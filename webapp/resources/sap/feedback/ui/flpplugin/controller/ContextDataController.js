/*!
 * SAPUI5

		(c) Copyright 2009-2020 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/base/Object","sap/base/util/extend","../utils/Constants","../data/AppContextData","../data/PushContextData"],function(O,e,C,A,P){"use strict";return O.extend("sap.feedback.ui.flpplugin.controller.ContextDataController",{_oConfig:{},_oAppContextData:null,_oSessionData:null,_sClientAction:null,_sLastTheme:null,_iFollowUpCount:null,constructor:function(c){this._oConfig=c;},init:function(){if(this._oConfig){this._oAppContextData=new A();this._collectSessionContextData(this._oConfig.getTenantId(),this._oConfig.getTenantRole(),this._oConfig.getProductName(),this._oConfig.getPlatformType());}else{this._resetContextData();}},updateContextData:function(c,p){this._resetContextData();this.setClientAction(c);var d=this._oConfig.getDataFormat();this._setSessionContextData(d);if(this._sClientAction===C.E_CLIENT_ACTION.backendPush||this._sClientAction===C.E_CLIENT_ACTION.inAppFeedback){this._setPushContextData(p.contextData);}return this._collectAppContextData(d);},setClientAction:function(c){this._sClientAction=c;this._updateClientAction();},setLastTheme:function(l){this._sLastTheme=l;this._updateLastTheme();},setFollowUpCount:function(f){this._iFollowUpCount=f;this._updateFollowUpCount();},getContextDataAsUrlParameter:function(){var s="";if(this._oConfig.getDataFormat()===C.E_DATA_FORMAT.version1){s+="?Q_Language="+encodeURIComponent(sap.qtxAppContext.language);s+="&language="+encodeURIComponent(sap.qtxAppContext.language);s+="&ui5Version="+encodeURIComponent(sap.qtxAppContext.ui5Version);s+="&ui5Theme="+encodeURIComponent(sap.qtxAppContext.ui5Theme);s+="&fioriId="+encodeURIComponent(sap.qtxAppContext.fioriId);s+="&appVersion="+encodeURIComponent(sap.qtxAppContext.appVersion);s+="&componentId="+encodeURIComponent(sap.qtxAppContext.componentId);s+="&appTitle="+encodeURIComponent(sap.qtxAppContext.appTitle);s+="&ach="+encodeURIComponent(sap.qtxAppContext.ach);s+="&tenantId="+encodeURIComponent(sap.qtxAppContext.tenantId);s+="&tenantRole="+encodeURIComponent(sap.qtxAppContext.tenantRole);}else if(this._oConfig.getDataFormat()===C.E_DATA_FORMAT.version2){s+="?Q_Language="+encodeURIComponent(sap.qtx.appcontext.languageTag);s+="&language="+encodeURIComponent(sap.qtx.appcontext.languageTag);s+="&appFrameworkId="+encodeURIComponent(sap.qtx.appcontext.appFrameworkId);s+="&appFrameworkVersion="+encodeURIComponent(sap.qtx.appcontext.appFrameworkVersion);s+="&theme="+encodeURIComponent(sap.qtx.appcontext.theme);s+="&appId="+encodeURIComponent(sap.qtx.appcontext.appId);s+="&appVersion="+encodeURIComponent(sap.qtx.appcontext.appVersion);s+="&technicalAppComponentId="+encodeURIComponent(sap.qtx.appcontext.technicalAppComponentId);s+="&appTitle="+encodeURIComponent(sap.qtx.appcontext.appTitle);s+="&appSupportInfo="+encodeURIComponent(sap.qtx.appcontext.appSupportInfo);s+="&previousTheme="+encodeURIComponent(this._sLastTheme);s+="&clientAction="+encodeURIComponent(this._sClientAction);s+="&followUpCount="+encodeURIComponent(this._iFollowUpCount);if(sap.qtx.session){s+="&tenantId="+encodeURIComponent(sap.qtx.session.tenantId);s+="&tenantRole="+encodeURIComponent(sap.qtx.session.tenantRole);s+="&productName="+encodeURIComponent(sap.qtx.session.productName);s+="&platformType="+encodeURIComponent(sap.qtx.session.platformType);}if(sap.qtx.push){s+="&pushSrcType="+encodeURIComponent(sap.qtx.push.srcType);s+="&pushSrcAppId="+encodeURIComponent(sap.qtx.push.srcAppId);s+="&pushSrcTrigger="+encodeURIComponent(sap.qtx.push.srcAppTrigger);}}return s;},_setPushContextData:function(p){if(!sap.qtx){sap.qtx={};}sap.qtx.push={};sap.qtx.push.srcType=p.getSourceType();sap.qtx.push.srcAppId=p.getSourceAppId();sap.qtx.push.srcAppTrigger=p.getSourceAppTrigger();},_collectSessionContextData:function(t,r,p,s){this._oSessionData={tenantId:t,tenantRole:r,productName:p,platformType:s};},_setSessionContextData:function(d){if(d===C.E_DATA_FORMAT.version1){if(!sap.qtxAppContext){sap.qtxAppContext={};}sap.qtxAppContext=e(sap.qtxAppContext,this._oSessionData);}else if(d===C.E_DATA_FORMAT.version2){if(!sap.qtx){sap.qtx={};}sap.qtx.session=this._oSessionData;}},_resetContextData:function(){sap.qtxAppContext={};if(!sap.qtx){sap.qtx={};}sap.qtx.appcontext={};sap.qtx.push={};},_collectAppContextData:function(d){return this._oAppContextData.getData(d).then(function(c){this._setAppContextData(c,d);}.bind(this));},_setAppContextData:function(c,d){if(d===C.E_DATA_FORMAT.version1){sap.qtxAppContext=e(sap.qtxAppContext,c);}else if(d===C.E_DATA_FORMAT.version2){sap.qtx.appcontext=c;this._updateClientAction();}},_ensureExistenceOfAppContextOnGlobalQtx:function(){if(!sap.qtx){sap.qtx={};}if(!sap.qtx.appcontext){sap.qtx.appcontext={};}},_updateClientAction:function(){this._ensureExistenceOfAppContextOnGlobalQtx();sap.qtx.appcontext.clientAction=this._sClientAction;},_updateLastTheme:function(){this._ensureExistenceOfAppContextOnGlobalQtx();sap.qtx.appcontext.previousTheme=this._sLastTheme;},_updateFollowUpCount:function(){this._ensureExistenceOfAppContextOnGlobalQtx();sap.qtx.appcontext.followUpCount=this._iFollowUpCount;}});});
