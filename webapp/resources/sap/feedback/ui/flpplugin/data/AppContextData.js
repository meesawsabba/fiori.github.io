/*!
 * SAPUI5

		(c) Copyright 2009-2020 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/base/Object","sap/base/Log","sap/ushell/services/AppConfiguration","../utils/Constants","../utils/Utils"],function(O,L,A,C,U){"use strict";return O.extend("sap.feedback.ui.flpplugin.data.AppContextData",{_dataV1:null,_dataV2:null,constructor:function(){},getData:function(f){return this._updateData().then(function(){if(f===C.E_DATA_FORMAT.version1){return this._dataV1;}else if(f===C.E_DATA_FORMAT.version2){return this._dataV2;}return null;}.bind(this));},_updateData:function(){this._resetData();return this._collectData().then(function(c){this._setData(c);}.bind(this),function(){this._resetData();}.bind(this));},_resetData:function(){this._dataV1={ui5Version:C.S_DEFAULT_VALUE,ui5Theme:C.S_DEFAULT_VALUE,fioriId:C.S_DEFAULT_VALUE,appTitle:C.S_DEFAULT_VALUE,language:C.S_DEFAULT_VALUE,componentId:C.S_DEFAULT_VALUE,appVersion:C.S_DEFAULT_VALUE,ach:C.S_DEFAULT_VALUE};this._dataV2={appFrameworkId:C.S_DEFAULT_VALUE,appFrameworkVersion:C.S_DEFAULT_VALUE,theme:C.S_DEFAULT_VALUE,appId:C.S_DEFAULT_VALUE,appTitle:C.S_DEFAULT_VALUE,languageTag:C.S_DEFAULT_VALUE,technicalAppComponentId:C.S_DEFAULT_VALUE,appVersion:C.S_DEFAULT_VALUE,appSupportInfo:C.S_DEFAULT_VALUE};},_setData:function(c){this._dataV1={ui5Version:c.appFrameworkVersion,ui5Theme:c.theme,fioriId:c.appId,appTitle:c.appTitle,language:c.languageTag,componentId:c.technicalAppComponentId,appVersion:c.appVersion,ach:c.appSupportInfo};this._dataV2=c;},_getUserInfo:function(){return sap.ushell.Container.getService("UserInfo");},_getLanguage:function(u){if(u){var v=u.getLanguage();if(v&&v.length===2){return v.toUpperCase();}}return sap.ui.getCore().getConfiguration().getLocale().getLanguage().toUpperCase();},_collectData:function(){return new Promise(function(r,R){var c=U.getCurrentApp();if(U.isSupportedAppType(c)){this._collectionAppInfoData(c).then(function(i){var o=this._assignAppInfoData(i);r(o);}.bind(this));}else{L.warning("App not of a supported app type.",null,C.S_PLUGIN_APPCONTEXTDATA_NAME);R();}}.bind(this));},_collectionAppInfoData:function(c){return new Promise(function(r,R){var a=["appId","appVersion","appSupportInfo","technicalAppComponentId","appFrameworkId","appFrameworkVersion"];c.getInfo(a).then(function(i){var m=A.getMetadata();if(m&&m.title){i.appTitle=m.title;}if(i.appId&&i.appId===C.S_LAUNCHPAD_VALUE){i.appTitle=U.stringToTitleCase(i.appId);}r(i);}).catch(function(e){R(e);});});},_assignAppInfoData:function(i){var c={};var u=this._getUserInfo();if(u){var o=u.getUser();if(o){c.languageTag=this._getLanguage(o);}}c.theme=sap.ui.getCore().getConfiguration().getTheme();if(i){c.appFrameworkId=U.convertAppFrameworkTypeToId(i["appFrameworkId"])||C.S_DEFAULT_VALUE;c.appFrameworkVersion=i["appFrameworkVersion"]||C.S_DEFAULT_VALUE;c.appId=i["appId"]||C.S_DEFAULT_VALUE;c.appTitle=i["appTitle"]||C.S_DEFAULT_VALUE;c.technicalAppComponentId=i["technicalAppComponentId"]||C.S_DEFAULT_VALUE;c.appVersion=i["appVersion"]||C.S_DEFAULT_VALUE;c.appSupportInfo=i["appSupportInfo"]||C.S_DEFAULT_VALUE;}return c;}});});
