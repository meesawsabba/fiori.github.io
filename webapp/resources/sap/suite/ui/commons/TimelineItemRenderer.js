/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["./library","sap/suite/ui/commons/util/HtmlElement","sap/ui/core/format/DateFormat","sap/ui/core/Icon","sap/base/security/encodeXML","sap/base/security/encodeCSS",'sap/ui/core/InvisibleText'],function(l,H,D,I,e,a,b){"use strict";var T=l.TimelineAlignment;var c={};var r=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons"),M=24*60*60*1000;c.render=function(R,t){this._getTimelineItemElement(t).getRenderer().render(R);};c._getTimelineItemElement=function(t){if(t._orientation==="V"){return this._getVerticalTimelineItemElement(t);}else{return this._getHorizontalTimelineItemElement(t);}};c._getFormatedDateTime=function(t,A){A=A||{};var R=A.resBundle||r,d=A.dateFormat||D.getDateInstance({style:"short"}),o=A.timeFormat||D.getTimeInstance({style:"short"}),f=t.getDateTimeWithoutStringParse(),g,h,i,C;if(!(f instanceof Date)||(isNaN(f.getTime()))){return f;}g=Date.UTC(f.getFullYear(),f.getMonth(),f.getDate());h=new Date();h=Date.UTC(h.getFullYear(),h.getMonth(),h.getDate());i=Math.floor((h-g)/M);switch(i){case 0:C=R.getText("TIMELINE_TODAY");break;case 1:C=R.getText("TIMELINE_YESTERDAY");break;default:C=d.format(f);}return C+" "+R.getText("TIMELINE_AT")+" "+o.format(f);};c._getHorizontalTimelineItemElement=function(t){var i=(t._placementLine==="top"),s=i?"sapSuiteUiCommonsTimelineItemHTop":"sapSuiteUiCommonsTimelineItemHBottom",d=t.getText()==="GroupHeader",g=t._groupID,A,o;if(d){return this._getGroupHeaderElement(t);}var f=new H("li"),h=new H("div"),j=new H("div"),k=new H("div"),m=new H("div"),n=new H("div"),p=new H("div"),q=this._getTimelineItemShell(t);if(g){f.setAttribute("groupid",t._groupID,true);}if(t._isFirstGroupEvenItem){f.setAttribute("firstgroupevenitem",t._isFirstGroupEvenItem);}f.addControlData(t);f.addClass("sapSuiteUiCommonsTimelineItemLiWrapperV");f.addClass(e(s));h.addClass("sapSuiteUiCommonsTimelineItemWrapperH sapSuiteUiCommonsTimelineItemBaseLength");f.addChild(h);j.addClass("sapSuiteUiCommonsTimelineItemBubbleSpacer");h.addChild(j);k.addClass("sapSuiteUiCommonsTimelineItemBubble");j.addChild(k);m.addClass("sapSuiteUiCommonsTimelineItemOutline");m.setId(t.getId()+"-outline");m.setAttribute("tabindex","0");this._addAccessibilityTags(m,t);n.addClass("sapSuiteUiCommonsTimelineItemBox");m.addChild(n);p.addClass("sapSuiteUiCommonsTimelineItemArrow");if(i){k.addChild(m);k.addChild(p);}else{k.addChild(p);k.addChild(m);}if(!t._callParentFn("_isGrouped")&&t._callParentFn("getEnableDoubleSided")&&t._index===1){o=t.getParent();A="margin-left";if(o&&o._bRtlMode){A="margin-right";}f.addStyle(a(A),"100px");}n.addChild(q);if(t._isGroupCollapsed()){f.addStyle("display","none");}return f;};c._getGroupHeaderElement=function(t){var d=new H("li"),f=new H("div"),g=new H("div"),h=new H("div"),i=new H("div"),j=new H("div"),k=new H("span"),m=new H("div"),n=new H("div"),o=new H("div"),p=t._orientation==="V"?g:h,q=new H("div"),s=new H("div"),u=new H("div");var v=t._isGroupCollapsed(),S=t._callParentFn("getShowIcons"),w;if(t._groupID){d.setAttribute("groupid",t._groupID,true);}if(t._isLastGroup){d.addClass("sapSuiteUiCommonsTimelineLastItem");}d.addControlData(t);d.addClass("sapSuiteUiCommonsTimelineGroupHeader");d.addChild(f);f.addChild(g);f.addClass("sapSuiteUiCommonsTimelineGroupHeaderDirectChild");g.addClass("sapSuiteUiCommonsTimelineGroupHeaderMainWrapper");g.setId(t.getId()+"-outline");g.setAttribute("tabindex","0");this._addAccessibilityTags(g,t,true);g.setAttribute("data-sap-ui-fastnavgroup",true);g.addChild(h);d.addChild(o);d.setAttribute("nodeType","GroupHeader");i.addClass("sapSuiteUiCommonsTimelineGroupHeaderSpanWrapper");if(t._orientation==="V"){d.addClass(t._position===T.Left?"sapSuiteUiCommonsTimelineItemWrapperVLeft":"sapSuiteUiCommonsTimelineItemWrapperVRight");d.setAttribute("role","treeitem");d.setAttribute("aria-expanded",v?false:true);d.setAttribute("aria-level",1);}else{d.setAttribute("role","presentation");}h.addClass("sapSuiteUiCommonsTimelineGroupHeaderWrapper");h.addClass("sapSuiteUiCommonsTimelineGroupHeaderPointer");p.addChild(j);h.addChild(n);h.addChild(i);d.addClass(v?"sapSuiteUiCommonsTimelineGroupCollapsed":"sapSuiteUiCommonsTimelineGroupExpanded");n.addClass("sapSuiteUiCommonsTimelineGroupHeaderIconWrapper");w=t._getCorrectGroupIcon();t._objects.register("groupCollapseIcon",function(){var x=new I(t.getId()+"-groupCollapseIcon",{src:w,decorative:true});x.addStyleClass("sapSuiteUiCommonsTimelineGroupHeaderPointer");x.setParent(t);return x;});n.addChild(t._objects.getGroupCollapseIcon());j.addClass("sapSuiteUiCommonsTimelineItemArrow");o.addClass("sapSuiteUiCommonsTimelineGroupHeaderLineWrapper");m.addClass("sapSuiteUiCommonsTimelineGroupHeaderLine");o.addChild(m);i.addChild(k);k.addClass("sapSuiteUiCommonsTimelineGroupHeaderSpan");k.addChildEscaped(" "+t.getTitle());if(t._orientation==="V"){d.addChild(q);s.addChild(t._getLineIcon());q.addChild(s);s.addClass("sapSuiteUiCommonsTimelineItemBarIconWrapperV");q.addClass("sapSuiteUiCommonsTimelineGroupHeaderBarWrapper");if(!t._isGroupCollapsed()){q.addStyle("display","none");}u.addClass("sapSuiteUiCommonsTimelineItemBarV");if(!S){u.addClass("sapSuiteUiCommonsTimelineItemBarNoIcon");}q.addChild(u);if(t._additionalBarClass){u.addClass(e(t._additionalBarClass));}}return d;};c._getVerticalTimelineItemElement=function(t){var d=new H("li"),f=new H("div"),g=new H("div"),h=new H("div"),i=new H("div"),j=new H("div"),k=new H("div"),m=new H("div"),n=new H("div"),o=new H("div"),p=new H("div"),q,s=new H("ul");var S=t._callParentFn("getShowIcons"),G=t._groupID,u=t.getText()==="GroupHeader",v=t._getStatusColorClass();if(u){return this._getGroupHeaderElement(t);}if(G){d.setAttribute("groupID",G,true);d.setAttribute("aria-level",2);}else{d.setAttribute("role","presentation");}d.addControlData(t);d.addClass("sapSuiteUiCommonsTimelineItem");d.setAttribute("aria-labelledby",t.getAriaLabelledBy().join(" "),true);if(t._isLast){d.addClass("sapSuiteUiCommonsTimelineLastItem");}f.addClass(u?"sapSuiteUiCommonsTimelineItemWrapperGrp":"sapSuiteUiCommonsTimelineItemWrapperV");d.addChild(f);f.addClass(t._position===T.Left?"sapSuiteUiCommonsTimelineItemWrapperVLeft":"sapSuiteUiCommonsTimelineItemWrapperVRight");f.addChild(i);f.addChild(g);g.addClass("sapSuiteUiCommonsTimelineItemBarWrapperV");h.addClass("sapSuiteUiCommonsTimelineItemBarIconWrapperV");if(v){h.addClass(e(v));}else{h.addClass("sapSuiteUiCommonsTimelineNoStatus");}if(S){g.addChild(h);h.addChild(t._getLineIcon('',G));}else{p.addChild(o);p.addClass("sapSuiteUiCommonsTimelineItemNoIconWrapper");o.addClass("sapSuiteUiCommonsTimelineItemNoIcon");g.addChild(p);if(v){o.addClass(e(v));}j.addClass("sapSuiteUiCommonsTimelineItemBarNoIcon");}j.addClass("sapSuiteUiCommonsTimelineItemBarV");g.addChild(j);if(t._additionalBarClass){j.addClass(e(t._additionalBarClass));}i.addClass("sapSuiteUiCommonsTimelineItemBubble");n.addClass("sapSuiteUiCommonsTimelineItemArrow");i.addChild(n);i.addChild(m);m.addClass("sapSuiteUiCommonsTimelineItemOutline");m.setId(t.getId()+"-outline");m.setAttribute("tabindex","0");this._addAccessibilityTags(m,t);k.addClass("sapSuiteUiCommonsTimelineItemBox");m.addChild(k);q=this._getTimelineItemShell(t);k.addChild(q);if(t._isGroupCollapsed()){s.addStyle("display","none");}if(G){s.addClass("sapSuiteUiCommonsTimelineItemUlWrapper");s.addChild(d);return s;}return d;};c._getTimelineItemShell=function(t){var d=new H("div"),f=new H("div"),g=new H("div"),h=new H("span"),u,U,i=new H("span"),j=new H("div"),k=new H("div"),m=new H("div"),n=new H("span"),o=new H("div"),p=new H("span"),q=new H("div"),s;var E=t.getEmbeddedControl();d.setId(t.getId()+"-shell");d.addClass("sapSuiteUiCommonsTimelineItemShell");d.addChild(t._objects.getInfoBar());d.addChild(f);f.addClass("sapSuiteUiCommonsTimelineItemHeaderWrapper");u=t._getUserPictureControl();if(u){u.addStyleClass("sapSuiteUiCommonsTimelineItemUserPicture");f.addChild(u);}g.setId(t.getId()+"-header");g.addClass("sapSuiteUiCommonsTimelineItemHeader");g.addClass("sapSuiteUiCommonsTimelineItemTextLineClamp");h.setId(t.getId()+"-username");h.addClass("sapSuiteUiCommonsTimelineItemShellUser");g.addChild(h);U=t._getUserNameLinkControl();if(U){h.addChild(U);}else{h.addChildEscaped(t.getUserName());h.addClass("sapUiSelectable");}f.addChild(g);i.addClass("sapSuiteUiCommonsTimelineItemShellHdr");i.addClass("sapUiSelectable");i.addChildEscaped(" "+t.getTitle());g.addChild(i);j.addClass("sapSuiteUiCommonsTimelineItemShellDateTime");j.addClass("sapUiSelectable");j.addChildEscaped(this._getFormatedDateTime(t));g.addChild(j);k.addClass("sapSuiteUiCommonsTimelineItemShellBody");d.addChild(k);if(E!==null){k.addChild(E);}else if(t.getText()){m.addChild(n);m.addClass("sapSuiteUiCommonsTimelineItemTextWrapper");n.setId(t.getId()+"-realtext");n.addClass("sapUiSelectable");k.addChild(m);s=t._checkTextIsExpandable();if(s){p.setId(t.getId()+"-threeDots");p.addClass("sapMFeedListItemTextString");p.addChildEscaped(" ");m.addChild(p);n.addChildEscaped(t._getCollapsedText(),true);p.addChildEscaped("... ");m.setAttribute("expandable",true);}else{n.addChildEscaped(t.getText(),true);o.addStyle("display","none");}k.addChild(o);o.addClass("sapSuiteUiCommonsTimelineItemShowMore");o.addChild(t._getButtonExpandCollapse());}if(t.getParent()&&t.getParent()._aFilterList&&(t._callParentFn("getEnableSocial")||t.getCustomAction().length>0)){q.addClass("sapSuiteUiCommonsTimelineItemShellBottom");q.addChild(t._objects.getSocialBar());d.addChild(q);}return d;};c._addAccessibilityTags=function(d,t,i){var g;d.setAttribute("role","option");if(t.getStatus()){var o=new b();o.setText("status "+t.getStatus());o.toStatic();d.setAttribute("aria-describedby",o.getId(),true);}if(typeof t._index==="number"){d.setAttribute("aria-posinset",t._index+1);d.setAttribute("aria-setsize",t._callParentFn("_getItemsCount"));}d.setAttribute("aria-live","polite");if(i){d.setAttribute("aria-expanded",!t._isGroupCollapsed());if(!t._isGroupCollapsed()){g=r.getText("TIMELINE_ACCESSIBILITY_GROUP_HEADER")+": "+t.getTitle()+" "+r.getText("TIMELINE_ACCESSIBILITY_GROUP_EXPAND");}else{g=r.getText("TIMELINE_ACCESSIBILITY_GROUP_HEADER")+": "+t.getTitle()+" "+r.getText("TIMELINE_ACCESSIBILITY_GROUP_COLLAPSE");}d.setAttribute("aria-label",g,true);}};return c;},true);
