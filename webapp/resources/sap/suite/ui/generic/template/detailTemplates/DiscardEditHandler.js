sap.ui.define(["sap/ui/base/Object","sap/base/util/extend"],function(B,e){"use strict";function g(c,t,v,s){var i=t.oComponentUtils.isDraftEnabled();var C=t.oComponentUtils.getCRUDActionHandler();var b=t.oServices.oApplication.getBusyHelper();var V=c.getView();var u=V.getModel("ui");var T=t.oComponentUtils.getTemplatePrivateModel();var a=T.setProperty.bind(T,"/objectPage/cancelEnabled");var o;var d;var I=false;var f=false;var h;var j;if(i&&t.oComponentUtils.getViewLevel()!==1){j=Function.prototype;}function F(){j();h=null;j=null;}function k(){f=false;if(I){o.close();}else{F();}}function O(p,q){if(!d){d=t.oCommonUtils.getDialogFragmentAsync("sap.suite.ui.generic.template.fragments.DiscardEditPopover",{onDiscardConfirm:function(){if(!I||f){return;}h();a(true);},beforeClose:function(){I=false;if(!f){F();}},afterClose:function(){a(true);}},"discard",function(r,w){w.setProperty("/placement",sap.m.PlacementType.Top);});}d.then(function(r){I=true;o=r;var w=o.getModel("discard");w.setProperty("/isCreate",q);a(false);o.openBy(p);});}function l(){if(i){var p=V.getBindingContext();return t.oServices.oApplication.getNavigateAfterDraftCancelPromise(p).then(function(N){return function(){t.oServices.oViewDependencyHelper.setRootPageToDirty();t.oServices.oViewDependencyHelper.unbindChildren(c.getOwnerComponent());t.oServices.oApplication.invalidatePaginatorInfo();N();};});}return Promise.resolve(function(){if(u.getProperty("/createMode")){var q=c.getOwnerComponent().getModel("_templPrivGlobal");var r=q.getProperty("/generic/FCL");return(r&&r.highestViewLevel===1)?t.oServices.oNavigationController.navigateToRoot():t.oServices.oNavigationController.navigateBack();}});}function n(){return new Promise(function(r){if(i){var p=V.getBindingContext();var P=p.getPath();C.hasValidationMessageOnDetailsViews().then(function(H){var q=t.oServices.oApplication.getIsDraftModified(P)||H;r(q);});}else{r(t.oComponentUtils.isComponentDirty());}});}function m(){if(i){var p=V.getBindingContext();var E=p.getObject();var q=E.hasOwnProperty("HasActiveEntity")&&!p.getProperty("IsActiveEntity")&&!p.getProperty("HasActiveEntity");return q;}return u.getProperty("/createMode");}function D(p){if(j){return Promise.reject();}if(!(t.oComponentUtils.isComponentActive()&&u.getProperty("/editable"))){return Promise.reject();}var r=new Promise(function(R,q){j=q;var E=l();var P=function(){if(p&&b.isBusy()){F();return;}var w=function(){f=true;var x=E.then(function(A){var S=function(){j=R;A();k();};var y;if(i){y=t.oServices.oCRUDManager.discardDraft(V.getBindingContext()).then(S);y.catch(k);}else{S();}t.oComponentUtils.cancelEdit(y);return y;});b.setBusy(x);};n().then(function(N){if(p&&N){h=w;O(p,m());}else{w();}});};t.oServices.oApplication.performAfterSideEffectExecution(P);});r.catch(Function.prototype);return r;}return{discardEdit:D};}return B.extend("sap.suite.ui.generic.template.detailTemplates.DiscardEditHandler",{constructor:function(c,t,v,s){e(this,g(c,t,v,s));}});});
