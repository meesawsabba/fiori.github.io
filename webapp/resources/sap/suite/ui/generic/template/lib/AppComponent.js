/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/base/util/extend","sap/base/util/isPlainObject","sap/m/NavContainer","sap/f/FlexibleColumnLayout","sap/ui/core/UIComponent","sap/ui/model/base/ManagedObjectModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/json/JSONModel","sap/ui/model/odata/MessageScope","sap/ui/model/resource/ResourceModel","sap/ui/generic/app/ApplicationController","sap/suite/ui/generic/template/genericUtilities/ProcessObserver","sap/suite/ui/generic/template/lib/Application","sap/suite/ui/generic/template/lib/BusyHelper","sap/suite/ui/generic/template/lib/DataLossHandler","sap/suite/ui/generic/template/lib/navigation/NavigationController","sap/suite/ui/generic/template/lib/TemplateAssembler","sap/suite/ui/generic/template/lib/CRUDHelper","sap/suite/ui/generic/template/lib/ViewDependencyHelper","sap/suite/ui/generic/template/genericUtilities/testableHelper","sap/suite/ui/generic/template/support/lib/CommonMethods","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/suite/ui/generic/template/lib/navigation/startupParameterHelper","sap/suite/ui/generic/template/lib/PageLeaveHandler","sap/suite/ui/generic/template/lib/ShareUtils"],function(e,a,N,F,U,M,b,c,J,d,R,A,P,f,B,D,g,T,C,V,t,h,j,s,k,S){"use strict";var l="lib.AppComponent";var L=new j(l).getLogger();A=t.observableConstructor(A);var m=sap.m.DraftIndicatorState;var r=T.getRegisterAppComponent();var n=true;if(window["sap-ushell-config"]&&window["sap-ushell-config"].apps&&window["sap-ushell-config"].apps.placeholder){n=window["sap-ushell-config"].apps.placeholder.enabled;}var o;function p(){o=o||new R({bundleName:"sap/suite/ui/generic/template/lib/i18n/i18n"}).getResourceBundle();return o.getText.apply(o,arguments);}function q(){return new P({processObservers:[]});}var u=sap.ui.getCore().getMessageManager().getMessageModel();var v=new b({path:"validation",operator:c.EQ,value1:true});function w(x,y){var z;var E={oAppComponent:x,leaveAppPromise:Promise.resolve(),ghostapp:(function(){var i=x.getManifestEntry("sap.ui.generic.app");return!!(i&&i.settings&&i.settings.ghostapp);})(),componentRegistry:Object.create(null),aRunningSideEffectExecutions:[],getText:p,oTemplatePrivateGlobalModel:(new J()).setDefaultBindingMode("TwoWay"),aStateChangers:[],oPaginatorInfo:Object.create(null),oStatePreserversAvailablePromise:Promise.resolve(),oValidationMessageBinding:u.bindList("/",null,null,v),bEnablePlaceholder:n};E.oDataLossHandler=new D(E);E.oPageLeaveHandler=new k(E);E.oValidationMessageBinding.attachChange(Function.prototype);var G;var H;var I;function K(){var i=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService("URLParsing");E.oTemplatePrivateGlobalModel.setProperty("/generic",{draftIndicatorState:m.Clear,shellServiceUnavailable:false,forceFullscreenCreate:false});x.setModel(E.oTemplatePrivateGlobalModel,"_templPrivGlobal");E.oShellServicePromise.catch(function(){E.oTemplatePrivateGlobalModel.setProperty("/generic/shellServiceUnavailable",true);});var o1=S.getCurrentUrl();o1.then(function(p1){E.oTemplatePrivateGlobalModel.setProperty("/generic/crossAppNavSupport",!!i&&i.isIntentUrl(p1));});var u=sap.ui.getCore().getMessageManager().getMessageModel();x.setModel(u,"_templPrivMessage");}function O(){E.fnAddSideEffectPromise=function(q1){var i=0;for(;E.aRunningSideEffectExecutions[i];){i++;}E.aRunningSideEffectExecutions[i]=q1;var r1=function(){E.aRunningSideEffectExecutions[i]=null;};q1.then(r1,r1);};G.attachEvent("beforeSideEffectExecution",function(i){var q1=i.getParameter("promise");setTimeout(E.oBusyHelper.setBusy.bind(null,q1),1000);E.fnAddSideEffectPromise(q1);});var o1=x.getModel("_templPrivGlobal");var p1="/generic/draftIndicatorState";G.attachBeforeQueueItemProcess(function(i){if(i.draftSave){o1.setProperty(p1,m.Saving);}});G.attachOnQueueCompleted(function(){if(o1.getProperty(p1)===m.Saving){o1.setProperty(p1,m.Saved);}});G.attachOnQueueFailed(function(){if(o1.getProperty(p1)===m.Saving){o1.setProperty(p1,m.Clear);}});o1.setProperty("/generic/appComponentName",x.getMetadata().getComponentName());}function Q(){var i={appComponent:x,oTemplateContract:E,application:new f(E),oViewDependencyHelper:new V(E)};E.oViewDependencyHelper=i.oViewDependencyHelper;E.oShellServicePromise=x.getService("ShellUIService").catch(function(){var r1=sap.ui.core.service.ServiceFactoryRegistry.get("sap.ushell.ui5service.ShellUIService");return((r1&&r1.createInstance())||Promise.reject());});E.oShellServicePromise.catch(function(){L.warning("No ShellService available");});var o1=i1().settings;if(o1&&o1.hasOwnProperty("ghostapp")){o1=e({},o1);delete o1.ghostapp;}else{o1=o1||Object.create(null);}x.applySettings(o1);(U.prototype.init||Function.prototype).apply(x,arguments);E.appSettings=new M(x);E.oBusyHelper.setBusy(E.oShellServicePromise,undefined,undefined,true);I=r(i);var p1=x.getModel();E.bCreateRequestsCanonical=true;var q1=p1.messageScopeSupported();E.oBusyHelper.setBusy(q1,undefined,undefined,true);q1.then(function(r1){if(r1){p1.setPersistTechnicalMessages(true);p1.setMessageScope(d.BusinessObject);E.bCreateRequestsCanonical=false;}G=new A(p1);K();H=new g(E);O();C.enableAutomaticDraftSaving(E);if((!p1.oMetadata||!p1.oMetadata.isLoaded())||p1.oMetadata.isFailed()){p1.attachMetadataFailed(function(){H.navigateToMessagePage({title:p("ST_GENERIC_ERROR_TITLE"),text:p("ST_GENERIC_ERROR_SYSTEM_UNAVAILABLE"),icon:"sap-icon://message-error",description:p("ST_GENERIC_ERROR_SYSTEM_UNAVAILABLE_DESC")});for(var t1 in E.componentRegistry){E.componentRegistry[t1].fnViewRegisteredResolve(true);}});}if(x&&x.getMetadata()&&x.getMetadata().getManifest()){h.setAppComponent(x);}h.setApplicationStatus(h.mApplicationStatus.LOADING);h.publishEvent("elements","ViewRenderingStarted",{});var s1=sap.ushell&&sap.ushell.Container;if(s1){s1.registerDirtyStateProvider(m1);}});_();}function W(){if(E.oNavigationHost){return"";}if(x.getFlexibleColumnLayout()){var i=new F();E.oNavigationHost=i;E.aNavigationObservers=[new P({processName:"BeginColumnNavigation",eventHandlers:{attachProcessStart:i.attachBeginColumnNavigate.bind(i),attachProcessStop:i.attachAfterBeginColumnNavigate.bind(i)}}),new P({processName:"MidColumnNavigation",eventHandlers:{attachProcessStart:i.attachMidColumnNavigate.bind(i),attachProcessStop:i.attachAfterMidColumnNavigate.bind(i)}}),new P({processName:"EndColumnNavigation",eventHandlers:{attachProcessStart:i.attachEndColumnNavigate.bind(i),attachProcessStop:i.attachAfterEndColumnNavigate.bind(i)}})];E.oNavigationObserver=new P({processObservers:E.aNavigationObservers});E.aHeaderLoadingObservers=[q(),q(),q()];}else{var o1=new N({id:x.getId()+"-appContent"});E.oNavigationHost=o1;E.oNavigationObserver=new P({processName:"Navigation",eventHandlers:{attachProcessStart:o1.attachNavigate.bind(o1),attachProcessStop:o1.attachAfterNavigate.bind(o1)}});}E.oHeaderLoadingObserver=new P({processObservers:E.aHeaderLoadingObservers||[]});E.oPagesDataLoadedObserver=new P({processObservers:[E.oHeaderLoadingObserver,E.oNavigationObserver]});E.oNavigationHost.addStyleClass(E.oApplicationProxy.getContentDensityClass());E.oBusyHelper=new B(E);E.oBusyHelper.setBusyReason("HashChange",true,true,undefined,true);E.oBusyHelper.getUnbusy().then(function(){E.oShellServicePromise.then(function(p1){p1.setBackNavigation(E.oApplicationProxy.onBackButtonPressed);});});return E.oNavigationHost;}function X(){for(var i in E.componentRegistry){var o1=E.componentRegistry[i];o1.utils.leaveApp(false);}}function Y(){var i=sap.ushell&&sap.ushell.Container;if(i){i.deregisterDirtyStateProvider(m1);}E.ghostapp=true;if(E.oNavigationHost){E.oNavigationHost.destroy();}if(G){G.destroy();}if(H){H.destroy();}if(E.oValidationMessageBinding){E.oValidationMessageBinding.destroy();}h.setAppComponent(null);(U.prototype.exit||Function.prototype).apply(x,arguments);I();t.endApp(y);if(z){z();}}function Z(){for(var i in E.componentRegistry){var o1=E.componentRegistry[i];if(o1.methods.onSuspend){o1.methods.onSuspend();}}X();var p1=sap.ushell&&sap.ushell.Container;if(p1){p1.deregisterDirtyStateProvider(m1);}E.ghostapp=true;E.aStateChangers.forEach(function(q1){q1.leaveApp();});E.oNavigationControllerProxy.suspend();z();z=null;}function $(){for(var i in E.componentRegistry){var o1=E.componentRegistry[i];if(o1.methods.onRestore){o1.methods.onRestore();}}_();var p1=sap.ushell&&sap.ushell.Container;if(p1){p1.registerDirtyStateProvider(m1);}E.ghostapp=false;E.oNavigationControllerProxy.restore();}function _(){E.leaveAppPromise=new Promise(function(i){z=i;});}function a1(i){var o1=Object.keys(i).map(function(p1){var q1=i[p1];if(q1.pages){q1.pages=a1(q1.pages);}return i[p1];});return o1;}function b1(h1){if(h1.pages&&a(h1.pages)){h1.pages=(h1.pages&&a(h1.pages))?a1(h1.pages):h1.pages;}}function c1(o1,p1){if(!o1){return;}for(var i=0;i<o1.length;i++){var q1=o1[i];if(q1.routingSpec&&q1.routingSpec.noOData){q1.entitySet=q1.routingSpec.routeName;if(p1>1){q1.navigationProperty=q1.routingSpec.routeName;}}c1(q1.pages,p1+1);if(q1.embeddedComponents){for(var r1 in q1.embeddedComponents){var s1=q1.embeddedComponents[r1];if(s1.pages){s1.pages=a1(s1.pages);c1(s1.pages,p1+1);}}}if(q1.implementingComponent&&q1.implementingComponent.pages){q1.implementingComponent.pages=a1(q1.implementingComponent.pages);c1(q1.implementingComponent.pages,p1+1);}}}function d1(h1){c1(h1.pages,0);}function e1(i){if(i){var o1=i.entitySet;var p1=(i.component&&i.component.settings&&i.component.settings.quickVariantSelectionX&&i.component.settings.quickVariantSelectionX.variants)||{};var q1=function(p1){for(var r1 in p1){var s1=p1[r1];if(s1.entitySet){return true;}}return false;};if(q1(p1)){for(var r1 in p1){var s1=p1[r1];if(s1.entitySet===undefined){s1.entitySet=o1;}}}}}function f1(h1){e1(h1.pages[0]);}function g1(i){if(i&&i.objectPageDynamicHeaderTitleWithVM){i.objectPageHeaderType=i.objectPageHeaderType||"Dynamic";i.objectPageVariantManagement=i.objectPageVariantManagement||"VendorLayer";}}var h1;function i1(){if(!h1){var i=x.getMetadata();h1=i.getManifestEntry("sap.ui.generic.app");if(!h1){return Object.create(null);}b1(h1);d1(h1);f1(h1);g1(h1.settings);}return h1;}var j1;function k1(){if(!j1){j1=e({},x.getMetadata().getManifest());j1["sap.ui.generic.app"]=i1();}return j1;}function l1(){var i=x.getFlexibleColumnLayout()?"f":"m";return"sap."+i+".routing.Router";}function m1(i){return!E.ghostapp&&E.oDataLossHandler.getShellDataLossPopup(i);}var n1={init:Q,createContent:W,exit:Y,suspend:Z,restore:$,_getRouterClassName:l1,getConfig:i1,getInternalManifest:k1,getTransactionController:function(){return G.getTransactionController();},getApplicationController:function(){return G;},getNavigationController:function(){return H;},navigateBasedOnStartupParameter:function(i){E.oNavigationControllerProxy.clearHistory().then(s.parametersToNavigation.bind(null,E,i));}};var b1=t.testable(b1,"fnNormalizePagesMapToArray");i1=t.testable(i1,"getConfig");t.testable(_,"AppComponent_setLeaveAppPromise");return n1;}return U.extend("sap.suite.ui.generic.template.lib.AppComponent",{metadata:{config:{title:"SAP UI Application Component",fullWidth:true},properties:{forceGlobalRefresh:{type:"boolean",defaultValue:true},considerAnalyticalParameters:{type:"boolean",defaultValue:false},showDraftToggle:{type:"boolean",defaultValue:false},objectPageHeaderType:{type:"string",defaultValue:"Static"},objectPageVariantManagement:{type:"string",defaultValue:"None"},flexibleColumnLayout:{type:"object",defaultValue:null},inboundParameters:{type:"object",defaultValue:null},tableColumnVerticalAlignment:{type:"string",defaultValue:"Middle"},useColumnLayoutForSmartForm:{type:"boolean",defaultValue:true},statePreservationMode:{type:"string",defaultValue:"auto"},enableAutoColumnWidthForSmartTable:{type:"boolean",defaultValue:true},draftDiscardConfirmationSettings:{type:"object",defaultValue:{'enabled':'always'}}},events:{pageDataLoaded:{}},routing:{config:{async:true,viewType:"XML",viewPath:"",clearTarget:false},routes:[],targets:[]},library:"sap.suite.ui.generic.template"},suppressDataLossPopup:function(){return false;},constructor:function(){var i=t.startApp();e(this,w(this,i));(U.prototype.constructor||Function.prototype).apply(this,arguments);}});});
