sap.ui.define(["sap/ui/base/Object","sap/f/FlexibleColumnLayoutSemanticHelper","sap/f/library","sap/base/util/extend","sap/suite/ui/generic/template/genericUtilities/controlHelper"],function(B,F,f,e,c){"use strict";var L=f.LayoutType;var d=2;var C=["begin","mid","end"];var m=["messagePageBeginColumn","messagePageMidColumn","messagePageEndColumn"];function t(i){return C[i]?i:d;}function g(i){return C[t(i)]+"ColumnPages";}function a(o){for(var i=0;i<C.length;i++){o(m[i],g(i));}}function b(v){return m[t(v)];}function h(i){return C[t(i)];}function j(o){var i;if(o instanceof sap.ui.table.Table){i=o.getRows();}else if(o instanceof sap.m.Table||o instanceof sap.m.List){i=o.getItems();}return i;}function k(o){var i=j(o);var r=i?i[0]:false;return r;}function l(s){return(s&&(Array.isArray(s.FCLLayout)?s.FCLLayout.sort()[0]:s.FCLLayout))||"";}function n(o,N){var T=N.oTemplateContract;var p=T.oAppComponent.getFlexibleColumnLayout();var q=F.getInstanceFor(o,p);var u;var s;var S;var r=Object.create(null);var M=sap.ui.Device.system.phone?1:(p.maxColumnsCount||3);var v=M>1&&p.initialColumnsCount===2;var D;var w=(function(){var i=q.getDefaultLayouts();return[v?i.defaultTwoColumnLayoutType:i.defaultLayoutType,i.defaultTwoColumnLayoutType,i.defaultThreeColumnLayoutType];})();var x=p.displayNextObjectAfterDelete===true;function y(i){return i.fCLLevel===1||i.fCLLevel===2||(i.level===0&&v);}function z(i){if(i.fCLLevel===3||M===1||(i.fCLLevel===0&&i.level>0)){return 1;}var w1=p.initialColumnsCount||1;var x1=Math.max(i.fCLLevel+1,w1);return sap.ui.Device.system.tablet&&x1>2?2:x1;}function A(i,w1,x1,y1){var z1=z(y1);i.showBeginColumn=y1.fCLLevel===0||z1>1;i.showMidColumn=y1.fCLLevel===1||z1>1;i.showEndColumn=y1.fCLLevel>1;if(z1===1){i.target=w1;}else if(y1.level===0){D=y1.page.pages[0].entitySet;i.target=[w1,D];}else{i.target=x1.concat([w1]);}return g(y1.fCLLevel);}function E(i,w1){if(i===L.OneColumn&&v){return false;}var x1=w1&&T.mRoutingTree[w1];var y1=x1&&x1.defaultLayoutType;if(y1){return i===y1;}return i===w[0]||i===w[1]||i===w[2];}function G(i,w1,x1){var y1=T.mRoutingTree[x1];return y1.componentCreated.then(function(z1){return N.activateOneComponent(w1,i,z1);});}function H(i){var w1=N.getCurrentIdentity();if(!w1){return null;}var x1={};var y1=true;for(var z1=w1.treeNode;y1;z1=T.mRoutingTree[z1.parentRoute]){var A1=z1.fCLLevel;var B1=h(A1);x1[B1]={route:z1.sRouteName,path:i?"-":z1.getPath(2,w1.keys),isVisible:A1>2||u.columnsVisibility[B1+"Column"]};y1=A1===1||A1===2;i=false;}return x1;}function I(i,w1){var x1=H(i.isNonDraftCreate);if(!x1){return Promise.resolve();}var y1=[];w1=w1||x1;for(var z1 in w1){var A1=x1[z1];if(A1.isVisible){y1.push(G(i,A1.path,A1.route));}else{var B1=T.oTemplatePrivateGlobalModel.getProperty("/generic/routeLevel");var C1=T.mRoutingTree[A1.route];var D1=(B1===C1.level)?2:(3+W(s));N.setVisibilityOfRoute(A1.route,D1);}}return Promise.all(y1).then(N.afterActivation);}function J(i){var w1=N.getActivationInfo();I(w1,i);}function K(){return!(u.columnsVisibility.beginColumn?u.columnsVisibility.midColumn:u.columnsVisibility.midColumn&&u.columnsVisibility.endColumn);}function O(i){if(!u&&!i){return;}var w1=q.getCurrentUIState();var x1={};x1.end=u&&(u.columnsVisibility.endColumn!==w1.columnsVisibility.endColumn);x1.mid=u&&(u.columnsVisibility.midColumn!==w1.columnsVisibility.midColumn);x1.begin=u&&(u.columnsVisibility.beginColumn!==w1.columnsVisibility.beginColumn);u=w1;T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/midActionButtons",{fullScreen:u.actionButtonsInfo.midColumn.fullScreen!==null,exitFullScreen:u.actionButtonsInfo.midColumn.exitFullScreen!==null,closeColumn:u.actionButtonsInfo.midColumn.closeColumn!==null});T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/endActionButtons",{fullScreen:u.actionButtonsInfo.endColumn.fullScreen!==null,exitFullScreen:u.actionButtonsInfo.endColumn.exitFullScreen!==null,closeColumn:u.actionButtonsInfo.endColumn.closeColumn!==null});var y1=N.getCurrentIdentity();var z1=y1&&y1.treeNode;if(y1){var A1=K();var B1=z1.level-(z1.fCLLevel===2&&!u.columnsVisibility.endColumn);var C1=B1-(B1>1&&!A1)-(u.columnsVisibility.endColumn&&u.columnsVisibility.beginColumn&&B1>2);T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/isVisuallyFullScreen",A1);T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/highestViewLevel",B1);T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/lowestDetailViewLevel",C1);}if(y1&&s!==u.layout){var D1=E(u.layout,z1.sRouteName)?null:u.layout;N.navigateByExchangingQueryParam("FCLLayout",D1);}else{if((x1.begin||x1.mid||x1.end)&&!i){J(x1);}var E1=N.getActiveComponents();E1.forEach(function(F1){var G1=r[F1];var H1=s;var I1=T.componentRegistry[F1];if(H1===L.ThreeColumnsMidExpanded){var J1=T.mRoutingTree[I1.route];if(J1.fCLLevel===0){H1=L.ThreeColumnsEndExpanded;}}if(G1!==H1){r[F1]=H1;if(G1){I1.utils.layoutChanged();}}});}}var P=false;function Q(i){for(var w1=i.treeNode;w1.fCLLevel===1||w1.fCLLevel===2;){w1=T.mRoutingTree[w1.parentRoute];N.prepareHostView(w1);}if(v&&i.treeNode.level===0){var x1=T.mRoutingTree[D];N.prepareHostView(x1);}var y1=function(){if(y(i.treeNode)){s=U(i);if(!s){switch(i.treeNode.fCLLevel){case 0:var z1=q.getNextUIState(0).columnsVisibility;if(z1.midColumn){s=w[1];}else{s=w[0];N.navigateByExchangingQueryParam("FCLLayout",s);}break;case 1:s=w[1];break;case 2:s=w[2];break;default:}}}else{s=i.treeNode.fCLLevel===0?w[0]:L.EndColumnFullScreen;}o.setLayout(s);o.setAutoFocus(false);if(i.treeNode.fCLLevel===1||i.treeNode.fCLLevel===2){var A1=q.getCurrentUIState();if(A1.columnsVisibility.midColumn){var B1=1-A1.columnsVisibility.beginColumn;for(var w1=i.treeNode;w1.fCLLevel>B1;){w1=T.mRoutingTree[w1.parentRoute];i.componentsDisplayed[w1.sRouteName]=1;w1.display();}}}};if(P){y1();return Promise.resolve();}return q.whenReady().then(function(){P=true;y1();});}function R(i){O(true);return I(i);}function U(i){return l(i.appStates)||i.treeNode.defaultLayoutType||w[t(i.treeNode.fCLLevel)];}function V(i,w1,x1){if(!E(w1,x1)){i.FCLLayout=w1;}}function W(i){return i===L.EndColumnFullScreen||i===L.MidColumnFullScreen;}function X(i){return i===L.ThreeColumnsBeginExpandedEndHidden||i===L.ThreeColumnsMidExpandedEndHidden;}function Y(i,w1,x1,y1){var z1={treeNode:i,keys:w1,appStates:y1};var A1=N.getApplicableStateForIdentityAddedPromise(z1);x1.push(A1);}function Z(i,w1,x1,y1){V(i,x1,w1.sRouteName);var z1=[];if(!X(x1)){Y(w1,y1,z1,i);}if(!W(x1)){for(var A1=w1;A1.fCLLevel>0;){A1=T.mRoutingTree[A1.parentRoute];Y(A1,y1,z1,i);}}return Promise.all(z1);}function $(i){return W(s)?b1(i.fCLLevel):(i.defaultLayoutType||q.getNextUIState(i.fCLLevel).layout);}function _(i,w1){var x1=(w1.treeNode.fCLLevel===1&&i&&i.treeNode.parentRoute===w1.treeNode.sRouteName&&i.treeNode.fCLLevel===2)?u.actionButtonsInfo.endColumn.closeColumn:$(w1.treeNode);return Z(w1.appStates,w1.treeNode,x1,w1.keys);}function a1(i,w1,x1){var y1;if(i.treeNode.fCLLevel===w1.treeNode.fCLLevel){y1=s;}else if(i.treeNode.fCLLevel===2){y1=u.actionButtonsInfo.endColumn.closeColumn;}else{y1=$(w1.treeNode);}return Z(x1,w1.treeNode,y1,w1.keys);}function b1(i){if(i===0){return L.OneColumn;}else if(i===1){return L.MidColumnFullScreen;}else if(i===2){return L.EndColumnFullScreen;}else{return"";}}function c1(w1,x1){var y1=T.mRoutingTree[w1];if(!y(y1)){return null;}var z1=S||y1.defaultLayoutType||q.getNextUIState(y1.fCLLevel).layout;V(x1,z1,w1);S=null;if(W(z1)){return null;}var A1=[];for(var i=y1.fCLLevel;i>0;i--){var B1=y1.parentRoute;A1.push(N.addUrlParameterInfoForRoute(B1,x1));y1=T.mRoutingTree[B1];}return Promise.all(A1);}function d1(i,w1){if(i.treeNode.fCLLevel===0||i.treeNode.fCLLevel===3){return true;}var x1=U(i);var y1=U(w1);return W(x1)===W(y1);}function e1(i,w1,x1){var y1=function(){T.oApplicationProxy.performAfterSideEffectExecution(function(){var A1=h(i.fCLLevel);var B1=u.actionButtonsInfo[A1+"Column"][w1];var C1=x1?T.mRoutingTree[i.parentRoute]:i;var z1=N.getCurrentIdentity();var D1=Object.create(null);T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/FCLActionButton",0);if(w1==="fullScreen"||w1==="exitFullScreen"){T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/FCLActionButton",1);}else{T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/FCLActionButton",0);}var E1=Z(D1,C1,B1,z1.keys);var F1=E1.then(function(){N.navigateToIdentity({treeNode:C1,keys:(C1===z1.treeNode)?z1.keys:z1.keys.slice(0,C1.level+1),appStates:D1});});T.oBusyHelper.setBusy(F1);},true);};if(x1){var z1=T.oNavigationControllerProxy.getCurrentIdentity();if(z1.treeNode.isDraft&&z1.treeNode.level===1){T.oPageLeaveHandler.performAfterDiscardOrKeepDraft(y1,Function.prototype,"LeavePage");}else{T.oDataLossHandler.performIfNoDataLoss(y1,Function.prototype,"LeavePage");}}else{y1();}}function f1(i){return{onCloseColumnPressed:e1.bind(null,i,"closeColumn",true),onFullscreenColumnPressed:e1.bind(null,i,"fullScreen",false),onExitFullscreenColumnPressed:e1.bind(null,i,"exitFullScreen",false)};}T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL",{});function g1(i){s=q.getNextUIState(i).layout;o.setLayout(s);}function h1(){return!K();}function i1(i,w1){var x1=0;for(var y1 in w1){var z1=T.mRoutingTree[y1];if(z1.level>=i.viewLevel&&w1[y1]===1){if(z1.level===i.viewLevel){x1=z1.fCLLevel;}w1[y1]=5+(z1.level>i.viewLevel);}}g1(x1);var A1=N.oRouter.getTargets();var B1=b(x1);A1.display(B1);}function j1(i,w1){if(!y(w1)){return;}var x1=b1(w1.fCLLevel);if(E(x1,w1.sRouteName)){return;}i.FCLLayout=x1;}function k1(i,w1,x1){if(x1&&x1.appStates&&x1.appStates.FCLLayout){i.FCLLayout=x1.appStates.FCLLayout;}else{delete i.FCLLayout;}}function l1(i,w1){if(i.page.defaultLayoutTypeIfExternalNavigation&&!E(i.page.defaultLayoutTypeIfExternalNavigation,i.sRouteName)){w1.FCLLayout=i.page.defaultLayoutTypeIfExternalNavigation;}else{delete w1.FCLLayout;}}function m1(i){return i.treeNode.fCLLevel==0||i.treeNode.fCLLevel==3||W(U(i));}function n1(i){return!m1(i);}function o1(){return M;}function p1(i,w1){if(!v){return;}var x1=false;var y1=q.getNextUIState(0).columnsVisibility;if(y1.midColumn){var z1=N.getCurrentIdentity();var A1=z1&&z1.treeNode;x1=A1&&A1.level===0&&l(z1.appStates)!==L.OneColumn;}if(x1){if(i){w1(i);}else{N.navigateByExchangingQueryParam("FCLLayout",L.OneColumn);}}}function q1(){return x;}function r1(){return v;}function s1(i,w1){if(c.isSmartTable(i)){i=i.getTable();}else if(c.isSmartList(i)){i=i.getList();}var x1=k(i);p1(x1,w1);}function t1(i){if(i>2){S="";}else{S=b1(i);}}function u1(i){var w1={};if(i.fCLLevel===1||i.fCLLevel===2){w1.oActionButtonHandlers=f1(i);}if(i.level===0){w1.handleDataReceived=(r1&&r1())?s1:Function.prototype;w1.isListAndFirstEntryLoadedOnStartup=r1;}w1.isNextObjectLoadedAfterDelete=q1;return w1;}function v1(w1,x1){var y1={};if(x1){switch(s){case'TwoColumnsMidExpanded':w1=1;break;case'ThreeColumnsEndExpanded':w1=2;break;default:w1=w1;break;}for(var i=0;i<=w1;i++){y1.aggregation=g(i);T.oNavigationHost.hidePlaceholder(y1);}return;}y1.aggregation=g(w1);T.oNavigationHost.hidePlaceholder(y1);}o.attachStateChange(O.bind(null,false));return{hidePlaceholder:v1,adaptRoutingInfo:A,createMessagePageTargets:a,displayMessagePage:i1,handleBeforeRouteMatched:Q,handleRouteMatched:R,areIdentitiesLayoutEquivalent:d1,getAppStatesPromiseForNavigation:_,getSpecialDraftCancelPromise:a1,getFCLAppStatesPromise:c1,adaptBreadCrumbUrlParameters:j1,adaptPreferredLayout:k1,isAppTitlePrefered:h1,hasIdentityFullscreenLayout:m1,hasNavigationMenuSelfLink:n1,getMaxColumnCountInFCL:o1,isNextObjectLoadedAfterDelete:q1,getFclProxy:u1,isListAndFirstEntryLoadedOnStartup:r1,setStoredTargetLayoutToFullscreen:t1,adaptAppStatesForExternalNavigation:l1};}return B.extend("sap.suite.ui.generic.template.lib.FlexibleColumnLayoutHandler",{constructor:function(o,N){e(this,n(o,N));}});});
