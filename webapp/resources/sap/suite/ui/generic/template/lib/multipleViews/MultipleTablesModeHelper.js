sap.ui.define(["sap/ui/base/Object","sap/ui/Device","sap/ui/model/Filter","sap/suite/ui/generic/template/genericUtilities/testableHelper","sap/base/util/extend","sap/suite/ui/generic/template/js/StableIdHelper"],function(B,D,F,t,e,S){"use strict";function h(f,H){if(Array.isArray(f)){var o=true;var a;for(var i=0;i<f.length;i++){var b=h(f[i],H);if(o){if(b===f[i]){continue;}o=false;a=f.slice(0,i);}if(b){a.push(b);}}return o?f:a;}if(f.aFilters){var n=h(f.aFilters,H);if(n===f.aFilters){return f;}if(n.length===0){return null;}if(n.length===1){return n[0];}return new F({filters:n,and:f.bAnd});}return H(f);}function g(c,T,C){var s;var o=T.oComponentUtils.getTemplatePrivateModel();var p=C.pathInTemplatePrivateModel+'/implementingHelper';var I=p+"/ignoredFilters";o.setProperty(p,{ignoredFilters:[]});function G(){var i;for(var j in s){var V=s[j];var J=V.presentationControlHandler.getEntitySet();if(i&&i!==J){return true;}i=J;}return false;}function f(i,V,j,J){if(j&&J){r(i,j);}var K=C.smartFilterBar;if(!K){return i;}var L=K.getFilters();if(L.length<1){if(!J){o.setProperty(I,[]);V.implementingHelperAttributes.ignoredLabels=[];}return i;}var M=!J&&Object.create(null);L=b(V,L,M);return L.concat(i);}function a(P){var i,j;if(P.indexOf("/")!==-1){i=P.split("/");j=i.pop();}else{j=P;}return j;}function b(V,i,j){var P=V.presentationControlHandler;var M=c.getOwnerComponent().getModel().getMetaModel();var J=T.oCommonUtils.getMetaModelEntityType(P.getEntitySet());var N=J.navigationProperty;var K=function(W){var X=W.sPath;var Y=false;var Z=a(X);var $=d(X,M,J,N,V);$.some(function(_){var a1;if(_.name===Z){a1=_["com.sap.vocabularies.UI.v1.Hidden"];Y=a1?a1.Bool!=="true":true;return Y;}return false;});if(Y){return W;}if(j){j[X]=true;}return null;};var L=h(i,K);if(j){var Q=Object.keys(j);var U=Q.map(function(W){var X=n(W,P);return X["sap:label"]||(X["com.sap.vocabularies.Common.v1.Label"]?X["com.sap.vocabularies.Common.v1.Label"].String:X.name);});o.setProperty(I,U);V.implementingHelperAttributes.ignoredLabels=U;}return L;}function d(P,M,J,N,V){var K,L,Q,U,W;if(P.indexOf("/")!==-1){K=P.split("/");for(var i=0;i<K.length-1;i++){L=K[i];for(var j in N){if(N[j].name===L){Q=true;break;}}if(!Q){return[];}U=M.getODataAssociationEnd(J,L);J=U&&M.getODataEntityType(U.type);N=J&&J.navigationProperty;}W=J&&J.property;}else{W=V.implementingHelperAttributes.entityTypeProperty;}return W;}function r(J,K){for(var i in K){var L=K[i];for(var j=J.length;j--;j>=0){if(JSON.stringify(J[j])===JSON.stringify(L)){J.splice(j,1);break;}}}}function k(V){return{entityTypeProperty:T.oCommonUtils.getMetaModelEntityType(V.presentationControlHandler.getEntitySet()).property,dirtyState:0,activeObjectEnabled:false,controlStateWrapper:T.oCommonUtils.getControlStateWrapper(c.byId(S.getStableId({type:"ListReportTable",subType:"SmartTable",sQuickVariantKey:V.switchingKey}))),searchFieldWrapper:T.oCommonUtils.getControlStateWrapper(c.byId(S.getStableId({type:"ListReportAction",subType:"SearchField",sQuickVariantKey:V.switchingKey})))};}function l(i,R,j){s=i;for(var K in s){var V=s[K];V.implementingHelperAttributes=k(V);V.implementingHelperAttributes.controlStateWrapper.attachStateChanged(C.appStateChange);V.implementingHelperAttributes.searchFieldWrapper.attachStateChanged(C.appStateChange);}if(C.smartFilterBar){C.smartFilterBar.attachSearch(function(L){R(3);});}if(C.pathToActiveObjectEnabled){var J=o.bindProperty(C.pathToActiveObjectEnabled);J.attachChange(function(L){var M=j();M.implementingHelperAttributes.activeObjectEnabled=o.getProperty(C.pathToActiveObjectEnabled);});}}function m(i,j){if(!j){return"";}var J="";var K=s[j].text;if(i&&i.length>0){if((D.system.tablet||D.system.phone)&&!D.system.desktop){if(i.length>1){J=T.oCommonUtils.getText("MESSAGE_MULTIPLE_VALUES_S_FORM",[i.join(", "),K]);}else{J=T.oCommonUtils.getText("MESSAGE_SINGLE_VALUE_S_FORM",[i[0],K]);}}else if(i.length>1){J=T.oCommonUtils.getText("MESSAGE_MULTIPLE_VALUES_L_FORM",[i.join(", "),K]);}else{J=T.oCommonUtils.getText("MESSAGE_SINGLE_VALUE_L_FORM",[i[0],K]);}}return J;}function n(P,i){var U;var j=u(i);for(var K in j){U=q(j[K],P);if(U){break;}}return U;}function q(i,P){return i.filter(function(j){return j.name===P;})[0];}function u(i){var P=[];for(var K in s){var V=s[K];if(V.presentationControlHandler!==i){P.push(V.implementingHelperAttributes.entityTypeProperty);}}return P;}function O(N){var V=s[N];var i=V.implementingHelperAttributes.ignoredLabels||[];o.setProperty(I,i);if(C.pathToActiveObjectEnabled){o.setProperty(C.pathToActiveObjectEnabled,V.implementingHelperAttributes.activeObjectEnabled);}C.adaptPresentationControl();}function v(i){var j,V;if(i.controlStates){for(var K in s){s[K].implementingHelperAttributes.controlStateWrapper.setState(i.controlStates[s[K].presentationControlHandler.getId()]);s[K].implementingHelperAttributes.searchFieldWrapper.setState(i.controlStates[s[K].implementingHelperAttributes.searchFieldWrapper.getLocalId()]);}}else{for(var K in s){j=s[K].presentationControlHandler;V=i.tableVariantIds[j.getId()];if(V){j.setCurrentVariantId(V);}}}if(C.pathToActiveObjectEnabled&&i.mEditButtonState){for(var J in s){s[J].implementingHelperAttributes.activeObjectEnabled=!!i.mEditButtonState[J];}}O(i.selectedTab);return i.selectedTab;}function w(i){var K,j,J=Object.create(null);for(K in s){j=s[K].presentationControlHandler;J[j.getId()]=s[K].implementingHelperAttributes.controlStateWrapper.getState();if(s[K].implementingHelperAttributes.searchFieldWrapper.getLocalId()){J[s[K].implementingHelperAttributes.searchFieldWrapper.getLocalId()]=s[K].implementingHelperAttributes.searchFieldWrapper.getState();}}var L={selectedTab:i,controlStates:J};if(C.pathToActiveObjectEnabled){var M=Object.create(null);for(var N in s){M[N]=s[N].implementingHelperAttributes.activeObjectEnabled;}L.mEditButtonState=M;}return L;}function R(i,j,J,K,L,M,N){var P=function(Q){if(Q===K&&M){N(i);return;}var V=s[Q];if(V.implementingHelperAttributes.dirtyState>0&&V.implementingHelperAttributes.dirtyState!==i){V.implementingHelperAttributes.dirtyState=3;}else{V.implementingHelperAttributes.dirtyState=i;}};if(j){if(L){j.forEach(P);return;}P(j);return;}for(var Q in s){if(!J||J[s[Q].presentationControlHandler.getEntitySet()]){P(Q);}}}function x(){return"multi";}function y(N){var V=s[N];var M=V.implementingHelperAttributes.dirtyState;V.implementingHelperAttributes.dirtyState=0;return M;}function z(V){var P=V.presentationControlHandler;var i=P.getActiveButtonTableStateCustomData();var j=JSON.parse(i.getValue());P.setActiveButtonTableStateCustomData(!j);T.oComponentUtils.getTemplatePrivateModel().setProperty("/listReport/activeObjectEnabled",!j);}function A(V){var i=T.oComponentUtils.getTemplatePrivateModel().getProperty("/listReport/activeObjectEnabled");V.presentationControlHandler.setActiveButtonTableStateCustomData(i);}function E(i,j){for(var K in s){var J=s[K].presentationControlHandler;J.setCurrentTableVariantId(j);J.setCurrentChartVariantId(i);}}function H(P){var i=P.getEntitySet();for(var K in s){var V=s[K];var j=V.presentationControlHandler;if(j!==P&&j.getEntitySet()===i&&V.implementingHelperAttributes.dirtyState<2){V.implementingHelperAttributes.dirtyState+=2;}}}var b=t.testable(b,"fnCleanupIrrelevantFilters");return{init:l,getDefaultShowCounts:G,getFiltersAdaptedFromItem:f,formatMessageStrip:m,onSelectedKeyChanged:O,getContentForIappState:w,getSelectedKeyAndRestoreFromIappState:v,refreshOperation:R,getMode:x,getRefreshMode:y,setActiveButtonState:z,restoreActiveButtonState:A,setControlVariant:E,refreshSiblingControls:H};}return B.extend("sap.suite.ui.generic.template.lib.multipleViews.MultipleTablesModeHelper",{constructor:function(c,T,C){e(this,g(c,T,C));}});});
