sap.ui.define(["sap/ui/base/Object","sap/ui/model/base/ManagedObjectModel","sap/suite/ui/generic/template/genericUtilities/controlHelper","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/suite/ui/generic/template/lib/CRUDActionHandler","sap/suite/ui/generic/template/lib/StatePreserver","sap/base/util/extend","sap/base/util/isEmptyObject","sap/suite/ui/generic/template/genericUtilities/FeError"],function(B,M,c,F,C,S,e,a,b){"use strict";var s="lib.ComponentUtils";var l=new F(s).getLogger();var d={isPreliminary:function(){return false;}};function g(o,f){var t=f.oTemplateContract.mRoutingTree[f.route];var h;var H;var j;var k;var m;var I=false;var L;var n=[];var N=false;var E=[];function p(){return o.getModel("_templPriv");}function q(i){f.oTemplateContract.oNavigationControllerProxy.preloadComponent(i);}function r(){var i=o.getAppComponent();return i.getModel("_templPrivGlobal");}function u(){return t.level;}function v(){var i=f.oTemplateContract.oApplicationProxy.getAncestralNode(t,1);if(i){var U1={};var V1=i.getPath(2,t1());U1.bindingContext=o.getModel().createBindingContext(V1)||o.getModel().getContext(V1);U1.entitySet=i.entitySet;U1.view=i.componentId&&f.oTemplateContract.componentRegistry[i.componentId].oController.getView();U1.componentId=i.componentId;return U1;}return null;}function w(){var i=f.oTemplateContract.oApplicationProxy.getAncestralNode(t,1);if(!i.componentId){q(i.sRouteName);}return i.componentCreated.then(function(o){var U1=f.oTemplateContract.componentRegistry[o.getId()];return U1.viewRegistered.then(function(){return{getText:U1.oControllerUtils.oCommonUtils.getText,getRootExpand:U1.oControllerUtils.oComponentUtils.getRootExpand};});});}function x(){return f.preprocessorsData;}function y(U1){var V1=f.oTemplateContract.oNavigationControllerProxy.getCurrentIdentity();var W1=V1.keys;var X1=[];for(var i=0;i<U1;i++){X1[i]="";}var Y1=f.oTemplateContract.oApplicationProxy.fillSiblingKeyPromise(V1.treeNode,W1,X1,"Changes");return Y1.then(function(Z1){return{keys:X1,treeNode:Z1};});}function z(){var i=x();if(i&&i.rootContextExpand){return i.rootContextExpand.join(',');}}function A(){return f.oParameterModel;}function D(i,U1,V1){if(typeof V1!=="function"){throw new b(s,"Event handler must be a function");}E.push({template:i,event:U1,handler:V1});}function G(U1,V1,W1){for(var i=E.length;i--;){if(E[i].handler===W1&&E[i].event===V1&&E[i].template===U1){E.splice(i,1);}}}function J(U1,V1,W1){for(var i=0;i<E.length;i++){if(E[i].event===V1&&E[i].template===U1){E[i].handler(W1);}}}function K(i){return i.getMetadata().getName();}function O(){return f.oApplication.isComponentActive(o);}function P(){return f.oNavigationObserver.getProcessFinished(true);}function Q(i,U1){var V1=P();V1.then(function(){if(O()){if(U1){d1(true,false);}J(K(f.oController),"PageDataLoaded",{context:i});if(i&&z1()){var W1=i.getObject();if(!W1.IsActiveEntity){f.oApplication.getDraftSiblingPromise(i);}}}});}function R(){h.then(function(i){if(i){Q(i);}});}function T(){f.oHeaderLoadingObserver.startProcess();if(!m){var i=new Promise(function(U1){m=U1;});f.oApplication.getBusyHelper().setBusy(i,undefined,undefined,true);}}function U(){if(!H){h=new Promise(function(i){H=i;});}}if(t.getPath(3)){U();}else{h=Promise.resolve();}function V(i){l.info("Request header data",i.getSource().getPath(),"Class sap.suite.ui.generic.template.lib.ComponentUtils");I=true;U();if(!o.getComponentContainer().getElementBinding().isSuspended()){T();}}function W(){if(m){m();m=null;}f.oHeaderLoadingObserver.stopProcess();}function X(i){var U1=i.getSource().getBoundContext();if(U1){return U1;}if(o.getComponentContainer().getElementBinding().isSuspended()){U1=null;}else{U1=d;}b1();return U1;}function Y(){f.oTemplateContract.oNavigationControllerProxy.navigationContextNotFound();}function Z(){I=false;if(!k){return;}if(k===d){Y();b1();}else if(!o.getComponentContainer().getElementBinding().isSuspended()){var i=o.getBindingContext();var U1=p1(i);var V1=U1.bIsDraft||N;var W1;if(V1){N=false;W1=U1.bIsCreate?4:2;}else{W1=1;}var X1=p();X1.setProperty("/objectPage/displayMode",W1);var Y1=o.getModel("ui");Y1.setProperty("/enabled",true);Y1.setProperty("/createMode",U1.bIsCreate);Y1.setProperty("/editable",V1);(f.methods.updateBindingContext||Function.prototype)(i);if(H){H(k);}}else{return;}H=null;k=null;}function $(i){l.info("Received header data",i.getSource().getPath(),"Class sap.suite.ui.generic.template.lib.ComponentUtils");j();W();if(I){k=X(i);}Z();}function _(i){j();var U1=X(i);if(U1&&U1.isPreliminary()){return;}k=U1;Z();f.oHeaderLoadingObserver.stopProcess();}function a1(i){f.oHeaderLoadingObserver.startProcess();var U1=new Promise(function(V1){j=V1;});U();if(f.methods.beforeRebind){f.methods.beforeRebind(U1);}k=null;t.bindElement(o.getComponentContainer(),i,false,{dataRequested:V,dataReceived:$,change:_});L=i;if(f.methods.afterRebind){f.methods.afterRebind();}}function b1(){U();var i=o.getComponentContainer();i.setBindingContext();t.unbindElement(i);L=null;k=null;I=false;W();}function c1(){var U1=t1();var V1=(U1.length===n.length);for(var i=0;i<U1.length&&V1;i++){V1=U1[i]===n[i];}n=U1;return!V1;}function d1(i,U1){f.reuseComponentsReady.then(function(V1){for(var W1 in V1){var X1=V1[W1];if(!U1||X1.isStarted()){X1.pathUnchangedCallBack(i);}}});}function e1(i,U1){var V1=Object.create(null);for(var W1 in i){var X1=i[W1];V1[W1]=U1(X1,W1);}return V1;}function f1(){var i=p();for(var U1 in t.embeddedComponents){var V1=!!t.embeddedComponents[U1].definition.hiddenByDefault;i.setProperty("/generic/embeddedComponents/"+U1+"/hidden",V1);}}function g1(i,U1){var V1=c1();if(V1&&!U1){f1();}if(!i){if(f.routingSpec&&f.routingSpec.noOData){Q(null,V1);}return;}var W1=o.getComponentContainer();if(!W1){return;}var X1=o.getModel("ui");var Y1=!!f.nonDraftCreateContext;if(Y1){var Z1=W1.getBindingContext();if(Z1===f.nonDraftCreateContext){return;}X1.setProperty("/enabled",true);X1.setProperty("/editable",true);X1.setProperty("/createMode",true);b1();if(H){H(f.nonDraftCreateContext);H=null;}else{h=Promise.resolve(f.nonDraftCreateContext);}R();if(f.methods.beforeRebind){f.methods.beforeRebind(h);}W1.setBindingContext(f.nonDraftCreateContext);Promise.all([f.oViewRenderedPromise,f.viewRegistered]).then(d1.bind(null,true,false));if(f.methods.afterRebind){f.methods.afterRebind();}}else{var $1=W1.getElementBinding();if($1){if(L===i){if($1.isSuspended()){$1.resume();Z();}if(I){T();}f.oApplication.getBusyHelper().getUnbusy().then(d1.bind(null,V1,false));if(!U1){R();}if(!U1&&!z1()){X1.setProperty("/editable",false);}X1.setProperty("/enabled",true);return;}else if(!U1){b1();}}X1.setProperty("/enabled",false);X1.setProperty("/editable",false);X1.setProperty("/createMode",false);a1(i);R();}}function h1(i,U1){var V1={};if(i){V1.discardPromise=i;}var W1=o.getModel();if(W1.hasPendingChanges()){var X1=f.oController.getView();X1.setBindingContext(null);W1.resetChanges();X1.setBindingContext();}var Y1=o.getModel("ui");if(U1||Y1.getProperty("/editable")){delete f.nonDraftCreateContext;if(!i){delete f.nonDraftCreateContext;Y1.setProperty("/editable",false);var Z1=p();Z1.setProperty("/objectPage/displayMode",1);}J(K(f.oController),"AfterCancel",V1);}}function i1(i,U1){return z1()?null:f.oTemplateContract.oNavigationControllerProxy.navigateForNonDraftCreate(i,U1);}function j1(i,U1){N=U1;f.oTemplateContract.oNavigationControllerProxy.adaptUrlAfterNonDraftCreateSaved(i);}function k1(i){var U1=o.getComponentContainer().getElementBinding();if(U1){o.getModel().invalidateEntry(U1.getBoundContext());if(U1.isSuspended()){b1();}else{U1.refresh(!i);f.bWithoutAssociationsRefresh=false;}}}function l1(i){i=i||o.getIsRefreshRequired();if(i||!a(f.mRefreshInfos)||f.bWithoutAssociationsRefresh){(f.methods.refreshBinding||Function.prototype)(i,f.mRefreshInfos,f.bWithoutAssociationsRefresh);o.setIsRefreshRequired(false);f.mRefreshInfos=Object.create(null);}d1(i,true);}function m1(){var i=o.getModel();var U1={canonicalRequest:!f.oTemplateContract.bCreateRequestsCanonical,batchGroupId:"facets",updateAggregatedMessages:true};i.read(L,U1);}function n1(i){if(z1()){var U1=o.getComponentContainer();var V1=U1.getElementBinding();if(V1&&!V1.isSuspended()){V1.suspend();i.catch(function(){V1.resume();});}}}function o1(){var i=o.getComponentContainer();if(f.nonDraftCreateContext){i.setBindingContext();delete f.nonDraftCreateContext;return;}var U1=i.getElementBinding();if(U1&&!U1.isSuspended()){if(f.oTemplateContract.oValidationMessageBinding.getLength()){b1();}else{U1.suspend();}W();}}function p1(i){var U1=u();return f.oApplication.registerContext(i,U1,o.getEntitySet(),t1());}function q1(i){if(i.level<2){return[i.entitySet];}var U1=f.oTemplateContract.mRoutingTree[i.parentRoute];var V1=q1(U1);if(i!==t){V1.push(i.navigationProperty?V1[U1.level-1]+"/"+i.navigationProperty:i.entitySet);}return V1;}function r1(){return t.level<2?[]:q1(t);}function s1(i,U1,V1){var W1;for(W1=t;W1.level>V1;){W1=f.oTemplateContract.mRoutingTree[W1.parentRoute];}var X1=new M(i);X1.bindProperty("/"+U1).attachChange(function(Y1){var Z1=Y1.getSource().getValue();f.oTemplateContract.oNavigationControllerProxy.setTextForTreeNode(W1,Z1);});W1.contextTargets=W1.contextTargets||[];W1.contextTargets.push(i);}function t1(){return f.oApplication.getCurrentKeys(u());}function u1(i){return f.oApplication.getCommunicationObject(o,i);}function v1(i,U1,V1,W1,X1){f.oTemplateContract.oNavigationControllerProxy.navigateToChild(t,i,V1,U1,W1,X1);}function w1(i,U1,V1){f.oTemplateContract.oNavigationControllerProxy.navigateFromNodeAccordingToContext(t,i,U1,V1);}function x1(){return t.headerTitle;}function y1(i){f.oTemplateContract.oNavigationControllerProxy.setTextForTreeNode(t,i);}function z1(){return t.isDraft;}function A1(){return!(f.routingSpec&&f.routingSpec.noOData);}function B1(){return!f.oTemplateContract.bCreateRequestsCanonical;}function C1(){return h;}function D1(){return f.oTemplateContract.oPaginatorInfo[u()-1];}function E1(i,U1){var V1=u();if(!U1){V1--;}f.oTemplateContract.oPaginatorInfo[V1]=i;}function F1(i,U1){f.reuseComponentsReady.then(function(V1){var W1=U1.getComponentInstance();for(var X1 in V1){if(W1===V1[X1].component){var Y1=p();Y1.setProperty("/generic/embeddedComponents/"+X1+"/isInVisibleArea",i);return;}}});}function G1(){return f.oStatePreserverPromise.then(function(i){return i.stateChanged();});}f.oStatePreserverPromise=f.reuseComponentsReady.then(function(i){var U1=f.methods.getStatePreserverSettings&&f.methods.getStatePreserverSettings();if(!U1){return{getUrlParameterInfo:function(){return Promise.resolve({});},applyAppState:Function.prototype,stateChanged:Function.prototype};}var V1="sap-iapp-state"+(t.level===0?"":"-"+t.entitySet);var W1=e({appStateName:encodeURI(V1),getCurrentState:function(){var Y1=f.methods.getCurrentState?f.methods.getCurrentState():Object.create(null);var Z1=function($1,_1){if($1.component.stGetCurrentState){var a2=$1.component.stGetCurrentState();for(var b2 in a2){Y1["$embeddedComponent$"+_1.length+"$"+_1+"$"+b2]=a2[b2];}}};e1(i,Z1);return Y1;},applyState:function(Y1,Z1){var $1=Object.create(null);var _1=Object.create(null);for(var a2 in Y1){if(a2.indexOf("$embeddedComponent$")===0){var b2=a2.substring(19);var c2=b2.indexOf("$");var d2=Number(b2.substring(0,c2));var e2=b2.substring(c2+1,c2+d2+1);var f2=_1[e2];if(!f2){f2=Object.create(null);_1[e2]=f2;}var g2=b2.substring(c2+d2+2);f2[g2]=Y1[a2];}else{$1[a2]=Y1[a2];}}(f.methods.applyState||Function.prototype)($1,Z1);var h2=function(i2,j2){if(i2.component.stApplyState){i2.component.stApplyState(_1[j2]||Object.create(null),Z1);}};Promise.all([f.oViewRenderedPromise,h]).then(e1.bind(null,i,h2));},oComponent:o},U1);var X1=new S(f.oTemplateContract,W1);f.oApplication.registerStateChanger(X1.getAsStateChanger());return X1;});f.oTemplateContract.oStatePreserversAvailablePromise=Promise.all([f.oTemplateContract.oStatePreserversAvailablePromise,f.oStatePreserverPromise]);function H1(){var i=f.oTemplateContract.oFlexibleColumnLayoutHandler;return i?i.getFclProxy(t):{handleDataReceived:t.level?null:Function.prototype,isListAndFirstEntryLoadedOnStartup:t.level?null:Function.prototype,isNextObjectLoadedAfterDelete:Function.prototype};}function I1(){return t.page.component.settings||{};}function J1(){var i=o.getAppComponent().getManifestEntry("sap.ui5");var U1=i.extends&&i.extends.extensions&&i.extends.extensions["sap.ui.controllerExtensions"];U1=U1&&U1[o.getTemplateName()];U1=U1&&U1["sap.ui.generic.app"];return U1&&U1[o.getEntitySet()];}function K1(){var i=o.getAppComponent().getManifestEntry("sap.ui5");var U1=i.extends&&i.extends.extensions&&i.extends.extensions["sap.ui.viewExtensions"];return U1&&U1[o.getTemplateName()];}function L1(i){f.aUnsavedDataCheckFunctions=f.aUnsavedDataCheckFunctions||[];f.aUnsavedDataCheckFunctions.push(i);}function M1(){if(f.methods.adaptToChildContext){var i=p().getProperty("/generic/currentActiveChildContext");f.methods.adaptToChildContext(i);}}var N1;function O1(){N1=N1||new C(f.oTemplateContract,f.oController,f.oControllerUtils.oCommonUtils);return N1;}function P1(i){if(f.methods.executeAfterInvokeActionFromExtensionAPI){f.methods.executeAfterInvokeActionFromExtensionAPI(i,f.oControllerUtils.oCommonUtils);}}function Q1(i){if(f.methods.executeBeforeInvokeActionFromExtensionAPI){f.methods.executeBeforeInvokeActionFromExtensionAPI(i,f.oControllerUtils.oCommonUtils);}}function R1(){var i=f.oController.getView();var U1=i.getModel();if(U1.hasPendingChanges(true)){return true;}if(f.aUnsavedDataCheckFunctions){return f.aUnsavedDataCheckFunctions.some(function(V1){return V1();});}return false;}function S1(i){if(f.reactivate&&!i){return;}var U1=f.oController.onLeaveAppExtension&&f.oController.onLeaveAppExtension.apply(f.oController,[i]);f.reactivate=f.reuseComponentsReady.then(function(V1){var W1=Object.create(null);e1(V1,function(X1,Y1){var Z1=X1.leaveApp(i);if(Z1&&!i){W1[Y1]=Z1;}});return!i&&function(){if(U1){U1();}for(var X1 in W1){W1[X1]();}};});}function T1(){if(f.oTemplateContract.oFlexibleColumnLayoutHandler){f.oTemplateContract.oFlexibleColumnLayoutHandler.hidePlaceholder(t.fCLLevel);}else{f.oTemplateContract.oNavigationHost.hidePlaceholder();}}return{getBusyHelper:function(){return f.oApplication.getBusyHelper();},attach:function(i,U1,V1){D(K(i),U1,V1);},detach:function(i,U1,V1){G(K(i),U1,V1);},fire:function(i,U1,V1){J(K(i),U1,V1);},getPreprocessorsData:x,getRootExpand:z,getParameterModelForTemplating:A,bindComponent:g1,cancelEdit:h1,getNonDraftCreatePromise:i1,adaptUrlAfterNonDraftCreateSaved:j1,refreshBinding:l1,refreshBindingUnconditional:k1,suspendBinding:o1,messagesRefresh:m1,getTemplatePrivateModel:p,getTemplatePrivateGlobalModel:r,registerContext:p1,getViewLevel:u,getMainComponentDetails:v,getMainComponentUtils:w,getBreadCrumbInfo:r1,registerAncestorTitleUpdater:s1,getCurrentKeys:t1,getCommunicationObject:u1,navigateRoute:v1,navigateAccordingToContext:w1,getTitle:x1,setText:y1,onBeforeDraftTransfer:n1,isDraftEnabled:z1,isODataBased:A1,getNoStateMessagesForTables:B1,isComponentActive:O,navigateToDataLoadedFailedPage:Y,getHeaderDataAvailablePromise:C1,getPaginatorInfo:D1,setPaginatorInfo:E1,onVisibilityChangeOfReuseComponent:F1,getNavigationFinishedPromise:P,stateChanged:G1,unbind:b1,getFclProxy:H1,getSettings:I1,getControllerExtensions:J1,getViewExtensions:K1,registerUnsavedDataCheckFunction:L1,layoutChanged:M1,getCRUDActionHandler:O1,executeAfterInvokeActionFromExtensionAPI:P1,executeBeforeInvokeActionFromExtensionAPI:Q1,preloadComponent:q,isComponentDirty:R1,getTargetKeyFromLevel:y,leaveApp:S1,hidePlaceholder:T1};}return B.extend("sap.suite.ui.generic.template.lib.ComponentUtils",{constructor:function(o,f){e(this,g(o,f));}});});
