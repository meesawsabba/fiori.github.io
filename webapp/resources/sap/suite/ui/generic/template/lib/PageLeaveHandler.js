sap.ui.define(["sap/ui/base/Object","sap/base/util/extend","sap/suite/ui/generic/template/lib/CRUDHelper","sap/m/MessageBox"],function(B,e,C,M){"use strict";function g(t){var o;var O;function d(b,c,m){o=b;O=c;var w=t.getText("ST_KEEP_DRAFT_MESSAGE");var k=t.getText("ST_KEEP_DRAFT_BTN");var s=t.getText("ST_DISCARD_DRAFT_BTN");var f=t.getText("CANCEL");M.warning(w,{title:t.getText("ST_UNSAVED_CHANGES_TITLE"),actions:[k,s,f],emphasizedAction:k,onClose:function(A){if(A===k){o();}else if(A===s){var h=D(m).then(o);h.catch(O);}else if(A===f){O();}}});}function D(m){var T=t.oAppComponent.getTransactionController();var b=T.getDraftController();var A=t.oApplicationProxy;var c=A.getContextForPath(a());var f=t.oNavigationControllerProxy.getCurrentIdentity();var h=(m==="LeaveApp"&&t.oNavigationControllerProxy.getSpecialDraftCancelOptionPromise(c))||Promise.resolve();var j=h.then(function(k){return C.discardDraft(b,T,A,c).then(function(){t.oNavigationControllerProxy.setBackNavigationOption(k);t.oViewDependencyHelper.setRootPageToDirty();t.oViewDependencyHelper.unbindChildrenUsingTreeNode(f.treeNode);A.invalidatePaginatorInfo();});});t.oBusyHelper.setBusy(j);return j;}function p(f,n,m,I){var E=t.oNavigationControllerProxy.isDiscardDraftConfirmationNeeded();var N=((E==="always"&&m.startsWith("Leave"))||(E==="restricted"&&m==="LeavePage"))&&i();if(N){d(f,n,m);}else{f();}}function i(){return t.oApplicationProxy.checkIfObjectIsADraftInstance(a());}function a(){var c=t.oNavigationControllerProxy.getCurrentIdentity();var A=t.oApplicationProxy.getAncestralNode(c.treeNode,1);var s=A.getPath(3,c.keys);return s;}function P(f,c,m,n,I){var r=new Promise(function(R,b){var h=function(){var r=f();R(r);};var N=function(){c();b();};if(n){p(h,N,m,I);}else{t.oApplicationProxy.performAfterSideEffectExecution(p.bind(null,h,N,m,I),true);}});return r;}return{discardDraft:D,performAfterDiscardOrKeepDraft:P};}return B.extend("sap.suite.ui.generic.template.lib.PageLeaveHandler",{constructor:function(t){e(this,g(t));}});});
