sap.ui.define(["sap/ui/base/Object","sap/ui/Device","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/m/ActionSheet","sap/m/Dialog","sap/m/Popover","sap/suite/ui/generic/template/lib/deletionHelper","sap/suite/ui/generic/template/lib/navigation/routingHelper","sap/suite/ui/generic/template/lib/ContextBookkeeping","sap/suite/ui/generic/template/lib/CRUDHelper","sap/suite/ui/generic/template/genericUtilities/testableHelper","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/suite/ui/generic/template/genericUtilities/oDataModelHelper","sap/ui/core/syncStyleClass","sap/base/util/extend","sap/ui/core/Fragment","sap/ui/generic/app/navigation/service/NavigationHandler","sap/suite/ui/generic/template/lib/KeepAliveHelper","sap/ui/core/Fragment"],function(B,D,J,M,A,a,P,d,r,C,b,t,F,o,s,e,c,N,K){"use strict";var G={storeInnerAppStateWithImmediateReturn:function(){return{promise:{fail:Function.prototype}};},parseNavigation:function(){return{done:function(H){setTimeout(H.bind(null,{},{},sap.ui.generic.app.navigation.service.NavType.initial),0);},fail:Function.prototype};}};var l=new F("lib.Application").getLogger();var f=(t.testableStatic(function(T,i){var k="sapUiSizeCozy",m="sapUiSizeCompact";if(i&&(i.classList.contains(k)||i.classList.contains(m))){return"";}else{return T?k:m;}},"Application_determineContentDensityClass")(D.support.touch,document.body));function g(){return f;}function h(i,p){s(f,p,i);p.addDependent(i);}var h=t.testableStatic(h,"Application_attachControlToParent");function j(T){var k=new C(T);var E;var n=Object.create(null);var m=new K(T);function p(i){var A1=T.oNavigationControllerProxy.getActiveComponents();return A1.indexOf(i.getId())>=0;}var I=false;function q(i){T.fnAddSideEffectPromise(i);}function u(i,A1){if(I){return;}var B1=T.aRunningSideEffectExecutions.filter(function(C1){return!!C1;});if(B1.length){I=true;Promise.all(B1).then(function(){I=false;u(i,A1);});}else if(A1&&T.oBusyHelper.isBusy()){if(typeof A1==="function"){A1();}}else{i();}}function v(i){var A1;if(i instanceof a){A1="open";}else if(i instanceof P||i instanceof A){A1="openBy";}if(A1){var B1=i[A1];i[A1]=function(){var C1=arguments;u(function(){if(!T.oBusyHelper.isBusy()){T.oBusyHelper.getUnbusy().then(function(){B1.apply(i,C1);});}});};}}var w={};function x(i,A1,B1,C1,D1){i=i||T.oNavigationHost;var E1=i.getId();var F1=w[E1]||(w[E1]={});var G1=F1[A1];if(!G1){G1=sap.ui.xmlfragment(E1,A1,B1);h(G1,i);var H1;if(C1){H1=new J();G1.setModel(H1,C1);}(D1||Function.prototype)(G1,H1);F1[A1]=G1;v(G1);}return G1;}function y(i,A1,B1,C1,D1,E1){return new Promise(function(F1){i=i||T.oNavigationHost;var G1=i.getId();var H1=w[G1]||(w[G1]={});var I1=H1[A1];if(!I1||E1){if(I1){I1.destroy();}c.load({id:G1,name:A1,controller:B1,type:"XML"}).then(function(J1){I1=J1;h(J1,i);var K1;if(C1){K1=new J();J1.setModel(K1,C1);}(D1||Function.prototype)(J1,K1);H1[A1]=J1;v(J1);F1(I1);});return;}F1(I1);});}function z(){return new Promise(function(i){T.oNavigationObserver.getProcessFinished(true).then(function(){T.oBusyHelper.getUnbusy().then(i);});});}function O(){if(T.oNavigationControllerProxy.isBackLeavingTheEditScope()){var i=T.oNavigationControllerProxy.getCurrentIdentity();var A1=i.treeNode.isDraft?T.oPageLeaveHandler.performAfterDiscardOrKeepDraft:T.oDataLossHandler.performIfNoDataLoss;A1(T.oNavigationControllerProxy.navigateBack,Function.prototype,"LeavePage");}else{u(T.oNavigationControllerProxy.navigateBack,true);}}function H(i,A1,B1){var C1=b.createNonDraft(null,"/"+i,T.oAppComponent.getModel(),A1,u1());if(B1){B1.aCreateContexts=B1.aCreateContexts||[];B1.aCreateContexts.push({entitySet:i,context:C1,predefinedValues:A1});}return C1;}function L(i){T.oNavigationControllerProxy.navigateForNonDraftCreate(i.entitySet,i.predefinedValues,i.context);}function Q(A1){var B1=T.oNavigationControllerProxy.getActiveComponents();for(var i=0;i<B1.length;i++){var C1=T.componentRegistry[B1[i]];C1.utils.onBeforeDraftTransfer(A1);}}function R(i,A1){Q(A1);k.activationStarted(i,A1);}function S(i,A1,B1){Q(A1);k.cancellationStarted(i,A1,B1);}function U(i,A1){Q(A1);k.editingStarted(i,A1);}function V(i){return k.checkmPath2ContextData(i);}function W(i){T.aStateChangers.push(i);}function X(i,A1){A1.then(function(){k.adaptAfterObjectDeleted(i);},Function.prototype);}function Y(){return T.oNavigationControllerProxy.getLinksToUpperLayers();}function Z(){var A1=T.oNavigationControllerProxy.getActiveComponents();var B1=0;var C1;for(var i=0;i<A1.length;i++){var D1=T.componentRegistry[A1[i]];if(D1.viewLevel>0&&(B1===0||D1.viewLevel<B1)){B1=D1.viewLevel;C1=D1.oComponent;}}var E1=C1?Promise.resolve(C1):T.oNavigationControllerProxy.getRootComponentPromise();return E1.then(function(F1){return F1.getModel("i18n").getResourceBundle();});}function $(){return T.oNavigationControllerProxy.getAppTitle();}function _(i){return T.oNavigationControllerProxy.getCurrentKeys(i);}function a1(i,A1){var B1=i;for(;B1.level>A1;){B1=T.mRoutingTree[B1.parentRoute];}return B1;}var b1;function c1(A1,B1){var i=B1||0;if(i>0){return null;}var C1=A1.getId();var D1=T.componentRegistry[C1];var E1=T.mRoutingTree[D1.route];var F1=E1.communicationObject;for(;i<0&&F1;){E1=T.mRoutingTree[E1.parentRoute];if(E1.communicationObject!==F1){i++;F1=E1.communicationObject;}}if(i<0||F1){return F1;}b1=b1||{};return b1;}function d1(i){for(var A1 in T.mEntityTree){if(T.mEntityTree[A1].navigationProperty&&(T.mEntityTree[A1].level===i+1)){return T.mEntityTree[A1].navigationProperty;}}}function e1(){var i=T.oNavigationControllerProxy.getCurrentIdentity();for(var A1=i.treeNode;A1.level>0;A1=T.mRoutingTree[A1.parentRoute]){if(A1.level===1&&A1.isDraft){var B1=A1.getPath(3,i.keys);k.markDraftAsModified(B1);return;}}}function f1(){if(E!==undefined){return E;}var i,A1,B1,C1,D1,E1,F1=true;var G1=T.oAppComponent.getModel();var H1=G1.getMetaModel();var I1=G1.mContexts;for(B1 in I1){F1=false;D1=I1[B1].sPath;C1=D1&&D1.substring(1,D1.indexOf('('));E1=C1&&H1.getODataEntitySet(C1);if(E1){i=G1.getProperty(D1);A1=i&&G1.getETag(undefined,undefined,i)||null;if(A1){E=true;return E;}}}if(F1){return true;}E=false;return E;}function g1(A1){var i,B1,C1;var D1=T.oNavigationControllerProxy.getAllComponents();for(i=0;i<D1.length;i++){B1=D1[i];if(!A1||!A1[B1]){C1=T.componentRegistry[B1];C1.utils.refreshBinding(true);}}}function h1(i){if(T.oFlexibleColumnLayoutHandler){T.oFlexibleColumnLayoutHandler.setStoredTargetLayoutToFullscreen(i);}}function i1(){T.oPaginatorInfo={};}function j1(A1,B1){var C1=n[A1];if(!C1){C1=Object.create(null);n[A1]=C1;var D1=T.oAppComponent.getModel();var E1=D1.getMetaModel();var F1=E1.getODataEntitySet(A1);var G1=F1&&E1.getODataEntityType(F1.entityType);var H1=(G1&&G1.navigationProperty)||[];for(var i=0;i<H1.length;i++){var I1=H1[i];C1[I1.name]=I1;}}return C1[B1];}function k1(i,A1){var B1=T.oNavigationControllerProxy.getSwitchToSiblingPromise(i,2,A1);T.oBusyHelper.setBusy(B1.then(function(C1){C1();}));}function l1(i){var A1=T.oNavigationControllerProxy.getSpecialDraftCancelPromise(i);if(A1){return A1;}var B1=k.getDraftSiblingPromise(i);var C1=T.oNavigationControllerProxy.getCurrentIdentity();var D1=T.componentRegistry[C1.treeNode.componentId];var E1=D1&&D1.utils.getTargetKeyFromLevel(2);return Promise.all([B1,E1]).then(function(F1){var G1=F1[0];var H1=G1&&G1.getObject();var I1=H1&&H1.IsActiveEntity;if(!I1){return Promise.resolve(d.getNavigateAfterDeletionOfCreateDraft(T));}return T.oNavigationControllerProxy.getSwitchToSiblingPromise(G1,1,F1[1]).then(function(J1){return function(){var K1=G1.getModel();K1.invalidateEntry(G1);return J1();};});});}function m1(i,A1){var B1=[];for(var C1=i;C1.level>=A1;C1=T.mRoutingTree[C1.parentRoute]){B1.push(C1);if(C1.level===0){break;}}return B1.reverse();}function n1(A1,B1,C1,D1){if(C1.length===0){C1.push("");}if(A1.level<C1.length){C1.splice(A1.level+1,C1.length-A1.level-1);return Promise.resolve(A1);}var E1=m1(A1,C1.length);var F1=E1.map(function(i){if(i.noKey||i.level===0){return Promise.resolve(true);}if(!i.isDraft){return Promise.resolve(B1[i.level]);}var G1=i.getPath(3,B1);var H1=k.getSiblingPromise(G1,D1);return H1.then(function(I1){var J1=I1&&o.analyseContext(I1);return J1&&J1.key;},Function.prototype);});return Promise.all(F1).then(function(G1){var H1=T.mRoutingTree[E1[0].parentRoute];G1.every(function(I1,i){if(I1){C1.push(I1===true?"":I1);H1=E1[i];}return I1;});return H1;});}function o1(i){return T.oNavigationControllerProxy.navigateAfterActivation(i);}function p1(i,A1,B1,C1){T.oNavigationControllerProxy.navigateToSubContext(i,A1,B1,C1);}function q1(i,A1,B1,C1){return T.oNavigationControllerProxy.navigateToDetailContextIfPossible(i,A1,B1,C1);}function r1(i,A1){T.oNavigationControllerProxy.navigateByExchangingQueryParam(i,A1);}function s1(){return!T.bCreateRequestsCanonical;}function t1(){return T.oNavigationControllerProxy.getParsedShellHashFromFLP();}function u1(){return!T.bCreateRequestsCanonical;}function v1(i){return k.checkIfObjectIsADraftInstance(i);}function w1(i){return k.getContextForPath(i);}function x1(){var i=T.oAppComponent.getStatePreservationMode();var A1=T.oAppComponent.getFlexibleColumnLayout()?true:false;if(i==="auto"){return A1?"persistence":"discovery";}return i;}var y1;function z1(){y1=y1||new N(T.oAppComponent);return T.ghostapp?G:y1;}T.oApplicationProxy={getDraftSiblingPromise:k.getDraftSiblingPromise,getSiblingPromise:k.getSiblingPromise,fillSiblingKeyPromise:n1,getAlternativeIdentityPromise:k.getAlternativeIdentityPromise,getPathOfLastShownDraftRoot:k.getPathOfLastShownDraftRoot,areTwoKnownPathesIdentical:k.areTwoKnownPathesIdentical,getIdentityKeyForContext:k.getIdentityKeyForContext,getAncestralNode:a1,getResourceBundleForEditPromise:Z,getContentDensityClass:g,getDialogFragment:x.bind(null,null),getDialogFragmentAsync:y.bind(null,null),destroyView:function(i){delete w[i];},markCurrentDraftAsModified:e1,prepareDeletion:X,performAfterSideEffectExecution:u,onBackButtonPressed:O,mustRequireRequestsCanonical:u1,cancellationStarted:S,checkIfObjectIsADraftInstance:v1,getContextForPath:w1,invalidatePaginatorInfo:i1};return{createNonDraft:H,navigateToNonDraftCreateContext:L,getContentDensityClass:g,attachControlToParent:h,getDialogFragmentForView:x,getDialogFragmentForViewAsync:y,getBusyHelper:function(){return T.oBusyHelper;},addSideEffectPromise:q,performAfterSideEffectExecution:u,isComponentActive:p,showMessageToast:function(){var i=arguments;var A1=function(){l.info("Show message toast");M.show.apply(M,i);};Promise.all([z(true),T.oBusyHelper.getUnbusy()]).then(A1);},registerStateChanger:W,getDraftSiblingPromise:k.getDraftSiblingPromise,registerContext:k.registerContext,activationStarted:R,cancellationStarted:S,editingStarted:U,checkContextData:V,getLinksToUpperLayers:Y,getAppTitle:$,getCurrentKeys:_,getCommunicationObject:c1,getForwardNavigationProperty:d1,markCurrentDraftAsModified:e1,checkEtags:f1,refreshAllComponents:g1,getIsDraftModified:k.getIsDraftModified,prepareDeletion:d.prepareDeletion.bind(null,T),setStoredTargetLayoutToFullscreen:h1,invalidatePaginatorInfo:i1,getNavigationProperty:j1,switchToDraft:k1,getNavigateAfterDraftCancelPromise:l1,navigateAfterActivation:o1,navigateToSubContext:p1,navigateToDetailContextIfPossible:q1,navigateByExchangingQueryParam:r1,onBackButtonPressed:O,needsToSuppressTechnicalStateMessages:s1,mustRequireRequestsCanonical:u1,getNavigationHandler:z1,getParsedShellHashFromFLP:t1,getStatePreservationMode:x1,getLeaveAppPromise:function(){return T.leaveAppPromise;},getComponentRefreshBehaviour:function(i){return m.getComponentRefreshBehaviour(i);},getChevronNavigationRefreshBehaviour:function(i){return m.getChevronNavigationRefreshBehaviour(i);}};}return B.extend("sap.suite.ui.generic.template.lib.Application",{constructor:function(T){e(this,j(T));}});});
