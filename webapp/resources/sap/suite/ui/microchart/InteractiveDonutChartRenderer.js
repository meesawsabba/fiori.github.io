/*!
 * SAPUI5
 * (c) Copyright 2009-2021 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/core/theming/Parameters","sap/ui/Device","sap/m/library","sap/base/Log"],function(P,D,M,L){"use strict";var I;var a={apiVersion:2};a.TOTAL_RADIUS_ABSOLUTE=3.625;a.OUTER_RADIUS_ABSOLUTE=3.25;a.SELECTION_THICKNESS_ABSOLUTE=0.375;a.HOLE_SIZE_RATIO_COMPACT=0.48;a.HOLE_SIZE_RATIO_COZY=0.48;a.SEGMENT_HALF_GAP_SIZE=0;a.SEGMENT_HALF_GAP_SIZE_HCB=0.5;a.GHOST_BORDER_HALF_THICKNESS_HCB=0.5;a.render=function(r,c){if(!c._bThemeApplied){return;}I=I||sap.ui.require("sap/suite/ui/microchart/InteractiveDonutChart");this._aSegments=c.getSegments();var s=c._iVisibleSegments;this._fSegmentHalfGapSize=this.SEGMENT_HALF_GAP_SIZE;this._fGhostHalfGapSize=0;if(this._isThemeHighContrast()){this._fSegmentHalfGapSize=this.SEGMENT_HALF_GAP_SIZE_HCB;this._fGhostHalfGapSize=this.GHOST_BORDER_HALF_THICKNESS_HCB;}if(c.getShowError()){r.openStart("div",c);r.class("sapSuiteUiMicroChartNoData");r.openEnd();r.renderControl(c._oIllustratedMessageControl);r.close("div");return;}r.openStart("div",c);r.class("sapSuiteIDC");if(!c._isChartEnabled()){var A=c.getTooltip_AsString();if(typeof A==="string"||A instanceof String){r.attr("title",A);}}var o={};o.role="listbox";o.roledescription=c._oRb.getText("INTERACTIVEDONUTCHART");o.multiselectable=true;o.disabled=!c._isChartEnabled();o.labelledby=c.getAriaLabelledBy();r.accessibilityState(c,o);r.openEnd();if(!c.getSelectionEnabled()){this._renderDisabledOverlay(r,c);}this._renderDonut(r,c,s);this._renderLegend(r,c,s);r.close("div");};a._renderDonut=function(r,c,s){var S,f,b,d,t,e,o,h,C=c._bCompact;r.openStart("div");r.class("sapSuiteIDCChart");r.openEnd();r.openStart("svg");r.class("sapSuiteIDCChartSVG");r.attr("viewBox","-2 -2 104 104");r.attr("focusable","false");r.openEnd();r.openStart("g");r.attr("transform","translate(50.5 50.5)");r.openEnd();t=50;o=(this.OUTER_RADIUS_ABSOLUTE/this.TOTAL_RADIUS_ABSOLUTE)*t;if(C){e=this.HOLE_SIZE_RATIO_COMPACT*o;}else{e=this.HOLE_SIZE_RATIO_COZY*o;}h=t*(this.SELECTION_THICKNESS_ABSOLUTE/this.TOTAL_RADIUS_ABSOLUTE);f=this._calculateSum(c);b=0.0;var i;for(i=0;i<s;i++){S=this._aSegments[i];if(S.getValue()>0){d=this._calculateSegmentPath(f,S.getValue(),b,o+h,e-h,this._fGhostHalfGapSize);r.openStart("path");r.attr("d",d);r.attr("data-sap-ui-idc-selection-index",i);r.class(I.CHART_SEGMENT_GHOST.CSSCLASS);if(S.getSelected()){r.class(I.CHART_SEGMENT_GHOST.CSSCLASS_SELECTED);}r.openEnd();if(c._isChartEnabled()){this._renderTitle(S.getTooltip_AsString(),r);}r.close("path");b+=this._aSegments[i].getValue();}}b=0.0;for(i=0;i<s;i++){S=this._aSegments[i];if(S.getValue()>0){d=this._calculateSegmentPath(f,S.getValue(),b,o,e,0);r.openStart("path");r.attr("d",d);r.attr("fill",this._getSegmentColor(i,s));r.attr("cursor","pointer");r.attr("data-sap-ui-idc-selection-index",i);r.class(I.CHART_SEGMENT.CSSCLASS);if(S.getSelected()){r.class(I.CHART_SEGMENT.CSSCLASS_SELECTED);}r.openEnd();if(c._isChartEnabled()){this._renderTitle(S.getTooltip_AsString(),r);}r.close("path");b+=this._aSegments[i].getValue();}}r.close("g");r.close("svg");r.close("div");};a._renderLegend=function(r,c,s){r.openStart("div");r.class("sapSuiteIDCLegend");r.openEnd();for(var i=0;i<s;i++){this._renderLegendSegment(r,c,i,s);}r.close("div");};a._renderLegendSegment=function(r,c,i,s){var S=this._aSegments[i],l=S.getLabel(),d=S.getDisplayedValue()||String(S.getValue()),t,C=S._getSemanticColor();if(S._bNullValue){d=c._oRb.getText("INTERACTIVECHART_NA");}d=d.substring(0,I.CHART_SEGMENT_LABEL_MAXLENGTH);var t=S.getTooltip_Text();var A;if(t&&t.trim()){A=t;}else{A=l;if(A){A=A+" "+d;}else{A=d;}if(C){A+=" "+C;}}var o={};o.role="option";o.label=A.trim();o.selected=S.getSelected();o.posinset=i+1;o.setsize=s;r.openStart("div",c.getId()+"-interactionArea-"+i);r.accessibilityState(S,o);r.attr("data-sap-ui-idc-selection-index",i);r.class("sapSuiteIDCLegendSegment");if(S.getSelected()){r.class(I.SEGMENT_CSSCLASS_SELECTED);}if(i===0&&c.getSelectionEnabled()){r.attr("tabindex","0");}r.openEnd();C=S.getColor();if(C!==M.ValueColor.Neutral){r.openStart("div");r.class("sapSuiteIDCSemanticMarker");r.class("sapSuiteICSemanticColor"+C);r.openEnd();r.close("div");}r.openStart("div");r.class("sapSuiteIDCLegendMarker");r.style("background-color",this._getSegmentColor(i,s));r.openEnd();r.close("div");r.openStart("div");r.class("sapSuiteIDCLegendLabelValue");r.openEnd();r.openStart("div");r.class("sapSuiteIDCLegendLabel");r.openEnd();r.text(l);r.close("div");r.openStart("div");r.class("sapSuiteIDCLegendValue");r.openEnd();r.text(d);r.close("div");r.close("div");r.close("div");};a._getSegmentColor=function(p,s){var w=1-(s-p)/s,c=P.get("_sap_suite_ui_microchart_InteractiveDonutChart_SegmentFillColor")||"white";if(this._isThemeHighContrast()){return c;}return this._mixColors(c,"#ffffff",w);};a._calculateSegmentPath=function(s,b,c,o,i,d){var m=0.01,S,l,e,f,g,h,E,j,k,n=this._fSegmentHalfGapSize+d,G=Math.pow(2*n,2),p,q,r,t;o=this._formatFloat(o);i=this._formatFloat(i);h=this._calculateCircleFraction(s,c);E=this._calculateCircleFraction(s,c+b);j=this._calculateCircleFraction(s,b);if(j<=Math.PI){k=0;}else{k=1;}if(s===b){p=i;q=o;r=0;t=0;}else{p=Math.sqrt(Math.pow(i,2)+G);q=Math.sqrt(Math.pow(o,2)+G);r=Math.atan(n/i);t=Math.atan(n/o);}l={"x":this._formatFloat(p*Math.sin(h+r)),"y":this._formatFloat(-p*Math.cos(h+r))};e={"x":this._formatFloat(q*Math.sin(h+t)),"y":this._formatFloat(-q*Math.cos(h+t))};f={"x":this._formatFloat(o*Math.sin(E-t)-m),"y":this._formatFloat(-o*Math.cos(E-t))};g={"x":this._formatFloat(i*Math.sin(E-r)-m),"y":this._formatFloat(-i*Math.cos(E-r))};S="";S+="M"+l.x+" "+l.y+" ";S+="L"+e.x+" "+e.y+" ";S+="A"+o+","+o+" 0 "+k+",1"+" "+f.x+","+f.y+" ";S+="L"+g.x+" "+g.y+" ";S+="A"+i+","+i+" 0 "+k+",0"+" "+l.x+","+l.y;return S;};a._formatFloat=function(v){return parseFloat(v.toFixed(2));};a._calculateSum=function(c){var s=0;var d=c.getDisplayedSegments();for(var i=0;i<this._aSegments.length&&i<d;i++){var v=this._aSegments[i].getValue();if(v>0){s+=v;}}return s;};a._calculateCircleFraction=function(s,b){return(2*Math.PI*b)/s;};a._renderDisabledOverlay=function(r){r.openStart("div");r.class("sapSuiteIDCDisabledOverlay");r.openEnd();r.close("div");};a._getAriaDescribedBy=function(c,s){var A=[];for(var i=0;i<s;i++){A.push(c.getId()+"-interactionArea-"+i);}return A.join(",");};a._mixColors=function(c,b,w){if(w===1||c.toLowerCase()===b.toLowerCase()){return c;}var C=this._hexToRgb(c);var d=this._hexToRgb(b);var s=Math.round((C[0]+(Math.abs(C[0]-d[0])*w))%255);var e=Math.round((C[1]+(Math.abs(C[1]-d[1])*w))%255);var f=Math.round((C[2]+(Math.abs(C[2]-d[2])*w))%255);return"#"+this._intToHex(s)+this._intToHex(e)+this._intToHex(f);};a._isThemeHighContrast=function(){return/(hcw|hcb)/g.test(sap.ui.getCore().getConfiguration().getTheme());};a._hexToRgb=function(h){var c=[];h=h.replace(/[^0-9a-f]+/ig,'');if(h.length===3){c=h.split('');}else if(h.length===6){c=h.match(/(\w{2})/g);}else{L.warning("Invalid color input: hex string must be in the format #FFFFFF or #FFF");}return c.map(function(x){return parseInt(x,16);});};a._intToHex=function(v){var h=v.toString(16);if(h.length===1){h='0'+h;}return h;};a._renderTitle=function(t,r){if(typeof t==="string"||t instanceof String){r.openStart("title");r.style("visibility","hidden");r.openEnd();if(D.browser.msie){t=t.split("\n");for(var j=0;j<t.length;j++){r.text(t[j]);if(j<t.length-1){r.voidStart("br");r.voidEnd();}}}else{r.text(t);}r.close("title");}};return a;},true);
