// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell_abap/pbServices/ui2/Utils","sap/ushell_abap/pbServices/ui2/Error"],function(U,S){"use strict";var c=new U.Map();var O=function(o,d){var b;this.getCsrfToken=function(){if(c.get(b)&&c.get(b).token){return c.get(b).token;}return"";};this.getDefaultErrorHandler=function(){return d;};this.openBatchQueue=function(){o.openBatchQueue();};this.refreshCsrfToken=function(s,f){var t;if(typeof s!=="function"){throw new S("Success callback is not a function","ODataService");}f=f||d;t=c.get(b);if(!t.fetchingInProgress){t.token=undefined;t.fetchingInProgress=true;o.read("",function(){if(!c.get(b)||!c.get(b).token){f("No CSRF token delivered");t.errorHandlers.forEach(function(h){h("No CSRF token delivered");});}else{s();t.successHandlers.forEach(function(h){h();});}t.successHandlers=[];t.errorHandlers=[];t.fetchingInProgress=false;},function(){t.fetchingInProgress=false;f.apply(null,arguments);});}else{t.successHandlers.push(s);t.errorHandlers.push(f);}};this.setCsrfToken=function(n){var t;if(n&&typeof n!=="string"){throw new S("Invalid CSRF token: "+n,"ODataService");}t=c.get(b);t.token=n;};this.setDefaultErrorHandler=function(n){if(n&&typeof n!=="function"){throw new S("Error callback is not a function","ODataService");}d=n||function(){};};this.submitBatchQueue=function(){o.submitBatchQueue.apply(o,arguments);};this.toString=function(v){var r=["ODataService({"];if(v){r.push('csrfToken:"',this.getCsrfToken(),'"');r.push(",oODataWrapper:",o.toString(true));}r.push("})");return r.join("");};if(!o){throw new S("Missing OData wrapper","ODataService");}b=o.getBaseUrl();if(!c.get(b)){c.put(b,{fetchingInProgress:false,successHandlers:[],errorHandlers:[]});}this.setDefaultErrorHandler(d);};O.resetSharedCsrfTokens=function(){c=new U.Map();};return O;},true);
