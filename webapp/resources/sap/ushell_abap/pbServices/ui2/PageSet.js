// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell_abap/pbServices/ui2/Utils","sap/ushell_abap/pbServices/ui2/Page","sap/ushell_abap/pbServices/ui2/Error","sap/base/Log"],function(U,P,S,L){"use strict";var O={assigned:1,userCreated:2,personalized:3,defaultPage:4};var a=function(f,p){var I,A,d,b=[],o,c=true,t=this;function e(){if(c){throw new S(t+": page set is just a stub","sap.ushell_abap.pbServices.ui2.PageSet");}}this.getPageType=function(h){var I=h.getId(),i;e();if(!o.containsKey(I)){throw new S("Unknown page "+I,"sap.ushell_abap.pbServices.ui2.PageSet");}i=o.get(I);if(i===O.assigned&&h.isPersonalized()){i=O.personalized;}return i;};function g(n){var D=n.DefaultPage.id,r=(n.AssignedPages&&n.AssignedPages.results)||[];A=n;o=new U.Map();r.forEach(function(R){o.put(R.id,O.assigned);});A.Pages.results.forEach(function(R){var h=new P(f,R),s=h.getId();b.push(h);if(D===s){d=h;o.put(s,O.defaultPage);}else if(!o.containsKey(s)){o.put(s,O.userCreated);}});delete A.AssignedPages;delete A.DefaultPage;delete A.Pages;c=false;L.debug("Initialized: "+t,null,"PageSet");}this.appendPage=function(s,C,h,F){e();if(typeof h!=="function"){throw new S("Missing success handler","PageSet");}f.getPageBuildingService().createPageInPageSet(I,s,C,function(n){var N=new P(f,n);b.push(N);o.put(N.getId(),O.userCreated);L.debug("Appended new page with ID "+N.getId()+" to pageset "+t,null,"PageSet");h(N);},F);};this.isPageRemovable=function(h){return this.getPageType(h)===O.userCreated;};this.isPageResettable=function(h){return this.getPageType(h)===O.personalized;};this.removePage=function(h,s,F){if(!this.isPageRemovable(h)){throw new S("Cannot remove page "+h.getId(),"PageSet");}h.remove(function(){b.splice(b.indexOf(h),1);o.remove(h.getId());if(s){s();}},F);};this.resetPage=function(h,s,F){if(!this.isPageResettable(h)){throw new S("Cannot reset page "+h.getId(),"sap.ushell_abap.pbServices.ui2.PageSet");}h.remove(function(){h.load(s,F,true);},F);};this.filter=function(h,C){var i,r=[],j;e();h=h||[];C=C||[];for(i=0;i<b.length;i+=1){j=b[i];if(h.indexOf(j.getId())!==-1){r.push(j);}else if(j.getCatalog()&&C.indexOf(j.getCatalog().getId())!==-1){r.push(j);}}b=r;};this.getConfiguration=function(){e();return A.configuration;};this.setConfiguration=function(C,s,F){e();if(typeof s!=="function"){throw new S("Missing success handler","PageSet");}if(A.configuration===C){U.callHandler(s,F,true);return;}A.configuration=C;f.getPageBuildingService().updatePageSet(A,function(n){s();},F);};this.getDefaultPage=function(){e();return d;};this.getId=function(){return I;};this.getPages=function(){e();return b.slice();};this.isStub=function(){return c;};this.load=function(s,F){if(!c){throw new S("Page set is not a stub anymore","PageSet");}f.getPageBuildingService().readPageSet(I,function(n){L.debug("Loaded: "+t,null,"PageSet");g(n);s();},F,true);};this.toString=function(v){var r=['PageSet({sId:"',I,'",bIsStub:',c];if(v){r.push(",oAlterEgo:",JSON.stringify(A),",oFactory:",f.toString(v),",aPages:",JSON.stringify(b));}r.push("})");return r.join("");};I=p;if(!I){throw new S("Missing page set ID","PageSet");}L.debug("Created: "+this,null,"PageSet");};return a;},true);
