// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
this.sap=this.sap||{};sap.ui.define(["sap/ushell_abap/pbServices/ui2/Bag","sap/ushell_abap/pbServices/ui2/Utils","sap/ushell_abap/pbServices/ui2/Error","sap/base/Log"],function(B,U,S,L){"use strict";var C=function(f,a,c,p){var A,b,o,d=new U.Map(),F=false,e=[],r,t,T,g=this;function m(){a.referenceChipInstanceId="";a.referencePageId="";}function h(){m();if(p){p.updateScope();}}function j(){if(!A){throw new S(g+": CHIP instance is just a stub","ChipInstance");}}function k(s,i){if(!A){A=c.createApi(g,d);}L.debug("Initialized: "+g,null,"ChipInstance");U.callHandler(s,i);}function l(R){var i,n=c.getBagIds(),s;for(i=0;i<R.length;i+=1){b.put(R[i].id,new B(f,R[i],c.getBag(R[i].id),h));}for(i=0;i<n.length;i+=1){s={pageId:a.pageId,instanceId:a.instanceId,id:n[i],$tmp:true};if(!b.containsKey(s.id)){b.put(s.id,new B(f,s,c.getBag(s.id),h));}}}function q(){if(c.isStub()){throw new S(this+": initializeConfiguration expects that the CHIP is no stub anymore","ChipInstance",false);}if(!o){o={};c.updateConfiguration(o,a.configuration);}}this.persist=function(s,i){f.getPageBuildingService().updatePageChipInstance(a,function(){m();if(p){p.updateScope();}if(s){s();}},i);};this.attachFullscreen=function(E){if(typeof E!=="function"){throw new S(this+": fullscreen event handler is not a function","ChipInstance");}e.push(E);};this.attachRefresh=function(E){if(E&&typeof E!=="function"){throw new S(this+": refresh event handler is not a function","ChipInstance");}r=E;};this.attachTitleChange=function(n){T=n;};this.detachAll=function(){e=[];r=null;};this.exit=function(){L.debug("Exit: "+g,null,"ChipInstance");A=null;b=new U.Map();o=null;t=null;T=null;};this.getApi=function(){return A;};this.getBagIds=function(){return b.keys();};this.getBag=function(s){var i;if(!s){throw new S("Missing bag ID","ChipInstance");}i=b.get(s);if(i){return i;}i=new B(f,{pageId:a.pageId,instanceId:a.instanceId,id:s,$tmp:true},null,h);b.put(s,i);return i;};this.getChip=function(){return c;};this.getConfiguration=function(){return a.configuration;};this.getConfigurationParameter=function(K){q();if(Object.prototype.hasOwnProperty.call(o,K)){return o[K];}return c.getConfigurationParameter(K);};this.getContract=function(n){j();return d.get(n);};this.getFullscreen=function(){return F;};this.getId=function(){return a.instanceId;};this.getImplementationAsSapui5=function(){j();return c.getImplementationAsSapui5(A);};this.getLayoutData=function(){return a.layoutData;};this.getPage=function(){return p;};this.getTitle=function(){return t||a.title||c.getTitle();};this.getUpdated=function(i){function n(){L.error("Parse Error: CHIP instance's updated property has unexpected format","value of updated property: '"+a.updated+"'","ChipInstance");}var M,R;if(a.updated&&!i){M=/\((\d*)\)/.exec(a.updated);if(!M){n();return undefined;}R=new Date(parseInt(M[1],10));if(isNaN(R.getTime())){n();return undefined;}return R;}return a.updated;};this.isOutdated=function(){return a.outdated==="X";};this.isReadOnly=function(){j();return a.isReadOnly==="X";};this.isReference=function(){return!!a.referenceChipInstanceId||!!a.referencePageId;};this.isBrokenReference=function(){return a.referenceChipInstanceId==="O"||a.referencePageId==="O";};this.getOriginalId=function(){return(a.referenceChipInstanceId===""||a.referenceChipInstanceId==="O")?undefined:a.referenceChipInstanceId;};this.getOriginalPageId=function(){return(a.referencePageId===""||a.referencePageId==="O")?undefined:a.referencePageId;};this.isStub=function(){return!A;};this.load=function(s,i){var n;i=i||f.getPageBuildingService().getDefaultErrorHandler();n=k.bind(null,s,i);if(c.isStub()){c.load(n,i);}else{U.callHandler(n,i,true);}};this.remove=function(s,i){if(p&&p.removeChipInstance(g,s,i)){return;}this.exit();f.getPageBuildingService().deletePageChipInstance(a.pageId,a.instanceId,s,i);};this.refresh=function(){if(r){try{r();return true;}catch(i){L.error(g+": call to refresh handler failed: "+(i.message||i.toString()),null,"ChipInstance");return false;}}return false;};this.setFullscreen=function(O){var i,n;if(F!==O){F=O;for(i=0,n=e.length;i<n;i+=1){e[i]();}}};this.setLayoutData=function(s,i,n){if(a.layoutData===s){if(i){n=n||f.getPageBuildingService().getDefaultErrorHandler();U.callHandler(i,n,true);}return;}a.layoutData=s;this.persist(i,n);};this.setTitle=function(n,D,s,i){var O;i=i||f.getPageBuildingService().getDefaultErrorHandler();if(t!==n){t=n;if(T){U.callHandler(T.bind(null,this),i,!D);}}if(D&&a.title!==t){O=a.title;a.title=t;t=undefined;this.persist(s,function(){a.title=O;t=undefined;i.apply(null,arguments);});}else if(s){U.callHandler(s,i,true);}};this.toString=function(v){var R=["ChipInstance({oChip:",c.toString(v),",bFullscreen:",F];if(v){R.push(",oAlterEgo:",JSON.stringify(a),",oApi:",JSON.stringify(A),",oBags:",b.toString(),",oConfiguration:",JSON.stringify(o),",oFactory:",f.toString(v),",aFullscreenHandlers.length:",e.length,',sTitle:"',t,'"');}R.push("})");return R.join("");};this.updateConfiguration=function(i,s,n){q();c.updateConfiguration(o,i);a.configuration=JSON.stringify(o);this.persist(s,n);};b=new U.Map();l((a.ChipInstanceBags&&a.ChipInstanceBags.results)||[]);delete a.Chip;L.debug("Created: "+this,null,"ChipInstance");};return C;},true);
