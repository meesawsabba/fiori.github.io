// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
this.sap=this.sap||{};sap.ui.define(["sap/ushell_abap/pbServices/ui2/Bag","sap/ushell_abap/pbServices/ui2/AllCatalogs","sap/ushell_abap/pbServices/ui2/Utils","sap/ushell_abap/pbServices/ui2/Error","sap/base/Log"],function(B,A,U,S,L){"use strict";var P=function(f,p){var I,a,o,b,c,C=[],d=true,e=true,t=this;function g(){if(e){throw new S(t+": page is just a stub","Page");}}function h(n){var i,k=!!(n.Bags&&n.Bags.results),r=k?n.Bags.results:[],R=(n.PageChipInstances&&n.PageChipInstances.results)||[],l=r.length,m=R.length;d=!k;delete n.Bags;delete n.Catalog;delete n.PageChipInstances;o=n;e=false;for(i=0;i<l;i+=1){b.put(r[i].id,new B(f,r[i]));}for(i=0;i<m;i+=1){C[i]=f.createChipInstance(R[i],null,null,t);}}function j(s,F){f.getPageBuildingService().updatePage(o,function(r){t.updateScope();if(s){s();}},F);}this.addChipInstance=function(T,s,F,i){var k=f.getPageBuildingService(),l,m;function u(r){var m=f.createChipInstance(r,i?null:s,F,t);C.push(m);t.updateScope();if(i){s(m);}}g();if(T.getChip){m=T;l=m.getChip();}else{l=T;}if(l.getRemoteCatalog()){k.createPageChipInstanceFromRawData({pageId:o.id,chipId:l.getId(),configuration:(m&&m.getConfiguration())||"",title:m&&m.getTitle(),remoteCatalogId:l.getRemoteCatalog().getId()},u,F);}else{k.createPageChipInstance(o.id,null,l.getId(),m&&m.getTitle(),(m&&m.getConfiguration())||"","",u,F);}};this.addChipInstanceReference=function(O,s,F){var i=f.getPageBuildingService();function u(r){var k=f.createChipInstance(r,O.isStub()?null:s,F,t);C.push(k);if(O.isStub()){s(k);}}g();i.clonePageChipInstance(O.getPage().getId(),O.getId(),this.getId(),u,F);};this.exit=function(){var i,n;L.debug("Exiting: "+this,null,"Page");for(i=0,n=C.length;i<n;i+=1){C[i].exit();}o=null;b=new U.Map();c=null;C=[];e=true;L.debug("Exited: "+this,null,"Page");};this.getAllCatalogs=function(){if(!a){a=new A(f,I);}return a;};this.getBagIds=function(){if(d){throw new S(t+": page is just a stub, load bags on demand","Page");}return b.keys();};this.getBag=function(s){var i;if(d){throw new S(t+": page is just a stub, load bags on demand","Page");}if(!s){throw new S("Missing bag ID","Page");}if(b.containsKey(s)){return b.get(s);}i=new B(f,{pageId:this.getId(),id:s,$tmp:true});b.put(s,i);return i;};this.loadBag=function(s){var D;if(!s){throw new S("Missing bag ID","Page");}if(b.containsKey(s)){D=b.get(s);}else{D=new jQuery.Deferred();b.put(s,D);f.getPageBuildingService().readBag(I,s,function(r){D.resolve(new B(f,r));},function(){D.resolve(new B(f,{pageId:I,id:s,$tmp:true}));});}return D.promise();};this.getCatalog=function(){g();if(!c&&o.catalogId){c=f.createCatalog(o.catalogId);}return c;};this.getChipInstances=function(){g();return C.slice();};this.getId=function(){return I;};this.getLayout=function(){g();return o.layout;};this.setLayout=function(l,s,F){g();if(o.layout===l){if(s){F=F||f.getPageBuildingService().getDefaultErrorHandler();U.callHandler(s,F,true);}return;}o.layout=l;j(s,F);};this.getOriginalLanguage=function(){g();return o.originalLanguage;};this.getScope=function(){g();return o.scope;};this.getTitle=function(){g();return o.title;};this.setTitle=function(T,s,F){g();if(o.title===T){if(s){F=F||f.getPageBuildingService().getDefaultErrorHandler();U.callHandler(s,F,true);}return;}o.title=T;j(s,F);};this.isCatalogPage=function(){g();return o.isCatalogPage==="X";};this.isPersonalizationLocked=function(){g();return o.isPersLocked==="X";};this.setPersonalizationLocked=function(i,s,F){g();if(f.getPageBuildingService().isPersonalization()){throw new S("Personalization locking cannot be changed at personalization scope","Page");}if((o.isPersLocked==="X"&&i)||(o.isPersLocked!=="X"&&!i)){if(s){F=F||f.getPageBuildingService().getDefaultErrorHandler();U.callHandler(s,F,true);}return;}o.isPersLocked=i?"X":" ";j(s,F);};this.isOutdated=function(){g();return o.outdated==="X";};this.isReadOnly=function(){g();return o.isReadOnly==="X";};this.isPersonalized=function(){g();return o.scope==="PERSONALIZATION";};this.isStub=function(){return e;};this.load=function(s,F,k){var l;if(!e){throw new S("Page is not a stub anymore","Page");}function m(){if(l===0){L.debug("Initialized: "+t,null,"Page");s();}}function n(){l-=1;m();}f.getPageBuildingService().readPage(I,function(N){var i,r=(N.PageChipInstances&&N.PageChipInstances.results)||[],q=r.length;L.debug("Loaded: "+t,null,"Page");h(N);l=k?0:q;if(!k){for(i=0;i<q;i+=1){C[i].load(n,F);}}m();},F);};this.remove=function(s,F){this.exit();f.getPageBuildingService().deletePage(I,s,F);};this.removeChipInstance=function(k,s,F){var i=C.indexOf(k);g();if(i>=0){C.splice(i,1);k.remove(function(){t.updateScope();if(s){s.apply(this,arguments);}},function(){C.splice(i,0,k);F=F||f.getPageBuildingService().getDefaultErrorHandler();F.apply(this,arguments);});return true;}return false;};this.toString=function(v){var r=['Page({sId:"',I,'",bIsStub:',e,",bIsLoadingBagsOnDemand:",d];if(v){r.push(",oAlterEgo:",JSON.stringify(o),",oCatalog:",c?c.toString(v):c,",oFactory:",f.toString(v),",aChipInstances:",JSON.stringify(C));}r.push("})");return r.join("");};this.updateScope=function(){if(f.getPageBuildingService().isPersonalization()){o.scope="PERSONALIZATION";}};if(typeof p==="object"){I=p.id;h(p);}else if(typeof p==="string"){I=p;}if(!I){throw new S("Missing ID","Page");}b=new U.Map();L.debug("Created: "+this,null,"Page");};if(jQuery&&jQuery.sap){jQuery.sap.declare("sap.ui2.srvc.chip");jQuery.sap.declare("sap.ui2.srvc.Chip");sap.ui2.srvc.Page=sap.ui2.srvc.page=P;}return P;},true);
