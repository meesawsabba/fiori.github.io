// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell_abap/pbServices/ui2/Chip","sap/ushell_abap/pbServices/ui2/Error","sap/ushell_abap/pbServices/ui2/Catalog","sap/ushell_abap/pbServices/ui2/ChipDefinition","sap/ushell_abap/pbServices/ui2/PageBuildingService","sap/ushell_abap/pbServices/ui2/ChipInstance","sap/ushell_abap/pbServices/ui2/Page","sap/ushell_abap/pbServices/ui2/PageSet","sap/ushell_abap/pbServices/ui2/Utils","sap/base/Log"],function(C,S,a,b,P,c,d,e,U,L){"use strict";var F=function(p){var m={},f={},g={},r,t=this;this.addRemoteCatalogService=function(B,R){if(!B){throw new S("Invalid base URL","sap.ushell_abap.pbServices.ui2.Factory");}if(typeof R.readChips!=="function"){throw new S("Invalid remote catalog service","sap.ushell_abap.pbServices.ui2.Factory");}B=B.replace(/\/$/,"");if(r.containsKey(B)){throw new S("Base URL '"+B+"' already registered","sap.ushell_abap.pbServices.ui2.Factory");}r.put(B,R);};this.createCatalog=function(v,s,h){var t=this,o,i=typeof v==="object"?v.id:v;function j(){var A;h=h||t.getPageBuildingService().getDefaultErrorHandler();if(h){A=Array.prototype.slice.call(arguments);A.splice(1,0,o);h.apply(null,A);}}function k(){j.apply(null,o.getCachedRemoteFailureArguments());}if(Object.prototype.hasOwnProperty.call(f,i)){o=f[i].catalog;if(typeof v==="object"&&o.getCatalogData()===undefined){a.call(o,this,v);}}else{o=new a(this,v);f[i]={catalog:o,chips:{}};}if(s){if(o.isStub()){o.load(s.bind(null,o),j);}else if(o.getCachedRemoteFailureArguments()!==undefined){U.callHandler(k,k,true);}else{U.callHandler(s.bind(null,o),j,true);}}return o;};this.createChip=function(R,s,h){var i=R.remoteCatalogId,j=R.id,o,k;if(i){this.createCatalog(i);o=f[i].chips;}else{o=m;}if(Object.prototype.hasOwnProperty.call(o,j)){k=o[j];k.update(R);}else{k=new C(R,this);o[j]=k;}if(s){if(k.isStub()){k.load(s.bind(null,k),h);}else{h=h||this.getPageBuildingService().getDefaultErrorHandler();U.callHandler(s.bind(null,k),h,true);}}return k;};this.createChipDefinition=function(u,s,h){var o,l;function j(O,i,n,A){U.callHandler(i.bind(null,new b(O)),n,A);}function k(x){var i,n;var v=new b(x);g[u]=v;for(i=0,n=l.length;i<n;i+=2){j(v,l[i],l[i+1],false);}}function q(E){var i,n,M;if(typeof E==="string"){M=E;}else{M=E.message;}g[u]=M;for(i=0,n=l.length;i<n;i+=2){l[i+1](M);}}if(!u){throw new S("Missing URL","Factory");}if(typeof s!=="function"){throw new S("Missing success handler","Factory");}h=h||this.getPageBuildingService().getDefaultErrorHandler();if(window.jQuery&&jQuery.sap&&typeof jQuery.sap.loadResource==="function"){u=U.addCacheBusterTokenUsingUshellConfig(u);}if(Object.prototype.hasOwnProperty.call(g,u)){o=l=g[u];if(U.isArray(l)){l.push(s,h);}else if(o instanceof b){j(o,s,h,true);}else{U.callHandler(h.bind(null,o),null,true);}return;}l=[s,h];g[u]=l;if(window.jQuery&&jQuery.sap&&typeof jQuery.sap.loadResource==="function"){jQuery.sap.loadResource({dataType:"xml",url:u,async:true}).then(k).catch(q);}else{U.get(u,true,k,q);}};this.createChipInstance=function(R,s,h,o){var i,j;R.Chip=R.Chip||{$proxy:true};R.Chip.id=R.Chip.id||R.chipId;R.Chip.remoteCatalogId=R.Chip.remoteCatalogId||R.remoteCatalogId;if(R.RemoteCatalog&&R.RemoteCatalog.id){this.createCatalog(R.RemoteCatalog);}i=this.createChip(R.Chip);j=new c(this,R,i,o);if(s){j.load(s.bind(null,j),h);}return j;};this.createNewCatalog=function(o,s,h){this.getPageBuildingService().createCatalog(o,function(R){var i=t.createCatalog(R);i.load(s.bind(null,i),function(E,j){h(E,i,j);});},function(E,M){h(E,undefined,M);});};this.createNewPageBasedCatalog=function(D,T,s,h){this.getPageBuildingService().createPageBasedCatalog(D,T,function(R){t.createCatalog(R,s,h);},h);};this.createPage=function(s,h,i,j){var o;o=new d(this,s);if(h){o.load(h.bind(null,o),i,j);}return o;};this.createPageSet=function(s,h,i){var o;o=new e(this,s);if(h){o.load(h.bind(null,o),i);}return o;};this.forgetCatalog=function(o){delete f[o.getId()];};this.getPageBuildingService=function(){return p;};this.getRemoteCatalogService=function(R){var B=R.type==="H"?"/sap/hba/apps/kpi/s/odata/hana_chip_catalog.xsodata":R.baseUrl;return B?r.get(B.replace(/\/$/,"")):undefined;};this.toString=function(v){var R=["Factory({oPbs:",p.toString(v)];if(v){R.push(",mChips:",JSON.stringify(m));}R.push("})");return R.join("");};r=new U.Map();if(!p){throw new S("Missing page building service","Factory");}L.debug("Created: "+this,null,"Factory");};F.createFactory=function(B,D,i){return new F(P.createPageBuildingService(B,D,i));};return F;},true);
