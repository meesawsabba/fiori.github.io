/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/gantt/library","sap/ui/thirdparty/jquery","sap/ui/core/Element","sap/ui/core/Core","sap/ui/core/format/NumberFormat","sap/m/Label","sap/m/Text","sap/m/Title","sap/m/Dialog","sap/m/ProgressIndicator","sap/m/Button","sap/m/Input","sap/m/FlexBox","sap/m/library","sap/m/FlexItemData","sap/m/ScrollContainer","sap/m/ComboBox","sap/m/RadioButton","sap/m/RadioButtonGroup","sap/m/CheckBox","sap/m/Slider","sap/m/ResponsiveScale","sap/m/StepInput","sap/m/DatePicker","sap/m/BusyDialog","sap/m/MessageStrip","sap/m/Switch","sap/m/Panel","sap/m/TextArea","sap/gantt/misc/Format","sap/gantt/simple/GanttChartContainer","sap/gantt/config/TimeHorizon","sap/gantt/axistime/FullScreenStrategy","sap/ui/core/Item","sap/ui/core/HTML","sap/ui/layout/VerticalLayout","sap/ui/layout/HorizontalLayout","sap/ui/layout/GridData","sap/ui/layout/form/SimpleForm","sap/ui/model/json/JSONModel","sap/ui/core/theming/Parameters","sap/ui/core/ResizeHandler","sap/gantt/thirdparty/jspdf","sap/gantt/thirdparty/html2canvas"],function(G,$,E,C,N,L,T,a,D,P,B,I,F,M,b,S,c,R,d,e,f,g,h,j,k,l,m,o,p,q,r,s,t,u,H,V,v,w,x,J,y,z,A,K){"use strict";var O=M.FlexDirection,Q=G.simple.GanttChartWithTableDisplayType;K=window.html2canvas;A=window.jsPDF;var U=E.extend("sap.gantt.simple.GanttPrinting",{metadata:{library:"sap.gantt",associations:{ganttChart:{type:"sap.gantt.simple.GanttChartWithTable",multiple:false}}}});U._oPaperSizes={"A5":{width:Z(148),height:Z(210)},"A4":{width:Z(210),height:Z(297)},"A3":{width:Z(297),height:Z(420)},"A2":{width:Z(420),height:Z(594)},"A1":{width:Z(594),height:Z(841)},"A0":{width:Z(841),height:Z(1189)},"Letter":{width:a1(8.5),height:a1(11)},"Legal":{width:a1(8.5),height:a1(14)},"Tabloid":{width:a1(11),height:a1(17)},"Custom":{width:undefined,height:undefined}};var W="9px Arial, Helvetica, sans-serif";var X="12px Arial, Helvetica, sans-serif";var Y="16384";U.prototype.init=function(){this._oRb=C.getLibraryResourceBundle("sap.gantt");var i={"multiplePage":true,"qualityWarning":false,"showOrientationMessage":false,"orientationMessage":this._oRb.getText("GNT_PRNTG_SINGLE_PAGE_LANDSCAPE"),"portrait":true,"paperSize":"A4","paperWidth":U._oPaperSizes.A4.width,"paperHeight":U._oPaperSizes.A4.height,"unit":"mm","repeatSelectionPanel":false,"scale":100,"duration":"all","startDate":new Date(),"endDate":new Date(),"showPageNumber":false,"showHeaderText":false,"headerText":"","showFooterText":false,"footerText":"","exportAll":true,"exportRange":"","exportAsJPEG":true,"compressionQuality":75,"previewPageNumber":1,"lastPageNumber":undefined,"marginType":"default","marginLocked":false,"marginTop":Z(5),"marginRight":Z(5),"marginBottom":Z(5),"marginLeft":Z(5),"cropMarks":false,"cropMarksWeight":0.25,"cropMarksOffset":Z(3)};this._oModel=new J(i);this._oGanttCanvas=undefined;this._iHeaderAndFooterHeight=Z(8);this._ganttChartContainer=new r();};U.prototype.export=function(){this._savePdf();};U.prototype.renderGanttClone=function(){if(C.getConfiguration().getRTL()){return Promise.resolve();}return new Promise(function(i){this._ganttChartClone.getTable().attachEventOnce("_rowsUpdated",i,this);this._ganttChartClone.invalidate();}.bind(this));};U.prototype.mergeCanvases=function(i){var d1=document.createElement('canvas'),e1=d1.getContext('2d'),f1=i[0].width,g1=[],h1=i.reduce(function(n,i1,j1,i){g1.push({cnv:i1,y:n});n+=i[j1].height;return n;},0);d1.width=f1;d1.height=h1;g1.forEach(function(n){e1.beginPath();e1.drawImage(n.cnv,0,n.y,f1,n.cnv.height);});if(d1.width>Y||d1.height>Y){this._oClonedGanttDiv.style.height=d1.height+"px";this._oClonedGanttDiv.style.width=d1.width+"px";return undefined;}return d1;};U.prototype.generateCanvasAsync=function(i){var n=0;var d1=this._getOriginalGanttChart().getTable()._getTotalRowCount()/this.iThreshold;this.bLast=d1>1?false:true;var e1=this;var f1=[];var g1=0;var h1=25/Math.ceil(d1);function i1(){if(e1._bMultipleBatches){g1+=h1;e1._oProgressIndicator.setPercentValue(g1);}}function j1(i){if(e1._bCancel){return Promise.reject();}e1._oClonedGanttDiv.style.height=Y+"px";var l1=i*e1.iThreshold;var m1=e1._getOriginalGanttChart().getTable()._getTotalRowCount();e1.iThreshold=Math.min(e1.iThreshold,m1-l1);e1.bLast=n+1>=d1?true:false;e1._ganttChartClone.getTable().setVisibleRowCountMode(sap.ui.table.VisibleRowCountMode.Fixed);e1._ganttChartClone.getTable().setVisibleRowCount(e1.iThreshold);e1.bFirst=(i===0)?true:false;e1._ganttChartClone.getTable().setFirstVisibleRow(l1);if(C.getConfiguration().getRTL()){e1._ganttChartClone._bRenderGanttClone=true;}return new Promise(function(n1){this._ganttChartClone.getTable().attachEventOnce("_rowsUpdated",n1,e1);this._ganttChartClone.invalidate();}.bind(e1));}function k1(i){i1();return j1(i).then(function(){i1();return e1._expandAndCollapse();}).then(function(){e1._ganttChartClone._bExpandRows=true;i1();return e1._expandRowSettings();}).then(function(){e1._ganttChartClone._bExpandRows=false;e1._setCloneDivHeight();document.getElementById(e1._ganttChartClone.getId()+"-sapGanttBackgroundTableContent").style.height=e1._iContentHeight;document.getElementById(e1._ganttChartClone.getTable().getId()+"-tableCCnt").style.height=e1._iContentHeight;if(!e1.bLast){i1();}return e1._createGanttCanvas();}).then(function(l1){return f1.push(l1);}).then(function(){if(i===0){e1._ganttChartClone.setShowGanttHeader(false);}n=n+1;if(n<d1){k1(n);}else if(!e1._bCancel){e1._oGanttCanvas=e1.mergeCanvases(f1);e1._updateDialogPreview();e1._oDialog.getContent()[0].setBusy(false);e1._oFlexBoxPreview.setBusy(false);e1._oButtonExport.setEnabled(true);if(e1._bMultipleBatches){e1._oProgressIndicator.setPercentValue(100);setTimeout(function(){e1._closeProgressIndicator(true);},500);}}else{return Promise.reject();}}).catch(function(){});}return k1(i);};U.prototype.open=function(){if(!this.getGanttChart()||!this._getOriginalGanttChart().isA("sap.gantt.simple.GanttChartWithTable")){throw new Error("Association 'ganttChart' of type 'sap.gantt.simple.GanttChartWithTable' is not set");}var i=this;this._createAndOpenDialog();this._oDialog.getContent()[0].setBusy(true);this._oButtonExport.setEnabled(false);if(this._ganttChartClone._enableOptimisation){this._ganttChartClone.setShowGanttHeader(true);return this._drawClonedGantt().then(function(){if(i._bMultipleBatches){i._openProgressDialog();}return i.generateCanvasAsync(0);}).catch(function(n){if(n&&n.bMaxCanvasSizeExceeded){i._updateDialogPreviewCanvas();i._oDialog.getContent()[0].setBusy(false);}});}else{if(C.getConfiguration().getRTL()){i._ganttChartClone._bRenderGanttClone=true;}return this._drawClonedGantt().then(function(){return i._expandAndCollapse();}).then(function(){i._ganttChartClone._bExpandRows=true;return i._expandRowSettings();}).then(function(){i._ganttChartClone._bExpandRows=false;i._setCloneDivHeightNonOptimised();document.getElementById(i._ganttChartClone.getId()+"-sapGanttBackgroundTableContent").style.height=i._iContentHeight;document.getElementById(i._ganttChartClone.getTable().getId()+"-tableCCnt").style.height=i._iContentHeight;return i._createGanttCanvas();}).then(function(n){i._oGanttCanvas=n;i._updateDialogPreview();i._oDialog.getContent()[0].setBusy(false);i._oButtonExport.setEnabled(true);}).catch(function(n){if(n&&n.bMaxCanvasSizeExceeded){i._updateDialogPreviewCanvas();i._oDialog.getContent()[0].setBusy(false);}});}};U.prototype.close=function(){var i=this._getOriginalGanttChart();if(this._initialDisplayType===Q.Table){i.setSelectionPanelSize(this._initialSelectionPanelSize);i.setDisplayType(this._initialDisplayType);if(i.getParent()&&i.getParent().isA("sap.gantt.simple.GanttChartContainer")&&i.getParent().getToolbar()){i.getParent().getToolbar()._oDisplayTypeSegmentedButton.setSelectedKey(Q.Table);}}this._ganttChartClone.destroy();this._ganttChartClone=null;this._ganttChartContainer.destroy();this._ganttChartContainer=null;document.body.removeChild(this._oClonedGanttDiv);z.deregister(this._sResizeHandlerId);this._oDialog.close();this._oDialog.destroy();};U.prototype._closeProgressIndicator=function(i){this._oProgressDialog.close();this._oProgressDialog.destroy();this._bCancel=true;if(!this._bUpdateGanttCanvas&&!i){this.close();}};U.prototype.setGanttChart=function(i){this.setAssociation("ganttChart",i);this._initialDisplayType=i.getDisplayType();this._initialSelectionPanelSize=i._iLastTableAreaSize?i._iLastTableAreaSize:i.getSelectionPanelSize();var n=this._initialDisplayType===Q.Table?true:false;if(n){i.setSelectionPanelSize("100%");i.setDisplayType(Q.Both);}this._ganttChartClone=i.clone();this._ganttChartClone._enableOptimisation=i.getPrintingBatchSize()>0?true:false;this._bUpdateGanttCanvas=false;this._bCancel=false;this._ganttChartClone.setEnableChartOverflowToolbar(false);this.canvasScale=2;if(this._ganttChartClone._enableOptimisation){this._ganttChartClone.getTable().destroyExtension();var d1=n?1:Math.max((i.getAxisTimeStrategy().getZoomLevel()),1);this.iThreshold=Math.min(Math.round(i.getPrintingBatchSize()/d1),i.getTable()._getTotalRowCount());this._bMultipleBatches=i.getTable()._getTotalRowCount()>this.iThreshold;this.bFirst=true;this._ganttChartClone.getTable().setVisibleRowCountMode(sap.ui.table.VisibleRowCountMode.Fixed);this._ganttChartClone.getTable().setVisibleRowCount(this.iThreshold);this._ganttChartClone.getTable().setThreshold(this.iThreshold);this._ganttChartClone.setParent(this._getOriginalGanttChart(),"originalGanttChart",true);}else{this._ganttChartContainer.setParent(this._getOriginalGanttChart(),"originalGanttChart",true);}this._addBackOriginalGanttRowBinding(this._ganttChartClone,i);this._originalHasRenderedShapes=i.getInnerGantt().hasRenderedShapes();this._ganttChartClone.mEventRegistry={};this._ganttChartClone.setHeight("100%");var e1=i._oSplitter._calculatedSizes[0];if(this._initialDisplayType===Q.Chart){this._ganttChartClone.setSelectionPanelSize("1px");}else{this._ganttChartClone.setSelectionPanelSize(e1.toString()+"px");}var f1=i.getAxisTimeStrategy();if(!f1.isA("sap.gantt.axistime.FullScreenStrategy")&&!n){i.isPrint=true;i._getScrollExtension()._updateVisibleHorizonForce();var g1=this._ganttChartClone.getAxisTimeStrategy();g1.setVisibleHorizon(g1.getTotalHorizon());}var h1=f1.getVisibleHorizon();var i1=this._getHorizonDates(h1);var j1=this._horizonWidthInSec(i1);this._fPixelsBySec=i.getVisibleWidth()/j1;this._ganttChartClone.isPrint=true;this._ganttChartClone._bClonedGantt=true;if(!this._ganttChartClone._enableOptimisation){this._ganttChartContainer.addGanttChart(this._ganttChartClone);}return this;};U.prototype._expandAndCollapse=function(){if(this._bCancel){return Promise.reject();}var n=this._getOriginalGanttChart().getTable();if(!n.isA("sap.ui.table.TreeTable")){return new Promise(function(g1){this._ganttChartClone.getTable().attachEventOnce("_rowsUpdated",g1,this);this._ganttChartClone.invalidate();}.bind(this));}var d1=n.getBinding("rows"),e1=this._ganttChartClone.getTable().getBinding("rows"),f1=false;for(var i=0;i<d1.getLength();i++){if((e1.isExpanded(i)!==undefined)&&d1.isExpanded(i)&&!e1.isExpanded(i)){e1.expand(i);f1=true;}else if((e1.isExpanded(i)!==undefined)&&!d1.isExpanded(i)&&e1.isExpanded(i)){e1.collapse(i);f1=true;}}if(f1){return new Promise(function(g1){this._ganttChartClone.getTable().attachEventOnce("_rowsUpdated",g1,this);this._ganttChartClone.invalidate();}.bind(this));}else{return Promise.resolve();}};U.prototype._expandRowSettings=function(){if(this._bCancel){return Promise.reject();}var i=this._ganttChartClone.getShapeSchemes().find(function(n){return!n.getPrimary();});if(i){this._ganttChartClone.expand(i.getKey(),this._getOriginalGanttChart()._aExpandedIndices);}return new Promise(function(n){this._ganttChartClone.getTable().attachEventOnce("_rowsUpdated",n,this);this._ganttChartClone.invalidate();}.bind(this));};U.prototype._onResize=function(){var i=this._oHTMLDialogPreview.getDomRef();i.style.overflow="hidden";this._resizePrintingPreviewPage();i.style.overflow="visible";};function Z(i){return i*3.78;}function _(i){return i/3.78;}function a1(i){return i/0.01042;}function b1(i){return i*0.01042;}U.prototype._convertUnitToPx=function(i){var n=this._oModel.getProperty("/unit");if(!n){return undefined;}switch(n){case"mm":return Z(i);case"cm":return Z(i)*10;case"in":return a1(i);default:return undefined;}};U.prototype._convertPxToUnit=function(i){var n=this._oModel.getProperty("/unit");if(!n){return undefined;}switch(n){case"mm":return _(i);case"cm":return _(i)/10;case"in":return b1(i);default:return undefined;}};U.prototype._onChangeUnitComboBox=function(){this._updatePaperSizeInputs();this._updateMarginInputs();};U.prototype._updatePaperSizeInputs=function(){var i=this._oModel.getProperty("/paperWidth"),n=this._oModel.getProperty("/paperHeight");this._setPaperSizeInputs(i,n);};U.prototype._setPaperSizeInputs=function(i,n){if(this._oInputPaperWidth){this._oInputPaperWidth.setValue(this._convertPxToUnit(i));}if(this._oInputPaperHeight){this._oInputPaperHeight.setValue(this._convertPxToUnit(n));}};U.prototype._setPaperSizesToModel=function(i,n){this._oModel.setProperty("/paperWidth",i);this._oModel.setProperty("/paperHeight",n);};U.prototype._updatePaperSizeValues=function(){var i=this._oModel.getProperty("/paperSize"),n=this._oModel.getProperty("/portrait"),d1,e1;if(!i||i==="Custom"){return;}var f1=U._oPaperSizes[i];if(n){d1=f1.width;e1=f1.height;}else{d1=f1.height;e1=f1.width;}this._setPaperSizeInputs(d1,e1);this._setPaperSizesToModel(d1,e1);if(i==="Letter"||i==="Legal"||i==="Tabloid"){this._oComboBoxUnit.setSelectedKey("in");}else{this._oComboBoxUnit.setSelectedKey("mm");}this._onChangeUnitComboBox();this._updateDialogPreview();};U.prototype._updatePaperOrientation=function(i){var n=this._oModel.getProperty("/paperWidth"),d1=this._oModel.getProperty("/paperHeight");if(d1>n){this._oModel.setProperty("/portrait",true);this._radioGroupOrientation.setSelectedIndex(0);}else{this._oModel.setProperty("/portrait",false);this._radioGroupOrientation.setSelectedIndex(1);}};U.prototype._onChangePaperSizeInput=function(i){var n=i.getSource();var d1=this._convertUnitToPx(N.getFloatInstance().parse(n.getValue()));if(n===this._oInputPaperWidth){this._oModel.setProperty("/paperWidth",d1);}else{this._oModel.setProperty("/paperHeight",d1);}this._oComboBoxPaperSizes.setSelectedKey("Custom");this._updatePaperOrientation();this._updateDialogPreview();};U.prototype._onChangeCompressionSlider=function(i){var n=i.getSource();var d1=n.getValue();this._setCompressionComboBoxItem(d1);};U.prototype._setCompressionComboBoxItem=function(n){if(n===100){this._oComboBoxCompression.setSelectedKey("maximum");}else if(n>=75){this._oComboBoxCompression.setSelectedKey("high");}else if(n>=50){this._oComboBoxCompression.setSelectedKey("medium");}else{this._oComboBoxCompression.setSelectedKey("low");}};U.prototype._onChangeCompressionComboBox=function(i){var n=i.getSource().getSelectedKey();var d1={maximum:100,high:75,medium:50,low:25};this._oModel.setProperty("/compressionQuality",d1[n]);};U.prototype._onChangeOrientation=function(){var i=this._oModel.getProperty("/paperWidth"),n=this._oModel.getProperty("/paperHeight");this._setPaperSizeInputs(n,i);this._setPaperSizesToModel(n,i);this._updateDialogPreview();};U.prototype._onChangeExportTypes=function(){this._updateDialogPreview();};U.prototype._setMarginInputs=function(i,n,d1,e1){this._oInputMarginTop.setValue(this._convertPxToUnit(i));this._oInputMarginRight.setValue(this._convertPxToUnit(n));this._oInputMarginBottom.setValue(this._convertPxToUnit(d1));this._oInputMarginLeft.setValue(this._convertPxToUnit(e1));};U.prototype._setMarginsToModel=function(i,n,d1,e1){if(i!==undefined){this._oModel.setProperty("/marginTop",i);}if(n!==undefined){this._oModel.setProperty("/marginRight",n);}if(d1!==undefined){this._oModel.setProperty("/marginBottom",d1);}if(e1!==undefined){this._oModel.setProperty("/marginLeft",e1);}};U.prototype._onChangeMarginComboBox=function(i){var n=i.getSource().getSelectedKey();var d1=Z(5);if(n==="none"){d1=0;}this._setMarginsToModel(d1,d1,d1,d1);this._setMarginInputs(d1,d1,d1,d1);this._updateDialogPreview();};U.prototype._updateModelFromMarginInputs=function(){var i,n,d1,e1;if(this._oInputMarginTop.getValueState()!=="Error"){i=this._convertUnitToPx(this._oInputMarginTop.getValue());}if(this._oInputMarginRight.getValueState()!=="Error"){n=this._convertUnitToPx(this._oInputMarginRight.getValue());}if(this._oInputMarginBottom.getValueState()!=="Error"){d1=this._convertUnitToPx(this._oInputMarginBottom.getValue());}if(this._oInputMarginLeft.getValueState()!=="Error"){e1=this._convertUnitToPx(this._oInputMarginLeft.getValue());}this._setMarginsToModel(i,n,d1,e1);};U.prototype._updateMarginInputs=function(){var i=this._oModel.getProperty("/marginTop");var n=this._oModel.getProperty("/marginRight");var d1=this._oModel.getProperty("/marginBottom");var e1=this._oModel.getProperty("/marginLeft");this._setMarginInputs(i,n,d1,e1);};U.prototype._updateCropMarksOffsetInput=function(){var i=this._oModel.getProperty("/cropMarksOffset");this._oInputCropMarksOffset.setValue(this._convertPxToUnit(i));};U.prototype._onChangeMarginInput=function(i){var n=i.getSource();if(n.getValueState()==="Error"){return;}if(this._oModel.getProperty("/marginLocked")){var d1=this._convertUnitToPx(n.getValue());this._setMarginInputs(d1,d1,d1,d1);this._setMarginsToModel(d1,d1,d1,d1);}else{this._updateModelFromMarginInputs();}this._updateDialogPreview();};U.prototype._onChangeCropMarksInput=function(i){var n=i.getSource();var d1=this._convertUnitToPx(n.getValue());this._oInputCropMarksOffset.setValue(this._convertPxToUnit(d1));this._oModel.setProperty("/cropMarksOffset",d1);};U.prototype._allRange=function(){this._oModel.setProperty("/startDate",this._oDatePickerFrom.getMinDate());this._oModel.setProperty("/endDate",this._oDatePickerTo.getMaxDate());};U.prototype._getFirstDayOfNextWeek=function(i){var n=this._getOriginalGanttChart().getAxisTimeStrategy().getFirstDayOfWeek();var d1=(n+7-i.getDay())%7;return new Date(i.getFullYear(),i.getMonth(),i.getDate()+(d1===0?7:d1));};U.prototype._nextWeekRange=function(){var n=new Date();var i=this._getFirstDayOfNextWeek(n);this._oModel.setProperty("/startDate",this._validateDate(i));this._oModel.setProperty("/endDate",this._validateDate(new Date(i.getFullYear(),i.getMonth(),i.getDate()+7)));};U.prototype._getFirstDayOfNextMonth=function(i){return new Date(i.getFullYear(),i.getMonth()+1,1);};U.prototype._nextMonthRange=function(){var n=new Date();this._oModel.setProperty("/startDate",this._validateDate(this._getFirstDayOfNextMonth(n)));this._oModel.setProperty("/endDate",this._validateDate(new Date(n.getFullYear(),n.getMonth()+2,1)));};U.prototype._validateDate=function(i){var n=this._oDatePickerTo.getMaxDate(),d1=this._oDatePickerFrom.getMinDate();if(i.getTime()>n.getTime()){return n;}if(i.getTime()<d1.getTime()){return d1;}return i;};U.prototype._onChangeDurationComboBox=function(){var i=this._oModel.getProperty("/duration");switch(i){case"all":{this._allRange();}break;case"week":{this._nextWeekRange();}break;case"month":{this._nextMonthRange();}break;case"custom":default:return;}this._updateGanttCanvas();};U.prototype._onChangeDurationDatePicker=function(){this._oComboBoxDuration.setSelectedKey("custom");this._updateGanttCanvas();};U.prototype._setEnabledPreviousButtons=function(i){this._oButtonFirst.setEnabled(i);this._oButtonPrevious.setEnabled(i);};U.prototype._setEnabledNextButtons=function(i){this._oButtonNext.setEnabled(i);this._oButtonLast.setEnabled(i);};U.prototype._updatePageNumberButtons=function(){if(!this._oGanttCanvas){this._setEnabledNextButtons(false);this._setEnabledPreviousButtons(false);return;}var i=this._oModel.getProperty("/previewPageNumber"),n=this._oModel.getProperty("/lastPageNumber");if(!n){n=Number.MAX_SAFE_INTEGER;}if(i<=1){this._setEnabledPreviousButtons(false);}if(i>=n){this._setEnabledNextButtons(false);}if(i>1){this._setEnabledPreviousButtons(true);}if(i<n){this._setEnabledNextButtons(true);}};U.prototype._getHeaderHeight=function(){var i=this._oModel.getProperty("/showHeaderText");if(i){return this._iHeaderAndFooterHeight;}return 0;};U.prototype._isFooterMultiline=function(){if(!this._oModel.getProperty("/multiplePage")){return false;}var i=this._oModel.getProperty("/showPageNumber"),n=this._oModel.getProperty("/showFooterText");if(!n||!i){return false;}var d1=this._oModel.getProperty("/footerText"),e1=this._oModel.getProperty("/paperWidth"),f1;var g1=C.getConfiguration().getRTL();if(g1){f1=this._oModel.getProperty("/marginRight");}else{f1=this._oModel.getProperty("/marginLeft");}var h1=7;var i1=this._oGanttCanvas.getContext("2d");i1.font=W;var j1=i1.measureText(d1).width;if(e1/2>(f1+Z(4)+j1+Z(10)+h1)){return false;}else{return true;}};U.prototype._getFooterHeight=function(){var i=this._oModel.getProperty("/showPageNumber"),n=this._oModel.getProperty("/showFooterText");if(n&&i){return this._isFooterMultiline()?2*this._iHeaderAndFooterHeight:this._iHeaderAndFooterHeight;}if(n||i){return this._iHeaderAndFooterHeight;}return 0;};U.prototype._isShrinkableToOnePageByWidth=function(){var i=this._getPaperContentWidth()/this._getPaperContentHeight(),n=this._oGanttCanvas.width/this._oGanttCanvas.height;return i<=n;};U.prototype._getPaperContentWidth=function(){var i=this._oModel.getProperty("/paperWidth"),n=this._oModel.getProperty("/marginLeft"),d1=this._oModel.getProperty("/marginRight");return i-n-d1;};U.prototype._getPaperContentHeight=function(){var i=this._oModel.getProperty("/paperHeight"),n=this._oModel.getProperty("/marginTop"),d1=this._oModel.getProperty("/marginBottom");return i-n-this._getHeaderHeight()-d1-this._getFooterHeight();};U.prototype._getScale=function(){return(100/this._oModel.getProperty("/scale"))*2;};U.prototype._getCroppingWidth=function(){return this._getScale()*this._getPaperContentWidth();};U.prototype._getCroppingHeight=function(){return this._getScale()*this._getPaperContentHeight();};U.prototype._getPagesInARow=function(){return Math.ceil(this._oGanttCanvas.width/this._getCroppingWidth());};U.prototype._getPagesInAColumn=function(){return Math.ceil(this._oGanttCanvas.height/this._getCroppingHeight());};U.prototype._updateLastPageNumber=function(){if(!this._oGanttCanvas){return;}var i=this._getPagesInARow()*this._getPagesInAColumn();this._oModel.setProperty("/lastPageNumber",i);var n=this._oModel.getProperty("/previewPageNumber");if(n>i){this._oModel.setProperty("/previewPageNumber",i);}};U.prototype._onPressButtonFirst=function(){this._oModel.setProperty("/previewPageNumber",1);this._updatePageNumberButtons();this._updateDialogPreviewCanvas();};U.prototype._onPressButtonPrevious=function(){var i=this._oModel.getProperty("/previewPageNumber");this._oModel.setProperty("/previewPageNumber",i-1);this._updatePageNumberButtons();this._updateDialogPreviewCanvas();};U.prototype._onPressButtonNext=function(){var i=this._oModel.getProperty("/previewPageNumber");this._oModel.setProperty("/previewPageNumber",i+1);this._updatePageNumberButtons();this._updateDialogPreviewCanvas();};U.prototype._onPressButtonLast=function(){var i=this._oModel.getProperty("/lastPageNumber");if(!i){return;}this._oModel.setProperty("/previewPageNumber",i);this._updatePageNumberButtons();this._updateDialogPreviewCanvas();};U.prototype._getOriginalGanttChart=function(){return sap.ui.getCore().byId(this.getAssociation("ganttChart"));};U.prototype._setGanttCloneDivWidth=function(i){var n=this._getOriginalGanttChart(),d1=this._getHorizonDates(i),e1=this._horizonWidthInSec(d1),f1=Math.ceil(this._fPixelsBySec*e1);var g1=n.getDisplayType()===Q.Both?n.getTable().getDomRef().offsetWidth:0;this._oClonedGanttDiv.style.width=(g1+f1+10).toString()+"px";};U.prototype._setGanttCloneDivHeight=function(){var i=this._getOriginalGanttChart().getTable();var n=i._getTotalRowCount(),d1=i._aRowHeights;var e1=d1.reduce(function(g1,h1){return g1+h1;});var f1=Math.ceil((e1/d1.length)*n);this._iGanttHeight=f1+102;this._oClonedGanttDiv.style.height=this._iGanttHeight.toString()+"px";};U.prototype._setCloneDivHeight=function(){var n=this.bFirst?document.getElementById(this._ganttChartClone.getId()+"-header-svg").height.baseVal.value:0;var d1=this._ganttChartClone.getTable().getVisibleRowCount();var e1=0;var f1=this.bLast?3:0;var g1=this._ganttChartClone.getTable().getRows()[0].getIndex();var h1=this._ganttChartClone.getTable().getFirstVisibleRow();var i1=Math.abs(g1-h1);var j1=this._ganttChartClone.getTable()._aRowHeights;for(var i=i1;i<d1+i1;i++){e1=e1+j1[i];}this._iContentHeight=e1+"px";this._oClonedGanttDiv.style.height=(e1+n+f1).toString()+"px";};U.prototype._setCloneDivHeightNonOptimised=function(){var n=document.getElementById(this._ganttChartClone.getId()+"-header-svg").height.baseVal.value;var d1=this._ganttChartClone.getTable()._getTotalRowCount();var e1=1;var f1=this._ganttChartClone.getTable()._aRowHeights;for(var i=0;i<d1;i++){var g1=f1[i]?f1[i]:0;e1=e1+g1;}this._iContentHeight=e1.toString()+"px";this._oClonedGanttDiv.style.height=(e1+n).toString()+"px";};U.prototype._createImgElementsFromSvgImages=function(){var n=this._ganttChartClone.$().find("svg.sapGanttChartSvg");if(!n.length){return;}var d1=this._ganttChartClone.$().find(".sapGanttChartCnt")[0];if(!d1){return;}d1.style.position="relative";var e1=n.find("image");for(var i=0;i<e1.length;i++){var f1=e1[i];var g1=document.createElement("img");g1.src=f1.getAttribute("href");g1.style.position="absolute";g1.style.top=f1.getAttribute("y")+"px";g1.style.left=f1.getAttribute("x")+"px";g1.style.width=f1.getAttribute("width")+"px";g1.style.height=f1.getAttribute("height")+"px";d1.appendChild(g1);}};U.prototype._createGanttCanvas=function(){if(this._bCancel){return Promise.reject();}this._setStyleToGanttChartSvg(this._ganttChartClone);this._createImgElementsFromSvgImages();return K(this._oClonedGanttDiv,{allowTaint:true,scale:this.canvasScale,logging:false});};U.prototype._updateGanttCanvas=function(){if(this._initialDisplayType===Q.Table){return;}var i=this._oModel;var n=this._ganttChartClone.getAxisTimeStrategy();var d1=n.getVisibleHorizon().clone();var e1=n.getTotalHorizon().clone();d1.setStartTime(i.getProperty("/startDate"));d1.setEndTime(i.getProperty("/endDate"));e1.setStartTime(i.getProperty("/startDate"));e1.setEndTime(i.getProperty("/endDate"));this._bUpdateGanttCanvas=true;this._bCancel=false;if(!this._bMultipleBatches){this._oFlexBoxPreview.setBusy(true);this._oButtonExport.setEnabled(false);}this._setGanttCloneDivWidth(e1);this._setGanttCloneDivHeight();if((this._oClonedGanttDiv.offsetWidth*this.canvasScale)>Y||(this._oClonedGanttDiv.offsetHeight*this.canvasScale)>Y){this._oClonedGanttDiv.style.height=(this._oClonedGanttDiv.offsetHeight*this.canvasScale)+"px";this._oClonedGanttDiv.style.width=(this._oClonedGanttDiv.offsetWidth*this.canvasScale)+"px";this._oGanttCanvas=undefined;this._updateDialogPreviewCanvas();this._oFlexBoxPreview.setBusy(false);return undefined;}n.setTotalHorizon(e1);n.setVisibleHorizon(d1);if(!this._ganttChartClone._enableOptimisation){this._ganttChartClone.invalidate();}this._ganttChartClone._bRenderGanttClone=true;if(this._ganttChartClone._enableOptimisation){var f1=this._getOriginalGanttChart();var g1=Math.max((f1.getAxisTimeStrategy().getZoomLevel()),1);this.iThreshold=Math.min(Math.round(f1.getPrintingBatchSize()/g1),f1.getTable()._getTotalRowCount());this._ganttChartClone.setShowGanttHeader(true);if(this._bMultipleBatches){this._openProgressDialog();}return this.renderGanttClone().then(function(){this._ganttChartClone._bRenderGanttClone=false;this.generateCanvasAsync(0);}.bind(this));}else{this._oClonedGanttDiv.style.height=(this._iGanttHeight*2)+"px";return this._ganttChartClone.getInnerGantt().resolveWhenReady(this._originalHasRenderedShapes).then(function(){this._ganttChartClone._bRenderGanttClone=false;this.renderGanttClone().then(function(){this._setCloneDivHeightNonOptimised();document.getElementById(this._ganttChartClone.getId()+"-sapGanttBackgroundTableContent").style.height=this._iContentHeight;document.getElementById(this._ganttChartClone.getTable().getId()+"-tableCCnt").style.height=this._iContentHeight;this._createGanttCanvas().then(function(h1){this._oGanttCanvas=h1;this._updateDialogPreview();this._oFlexBoxPreview.setBusy(false);}.bind(this)).catch(function(){this._oFlexBoxPreview.setBusy(false);}.bind(this));}.bind(this));}.bind(this)).catch(function(){this._oFlexBoxPreview.setBusy(false);}.bind(this));}};U.prototype._drawClonedGantt=function(){if(this._oClonedGanttDiv){return Promise.reject();}this._oClonedGanttDiv=document.createElement("div");this._oClonedGanttDiv.id="clonedGanttDiv";if(this._getOriginalGanttChart().$().closest(".sapUiSizeCompact").length>0){this._oClonedGanttDiv.classList.add("sapUiSizeCompact");}this._oClonedGanttDiv.style.position="absolute";this._oClonedGanttDiv.style.top="-17000px";this._oClonedGanttDiv.style.left="-17000px";document.body.appendChild(this._oClonedGanttDiv);this._setGanttCloneDivWidth(this._ganttChartClone.getAxisTimeStrategy().getTotalHorizon());this._setGanttCloneDivHeight();var i=this._oModel;var n=this._ganttChartClone.getAxisTimeStrategy();n.getVisibleHorizon().setStartTime(i.getProperty("/startDate"));n.getVisibleHorizon().setEndTime(i.getProperty("/endDate"));if(this._ganttChartClone._enableOptimisation){this._ganttChartClone.placeAt("clonedGanttDiv");}else{this._ganttChartContainer.placeAt("clonedGanttDiv");}this._addBackOriginalGanttRowBinding(this._ganttChartClone,this._getOriginalGanttChart());if((this._oClonedGanttDiv.offsetWidth*this.canvasScale)>Y||(this._oClonedGanttDiv.offsetHeight*this.canvasScale)>Y){this._oClonedGanttDiv.style.height=(this._oClonedGanttDiv.offsetHeight*this.canvasScale)+"px";this._oClonedGanttDiv.style.width=(this._oClonedGanttDiv.offsetWidth*this.canvasScale)+"px";return Promise.reject({bMaxCanvasSizeExceeded:true});}if(this._ganttChartClone._enableOptimisation){return Promise.resolve();}else{this._oClonedGanttDiv.style.height=(this._iGanttHeight*2)+"px";return this._ganttChartClone.getInnerGantt().resolveWhenReady(this._originalHasRenderedShapes);}};U.prototype._addBackOriginalGanttRowBinding=function(i,n){if(i.getTable().getBindingInfo("rows").binding==null){i.oPropagatedProperties=n._getPropertiesToPropagate();i.propagateProperties(true);}if(this._ganttChartClone._enableOptimisation){i.getTable().setVisibleRowCountMode(sap.ui.table.VisibleRowCountMode.Fixed);i.getTable().setVisibleRowCount(this.iThreshold);i.getTable().setThreshold(this.iThreshold);}var d1=n.getTable().getBinding("rows"),e1=i.getTable().getBinding("rows");if(d1){if(d1.sCustomParams){e1.sCustomParams=d1.sCustomParams;}if(d1.aApplicationFilters&&d1.aApplicationFilters.length>0){e1.filter(d1.aApplicationFilters,sap.ui.model.FilterType.Application);}if(d1.aSorters&&d1.aSorters.length>0){e1.sort(d1.aSorters);}}};U.prototype._resizePrintingPreviewPage=function(){var i=this._oHTMLDialogPreview.getDomRef(),n=this._oHTMLDialogPreview.$().find(".sapGanttPrintingPreviewPageDiv")[0],d1=i.offsetHeight,e1=this._oModel.getProperty("/paperHeight"),f1=this._oModel.getProperty("/paperWidth"),g1=this._oModel.getProperty("/portrait"),h1,i1;if(g1){h1=d1/e1;i1=f1*h1;}else{h1=d1/f1;i1=d1;d1=e1*h1;}n.style.width=i1.toString()+"px";n.style.height=d1.toString()+"px";};U.prototype._updateSinglePageMessages=function(i,n){if(n>i){this._oModel.setProperty("/orientationMessage",this._oRb.getText("GNT_PRNTG_SINGLE_PAGE_PORTRAIT"));}else{this._oModel.setProperty("/orientationMessage",this._oRb.getText("GNT_PRNTG_SINGLE_PAGE_LANDSCAPE"));}if(this._getPagesInARow()>3||this._getPagesInAColumn()>3){this._oModel.setProperty("/qualityWarning",true);}else{this._oModel.setProperty("/qualityWarning",false);}if((n>=i&&this._oModel.getProperty("/portrait"))||(n<=i&&!this._oModel.getProperty("/portrait"))){this._oModel.setProperty("/showOrientationMessage",false);}else{this._oModel.setProperty("/showOrientationMessage",true);}};U.prototype._getCanvasOfPageN=function(i,n){var d1=this._oModel.getProperty("/lastPageNumber");if(i>d1){return null;}var e1=document.createElement("canvas");var f1=e1.getContext("2d");f1.imageSmoothingEnabled=false;var g1=this._getCroppingWidth(),h1=this._getCroppingHeight();var i1=this._getPagesInARow();var j1=this._oModel.getProperty("/paperWidth"),k1=this._oModel.getProperty("/paperHeight");var l1=this._oModel.getProperty("/marginTop"),m1=this._oModel.getProperty("/marginRight"),n1=this._oModel.getProperty("/marginBottom"),o1=this._oModel.getProperty("/marginLeft");var p1=(i-1)%i1,q1=Math.floor((i-1)/i1);e1.width=j1;e1.height=k1;if(!n){e1.style.height="100%";e1.style.width="auto";}f1.fillStyle="white";f1.fillRect(0,0,e1.width,e1.height);f1.fillStyle=y.get("sapUiBaseText");f1.textBaseline="middle";f1.font=W;var r1;var s1=C.getConfiguration().getRTL();if(s1){f1.textAlign="right";r1=j1-m1-Z(4);}else{f1.textAlign="left";r1=o1+Z(4);}var t1=this._oModel.getProperty("/showHeaderText");if(t1){var u1=this._oModel.getProperty("/headerText");f1.fillText(u1,r1,l1+(this._iHeaderAndFooterHeight/2));}if(this._oModel.getProperty("/showFooterText")){f1.fillText(this._oModel.getProperty("/footerText"),r1,k1-n1-(this._iHeaderAndFooterHeight/2)-(this._isFooterMultiline()?this._iHeaderAndFooterHeight:0));}var v1=this._oModel.getProperty("/showPageNumber"),w1=this._oModel.getProperty("/multiplePage");if(w1&&v1){f1.font=X;f1.textAlign="center";f1.fillText(i.toString(),j1/2,k1-n1-(this._iHeaderAndFooterHeight/2));}if(w1){var x1=p1*g1,y1=q1*h1,z1=0,A1=0;var B1=false;if((x1+g1)>this._oGanttCanvas.width){B1=true;g1=(this._oGanttCanvas.width-x1);A1=g1/this._getScale();}var C1=false;if((y1+h1)>this._oGanttCanvas.height){C1=true;h1=(this._oGanttCanvas.height-y1);z1=h1/this._getScale();}f1.drawImage(this._oGanttCanvas,x1,y1,g1,h1,o1,l1+this._getHeaderHeight(),B1?A1:this._getPaperContentWidth(),C1?z1:this._getPaperContentHeight());}else{var D1=this._getPaperContentWidth(),E1=this._getPaperContentHeight();var F1=this._isShrinkableToOnePageByWidth();var G1;if(F1){G1=D1/this._oGanttCanvas.width;E1=this._oGanttCanvas.height*G1;}else{G1=E1/this._oGanttCanvas.height;D1=this._oGanttCanvas.width*G1;}this._updateSinglePageMessages(D1,E1);var H1=D1/this._oGanttCanvas.width;if(H1<1){this._downScaleCanvas(this._oGanttCanvas,f1,H1,0,0,this._oGanttCanvas.width,this._oGanttCanvas.height,o1,l1+this._getHeaderHeight());}else{f1.drawImage(this._oGanttCanvas,0,0,this._oGanttCanvas.width,this._oGanttCanvas.height,o1,l1+this._getHeaderHeight(),D1,E1);}}return e1;};U.prototype._downScaleCanvas=function(i,n,d1,e1,f1,g1,h1,i1,j1){var k1=document.createElement('canvas');k1.width=g1;k1.height=h1;var l1=k1.getContext('2d');l1.drawImage(i,e1,f1,g1,h1);var m1=d1*d1;var n1=Math.floor(g1*d1);var o1=Math.floor(h1*d1);var p1=0,q1=0,r1=0;var s1=0,t1=0,u1=0,v1=0;var w1=0,x1=0;var y1=0,z1=0,A1=0;var B1=0,C1=0,D1=0;var E1=false,F1=false;var G1=k1.getContext('2d').getImageData(0,0,g1,h1).data;var H1=new Float32Array(3*n1*o1);var I1=0,J1=0,K1=0;for(q1=0;q1<h1;q1++){t1=q1*d1;x1=0|t1;u1=3*x1*n1;F1=(x1!==(0|(t1+d1)));if(F1){A1=(x1+1-t1);D1=(t1+d1-x1-1);}for(p1=0;p1<g1;p1++,r1+=4){s1=p1*d1;w1=0|s1;v1=u1+w1*3;E1=(w1!==(0|(s1+d1)));if(E1){z1=(w1+1-s1);C1=(s1+d1-w1-1);}I1=G1[r1];J1=G1[r1+1];K1=G1[r1+2];if(!E1&&!F1){H1[v1]+=I1*m1;H1[v1+1]+=J1*m1;H1[v1+2]+=K1*m1;}else if(!E1&&F1){y1=A1*d1;H1[v1]+=I1*y1;H1[v1+1]+=J1*y1;H1[v1+2]+=K1*y1;B1=D1*d1;H1[v1+3*n1]+=I1*B1;H1[v1+3*n1+1]+=J1*B1;H1[v1+3*n1+2]+=K1*B1;}else if(E1&&!F1){y1=z1*d1;H1[v1]+=I1*y1;H1[v1+1]+=J1*y1;H1[v1+2]+=K1*y1;B1=C1*d1;H1[v1+3]+=I1*B1;H1[v1+4]+=J1*B1;H1[v1+5]+=K1*B1;}else{y1=z1*A1;H1[v1]+=I1*y1;H1[v1+1]+=J1*y1;H1[v1+2]+=K1*y1;B1=C1*A1;H1[v1+3]+=I1*B1;H1[v1+4]+=J1*B1;H1[v1+5]+=K1*B1;B1=z1*D1;H1[v1+3*n1]+=I1*B1;H1[v1+3*n1+1]+=J1*B1;H1[v1+3*n1+2]+=K1*B1;B1=C1*D1;H1[v1+3*n1+3]+=I1*B1;H1[v1+3*n1+4]+=J1*B1;H1[v1+3*n1+5]+=K1*B1;}}}var L1=document.createElement('canvas');L1.width=n1;L1.height=o1;var M1=L1.getContext('2d');var N1=M1.getImageData(0,0,n1,o1);var O1=N1.data;var P1=0;for(r1=0,v1=0;P1<n1*o1;r1+=3,v1+=4,P1++){O1[v1]=0|(H1[r1]);O1[v1+1]=0|(H1[r1+1]);O1[v1+2]=0|(H1[r1+2]);O1[v1+3]=255;}n.putImageData(N1,i1,j1);return;};function c1(i){while(i.firstChild){i.removeChild(i.firstChild);}}U.prototype._createPreviewErrorMessageStrip=function(i){return new l({text:this._oRb.getText(i?"GNT_PRNTG_ERROR_TOOHIGHCHART":"GNT_PRNTG_ERROR_BIGCHART"),showIcon:true,type:"Error"});};U.prototype._updateDialogPreviewCanvas=function(){var i=this._oHTMLDialogPreview.$().find(".sapGanttPrintingPreviewPageDiv");var n=i[0];if(this._oGanttCanvas){this._oButtonExport.setEnabled(true);var d1=this._oModel.getProperty("/multiplePage");if(d1){this._oModel.setProperty("/qualityWarning",false);this._oModel.setProperty("/showOrientationMessage",false);}var e1=this._getCanvasOfPageN(d1?this._oModel.getProperty("/previewPageNumber"):1,false);c1(n);this._resizePrintingPreviewPage();n.appendChild(e1);}else if(!this._oGanttCanvas&&(this._oClonedGanttDiv.offsetWidth>Y||this._oClonedGanttDiv.offsetHeight>Y)){this._oButtonExport.setEnabled(false);this._resizePrintingPreviewPage();this._oModel.setProperty("/qualityWarning",false);this._oModel.setProperty("/showOrientationMessage",false);if(!this._oHTMLDialogPreview.$().find("#"+this.getId()+"-previewErrorMessageStrip").length){c1(n);if(!this._oPreviewErrorMessageStrip){this._oPreviewErrorMessageStrip=this._createPreviewErrorMessageStrip(this._oClonedGanttDiv.offsetHeight>Y);}var f1=document.createElement("div");f1.id=this.getId()+"-previewErrorMessageStrip";f1.style.width="80%";n.appendChild(f1);this._oPreviewErrorMessageStrip.placeAt(this.getId()+"-previewErrorMessageStrip");}}else{throw new Error("Gantt chart canvas does not exist.");}i.addClass("sapGanttPrintingPreviewPageDivBorder");};U.prototype._updateDialogPreview=function(){this._updateLastPageNumber();this._updatePageNumberButtons();this._updateDialogPreviewCanvas();};U.prototype._setStylesToDom=function(n){function d1(f1){var g1=getComputedStyle(f1);var i,h1,i1,j1;var k1=["height","width","min-height","min-width"];var l1="";for(i=0,h1=g1.length;i<h1;i++){i1=g1[i];if(!((f1 instanceof SVGElement)&&k1.indexOf(i1)>=0)){j1=g1.getPropertyValue(i1);l1+=i1+":"+j1+";";}}f1.style=l1;}function e1(i){d1(i);f1(i);function f1(g1){if(g1&&g1.hasChildNodes()){var h1=g1.firstChild;while(h1){if(h1.nodeType===1&&h1.nodeName!="SCRIPT"){d1(h1);f1(h1);}h1=h1.nextSibling;}}}}e1(n);};U.prototype._setStyleToGanttChartSvg=function(i){var n=i.$().find("svg.sapGanttChartSvg")[0];var d1=i.$().find("svg.sapGanttChartHeaderSvg")[0];if(n){this._setStylesToDom(n);}if(d1){this._setStylesToDom(d1);}};U.prototype._getHorizonDates=function(i){var n=i.getStartTime();var d1=i.getEndTime();return{"startTime":new Date(q.abapTimestampToDate(n)),"endTime":new Date(q.abapTimestampToDate(d1))};};U.prototype._horizonWidthInSec=function(i){if(i&&i.startTime&&i.endTime){return i.endTime.getTime()-i.startTime.getTime();}return 0;};U.prototype._pageToBeExported=function(){if(!this._oModel.getProperty("/multiplePage")){return[1];}var n=this._oModel.getProperty("/lastPageNumber"),d1=this._oModel.getProperty("/exportAll"),e1=[];if(d1){for(var i=1;i<=n;i++){e1.push(i);}return e1;}else{var f1=this._oModel.getProperty("/exportRange");f1=f1.replace(/\s/g,"");var g1=N.getIntegerInstance();var h1=f1.split(",");h1.forEach(function(i1){if(i1.indexOf("-")!==-1){var j1=i1.split("-");var k1=g1.parse(j1[0]);var l1=g1.parse(j1[1]);for(var i=k1;i<=l1;i++){e1.push(i);}}else{e1.push(g1.parse(i1));}});return e1;}};U.prototype._validateFields=function(){var i=true;i&=this._validateExportRangeInput();i&=(this._oInputMarginTop.getValueState()!=="Error");i&=(this._oInputMarginRight.getValueState()!=="Error");i&=(this._oInputMarginBottom.getValueState()!=="Error");i&=(this._oInputMarginLeft.getValueState()!=="Error");return i;};U.prototype._savePdf=function(){if(!this._validateFields()){return;}var n=this._oModel.getProperty("/portrait")?"p":"l",d1=this._oModel.getProperty("/paperWidth"),e1=this._oModel.getProperty("/paperHeight"),f1=this._oModel.getProperty("/exportAsJPEG"),g1=this._oModel.getProperty("/compressionQuality")/100,h1=this._oModel.getProperty("/paperSize");var i1=new A({orientation:n,unit:"px",format:h1==="Custom"?[d1*0.75,e1*0.75]:h1.toLowerCase()});var j1=this._pageToBeExported();for(var i=0;i<j1.length;i++){var k1=this._getCanvasOfPageN(j1[i],true);if(!k1){continue;}if(i!==0){i1.addPage();}if(f1){i1.addImage(k1.toDataURL("image/jpeg",g1),"JPEG",0,0);}else{i1.addImage(k1.toDataURL("image/png"),"PNG",0,0);}}var l1=new Date();i1.save("GanttChartExport-"+l1.toISOString()+".pdf");};U.prototype._createPaperComboBox=function(){this._oComboBoxPaperSizes=new c({selectedKey:"{setting>/paperSize}",change:this._updatePaperSizeValues.bind(this),items:[new u({key:"A5",text:"A5"}),new u({key:"A4",text:"A4"}),new u({key:"A3",text:"A3"}),new u({key:"A2",text:"A2"}),new u({key:"A1",text:"A1"}),new u({key:"A0",text:"A0"}),new u({key:"Letter",text:"Letter"}),new u({key:"Legal",text:"Legal"}),new u({key:"Tabloid",text:"Tabloid"}),new u({key:"Custom",text:"Custom"})]});return this._oComboBoxPaperSizes;};U.prototype._createPaperSizeFields=function(){this._oInputPaperWidth=new I({width:"20%",type:"Number",change:this._onChangePaperSizeInput.bind(this)});this._oInputPaperHeight=new I({width:"20%",type:"Number",change:this._onChangePaperSizeInput.bind(this)});this._updatePaperSizeInputs();return new F({renderType:"Bare",alignItems:"Center",justifyContent:"SpaceBetween",items:[this._oInputPaperWidth,new T({text:"Ã—"}),this._oInputPaperHeight,this._oComboBoxUnit=new c({width:"50%",selectedKey:"{setting>/unit}",change:this._onChangeUnitComboBox.bind(this),items:[new u({key:"mm",text:this._oRb.getText("GNT_PRNTG_MILLIMETERS")}),new u({key:"cm",text:this._oRb.getText("GNT_PRNTG_CENTIMETERS")}),new u({key:"in",text:this._oRb.getText("GNT_PRNTG_INCHES")})]})]});};U.prototype._createDurationComboBox=function(){var i=this._getOriginalGanttChart().getAxisTimeStrategy(),n=i.getTotalHorizon(),d1=new Date(q.abapTimestampToDate(n.getEndTime())),e1=new Date();this._oComboBoxDuration=new c({selectedKey:"{setting>/duration}",change:this._onChangeDurationComboBox.bind(this),items:[new u({key:"all",text:this._oRb.getText("GNT_PRNTG_DURATION_ALL")}),new u({key:"week",enabled:this._getFirstDayOfNextWeek(e1).getTime()<d1.getTime(),text:this._oRb.getText("GNT_PRNTG_DURATION_NEXT_WEEK")}),new u({key:"month",enabled:this._getFirstDayOfNextMonth(e1).getTime()<d1.getTime(),text:this._oRb.getText("GNT_PRNTG_DURATION_NEXT_MONTH")}),new u({key:"custom",text:this._oRb.getText("GNT_PRNTG_DURATION_CUSTOM")})]});return this._oComboBoxDuration;};U.prototype._createDatePicker=function(){var i=this._getOriginalGanttChart().getAxisTimeStrategy();var n=i.getTotalHorizon();var d1=new Date(q.abapTimestampToDate(n.getStartTime()));var e1=new Date(q.abapTimestampToDate(n.getEndTime()));this._oModel.setProperty("/startDate",d1);this._oModel.setProperty("/endDate",e1);this._oDatePickerFrom=new j({width:"47%",minDate:d1,maxDate:"{setting>/endDate}",dateValue:"{setting>/startDate}",change:this._onChangeDurationDatePicker.bind(this),enabled:true});this._oDatePickerTo=new j({width:"47%",minDate:"{setting>/startDate}",maxDate:e1,dateValue:"{setting>/endDate}",change:this._onChangeDurationDatePicker.bind(this),enabled:true});return new F({renderType:"Bare",alignItems:"Center",justifyContent:"SpaceBetween",items:[this._oDatePickerFrom,new T({text:"~"}),this._oDatePickerTo]});};U.prototype._createScale=function(){return new f({min:50,max:200,step:1,width:"25rem",value:"{setting>/scale}",visible:"{setting>/multiplePage}",liveChange:this._updateDialogPreview.bind(this),showAdvancedTooltip:true,inputsAsTooltips:true});};U.prototype._validateExportRangeInput=function(){if(this._oModel.getProperty("/exportAll")){return true;}var i=this._oModel.getProperty("/exportRange").replace(/\s/g,"");if(/^((\d+),|(\d+-\d+),)*((\d+)|(\d+-\d+))+$/.test(i)){this._oInputRange.setValueState("None");return true;}this._oInputRange.setValueState("Error");this._oInputRange.setValueStateText(this._oRb.getText("GNT_PRNTG_PAGE_RANGE_ERROR"));return false;};U.prototype._createPageRange=function(){var i=function(n){var d1=n.getSource().getSelectedIndex();if(d1===0){this._oButtonExport.setEnabled(true);this._oInputRange.setValueState("None");}};return new F({renderType:"Bare",alignItems:"Center",visible:"{setting>/multiplePage}",justifyContent:"SpaceBetween",items:[new d({layoutData:new b({shrinkFactor:0,growFactor:1}),selectedIndex:this._oModel.getProperty("/exportAll")?0:1,columns:2,select:i.bind(this),buttons:[new R({id:"all",text:this._oRb.getText("GNT_PRNTG_PAGE_RANGE_ALL"),selected:"{setting>/exportAll}"}),new R({id:"range",text:this._oRb.getText("GNT_PRNTG_PAGE_RANGE_RANGE")+" "})]}),this._oInputRange=new I({layoutData:new b({growFactor:1}),value:"{setting>/exportRange}",change:this._validateExportRangeInput.bind(this),enabled:{path:"setting>/exportAll",formatter:function(n){return!n;}}}).addStyleClass("sapGanttPrintingPageRangeInput")]});};U.prototype._createLabelWithSwitch=function(i,n){return new F({renderType:"Bare",visible:"{setting>/multiplePage}",alignItems:"Center",items:[new L({text:i}),new m({state:n,change:this._updateDialogPreview.bind(this)}).addStyleClass("sapGanttPrintingSwitchPadding")]});};U.prototype._createCheckBoxWithInput=function(i,n,d1){return new F({renderType:"Bare",alignItems:"Start",justifyContent:"SpaceBetween",items:[new e({selected:n,text:i,select:this._updateDialogPreview.bind(this)}),new I({width:"65%",value:d1,enabled:n,change:this._updateDialogPreview.bind(this)})]});};U.prototype._createPanel=function(i,n){return new o({expandable:true,expanded:false,headerText:i,content:[new F({renderType:"Bare",direction:O.Column,items:[n]})]});};U.prototype._createCompressionSlider=function(){return new f({min:1,max:100,step:1,change:this._onChangeCompressionSlider.bind(this),value:{path:"setting>/compressionQuality",type:"sap.ui.model.type.Integer"},visible:"{setting>/exportAsJPEG}",showAdvancedTooltip:true,inputsAsTooltips:true});};U.prototype._createCompressionComboBox=function(){this._oComboBoxCompression=new c({visible:"{setting>/exportAsJPEG}",change:this._onChangeCompressionComboBox.bind(this),items:[new u({key:"maximum",text:this._oRb.getText("GNT_PRNTG_COMPRESSION_MAXIMUM")}),new u({key:"high",text:this._oRb.getText("GNT_PRNTG_COMPRESSION_HIGH")}),new u({key:"medium",text:this._oRb.getText("GNT_PRNTG_COMPRESSION_MEDIUM")}),new u({key:"low",text:this._oRb.getText("GNT_PRNTG_COMPRESSION_LOW")})]});var i=this._oModel.getProperty("/compressionQuality");this._setCompressionComboBoxItem(i);return this._oComboBoxCompression;};U.prototype._updateInputsStep=function(i){var n=0.1;if(i==="mm"){n=1;}return n;};U.prototype._createMargin=function(){function i(n){return Math.round(this._convertPxToUnit(n/3));}return[new L({text:this._oRb.getText("GNT_PRNTG_MARGIN")+":"}),new c({change:this._onChangeMarginComboBox.bind(this),selectedKey:"{setting>/marginType}",items:[new u({key:"default",text:this._oRb.getText("GNT_PRNTG_MARGIN_DEFAULT")}),new u({key:"none",text:this._oRb.getText("GNT_PRNTG_MARGIN_NONE")}),new u({key:"custom",text:this._oRb.getText("GNT_PRNTG_MARGIN_CUSTOM")})]}),new F({renderType:"Bare",alignItems:"Center",visible:{path:"setting>/marginType",formatter:function(n){return n==="custom";}},items:[new F({direction:O.Column,layoutData:new b({shrinkFactor:0,growFactor:0,baseSize:"8rem"}),items:[new L({text:this._oRb.getText("GNT_PRNTG_MARGIN_TOP")}),this._oInputMarginTop=new h({min:0,step:{path:"setting>/unit",formatter:this._updateInputsStep},displayValuePrecision:1,change:this._onChangeMarginInput.bind(this),value:this._convertPxToUnit(this._oModel.getProperty("/marginTop")),fieldWidth:"7rem",validationMode:"LiveChange",valueStateText:this._oRb.getText("GNT_PRNTG_MARGIN_HEIGHT_ERROR"),max:{parts:[{path:"setting>/paperHeight"},{path:"setting>/unit"}],formatter:i.bind(this)},description:"{setting>/unit}"}).addStyleClass("sapGanttPrintingBottomMargin"),new L({text:this._oRb.getText("GNT_PRNTG_MARGIN_LEFT")}),this._oInputMarginLeft=new h({min:0,step:{path:"setting>/unit",formatter:this._updateInputsStep},displayValuePrecision:1,change:this._onChangeMarginInput.bind(this),value:this._convertPxToUnit(this._oModel.getProperty("/marginLeft")),fieldWidth:"7rem",validationMode:"LiveChange",valueStateText:this._oRb.getText("GNT_PRNTG_MARGIN_WIDTH_ERROR"),max:{parts:[{path:"setting>/paperWidth"},{path:"setting>/unit"}],formatter:i.bind(this)},description:"{setting>/unit}"})]}),new F({direction:O.Column,layoutData:new b({shrinkFactor:0,growFactor:0,baseSize:"8rem"}),items:[new L({text:this._oRb.getText("GNT_PRNTG_MARGIN_BOTTOM")}),this._oInputMarginBottom=new h({min:0,step:{path:"setting>/unit",formatter:this._updateInputsStep},displayValuePrecision:1,change:this._onChangeMarginInput.bind(this),value:this._convertPxToUnit(this._oModel.getProperty("/marginBottom")),fieldWidth:"7rem",validationMode:"LiveChange",valueStateText:this._oRb.getText("GNT_PRNTG_MARGIN_HEIGHT_ERROR"),max:{parts:[{path:"setting>/paperHeight"},{path:"setting>/unit"}],formatter:i.bind(this)},description:"{setting>/unit}"}).addStyleClass("sapGanttPrintingBottomMargin"),new L({text:this._oRb.getText("GNT_PRNTG_MARGIN_RIGHT")}),this._oInputMarginRight=new h({min:0,step:{path:"setting>/unit",formatter:this._updateInputsStep},displayValuePrecision:1,change:this._onChangeMarginInput.bind(this),value:this._convertPxToUnit(this._oModel.getProperty("/marginRight")),fieldWidth:"7rem",validationMode:"LiveChange",valueStateText:this._oRb.getText("GNT_PRNTG_MARGIN_WIDTH_ERROR"),max:{parts:[{path:"setting>/paperWidth"},{path:"setting>/unit"}],formatter:i.bind(this)},description:"{setting>/unit}"})]}).addStyleClass("sapGanttPrintingLeftMargin"),new B({icon:{path:"setting>/marginLocked",formatter:function(n){if(n){return"sap-icon://chain-link";}return"sap-icon://broken-link";}},press:function(){var n=this._oModel.getProperty("/marginLocked");this._oModel.setProperty("/marginLocked",!n);}.bind(this),type:"Transparent"}).addStyleClass("sapGanttPrintingLockButton sapGanttPrintingLeftMargin")]}).addStyleClass("sapGanttPrintingTopMargin sapGanttPrintingTopMargin")];};U.prototype._createCropMarks=function(){return[new m({state:"{setting>/cropMarks}"}),new F({renderType:"Bare",visible:"{setting>/cropMarks}",items:[new F({direction:O.Column,layoutData:new b({shrinkFactor:0,growFactor:0,baseSize:"8rem"}),items:[new L({text:"Weight:"}),new h({min:0,step:0.05,displayValuePrecision:2,value:"{setting>/cropMarksWeight}",fieldWidth:"7rem",description:"pt"})]}),new F({direction:O.Column,layoutData:new b({shrinkFactor:0,growFactor:0,baseSize:"8rem"}),items:[new L({text:"Offset:"}),this._oInputCropMarksOffset=new h({min:0,step:{path:"setting>/unit",formatter:this._updateInputsStep},displayValuePrecision:1,change:this._onChangeCropMarksInput.bind(this),value:this._convertPxToUnit(this._oModel.getProperty("/cropMarksOffset")),fieldWidth:"7rem",description:"{setting>/unit}"})]}).addStyleClass("sapGanttPrintingLeftMargin")]}).addStyleClass("sapGanttPrintingTopMargin")];};U.prototype._createCompression=function(){var i=this._oModel.getProperty("/exportAsJPEG");return[new L({text:this._oRb.getText("GNT_PRNTG_EXPORT_TYPES")}),new d({columns:2,selectedIndex:i?0:1,buttons:[new R({id:"jpeg",text:"JPEG",selected:"{setting>/exportAsJPEG}"}),new R({id:"png",text:"PNG"})]}).addStyleClass("sapGanttPrintingBottomMargin"),new L({text:this._oRb.getText("GNT_PRNTG_COMPRESSION_QUALITY"),visible:"{setting>/exportAsJPEG}"}),this._createCompressionComboBox(),this._createCompressionSlider().addStyleClass("sapGanttPrintingTopMargin sapGanttPrintingBottomMargin"),new l({text:this._oRb.getText("GNT_PRNTG_COMPRESSION_PNG_WARNING"),showIcon:true,type:"Warning",visible:{path:"setting>/exportAsJPEG",type:"sap.ui.model.type.Boolean",formatter:function(i){return!i;}}}).addStyleClass("sapGanttPrintingBottomMargin")];};U.prototype._createOptionsForm=function(){return new F({renderType:"Bare",direction:O.Column,items:[new L({text:this._oRb.getText("GNT_PRNTG_EXPORT_TYPES")}),this._radioGroupPage=new d({columns:2,selectedIndex:this._oModel.getProperty("/multiplePage")?0:1,select:this._onChangeExportTypes.bind(this),buttons:[new R({id:"Multiple",text:this._oRb.getText("GNT_PRNTG_MULTIPLE_PAGE"),selected:"{setting>/multiplePage}"}),new R({id:"Single",text:this._oRb.getText("GNT_PRNTG_SINGLE_PAGE")})]}).addStyleClass("sapGanttPrintingBottomMargin"),new L({text:this._oRb.getText("GNT_PRNTG_ORIENTATION")}),this._radioGroupOrientation=new d({columns:2,selectedIndex:this._oModel.getProperty("/portrait")?0:1,select:this._onChangeOrientation.bind(this),buttons:[new R({id:"Portrait",text:this._oRb.getText("GNT_PRNTG_PORTRAIT"),selected:"{setting>/portrait}"}),new R({id:"Landscape",text:this._oRb.getText("GNT_PRNTG_LANDSCAPE")})]}).addStyleClass("sapGanttPrintingBottomMargin"),new l({text:"{setting>/orientationMessage}",type:"Information",showIcon:true,visible:"{setting>/showOrientationMessage}"}).addStyleClass("sapGanttPrintingSinglePageMessage"),new L({text:this._oRb.getText("GNT_PRNTG_PAPER_SIZE")}),this._createPaperComboBox(),this._createPaperSizeFields().addStyleClass("sapGanttPrintingBottomMargin"),new l({text:this._oRb.getText("GNT_PRNTG_SINGLE_PAGE_QUALITY"),type:"Information",showIcon:true,visible:"{setting>/qualityWarning}"}).addStyleClass("sapGanttPrintingSinglePageMessage"),new L({text:this._oRb.getText("GNT_PRNTG_DURATION")}),this._createDurationComboBox(),this._createDatePicker().addStyleClass("sapGanttPrintingBottomMargin"),new L({text:this._oRb.getText("GNT_PRNTG_SCALE"),visible:"{setting>/multiplePage}"}),this._createScale().addStyleClass("sapGanttPrintingBottomMargin"),new L({text:this._oRb.getText("GNT_PRNTG_PAGE_RANGE"),visible:"{setting>/multiplePage}"}),this._createPageRange().addStyleClass("sapGanttPrintingBottomMargin"),new L({text:this._oRb.getText("GNT_PRNTG_HEADER_AND_FOOTER")}),this._createCheckBoxWithInput(this._oRb.getText("GNT_PRNTG_HEADER"),"{setting>/showHeaderText}","{setting>/headerText}"),this._createCheckBoxWithInput(this._oRb.getText("GNT_PRNTG_FOOTER"),"{setting>/showFooterText}","{setting>/footerText}").addStyleClass("sapGanttPrintingBottomMargin"),this._createLabelWithSwitch(this._oRb.getText("GNT_PRNTG_SHOW_PAGE_NUMBER"),"{setting>/showPageNumber}").addStyleClass("sapGanttPrintingBottomMargin"),this._createPanel(this._oRb.getText("GNT_PRNTG_MARGIN"),this._createMargin()),this._createPanel(this._oRb.getText("GNT_PRNTG_COMPRESSION"),this._createCompression())]});};U.prototype._createDialogContent=function(){var i=new F({renderType:"Bare",fitContainer:true,items:[this._oFlexBoxPreview=new F({renderType:"Bare",layoutData:new b({shrinkFactor:1,growFactor:1,baseSize:"auto"}),direction:O.Column,items:[new F({renderType:"Bare",layoutData:new b({shrinkFactor:0,growFactor:0,baseSize:"3.5rem"})}),this._oHTMLDialogPreview=new H({content:"<div class=\"sapGanttPrintingPreviewContentDiv\"><div class=\"sapGanttPrintingPreviewPageDiv\"></div></div>"}),new F({renderType:"Bare",justifyContent:"Center",alignItems:"Center",layoutData:new b({shrinkFactor:0,growFactor:0,baseSize:"6rem"}),items:[this._oButtonFirst=new B({icon:"sap-icon://close-command-field",visible:"{setting>/multiplePage}",press:this._onPressButtonFirst.bind(this),type:"Transparent"}).addStyleClass("sapGanttPrintingPreviewIconMarginRight"),this._oButtonPrevious=new B({icon:"sap-icon://navigation-left-arrow",visible:"{setting>/multiplePage}",press:this._onPressButtonPrevious.bind(this),type:"Transparent"}),new T({textAlign:"Center",visible:"{setting>/multiplePage}",width:"7.25rem",text:{parts:[{path:"setting>/previewPageNumber"},{path:"setting>/lastPageNumber"}],formatter:function(n,d1){return d1?this._oRb.getText("GNT_PRNTG_OF",[n,d1]):n.toString();}.bind(this)}}).addStyleClass("sapGanttPrintingPreviewText"),this._oButtonNext=new B({icon:"sap-icon://navigation-right-arrow",visible:"{setting>/multiplePage}",press:this._onPressButtonNext.bind(this),type:"Transparent"}).addStyleClass("sapGanttPrintingPreviewIconMarginRight"),this._oButtonLast=new B({icon:"sap-icon://open-command-field",visible:"{setting>/multiplePage}",press:this._onPressButtonLast.bind(this),type:"Transparent"})]}).addStyleClass("sapGanttPrintingPreviewFooter")]}).addStyleClass("sapGanttPrintingPreviewContent"),new S({horizontal:false,vertical:true,layoutData:new b({shrinkFactor:0,growFactor:0,baseSize:"27rem"}),content:[this._createOptionsForm().addStyleClass("sapGanttPrintingDialogSettings")]})]});this._updatePageNumberButtons();return i;};U.prototype._createAndOpenDialog=function(){this._oDialog=new D({title:this._oRb.getText("GNT_PRNTG_PDF_EXPORT_TITLE"),contentWidth:"100%",contentHeight:"100%",horizontalScrolling:false,verticalScrolling:false,content:[this._createDialogContent()],buttons:[this._oButtonExport=new B({text:this._oRb.getText("GNT_PRNTG_EXPORT"),type:M.ButtonType.Emphasized,press:this.export.bind(this)}),this._oButtonClose=new B({text:this._oRb.getText("GNT_PRNTG_CANCEL"),press:function(){this.close();}.bind(this)})]}).addStyleClass("sapGanttPrintingDialog");this._oDialog.onsapescape=function(i){this.close();i.preventDefault();i.stopPropagation();}.bind(this);this._oDialog.setModel(this._oModel,"setting");this._oDialog.open();this._sResizeHandlerId=z.register(this._oDialog,this._onResize.bind(this));};U.prototype._openProgressDialog=function(){this._oProgressIndicator=new P({state:"Information",percentValue:0});this._oProgressText=new T({text:this._oRb.getText("GNT_PRNTG_PDF_PREVIEW"),textAlign:"Center"}).addStyleClass("sapGanttPrintingProgressText");this._oProgressIndicatorBox=new F(this.getId()+"-progressFlexBox",{direction:"Column",alignItems:"Center",items:[this._oProgressText,this._oProgressIndicator],renderType:"Bare"}).addStyleClass("sapGanttPrintingProgressBox");this._oProgressDialog=new D(this.getId()+"-progressDialog",{contentWidth:"25%",showHeader:false,content:[this._oProgressIndicatorBox],buttons:[new B({text:this._oRb.getText("GNT_PRNTG_CANCEL"),press:function(){this._closeProgressIndicator();}.bind(this)})]});this._oProgressDialog.open();};return U;});
