sap.ui.define(["sap/ui/core/Core","sap/gantt/library","sap/ui/base/ManagedObjectObserver","sap/ui/core/Item","sap/ui/base/Object","sap/base/Log","sap/m/library","sap/m/OverflowToolbar","sap/m/OverflowToolbarLayoutData","sap/m/ToolbarSpacer","sap/m/FlexBox","sap/m/OverflowToolbarButton","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","sap/m/Select","sap/m/ViewSettingsDialog","sap/m/ViewSettingsCustomTab","sap/m/CheckBox","sap/m/Slider","sap/m/Popover","../control/AssociateContainer","sap/ui/fl/variants/VariantManagement","sap/ui/fl/apply/api/ControlVariantApplyAPI","./ContainerToolbarRenderer"],function(C,l,M,a,B,L,m,O,b,T,F,c,S,d,e,V,f,g,h,P,A,k,n){"use strict";var G=l.simple.GanttChartWithTableDisplayType,p=l.simple.ContainerToolbarPlaceholderType,q=m.OverflowToolbarPriority,r=m.FlexDirection,s=m.ButtonType,t=m.PlacementType;var u=O.extend("sap.gantt.simple.ContainerToolbar",{metadata:{library:"sap.gantt",properties:{showBirdEyeButton:{type:"boolean",defaultValue:false},showDisplayTypeButton:{type:"boolean",defaultValue:false},showLegendButton:{type:"boolean",defaultValue:false},showSettingButton:{type:"boolean",defaultValue:true},showTimeZoomControl:{type:"boolean",defaultValue:true},zoomControlType:{type:"sap.gantt.config.ZoomControlType",defaultValue:l.config.ZoomControlType.SliderWithButtons},stepCountOfSlider:{type:"int",defaultValue:10},infoOfSelectItems:{type:"object[]",defaultValue:[]},zoomLevel:{type:"int",defaultValue:0},alignCustomContentToRight:{type:"boolean",defaultValue:false}},aggregations:{settingItems:{type:"sap.gantt.config.SettingItem",multiple:true},legendContainer:{type:"sap.ui.core.Control",multiple:false,visibility:"public"}},events:{zoomStopChange:{parameters:{index:{type:"int"},selectedItem:{type:"sap.ui.core.Item"}}},birdEyeButtonPress:{},displayTypeChange:{parameters:{displayType:{type:"sap.gantt.simple.GanttChartWithTableDisplayType"}}}}}});u.prototype.init=function(){O.prototype.init.apply(this,arguments);this.mSettingsConfig={};this._oRb=C.getLibraryResourceBundle("sap.gantt");this.oObserver=new M(this.observeChanges.bind(this));this.oObserver.observe(this,{properties:["showBirdEyeButton","showLegendButton","showTimeZoomControl","showSettingButton","zoomControlType","infoOfSelectItems","showDisplayTypeButton","alignCustomContentToRight"],aggregations:["content"]});this.bShallUpdateContent=true;this.bZoomControlTypeChanged=false;this.bContentAlignChanged=false;this._bSuppressZoomStopChange=false;this.oToolbarSpacer=new T(this.getId()+"-toolbarSpacer");};u.prototype.observeChanges=function(o){if(!this.bShallUpdateContent){this.bShallUpdateContent=true;this.bZoomControlTypeChanged=o.name==="zoomControlType";this.bContentAlignChanged=o.name==="alignCustomContentToRight";}};u.prototype.exit=function(){this.oObserver.disconnect();this._destroyIfExists([this._oDisplayTypeSegmentedButton,this._oBirdEyeButton,this._oSelect,this._oTimeZoomFlexBox,this._oSettingsDialog,this._oSettingsButton,this._oLegendPop,this._oLegendButton,this._oVariantManagement]);O.prototype.exit.apply(this,arguments);};u.prototype.applySettings=function(i,j){i=i||{};if(!i.settingItems){i.settingItems=l.config.DEFAULT_TOOLBAR_SETTING_ITEMS.map(function(o){return o.clone();});}O.prototype.applySettings.apply(this,arguments);this._createControlsOnly();return this;};u.prototype._isParentGanttContainer=function(){var o=this.getParent();if(o&&o.isA("sap.gantt.simple.GanttChartContainer")){return true;}return false;};u.prototype.onBeforeRendering=function(){if(this.bShallUpdateContent===true){this.updateToolbarContents();this.bShallUpdateContent=false;this.bZoomControlTypeChanged=false;this.bContentAlignChanged=false;}};u.prototype.updateToolbarContents=function(){var i=this.getContent(),j={},o=0;var N=function(w){return this.getContent().indexOf(w)===-1;}.bind(this);var v=function(w,x,y){if(!w._getControl()){w._setControl(y);}w.setProperty("_show",x);};var I=function(w,x,y){var z=j[w],D=N(y);if(z){v(z,x,y);}else if(x){o++;}if(!D&&(z||!x)){this.removeContent(y);}else if(!z&&x&&D){if(w===p.VariantManagement){this.insertContent(y,0);var E=function(){var H=this.getParent();H.updateAxisTimeSettings();H.fireVariantApplied();};n.attachVariantApplied({selector:this.getParent(),vmControlId:this._oVariantManagement.getId(),callAfterInitialVariant:true,callback:E.bind(this)});}else if(w===p.Spacer){this.insertContent(y,this.getAlignCustomContentToRight()?0:this.getContent().length-o+1);}else{this.addContent(y);}}}.bind(this);i.forEach(function(w){var x;if(B.isA(w,"sap.gantt.simple.ContainerToolbarPlaceholder")){x=w.getType();if(j[x]){L.warning("There are more than one sap.gantt.simple.ContainerToolbarPlaceholder of the "+x+" type.");}j[x]=w;}});if(this.bContentAlignChanged){this.removeContent(this.oToolbarSpacer);}I(p.BirdEyeButton,this.getShowBirdEyeButton(),this._genBirdEyeButton());I(p.TimeZoomControl,this.getShowTimeZoomControl(),this._genTimeZoomFlexBox());I(p.LegendButton,this.getShowLegendButton(),this._genLegend());I(p.SettingButton,this.getShowSettingButton(),this._genSettings());I(p.DisplayTypeButton,this.getShowDisplayTypeButton(),this._genDisplayTypeButton());I(p.Spacer,true,this.oToolbarSpacer);I(p.VariantManagement,(this._isParentGanttContainer()&&this.getParent().getEnableVariantManagement()),this._genVariantManagement());};u.prototype._createControlsOnly=function(){this._genBirdEyeButton();this._genTimeZoomGroupControls();this._genLegend();this._genSettings();this._genDisplayTypeButton();};u.prototype._destroyIfExists=function(i){i.forEach(function(o){if(o){o.destroy();}});};u.prototype._genVariantManagement=function(){if(this._oVariantManagement==null){this._oVariantManagement=new k({"id":this.getId()+"-variantManagement","for":[this.getParent()],"executeOnSelectionForStandardDefault":true}).addStyleClass("sapUiCompVarMngmt").addStyleClass("sapMBarChild").addStyleClass("sapUiCompSmartTableToolbarContent");}return this._oVariantManagement;};u.prototype._genDisplayTypeButton=function(){if(this._oDisplayTypeSegmentedButton){return this._oDisplayTypeSegmentedButton;}this._oDisplayTypeSegmentedButton=new S(this.getId()+"-displayTypeSegmentedButton",{selectedKey:G.Both,selectionChange:function(E){this.fireDisplayTypeChange({displayType:E.getParameter("item").getKey()});}.bind(this),items:[new d(this.getId()+"-"+G.Both+"SegmentedButtonItem",{tooltip:this._oRb.getText("TLTP_DISPLAY_TYPE_BUTTON_BOTH"),icon:"sap-icon://Chart-Tree-Map",key:G.Both}),new d(this.getId()+"-"+G.Chart+"SegmentedButtonItem",{tooltip:this._oRb.getText("TLTP_DISPLAY_TYPE_BUTTON_CHART"),icon:"sap-icon://along-stacked-chart",key:G.Chart}),new d(this.getId()+"-"+G.Table+"SegmentedButtonItem",{tooltip:this._oRb.getText("TLTP_DISPLAY_TYPE_BUTTON_TABLE"),icon:"sap-icon://table-view",key:G.Table})]});};u.prototype._genBirdEyeButton=function(){if(this._oBirdEyeButton==null){var i=function(R){var j=R.getText("TXT_BRIDEYE"),o=R.getText("TXT_BRIDEYE_RANGE_VISIBLE_ROWS"),v=R.getText("TLTP_BRIDEYE_ON_VISIBLE_ROWS");return j+" ("+o+"): "+v;};this._oBirdEyeButton=new c(this.getId()+"-birdEyeButton",{icon:"sap-icon://show",type:s.Transparent,text:this._oRb.getText("TXT_BIRDEYE_BUTTON"),tooltip:i(this._oRb),press:this.fireBirdEyeButtonPress.bind(this)});}return this._oBirdEyeButton;};u.prototype._getSelectItems=function(){var j=[],I=this.getInfoOfSelectItems();if(I.length>0){if(I[0]instanceof a){j=I;}else{for(var i=0;i<I.length;i++){j.push(new a({key:I[i].key,text:I[i].text}));}}}return j;};u.prototype._genTimeZoomGroupControls=function(){var Z=l.config.ZoomControlType;var z=this.getZoomControlType();var U=function(o){clearTimeout(this._iLiveChangeTimer);this._iLiveChangeTimer=-1;this.setZoomLevel(o,true);};this.fireEvent("_zoomControlTypeChange",{zoomControlType:z});if(z===Z.None){return[];}if(z===Z.Select){if(this._oSelect){return[this._oSelect];}var i=this._getSelectItems();this._oSelect=new e(this.getId()+"-zoomSelect",{items:i,selectedItem:i[this.getZoomLevel()],change:function(E){var o=E.getSource();var v=o.getSelectedItem();var w=o.indexOfItem(v);this._iLiveChangeTimer=setTimeout(U.bind(this),200,[w,v]);}.bind(this)});return[this._oSelect];}else{if(this._oZoomSlider){this._oZoomSlider.setMax(this.getStepCountOfSlider()-1);if(z===Z.SliderOnly){return[this._oZoomSlider];}else if(z===Z.ButtonsOnly){return[this._oZoomOutButton,this._oZoomInButton];}else{return[this._oZoomOutButton,this._oZoomSlider,this._oZoomInButton];}}this._oZoomSlider=new h(this.getId()+"-zoomSlider",{width:"200px",max:this.getStepCountOfSlider()-1,value:this.getZoomLevel(),min:0,step:1,liveChange:function(E){var o=parseInt(E.getParameter("value"),10);clearTimeout(this._iLiveChangeTimer);this._iLiveChangeTimer=setTimeout(U.bind(this),200,o);}.bind(this)});var j=function(o){return function(E){this._iLiveChangeTimer=setTimeout(function(){var v=parseInt(o?this._oZoomSlider.stepUp(1).getValue():this._oZoomSlider.stepDown(1).getValue(),10);U.call(this,v);var w=this._oZoomSlider.getMax(),x=this._oZoomSlider.getMin();if(v===w){this._oZoomOutButton.focus();}else if(v===x){this._oZoomInButton.focus();}}.bind(this),200);};};this._oZoomInButton=new c(this.getId()+"-zoomInButton",{icon:"sap-icon://zoom-in",type:s.Transparent,tooltip:this._oRb.getText("TLTP_SLIDER_ZOOM_IN"),ariaDescribedBy:[this._oZoomSlider],press:j(true).bind(this)});this._oZoomOutButton=new c(this.getId()+"-zoomOutButton",{icon:"sap-icon://zoom-out",type:s.Transparent,tooltip:this._oRb.getText("TLTP_SLIDER_ZOOM_OUT"),ariaDescribedBy:[this._oZoomSlider],press:j(false).bind(this)});return[this._oZoomOutButton,this._oZoomSlider,this._oZoomInButton];}};u.prototype._genTimeZoomFlexBox=function(){if(this._oTimeZoomFlexBox){if(this.bZoomControlTypeChanged){this._oTimeZoomFlexBox.removeAllItems();this._genTimeZoomGroupControls().forEach(function(i){this._oTimeZoomFlexBox.addItem(i);}.bind(this));}return this._oTimeZoomFlexBox;}this._oTimeZoomFlexBox=new F(this.getId()+"-timeZoomFlexBox",{items:this._genTimeZoomGroupControls(),layoutData:new b({priority:q.NeverOverflow})});return this._oTimeZoomFlexBox;};u.prototype._genSettingItems=function(){return this.getSettingItems().map(function(o){var i=new g(this.getId()+"-"+o.getKey()+"CheckBox",{name:o.getKey(),text:o.getDisplayText(),tooltip:o.getTooltip(),selected:o.getChecked()}).addStyleClass("sapUiSettingBoxItem");i.isStandard=o.get_isStandard();return i;}.bind(this));};u.prototype._genSettings=function(){if(this._oSettingsButton){if(this._oSettingsBox&&(this._oSettingsBox.getItems().length===this.getSettingItems().length)){var o=this.getSettingItems();if(this._aOriginalSettings){var v={};var w={};o.forEach(function(E){if(!v[E.getKey()]){v[E.getKey()]=true;}});for(var j=this._aOriginalSettings.length-1;j>=0;j--){if(!v[this._aOriginalSettings[j].getKey()]){this._aOriginalSettings.splice(j,1);}else{w[this._aOriginalSettings[j].getKey()]=true;}}o.forEach(function(E){if(!w[E.getKey()]){this._aOriginalSettings.push(E.clone());}}.bind(this));}var x=this._oSettingsBox.getItems(),y=this._aOriginalSettings?this._aOriginalSettings:this.getSettingItems();for(var i=0;i<x.length;i++){var z=x[i],D=y[i];z.setName(D.getKey());z.setText(D.getDisplayText());z.setTooltip(D.getTooltip());z.setSelected(D.getChecked());}}else{this._oSettingsBox.destroyItems();this._genSettingItems().forEach(function(D){this._oSettingsBox.addItem(D);}.bind(this));}return this._oSettingsButton;}this._oSettingsBox=new F(this.getId()+"-settingsFlexBox",{direction:r.Column,items:this._genSettingItems()}).addStyleClass("sapUiSettingBox");this._oSettingsDialog=new V(this.getId()+"-settingsDialog",{title:this._oRb.getText("SETTINGS_DIALOG_TITLE"),customTabs:[new f({content:this._oSettingsBox})],confirm:function(){this._fireSettingItemChangedEvent();if(this._isParentGanttContainer()){this.getParent()._oSplitter.resetContentAreasSizes();}}.bind(this),cancel:function(){this.updateSettingItems(this.mSettingsConfig);}.bind(this),reset:function(){this._genSettings();}.bind(this)});this._oSettingsButton=new c(this.getId()+"-settingsButton",{icon:"sap-icon://action-settings",type:s.Transparent,text:this._oRb.getText("TXT_SETTING_BUTTON"),tooltip:this._oRb.getText("TXT_SETTING_BUTTON"),layoutData:new b({priority:q.High}),press:function(E){this._oSettingsDialog.open();}.bind(this)});return this._oSettingsButton;};u.prototype._genLegend=function(){if(this._oLegendButton){return this._oLegendButton;}if(!this._oLegendPop){this._oLegendPop=new P(this.getId()+"-legendPopover",{placement:t.Bottom,showArrow:false,showHeader:false});}this._oLegendButton=new c(this.getId()+"-legendButton",{icon:"sap-icon://legend",type:s.Transparent,text:this._oRb.getText("TXT_LEGEND_BUTTON"),tooltip:this._oRb.getText("TLTP_SHOW_LEGEND"),layoutData:new b({priority:q.High,closeOverflowOnInteraction:false}),press:function(E){var o=this._oLegendPop;if(o.isOpen()){o.close();}else{o.openBy(this._oLegendButton);}}.bind(this)});return this._oLegendButton;};u.prototype.updateZoomLevel=function(z){this._bSuppressZoomStopChange=true;this.setZoomLevel(z);};u.prototype.setZoomLevel=function(z,i){if(!isNaN(z)){var j=this.getZoomLevel();if(this._oZoomSlider&&this._oZoomOutButton&&this._oZoomInButton){var o=this._oZoomSlider.getMax(),v=this._oZoomSlider.getMin();if(z===o){this._oZoomInButton.setEnabled(false);this._oZoomOutButton.setEnabled(true);}else if(z===v){this._oZoomInButton.setEnabled(true);this._oZoomOutButton.setEnabled(false);}else{this._oZoomInButton.setEnabled(true);this._oZoomOutButton.setEnabled(true);}}if(j!==z){this.setProperty("zoomLevel",z,i);if(this._oZoomSlider){this._oZoomSlider.setValue(z);if(!this._bSuppressZoomStopChange){this.fireZoomStopChange({index:z});}}if(this._oSelect){this._oSelect.setSelectedItem(this._oSelect.getItems()[z]);if(!this._bSuppressZoomStopChange){this.fireZoomStopChange({index:z,selectedItem:this._oSelect.getSelectedItem()});}}}}this._bSuppressZoomStopChange=false;return this;};u.prototype.setLegendContainer=function(o){this.setAggregation("legendContainer",o);if(!this._oLegendPop){this._oLegendPop=new P(this.getId()+"-legendPopover",{placement:t.Bottom,showArrow:false,showHeader:false});}if(o){this._oLegendPop.removeAllContent();this._oLegendPop.addContent(new A({content:o}));}};u.prototype._fireSettingItemChangedEvent=function(){var j=this._oSettingsBox.getItems();var o=[];for(var i=0;i<j.length;i++){var v=j[i].getName(),w=v.substr(4),x="",N=j[i].getSelected();if(j[i].isStandard){x=this.mSettingsConfig[w];}else{x=this.mSettingsConfig[v];}if(x!==N){o.push({name:v,value:N,isStandard:j[i].isStandard});if(!j[i].isStandard){this.mSettingsConfig[v]=N;}}}if(o.length>0){this.fireEvent("_settingsChange",o);}};u.prototype.updateSettingsConfig=function(i,I){var j=this.getSettingItems();Object.keys(i).forEach(function(o){this.mSettingsConfig[o]=i[o];var v=j.filter(function(w){return w.getKey().endsWith(o);})[0];if(v){v.setChecked(i[o]);}}.bind(this));this.updateSettingItems(i);this._updateMSettingsConfigWithCustom(j);if(I&&!this._aOriginalSettings){this._aOriginalSettings=[];this.getSettingItems().forEach(function(o){this._aOriginalSettings.push(o.clone());}.bind(this));}};u.prototype.updateCustomSettingsConfig=function(){var o={};var i=this.getSettingItems();this._updateMSettingsConfigWithCustom(i,o);this.updateSettingItems(o);};u.prototype.updateCustomSettings=function(i){var j=this.getSettingItems();i.forEach(function(o){this.mSettingsConfig[o.name]=o.value;var v=j.filter(function(I){return I.getKey().endsWith(o.name);})[0];if(v){v.setChecked(o.value);}}.bind(this));};u.prototype._updateMSettingsConfigWithCustom=function(i,o){i.forEach(function(I){var K=I.getKey();var j=I.getChecked();if(!I.get_isStandard()&&this.mSettingsConfig[K]!==j){if(o){o[K]=j;}this.mSettingsConfig[K]=I.getChecked();}}.bind(this));};u.prototype.updateSettingItems=function(i){var j=this._oSettingsBox.getItems();Object.keys(i).forEach(function(o){var v=j.filter(function(I){return I.getName().endsWith(o);})[0];if(v){v.setSelected(i[o]);}});};u.prototype.getAllToolbarItems=function(){return this.getContent();};u.prototype.setInfoOfSelectItems=function(i,j){this.setProperty("infoOfSelectItems",i,j);var o=this;if(this._oSelect){var v=this._getSelectItems();this._oSelect.removeAllItems();v.forEach(function(w){o._oSelect.addItem(w);});}};return u;},true);
