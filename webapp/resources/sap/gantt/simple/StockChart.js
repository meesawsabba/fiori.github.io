/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/base/util/merge","./UtilizationChart"],function(m,U){"use strict";var S=U.extend("sap.gantt.simple.StockChart",{metadata:{library:"sap.gantt",properties:{showMiddleLine:{type:"boolean",defaultValue:true},minValue:{type:"float",group:"Misc",defaultValue:0},maxValue:{type:"float",group:"Misc",defaultValue:100}},defaultAggregation:"stockChartDimensions",aggregations:{stockChartDimensions:{type:"sap.gantt.simple.StockChartDimension",group:"Data"}}},renderer:{apiVersion:2}});S.prototype.applySettings=function(s,o){s=s||{};U.prototype.applySettings.call(this,s,o);};S.prototype.renderElement=function(r,e){if(this.getStockChartDimensions().length===0){this._renderEmptyDomRefs(r,true);return;}this._renderEmptyDomRefs(r,false);var x=this.getX(),h=this.getHeight(),y=this.getRowYCenter()-h/2,w=this.getWidth();var p={x:x,y:y,width:w,height:h};this._renderDimensionClipPaths(r,p);this._renderMiddleLine(r,p);this._renderDimensionPaths(r,p);this._renderTooltips(r,p);r.close("g");};S.prototype._renderEmptyDomRefs=function(r,c){r.openStart("g",this);r.class("sapGanttStock");r.openEnd();if(c){r.close("g");}};S.prototype._renderDimensionClipPaths=function(r,p){var d=this.getStockChartDimensions();r.openStart("defs").openEnd();for(var i=0;i<d.length;i++){r.openStart("clipPath",d[i].getId()+"-clipPath");r.openEnd();this.renderDimensionPath(r,d[i],p.y,p.height);r.close("clipPath");}r.close("defs");};S.prototype._renderMiddleLine=function(r,p){if(this.getShowMiddleLine()){var M=this._getMiddleLineY(p);r.openStart("path",this.getId()+"-middleLine");r.attr("d","M "+p.x+" "+M+" h "+p.width);r.class("sapGanttStockMiddleLine");r.openEnd().close("path");}};S.prototype._getMiddleLineY=function(p){var t=this._getThresholdHeight(p.height);return(p.y+t)+(p.height-t)/2;};S.prototype._getThresholdHeight=function(h){return(h)/(100);};S.prototype._getClipPathIdOfDimension=function(d){return"url(#"+d.getId()+"-clipPath)";};S.prototype._renderDimensionPaths=function(r,p){var x=p.x,y=p.y,w=p.width,h=p.height;var n=[];var P=[];var d=this.getStockChartDimensions();for(var I=0;I<d.length;I++){r.openStart("g").openEnd();var D=d[I];this.renderDimensionPath(r,D,y,h,"scPath");n=[];P=[];for(var i=0;i<D.getStockChartPeriods().length;i++){var o=D.getStockChartPeriods()[i];o.getValue()<D.getRelativePoint()?n.push(o):P.push(o);}var a=h;if(n.length>0&&P.length>0){for(var b=0;b<2;b++){var R=this._createTransform(D.getRelativePoint());var c=h*(R/(100));var e=a-c;var A={id:D.getId()+(b==1?"-scRectNegative":"-scRect"),x:x,y:(b==1?(y+e):y),width:w,height:(b==1?h-e:h-(h-e)),fill:(b==1?D.getRemainCapacityColorNegative():D.getRemainCapacityColor()),"fill-opacity":0.5,"stroke-opacity":0.5,"clip-path":this._getClipPathIdOfDimension(D)};this.renderRectangleWithAttributes(r,A);}}else if(P.length>0){var A={id:D.getId()+"-scRect",x:x,y:y,width:w,height:h,fill:D.getRemainCapacityColor(),"fill-opacity":0.5,"stroke-opacity":0.5,"clip-path":this._getClipPathIdOfDimension(D)};this.renderRectangleWithAttributes(r,A);}else if(n.length>0){var A={id:D.getId()+"-scRectNegative",x:x,y:y,width:w,height:h,fill:D.getRemainCapacityColorNegative(),"fill-opacity":0.5,"stroke-opacity":0.5,"clip-path":this._getClipPathIdOfDimension(D)};this.renderRectangleWithAttributes(r,A);}r.close("g");}};S.prototype._renderTooltips=function(r,p){var y=p.y,h=p.height;r.openStart("g");r.class("sc-tooltips").openEnd();var d=this.getAllDimensionPoints();d.forEach(function(P,i,a){var n=a[i+1]||P;var t=P.tooltip;var D=P.name!==n.name;if(D){t=P.tooltip+"\n"+n.tooltip;}var x=this.toX(P.from),l=a.length-1===i,X=this.toX(l?n.to:n.from),w=Math.abs(X-x);if(w>0){var b={opacity:0,fillOpacity:0,strokeOpacity:0};var A=m({x:x,y:y,width:w,height:h},b);this.renderRectangleWithAttributes(r,A,t);}}.bind(this));r.close("g");};S.prototype.getAllDimensionPoints=function(){var A=[];this.getStockChartDimensions().forEach(function(d){var n=d.getName();d.getStockChartPeriods().forEach(function(p,i,P){var t=p.getTooltip();if(!t){t=n+":"+p.getValue();}if(p.getFrom()!=p.getTo()){A.push({name:n,from:p.getFrom(),to:p.getFrom(),tooltip:t});A.push({name:n,from:p.getTo(),to:p.getTo(),tooltip:t});}else{A.push({name:n,from:p.getFrom(),to:p.getTo(),tooltip:t});}});});A.sort(function(a,b){return a.from-b.from;});return A;};S.prototype.renderDimensionPath=function(r,D,R,a,I){var p=D.getStockChartPeriods();var d="";for(var i=0;i<p.length;i++){var f=(i===0),l=(i===p.length-1);var P=p[i];var x=this.toX(P.getFrom());var b=this.toX(P.getTo());var v=P.getValue();if(v>(100)){v=100;}if(v<this.getMinValue()){v=this.getMinValue();}var y=R+a;var c=a*(this._createTransform(v)/(100));var e=y-c;var g=this._createTransform(D.getRelativePoint());var h=a*(g/(100));var j=y-h;d+=(f?" M "+x+" "+j:"")+" L "+x+" "+e+" L "+b+" "+e+(l?" L "+b+" "+j:"");}if(I){r.openStart("path",D.getId()+"-"+I);}else{r.openStart("path");}r.attr("d",d);r.attr("fill","none");r.attr("stroke-width",2);r.attr("stroke",D.getDimensionPathColor());r.class("sapGanttScDimensionPath");r.openEnd().close("path");};S.prototype._createTransform=function(v){var o={max:this.getMaxValue(),min:this.getMinValue()};var n={max:100,min:0};var s=(n.max-n.min)/(o.max-o.min);var a=(v-o.min)*s;return a;};S.prototype.destroy=function(){U.prototype.destroy.apply(this,arguments);};return S;},true);
