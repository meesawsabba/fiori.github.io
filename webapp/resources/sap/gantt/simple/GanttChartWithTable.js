/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/gantt/library","sap/ui/thirdparty/jquery","sap/base/assert","sap/base/Log","sap/ui/core/Control","sap/ui/model/ChangeReason","sap/base/util/values","sap/ui/layout/Splitter","sap/ui/layout/SplitterLayoutData","sap/ui/core/ResizeHandler","./InnerGanttChart","./GanttHeader","./GanttSyncedControl","../control/AssociateContainer","../axistime/ProportionZoomStrategy","./SelectionModel","./ExpandModel","./ShapeScheme","./GanttExtension","./GanttScrollExtension","./GanttZoomExtension","./GanttPointerExtension","./GanttDragDropExtension","./GanttPopoverExtension","./GanttConnectExtension","./GanttResizeExtension","./GanttLassoExtension","./GanttUtils","./RenderUtils","../misc/Format","../misc/Utility","../config/TimeHorizon","sap/ui/export/Spreadsheet","sap/m/OverflowToolbar",'sap/ui/core/Core','sap/base/util/uid','sap/m/Dialog','sap/m/Input','sap/m/Label','sap/m/VBox','sap/m/Button','sap/ui/model/json/JSONModel','sap/m/Menu','sap/m/MenuButton','sap/m/MenuItem',"sap/base/util/deepEqual","sap/ui/core/CustomData","sap/gantt/simple/GanttAdaptationData","sap/ui/fl/write/api/ControlPersonalizationWriteAPI","./GanttChartWithTableRenderer"],function(l,q,c,L,C,d,v,S,e,R,I,G,f,A,P,g,E,h,j,k,m,n,o,p,r,s,t,u,w,F,U,T,z,O,B,D,H,J,K,V,M,N,Q,W,X,Y,Z,$,_){"use strict";var a1=l.simple.GanttChartWithTableDisplayType,b1=l.simple.VisibleHorizonUpdateType,c1=l.simple.exportTableCustomDataType;var d1=Object.freeze({"totalHorizonUpdated":b1.TotalHorizonUpdated,"mouseWheelZoom":b1.MouseWheelZoom,"syncVisibleHorizon":b1.SyncVisibleHorizon,"initialRender":b1.InitialRender,"horizontalScroll":b1.HorizontalScroll,"zoomLevelChanged":b1.ZoomLevelChanged,"timePeriodZooming":b1.TimePeriodZooming});var e1=B.getLibraryResourceBundle("sap.gantt");var f1=10;var g1=60;function h1(a,b){return a+b;}function i1(a,b){return Math.abs(a-b)<f1;}var j1=C.extend("sap.gantt.simple.GanttChartWithTable",{metadata:{library:"sap.gantt",properties:{width:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},shapeSelectionMode:{type:"sap.gantt.SelectionMode",defaultValue:l.SelectionMode.MultiWithKeyboard},shapeOverRelationship:{type:"boolean",defaultValue:true},shapeSelectionSettings:{type:"object",defaultValue:null},enableCursorLine:{type:"boolean",defaultValue:true},enableNowLine:{type:"boolean",defaultValue:true},nowLineInUTC:{type:"boolean",defaultValue:true},enableVerticalLine:{type:"boolean",defaultValue:true},enableAdhocLine:{type:"boolean",defaultValue:true},adhocLineLayer:{type:"string",defaultValue:l.AdhocLineLayer.Top},enableDeltaLine:{type:"boolean",defaultValue:true},enableNonWorkingTime:{type:"boolean",defaultValue:true},enableChartDeltaAreaHighlight:{type:"boolean",defaultValue:true},deltaLineLayer:{type:"string",defaultValue:l.DeltaLineLayer.Bottom},datePattern:{type:"string",defaultValue:l.config.DEFAULT_DATE_PATTERN},timePattern:{type:"string",defaultValue:l.config.DEFAULT_TIME_PATTERN},enableExpandedRowBorders:{type:"boolean",defaultValue:true},enableExpandedRowBackground:{type:"boolean",defaultValue:true},expandedRowHeight:{type:"int"},dragOrientation:{type:"sap.gantt.DragOrientation",defaultValue:l.DragOrientation.Free},ghostAlignment:{type:"string",defaultValue:l.dragdrop.GhostAlignment.None},showShapeTimeOnDrag:{type:"boolean",defaultValue:false},selectionPanelSize:{type:"sap.ui.core.CSSSize",defaultValue:"30%"},displayType:{type:"sap.gantt.simple.GanttChartWithTableDisplayType",defaultValue:a1.Both},disableShapeDoubleClickEvent:{type:"boolean",defaultValue:false},showExportTableToExcel:{type:"boolean",defaultValue:false},enableSelectAndDrag:{type:"boolean",defaultValue:true},deltaAreaHighlightColor:{type:"string",defaultValue:"@sapUiListSelectionBackgroundColor"},enableLassoInvert:{type:"boolean",defaultValue:false},showParentRowOnExpand:{type:"boolean",defaultValue:true},printingBatchSize:{type:"int",defaultValue:100},showGanttHeader:{type:"boolean",defaultValue:true},_enableRTA:{type:'boolean',defaultValue:false},snapMode:{type:"sap.gantt.dragdrop.SnapMode",defaultValue:l.dragdrop.SnapMode.None},snapTimeInterval:{type:"object",defaultValue:{}},enableChartOverflowToolbar:{type:"boolean",defaultValue:false},enableChartSelectionState:{type:"boolean",defaultValue:true},enableChartHoverState:{type:"boolean",defaultValue:true},selectOnlyGraphicalShape:{type:"boolean",defaultValue:false},showTextOnGhost:{type:"boolean",defaultValue:true},relationshipShapeSize:{type:"sap.gantt.simple.relationshipShapeSize",defaultValue:l.simple.relationshipShapeSize.Medium}},aggregations:{table:{type:"sap.ui.table.Table",multiple:false},adhocLines:{type:"sap.gantt.AdhocLine",multiple:true,singularName:"adhocLine",bindable:"bindable",visibility:"public"},simpleAdhocLines:{type:"sap.gantt.simple.AdhocLine",multiple:true,singularName:"simpleAdhocLine",bindable:"bindable",visibility:"public"},deltaLines:{type:"sap.gantt.simple.DeltaLine",multiple:true,singularName:"deltaLine",bindable:"bindable",visibility:"public"},svgDefs:{type:"sap.gantt.def.SvgDefs",multiple:false,singularName:"svgDef"},shapeSchemes:{type:"sap.gantt.simple.ShapeScheme",multiple:true,singularName:"shapeScheme"},calendarDef:{type:"sap.gantt.def.cal.CalendarDefs",multiple:false,bindable:"bindable"},axisTimeStrategy:{type:"sap.gantt.axistime.AxisTimeStrategyBase",multiple:false,bindable:"bindable"},locale:{type:"sap.gantt.config.Locale",multiple:false},_splitter:{type:"sap.ui.layout.Splitter",multiple:false,visibility:"hidden"},_header:{type:"sap.gantt.simple.GanttHeader",multiple:false,defaultValue:null,visibility:"hidden"},_innerGantt:{type:"sap.gantt.simple.InnerGanttChart",multiple:false,visibility:"hidden"},ganttAdaptationData:{type:"sap.gantt.simple.GanttAdaptationData",multiple:true}},events:{shapeSelectionChange:{parameters:{shapeUids:{type:"string[]"}}},shapeResize:{parameters:{shapeUid:{type:"string"},shape:{type:"sap.gantt.simple.BaseShape"},rowObject:{type:"object"},oldTime:{type:"string[]"},newTime:{type:"string[]"}}},shapeMouseEnter:{parameters:{shape:{type:"sap.gantt.simple.BaseShape"},pageX:{type:"int"},pageY:{type:"int"}}},shapeMouseLeave:{parameters:{shape:{type:"sap.gantt.simple.BaseShape"},originEvent:{type:"object"}}},shapePress:{parameters:{popoverOffsetX:{type:"int"},rowSettings:{type:"sap.gantt.simple.GanttRowSettings"},shape:{type:"sap.gantt.simple.BaseShape"}},allowPreventDefault:true},shapeDoubleClick:{parameters:{popoverOffsetX:{type:"int"},rowSettings:{type:"sap.gantt.simple.GanttRowSettings"},shape:{type:"sap.gantt.simple.BaseShape"}}},shapeContextMenu:{parameters:{pageX:{type:"int"},pageY:{type:"int"},popoverOffsetX:{type:"int"},rowSettings:{type:"sap.gantt.simple.GanttRowSettings"},shape:{type:"sap.gantt.simple.BaseShape"}}},dragStart:{parameters:{sourceGanttChart:{type:"sap.gantt.simple.GanttChartWithTable"},draggedShapeDates:{type:"object"},lastDraggedShapeUid:{type:"string"},cursorDateTime:{type:"object"}}},shapeDrop:{parameters:{sourceGanttChart:{type:"sap.gantt.simple.GanttChartWithTable"},targetGanttChart:{type:"sap.gantt.simple.GanttChartWithTable"},draggedShapeDates:{type:"object"},lastDraggedShapeUid:{type:"string"},targetRow:{type:"sap.ui.table.Row"},cursorDateTime:{type:"object"},newDateTime:{type:"object"},targetShape:{type:"sap.gantt.simple.BaseShape"}}},shapeConnect:{parameters:{fromShapeUid:{type:"string"},toShapeUid:{type:"string"},type:{type:"sap.gantt.simple.RelationshipType"}}},visibleHorizonUpdate:{parameters:{type:{type:"sap.gantt.simple.VisibleHorizonUpdateType"},lastVisibleHorizon:{type:"sap.gantt.config.TimeHorizon"},currentVisibleHorizon:{type:"sap.gantt.config.TimeHorizon"}}}},designtime:"sap/gantt/designtime/simple/GanttChartWithTable.designtime"}});j1.prototype.init=function(){this.iGanttRenderedWidth=-1;this._bExtensionsInitialized=false;this._bSupressShapeChangeEvent=false;this._oExpandModel=new E();this._aExpandedIndices=[];this._oSplitter=new S({id:this.getId()+"-ganttChartSplitter"});this.setAggregation("_splitter",this._oSplitter);this._oSyncedControl=new f();this.setAggregation("_innerGantt",new I());this.setAggregation("_header",new G());this._sPreviousDisplayType=this.getDisplayType();this.searchTxt=[];this.searchProperty=[];};j1.prototype.getInnerGantt=function(){return this.getAggregation("_innerGantt");};j1.prototype.onSplitterResize=function(a){var b=a.getParameter("oldSizes"),i=a.getParameter("newSizes"),x=b.length>0&&i.length>0&&(b[0]!==i[0]||b[1]!==i[1]),y=this.getDisplayType(),k1=i[0],l1=false;if(this._sPreviousDisplayType!==y){l1=true;this._isDisplayTypeChanged=true;}if(x){if(y===a1.Both){this._onResize(x);}var m1=function(n1){return this.getSelectionPanelSize().startsWith("0")||n1[0]!==0;}.bind(this);if(i1(b.reduce(h1),i.reduce(h1))&&b[0]!==i[0]&&m1(b)){this.setProperty("selectionPanelSize",k1+"px",true);this.fireEvent("_selectionPanelResize",{newWidth:k1,displayType:y});}if(l1){this._isDisplayTypeChanged=true;}this._draw();}};j1.prototype.setLayoutData=function(a){this.setAggregation("layoutData",a,true);this.fireEvent("_layoutDataChange");return this;};j1.prototype.setDisplayType=function(a){this._sPreviousDisplayType=this.getDisplayType();if(this._sPreviousDisplayType===a1.Both&&a!==a1.Both){this._iLastTableAreaSize=this.getAggregation("_splitter").getContentAreas()[0]&&this.getAggregation("_splitter").getContentAreas()[0].getLayoutData().getSize();}this._isDisplayTypeChanged=true;this.setProperty("displayType",a,false);if(a===a1.Table){this.setProperty("selectionPanelSize","auto",true);}else{delete this._bPreventInitialRender;}this._setupDisplayType();return this;};j1.prototype.setShapeSelectionSettings=function(a){this.setProperty("shapeSelectionSettings",a,true);if(this._getResizeExtension){this._getResizeExtension().updatemSelectionSettings();}};j1.prototype.setSelectionPanelSize=function(a){this.setProperty("selectionPanelSize",a,false);delete this._iLastTableAreaSize;this._setSplitterLayoutData(a,"auto");return this;};j1.prototype.applySettings=function(a,b){a=a||{};this._applyMissingSettings(a);C.prototype.applySettings.call(this,a,b);this._initSelectionModel(this.getProperty("shapeSelectionMode"));};j1.prototype._applyMissingSettings=function(a){if(!a.axisTimeStrategy){a.axisTimeStrategy=new P();}if(!a.locale){a.locale=l.config.DEFAULT_LOCALE_CET.clone();}if(!a.shapeSchemes){a.shapeSchemes=[new h({key:"default",primary:true})];}else{var b=a.shapeSchemes.some(function(i){return i.getPrimary();});if(!b){L.warning("you need set a ShapeSheme with primary:true");}}};j1.prototype.getPrimaryShapeScheme=function(){return this.getShapeSchemes().filter(function(a){return a.getPrimary();})[0];};j1.prototype.getSyncedControl=function(){return this._oSyncedControl;};j1.prototype.getTableRowHeights=function(){return this.getSyncedControl().getRowHeights();};j1.prototype.setTable=function(a){this.setAggregation("table",a);a.addCustomData(new Z({key:"sap-ui-custom-settings",value:{"sap.ui.dt":{"designtime":"sap/gantt/designtime/simple/Table.designtime"}}}));a._bVariableRowHeightEnabled=true;var b=this._oSplitter.removeContentArea(0);this._oSplitter.insertContentArea(new A({content:a,enableRootDiv:true,layoutData:a.getLayoutData()?a.getLayoutData().clone():new e({size:this.getSelectionPanelSize()})}),0);var i=a.getRowActionTemplate();if(i&&i.isA("sap.gantt.simple.GanttRowAction")&&i.getControlTemplate()){a.setRowHeight(80);}if(b==null){this._oSyncedControl.syncWith(a);this._oSplitter.addContentArea(this._oSyncedControl);}else if(b&&b.getContent()!==a.getId()){this._oSyncedControl.syncWith(a);}a.detachEvent("_rowsUpdated",this._onTableRowsUpdated,this);a.attachEvent("_rowsUpdated",this._onTableRowsUpdated,this);a.attachEvent("columnMove",this._onTableColumnMove,this);a.attachEvent("filter",this._onTableFilter,this);a.attachEvent("sort",this._onTableSorter,this);a.attachEvent("columnVisibility",this._onColumnVisible,this);};j1.prototype.setGanttAdaptationData=function(i,a){this.addAggregation("ganttAdaptationData",new $(i,a),true);};j1.prototype.setEnableVariableRowHeight=function(b){if(this.getTable()){this.getTable()._bVariableRowHeightEnabled=b;}else{L.warning("you need to set table aggregation first");}};j1.prototype.setLargeDataScrolling=function(b){if(this.getTable()){this.getTable()._setLargeDataScrolling(b);}else{L.warning("you need to set table aggregation first");}};j1.prototype.getRenderedTimeRange=function(){return this.getAxisTime().getTimeRangeSlice(0,this.iGanttRenderedWidth);};j1.prototype._initSelectionModel=function(a){if(this.oSelection){this.oSelection.detachSelectionChanged(this._onSelectionChanged,this);}this.oSelection=new g(a);this.oSelection.attachSelectionChanged(this._onSelectionChanged,this);return this;};j1.prototype.setShapeSelectionMode=function(a){this.setProperty("shapeSelectionMode",a);if(this.oSelection){this.oSelection.setSelectionMode(a);}return this;};j1.prototype.getSelectedShapeUid=function(){return this.oSelection.allUid();};j1.prototype.setSelectedShapeUid=function(a){return this.selectShapes(a,true);};j1.prototype.selectShapes=function(a,b){if(!this.oSelection){return this;}if((!a||a.length===0)&&b){this._bSupressShapeChangeEvent=false;this.oSelection.clear(true);return this;}var i=this._bSupressShapeChangeEvent;this._bSupressShapeChangeEvent=true;if(b){this.oSelection.clear(false);}this._bSupressShapeChangeEvent=i;this._updateShapes(a,true);return this;};j1.prototype._getShapeIdPath=function(){var a;if(this.getSelectedShapeUid()&&this.getSelectedShapeUid().length>0){var b=u.getShapesWithUid(this.sId,this.getSelectedShapeUid());b.forEach(function(p1){if(!a&&p1){a=p1.getBindingPath("shapeId");}});}else{var i=this.getTable().getRows();var x=this.getTable().getBindingInfo("rows"),y=x&&x.model;var k1=i[0].getBindingContext(y),l1=k1.getObject(),m1=k1.getPath();var n1=m1.split("'");var o1=n1[1];Object.keys(l1).forEach(function(p1){if(l1[p1]===o1){a=p1;}});}return a;};j1.prototype.findAndSelect=function(a,b,i,x){var y=this.findAll(a,b);var k1;if(x){k1=this.getTable().getRowSettingsTemplate().mBindingInfos.rowId.parts[0].path;if(i){this.searchTxt=[];this.searchProperty=[];}if(this.searchTxt.indexOf(a)===-1){this.searchTxt.push(a);}if(Array.isArray(b)){this.searchProperty.concat(b);}else if(this.searchProperty.indexOf(b)===-1){this.searchProperty.push(b);}}else{k1=this._getShapeIdPath();}var l1=[];y.forEach(function(m1){if(m1[k1]){if(x){l1.push({rowId:m1[k1],Selected:true});}else{l1.push({ShapeId:m1[k1],Selected:true});}m1.selected=true;}});if(i){this.getSelection().clearAllSelectedShapeIds();this.getSelection().updateShape(null,{selected:false,ctrl:false});}if(l1.length>0){this.oSelection.updateSelectedShapes(l1,i);}};j1.prototype.findAndDeselect=function(a,b,i){var x=this.findAll(a,b);var y;if(i){y=this.getTable().getRowSettingsTemplate().mBindingInfos.rowId.parts[0].path;this.deSelectTxt=a;this.deSelectProperty=b;if(this.searchTxt.indexOf(a)!==-1){this.searchTxt.splice(this.searchTxt.indexOf(a),1);}if(this.searchProperty.indexOf(b)!==-1){this.searchProperty.splice(this.searchTxt.indexOf(a),1);}}else{y=this._getShapeIdPath();}var k1=[];x.forEach(function(l1){if(l1[y]){if(i){k1.push({rowId:l1[y],Selected:false});}else{k1.push({ShapeId:l1[y],Selected:false});}l1.selected=false;}});if(k1.length>0){this.oSelection.updateSelectedShapes(k1,false);}};j1.prototype.findAll=function(a,b){var i=[];var x=this.getTable().getBinding().getModel().oData;Object.keys(x).forEach(function(y){var k1=x[y];if(b){if(k1[b]!==undefined&&k1[b]!==null&&k1[b].toString().toLowerCase().indexOf(a.toString().toLowerCase())!==-1){i.push(k1);}}else{var l1=false;Object.keys(k1).forEach(function(m1){if(l1){return;}if(k1[m1]!==undefined&&k1[m1]!==null&&k1[m1].toString().toLowerCase().indexOf(a.toString().toLowerCase())!==-1){i.push(k1);l1=true;}});}});return i;};j1.prototype.deselectShapes=function(a){if(!this.oSelection||!a||a.length===0){return this;}this._updateShapes(a,false);return this;};j1.prototype._updateShapes=function(a,b){var x={};var y=u.getShapesWithUid(this.getId(),a);for(var i=0;i<a.length;i++){x[a[i]]={selected:b,ctrl:false};if(y[i]){x.draggable=y[i].getDraggable();x.time=y[i].getTime();x.endTime=y[i].getEndTime();}}this.oSelection.updateShapes(x);};j1.prototype._onSelectionChanged=function(a){var b=a.getParameter("shapeUid"),i=a.getParameter("deselectedUid"),x=a.getParameter("silent"),y=a.getParameter("deSelectAll");this._updateShapeSelections(b,i,y);if((!x||this._bDeselectShapes)&&!this._bSupressShapeChangeEvent){this.fireShapeSelectionChange({shapeUids:b});}};j1.prototype.handleShapePress=function(a){var b=a.shape,i=b.getShapeUid(),x=a.ctrlOrMeta,y=this._getDragDropExtension();var k1=!b.getSelected();if(y.shapeSelectedOnMouseDown&&!y.initiallySelected&&!this.getEnableSelectAndDrag()){k1=y.shapeSelectedOnMouseDown;}var l1,m1;if(b instanceof sap.gantt.simple.BaseConditionalShape){if(b._getActiveShapeElement()instanceof sap.gantt.simple.BaseGroup){b._getActiveShapeElement().getShapes().forEach(function(n1){if(!l1&&!m1){l1=n1.getTime();m1=n1.getEndTime();}else{if(n1.getTime()>=l1){l1=l1;}else{l1=n1.getTime();}if(n1.getEndTime()>=m1){m1=n1.getEndTime();}else{m1=m1;}}});b.setTime(l1);b.setEndTime(m1);}else{l1=b._getActiveShapeElement().getTime();m1=b._getActiveShapeElement().getEndTime();b.setTime(l1);b.setEndTime(m1);}}else if(b instanceof sap.gantt.simple.BaseGroup&&!(b.getTime()&&b.getEndTime())){b.getShapes().forEach(function(n1){if(!l1&&!m1){l1=n1.getTime();m1=n1.getEndTime();}else{if(n1.getTime()>=l1){l1=l1;}else{l1=n1.getTime();}if(n1.getEndTime()>=m1){m1=n1.getEndTime();}else{m1=m1;}}});b.setTime(l1);b.setEndTime(m1);}if(!x){this.oSelection.clearAllSelectedShapeIds();this.searchTxt=[];this.searchProperty=[];}this.oSelection.updateShape(i,{selected:k1,ctrl:x,draggable:b.getDraggable(),time:b.getTime(),endTime:b.getEndTime()});y.shapeSelectedOnMouseDown=false;};j1.prototype.handleShapeMouseEnter=function(a){if(!this.getEnableSelectAndDrag()){var b=a.shape,i=this._getResizeExtension();if(!b.getSelected()){i.addResizerOnMouseOver(b);}var x=this._getDragDropExtension();if(b.getDraggable()){x.updateCursorStyle("move");}}};j1.prototype.handleShapeMouseLeave=function(a){if(!this.getEnableSelectAndDrag()){var b=this._getDragDropExtension();b.updateCursorStyle("default");}};j1.prototype._updateShapeSelections=function(a,b,i){var x=this.getShapeSelectionMode();if(x===l.SelectionMode.None){return;}if(this.oSelection.getSelectedShapeIDS().length>0||this.oSelection.getSelectedRowIDS().length>0||this.oSelection.getDeSelectedShapeIDS().length>0||this.oSelection.getDeSelectedRowIDS().length>0){w.updateShapeSelectionByShapeID(this,i);}w.updateShapeSelections(this,this.getSelection().allUid(),b);};j1.prototype._updateVsbContainers=function(){if(this.getParent().isA("sap.gantt.simple.GanttChartContainer")&&this.getParent().getGanttCharts().length>1){var a=this.getParent().getGanttCharts();var b=false;var i,x;for(i=0;i<a.length;i++){x=a[i];if(!x.getTable()._getScrollExtension().getVerticalScrollbar().classList.contains("sapUiTableHidden")){b=true;break;}}if(b){for(i=0;i<a.length;i++){x=a[i];var y=x.getTable()._getScrollExtension().getVerticalScrollbar().classList;if(y.contains("sapUiTableHidden")){y.add("sapVerticalScrollBarContainer");}else{y.remove("sapVerticalScrollBarContainer");}}}else{for(i=0;i<a.length;i++){x=a[i];x.getTable()._getScrollExtension().getVerticalScrollbar().classList.remove("sapVerticalScrollBarContainer");}}}};j1.prototype.getSelection=function(){return this.oSelection;};j1.prototype.getExpandedBackgroundData=function(){if(this._oExpandModel.hasExpandedRows()){var a=this.getTable().getRows();var b=a.length;var x=this.getTable().getFirstVisibleRow();var y=[];for(var i=0;i<b;i++){if(a[i].getIndex()>=x){var k1=a[i].getAggregation("_settings");y.push(k1.getRowUid());}}return this._oExpandModel.collectExpandedBgData(y,this.getExpandedRowHeight(),this.getShowParentRowOnExpand());}};j1.prototype.setAxisTimeStrategy=function(a){a.attachEvent("_redrawRequest",this._onRedrawRequest,this);delete this._bPreventInitialRender;return this.setAggregation("axisTimeStrategy",a,false);};j1.prototype._addChangesToControlPersonalizationWriteAPI=function(a,b){var i=this.getParent();var x=i.isA("sap.gantt.simple.GanttChartContainer");var y=(x&&i.getEnableVariantManagement())||this.getProperty("_enableRTA");if(!a.bPreventDefault&&y){_.add({changes:b});}};j1.prototype._onTableFilter=function(a){var b=[{"selectorElement":a.mParameters.column,"changeSpecificData":{"changeType":"TableColumnFilterValue","content":{propertyName:"filterValue",newValue:a.mParameters.value,oldValue:""}}}];this._addChangesToControlPersonalizationWriteAPI(a,b);};j1.prototype._onTableSorter=function(a){var b=[{"selectorElement":a.mParameters.column,"changeSpecificData":{"changeType":"TableColumnSortOrder","content":{propertyName:"sortOrder",newValue:a.mParameters.sortOrder,oldValue:"Ascending"}}}];this._addChangesToControlPersonalizationWriteAPI(a,b);};j1.prototype._onColumnVisible=function(a){var b=a.mParameters.newVisible;var i=[{"selectorElement":a.mParameters.column,"changeSpecificData":{"changeType":"TableColumnVisibility","content":{propertyName:"visible",newValue:b,oldValue:!b}}}];this._addChangesToControlPersonalizationWriteAPI(a,i);};j1.prototype._onTableColumnMove=function(a){var b=a.getSource().getAggregation('columns').map(function(x){return x.getId();});var i=a.getParameter('column').getIndex();var k1=a.getParameter('newPos');var l1=Array.from(new Set(b));var m1=u.arrayMove(l1,i,k1);var n1=[];m1.forEach(function(x,p1){var q1=a.getSource().getAggregation('columns').find(function(y){return y.getId()===x;});n1.push(q1.getId());});var o1=[];o1.push({"selectorElement":this.getTable(),"changeSpecificData":{"changeType":"GanttTableColumnOrder","content":{"aggregationName":"columns","newValue":n1,"oldValue":b}}});this._addChangesToControlPersonalizationWriteAPI(a,o1);};j1.prototype._onTableRowsUpdated=function(a){if(!this.getVisible()){return;}var b=a.getParameter("reason"),i=this.getInnerGantt();var x=v(d).slice();var y=x.concat(["Render","FirstVisibleRowChange","Resize"]);if(y.indexOf(b)!==-1){this.getSyncedControl().setAllowContentScroll(false);i.invalidate();}else if(b==="VerticalScroll"){}else{i.getRenderer().renderImmediately(this);}};j1.prototype.syncVisibleHorizon=function(a,i,b,x){var y=this.getAxisTimeStrategy();var k1=y.getTotalHorizon();var l1;var m1=this.getVisibleWidth();if(i!==undefined){if(m1===undefined){return;}if(b){var n1=y.getVisibleHorizon();var o1=F.abapTimestampToDate(n1.getStartTime());l1=U.calculateHorizonByWidth(a,i,m1,o1);}else{l1=U.calculateHorizonByWidth(a,i,m1);}}else{l1=a;}if(k1.getEndTime()<l1.getEndTime()){var p1=F.abapTimestampToDate(l1.getEndTime()).getTime()-F.abapTimestampToDate(l1.getStartTime()).getTime();var q1=F.abapTimestampToDate(k1.getEndTime());var r1=new Date();r1.setTime(q1.getTime()-p1);l1=new T({startTime:r1,endTime:q1});}this._updateVisibleHorizon(l1,x||"syncVisibleHorizon",m1);};j1.prototype._updateVisibleHorizon=function(a,b,i){var x=this.getAxisTimeStrategy();x.updateGanttVisibleWidth(i);if(b==="initialRender"){if(!x.isA("sap.gantt.axistime.StepwiseZoomStrategy")){x.calZoomBase();}x.createAxisTime(x.getLocale());}if(a&&(a.getStartTime()||a.getEndTime())){x.setVisibleHorizonWithReason(a,b);}};j1.prototype.syncMouseWheelZoom=function(a){this._getZoomExtension().performMouseWheelZooming(a.originEvent,true);};j1.prototype.syncTimePeriodZoomOperation=function(a,b,i){this._getZoomExtension().syncTimePeriodZoomOperation(a,b,i);};j1.prototype._onRedrawRequest=function(a){var b=a.getParameter("valueBeforeChange");var i=a.getParameter("reasonCode");if(b&&i!=="totalHorizonUpdated"&&i!=="initialRender"&&i!=="syncVisibleHorizon"){this._syncContainerGanttCharts(i,a.getParameter("originEvent"));}this.fireVisibleHorizonUpdate({type:d1[i],lastVisibleHorizon:b,currentVisibleHorizon:this.getAxisTimeStrategy().getVisibleHorizon()});if(this._sPreviousDisplayType!==this.getDisplayType()){this._isDisplayTypeChanged=true;}this.redraw(i);this._setupDisplayType();};j1.prototype.redraw=function(a){this._draw(a);};j1.prototype._draw=function(a){if(this.getDisplayType()===a1.Table&&!this.isPrint){this.getParent().getToolbar().updateZoomLevel(this.getAxisTimeStrategy().getZoomLevel());}else{var i=this.getVisibleWidth();if(!i){return;}var b=this.getAxisTimeStrategy().syncContext(i);if(this.getAxisTimeStrategy().initialSettings!=null&&this.getAxisTimeStrategy().initialSettings.zoomLevel!=null&&this.getAxisTimeStrategy().initialSettings.zoomLevel!=0&&a=="initialRender"&&!this.getAxisTimeStrategy().isA("sap.gantt.axistime.FullScreenStrategy")&&!this.isPrint&&this.getParent().isA("sap.gantt.simple.GanttChartContainer")&&!this.getParent().isZoomLevelUpdated){var x=this.getAxisTimeStrategy();var y=x.initialSettings.zoomLevel;x.setProperty("zoomLevel",y,true);b.zoomLevel=y;var k1=x.calVisibleHorizonByRate(x._aZoomRate[y]);x.updateInitialVisibleHorizon(k1,y);this.getParent().isZoomLevelUpdated=true;}this.fireEvent("_zoomInfoUpdated",b);setTimeout(function(){this._isDisplayTypeChanged=false;}.bind(this),2000);var l1=this._getScrollExtension();if(b.axisTimeChanged){l1.clearOffsetWidth();}l1.needRerenderGantt(function(){this.getInnerGantt().getRenderer().renderImmediately(this);}.bind(this),a);}};j1.prototype._syncContainerGanttCharts=function(a,b){var i=this.getParent();if(i&&i.isA("sap.gantt.simple.GanttChartContainer")&&i.getGanttCharts().length>1){this.fireEvent("_initialRenderGanttChartsSync",{reasonCode:a,visibleHorizon:this.getAxisTimeStrategy().getVisibleHorizon(),visibleWidth:this.getVisibleWidth(),originEvent:b});}};j1.prototype.onBeforeRendering=function(a){this._updateRowHeightInExpandModel(this.getTable());j.detachEvents(this);this._oSplitter.detachResize(this.onSplitterResize,this);if(this._sResizeHandlerId){R.deregister(this._sResizeHandlerId);}if(this.getDisplayType()!==a1.Table){this.getInnerGantt().invalidate();}var b=this.getTable();var i=b.getRowActionTemplate();if(this.getShowExportTableToExcel()&&!this._enableOptimisation&&this.getShowGanttHeader()){if(this.oExportTableToExcelButton==null){this.oExportTableToExcelButton=new W(this.getId()+"-exportTableToExcelButton",{icon:"sap-icon://excel-attachment",tooltip:e1.getText("EXPORT_BUTTON_TEXT"),type:sap.m.ButtonType.Transparent,buttonMode:sap.m.MenuButtonMode.Split,useDefaultActionOnly:true,defaultAction:[function(){this._exportTableToExcel();},this],menu:[new Q({items:[new X({text:e1.getText("QUICK_EXPORT"),press:[function(){this._exportTableToExcel();},this]}),new X({text:e1.getText("EXPORT_WITH_SETTINGS"),press:[function(){this._createExportDialogBox();},this]})]})]});}u.addToolbarToTable(this,b,true);}else if(!this.getShowExportTableToExcel()&&(b.getExtension().length>0&&!(b.getExtension()[0].getContent().indexOf(this.oExportTableToExcelButton)===-1))){if(b.getExtension()[0].getContent().length==1){b.removeExtension(b.getExtension()[0]);}else if(b.getExtension()[0].getContent().length>1){b.getExtension()[0].removeContent(this.oExportTableToExcelButton);}}if(i&&i.isA("sap.gantt.simple.GanttRowAction")&&i.getControlTemplate()){var x=b.getBinding();x.attachDataReceived(function(a){i.invalidate();});}};j1.prototype.onAfterRendering=function(a){this._attachExtensions();j.attachEvents(this);this._oSplitter.attachResize(this.onSplitterResize,this);this._sResizeHandlerId=R.register(this,this._onResize.bind(this));if((this.mProperties.hasOwnProperty("height")||(this.getParent()&&this.getParent().mProperties.hasOwnProperty("height")))&&!this._enableOptimisation){this.getTable().setVisibleRowCountMode(sap.ui.table.VisibleRowCountMode.Auto);this.getTable().setMinAutoRowCount(1);}};j1.prototype._onResize=function(i){if(this.getDisplayType()!==a1.Both){return;}var a=this.getAggregation("_splitter");this._sPreviousDisplayType=this.getDisplayType();if(this._sPreviousDisplayType===a1.Both){this._iLastTableAreaSize=this.getAggregation("_splitter").getContentAreas()[0]&&this.getAggregation("_splitter").getContentAreas()[0].getLayoutData().getSize();}if(a.getContentAreas()[0]&&a.getContentAreas()[0].getLayoutData()){var b=a.getContentAreas()[0],x=b.getLayoutData(),y=this.getDomRef().offsetWidth,k1;if(y<g1*2){k1=y/2;k1=k1+"px";}else{var l1=b.getDomRef().offsetWidth;if(l1>g1){return;}if(this.getSelectionPanelSize()!=null&&l1==0&&i!=true){k1=this.getSelectionPanelSize();}else{k1=Math.max(Math.min(l1,y-g1),Math.max((0.3*y),g1));k1=k1+"px";}}x.setSize(k1);}};j1.prototype._setupDisplayType=function(){var a=this.getDisplayType();this._isDisplayTypeChanged=true;if(a===a1.Table){var i=this.getSyncedControl().$().find(".sapGanttBackgroundVScrollContentArea").width();if(i!==null){this._setSplitterLayoutData("auto",i+"px");}}else if(a===a1.Chart){this._setSplitterLayoutData("0px","auto");}else if(a!==this._sPreviousDisplayType){this._setSplitterLayoutData(this._iLastTableAreaSize?this._iLastTableAreaSize:this.getSelectionPanelSize(),"auto");}};j1.prototype._setSplitterLayoutData=function(a,b){var i=this._oSplitter.getContentAreas();if(i.length>1){var x=i[0].getLayoutData(),y=i[1].getLayoutData(),k1=this.getDisplayType()===a1.Both;x.setSize(a).setResizable(k1);y.setSize(b).setResizable(k1);}};j1.prototype._updateRowHeightInExpandModel=function(a){var i=Math.ceil(a.getRowHeight());if(i===0){i=Math.ceil(a._getDefaultRowHeight());}this._oExpandModel.setBaseRowHeight(i);};j1.prototype.jumpToPosition=function(a){if(Object.prototype.toString.call(a)==="[object Date]"||typeof a==="string"){this._updateVisibleHorizon(new T({startTime:a}),"jumpToPosition",this.getVisibleWidth());}else if(Array.isArray(a)){this._updateVisibleHorizon(new T({startTime:a[0],endTime:a[1]}),"jumpToPosition",this.getVisibleWidth());}else if(a===undefined){this._updateVisibleHorizon(this.getAxisTimeStrategy().getTotalHorizon(),"jumpToPosition",this.getVisibleWidth());}};j1.prototype.exit=function(){if(this._sResizeHandlerId){R.deregister(this._sResizeHandlerId);}this._detachExtensions();delete this._bPreventInitialRender;};j1.prototype._attachExtensions=function(){if(this._bExtensionsInitialized){return;}j.enrich(this,k);j.enrich(this,m);j.enrich(this,n);j.enrich(this,o);j.enrich(this,p);j.enrich(this,r);j.enrich(this,s);j.enrich(this,t);this._bExtensionsInitialized=true;};j1.prototype._detachExtensions=function(){j.cleanup(this);};j1.prototype.getAxisTime=function(){var a=this.getAxisTimeStrategy().getAxisTime();if(!a){this.getAxisTimeStrategy().createAxisTime(this.getLocale());a=this.getAxisTimeStrategy().getAxisTime();}return a;};j1.prototype.getContentWidth=function(){var a=this.getAxisTime(),b=a.getViewRange();return(Math.abs(Math.ceil(b[1])-Math.ceil(b[0]))-1);};j1.prototype.getVisibleWidth=function(){return this._getScrollExtension?this._getScrollExtension().getVisibleWidth():undefined;};j1.prototype.expand=function(a,b){this.toggleShapeScheme(true,a,b);this._aExpandedIndices=this._aExpandedIndices.concat(b);this._aExpandedIndices=Array.from(new Set(this._aExpandedIndices));};j1.prototype.collapse=function(a,b){this.toggleShapeScheme(false,a,b);var i=[];i=i.concat(b);this._aExpandedIndices=this._aExpandedIndices.filter(function(x){return i.indexOf(x)==-1;});};j1.prototype.toggleShapeScheme=function(b,a,i){var x=[];if(typeof i==="number"){x=[i];}else if(Array.isArray(i)){x=i;}if(x.length===0||!a){return;}var y=this.getShapeSchemes().filter(function(m1){return m1.getKey()===a;});if(y==null||y.length===0||y.length>1){c(false,"shape scheme must not be null or not found in shapeSchemes");return;}var k1=this.getPrimaryShapeScheme();var l1=this._oExpandModel.isTableRowHeightNeedChange(b,this.getTable(),x,k1,y[0]);if(l1){this.getTable().invalidate();}};j1.prototype.isShapeVisible=function(a){if(a&&a.isVisible()){return true;}if(!a.getVisible()){return false;}var b=this.getRenderedTimeRange(),i=b[0],x=b[1];var y=a.getTime(),k1=a.getEndTime();if(this.getLocale()&&(y&&k1)){y=F._convertUTCToLocalTime(y,this.getLocale());k1=F._convertUTCToLocalTime(k1,this.getLocale());}var l1=function(m1){return(m1>=i&&m1<=x);};if(a.getSelected()||!y||!k1){return true;}else if(y&&k1){return l1(y)||l1(k1)||(y<=i&&k1>=x);}else if(y&&!k1){return l1(y);}else if(!y&&k1){return l1(k1);}};j1.prototype.doBirdEye=function(i){var a=this._getZoomExtension();a.doBirdEye(i);};j1.prototype._exportTableToExcel=function(a){var b,i,x,y,k1,l1;k1=this.getTable();if(k1){l1=k1.getBinding(k1._sAggregation);}if(l1.getModel().isA('sap.ui.model.json.JSONModel')){y=true;}b=this._createColumnConfig();var m1=l1.getModel();i={workbook:{columns:b},fileName:a&&a.fileName?a.fileName:"GanttTableExport.xlsx",worker:false};if(y){i.dataSource=this._createJSONDataSource(k1);}else{i.dataSource={type:"odata",dataUrl:l1.getDownloadUrl?l1.getDownloadUrl():null,serviceUrl:this._sServiceUrl,headers:m1.getHeaders?m1.getHeaders():null,count:l1.getLength?l1.getLength():null};}if(k1.getColumns()[0].data("exportTableColumnConfig")&&k1.getColumns()[0].data("exportTableColumnConfig").hierarchyNodeLevel){i.workbook.hierarchyLevel=k1.getColumns()[0].data("exportTableColumnConfig").hierarchyNodeLevel;}x=new z(i);x.build().finally(function(){x.destroy();});};j1.prototype._createExportDialogBox=function(){this._getExportSettingsViaDialog().then(function(a){this._exportTableToExcel(a);}.bind(this));};j1.prototype._getExportSettingsViaDialog=function(a){return new Promise(function(b,i){var x;var y=new N();var k1={fileName:"GanttTableExport",fileType:[{key:"xlsx"}],selectedFileType:"xlsx"};y.setData(k1);var l1=D();x=new H({id:l1,title:e1.getText("EXPORT_SETTINGS_TITLE"),content:[new V({renderType:"Bare",width:"100%",items:[new K({text:e1.getText("FILE_NAME"),labelFor:l1+"-fileName"}),new J({id:l1+"-fileName",value:"{/fileName}",liveChange:function(m1){var n1=m1.getSource();var o1=m1.getParameter("value");var p1=/[\\/:|?"*<>]/;var q1=B.byId(l1+"-export");var r1=p1.test(o1);if(r1){n1.setValueState(sap.ui.core.ValueState.Error);n1.setValueStateText(e1.getText("FILENAME_ERROR"));}else if(o1.length>100){n1.setValueState(sap.ui.core.ValueState.Warning);n1.setValueStateText(e1.getText("FILENAME_WARNING"));}else{n1.setValueState(sap.ui.core.ValueState.None);n1.setValueStateText(null);}q1.setEnabled(!r1);}}).addStyleClass("sapUiTinyMarginBottom")]}).addStyleClass("sapUiExportSettingsLabel")],endButton:new M({id:l1+"-cancel",text:e1.getText("CANCEL_BUTTON"),press:function(){x.close();}}),beginButton:new M({id:l1+"-export",text:e1.getText("QUICK_EXPORT"),type:sap.m.ButtonType.Emphasized,press:function(){if(x){x._bSuccess=true;x.close();b(y.getData());}}}),afterClose:function(){if(!x._bSuccess){L.warning("sap.gantt.simple.GanttChartWithTable ","Cancel Click on Export to Excel PopOver",this);i(null);}x.destroy();x=null;}});x.addStyleClass("sapUiContentPadding sapUiExportSettings");x.setModel(y);x.open();if(a){a(x);}});};j1.prototype._createColumnConfig=function(){var a,i,b,x,y,k1,l1,m1,n1,o1=[],p1,q1,r1;this._oTable=this.getTable();a=this._oTable.getColumns();b=a.length;for(i=0;i<b;i++){l1=null;p1=null;q1=null;r1=null;n1=null;x=a[i];if(x.getVisible()){y=x.data("exportTableColumnConfig");if(!l1&&y){l1=y["leadingProperty"];}if(Array.isArray(l1)){l1=l1[0];}if(l1){k1=this._getColumnLabel(x);m1=x.getWidth().toLowerCase()||y.width||"";m1=this._getColumnWidthNumber(m1);if(y.unitProperty){n1=y.isCurrency?sap.ui.export.EdmType.Currency:sap.ui.export.EdmType.Number;}else if(y.isDigitSequence){n1=sap.ui.export.EdmType.Number;}if(!n1){switch(y.dataType){case c1.Numeric:n1=sap.ui.export.EdmType.Number;break;case c1.DateTime:n1=sap.ui.export.EdmType.DateTime;r1=y.displayFormat;break;case c1.StringDate:case c1.Date:n1=sap.ui.export.EdmType.Date;r1=y.displayFormat;break;case c1.Boolean:n1=sap.ui.export.EdmType.Boolean;p1="false";q1="true";break;case c1.String:n1=sap.ui.export.EdmType.String;break;case c1.Time:n1=sap.ui.export.EdmType.Time;break;default:n1=sap.ui.export.EdmType.String;break;}}o1.push({columnId:x.getId(),property:l1,type:n1,format:r1?r1:undefined,label:k1?k1:l1,width:m1,textAlign:x.getHAlign(),trueValue:(n1===sap.ui.export.EdmType.Boolean&&q1)?q1:undefined,falseValue:(n1===sap.ui.export.EdmType.Boolean&&p1)?p1:undefined,unitProperty:(n1===sap.ui.export.EdmType.Currency||(n1===sap.ui.export.EdmType.Number))?y.unitProperty:undefined,displayUnit:n1===sap.ui.export.EdmType.Currency,unit:y.unit?y.unit:undefined,precision:y.precision?y.precision:undefined,scale:y.scale?y.scale:undefined,wrap:y.wrap?y.wrap:false});}}}return o1;};j1.prototype._getColumnLabel=function(a){var b;if(!a){return null;}if(a.getLabel){b=a.getLabel();}if(a.getHeader){b=a.getHeader();}return(b&&b.getText)?b.getText():null;};j1.prototype._getColumnWidthNumber=function(a){if(a.indexOf("em")>0){return Math.round(parseFloat(a));}if(a.indexOf("px")>0){return Math.round(parseInt(a,10)/16);}return"";};j1.prototype._createJSONDataSource=function(a){var b,i,x,y=[];b=a.getBinding(a._sAggregation).mParameters.arrayNames[0];i=a.getBinding().sPath;x=a.getModel().getProperty(i);y=this._generateJSONRowData(x[b],b,y);return y;};j1.prototype._generateJSONRowData=function(a,b,x){if(!a){return[];}if(!x){x=[];}for(var i=0;i<a.length;i++){x.push(a[i]);if(a[i][b]){this._generateJSONRowData(a[i][b],b,x);}}return x;};j1.prototype.setRowsHeight=function(a){this.oRowsCustomHeight=a;this.getTable().invalidate();};j1.prototype.getShapeUids=function(a){var b=[],i=[];var x=this.getTable().getRows();for(var y=0;y<x.length;y++){var k1=x[y].getAggregation("_settings");b=b.concat(this._getAllMatchedShapeInRow(k1,[],a));}b.forEach(function(l1){if(l1.getShapeUid()){i.push(l1.getShapeUid());}});i=Array.from(new Set(i));return i;};j1.prototype._getAllMatchedShapeInRow=function(a,b,i){var x=a.getMetadata(),y=x.getAllAggregations(),k1=false;Object.keys(y).forEach(function(l1){if(l1==="calendars"){return;}var m1=a.getAggregation(l1);if(m1){m1=q.isArray(m1)?m1:[m1];if(m1.length>0){m1.forEach(function(n1){if(n1 instanceof sap.gantt.simple.BaseConditionalShape){n1=n1._getActiveShapeElement();if(n1 instanceof sap.gantt.simple.BaseGroup){k1=this._checkBaseGroup(n1,"shapes",i);if(k1&&n1.getShapeUid()){b=b.concat(n1);}}else if(this._isShapeMatched(n1,i)&&n1.getShapeUid()){b=b.concat(n1);}}else if(n1 instanceof sap.gantt.simple.MultiActivityGroup){var o1=this._oExpandModel.isRowExpanded(n1.getParent().getRowUid());k1=this._checkBaseGroup(n1,"task",i);if(k1&&n1.getShapeUid()){if(!(o1&&!this.getShowParentRowOnExpand())){b=b.concat(n1);}}if(o1){b=b.concat(this._getAllMatchedShapeInRow(n1,[],i));}}else if(n1 instanceof sap.gantt.simple.BaseGroup){k1=this._checkBaseGroup(n1,"shapes",i);if(k1&&n1.getShapeUid()){b=b.concat(n1);}}else if(this._isShapeMatched(n1,i)&&n1.getShapeUid()){b=b.concat(n1);}}.bind(this));}}}.bind(this));return b;};j1.prototype._checkBaseGroup=function(a,b,i){var x=false;if(this._isShapeMatched(a,i)&&a.getShapeUid()){x=true;return x;}var y=a.getAggregation(b);y=q.isArray(y)?y:[y];y.forEach(function(k1){if(k1 instanceof sap.gantt.simple.BaseGroup){x=this._checkBaseGroup(k1,"shapes",i);}else if(this._isShapeMatched(k1,i)){x=true;return x;}}.bind(this));return x;};j1.prototype._isShapeMatched=function(a,b){if(b&&(a instanceof sap.gantt.simple.BaseShape)){var i=true;for(var x in b){var y=a.getMetadata(),k1=y.getAllProperties();if(k1&&k1.hasOwnProperty(x)&&i){var l1=a.getProperty(x);if(l1 instanceof Date){l1=l1.getTime();if(b[x]instanceof Date){b[x]=b[x].getTime();}}else if(typeof(l1)==="string"){l1=l1.toLowerCase();b[x]=b[x].toLowerCase();}if(typeof(l1)==="object"){i=Y(l1,b[x]);}else if(l1!==b[x]){i=false;}}else{i=false;}}return i;}else{return false;}};j1.prototype.getChartOverflowToolbar=function(){var a;if(this.getEnableChartOverflowToolbar()){a=sap.ui.getCore().byId(this.getId()+"-ganttHeaderOverflowToolbar");}return a;};return j1;},true);
