/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/gantt/library","sap/ui/base/EventProvider","./GanttUtils"],function(l,E,G){"use strict";var S=l.SelectionMode;var a=E.extend("sap.gantt.simple.SelectionModel",{constructor:function(s){E.apply(this,arguments);this.sSelectionMode=s||S.Single;this.mSelected={"uid":{},"shapeId":{},"rowId":{},"deSelectShapeId":{},"deSelectRowId":{}};}});a.prototype.getSelectionMode=function(){return this.sSelectionMode;};a.prototype.setSelectionMode=function(s){this.sSelectionMode=s||S.Single;return this;};a.prototype.updateShape=function(u,p){var s=this.getSelectionMode();if(s==="None"){return;}if(!u){if(s===S.Single||s===S.Multiple||s===S.MultiWithKeyboard&&!p.ctrl||s===S.MultipleWithLasso||s===S.MultiWithKeyboardAndLasso&&!p.ctrl){this.clear(false);}return;}if(p.selected&&!this.mSelected.uid[u]){var d=Object.keys(this.mSelected.uid);if(this.sSelectionMode===S.Single){this.mSelected.uid={};}else if(this.sSelectionMode===S.MultiWithKeyboard||this.sSelectionMode===S.MultiWithKeyboardAndLasso){if(p.ctrl){d=[];}else{this.mSelected.uid={};}}else if(this.sSelectionMode===S.Multiple||this.sSelectionMode===S.MultipleWithLasso){d=[];}this._updateSelectedShape(u,p);this._fireSelectionChanged(d);}else if(!p.selected&&this.mSelected.uid[u]){delete this.mSelected.uid[u];this._fireSelectionChanged([u]);}};a.prototype.updateShapes=function(s){if(!s){return;}var d=[];var k=Object.keys(s);for(var i=0;i<k.length;i++){var u=k[i];var p=s[k[i]];if(p&&p.selected&&!this.mSelected.uid[u]){this._updateSelectedShape(u,p);}else if(p&&!p.selected&&this.mSelected.uid[u]){delete this.mSelected.uid[u];d.push(u);}}this._fireSelectionChanged(d);};a.prototype.updateProperties=function(u,p,n){if(this.mSelected.uid[u]){this.mSelected.uid[u].draggable=p.draggable;this.mSelected.uid[u].time=p.time;this.mSelected.uid[u].endTime=p.endTime;}else if(n){this._updateSelectedShape(u,p);}};a.prototype._updateSelectedShape=function(u,p){this.mSelected.uid[u]={shapeUid:u,draggable:p.draggable,time:p.time,endTime:p.endTime};};a.prototype._fireSelectionChanged=function(d,s,b,c){var p={shapeUid:Object.keys(this.mSelected.uid),deselectedUid:d,silent:!!s,deSelectAll:c};if(p.shapeUid.length>0||p.deselectedUid.length>0||b){this.fireSelectionChanged(p);}};a.prototype.clearSelectionByUid=function(u){if(this.existed(u)){delete this.mSelected.uid[u];}};a.prototype.existed=function(u){return!!this.mSelected.uid[u];};a.prototype.clear=function(f){if(this.mSelected.uid.length===0){return false;}var u=this.allUid();this.mSelected.uid={};this._fireSelectionChanged(u,f);return true;};a.prototype.allUid=function(){return Object.keys(this.mSelected.uid);};a.prototype.numberOfSelectedDraggableShapes=function(){return this.allSelectedDraggableUid().length;};a.prototype.allSelectedDraggableUid=function(){return Object.keys(this.mSelected.uid).filter(function(u){return this.mSelected.uid[u].draggable;}.bind(this));};a.prototype.updateSelectedShapes=function(s,o){this.mSelected.deSelectRowId={};if(!s||s.length===0){this.mSelected.deSelectShapeId=this.mSelected.shapeId;this.mSelected.shapeId={};}if(o){this.mSelected.uid={};this.mSelected.shapeId={};}s.forEach(function(b){if(b.Selected){this.mSelected.deSelectShapeId={};if(b.ShapeId&&!this.mSelected.shapeId[b.ShapeId]){this.mSelected.shapeId[b.ShapeId]={selected:b.Selected};}else if(b.rowId&&!this.mSelected.rowId[b.rowId]){this.mSelected.rowId[b.rowId]={selected:b.Selected};}}else{if(b.ShapeId&&this.mSelected.shapeId[b.ShapeId]){delete this.mSelected.shapeId[b.ShapeId];this.mSelected.deSelectShapeId[b.ShapeId]={selected:b.Selected};}else if(b.ShapeId&&!this.mSelected.shapeId[b.ShapeId]){this.mSelected.deSelectShapeId[b.ShapeId]={selected:b.Selected};}else if(b.rowId&&this.mSelected.rowId[b.rowId]){delete this.mSelected.rowId[b.rowId];this.mSelected.deSelectRowId[b.rowId]={selected:b.Selected};}else if(b.rowId&&!this.mSelected.rowId[b.rowId]){this.mSelected.deSelectRowId[b.rowId]={selected:b.Selected};}}}.bind(this));this._fireSelectionChanged([],true,true,false);};a.prototype.clearAllSelectedShapeIds=function(){this.mSelected.deSelectShapeId=this.mSelected.shapeId;this.mSelected.deSelectRowId=this.mSelected.rowId;this.mSelected.shapeId={};this.mSelected.rowId={};var u=this.allUid();this._fireSelectionChanged(u,true,true,true);};a.prototype.getSelectedShapeIDS=function(){return Object.keys(this.mSelected.shapeId);};a.prototype.getSelectedRowIDS=function(){return Object.keys(this.mSelected.rowId);};a.prototype.getDeSelectedShapeIDS=function(){return Object.keys(this.mSelected.deSelectShapeId);};a.prototype.getDeSelectedRowIDS=function(){return Object.keys(this.mSelected.deSelectRowId);};a.prototype.updateShapeId=function(s,b){if(b){if(!this.mSelected.shapeId[s]){this.mSelected.shapeId[s]={selected:b};}if(this.mSelected.deSelectShapeId[s]){delete this.mSelected.deSelectShapeId[s];}}else{if(this.mSelected.shapeId[s]){delete this.mSelected.shapeId[s];}if(!this.mSelected.deSelectShapeId[s]){this.mSelected.deSelectShapeId[s]={selected:b};}}};a.prototype.getSelectedShapeDataByUid=function(u){return this.mSelected.uid[u];};a.prototype.attachSelectionChanged=function(d,f,L){this.attachEvent("selectionChanged",d,f,L);};a.prototype.detachSelectionChanged=function(f,L){this.detachEvent("selectionChanged",f,L);};a.prototype.fireSelectionChanged=function(A){this.fireEvent("selectionChanged",A);return this;};return a;},true);
