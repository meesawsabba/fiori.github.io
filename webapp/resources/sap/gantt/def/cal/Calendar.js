/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["../DefBase","sap/gantt/misc/Format","sap/gantt/simple/AggregationUtils"],function(D,F,A){"use strict";var C=D.extend("sap.gantt.def.cal.Calendar",{metadata:{library:"sap.gantt",properties:{key:{type:"string",defaultValue:"calendar"},backgroundColor:{type:"sap.gantt.ValueSVGPaintServer",defaultValue:"#e5e5e5"}},defaultAggregation:"timeIntervals",aggregations:{timeIntervals:{type:"sap.gantt.def.cal.TimeInterval",multiple:true,singularName:"timeInterval",bindable:"bindable"}}}});C.prototype.getDefNode=function(){var t=this.getTimeIntervals();var s=(this.getParent()&&this.getParent().getParent())?this.getParent().getParent()._oStatusSet:null;var v=s?s.aViewBoundary:null;var T=s?s.aTimeBoundary:null;var f=t;if(T&&s){f=t.filter(function(o){var b=F.abapTimestampToDate(o.getStartTime());var e=F.abapTimestampToDate(o.getEndTime());var c=s.bRTL?T[1]:T[0],d=s.bRTL?T[0]:T[1];return e>c&&b<d;});}var w=(v&&v.length>1)?(v[1]-v[0]):1;var p={id:this.generateRefId(),x:0,y:0,width:w,timeIntervals:[]};var a=(this.getParent()&&this.getParent().getParent()&&this.getParent().getParent().getAggregation("table"))?this.getParent().getParent().getTable().getRows():null;if(a&&a.length>0){a.forEach(function(r){if(!p.title||p.title===""){var R=r.getAggregation("_settings");if(R){var m=A.getAllNonLazyAggregations(R);var M=Object.keys(m).filter(function(n){return(n.indexOf("calendars")===0);}).map(function(n){return R.getAggregation(n)||[];});M.forEach(function(b){if(b&&b.length>0){var c=b.filter(function(g){return this.getKey()===g.getCalendarName();}.bind(this));var d=(c&&c.length>0)?c[0].getTitle():null;var e=(c&&c.length>0)?c[0]:null;p['title']=d;p['baseCalender']=e;}}.bind(this));}}}.bind(this));}for(var i=0;i<f.length;i++){var I=f[i].getDefNode();I.fill=this.getBackgroundColor();p.timeIntervals.push(I);}return p;};C.prototype.generateRefId=function(){var i=(this.getParent()&&this.getParent().getParent())?this.getParent().getParent().getId():"";return i+"_"+this.getKey();};return C;},true);
