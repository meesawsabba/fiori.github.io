/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["./RedlineElement","./Redline","sap/base/Log"],function(R,a,L){"use strict";var b=R.extend("sap.ui.vk.RedlineElementText",{metadata:{library:"sap.ui.vk",properties:{text:{type:"string",defaultValue:"Text"},font:{type:"string",defaultValue:""},fontSize:{type:"float",defaultValue:32},fillColor:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(0,0,0,0)"},width:{type:"float",defaultValue:300},height:{type:"float",defaultValue:0}}}});b.prototype.edit=function(p,c){var d=this.getParent(),e=d._toVirtualSpace(p,c);this.setOriginX(e.x);this.setOriginY(e.y);this.rerender();return this;};b.prototype.applyZoom=function(z){this.setFontSize(this.getFontSize()*z);this.setWidth(this.getWidth()*z);this.setHeight(this.getHeight()*z);return this;};b.prototype.renderElement=function(r,h){var p=this.getParent()._toPixelSpace(this.getOriginX(),this.getOriginY());r.write("<foreignObject");r.writeElementData(this);r.writeAttribute("x",p.x);r.writeAttribute("y",p.y);r.writeAttribute("width","1");r.writeAttribute("height","1");r.addStyle("overflow","visible");r.writeStyles();r.write("><textarea");r.writeAttribute("spellcheck",false);if(h){r.addStyle("text-shadow","0 0 5px "+this.getHaloColor());}if(this.getFont()){r.addStyle("font-family",this.getFont());}r.addStyle("font-size",this.getFontSize()+"px");r.addStyle("color",this.getFillColor());r.addStyle("opacity",this.getOpacity());r.addStyle("background","transparent");r.addStyle("border-style","none");r.addStyle("resize","none");r.addStyle("width",this.getWidth()+"px");r.addStyle("height",(this.getHeight()||this.getFontSize()*1.2)+"px");r.writeStyles();r.write(">");r.write(this.getText());r.write("</textarea></foreignObject>");};b.prototype.exportJSON=function(){return jQuery.extend(true,R.prototype.exportJSON.call(this),{type:a.ElementType.Text,version:1,text:this.getText(),font:this.getFont(),fontSize:this.getFontSize(),fillColor:this.getFillColor(),width:this.getWidth(),height:this.getHeight()});};b.prototype.importJSON=function(j){if(j.type===a.ElementType.Text){if(j.version===1){R.prototype.importJSON.call(this,j);if(j.hasOwnProperty("text")){this.setText(j.text);}if(j.hasOwnProperty("font")){this.setFont(j.font);}if(j.hasOwnProperty("fontSize")){this.setFontSize(j.fontSize);}if(j.hasOwnProperty("fillColor")){this.setFillColor(j.fillColor);}if(j.hasOwnProperty("width")){this.setWidth(j.width);}if(j.hasOwnProperty("height")){this.setHeight(j.height);}}else{L.error("wrong version number");}}else{L.error("Redlining JSON import: Wrong element type");}return this;};b.prototype.exportSVG=function(){var e=document.createElementNS(a.svgNamespace,"text");e.setAttribute("x",this.getOriginX());e.setAttribute("y",this.getOriginY());if(this.getFont()){e.setAttribute("font-family",this.getFont());}e.setAttribute("font-size",this.getFontSize());e.setAttribute("fill",this.getFillColor());e.setAttribute("stroke",this.getStrokeColor());e.setAttribute("stroke-width",this.getStrokeWidth());if(this.getStrokeDashArray().length>0){e.setAttribute("stroke-dasharray",this.getStrokeDashArray().toString());}if(this.getOpacity()<1){e.setAttribute("opacity",this.getOpacity());}e.setAttribute("data-sap-element-id",this.getElementId());e.setAttribute("data-sap-halo",this.getHalo());e.setAttribute("width",this.getWidth());e.setAttribute("height",this.getHeight());e.textContent=this.getText();return e;};b.prototype.importSVG=function(e){if(e.tagName==="text"){R.prototype.importSVG.call(this,e);if(e.getAttribute("x")){this.setOriginX(parseFloat(e.getAttribute("x")));}if(e.getAttribute("y")){this.setOriginY(parseFloat(e.getAttribute("y")));}if(e.textContent){this.setText(e.textContent);}if(e.getAttribute("font-family")){this.setFont(e.getAttribute("font-family"));}if(e.getAttribute("font-size")){this.setFontSize(parseFloat(e.getAttribute("font-size")));}if(e.getAttribute("fill")){this.setFillColor(e.getAttribute("fill"));}if(e.getAttribute("width")){this.setWidth(parseFloat(e.getAttribute("width")));}if(e.getAttribute("height")){this.setHeight(parseFloat(e.getAttribute("height")));}}else{L("Redlining SVG import: Wrong element type");}return this;};return b;});
