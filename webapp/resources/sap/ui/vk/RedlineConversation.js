/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/core/Element","sap/ui/base/ManagedObjectObserver","sap/ui/vk/uuidv4","sap/ui/vk/RedlineElementComment"],function(E,M,u,R){"use strict";var a=E.extend("sap.ui.vk.RedlineConversation",{metadata:{library:"sap.ui.vk",properties:{conversationName:{type:"string"},timestamp:{type:"int"},viewId:{type:"string",defaultValue:""},viewInfo:{type:"any",defaultValue:null},animationOffset:{type:"float",defaultValue:0}},aggregations:{comments:{singularName:"comment",type:"sap.ui.vk.RedlineElementComment",multiple:true}}},constructor:function(i,p){E.apply(this,arguments);if(typeof i==="object"){p=i;i=undefined;}this._elementId=p&&p.elementId?p.elementId:u();}});a.prototype.getElementId=function(){return this._elementId;};a.prototype.addContent=function(c){if(!this._elements){this._elements=new Map();}var e;var j;if(c instanceof sap.ui.vk.RedlineElement){e=c.getElementId();j=c.exportJSON();}else{e=c.elementId;j=c;}this._elements.set(e,j);return this;};a.prototype.removeContent=function(c){if(this._elements){var e;if(c instanceof sap.ui.vk.RedlineElement){e=c.getElementId();}else if(typeof c==="string"){e=c;}else{e=c.elementId;}this._elements.delete(e);}return this;};a.prototype.getContent=function(){var e=[];if(this._elements){e=Array.from(this._elements.values());}return e;};a.prototype._activate=function(t){var b=this;var o={properties:true};if(!this._objectObserver){var c=function(d){if(d.type==="property"){b.addContent(d.object);}};this._objectObserver=new M(c);}this._objectObserver.disconnect();t.importJSON(this.getContent());var e=t.getRedlineElements();for(var i=0;i<e.length;i++){this._objectObserver.observe(e[i],o);}};a.prototype._deactivate=function(){if(this._objectObserver){this._objectObserver.disconnect();}};a.prototype._createCommentFromJSON=function(j){var c=new R();var b=c.importJSON(j);this.addComment(c);return b;};a.prototype.exportJSON=function(){if(this.getContent()){this.getContent().forEach(function(c){if(!c.createTimestamp){c.createTimestamp=Date.now();}if(c.deletedByUser){c.deleteTimestamp=Date.now();}});}var j={conversationId:this.getElementId(),conversationName:this.getConversationName(),timestamp:this.getTimestamp()?this.getTimestamp():Date.now(),sceneView:this.getViewId(),viewInfo:this.getViewInfo(),animationOffset:this.getAnimationOffset(),comments:this.getComments().map(function(c){return c.exportJSON();}),content:this.getContent()};return j;};a.prototype.importJSON=function(b){var c=new Set();if(b.hasOwnProperty("conversationId")){this._elementId=b.conversationId;}if(b.hasOwnProperty("conversationName")){this.setConversationName(b.conversationName);}if(b.hasOwnProperty("timestamp")){this.setTimestamp(b.timestamp);}if(b.hasOwnProperty("sceneView")){this.setViewId(b.sceneView);}if(b.hasOwnProperty("viewInfo")){this.setViewInfo(b.viewInfo);}if(b.hasOwnProperty("animationOffset")){this.setAnimationOffset(b.animationOffset);}if(b.hasOwnProperty("comments")){var d=b.comments;if(d){for(var i=0;i<d.length;i++){var e=this._createCommentFromJSON(d[i]);if(e){c.add(e);}}}}if(b.hasOwnProperty("content")){var f=b.content;if(f){for(var j=0;j<f.length;j++){var g=f[j].createdByUser;if(g){c.add(g);}var h=f[j].deletedByUser;if(h){c.add(h);}this.addContent(f[j]);}}}return c;};return a;});
