/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["../Core","./ViewportRenderer","../ViewportBase","sap/ui/core/ResizeHandler","sap/ui/events/KeyCodes","../Loco","../ViewStateManager","./ViewStateManager","../ViewportHandler","../VisibilityMode","../ZoomTo","../SelectionMode","../NodeContentType","../getResourceBundle","../Messages","./Scene","./OrthographicCamera","./Element","./Rectangle","./HotspotHelper","../colorToCSSColor","../cssColorToColor","../colorToABGR","../abgrToColor","sap/base/Log","sap/ui/core/Core"],function(v,V,c,R,K,L,d,g,h,j,Z,S,N,k,M,l,O,E,m,H,o,p,q,r,s,u){"use strict";var w=c.extend("sap.ui.vk.svg.Viewport",{metadata:{library:"sap.ui.vk",events:{cameraChanged:{parameters:{offset:"float[]",zoom:"float"},enableEventBubbling:true},hotspotEnter:{parameters:{nodeRef:"any"},enableEventBubbling:true},hotspotLeave:{parameters:{nodeRef:"any"},enableEventBubbling:true}}}});var A=w.getMetadata().getParent().getClass().prototype;w.prototype.init=function(){if(A.init){A.init.call(this);}this._resizeListenerId=null;this._animLoopRequestId=0;this._animLoopFunction=this._animLoop.bind(this);this._width=this._height=0;this._camera=new O();this._gestureX=0;this._gestureY=0;this._scene=null;this._selectionRect=new m({material:{lineColor:[0.75,0.75,0,1],lineStyle:{dashPattern:[2,2]}}});this._styles=new Map();this.raster={rasterImage:new Image(),vectorImage:new Image(),bmpCanvas:null,rasterMode:false,useRasterMode:false,delayEnd:false,timer:null,nodesThreshold:10000};this.raster.vectorImage.onload=function(){var a=this.raster.bmpCanvas.getContext("2d");a.clearRect(0,0,this.raster.bmpCanvas.width,this.raster.bmpCanvas.height);a.drawImage(this.raster.vectorImage,0,0);this.raster.rasterImage.width=this.raster.bmpCanvas.width;this.raster.rasterImage.height=this.raster.bmpCanvas.height;this.raster.rasterImage.src=this.raster.bmpCanvas.toDataURL();}.bind(this);this._viewportHandler=new h(this);this._loco=new L(this);this._loco.addHandler(this._viewportHandler,-1);this._hotspotHelper=new H();this._currentViewIndex=0;this._currentView=null;v.getEventBus().subscribe("sap.ui.vk","viewStateApplied",this._onViewStateApplied,this);};w.prototype.exit=function(){v.getEventBus().unsubscribe("sap.ui.vk","viewStateApplied",this._onViewStateApplied,this);this._loco.removeHandler(this._viewportHandler);this._viewportHandler.destroy();if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}this.setScene(null);this._renderer=null;this._loco=null;this._viewportHandler=null;if(A.exit){A.exit.call(this);}this.raster.rasterMode=false;this.raster.useRasterMode=false;};w.prototype.onBeforeRendering=function(){if(this._resizeListenerId){R.deregister(this._resizeListenerId);this._resizeListenerId=null;}};w.prototype.onAfterRendering=function(){this._resizeListenerId=R.register(this,this._handleResize.bind(this));var a=this.getDomRef();if(this._scene){var b=this._scene.getRootElement();b._setDomRef(document.getElementById(b.uid));this._hotspotEffect=b.domRef?b.domRef.parentNode.getElementById("hotspot-effect"):null;this._svgElement=b.domRef.parentNode;}else{this._hotspotEffect=null;}this._handleResize({size:{width:a.clientWidth,height:a.clientHeight}});};w.prototype._handleResize=function(e){var a=this._width;var b=this._height;this._width=e.size.width;this._height=e.size.height;this._camera.update(this._width,this._height,false,true);if((a===0||b===0)&&!this._camera._initialPosition){this.zoomTo(Z.All,null,0,0);}else{this._updateViewBox();this.fireCameraChanged({viewBox:this._getViewBox()});}this.fireResize({size:{width:this._width,height:this._height}});if(this._svgElement!=null){this.raster.bmpCanvas=this._svgElement.previousSibling;this._updateRasterImage();}return true;};w.prototype.setScene=function(a){if(this._scene){this._scene.getDefaultNodeHierarchy().detachNodeCreated(this._nodeCreatedHandler,this);}this._scene=a;this._currentViewIndex=0;this._currentView=null;this._styles.clear();if(a){var n=this._scene.getDefaultNodeHierarchy();this.raster.useRasterMode=n.findNodesByName().length>this.raster.nodesThreshold;n.attachNodeCreated(this._nodeCreatedHandler,this);var i=a.getInitialView();if(i){this.activateView(i);}this._onContentLoadingFinished();}return this;};w.prototype.setCamera=function(a){if(!(a instanceof O)){return this;}if(A.setCamera){A.setCamera.call(this,a);}if(a){a.update(this._width,this._height,true);this._updateViewBox();}return this;};w.prototype._nodeCreatedHandler=function(e){var a=e.getParameter("nodeRef");if(a._vkGetNodeContentType()===N.Annotation&&a.children&&a.children.length&&a.children[0].type==="Image"){this.invalidate();}};w.prototype.getScene=function(){return this._scene;};w.prototype.onSetViewStateManager=function(a){this._viewStateManager=a;a.attachOutliningChanged(this._onOutliningOrSelectionChanged,this);a.attachSelectionChanged(this._onOutliningOrSelectionChanged,this);};w.prototype.onRemoveViewStateManager=function(a){a.detachOutliningChanged(this._onOutliningOrSelectionChanged,this);a.detachSelectionChanged(this._onOutliningOrSelectionChanged,this);this._viewStateManager=null;};w.prototype._getViewStateManagerSVG=function(){if(this._viewStateManager){if(this._viewStateManager instanceof g){return this._viewStateManager;}if(this._viewStateManager instanceof d&&this._viewStateManager._implementation instanceof g){return this._viewStateManager._implementation;}}return null;};w.prototype.hitTest=function(x,y,a){var b=this._getViewStateManagerSVG();if(!b||!this._scene){return null;}var e=this._scene.getRootElement();var f=this.getDomRef().getBoundingClientRect();var i=function(x,y){var P=document.elementFromPoint(x+f.x,y+f.y);return P!==null&&P.id?e.getElementById(P.id):null;};var n=i(x,y);if(a){var t=3;var z=3;for(var I=y-z;I<y+z&&!n;I++){for(var J=x-t;J<x+t&&!n;J++){n=i(J,I);}}}return n?n._getSceneTreeElement():null;};w.prototype.tap=function(x,y,i){var n=this.hitTest(x,y,true);if(!i){this.tapObject(n);if(n!==null){this.fireNodeClicked({nodeRef:n,x:x,y:y},true,true);}}else if(!this.getFreezeCamera()){if(n&&this._camera.zoomedObject!==n){this._camera.zoomedObject=n;this.zoomTo(Z.Node,this._camera.zoomedObject,0.5,0.1);}else{this._camera.zoomedObject=null;this.zoomTo(Z.Visible,null,0.5,0);}}return this;};w.prototype.tapObject=function(n){var a={picked:n?[n]:[]};this.fireNodesPicked(a);if(this.getSelectionMode()===S.Exclusive){this.exclusiveSelectionHandler(a.picked);}else if(this.getSelectionMode()===S.Sticky){this.stickySelectionHandler(a.picked);}return this;};var B={x:-2,y:-2};var C=2;var D=5;w.prototype.onkeydown=function(e){if(!e.isMarked()){switch(e.keyCode){case K.ARROW_LEFT:case K.ARROW_RIGHT:case K.ARROW_UP:case K.ARROW_DOWN:if(e.ctrlKey||e.altKey||e.metaKey){break;}var a={x:0,y:0};switch(e.keyCode){case K.ARROW_LEFT:a.x=-1;break;case K.ARROW_RIGHT:a.x=+1;break;case K.ARROW_UP:a.y=-1;break;case K.ARROW_DOWN:a.y=+1;break;default:break;}this.beginGesture(B.x,B.y);if(e.shiftKey){this.pan(D*a.x,D*a.y);}else{this.rotate(C*a.x,C*a.y,true);}this.endGesture();e.preventDefault();e.stopPropagation();break;case 189:case K.PLUS:case K.NUMPAD_MINUS:case K.NUMPAD_PLUS:this.beginGesture(this._width*0.5,this._height*0.5);this.zoom(e.keyCode===K.PLUS||e.keyCode===K.NUMPAD_PLUS?1.02:0.98);this.endGesture();e.preventDefault();e.stopPropagation();break;case K.D:if(e.ctrlKey){this._dumpSceneData();}break;default:break;}}};w.prototype._onOutliningOrSelectionChanged=function(e){var t=this.getTools();for(var i=0;i<t.length;i++){var a=u.byId(t[i]);var b=a.getGizmoForContainer(this);if(b&&b.handleSelectionChanged){b.handleSelectionChanged(e);}}};w.prototype.setSelectionRect=function(a){var b=document.getElementById(this._selectionRect.uid);if(b){if(a){b.removeAttribute("display");a=this._camera._transformRect(a);b.setAttribute("x",a.x1,a.x2);b.setAttribute("y",a.y1,a.y2);b.setAttribute("width",a.x2-a.x1);b.setAttribute("height",a.y2-a.y1);}else{b.setAttribute("display","none");}}};w.prototype._select=function(a){var b=this._getViewStateManagerSVG();if(b&&this._scene){a=this._camera._transformRect(a);var e=new Set();this._scene.getRootElement()._findRectElementsRecursive(e,a,b._mask);return Array.from(e);}return[];};w.prototype.getImage=function(a,b,t,e,i){return null;};w.prototype._setContent=function(a){this.setScene(a instanceof l?a:null);this.setCamera(new O());if(this.getScene()){var i=this.getScene().getInitialView();if(i&&this._getViewStateManagerSVG()){this.activateView(i,false,true);}}return this;};w.prototype.onSetContentConnector=function(a){c.prototype.onSetContentConnector.call(this,a);a.attachContentLoadingFinished(this._onContentLoadingFinished,this);};w.prototype.onUnsetContentConnector=function(a){a.detachContentLoadingFinished(this._onContentLoadingFinished,this);c.prototype.onUnsetContentConnector.call(this,a);};w.prototype._onContentLoadingFinished=function(e){if(this._scene){var n=this._scene.getDefaultNodeHierarchy();if(n){var a=this.getShowAllHotspots()?1:0;var b=n.getHotspotNodeIds();b.forEach(function(f){this._hotspotHelper.updateHotspot(f,undefined,a);if(this.getDisableHotspotHovering()){f.addClass("sapUiVizKitNonInteractiveHotspot");}},this);}if(!this._camera._initialZoom||this._camera._initialZoom===-1){this.zoomTo(Z.All,null,0,0);}this.invalidate();}};function F(a,b,f){return a+(b-a)*f;}function G(e,a,x){x=Math.min(Math.max((x-e)/(a-e),0.0),1.0);return x*x*x*(x*(x*6-15)+10);}w.prototype._animLoop=function(){this._animLoopRequestId=0;var a=this._anim;if(a){var b=a.start;var e=a.end;var t=Date.now();var f=Math.min(G(0,1,(t-b.time)/a.duration),1);this._camera.offsetX=F(b.offsetX,e.offsetX,f);this._camera.offsetY=F(b.offsetY,e.offsetY,f);this._camera.zoom=F(b.zoom,e.zoom,f);this.fireCameraChanged({viewBox:this._getViewBox()});if(this._updateViewBox()&&(t-b.time)<a.duration){this._animLoopRequestId=window.requestAnimationFrame(this._animLoopFunction);}else{delete this._anim;this._endRasterMode();}}};w.prototype.getCurrentView=function(){return this._currentView;};w.prototype._onViewStateApplied=function(a,e,b){if(b.source===this._getViewStateManagerSVG()){this.activateView(b.view);}};w.prototype.activateView=function(a){if(!this._scene){return this;}var b=this._scene.getViewGroups();var t=this;if(b){b.forEach(function(f){f.getViews().forEach(function(i){if(i===a){t._currentViewIndex=f.getViews().indexOf(i);}});});}this.fireViewActivated({viewIndex:this._currentViewIndex,view:a});v.getEventBus().publish("sap.ui.vk","viewActivated",{source:this,view:a,viewIndex:this._currentViewIndex});v.getEventBus().publish("sap.ui.vk","readyForAnimation",{source:this._getViewStateManagerSVG(),view:a,ignoreAnimationPosition:false});this._currentView=a;var e=a.getCamera();if(e){this.setCamera(e);}if(a.topColor!==undefined){this.setBackgroundColorTop(o({red:a.topColor[0]*255,green:a.topColor[1]*255,blue:a.topColor[2]*255,alpha:a.topColor[3]}));}if(a.bottomColor!==undefined){this.setBackgroundColorBottom(o({red:a.bottomColor[0]*255,green:a.bottomColor[1]*255,blue:a.bottomColor[2]*255,alpha:a.bottomColor[3]}));}this.rerender();this.fireViewFinished({viewIndex:this._currentViewIndex});return this;};w.prototype.resetCurrentView=function(){if(this._currentView){this._getViewStateManagerSVG()._resetNodesStatusByCurrentView(this._currentView);this.rerender();}return this;};w.prototype.zoomTo=function(a,n,b,e){if(this._width===0||this._height===0||this._scene==null){return this;}var f={min:{x:Infinity,y:Infinity},max:{x:-Infinity,y:-Infinity}};var i=this._getViewStateManagerSVG();(Array.isArray(a)?a:[a]).forEach(function(a){switch(a){case Z.All:this._scene.getRootElement()._expandBoundingBoxRecursive(f,-1>>>0);break;case Z.Visible:if(i){this._scene.getRootElement()._expandBoundingBoxRecursive(f,i._mask);}break;case Z.Selected:if(i){i.enumerateSelection(function(n){n._expandBoundingBoxRecursive(f,-1>>>0);});}break;case Z.Node:if(!n){return this;}if(Array.isArray(n)){n.forEach(function(n){n._expandBoundingBoxRecursive(f,-1>>>0);});}else{n._expandBoundingBoxRecursive(f,-1>>>0);}break;case Z.Restore:s.error(k().getText("VIEWPORT_MSG_RESTORENOTIMPLEMENTED"));return this;case Z.NodeSetIsolation:s.error(k().getText("VIEWPORT_MSG_NODESETISOLATIONNOTIMPLEMENTED"));return this;case Z.RestoreRemoveIsolation:s.error(k().getText("VIEWPORT_MSG_RESTOREREMOVEISOLATIONNOTIMPLEMENTED"));return this;case Z.ViewLeft:case Z.ViewRight:case Z.ViewTop:case Z.ViewBottom:case Z.ViewBack:case Z.ViewFront:return this;default:break;}}.bind(this));var t=function(f){var x=new O();x._zoomTo(f,this._width,this._height,e);this._activateCamera(x,b);}.bind(this);if(f.min.x<f.max.x&&f.min.y<f.max.y){t(f);}else{f={min:{x:0,y:0},max:{x:1,y:1}};t(f);}return this;};w.prototype._activateCamera=function(a,f){if(f>0&&!this._animLoopRequestId){this._anim={start:{time:Date.now(),offsetX:this._camera.offsetX,offsetY:this._camera.offsetY,zoom:this._camera.zoom},end:{offsetX:a.offsetX,offsetY:a.offsetY,zoom:a.zoom},duration:f*1e3};this._startRasterMode();this._animLoopRequestId=window.requestAnimationFrame(this._animLoopFunction);}else{this._camera.zoom=a.zoom;this._camera.offsetX=a.offsetX;this._camera.offsetY=a.offsetY;this._updateViewBox();this._updateRasterImage();this.fireCameraChanged({viewBox:this._getViewBox()});}};w.prototype.beginGesture=function(x,y){this._gestureX=(x-this._camera.offsetX)/this._camera.zoom;this._gestureY=(y-this._camera.offsetY)/this._camera.zoom;};w.prototype.endGesture=function(){this._gestureX=0;this._gestureY=0;this._endRasterMode();};w.prototype._updateRasterImage=function(){if(this._svgElement==null||!this.raster.useRasterMode||!this.raster.bmpCanvas){return;}this.raster.bmpCanvas.width=this._width*devicePixelRatio;this.raster.bmpCanvas.height=this._height*devicePixelRatio;this.raster.bmpCanvas.style.width=this._width+"px";this.raster.bmpCanvas.style.height=this._height+"px";this.raster.bmpCanvas.viewBox=this._getViewBox();if(sap.ui.Device.browser.firefox){this._svgElement.setAttribute("width",this.raster.bmpCanvas.width+"px");this._svgElement.setAttribute("height",this.raster.bmpCanvas.height+"px");}var a=new XMLSerializer().serializeToString(this._svgElement);var b="data:image/svg+xml; charset=utf8, "+encodeURIComponent(a);if(sap.ui.Device.browser.firefox){this._svgElement.setAttribute("width","100%");this._svgElement.setAttribute("height","100%");}this.raster.vectorImage.width=this.raster.bmpCanvas.width;this.raster.vectorImage.height=this.raster.bmpCanvas.height;this.raster.vectorImage.src=b;};w.prototype._startRasterMode=function(a){if(this.raster.timer){clearTimeout(this.raster.timer);this.raster.timer=null;}if(this.raster.rasterMode||!this.raster.useRasterMode||this._svgElement==null){return;}this.raster.rasterMode=true;this.raster.delayEnd=a;this._svgElement.style.display="none";this.raster.bmpCanvas.style.display="block";};w.prototype._endRasterMode=function(){if(!this.raster.rasterMode){return;}var a=function(){this.raster.bmpCanvas.style.display="none";this._svgElement.style.display="";this.raster.rasterMode=false;this._updateRasterImage();}.bind(this);if(this.raster.delayEnd){this.raster.timer=setTimeout(function(){this.raster.timer=null;a();}.bind(this),1000);}else{a();}};w.prototype.pan=function(a,b){if(!this.getFreezeCamera()){this._startRasterMode();this._camera.offsetX+=a;this._camera.offsetY+=b;this._updateViewBox();this.fireCameraChanged({viewBox:this._getViewBox()});}};w.prototype.rotate=function(a,b){this.pan(a,b);};w.prototype.zoom=function(z){if(!this.getFreezeCamera()){this._startRasterMode(true);var a=this._camera.zoom;this._camera.zoom=Math.max(this._camera.zoom*z,O._MIN_ZOOM);this._camera.offsetX+=this._gestureX*(a-this._camera.zoom);this._camera.offsetY+=this._gestureY*(a-this._camera.zoom);this._updateViewBox();this.fireCameraChanged({viewBox:this._getViewBox()});}};w.prototype.hover=function(x,y){var a=this._getViewStateManagerSVG();if(!a){return;}var e=this.getDisableHotspotHovering()?null:this.hitTest(x,y);if(this._hotspotElement&&this._hotspotElement!==e){this.fireHotspotLeave({nodeRef:this._hotspotElement});delete this._hotspotElement._isHovered;delete this._hotspotElement._hoverColor;if(!this.getShowAllHotspots()){if(!this._hotspotElement.isSelected(a._mask)){this._hotspotElement.resetOpacity();}}this._hotspotElement=null;}if(e&&e._vkGetNodeContentType()===N.Hotspot){this._hotspotElement=e;this._hotspotElement._isHovered=true;this._hotspotElement._hoverColor=this.getHotspotColorABGR();if(!this.getShowAllHotspots()){if(!this._hotspotElement.isSelected(a._mask)){var b=r(this.getHotspotColorABGR()).alpha;e.setOpacity(b);}}this.fireHotspotEnter({nodeRef:e});}};w.prototype._getViewBox=function(){return this._camera._getViewBox();};w.prototype._bmpDraw=function(){var a=this._getViewBox();var b=this.raster.bmpCanvas.getContext("2d");b.clearRect(0,0,this.raster.bmpCanvas.width,this.raster.bmpCanvas.height);if(this.raster.bmpCanvas.viewBox){var e=this._camera._worldToScreen(this.raster.bmpCanvas.viewBox[0],this.raster.bmpCanvas.viewBox[1]);var n=this._camera._worldToScreen(a[0],a[1]);b.translate((e.x-n.x)*devicePixelRatio,(e.y-n.y)*devicePixelRatio);var f=this.raster.bmpCanvas.viewBox[3]/a[3];b.scale(f,f);}b.drawImage(this.raster.rasterImage,0,0);this.raster.bmpCanvas.viewBox=a;};w.prototype._updateViewBox=function(){if(this._svgElement==null){return false;}if(this.raster.rasterMode){window.requestAnimationFrame(this._bmpDraw.bind(this));}this._svgElement.setAttribute("viewBox",this._getViewBox().join(" "));if(this._hotspotEffect){var a=this._getHotspotEffectScale();var e=a*8;this._hotspotEffect.setAttribute("x",-e+"%");this._hotspotEffect.setAttribute("y",-e+"%");this._hotspotEffect.setAttribute("width",(100+e*2)+"%");this._hotspotEffect.setAttribute("height",(100+e*2)+"%");this._hotspotEffect.children[0].setAttribute("stdDeviation",a);}return true;};w.prototype._getHotspotEffectScale=function(){return this._camera&&this._camera.zoom>0?8/this._camera.zoom:0;};w.prototype.getViewInfo=function(a){var b={};if(a==null){a={};}if(a.camera==null){a.camera=true;}if(a.camera){b.camera={viewBox:this._getViewBox()};}if(a.visibility&&this._viewStateManager){var e=a.visibility.mode==null?j.Complete:a.visibility.mode;b.visibility={mode:e};if(e===j.Complete){var f=this._viewStateManager.getVisibilityComplete();b.visibility.visible=f.visible;b.visibility.hidden=f.hidden;}else if(this._viewStateManager.getShouldTrackVisibilityChanges()){b.visibility.changes=this._viewStateManager.getVisibilityChanges();}else{s.warning(k().getText(M.VIT32.summary),M.VIT32.code,"sap.ui.vk.threejs.Viewport");}}var i=this._getViewStateManagerSVG();if(a.selection&&i){b.selection=i._getSelectionComplete();}return b;};w.prototype.setViewInfo=function(a,f){var b=a.camera;if(b&&b.viewBox){var n=new O();n._setViewBox(b.viewBox,this._width,this._height);this._activateCamera(n,f);}var e=new Map();if(a.visibility||a.selection){var i=this._viewStateManager.getNodeHierarchy(),t=i.findNodesByName();t.forEach(function(T){var U=i.createNodeProxy(T);var W=U.getVeId();i.destroyNodeProxy(U);if(W){e.set(W,T);}});}if(a.visibility){switch(a.visibility.mode){case j.Complete:var x=a.visibility.visible,y=a.visibility.hidden;x.forEach(function(T){this._viewStateManager.setVisibilityState(e.get(T),true,false);},this);y.forEach(function(T){this._viewStateManager.setVisibilityState(e.get(T),false,false);},this);break;case j.Differences:this._viewStateManager.resetVisibility();a.visibility.changes.forEach(function(T){var U=e.get(T);if(U){this._viewStateManager.setVisibilityState(U,!this._viewStateManager.getVisibilityState(U),false);}},this);break;default:s.error(k().getText(M.VIT28.summary),M.VIT28.code,"sap.ui.vk.threejs.Viewport");break;}}var z=this._getViewStateManagerSVG();var I=a.selection;if(I&&z){var J=z._getSelectionComplete();if(Array.isArray(I.selected)){var P=[];var Q=[];I.selected.forEach(function(T){var U=e.get(T);if(U){P.push(U);}});J.selected.forEach(function(T){var U=e.get(T);if(U&&I.selected.indexOf(T)<0){Q.push(U);}});z.setSelectionStates(P,Q,false,false);}}return this;};w.prototype.queueCommand=function(a){if(this instanceof w){a();}return this;};w.prototype.getOutputSize=function(){var b=this.getDomRef().getBoundingClientRect();var a=b.width;var e=b.height;var f;f=Math.min(a,e);return{left:(a-f)*0.5,top:(e-f)*0.5,sideLength:f};};w.prototype.setShouldRenderFrame=function(){this.invalidate();};w.prototype._isPanoramicActivated=function(){return false;};w.prototype.setShowAllHotspots=function(a){this.setProperty("showAllHotspots",a,true);var b=this._getViewStateManagerSVG();if(b){var n=b.getNodeHierarchy();var e=n.getHotspotNodeIds();var f=this._hotspotElement;var i=this.getShowAllHotspotsTintColor();e.forEach(function(t){if(t.opacity!==undefined&&t.domRef){if(a){t._alwaysVisible=true;t.setTintColor(t.sMask,i);t.setOpacity(1);}else if(t!==f){delete t._alwaysVisible;t.setTintColor(t.sMask,null);t.resetOpacity();}}});if(e.length>0){this.invalidate();}}};w.prototype.setDisableHotspotHovering=function(a){this.setProperty("disableHotspotHovering",a,true);if(a){this.hover(0,0);}var b=this._getViewStateManagerSVG();if(b){var n=b.getNodeHierarchy();var e=n.getHotspotNodeIds();e.forEach(function(f){if(a){f.addClass("sapUiVizKitNonInteractiveHotspot");}else{f.removeClass("sapUiVizKitNonInteractiveHotspot");}});}};w.prototype.setHotspotColorABGR=function(a){this.setProperty("hotspotColorABGR",a,true);this.setProperty("hotspotColor",o(r(a)),true);this.invalidate();return this;};w.prototype.setHotspotColor=function(a){this.setProperty("hotspotColor",a,true);this.setProperty("hotspotColorABGR",q(p(a)),true);this.invalidate();return this;};w.prototype.showHotspots=function(n,a,b){if(n==null){return this;}if(!Array.isArray(n)){n=[n];}var e=b||this.getHotspotColorABGR();n.forEach(function(f){if(a){f._alwaysVisible=true;f.setTintColor(0,e);f.setOpacity(1);}else{delete f._alwaysVisible;f.setTintColor(0,null);f.resetOpacity();}},this);this.invalidate();return this;};w.prototype._getFillStyleId=function(e){if(e.highlightColor||e.tintColor){return null;}var i;if(e.fillStyle&&e.fillStyle.veid!==undefined){i="f"+e.fillStyle.veid;}else if(e.fill!==undefined&&e.fill[3]===0){i="fn";}else{return null;}if(!this._styles.has(i)){var a=[];e._setFillStyleAttributes(function(n,b){a.push(n,b);});this._styles.set(i,a);}return i;};w.prototype._getLineStyleId=function(e){if(e.highlightColor||e.tintColor){return null;}var i;if(e.lineStyle&&e.lineStyle.veid!==undefined){i="l"+e.lineStyle.veid;}else if(e.materialId){i="m"+e.materialId;}else{return null;}if(!this._styles.has(i)){var a=[];e._setLineStyleAttributes(function(n,b){a.push(n,b);});this._styles.set(i,a);}return i;};w.prototype._dumpSceneData=function(){var a=this._scene.getDefaultNodeHierarchy();var b=a.findNodesByName();var x=s.getLevel();s.setLevel(s.Level.INFO);s.info("**************************************");s.info("Nodes in the scene: "+b.length);var y=0;var z=0;var I=0;var J=0;var e=document.getElementsByTagName("svg")[0];var f=function(n){y+=n.children.length;var P=n;var t=1;while(P!=e){P=P.parentNode;t++;}if(z<t){z=t;}if(n.children.length===0){I++;if(n.tagName==="g"){J++;}}for(var i=0;i<n.children.length;i++){f(n.children[i]);}};f(e);s.info("DOM statistics:");s.info("    Nodes:      "+y);s.info("    Tree depth: "+z);s.info("    Leaf nodes: "+I);s.info("    Empty nodes:"+J);s.info("    Groups:     "+document.getElementsByTagName("g").length);s.info("    Lines:      "+document.getElementsByTagName("line").length);s.info("    Polylines:   "+document.getElementsByTagName("polyline").length);s.info("    Polygons:   "+document.getElementsByTagName("polygon").length);s.info("    Paths:      "+document.getElementsByTagName("path").length);s.info("    Ellipses:   "+document.getElementsByTagName("ellipse").length);s.info("    Rectangles: "+document.getElementsByTagName("rect").length);s.info("    Texts:      "+document.getElementsByTagName("text").length);s.info("    Images:     "+document.getElementsByTagName("image").length);s.info("**************************************");s.setLevel(x);};return w;});
