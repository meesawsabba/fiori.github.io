/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["../abgrToColor","../cssColorToColor","../NodeContentType","sap/base/util/uid"],function(d,e,N,u){"use strict";var E=function(p){p=p||{};this.type="Group";this.uid=u();this.sid=p.sid||undefined;this.name=p.name||undefined;this.vMask=(1|0);this.sMask=(0|0);this.matrix=new Float32Array(p.matrix||[1,0,0,1,0,0]);this.parent=null;this.children=[];this.domRef=null;this.nodeContentType=N.Regular;this.materialId=p.materialID;if(p.lineStyle){this.lineStyle=p.lineStyle;}if(p.fillStyle){this.fillStyle=p.fillStyle;}this.userData=p.subelement?{skipIt:true}:{};this.classList=new Set();};function h(c,a){if(c===null||c===undefined){return Float32Array([0.0,0.0,0.0,a]);}var r=c.match(/\w\w/g).map(function(x){return parseInt(x,16);});if(r.length==4){a=r[3]/255;}if(r.length<3||isNaN(r[0]+r[1]+r[2]+a)){c=e(c);return new Float32Array([c.red/255,c.green/255,c.blue/255,c.alpha]);}return new Float32Array([r[0]/255,r[1]/255,r[2]/255,a]);}function k(c,a){if(c){if(typeof c==="string"){return h(c,a);}else if(c.length===4){return new Float32Array(c);}else{return new Float32Array([c[0],c[1],c[2],a]);}}return new Float32Array([0,0,0,0]);}E.prototype.defaultFillAlpha=0;E.prototype.setFillStyle=function(f,i){if(f){if(f.fillURL){this.fillURL=f.fillURL;}else{this.fill=k(f.colour,1);}}else{this.fill=new Float32Array([0,0,0,0]);}if(this._fillStyleId){this.removeClass(this._fillStyleId);this._fillStyleId=null;}if(i){this.invalidate();}};E.prototype.setLineStyle=function(l,i){if(l){this.stroke=k(l.colour,1);this.strokeWidth=l.width||1;this.strokeDashArray=E._convertDashes(l.dashes||[],this.strokeWidth);}else{this.stroke=new Float32Array([0,0,0,0]);this.strokeWidth=1;this.strokeDashArray=[];}if(this._lineStyleId){this.removeClass(this._lineStyleId);this._lineStyleId=null;}if(i){this.invalidate();}};E.prototype.setMaterial=function(m,a){m=m||{};if(this.materialId===m.materialId){this.setFillStyle(this.fillStyle);var b=this.lineStyle;if(b){this.setLineStyle(b);}else{this.stroke=k(m.lineColor,1);this.strokeWidth=m.lineWidth!==undefined?m.lineWidth:1;this.strokeDashArray=(m.lineStyle&&m.lineStyle.dashPattern)||[];}}for(var i=0,l=this.children.length;i<l;i++){this.children[i].setMaterial(m);}if(a){this.invalidate();}};E._convertDashes=function(a,s){var b=[];for(var i=0;i<a.length;i++){var n=a[i]*10;if(n>0){b.push(n);b.push(0);}else if(n<0){b.push(0);b.push(-n);}else{b.push(s);b.push(s);}}return b;};E._convertToDashes=function(c,s){var f=[];for(var i=0;i<c.length;i+=2){var a=c[i];var b=c[i+1];if(a===s&&b===s){f.push(0);}else if(b===0){f.push(a*0.1);}else if(a===0){f.push(b*-0.1);}}return f;};E.prototype.add=function(a){if(a.parent!==null){a.parent.remove(a);}a.parent=this;this.children.push(a);a.sMask=this.sMask;if(this.highlightColor){a.highlightColor=this.highlightColor;}if(this.domRef){a.traverse(function(c){if(!c.domRef){c.domRef=z(c)?c.parent.domRef:c._createDomElement();}if(c.domRef&&c.parent.domRef&&c.parent.domRef!==c.domRef&&c.domRef.parentNode!==c.parent.domRef){c.parent.domRef.appendChild(c.domRef);}});}return this;};E.prototype.remove=function(a){var i=this.children.indexOf(a);if(i!==-1){if(a.domRef&&this.domRef&&a.domRef.parentNode===this.domRef){this.domRef.removeChild(a.domRef);}a.parent=null;this.children.splice(i,1);}return this;};E.prototype.replace=function(a,n){var i=this.children.indexOf(a);if(i!==-1){a.parent=null;n.parent=this;this.children[i]=n;n.domRef=a.domRef;n.invalidate();}return this;};E.prototype._vkPersistentId=function(){var a=this;do{if(a.sid){return a.sid;}a=a.parent;}while(a);return null;};E.prototype._vkGetNodeContentType=function(){return this.nodeContentType;};E.prototype._initAsHotspot=function(a){var b=this.parent;while(b){if(b.nodeContentType===N.Hotspot){return;}b=b.parent;}if(a!==undefined){this.opacity=a;}this.traverse(function(n){if(n!==this){n.userData.skipIt=true;}n.fill=n.stroke=new Float32Array([1,1,1,1]);}.bind(this));};E.prototype._vkSetNodeContentType=function(n){this.nodeContentType=n;if(n===N.Hotspot){this._initAsHotspot(0);}};E.prototype.traverse=function(c){c(this);var a=this.children;for(var i=0,l=a.length;i<l;i++){a[i].traverse(c);}};E.prototype.traverseAncestors=function(c){var p=this.parent;if(p!==null){c(p);p.traverseAncestors(c);}};E.prototype.traverseVisible=function(c,m){if(this.isVisible(m)){c(this);var a=this.children;for(var i=0,l=a.length;i<l;i++){a[i].traverseVisible(c,m);}}};E.prototype.setVisible=function(m,a){if(!this.userData.skipIt){if(a){this.vMask|=m;}else{this.vMask&=~m;}if(this.domRef!==null){if(this.parent&&((this.domRef===this.parent.domRef)^z(this))){this.invalidate();}else if(a){this.domRef.removeAttribute("display");}else{this.domRef.setAttribute("display","none");}}}};E.prototype.isVisible=function(m){return this.userData.skipIt||(this.vMask&m)!==0;};E.prototype._updateColor=function(m){var a=this.domRef;if(a!==null){var s=a.setAttribute.bind(a);if(this.highlightColor||this.tintColor){if(this._fillStyleId){this.removeClass(this._fillStyleId);}this._setFillStyleAttributes(s);if(this._lineStyleId){this.removeClass(this._lineStyleId);}this._setLineStyleAttributes(s);}else{if(this._fillStyleId){this.addClass(this._fillStyleId);a.removeAttribute("fill");}else{this._setFillStyleAttributes(s);}if(this._lineStyleId){this.addClass(this._lineStyleId);a.removeAttribute("stroke");a.removeAttribute("stroke-width");a.removeAttribute("vector-effect");a.removeAttribute("stroke-dasharray");}else{this._setLineStyleAttributes(s);}}if(this.nodeContentType===N.Hotspot&&!this._hasHostpotAncestor()){if(this.isSelected(m)){a.setAttribute("filter","");}else{a.setAttribute("filter","url(#"+this.getHotspotEffectDef().name+")");}}}};E.prototype.getHotspotEffectDef=function(){if(this.getTintColor()==null){return{name:"hotspot-effect"};}var c=e(this.getTintColor(),1);return{name:"hotspot-effect-"+c.red+c.green+c.blue+c.alpha,color:c};};E.prototype.setSelected=function(m,s,a){if(s){this.sMask|=m;this.highlightColor=a;}else{this.sMask&=~m;delete this.highlightColor;}this._updateColor(m);if(this.opacity!==undefined){var b=d(a).alpha;if(s){this.setOpacity(b);}else{this.resetOpacity();}}};E.prototype.isSelected=function(m){return(this.sMask&m)!==0;};E.prototype.setTintColor=function(m,a){this.tintColor=a;this._updateColor(m);};E.prototype.getTintColor=function(){return this.tintColor;};E.prototype._setOpacity=function(a){if(this.domRef!==null){if(this.parent&&((this.domRef===this.parent.domRef)^z(this))){this.invalidate();}else if(a!==undefined){this.domRef.setAttribute("opacity",a);}else{this.domRef.removeAttribute("opacity");}}};E.prototype._isGeometryNode=function(){return this.constructor!==E;};E.prototype._getFurthestParentWithOpacity=function(){var p=this.parent;var a;while(p){if(p.opacity){a=p.opacity;}p=p.parent;}return a;};E.prototype.setOpacity=function(a){if(this._isGeometryNode()){return;}var b=[];this.opacity=a;if(this.nodeContentType===N.Hotspot){this._setOpacity(a);return;}this.traverse(function(c){if(c._isGeometryNode()){b.push(c);}});b.forEach(function(l){var s=a;if(a===undefined){if(l.opacity){s=l.opacity;}else{s=l._getFurthestParentWithOpacity();}}l._setOpacity(s);});};E.prototype.resetOpacity=function(){if(this._alwaysVisible){this.setOpacity(1);}else if(this._isHovered){var a=d(this._hoverColor).alpha;this.setOpacity(a);}else if(this.getTintColor()){this.setOpacity(e(this.getTintColor()).alpha);}else{this.setOpacity(0);}};function o(m){return m[0]===1&&m[1]===0&&m[2]===0&&m[3]===1&&m[4]===0&&m[5]===0;}E.prototype.setMatrix=function(m){this.matrix.set(m);if(this.domRef!==null){if(this.parent&&((this.domRef===this.parent.domRef)^z(this))){this.invalidate();}else if(!this.parent||this.domRef!==this.parent.domRef){if(!o(m)){this.domRef.setAttribute("transform","matrix("+this.matrix.join(",")+")");}else{this.domRef.removeAttribute("transform");}}}};E._multiplyMatrices=function(a,b){var c=a[0],f=a[2],g=a[4];var i=a[1],j=a[3],l=a[5];var m=b[0],n=b[2],p=b[4];var q=b[1],r=b[3],s=b[5];return new Float32Array([c*m+f*q,i*m+j*q,c*n+f*r,i*n+j*r,c*p+f*s+g,i*p+j*s+l]);};E._invertMatrix=function(m){var a=m[0],b=m[1],c=m[2],f=m[3],g=m[4],i=m[5],j=a*f-b*c;if(j===0){return new Float32Array([0,0,0,0,0,0]);}var l=1/j;var n=new Float32Array(6);n[0]=f*l;n[1]=-b*l;n[2]=-c*l;n[3]=a*l;n[4]=(i*c-f*g)*l;n[5]=(b*g-i*a)*l;return n;};E._decompose=function(m){var a=Math.sqrt(m[0]*m[0]+m[1]*m[1]);var b=Math.sqrt(m[2]*m[2]+m[3]*m[3]);var c=m[0]/a,f=m[1]/a,g=m[2]/b,i=m[3]/b;var q,s;if(c+i+1>0){s=0.5/Math.sqrt(2+c+i);q=[0,0,(f-g)*s,0.25/s];}else{s=2.0*Math.sqrt(2-c-i);q=[0,0,0.25*s,(f-g)/s];}return{position:[m[4],m[5],0],quaternion:q,scale:[a,b,1]};};E._compose=function(p,q,s){var a=s[0],b=s[1];var c=q[2],f=q[3];var g=c*c*2,i=f*c*2;return new Float32Array([(1-g)*a,i*a,-i*b,(1-g)*b,p[0],p[1]]);};E._transformPoint=function(p,a,m){return{x:p*m[0]+a*m[2]+m[4],y:p*m[1]+a*m[3]+m[5]};};E.prototype._matrixWorld=function(m){if(m!==undefined){return E._multiplyMatrices(m,this.matrix);}else{var p=this.parent;var a=this.matrix;while(p!==null){a=E._multiplyMatrices(p.matrix,a);p=p.parent;}return a;}};function t(b,x,y,a,c){b.min.x=Math.min(b.min.x,x-a);b.min.y=Math.min(b.min.y,y-c);b.max.x=Math.max(b.max.x,x+a);b.max.y=Math.max(b.max.y,y+c);}function v(a){return a*a;}E.prototype._expandBoundingBoxCE=function(b,m,c,a,f,g){t(b,c*m[0]+a*m[2]+m[4],c*m[1]+a*m[3]+m[5],Math.abs(f*m[0])+Math.abs(g*m[2]),Math.abs(f*m[1])+Math.abs(g*m[3]));};E.prototype._expandBoundingBoxCR=function(b,m,c,a,r,f){t(b,c*m[0]+a*m[2]+m[4],c*m[1]+a*m[3]+m[5],Math.sqrt(v(r*m[0])+v(f*m[2])),Math.sqrt(v(r*m[1])+v(f*m[3])));};E.prototype._expandBoundingBox=function(b,m){};E.prototype._expandBoundingBoxRecursive=function(b,m,a){if(this.isVisible(m)){var c=this._matrixWorld(a);this._expandBoundingBox(b,c);var f=this.children;for(var i=0,l=f.length;i<l;i++){f[i]._expandBoundingBoxRecursive(b,m,c);}}};function w(b,m){var a=b.width*0.5;var c=b.height*0.5;var f=b.x+a;var g=b.y+c;var i=f*m[0]+g*m[2]+m[4];var j=f*m[1]+g*m[3]+m[5];var l=Math.abs(a*m[0])+Math.abs(c*m[2]);var n=Math.abs(a*m[1])+Math.abs(c*m[3]);return{x:i-l,y:j-n,width:l*2,height:n*2};}E.prototype._getBBox=function(m){if(this.domRef){var b;if(!this.parent||this.domRef!==this.parent.domRef){b=this.domRef.getBBox();if(m&&b){b=w(b,m);}return b;}var a=Infinity,c=Infinity,f=-Infinity,g=-Infinity;for(var i=0,l=this.children.length;i<l;i++){var j=this.children[i];b=j._getBBox(m?E._multiplyMatrices(m,j.matrix):j.matrix);if(b){a=Math.min(a,b.x);c=Math.min(c,b.y);f=Math.max(f,b.x+b.width);g=Math.max(g,b.y+b.height);}}if(a<=f&&c<=g){return{x:a,y:c,width:f-a,height:g-c};}}return null;};function z(a){return a.parent!==null&&a.constructor===E&&o(a.matrix)&&a.opacity===undefined&&a.vMask===1;}E.prototype._getSceneTreeElement=function(){var a=this;var p=a.parent;while(p){if(p.userData.closed||p.nodeContentType!==N.Regular){a=p;}p=p.parent;}while(a.userData.skipIt){a=a.parent;}return a;};function A(c,m,r){function g(q,y,G){var H,I;for(var i=0,l=q.length;i<l;i++){var p=q[i];var J=y*p.x+G*p.y;if(i===0||H>J){H=J;}if(i===0||I<J){I=J;}}return{min:H,max:I};}var f=[E._transformPoint(c.x,c.y,m),E._transformPoint(c.x+c.width,c.y,m),E._transformPoint(c.x+c.width,c.y+c.height,m),E._transformPoint(c.x,c.y+c.height,m)];var n=[{x:r.x1,y:r.y1},{x:r.x2,y:r.y1},{x:r.x2,y:r.y2},{x:r.x1,y:r.y2}];var q=f.concat(n);for(var i=0,j=q.length-1;i<q.length;j=i++){var s=q[j];var x=q[i];var y=x.y-s.y,G=s.x-x.x;var a=g(f,y,G);var b=g(n,y,G);if(a.max<b.min||b.max<a.min){return false;}}return true;}E.prototype._findRectElementsRecursive=function(s,r,m,a){if(this.isVisible(m)){var b=this._matrixWorld(a);if(this._isGeometryNode()){var c=this._getBBox();if(c&&A(c,b,r)){s.add(this._getSceneTreeElement());}}var f=this.children;for(var i=0,l=f.length;i<l;i++){f[i]._findRectElementsRecursive(s,r,m,b);}}};E.prototype.tagName=function(){return"g";};E.prototype._setBaseAttributes=function(s,m){s("id",this.uid);if(this.opacity!==undefined){s("opacity",this.nodeContentType===N.Hotspot&&this.isSelected(m)?(this.opacity*0.5+0.5):this.opacity);}if(!o(this.matrix)){s("transform","matrix("+this.matrix.join(",")+")");}if(!this.isVisible(m)){s("display","none");}if(!this._fillStyleId||!this.classList.has(this._fillStyleId)){this._setFillStyleAttributes(s);}if(!this._lineStyleId||!this.classList.has(this._lineStyleId)){this._setLineStyleAttributes(s);}if(this.nodeContentType===N.Hotspot&&!this.isSelected(m)){if(!this._hasHostpotAncestor()){s("filter","url(#"+this.getHotspotEffectDef().name+")");}}if(this.classList.size){s("class",Array.from(this.classList).join(" "));}};E.prototype._setSpecificAttributes=function(s,a){};E.prototype._setFillStyleAttributes=function(s){if(this.fillURL!==undefined){s("fill",this.fillURL);}else if(this.fill!==undefined){s("fill",this._cssColor(this.fill));}};E.prototype._setLineStyleAttributes=function(s){if(this.stroke!==undefined&&this.stroke[3]>0&&this.strokeWidth){s("stroke",this._cssColor(this.stroke));if(this.strokeWidth!==1){s("stroke-width",this.strokeWidth);}s("vector-effect","non-scaling-stroke");if(this.strokeDashArray.length>0){s("stroke-dasharray",this.strokeDashArray.join(" "));}}};E.prototype.render=function(r,m,a){var s=z(this),b;if(!s){b=this.tagName();r.write("<"+b);if(a&&this._isGeometryNode()){var f=a._getFillStyleId(this);if(this._fillStyleId!==f){if(this._fillStyleId){this.removeClass(this._fillStyleId);}this._fillStyleId=f;if(f){this.addClass(this._fillStyleId);}}var l=a._getLineStyleId(this);if(this._lineStyleId!==l){if(this._lineStyleId){this.removeClass(this._lineStyleId);}this._lineStyleId=l;if(l){this.addClass(this._lineStyleId);}}}var c=r.writeAttribute.bind(r);this._setBaseAttributes(c,m);this._setSpecificAttributes(c,null);r.write(">");if(this._renderContent){this._renderContent(r);}}var g=[];this.children.forEach(function(i){if(i.nodeContentType===N.Hotspot){g.push(i);}else{i.render(r,m,a);}});g.forEach(function(i){i.render(r,m);});if(!s){r.write("</"+b+">");}};E._svgNamespace="http://www.w3.org/2000/svg";E.prototype._createDomElement=function(c){var a=document.createElementNS(E._svgNamespace,this.tagName());var s=a.setAttribute.bind(a);this._setBaseAttributes(s,1<<c);this._setSpecificAttributes(s,a);if(this._createContent){this._createContent(a);}return a;};function B(n,p){var a=n.domRef;if(a&&a!==p&&a.parentNode===p){return a;}var c=n.children;for(var i=0,l=c.length;i<l;i++){a=B(c[i],p);if(a!==null){return a;}}return null;}E.prototype._replaceParentDomRef=function(a,n){for(var i=0,l=this.children.length;i<l;i++){var c=this.children[i];if(c.domRef){if(c.domRef===a){c.domRef=n;c._replaceParentDomRef(a,n);}else if(c.domRef.parentNode===a){if(a.parentNode===n){n.insertBefore(c.domRef,a);}else{n.appendChild(c.domRef);}}}}};E.prototype.invalidate=function(c){var a=this.domRef;if(a!==null){var p=this.parent&&this.parent.domRef;if(z(this)){if(a!==p){this.domRef=p;this._replaceParentDomRef(a,this.domRef);a.remove();}}else{this.domRef=this._createDomElement(c);if(a===p){p.insertBefore(this.domRef,B(this,p));}else if(p){p.replaceChild(this.domRef,a);}this._replaceParentDomRef(a,this.domRef);}}};E.prototype._setDomRef=function(a){this.domRef=a;var c=this.children;for(var i=0,l=c.length;i<l;i++){var b=c[i];var f=document.getElementById(b.uid);if(f===null&&z(b)){f=a;}b._setDomRef(f);}};E.prototype.getElementByProperty=function(n,a){if(this[n]===a){return this;}var c=this.children;for(var i=0,l=c.length;i<l;i++){var b=c[i].getElementByProperty(n,a);if(b!==null){return b;}}return null;};E.prototype.getElementById=function(i){return this.getElementByProperty("uid",i);};E.prototype.copy=function(s,r){this.name=s.name;this.matrix=s.matrix.slice();this.nodeContentType=s.nodeContentType;this.materialId=s.materialId;this.lineStyle=s.lineStyle;this.fillStyle=s.fillStyle;this.classList=new Set(s.classList);if(s.opacity!==undefined){this.opacity=s.opacity;}if(s.tintColor!==undefined){this.tintColor=s.tintColor;}if(s.fillURL!==undefined){this.fillURL=s.fillURL;}if(s.fill!==undefined){this.fill=s.fill.slice();}if(s.stroke!==undefined){this.stroke=s.stroke.slice();}if(s.strokeWidth!==undefined){this.strokeWidth=s.strokeWidth;}if(s.strokeDashArray!==undefined){this.strokeDashArray=s.strokeDashArray.slice();}if(s.userData.skipIt){this.userData.skipIt=true;}if(r||r===undefined){for(var i=0,l=s.children.length;i<l;i++){this.add(s.children[i].clone());}}return this;};E.prototype.clone=function(){return new this.constructor().copy(this);};function C(a,b,f){return a+(b-a)*f;}function D(r,g,b,a){var c=((r<<24)|(g<<16)|(b<<8)|(a*255))>>>0;return"#"+("00000000"+c.toString(16)).slice(-8);}function F(c){return D(c[0]*255,c[1]*255,c[2]*255,c[3]);}E.prototype._cssColor=function(c){var a=c[3];if(a===0){return"none";}var r=c[0]*255;var g=c[1]*255;var b=c[2]*255;var f=this.tintColor;if(f){f=d(f);var i=f.alpha;if(i>0){r=C(r,f.red,i);g=C(g,f.green,i);b=C(b,f.blue,i);}}var j=this.highlightColor;if(j){j=d(j);var l=j.alpha;if(l>0){r=C(r,j.red,l);g=C(g,j.green,l);b=C(b,j.blue,l);a=C(a,l,l);}}return D(r,g,b,a);};E.prototype._getParametricShape=function(f,l,a){var p={};if(!o(this.matrix)){var b=E._decompose(this.matrix);p.t=b.position;p.r=b.quaternion;p.s=b.scale;}if(this.fill!==undefined){p.fill=f.length;f.push({colour:F(this.fill)});}if(this.stroke!==undefined&&this.stroke[3]>0&&this.strokeWidth){p.stroke=l.length;var c={colour:F(this.stroke),width:this.strokeWidth};if(this.strokeDashArray.length>0){c.dashes=E._convertToDashes(this.strokeDashArray,this.strokeWidth);}l.push(c);}return p;};E.prototype.getParametricContent=function(f,l,a){var s=[];this.children.forEach(function(c){var b=c._getParametricShape(f,l,a);if(b.type!==undefined){s.push(b);}});if(s.length===0){return null;}return s.length===1?s[0]:{shapes:s};};E.prototype._hasHostpotAncestor=function(){var a=this.parent,b=false;while(a&&!b){if(a.nodeContentType===N.Hotspot){b=true;}a=a.parent;}return b;};E.prototype.addClass=function(c){this.classList.add(c);if(this.domRef){this.domRef.setAttribute("class",Array.from(this.classList).join(" "));}return this;};E.prototype.removeClass=function(c){this.classList.delete(c);if(this.domRef){if(this.classList.size){this.domRef.setAttribute("class",Array.from(this.classList).join(" "));}else{this.domRef.removeAttribute("class");}}return this;};E.prototype.hasClass=function(c){return this.classList.has(c);};E.prototype.toggleClass=function(c){if(this.hasClass(c)){this.removeClass(c);}else{this.addClass(c);}return this;};return E;});
