/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/base/EventProvider","../svg/Element"],function(E,a){"use strict";var T=E.extend("sap.ui.vk.tools.TransformSvgElementToolHandler",{metadata:{},constructor:function(t){this._priority=10;this._tool=t;this._gizmo=t.getGizmo();this._rect=null;}});T.prototype._getPosition=function(e){return this._tool._viewport._camera._screenToWorld(e.x-this._rect.x,e.y-this._rect.y);};T.prototype._getGizmoHandle=function(e){var v=this._tool._viewport;if(!v||!this._gizmo||!this._inside(e)){return null;}if(e.scroll!==undefined){return null;}var c=v._camera;var n=this._gizmo._nodes;if(!c||!n||n.length===0){return null;}var m=e.x-this._rect.x;var b=e.y-this._rect.y;var w=this._getPosition(e);var s=12;var g=-1;for(var d=0;d<n.length;d++){var f=n[d];var h=f.node;var j=h._getBBox();if(!j){continue;}var k=h._matrixWorld();var l=this._gizmo._getHandleLocalPositions(f,k);var o=[0,4,2,6,8,1,3,5,7];for(var i=0;i<9;i++){var p=o[i];var q=a._transformPoint(l[p*2],l[p*2+1],k);var r=c._worldToScreen(q.x,q.y);if(m>=r.x-s&&m<=r.x+s&&b>=r.y-s&&b<=r.y+s){return{gizmoIndex:d,handleIndex:p,angle:Math.atan2(k[2],k[3])};}}if(g<0){var t=s/(c.zoom*Math.sqrt(k[0]*k[0]+k[1]*k[1]));var u=s/(c.zoom*Math.sqrt(k[2]*k[2]+k[3]*k[3]));var x=a._transformPoint(w.x,w.y,a._invertMatrix(k));if(x.x>=j.x-t&&x.x<=j.x+j.width+t&&x.y>=j.y-u&&x.y<=j.y+j.height+u){g=d;}}}return g<0?null:{gizmoIndex:g,handleIndex:-1};};T.prototype.hover=function(e){if(this._gizmo){var h=this._getGizmoHandle(e);if(h){this._gizmo._selectHandle(h.gizmoIndex,h.handleIndex);}else{this._gizmo._selectHandle(-1,-1);}}};T.prototype.beginGesture=function(e){this._handle=this._getGizmoHandle(e);if(this._handle){e.handled=true;this._gizmo._selectHandle(this._handle.gizmoIndex,this._handle.handleIndex);this._startPos=this._getPosition(e);this._gizmo._beginGesture();}};T.prototype.move=function(e){if(this._handle&&this._inside(e)){e.handled=true;var p=this._getPosition(e);this._gizmo._update(p.x-this._startPos.x,p.y-this._startPos.y,e.event&&(sap.ui.Device.os.macintosh?e.event.metaKey:e.event.ctrlKey));}};T.prototype.endGesture=function(e){if(this._handle){this._handle=null;e.handled=true;this._gizmo._endGesture();}};T.prototype.click=function(e){};T.prototype.doubleClick=function(e){};T.prototype.contextMenu=function(e){};T.prototype.getViewport=function(){return this._tool._viewport;};T.prototype._getOffset=function(o){var r=o.getBoundingClientRect();var p={x:r.left+window.pageXOffset,y:r.top+window.pageYOffset};return p;};T.prototype._inside=function(e){var i=this._tool._viewport.getIdForLabel();var d=document.getElementById(i);if(d==null){return false;}var o=this._getOffset(d);this._rect={x:o.x,y:o.y,w:d.offsetWidth,h:d.offsetHeight};return(e.x>=this._rect.x&&e.x<=this._rect.x+this._rect.w&&e.y>=this._rect.y&&e.y<=this._rect.y+this._rect.h);};return T;});
