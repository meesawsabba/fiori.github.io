/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["./CreateParametricGizmo","../svg/Element","../svg/Text","sap/ui/richtexteditor/RichTextEditor"],function(G,E,T,R){"use strict";var C=G.extend("sap.ui.vk.tools.CreateTextToolGizmo",{metadata:{library:"sap.ui.vk"}});C.prototype.hasDomElement=function(){return true;};C.prototype.show=function(v,t){this._viewport=v;this._tool=t;this._editForm=null;this.updateParentNode();};C.prototype.hide=function(){this._viewport=null;this._tool=null;this._root=null;if(this._editForm){this._editForm.close();this._editForm=null;}};C.prototype._createText=function(p,t){if(this._editForm){return;}var s=1/this._viewport._camera.zoom;var n=E._multiplyMatrices(E._invertMatrix(this._root._matrixWorld()),[s,0,0,s,p.x,p.y]);var a=[1,0,0,n[3]<0?-1:1,0,0];if(n[3]<0){n[2]*=-1;n[3]*=-1;}var b=new T({subelement:true,text:t,style:{size:this._tool.getFontSize(),fontFace:this._tool.getFontFace()},matrix:a,lineStyle:this._tool._lineStyle,fillStyle:this._tool._fillStyle});var c=new E({name:"Text",matrix:n});c.add(b);this._root.add(c);this._editText(b);};C.prototype._editText=function(t){var d=this.getDomRef();if(!d){this._editElementWhenReady=t;return;}var p=E._transformPoint(t.x,t.y,t._matrixWorld());var s=this._viewport._camera._worldToScreen(p.x,p.y);d.style.left=s.x+"px";d.style.top=s.y+"px";var e=this._editForm=new sap.m.Popover({showHeader:false,placement:sap.m.PlacementType.PreferredLeftOrFlip,content:new sap.m.VBox({items:[new R({width:"500px",height:"200px",wrapping:false,customToolbar:true,showGroupUndo:true,showGroupFont:true,showGroupTextAlign:false,value:t.getHtmlTextContent(),change:function(a){t.setHtmlTextContent(this.getValue());},customButtons:[new sap.m.Button({text:"OK",press:function(){e.close();}})]}).addStyleClass("sapUiSizeCompact"),new sap.m.Button({text:"OK",press:function(){e.close();}})]})});e.attachAfterClose(function(){this._tool.fireCompleted({node:t.parent,request:this._createRequest(t.parent)});this._tool.setActive(false);this._editForm=null;}.bind(this));e.openBy(this);};C.prototype.onAfterRendering=function(){if(this._editElementWhenReady){this._editText(this._editElementWhenReady);this._editElementWhenReady=null;}};return C;});
