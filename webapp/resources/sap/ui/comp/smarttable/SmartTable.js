/*
 * ! SAPUI5
 * (c) Copyright 2009-2021 SAP SE. All rights reserved.
 */
sap.ui.define(['sap/ui/thirdparty/jquery','sap/m/library','sap/ui/core/library','sap/ui/core/Core','sap/ui/core/ShortcutHintsMixin','sap/ui/core/format/ListFormat','sap/ui/events/KeyCodes','sap/ui/comp/util/DateTimeUtil','sap/ui/comp/util/FilterUtil','sap/m/Column','sap/m/ColumnListItem','sap/m/Label','sap/m/MessageBox','sap/m/Table','sap/m/Text','sap/m/Title','sap/m/OverflowToolbar','sap/m/ToolbarSpacer','sap/m/OverflowToolbarButton','sap/m/ToolbarSeparator','sap/m/VBox','sap/m/FlexItemData','sap/ui/comp/library','sap/ui/comp/providers/TableProvider','sap/ui/comp/smartvariants/SmartVariantManagement','sap/ui/model/Sorter','sap/ui/model/Filter','sap/ui/model/FilterOperator','sap/ui/model/json/JSONModel','sap/ui/table/AnalyticalColumn','sap/ui/table/AnalyticalTable','sap/ui/table/Column','sap/ui/table/Table','sap/ui/table/TreeTable','sap/ui/comp/personalization/Controller','sap/ui/comp/personalization/Util','sap/ui/comp/util/FormatUtil','sap/ui/comp/util/FullScreenUtil','sap/ui/comp/odata/ODataModelUtil','sap/ui/comp/odata/ODataType','sap/ui/comp/state/UIState','sap/ui/comp/smartvariants/PersonalizableInfo','sap/ui/core/format/NumberFormat','sap/ui/Device','sap/base/Log','sap/base/util/deepEqual','sap/base/util/merge',"sap/m/ColumnHeaderPopover",'sap/m/ColumnPopoverActionItem','sap/m/Menu','sap/m/MenuButton','sap/m/MenuItem','sap/m/Button','sap/m/Link','sap/m/MessageStrip','sap/ui/core/InvisibleMessage','sap/ui/util/openWindow','sap/ui/core/theming/Parameters','sap/m/plugins/ColumnResizer',"sap/m/ColumnPopoverSelectListItem","sap/m/table/Util"],function(q,M,c,C,S,L,K,D,F,a,b,d,f,R,T,g,O,h,j,k,V,l,m,n,o,p,r,s,J,A,t,u,v,w,x,P,y,z,B,E,U,G,N,H,I,Q,W,X,Y,Z,$,_,a1,b1,c1,d1,e1,f1,g1,h1,i1){"use strict";var j1=M.ButtonType;var k1=M.MenuButtonMode;var l1=M.ToolbarDesign;var m1=M.ToolbarStyle;var n1=c.SortOrder;var o1=m.smarttable.InfoToolbarBehavior;var p1=V.extend("sap.ui.comp.smarttable.SmartTable",{metadata:{library:"sap.ui.comp",designtime:"sap/ui/comp/designtime/smarttable/SmartTable.designtime",properties:{entitySet:{type:"string",group:"Misc",defaultValue:null},smartFilterId:{type:"string",group:"Misc",defaultValue:null},ignoredFields:{type:"string",group:"Misc",defaultValue:null},initiallyVisibleFields:{type:"string",group:"Misc",defaultValue:null},requestAtLeastFields:{type:"string",group:"Misc",defaultValue:null},ignoreFromPersonalisation:{type:"string",group:"Misc",defaultValue:null},tableType:{type:"sap.ui.comp.smarttable.TableType",group:"Misc",defaultValue:null},useVariantManagement:{type:"boolean",group:"Misc",defaultValue:true},showVariantManagement:{type:"boolean",group:"Misc",defaultValue:true},useExportToExcel:{type:"boolean",group:"Misc",defaultValue:true},exportType:{type:"sap.ui.comp.smarttable.ExportType",group:"Misc",defaultValue:"UI5Client"},useTablePersonalisation:{type:"boolean",group:"Misc",defaultValue:true},showTablePersonalisation:{type:"boolean",group:"Misc",defaultValue:true},showRowCount:{type:"boolean",group:"Misc",defaultValue:true},header:{type:"string",group:"Misc",defaultValue:null},headerLevel:{type:"sap.ui.core.TitleLevel",group:"Appearance",defaultValue:sap.ui.core.TitleLevel.Auto},toolbarStyleClass:{type:"string",group:"Misc",defaultValue:null},enableCustomFilter:{type:"boolean",group:"Misc",defaultValue:true},persistencyKey:{type:"string",group:"Misc",defaultValue:null},useOnlyOneSolidToolbar:{type:"boolean",group:"Misc",defaultValue:false},placeToolbarInTable:{type:"boolean",group:"Misc",defaultValue:false},currentVariantId:{type:"string",group:"Misc",defaultValue:null},editable:{type:"boolean",group:"Misc",defaultValue:false},enableAutoBinding:{type:"boolean",group:"Misc",defaultValue:false},tableBindingPath:{type:"string",group:"Misc",defaultValue:null},editTogglable:{type:"boolean",group:"Misc",defaultValue:false},demandPopin:{type:"boolean",group:"Misc",defaultValue:false},showFullScreenButton:{type:"boolean",group:"Misc",defaultValue:false},initialNoDataText:{type:"string",group:"Misc",defaultValue:null},useInfoToolbar:{type:"sap.ui.comp.smarttable.InfoToolbarBehavior",group:"Behavior",defaultValue:o1.Auto},showDetailsButton:{type:"boolean",group:"Misc",defaultValue:false},detailsButtonSetting:{type:"sap.ui.core.Priority[]",group:"Behavior"},enableAutoColumnWidth:{type:"boolean",group:"Misc",defaultValue:false},showPasteButton:{type:"boolean",group:"Behavior",defaultValue:false},enablePaste:{type:"boolean",group:"Behavior",defaultValue:true}},associations:{smartVariant:{type:"sap.ui.core.Control",multiple:false}},aggregations:{customToolbar:{type:"sap.m.Toolbar",multiple:false},semanticObjectController:{type:"sap.ui.comp.navpopover.SemanticObjectController",multiple:false},noData:{type:"sap.ui.core.Control",altTypes:["string"],multiple:false},semanticKeyAdditionalControl:{type:"sap.ui.core.Control",multiple:false},dataStateIndicator:{type:"sap.m.plugins.DataStateIndicator",multiple:false}},events:{initialise:{},beforeRebindTable:{},editToggled:{},dataRequested:{},dataReceived:{},afterVariantInitialise:{},afterVariantSave:{parameters:{currentVariantId:{type:"string"}}},afterVariantApply:{parameters:{currentVariantId:{type:"string"}}},showOverlay:{},fieldChange:{},fullScreenToggled:{parameters:{fullScreen:{type:"boolean"}}},beforeExport:{parameters:{exportSettings:{type:"object"},userExportSettings:{type:"object"}}},beforePaste:{allowPreventDefault:true,parameters:{columnInfos:{type:"object[]"}}},paste:{parameters:{result:{type:"object"}}}}},renderer:{apiVersion:2},constructor:function(){this._oTableReady=(function(){var e={};e.promise=new Promise(function(i){e.resolve=i;});return e;}());V.apply(this,arguments);this._aExistingColumns=[];this._aAlwaysSelect=[];this._oTemplate=null;this._mFieldMetadataByKey={};this._createToolbar();this._oP13nDialogSettings=this._getP13nDialogSettings();this._bIsFilterPanelEnabled=(this._oP13nDialogSettings&&this._oP13nDialogSettings.filter)?this._oP13nDialogSettings.filter.visible!==false:true;this._bIsSortPanelEnabled=(this._oP13nDialogSettings&&this._oP13nDialogSettings.sort)?this._oP13nDialogSettings.sort.visible!==false:true;this._createTable();this.attachModelContextChange(this._initialiseMetadata,this);}});p1.prototype._getP13nDialogSettings=function(){var i=this.data("p13nDialogSettings");if(typeof this._oP13nDialogSettings==="string"){try{i=JSON.parse(this._oP13nDialogSettings);}catch(e){i=null;}}return i;};p1.prototype.getDataStateIndicatorPluginOwner=function(){return this._oTable||this._oTableReady.promise;};p1.prototype.setDataStateIndicator=function(e){this._handeDataStateEvents(this.getDataStateIndicator(),"detach");this.setAggregation("dataStateIndicator",e,true);this._handeDataStateEvents(this.getDataStateIndicator(),"attach");return this;};p1.prototype._handeDataStateEvents=function(e,i){if(e){e[i+"ApplyFilter"](this._onApplyMessageFilter,this);e[i+"ClearFilter"](this._onClearMessageFilter,this);e[i+"Event"]("filterInfoPress",this._handleInfoToolbarPress,this);}};p1.prototype.setHeaderLevel=function(e){if(this.getHeaderLevel()===e){return this;}this.setProperty("headerLevel",e,true);this._headerText&&this._headerText.setLevel(e);return this;};p1.prototype._getP13nFilterMessageStrip=function(){var e,i;if(this._oMessageFilter){i=C.getLibraryResourceBundle("sap.ui.comp");e=new c1({text:i.getText("SMARTTABLE_P13N_FILTER_MESSAGESTRIP"),link:new b1({text:i.getText("SMARTTABLE_MESSAGESTRIP_CLEAR_FILTER"),press:[function(){this._fnClearMessageFilter();e.setVisible(false);},this]})});}return e;};p1.prototype._onApplyMessageFilter=function(e){this._fnClearMessageFilter=e.getParameter("revert");this._oMessageFilter=e.getParameter("filter");e.preventDefault();this._reBindTable();};p1.prototype._onClearMessageFilter=function(e){this._oMessageFilter=null;e.preventDefault();this._reBindTable();};p1.prototype.init=function(){V.prototype.init.call(this);this.addStyleClass("sapUiCompSmartTable");this.setFitContainer(true);this._aColumnKeys=[];this._aDeactivatedColumns=[];this._mLazyColumnMap={};};p1.prototype._getVariantManagementControl=function(e){var i=null;if(e){if(typeof e==='string'){i=C.byId(e);}else{i=e;}if(i){if(!(i instanceof o)){I.error("Control with the id="+e.getId?e.getId():e+" not of expected type");return null;}}}return i;};p1.prototype._createVariantManagementControl=function(){if(this._oVariantManagement||(!this.getUseVariantManagement()&&!this.getUseTablePersonalisation())||!this.getPersistencyKey()){return;}var e=new G({type:"table",keyName:"persistencyKey",dataSource:"TODO"});e.setControl(this);var i=this.getSmartVariant();if(i){this._oVariantManagement=this._getVariantManagementControl(i);}else if(this._oSmartFilter&&this._oSmartFilter.data("pageVariantPersistencyKey")){i=this._oSmartFilter.getSmartVariant();if(i){this._oVariantManagement=this._getVariantManagementControl(i);}}else{this._oVariantManagement=new o(this.getId()+"-variant",{showShare:true});}if(this._oVariantManagement){this._oVariantManagement.addPersonalizableControl(e);this._oVariantManagement.attachSave(this._variantSaved,this);this._oVariantManagement.attachAfterSave(this._variantAfterSave,this);this._oVariantManagement.initialise(this._variantInitialised,this);}};p1.prototype._variantInitialised=function(){if(!this._oCurrentVariant){this._oCurrentVariant="STANDARD";}this.fireAfterVariantInitialise();if(this._oVariantManagement&&!this._oVariantManagement.getEnabled()){this._checkAndTriggerBinding();}};p1.prototype._variantSaved=function(){if(this._oPersController){this._oPersController.setPersonalizationData(this._oCurrentVariant,true);}};p1.prototype._variantAfterSave=function(){this.fireAfterVariantSave({currentVariantId:this.getCurrentVariantId()});};p1.prototype.setTableBindingPath=function(e){this.setProperty("tableBindingPath",e,true);return this;};p1.prototype.setShowTablePersonalisation=function(e){this.setProperty("showTablePersonalisation",e,true);if(this._oTablePersonalisationButton){this._oTablePersonalisationButton.setVisible(e);}return this;};p1.prototype.setUseVariantManagement=function(e){this.setProperty("useVariantManagement",e,true);if(this._oPersController){this._oPersController.setResetToInitialTableState(!e);}return this;};p1.prototype.setShowVariantManagement=function(e){this.setProperty("showVariantManagement",e,true);if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){this._oVariantManagement.setVisible(e);if(this._oSeparator){this._oSeparator.setVisible(e);}}return this;};p1.prototype.setToolbarStyleClass=function(e){this.setProperty("toolbarStyleClass",e,true);return this;};p1.prototype.setCustomToolbar=function(e){this._oCustomToolbar=e;return this;};p1.prototype.getCustomToolbar=function(){return this._oCustomToolbar;};p1.prototype.setHeader=function(e){var i=this.getProperty("header"),q1;this.setProperty("header",e,true);if(this.bIsInitialised&&this._oToolbar){q1=(!i===!e);if(!q1){this._createToolbarContent();}else{this._refreshHeaderText();}}return this;};p1.prototype.setShowRowCount=function(e){this.setProperty("showRowCount",e,true);this._refreshHeaderText();return this;};p1.prototype.setEditable=function(e){if((e=!!e)==this.getEditable()){return this;}this.setProperty("editable",e,true);if(this._oEditModel){this._oEditModel.setProperty("/editable",e);}if(this._oEditButton){this._oEditButton.setIcon(e?"sap-icon://display":"sap-icon://edit");}if(this._isMobileTable&&this._oTable.setKeyboardMode){this._oTable.setKeyboardMode(e?"Edit":"Navigation");}this._updateVisibleColumnsWidthForEdit();return this;};p1.prototype.setDemandPopin=function(e){var i=this.getDemandPopin();if(i===e){return this;}this.setProperty("demandPopin",e,true);if(this.bIsInitialised){if(e){this._updateColumnsPopinFeature();}else{this._deactivateColumnsPopinFeature();}}return this;};p1.prototype._refreshHeaderText=function(){if(!this._headerText){return;}if(!this._oNumberFormatInstance){this._oNumberFormatInstance=N.getFloatInstance();}var i;var e=this.getHeader();this._headerText.setVisible(!!e);if(this.getShowRowCount()){i=this._getRowCount(true);if(i>0){var q1=this._oNumberFormatInstance.format(i);e+=" ("+q1+")";}}this._headerText.setText(e);this._updateAriaLabelledByInfo();if(this._bUpdateTableAnnouncement){this._bUpdateTableAnnouncement=false;this._updateTableAnnouncement(i);}};p1.prototype._updateAriaLabelledByInfo=function(){var e=this._headerText.getId();if(this._oTable&&this._oTable.addAriaLabelledBy){if(this._headerText.getVisible()){if(this._oTable.getAriaLabelledBy().indexOf(e)===-1){this._oTable.addAriaLabelledBy(e);}}else{this._oTable.removeAriaLabelledBy(e);}}};p1.prototype._updateTableAnnouncement=function(i){var e=d1.getInstance();if(e){var q1=C.getLibraryResourceBundle("sap.ui.comp");var r1=this.getHeader();if(i===undefined&&this._getRowCount(false)>0){e.announce(q1.getText("SMARTTABLE_ANNOUNCEMENT_TABLE_UPDATED",[r1]));}else if(i>1){e.announce(q1.getText("SMARTTABLE_ANNOUNCEMENT_TABLE_UPDATED_MULT",[r1,i]));}else if(i===1){e.announce(q1.getText("SMARTTABLE_ANNOUNCEMENT_TABLE_UPDATED_SING",[r1,i]));}else{e.announce(q1.getText("SMARTTABLE_ANNOUNCEMENT_TABLE_UPDATED_NOITEMS",[r1]));}}};p1.prototype._addFullScreenButton=function(){if(this._oFullScreenButton){this._oToolbar.removeContent(this._oFullScreenButton);}if(this.getShowFullScreenButton()){if(!this._oFullScreenButton){this._oFullScreenButton=new j(this.getId()+"-btnFullScreen",{press:[function(){this._toggleFullScreen(!this.bFullScreen);},this]});this._oFullScreenButton.addStyleClass("sapUiCompSmartTableToolbarContent");}this._renderFullScreenButton();this._oToolbar.addContent(this._oFullScreenButton);}};p1.prototype._addPasteButton=function(){var e=this.getId()+"-btnPaste";var i=C.byId(e);if(i){this._oToolbar.removeContent(i);}if(this.getShowPasteButton()){if(!i){i=new j(e);i.addStyleClass("sapUiCompSmartTableToolbarContent");sap.ui.require(["sap/m/plugins/PasteProvider"],function(q1){i.addDependent(new q1({pasteFor:this._oTable.getId()}));}.bind(this));}i.setEnabled(this.getEnablePaste());this._oToolbar.addContent(i);}};p1.prototype._createToolbar=function(){var e=null;if(!this._oToolbar){e=this.getCustomToolbar();if(e){this._oToolbar=e;}else{this._oToolbar=new O({design:l1.Transparent,style:this.getTableType()==="ResponsiveTable"?m1.Standard:m1.Clear});this._oToolbar.addStyleClass("sapUiCompSmartTableToolbar");if(this.getToolbarStyleClass()){this._oToolbar.addStyleClass(this.getToolbarStyleClass());}}this._oToolbar.setLayoutData(new l({shrinkFactor:0}));}};p1.prototype._toggleShowHideDetails=function(e){if(!this._oShowHideDetailsButton||(e===this.bHideDetails)){return;}this.bHideDetails=e;if(this.bHideDetails){this._oTable.setHiddenInPopin(this._getImportanceToHide());}else{this._oTable.setHiddenInPopin([]);}this._renderShowHideDetailsButton();};p1.prototype._getImportanceToHide=function(){var e=this.getDetailsButtonSetting()||[];var i=[];if(e.length){i=e;}else{i=H.system.phone?["Low","Medium"]:["Low"];}return i;};p1.prototype._renderShowHideDetailsButton=function(){var e=C.getLibraryResourceBundle("sap.ui.comp"),i;i=this.bHideDetails?e.getText("TABLE_SHOWDETAILS_TEXT"):e.getText("TABLE_HIDEDETAILS_TEXT");this._oShowHideDetailsButton.setTooltip(i);this._oShowHideDetailsButton.setText(i);};p1.prototype._toggleFullScreen=function(e,i){if(!this._oFullScreenButton||(e===this.bFullScreen&&!i)){return;}this.bFullScreen=e;z.toggleFullScreen(this,this.bFullScreen,this._oFullScreenButton,this._toggleFullScreen);this._renderFullScreenButton();this.fireFullScreenToggled({fullScreen:e});};p1.prototype._renderFullScreenButton=function(){var e=C.getLibraryResourceBundle("sap.ui.comp"),i;i=this.bFullScreen?e.getText("CHART_MINIMIZEBTN_TOOLTIP"):e.getText("CHART_MAXIMIZEBTN_TOOLTIP");this._oFullScreenButton.setTooltip(i);this._oFullScreenButton.setText(i);this._oFullScreenButton.setIcon(this.bFullScreen?"sap-icon://exit-full-screen":"sap-icon://full-screen");};p1.prototype._createToolbarContent=function(){if(!this._oToolbar){this._createToolbar();}this._addVariantManagementToToolbar();this._addSeparatorToToolbar();this._addHeaderToToolbar();this._addSpacerToToolbar();this._addPasteButton();this._addEditTogglableToToolbar();this._addShowHideDetailsButton();this._addTablePersonalisationToToolbar();this._addExportToExcelToToolbar();this._addFullScreenButton();this._bToolbarInsertedIntoItems=true;this._placeToolbar();};p1.prototype._placeToolbar=function(){if(!this.getPlaceToolbarInTable()){this.insertItem(this._oToolbar,0);}else if(this._isMobileTable){this._oTable.setHeaderToolbar(this._oToolbar);}else{this._oTable.addExtension(this._oToolbar);}};p1.prototype.getToolbar=function(){return this._oToolbar;};p1.prototype._addEditTogglableToToolbar=function(){var e;if(this._oEditButton){this._oToolbar.removeContent(this._oEditButton);}if(this.getEditTogglable()){if(!this._oEditButton){e=C.getLibraryResourceBundle("sap.ui.comp").getText("TABLE_EDITTOGGLE_TOOLTIP");this._oEditButton=new j(this.getId()+"-btnEditToggle",{icon:this.getEditable()?"sap-icon://display":"sap-icon://edit",text:e,tooltip:e,press:[function(){var i=this.getEditable();i=!i;this.setEditable(i,true);this.fireEditToggled({editable:i});},this]});this._oEditButton.addStyleClass("sapUiCompSmartTableToolbarContent");}this._oToolbar.addContent(this._oEditButton);}};p1.prototype._addHeaderToToolbar=function(){if(this._headerText){this._oToolbar.removeContent(this._headerText);}if(!this._headerText){this._headerText=new g(this.getId()+"-header");this._headerText.addStyleClass("sapMH4Style");this._headerText.addStyleClass("sapUiCompSmartTableHeader");this._headerText.addStyleClass("sapUiCompSmartTableToolbarContent");this._headerText.setLevel(this.getHeaderLevel());}this._refreshHeaderText();this._oToolbar.insertContent(this._headerText,0);};p1.prototype._addSeparatorToToolbar=function(){if(this._oSeparator){this._oToolbar.removeContent(this._oSeparator);}if(this.getHeader()&&this.getUseVariantManagement()&&this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){if(!this._oSeparator){this._oSeparator=new k(this.getId()+"-toolbarSeperator");if(!this.getShowVariantManagement()){this._oSeparator.setVisible(false);}}this._oToolbar.insertContent(this._oSeparator,0);}if(this._oToolbar){this._oToolbar.addStyleClass("sapMTBHeader-CTX");}};p1.prototype._addVariantManagementToToolbar=function(){if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){this._oToolbar.removeContent(this._oVariantManagement);if(this.getUseVariantManagement()){this._oToolbar.insertContent(this._oVariantManagement,0);this._oVariantManagement.addStyleClass("sapUiCompSmartTableToolbarContent");if(!this._oVariantManagement.isPageVariant()){this._oVariantManagement.setVisible(this.getShowVariantManagement());}}}};p1.prototype._addSpacerToToolbar=function(){var e=false,q1=this._oToolbar.getContent(),i,r1;if(q1){r1=q1.length;i=0;for(i;i<r1;i++){if(q1[i]instanceof h){e=true;break;}}}if(!e){this._oToolbar.addContent(new h(this.getId()+"-toolbarSpacer"));}};p1.prototype._createShowHideDetailsButton=function(){this._oShowHideDetailsButton=new a1(this.getId()+"-btnShowHideDetails",{visible:false,press:[function(){this._toggleShowHideDetails(!this.bHideDetails);},this]});this._oShowHideDetailsButton.addStyleClass("sapUiCompSmartTableToolbarContent");};p1.prototype._addShowHideDetailsButton=function(){if(this._oShowHideDetailsButton){this._oToolbar.removeContent(this._oShowHideDetailsButton);}if(this.getShowDetailsButton()&&this._isMobileTable){this.bHideDetails=true;if(!this._oShowHideDetailsButton){this._createShowHideDetailsButton();}this._renderShowHideDetailsButton();this._oToolbar.addContent(this._oShowHideDetailsButton);}};p1.prototype._addTablePersonalisationToToolbar=function(){var e;if(this._oTablePersonalisationButton){this._oToolbar.removeContent(this._oTablePersonalisationButton);}if(this.getUseTablePersonalisation()){if(!this._oTablePersonalisationButton){e=C.getLibraryResourceBundle("sap.ui.comp").getText("TABLE_PERSOBTN_TOOLTIP");this._oTablePersonalisationButton=new j(this.getId()+"-btnPersonalisation",{icon:"sap-icon://action-settings",text:e,tooltip:e,press:[function(i){this._oPersController.openDialog();},this]});S.addConfig(this._oTablePersonalisationButton,{messageBundleKey:H.os.macintosh?"SMARTTABLE_SHORTCUT_SHOW_SETTINGS_MAC":"SMARTTABLE_SHORTCUT_SHOW_SETTINGS"},this);this._oTablePersonalisationButton.addStyleClass("sapUiCompSmartTableToolbarContent");this._oTablePersonalisationButton.setVisible(this.getShowTablePersonalisation());}this._oToolbar.addContent(this._oTablePersonalisationButton);}};p1.prototype._triggerGWExport=function(){var e=C.getLibraryResourceBundle("sap.ui.comp");var i=function(){var r1=this._getRowBinding();var s1=r1.getDownloadUrl("xlsx");s1=this._removeExpandParameter(s1);var t1={url:s1};this.fireBeforeExport({exportSettings:t1});e1(t1.url);}.bind(this);var q1=this._getRowCount(true);if(q1>10000){f.confirm(e.getText("DOWNLOAD_CONFIRMATION_TEXT",q1),{actions:[f.Action.YES,f.Action.NO],onClose:function(r1){if(r1===f.Action.YES){i();}}});}else{i();}};p1.prototype._addExportToExcelToToolbar=function(){if(this._oUseExportToExcel){this._oToolbar.removeContent(this._oUseExportToExcel);}if(!this.getUseExportToExcel()){return;}if(!this._oUseExportToExcel){var e=this.getId()+"-btnExcelExport";var i="sap-icon://excel-attachment";var q1=C.getLibraryResourceBundle("sap.ui.comp");if(this.getExportType()==="UI5Client"){this._oUseExportToExcel=this._createClientExportButton(e,i);}if(this._bTableSupportsExcelExport&&this.getExportType()==="GW"){var r1;r1=q1.getText("TABLE_EXPORT_TEXT");this._oUseExportToExcel=new j(e,{icon:i,text:r1,tooltip:r1,press:[this._triggerGWExport,this]});}this._setExcelExportEnableState();if(this._oUseExportToExcel){this._oUseExportToExcel.addStyleClass("sapUiCompSmartTableToolbarContent");}}this._oToolbar.addContent(this._oUseExportToExcel);};p1.prototype._openExportSettings=function(){var e=this;this._loadExportLibrary().then(function(){sap.ui.require(['sap/ui/export/ExportUtils'],function(i){i.getExportSettingsViaDialog(e._cachedExcelSettings,e).then(function(q1){e._cachedExcelSettings=q1;e._triggerUI5ClientExport(q1);},function(){});});});};p1.prototype._createClientExportButton=function(e,i){var q1=C.getLibraryResourceBundle("sap.ui.comp");var r1={fileName:this.getHeader()};if(!this._cachedExcelSettings){this._cachedExcelSettings=r1;}var s1=new $(e,{icon:i,tooltip:q1.getText("TABLE_EXPORT_TEXT"),type:j1.Ghost,buttonMode:k1.Split,useDefaultActionOnly:true,defaultAction:[function(){this._triggerUI5ClientExport(r1);},this],menu:[new Z({items:[new _({text:q1.getText("QUICK_EXPORT"),press:[function(){this._triggerUI5ClientExport(r1);},this]}),new _({text:q1.getText("EXPORT_WITH_SETTINGS"),press:[this._openExportSettings,this]})]})]});S.addConfig(s1._getButtonControl(),{addAccessibilityLabel:true,messageBundleKey:H.os.macintosh?"SMARTTABLE_SHORTCUT_EXPORT_TO_EXCEL_MAC":"SMARTTABLE_SHORTCUT_EXPORT_TO_EXCEL"},this);return s1;};p1.prototype.onkeydown=function(e){if(e.isMarked()){return;}if((e.metaKey||e.ctrlKey)&&e.shiftKey&&e.which===K.E){if(this.getUseExportToExcel()&&this.getExportType()==="UI5Client"&&this._oUseExportToExcel&&this._oUseExportToExcel.getEnabled()){this._openExportSettings();e.setMarked();e.preventDefault();}}else if((e.metaKey||e.ctrlKey)&&e.which===K.COMMA){if(this.getUseTablePersonalisation()&&this._oTablePersonalisationButton&&this._oTablePersonalisationButton.getVisible()){this._oPersController.openDialog();e.setMarked();e.preventDefault();}}};p1.prototype._loadExportLibrary=function(){if(!this._oExportLibLoadPromise){this._oExportLibLoadPromise=C.loadLibrary("sap.ui.export",true);}return this._oExportLibLoadPromise;};p1.prototype._getColumnLabel=function(e){var i,q1;if(typeof e==='string'){i=e;e=this._getColumnByKey(e);}if(!e){var r1=this._oTableProvider.getFieldLabel(this.getEntitySet(),i);if(r1&&r1.match(/{@i18n>.+}/gi)){var s1=this.getModel("@i18n");if(s1&&s1.isA("sap.ui.model.resource.ResourceModel")){return s1.getProperty(r1.slice(1,-1).substring(6))||r1;}}return r1;}if(e.getLabel){q1=e.getLabel();}else if(e.getHeader){q1=e.getHeader();}return(q1&&q1.getText)?q1.getText():null;};p1.prototype._getColumnWidthNumber=function(e){if(e.indexOf("em")>0){return Math.round(parseFloat(e));}if(e.indexOf("px")>0){return Math.round(parseInt(e)/16);}return"";};p1.prototype._triggerUI5ClientExport=function(e){var i=this._createExportColumnConfiguration(e);if(!i||!i.length){f.error(C.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_COLS_EXPORT"),{styleClass:(this.$()&&this.$().closest(".sapUiSizeCompact").length)?"sapUiSizeCompact":""});return;}var q1=this._getRowBinding();var r1=this._getColumnLabel.bind(this);var s1={workbook:{columns:i,hierarchyLevel:(this._isTreeTable&&q1.getTreeAnnotation)?q1.getTreeAnnotation("hierarchy-level-for"):undefined},dataSource:q1,fileName:e?e.fileName:this.getHeader()};this._loadExportLibrary().then(function(){sap.ui.require(['sap/ui/export/ExportUtils','sap/ui/export/Spreadsheet'],function(t1,u1){var v1=Promise.resolve();if(e.includeFilterSettings){v1=t1.parseFilterConfiguration(q1,r1).then(function(w1){if(e.includeFilterSettings&&w1){s1.workbook.context={metaSheetName:w1.name,metainfo:[w1]};}});}v1.then(function(){var w1={splitCells:false,includeFilterSettings:false};if(e){w1.splitCells=e.splitCells;w1.includeFilterSettings=e.includeFilterSettings;}var x1=new u1(s1);x1.attachBeforeExport(function(z1){this.fireBeforeExport({exportSettings:z1.getParameter('exportSettings'),userExportSettings:w1});},this);var y1=function(){x1.destroy();};x1.build().then(y1,y1);}.bind(this));}.bind(this));}.bind(this));};p1.prototype._createExportColumnConfiguration=function(e){var q1,i,r1,s1,t1,u1,v1,w1,x1,y1,z1,A1,B1,C1,D1,E1,F1,G1,H1=[],I1,J1,K1;var L1=e&&e.splitCells;var M1=function(O1,P1){return'{'+(parseInt(P1)-1)+'}';};q1=this._isMobileTable?this._oTable.getColumns(true):this._oTable.getColumns();r1=q1.length;K1=this.data("useUTCDateTime");if(K1!=null){if(typeof K1==="string"){I1=K1==="true";}else if(typeof K1==="boolean"){I1=K1;}}for(i=0;i<r1;i++){v1=null;w1=null;x1=null;s1=q1[i];J1=I1;if(s1.getVisible()){t1=s1.data("p13nData");if(s1.getLeadingProperty){v1=s1.getLeadingProperty();}if(!v1&&t1){v1=t1["leadingProperty"];}if(Array.isArray(v1)){v1=v1[0];}if(v1){u1=this._getColumnLabel(s1);C1=s1.getWidth().toLowerCase()||t1.width||"";C1=this._getColumnWidthNumber(C1);D1=t1.type==="numeric"?"Number":t1.type;G1=t1.typeInstance;F1=null;E1=null;if(t1.unit){D1=t1.isCurrency?"Currency":"Number";if(L1){x1=t1.unit;}}else if(G1&&G1.isA("sap.ui.comp.odata.type.FiscalDate")){var N1=G1.getFormatter();w1=N1.getTemplate().replace(/\$(\d)/g,M1);E1=N1.getRegExPattern().toString().slice(1,-1);D1="String";}else if(D1!="date"&&E.isDateOrTime(t1.edmType)){D1=E.getTypeName(t1.edmType);if(D1==="DateTimeOffset"){D1="DateTime";J1=false;}}else if(D1==="stringdate"){D1="Date";E1="YYYYMMDD";}else if(D1==="boolean"){D1="Boolean";F1=E.getType(t1.edmType);}else if(t1.description){D1="String";if(!L1){w1=y.getFormattedExpressionFromDisplayBehaviour(t1.displayBehaviour,"{0}","{1}");}else if(t1.displayBehaviour==="descriptionOnly"){v1=t1.description;}else if(t1.displayBehaviour!=="idOnly"){x1=t1.description;}}else if(t1.isDigitSequence){D1="Number";}else if(D1==="string"){D1="String";}else if(D1==="date"){D1="Date";}else if(D1==="time"){D1="Time";}H1.push({columnId:s1.getId(),property:t1.description&&!L1?[v1,t1.description]:v1,type:D1,inputFormat:E1,label:u1?u1:v1,width:C1,textAlign:s1.getHAlign(),template:w1,trueValue:(D1==="Boolean"&&F1)?F1.formatValue(true,"string"):undefined,falseValue:(D1==="Boolean"&&F1)?F1.formatValue(false,"string"):undefined,unitProperty:(D1==="Currency"||(D1==="Number"&&!L1))?t1.unit:undefined,displayUnit:D1==="Currency"&&!L1,precision:t1.precision,scale:t1.scale,autoScale:D1==="Number",utc:(D1==="DateTime"&&J1!=null)?J1:undefined});if(x1){y1=this._getColumnByKey(x1);z1=u1;u1=null;if(y1){u1=this._getColumnLabel(y1);C1=y1.getWidth().toLowerCase()||"";C1=this._getColumnWidthNumber(C1);B1=y1.getHAlign();}else{A1=this._mFieldMetadataByKey[x1];if(A1){u1=A1.label;C1=A1.width;}}H1.push({columnId:s1.getId()+"-additionalProperty",property:x1,type:"String",label:u1||(z1?z1+" (2)":x1),width:C1,textAlign:B1});}}}}return H1;};p1.prototype._removeExpandParameter=function(e){var i=e.replace(new RegExp("([\\?&]\\$expand=[^&]+)(&?)"),function(q1,r1,s1){return s1?r1.substring(0,1):"";});return i;};p1.prototype._getRowCount=function(e){var i=this._getRowBinding();if(!i){return e?undefined:0;}var q1;if(!e){q1=i.getLength();}else if(typeof i.getCount==='function'){q1=i.getCount();}else if(!i.isA('sap.ui.model.TreeBinding')&&typeof i.isLengthFinal==='function'&&i.isLengthFinal()){q1=i.getLength();}if(q1<0||q1==="0"){q1=0;}return q1;};p1.prototype._setExcelExportEnableState=function(){if(this._oUseExportToExcel){var i=this._getRowCount();this._oUseExportToExcel.setEnabled(i>0);}};p1.prototype._createPersonalizationController=function(){if(this._oPersController||!this.getUseTablePersonalisation()){return;}var e=this._oP13nDialogSettings;e=this._setIgnoreFromPersonalisationToSettings(e);e=e||{};if(this._isTreeTable){e.stableColumnKeys=[];e.stableColumnKeys.push(this._aColumnKeys[0]);}if(this._bIsFilterPanelEnabled){e.filter=e.filter?e.filter:{};e.filter.createMessageStrip=this._getP13nFilterMessageStrip.bind(this);}this._oPersController=new x(this.getId()+"-persoController",{table:this._oTable,columnKeys:this._aColumnKeys,setting:e,resetToInitialTableState:!this.getUseVariantManagement(),beforePotentialTableChange:[this._beforePersonalisationModelDataChange,this],afterPotentialTableChange:[this._afterPersonalisationModelDataChange,this],afterP13nModelDataChange:[this._personalisationModelDataChange,this],requestColumns:[this._personalisationRequestColumns,this]});this._oPersController.attachDialogAfterClose(function(i){if(this._fGetDataForKeyUser){if(i.getParameter("cancel")){this._fGetDataForKeyUser([]);}this._cleanUpKeyUser();}}.bind(this));if(this._aDeactivatedColumns.length>0){this._oPersController.addToSettingIgnoreColumnKeys(this._aDeactivatedColumns);}};p1.prototype.getVariantManagement=function(){return this._oVariantManagement;};p1.prototype.openDialogForKeyUser=function(e,i){this._fGetDataForKeyUser=i;this._oPersController.openDialog({showReset:false,useAvailablePanels:true,styleClass:e});};p1.prototype._cleanUpKeyUser=function(){this._fGetDataForKeyUser=null;};p1.prototype._createKeyUserChange=function(){return[{selectorControl:this._oVariantManagement._getPersoController(),changeSpecificData:{changeType:"variantContent",content:{key:this._oVariantManagement.getSelectionKey(),persistencyKey:this.getPersistencyKey(),content:this.fetchVariant()}}}];};p1.prototype._setIgnoreFromPersonalisationToSettings=function(e){var i=P.createArrayFromString(this.getIgnoreFromPersonalisation());if(i.length){if(!e){e={};}var q1=function(r1){if(!e[r1]){e[r1]={};}e[r1].ignoreColumnKeys=i;};q1("filter");q1("sort");q1("group");q1("columns");}return e;};p1.prototype._getRowBinding=function(){if(this._oTable){return this._oTable.getBinding(this._sAggregation);}};p1.prototype.setEntitySet=function(e){this.setProperty("entitySet",e,true);this._initialiseMetadata();return this;};p1.prototype._initialiseMetadata=function(e){var i=this,q1=i;if(e){q1=e.getSource();}if(!q1.bIsInitialised){B.handleModelInit(q1,q1._onMetadataInitialised,true);}};p1.prototype._onMetadataInitialised=function(){this._bMetaModelLoadAttached=false;if(this.bIsInitialised){return;}this._updateInitialColumns();this._createTableProvider();if(!this._oTableProvider){return;}this._aTableViewMetadata=this._oTableProvider.getTableViewMetadata();if(!this._aTableViewMetadata){return;}if(this.getEnableAutoColumnWidth()){this._oTable.getColumns().forEach(this._setWidthForCustomColumn,this);}if(!this._isMobileTable&&this.getDemandPopin()){this.setDemandPopin(false);I.error("use SmartTable property 'demandPopin' only  with responsive table, property has been set to false");}this.detachModelContextChange(this._initialiseMetadata,this);this.bIsInitialised=true;var e=this._getP13nDialogSettings();if(!Q(this._oP13nDialogSettings,e)){this._oP13nDialogSettings=e;this._bIsFilterPanelEnabled=(this._oP13nDialogSettings&&this._oP13nDialogSettings.filter)?this._oP13nDialogSettings.filter.visible!==false:true;this._bIsSortPanelEnabled=(this._oP13nDialogSettings&&this._oP13nDialogSettings.sort)?this._oP13nDialogSettings.sort.visible!==false:true;this._attachTableCustomFilter();}this._bTableSupportsExcelExport=this._oTableProvider.getSupportsExcelExport();this._bMultiUnitBehaviorEnabled=this._oTableProvider.getMultiUnitBehaviorEnabled();this._listenToSmartFilter();this._createVariantManagementControl();this._createToolbarContent();this._aAlwaysSelect=this._oTableProvider.getRequestAtLeastFields();this._createContent();this._createPersonalizationController();this._oEditModel=new J({editable:this.getEditable()});this.setModel(this._oEditModel,"sm4rtM0d3l");this.attachEvent("_change",this._onPropertyChange,this);this.fireInitialise();if(!this._oVariantManagement||(this._oVariantManagement&&this._bVariantInitialised)){this._checkAndTriggerBinding();}};p1.prototype._checkAndTriggerBinding=function(){if(!this._bAutoBindingTriggered){this._bAutoBindingTriggered=true;if(this.getEnableAutoBinding()){if(this._oSmartFilter){if(this._oSmartFilter.isInitialised()){this._oSmartFilter.search();}else{this._oSmartFilter.attachEventOnce("initialise",function(){this._oSmartFilter.search();},this);}}else{this._reBindTable();}}}};p1.prototype._aStaticProperties=["entitySet","ignoredFields","initiallyVisibleFields","ignoreFromPersonalisation","tableType","useTablePersonalisation","enableAutoBinding","persistencyKey","smartFilterId","showDetailsButton","enableAutoColumnWidth"];p1.prototype._aToolbarRelatedProperties=["useExportToExcel","exportType","showFullScreenButton","showPasteButton","editTogglable","placeToolbarInTable"];p1.prototype._onPropertyChange=function(e){var i=e.getParameter("name");if(this._aStaticProperties.indexOf(i)>-1){I.error("Property "+i+" cannot be changed after the SmartTable with id "+this.getId()+" is initialised");}if(this._oToolbar&&this._aToolbarRelatedProperties.indexOf(i)>-1){if(i==="exportType"&&this._oUseExportToExcel){this._oUseExportToExcel.destroy();this._oUseExportToExcel=null;}this._createToolbarContent();}};p1.prototype._createTableProvider=function(){var e,i,q1,r1;i=this.getEntitySet();q1=this.getIgnoredFields();e=this.getModel();r1=this.data("preserveDecimals");if(r1!=null){if(r1==false||(typeof r1==="string"&&r1==="false")){this._bPreserveDecimals=false;}else{this._bPreserveDecimals=true;}}else{this._bPreserveDecimals=true;}if(e&&i){if(this._aExistingColumns.length){if(q1){q1+=","+this._aExistingColumns.toString();}else{q1=this._aExistingColumns.toString();}}this._oTableProvider=new n({entitySet:i,ignoredFields:q1,initiallyVisibleFields:this.getInitiallyVisibleFields(),isEditableTable:this.getEditable(),smartTableId:this.getId(),isAnalyticalTable:!!this._isAnalyticalTable,isMobileTable:!!this._isMobileTable,dateFormatSettings:this.data("dateFormatSettings"),useUTCDateTime:this.data("useUTCDateTime"),currencyFormatSettings:this.data("currencyFormatSettings"),defaultDropDownDisplayBehaviour:this.data("defaultDropDownDisplayBehaviour"),useSmartField:this.data("useSmartField"),useSmartToggle:this.data("useSmartToggle"),skipAnnotationParse:this.data("skipAnnotationParse"),lineItemQualifier:this.data("lineItemQualifier"),presentationVariantQualifier:this.data("presentationVariantQualifier"),enableInResultForLineItem:this.data("enableInResultForLineItem"),_semanticKeyAdditionalControl:this.getAggregation("semanticKeyAdditionalControl"),model:e,semanticObjectController:this.getSemanticObjectController(),showDetailsButton:this.getShowDetailsButton(),enableAutoColumnWidth:this.getEnableAutoColumnWidth(),preserveDecimals:this._bPreserveDecimals});}};p1.prototype._listenToSmartFilter=function(){var e,i,q1=false;e=this.getSmartFilterId();this._oSmartFilter=this._findControl(e,"sap.ui.comp.filterbar.FilterBar");if(this._oSmartFilter){this._oSmartFilter.attachSearch(this._reBindTable,this);this._oSmartFilter.attachFilterChange(this._filterChangeEvent,this);q1=true;}var r1=C.getLibraryResourceBundle("sap.ui.comp"),s1,t1,u1={SMARTTABLE_NO_DATA:r1.getText("SMARTTABLE_NO_DATA"),SMARTTABLE_NO_DATA_WITHOUT_FILTERBAR:r1.getText("SMARTTABLE_NO_DATA_WITHOUT_FILTERBAR"),SMARTTABLE_NO_RESULTS:r1.getText("SMARTTABLE_NO_RESULTS")};if(this._oTable){s1=this._oTable.getNoData;t1="noData";if(!s1){s1=this._oTable.getNoDataText;t1="noDataText";}}if(s1){var v1=s1.call(this._oTable);if(v1&&(!this._isMobileTable||!this._oTable.isPropertyInitial(t1))){if(Object.values(u1).indexOf(v1)==-1){this._vCustomNoData=v1;}}}i=this.getInitialNoDataText();if(i){q1=i==="$FILTERBAR";if(!q1&&i!=="$NO_FILTERBAR"){this._setNoDataText(i);return;}}if(q1){this._setNoDataText(u1["SMARTTABLE_NO_DATA"]);}else{this._setNoDataText(u1["SMARTTABLE_NO_DATA_WITHOUT_FILTERBAR"]);}};p1.prototype._filterChangeEvent=function(){if(this._isTableBound()&&this._oSmartFilter&&!this._oSmartFilter.getLiveMode()&&!this._oSmartFilter.isDialogOpen()){this._showOverlay(true);}};p1.prototype._showOverlay=function(e){if(e){var i={show:true};this.fireShowOverlay({overlay:i});e=i.show;}this._oTable.setShowOverlay(e);};p1.prototype._findControl=function(i,e){var q1,r1;if(i){q1=C.byId(i);if(!q1||!q1.isA(e)){r1=this._getView();if(r1){q1=r1.byId(i);}}if(q1&&!q1.isA(e)){q1=undefined;}}return q1;};p1.prototype._getView=function(){if(!this._oView){var e=this.getParent();while(e){if(e.isA("sap.ui.core.mvc.View")){this._oView=e;break;}e=e.getParent();}}return this._oView;};p1.prototype.rebindTable=function(e){if(this.isInitialised()){this._reBindTable(null,e);return;}I.error("rebindTable method called before the SmartTable is initialized. Please execute the UI5 Support Assistant 'SmartTable' rules to get more information",this.getId(),"sap.ui.comp.smarttable.SmartTable");};p1.prototype._reBindTable=function(e,q1){var r1,s1,t1,i,u1,v1,w1=[],x1,y1,z1,A1,B1,C1,D1,E1={},F1={preventTableBind:false};this._bUpdateTableAnnouncement=e&&e.getId&&e.getId()==="search";t1=this._getTablePersonalisationData()||{};if(this._oMessageFilter){x1=this._oMessageFilter;}else{x1=t1.filters;y1=t1.excludeFilters;}D1=t1.sorters;if(this._oSmartFilter){v1=this._oSmartFilter.getFilters();E1=this._oSmartFilter.getParameters()||{};}if(v1&&v1.length){if(y1){w1=[new r([v1[0],y1],true)];}else{w1=v1;}}else if(y1){w1=[y1];}if(x1){x1=w1.concat(x1);}else{x1=w1;}z1=this._getRequestAtLeastFields();B1=this._getRelevantColumnPaths();A1=B1["select"];if(!A1||!A1.length){A1=z1;}else{u1=z1.length;for(i=0;i<u1;i++){if(A1.indexOf(z1[i])<0){A1.push(z1[i]);}}}if(this._mSelectExpandForGroup&&this._mSelectExpandForGroup.select){this._mSelectExpandForGroup.select.forEach(function(I1){if(A1.indexOf(I1)<0){A1.push(I1);}});}if(A1.length){E1["select"]=A1.toString();C1=B1["expand"]||[];if(this._mSelectExpandForGroup&&this._mSelectExpandForGroup.expand){this._mSelectExpandForGroup.expand.forEach(function(I1){if(C1.indexOf(I1)<0){C1.push(I1);}});}if(C1.length){E1["expand"]=C1.join(",");}}E1["useBatchRequests"]=true;if(!D1){D1=[];}F1.filters=x1;F1.sorter=D1;F1.parameters=E1;F1.length=undefined;F1.startIndex=undefined;F1.events={};this.fireBeforeRebindTable({bindingParams:F1,messageFilterActive:!!this._oMessageFilter});if(!F1.preventTableBind){D1=F1.sorter;x1=F1.filters;E1=F1.parameters;A1=F1.parameters["select"];if(!A1||!A1.length){f.error(C.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_COLS"),{styleClass:(this.$()&&this.$().closest(".sapUiSizeCompact").length)?"sapUiSizeCompact":""});return;}s1=this.getTableBindingPath()||("/"+this.getEntitySet());if(this._oTable.resumeUpdateAnalyticalInfo){this._oTable.resumeUpdateAnalyticalInfo(true,false);}this._bDataLoadPending=true;this._bIgnoreChange=false;if(this._bForceTableUpdate){q1=true;this._bForceTableUpdate=false;}if(!q1){r1=this._oTable.getBinding(this._sAggregation);if(r1&&r1.mParameters){q1=!(Q(E1,r1.mParameters,true)&&Q(E1.custom,r1.mParameters.custom)&&!F1.length&&!F1.startIndex&&s1===r1.getPath());}}if(!this._bNoDataUpdated){this._bNoDataUpdated=true;this._setNoDataText();}if(!r1||!this._bIsTableBound||q1){p1._addBindingListener(F1,"change",this._onBindingChange,this);p1._addBindingListener(F1,"dataRequested",this._onDataRequested,this);p1._addBindingListener(F1,"dataReceived",this._onDataReceived,this);if(this._isMobileTable){var G1=this._oTable?this._oTable.getColumns():[];var H1=this._oTemplate?this._oTemplate.getCells():[];if(G1.length===H1.length){G1.forEach(function(I1,J1){H1[J1].setBindingContext(I1.getVisible()?undefined:null);});}}this._oTable.bindRows({path:s1,filters:x1,sorter:D1,parameters:E1,length:F1.length,startIndex:F1.startIndex,template:this._oTemplate,events:F1.events});this._bIsTableBound=true;}else{r1.sort(D1);r1.filter(x1,"Application");}this._showOverlay(false);}};p1.prototype._onDataRequested=function(e){if(e&&e.getParameter&&e.getParameter("__simulateAsyncAnalyticalBinding")){return;}this._bIgnoreChange=true;this.fireDataRequested(e.getParameters());};p1.prototype._onDataReceived=function(e){if(e&&e.getParameter&&e.getParameter("__simulateAsyncAnalyticalBinding")){return;}this._bIgnoreChange=false;this._onDataLoadComplete(e,true);this.fireDataReceived(e);};p1.prototype._onBindingChange=function(e){if(this._bIgnoreChange){return;}var i,q1=false;i=(e&&e.getParameter)?e.getParameter("reason"):undefined;if(!i||i==="filter"||i==="context"||(!this._bDataLoadPending&&i==="change")){q1=true;}if(i==="change"||q1){this._onDataLoadComplete(e,q1);}};p1._addBindingListener=function(e,i,q1,r1){if(!e.events){e.events={};}if(!e.events[i]){e.events[i]=q1.bind(r1);}else{var s1=e.events[i];e.events[i]=function(){q1.apply(r1,arguments);s1.apply(r1,arguments);};}};p1.prototype._onDataLoadComplete=function(e,i){if(this._bDataLoadPending||i){this._bDataLoadPending=false;this.updateTableHeaderState();}};p1.prototype._isTableBound=function(){if(this._bIsTableBound){return true;}if(this._oTable){return this._oTable.isBound(this._sAggregation);}return false;};p1.prototype.setNoData=function(e){this._oNoData=e;if(this._bNoDataUpdated||this._isTableBound()){this._setNoDataText();}return this;};p1.prototype.getNoData=function(){return this._oNoData;};p1.prototype._setNoDataText=function(e){var i=this._oTable.setNoData;if(!i){i=this._oTable.setNoDataText;}if(!i){return;}if(this._bNoDataUpdated&&this._vCustomNoData){i.call(this._oTable,this._vCustomNoData,true);return;}var q1=e;if(!q1){q1=this.getNoData();}if(!q1){q1=C.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_NO_RESULTS");}i.call(this._oTable,q1,true);};p1.prototype.updateTableHeaderState=function(){this._refreshHeaderText();this._setExcelExportEnableState();};p1.prototype._createContent=function(){var i,e=0,q1,r1,s1,t1=[];if(this._aExistingColumns&&this._aExistingColumns.length){this._aColumnKeys=[].concat(this._aExistingColumns.reverse());}r1=this._parseIndexedColumns();e=this._aTableViewMetadata.length;for(i=0;i<e;i++){q1=this._aTableViewMetadata[i];if(q1.isInitiallyVisible){this._aColumnKeys.push(q1.name);}else{t1.push(q1.name);}if(!(q1.isInitiallyVisible||q1.inResult)){this._mLazyColumnMap[q1.name]=q1;}else{s1=this._createColumnForField(q1);this._oTable.addColumn(s1);}this._mFieldMetadataByKey[q1.name]=q1;}this._insertIndexedColumns(r1);this._aColumnKeys=this._aColumnKeys.concat(t1);if(this._isMobileTable&&this.getEnableAutoColumnWidth()){this.setDemandPopin(true);this._oTable.setFixedLayout("Strict");this._oTable.setContextualWidth("auto");this._oTable.addDependent(new g1());}this._updateColumnsPopinFeature();if(this.getShowDetailsButton()){this._oTable.setHiddenInPopin(this._getImportanceToHide());}this._storeInitialColumnSettings();};p1.prototype._createColumnForField=function(e){var i,q1;q1=this.getId()+"-"+e.name.replace(/[^A-Za-z0-9_.:-]+/g,"_");i=this._createColumn(e,q1);e.isColumnCreated=true;i.data("p13nData",{columnKey:e.name,leadingProperty:e.name,additionalProperty:e.additionalProperty,navigationProperty:e.navigationProperty,sortProperty:e.sortable?e.name:undefined,filterProperty:e.filterable?e.name:undefined,isGroupable:e.sortable&&e.filterable&&e.aggregationRole==="dimension",fullName:e.hasValueListAnnotation?e.fullName:null,type:e.filterType,typeInstance:e.modelType,maxLength:e.maxLength,precision:e.precision,scale:e.scale,align:e.align,edmType:e.type,displayBehaviour:e.displayBehaviour,description:e.description,isDigitSequence:e.isDigitSequence,isCurrency:e.isCurrencyField,unit:e.unit,width:e.width,aggregationRole:e.aggregationRole,nullable:e.nullable!=="false"});if(e.filterable&&i.setFilterProperty){i.setFilterProperty(e.name);}if(e.sortable&&i.setSortProperty){i.setSortProperty(e.name);}if(this.getEnableAutoColumnWidth()){e.width=i.getWidth();if(this.getEditable()){this._updateColumnWidthForEdit(i,e);}}this._registerContentTemplateEvents(e.template);return i;};p1.prototype._parseIndexedColumns=function(){var i,e,q1,r1,s1,t1,u1,v1,w1;var x1=this._oTable.getColumns();var y1=null;if(this._oTemplate&&this._oTemplate.getCells){y1=this._oTemplate.getCells();}if(!x1){return null;}r1=[];e=x1.length;for(i=0;i<e;i++){q1=x1[i];s1=q1.data("p13nData");t1=null;u1=null;if(s1){t1=s1.columnIndex;u1=s1.columnKey;}v1=-1;if(t1!==null&&t1!==undefined){v1=parseInt(t1);}if(!isNaN(v1)&&v1>-1){if(y1){w1=y1[i];this._oTemplate.removeCell(w1);}else{w1=null;}this._aColumnKeys.splice(i-r1.length,1);r1.push({index:v1,columnKey:u1,column:q1,template:w1});this._oTable.removeColumn(q1);}}r1.sort(function(z1,A1){return z1.index-A1.index;});return r1;};p1.prototype._insertIndexedColumns=function(e){var i,q1,r1;if(!e){return;}q1=e.length;for(i=0;i<q1;i++){r1=e[i];this._aColumnKeys.splice(r1.index,0,r1.columnKey);this._oTable.insertColumn(r1.column,r1.index);if(r1.template){this._oTemplate.insertCell(r1.template,r1.index);}}};p1.prototype._updateColumnsPopinFeature=function(){if(!this._isMobileTable||!this.getDemandPopin()){return;}if(!this._oTable.getAutoPopinMode()){this._oTable.setAutoPopinMode(true);}var e=this._oTable.getColumns(true);if(!e){return;}e=e.filter(function(i){return i.getVisible();});e.forEach(function(i){if(i.getPopinDisplay()!="WithoutHeader"){i.setPopinDisplay("Inline");}});};p1.prototype._storeInitialColumnSettings=function(){this._aInitialSorters=[];P.createSort2Json(this._oTable,this._aInitialSorters,P.createArrayFromString(this.getIgnoreFromPersonalisation()));};p1.prototype._deactivateColumnsPopinFeature=function(){if(!this._isMobileTable){return;}if(this._oTable.getAutoPopinMode()){this._oTable.setAutoPopinMode(false);}var e=this._oTable.getColumns();if(!e){return;}var q1,r1=e.length;for(var i=0;i<r1;i++){q1=e[i];q1.setDemandPopin(false);q1.setMinScreenWidth("1px");}};p1.prototype._registerContentTemplateEvents=function(e){if(e.isA("sap.ui.comp.SmartToggle")){e=e.getEdit();}if(e&&e.attachChange){e.attachChange(function(i){this.fireFieldChange({changeEvent:i});},this);}};p1.prototype._updateInitialColumns=function(){var i=this._oTable.getColumns(),q1=i.length,r1,s1;var t1=this.getEnableAutoColumnWidth();while(q1--){r1=i[q1];s1=r1.data("p13nData");if(s1&&s1.columnKey&&this._aExistingColumns.indexOf(s1.columnKey)>=0){continue;}if(typeof s1==="string"){try{s1=JSON.parse(s1);r1.data("p13nData",s1);}catch(e){}}if(s1&&s1.columnKey){this._aExistingColumns.push(s1.columnKey);}if(t1&&this._isMobileTable){var u1=r1.getHeader();if(u1&&u1.isPropertyInitial("wrapping")&&u1.getMetadata().getProperty("wrapping")){u1.setWrapping(false);}}}};p1.prototype._getRelevantColumnPaths=function(){var e={},q1=[],r1=[],s1=this._oTable.getColumns(),i,t1=s1?s1.length:0,u1,v1,w1,x1,y1;var z1=function(w1,A1){var B1,C1;if(w1){C1=w1.split(",");B1=C1.length;while(B1--){w1=C1[B1];if(w1&&A1.indexOf(w1)<0){A1.push(w1);}}}};for(i=0;i<t1;i++){u1=s1[i];w1=null;if(u1.getVisible()||(u1.getInResult&&u1.getInResult())){if(u1.getLeadingProperty){w1=u1.getLeadingProperty();}v1=u1.data("p13nData");if(v1){if(!w1){w1=v1["leadingProperty"];}x1=v1["additionalProperty"];y1=v1["navigationProperty"];}if(w1&&q1.indexOf(w1)<0){q1.push(w1);}z1(x1,q1);z1(y1,r1);}}e["select"]=q1;e["expand"]=r1;return e;};p1.prototype._createTable=function(){var e=this.getItems(),i=e?e.length:0,q1,r1;this._sAggregation="rows";while(i--){q1=e[i];if(q1 instanceof v||q1 instanceof R){break;}q1=null;}if(q1){this._oTable=q1;if(q1 instanceof t){this._isAnalyticalTable=true;}else if(q1 instanceof R){this._isMobileTable=true;this._oTemplate=(q1.getItems()&&q1.getItems().length>0)?q1.getItems()[0]:new b();q1.removeAllItems();}else if(q1 instanceof w){this._isTreeTable=true;}this._updateInitialColumns();}else{r1=this.getId()+"-ui5table";if(this.getTableType()==="AnalyticalTable"){this._isAnalyticalTable=true;this._oTable=new t(r1,{enableCustomFilter:true});}else if(this.getTableType()==="ResponsiveTable"){this._isMobileTable=true;this._oTable=new R(r1,{growing:true,autoPopinMode:this.getDemandPopin()});this._oTemplate=new b();}else if(this.getTableType()==="TreeTable"){this._isTreeTable=true;this._oTable=new w(r1,{selectionMode:"MultiToggle"});}else{this._oTable=new v(r1,{selectionMode:"MultiToggle"});}if(this._oTable.setVisibleRowCountMode){this._oTable.setVisibleRowCountMode("Auto");}this.insertItem(this._oTable,2);}this._oTableReady.resolve(this._oTable);this._fColumnPaddingBorder=(this._isMobileTable)?1:1.1875;if(!this._oTable.getLayoutData()){if(this._oTable instanceof R||(this._oTable.getVisibleRowCountMode&&this._oTable.getVisibleRowCountMode()!=="Auto")){this._oTable.setLayoutData(new l({growFactor:1,baseSize:"auto"}));}else{this._oTable.setLayoutData(new l({growFactor:1,baseSize:"0%"}));}}this._oTable.addStyleClass("sapUiCompSmartTableInnerTable");this._oTable.setEnableBusyIndicator(true);this._oTable.setBusyIndicatorDelay(100);if(this._oTable.setEnableCustomFilter){this._oTable.setEnableCustomFilter(this.getEnableCustomFilter());}if(this._oTable.setShowColumnVisibilityMenu){this._oTable.setShowColumnVisibilityMenu(false);}this._attachTableCustomFilter();if(this._isAnalyticalTable){this._createColumn=this._createAnalyticalColumn;}else if(this._isMobileTable){if(this.getUseTablePersonalisation()){this._oTable.bActiveHeaders=true;this._oTable.attachEvent("columnPress",this._onColumnPress,this);this._oTable.attachSort=function(){this.attachEvent("sort",arguments[0],arguments[1],arguments[2]);};this._oTable.detachSort=function(){this.detachEvent("sort",arguments[0],arguments[1]);};}this._sAggregation="items";this._createColumn=this._createMobileColumn;this._oTable.bindRows=this._oTable.bindItems;if(this.getShowDetailsButton()){this._oTable.attachEvent("popinChanged",this._onPopinChanged,this);}}if(!this._isMobileTable){this._oTable.attachRowsUpdated(function(){this._setExcelExportEnableState();},this);}if(this._oTable._setLargeDataScrolling){this._oTable._setLargeDataScrolling(true);}this._oTable.attachPaste(this._onInnerTablePaste,this);};p1.prototype._attachTableCustomFilter=function(){if(this._oTable.detachCustomFilter){this._oTable.detachCustomFilter(this._onCustomFilter,this);}if(this._oTable.getEnableCustomFilter&&this._oTable.getEnableCustomFilter()&&this._bIsFilterPanelEnabled){if(this._oTable.setEnableCellFilter){this._oTable.setEnableCellFilter(false);}if(this._oTable.attachCustomFilter){this._oTable.attachCustomFilter(this._onCustomFilter,this);}}};p1.prototype._createResponsivePopover=function(e){this._oFilterButton=new Y({text:C.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_RP_FILTER"),icon:"sap-icon://filter",press:[function(q1){this._onCustomFilter(q1);},this]});var i=C.getLibraryResourceBundle("sap.ui.comp");this._aSortButton=[new h1({label:i.getText("SMARTTABLE_RP_SORT_ASCENDING"),icon:"sap-icon://sort-ascending",action:[true,this._onCustomSort,this]}),new h1({label:i.getText("SMARTTABLE_RP_SORT_DESCENDING"),icon:"sap-icon://sort-descending",action:[false,this._onCustomSort,this]})];this._oColumnHeaderPopover=new X({items:[this._aSortButton,this._oFilterButton]});if(e){this._oColumnHeaderPopover.addItem(new Y({text:C.getLibraryResourceBundle("sap.ui.comp").getText("SMARTTABLE_RP_RESIZE"),icon:"sap-icon://resize-horizontal",press:[function(){g1.getPlugin(this._oTable).startResizing(this._oColumnClicked.getDomRef());},this]}));}};p1.prototype._onColumnPress=function(e){this._oColumnClicked=e.getParameter("column");var i=this._oColumnClicked.data("p13nData");var q1=window.matchMedia("(hover:none)").matches&&this._isMobileTable&&this.getEnableAutoColumnWidth();if(!i&&!q1){return;}var r1=i.filterProperty;var s1=i.sortProperty;if(!this._oColumnHeaderPopover){this._createResponsivePopover(q1);}this._oFilterButton.setVisible(!!r1&&this._bIsFilterPanelEnabled);var t1=!!s1&&this._bIsSortPanelEnabled;this._aSortButton[0].setVisible(t1);this._aSortButton[1].setVisible(t1);if((r1&&this._bIsFilterPanelEnabled)||(s1&&this._bIsSortPanelEnabled)||q1){this._oColumnHeaderPopover.removeAllAriaLabelledBy();this._oColumnHeaderPopover.addAriaLabelledBy(this._oColumnClicked.getHeader());this._oColumnHeaderPopover.openBy(this._oColumnClicked);}};p1.prototype._onCustomSort=function(e,i){var q1=this._oColumnClicked.data("p13nData");var r1,s1;if(q1){if(q1.sorted&&q1.sorted.ascending===i){delete q1.sorted;s1=n1.None;this._oColumnClicked.setSortIndicator(s1);}else{q1.sorted={"ascending":i};r1=q1.sorted;s1=(r1&&r1.ascending)?n1.Ascending:n1.Descending;}this._oTable.fireEvent("sort",{column:this._oColumnClicked,sortOrder:s1,columnAdded:false});}};p1.prototype._onCustomFilter=function(e){this._showTableFilterDialog(e.getParameter("column")||this._oColumnClicked);};p1.prototype._onPopinChanged=function(e){if(!this._oShowHideDetailsButton){this._createShowHideDetailsButton();}var i=e.getParameter("visibleInPopin");var q1=e.getParameter("hiddenInPopin");var r1=e.getSource().getVisibleItems();var s1=i.some(function(t1){return this._getImportanceToHide().indexOf(t1.getImportance())>-1;},this);if(r1.length&&(q1.length||s1)){this._oShowHideDetailsButton.setVisible(true);}else{this._oShowHideDetailsButton.setVisible(false);}};p1.prototype.getTable=function(){return this._oTable;};p1.prototype._showTableFilterDialog=function(e){if(this._oPersController){var i={filter:{visible:true}};if(e){i.filter["payload"]={column:e};}this._oPersController.openDialog(i);}};p1.prototype._calcColumnWidth=function(e,i,q1){q1=Object.assign({label:i?false:true,defaultWidth:i?4:8,padding:this._fColumnPaddingBorder},q1);if(!e){return q1.defaultWidth;}var r1=0,s1=0,t1=Math.max(q1.min||0,(i?1:2)),u1=Math.max(t1,q1.max||19),v1=e.additionalProperty||"",w1=e.displayBehaviour,x1=e.modelType,y1=e.type||"";if(u1<t1){return u1;}if(q1.additionalProperty){v1=q1.additionalProperty.concat(v1.split(",")).filter(function(A1,B1,C1){return A1&&C1.indexOf(A1)==B1;}).join(",");}if(i||e.unit||!v1||w1!="descriptionOnly"){if(e.isImageURL||y1=="Edm.Byte"||y1=="Edm.SByte"){r1+=t1;}else if(x1){r1+=i1.calcTypeWidth(x1,{defaultWidth:q1.defaultWidth,maxWidth:q1.maxWidth});}else{r1+=q1.defaultWidth;}}if(this._isTreeTable&&e.hierarchy&&e.index==0){r1+=3;}if(!i){e.ownWidth=r1=Math.min(r1,u1);}if(!i&&w1!="idOnly"&&v1&&this._oTableProvider&&r1<u1){v1.split(",").forEach(function(v1){if(v1==e.fieldControlProperty){return;}var A1=this._oTableProvider.getFieldMetadata(v1);var B1=Object.assign({padding:0.4,max:u1-r1-0.4},e.vertical&&{padding:0,max:u1});var C1=this._calcColumnWidth(A1,true,B1);if(e.vertical){r1=Math.max(C1,r1);}else{r1+=C1;}},this);if(w1=="descriptionOnly"){e.ownWidth=r1;}else{e.additionalWidth=r1-e.ownWidth;}}r1=r1+(q1.gap||0);if(q1.label){var z1=e.label||e.fieldLabel||"";e.labelWidth=s1=i1.calcHeaderWidth(z1,r1,u1,t1);}r1=Math.max(t1,r1,s1);r1=Math.min(r1,u1)+q1.padding;r1=Math.round(r1*100)/100;return r1;};p1.prototype._setWidthForCustomColumn=function(e){var i=e.data("p13nData");if(!this._oTableProvider||!i||!i.autoColumnWidth||e.getWidth()){return;}var q1=i.autoColumnWidth;var r1=q1.visibleProperty||[i.leadingProperty,i.additionalProperty].join(",");var s1=r1.split(",");var t1=this._oTableProvider.getFieldMetadata(s1.shift(),true);if(!t1){return;}t1.label=this._getColumnLabel(e);var u1=this._calcColumnWidth(t1,false,{additionalProperty:s1,min:q1.min,max:q1.max,gap:q1.gap});t1.width=u1+"rem";e.setWidth(t1.width);if(this.getEditable()){this._updateColumnWidthForEdit(e,t1,q1);}};p1.prototype._updateColumnWidthForEdit=function(e,i){if(!i||!i.isColumnCreated||i.type=="Edm.Boolean"||i.semanticObjects){return;}var q1=this.data("useSmartField")=="true"||this.data("useSmartField")===true;if(q1&&i["sap:updatable"]=="false"){return;}var r1=e.getWidth();if(!this.getEditable()){if(i.editWidth==r1){e.setWidth(i.width);}}else if(i.width==r1){if(i.editWidth){return e.setWidth(i.editWidth);}if(!this._aEditableColumnAdditionalWidth){var s1=this._fColumnPaddingBorder;var t1=this.$().closest(".sapUiSizeCompact").length?"_Compact":"";var u1=parseFloat(f1.get({name:"_sap_m_InputBase"+t1+"_IconWidth"}));s1+=parseFloat(f1.get({name:"_sap_m_InputBaseWrapper_Sum_Border"}));s1+=parseFloat(f1.get({name:"_sap_m_InputBase"+t1+"_InnerPadding"}).split(" ").pop())*2;this._aEditableColumnAdditionalWidth=[s1,s1+u1-0.25];}var v1=(i.displayBehaviour||"").includes("And");var w1=(i.labelWidth||0)+this._fColumnPaddingBorder;if(q1&&v1&&i.additionalWidth&&i.hasValueListAnnotation&&!i.hasFixedValues){i.editWidth=Math.max(i.ownWidth+this._aEditableColumnAdditionalWidth[1],w1)+"rem";return e.setWidth(i.editWidth);}var x1=i.isCalendarDate||E.isDateOrTime(i.type);var y1=i.hasValueListAnnotation||x1;var z1=this._aEditableColumnAdditionalWidth[+y1];if(q1&&v1&&!i.additionalWidth&&i.hasValueListAnnotation&&i.hasFixedValues){z1=Math.max(i.ownWidth+3+z1,w1);}else if(i.ownWidth<4||x1){z1+=i.ownWidth;}else{z1+=2;}var A1=parseFloat(r1);if(A1<z1){i.editWidth=z1+"rem";e.setWidth(i.editWidth);}}};p1.prototype._updateVisibleColumnsWidthForEdit=function(){if(this._oTable&&this._oTableProvider&&this.getEnableAutoColumnWidth()){this._oTable.getColumns().forEach(function(e){if(e.getVisible()){var i=e.data("p13nData");var q1=i&&i.leadingProperty;if(q1){var r1=this._oTableProvider.getFieldMetadata(q1);r1&&this._updateColumnWidthForEdit(e,r1);}}},this);}};p1.prototype._createColumn=function(e,i){var q1=new u(i,{autoResizable:true,hAlign:e.align,width:e.width,visible:e.isInitiallyVisible,label:new d(i+"-header",{textAlign:e.align,text:e.label}),sorted:e.sorted,sortOrder:e.sortOrder,tooltip:e.quickInfo,showSortMenuEntry:e.sortable&&this._bIsSortPanelEnabled,showFilterMenuEntry:e.filterable&&this._bIsFilterPanelEnabled,name:e.fieldName,template:e.template});if(!e.width&&this.getEnableAutoColumnWidth()){q1.setWidth(this._calcColumnWidth(e)+"rem");}return q1;};p1.prototype._createAnalyticalColumn=function(e,i){if(e.aggregationRole!=="measure"&&e.isMeasureField&&e.unit&&e.template.addStyleClass){e.template.addStyleClass("sapUiAnalyticalTableSumCellHidden sapUiAnalyticalTableGroupCellHidden");}else if(e.isCurrencyField&&e.template.addStyleClass){e.template.addStyleClass("sapUiCompCurrencyBold");}var q1=new A(i,{autoResizable:true,hAlign:e.align,width:e.width,visible:e.isInitiallyVisible,inResult:e.inResult,label:new d(i+"-header",{textAlign:e.align,text:e.label}),tooltip:e.quickInfo,sorted:e.sorted,sortOrder:e.sortOrder,grouped:e.grouped,showIfGrouped:e.grouped,showSortMenuEntry:e.sortable&&this._bIsSortPanelEnabled,showFilterMenuEntry:e.filterable&&this._bIsFilterPanelEnabled,summed:e.summed,leadingProperty:e.name,template:e.template,groupHeaderFormatter:y.getInlineGroupFormatterFunction(e,true,this._getDateFormatSettings(),this._bPreserveDecimals)});if(!e.width&&this.getEnableAutoColumnWidth()){q1.setWidth(this._calcColumnWidth(e)+"rem");}return q1;};p1.prototype._createMobileColumn=function(e,i){var q1=new a(i,{hAlign:e.align,visible:e.isInitiallyVisible,header:new d(i+"-header",{textAlign:e.align,text:e.label,tooltip:e.quickInfo,wrapping:!this.getEnableAutoColumnWidth(),wrappingType:M.WrappingType.Hyphenated}),tooltip:e.quickInfo});if(e.importance&&!this._oTableProvider.isLineItemDefaultImportance(e)){q1.setImportance(e.importance);}if(this._oTemplate){this._oTemplate.addCell(e.template);}if(e.width){return q1.setWidth(e.width);}if(!this.getEnableAutoColumnWidth()){return q1.setWidth(e.isImageURL?"3em":"auto");}return q1.setWidth(this._calcColumnWidth(e)+"rem");};p1.prototype.fetchVariant=function(){if(this._oCurrentVariant==="STANDARD"||this._oCurrentVariant===null){return{};}return this._oCurrentVariant;};p1.prototype.applyVariant=function(e,i){this._oCurrentVariant=e;if(this._oCurrentVariant==="STANDARD"){this._oCurrentVariant=null;}this._bApplyingVariant=true;if(this._oTable._setSuppressRefresh){this._oTable._setSuppressRefresh(true);}if(this._oPersController){if(this._oCurrentVariant===null||q.isEmptyObject(this._oCurrentVariant)){this._oPersController.resetPersonalization("ResetFull");}else{this._oPersController.setPersonalizationData(this._oCurrentVariant,true);}}this._bApplyingVariant=false;this.fireAfterVariantApply({currentVariantId:this.getCurrentVariantId()});};p1.prototype.variantsInitialized=function(){this._bVariantInitialised=true;this._checkAndTriggerBinding();};p1.prototype.getUiState=function(){var e=this._oPersController?this._oPersController.getDataSuiteFormatSnapshot():null;return new U({presentationVariant:{SortOrder:e?e.SortOrder:[],GroupBy:e?e.GroupBy:[],Total:e?e.Total:[],RequestAtLeast:this._getRequestAtLeastFields(),Visualizations:e?e.Visualizations:[]},selectionVariant:{SelectOptions:e?e.SelectOptions:[]},variantName:this.getCurrentVariantId()});};p1.prototype.setUiState=function(e){this._setUiState(e,false);};p1.prototype.setUiStateAsVariant=function(e){this._setUiState(e,true);};p1.prototype._setUiState=function(e,i){var q1=e.getPresentationVariant()&&e.getPresentationVariant().RequestAtLeast?[].concat(e.getPresentationVariant().RequestAtLeast):[];if(!Q(q1,this._getRequestAtLeastFields())){this._aAlwaysSelect=q1;}if(this._oPersController){if(i){this._oPersController.setPersonalizationDataAsDataSuiteFormat(W({},e.getPresentationVariant(),e.getSelectionVariant()),true);}else{var r1=(this._oVariantManagement&&e.getVariantName())?this._oVariantManagement.getVariantContent(this,e.getVariantName()):{};this._oPersController.setDataSuiteFormatSnapshot(W({},e.getPresentationVariant(),e.getSelectionVariant()),r1,true);}}};p1.prototype._getRequestAtLeastFields=function(){var e=this.getRequestAtLeastFields();var i=e?e.split(","):[];return i.concat(this._aAlwaysSelect);};p1.prototype._personalisationRequestColumns=function(e){var q1=e.getParameter("columnKeys"),r1,i,s1,t1,u1,v1={};s1=q1.length;for(i=0;i<s1;i++){r1=q1[i];t1=this._mLazyColumnMap[r1];if(t1){u1=this._createColumnForField(t1);if(this._isMobileTable){this._oTable.addColumn(u1);}v1[t1.name]=u1;}}this._oPersController.addColumns(v1);};p1.prototype._beforePersonalisationModelDataChange=function(e){if(this._oTable.suspendUpdateAnalyticalInfo){this._oTable.suspendUpdateAnalyticalInfo();}};p1.prototype._afterPersonalisationModelDataChange=function(e){this._updateColumnsPopinFeature();if(this.getEditable()){this._updateVisibleColumnsWidthForEdit();}};p1.prototype._personalisationModelDataChange=function(e){this._oCurrentVariant=e.getParameter("persistentData");if(this._fGetDataForKeyUser){this._fGetDataForKeyUser(this._createKeyUserChange());}var i=e.getParameter("runtimeDeltaDataChangeType");var q1=this._getChangeStatus(i);if(q1==="Unchanged"){return;}if(!(this._bApplyingVariant||this._bDeactivatingColumns)){if(!this.getUseVariantManagement()){this._persistPersonalisation();}else if(this._oVariantManagement){this._oVariantManagement.currentVariantSetModified(true);}}if(q1==="ModelChanged"&&this._isTableBound()){if(i&&i.columns==="ModelChanged"){this._bForceTableUpdate=true;}if(this._oSmartFilter){this._oSmartFilter.search();}else{this._reBindTable(null);}}if(this._isMobileTable){this._adaptCustomSort();}this._createInfoToolbar();};p1.prototype._adaptCustomSort=function(){if(this._oCurrentVariant){var e,i,q1,r1=[],s1;if(this._oCurrentVariant.sort&&this._oCurrentVariant.sort.sortItems){r1=this._oCurrentVariant.sort.sortItems;}this._oTable.getColumns().forEach(function(t1){e=t1.data("p13nData");i=e&&e.columnKey;if(i){q1=r1.filter(function(u1){return i===u1.columnKey;});s1=q1[0];if(s1){if(!e.sorted){e.sorted={"ascending":false};}if(s1.operation===n1.None){delete e.sorted;}else{e.sorted={"ascending":s1.operation!==n1.Descending};}t1.setSortIndicator(s1.operation);}else if(e&&e.sorted){e.sorted=null;t1.setSortIndicator(c.None);}}else if(t1.getSortIndicator()!==n1.None){t1.setSortIndicator(n1.None);}},this);}};p1.prototype.setUseInfoToolbar=function(e){this.setProperty("useInfoToolbar",e,true);if(this.getTable()){this._createInfoToolbar();}return this;};p1.prototype._updateInfoToolbar=function(i,e){if(!this._oInfoToolbar){this._oInfoToolbar=new O({active:true,visible:true,design:l1.Info,content:[new T({id:this.getId()+"-infoToolbarText",text:i,wrapping:false})],press:[e,this._handleInfoToolbarPress,this]});}else{this._oInfoToolbar.setVisible(true);this._oInfoToolbar.getContent()[0].setText(i);this._oInfoToolbar.detachPress(this._handleInfoToolbarPress,this);this._oInfoToolbar.attachPress(e,this._handleInfoToolbarPress,this);}};p1.prototype._handleInfoToolbarPress=function(e,i){this._showTableFilterDialog(i);};p1.prototype._createInfoToolbar=function(){var e=this.getUseInfoToolbar(),i=this.getTable(),q1=this.getId()+"-infoToolbarText",r1,s1=C.getLibraryResourceBundle("sap.ui.comp");if(e===o1.Off){if(this._oInfoToolbar&&this._oInfoToolbar.getVisible()){this._oInfoToolbar.setVisible(false);i.removeAriaLabelledBy(q1);}return;}if(this._isMobileTable){if(i.getInfoToolbar()&&!this._oInfoToolbar){I.error("Custom infoToolbar is used, hence set useInfoToolbar property on the SmartTable with id='"+this.getId()+"' to Off");return;}var t1=this._oCurrentVariant&&this._oCurrentVariant.filter&&this._oCurrentVariant.filter.filterItems,u1=t1&&t1.length;if(u1){var v1=[],w1=L.getInstance();t1.forEach(function(y1){var z1=this._getColumnLabel(y1.columnKey);if(z1&&v1.indexOf(z1)===-1){v1.push(z1);}},this);var x1=s1.getText("SMARTTABLE_INFOTOOLBAR_FILTERED_BY",[w1.format(v1)]);r1=this._getColumnByKey(t1[0].columnKey);this._updateInfoToolbar(x1,r1);if(!i.getInfoToolbar()){i.setInfoToolbar(this._oInfoToolbar);}if(i.getAriaLabelledBy().indexOf(q1)===-1){i.addAriaLabelledBy(q1);}}else if(this._oInfoToolbar&&this._oInfoToolbar.getVisible()){this._oInfoToolbar.setVisible(false);i.removeAriaLabelledBy(q1);}}else if(this._oInfoToolbar){this._oInfoToolbar.setVisible(false);}};p1.prototype._getChangeStatus=function(e){if(!e){return"ModelChanged";}if(e.sort==="ModelChanged"||e.filter==="ModelChanged"||e.columns==="ModelChanged"||e.group==="ModelChanged"){return"ModelChanged";}if(e.sort==="TableChanged"||e.filter==="TableChanged"||e.columns==="TableChanged"||e.group==="TableChanged"){return"TableChanged";}return"Unchanged";};p1.prototype._getDateFormatSettings=function(){if(this._oTableProvider&&this._oTableProvider._oDateFormatSettings){return this._oTableProvider._oDateFormatSettings;}return undefined;};p1.prototype._getTablePersonalisationData=function(){this._mSelectExpandForGroup=null;if(!this._oCurrentVariant){return null;}var e=[],i=[],q1=[],r1,s1,t1,u1,v1,w1,x1,y1,z1,A1,B1={},C1={},D1="",E1;if(this._isMobileTable&&this._oCurrentVariant.group&&this._oCurrentVariant.group.groupItems){s1=this._oCurrentVariant.group.groupItems[0];if(this._aDeactivatedColumns.indexOf(s1.columnKey)<0){v1=this._getColumnByKey(s1.columnKey);if(v1){D1=v1.getHeader().getText();}A1=this._getPathFromColumnKeyAndProperty(s1.columnKey,"sortProperty");}if(A1){x1=A1;y1=null;var F1=this._mFieldMetadataByKey[s1.columnKey],G1;if(F1){y1=F1.unit||F1.description;G1=y.getInlineGroupFormatterFunction(F1,false,this._getDateFormatSettings(),this._bPreserveDecimals);}t1=new p(x1,s1.operation==="GroupDescending",function(J1){var K1=J1.getProperty(x1),L1;if(G1){if(y1){L1=J1.getProperty(y1);}K1=G1(K1,L1);}if(K1===undefined||K1===null){K1="";}return{key:K1,text:D1?D1+": "+K1:K1};});this._mSelectExpandForGroup={select:[x1]};if(F1){if(F1.additionalProperty){this._mSelectExpandForGroup.select.push(F1.additionalProperty);}if(F1.navigationProperty){this._mSelectExpandForGroup.expand=[F1.navigationProperty];}}e.push(t1);}}if(this._oCurrentVariant.sort){u1=this._oCurrentVariant.sort.sortItems;}else{u1=this._aInitialSorters;}if(u1){u1.forEach(function(J1,K1){var L1=J1.operation==="Descending";A1=null;z1=null;if(this._aDeactivatedColumns.indexOf(J1.columnKey)<0){A1=this._getPathFromColumnKeyAndProperty(J1.columnKey,"sortProperty");}if(A1){if(t1&&t1.sPath===A1){t1.bDescending=L1;}else{var F1=this._mFieldMetadataByKey[J1.columnKey];if(!F1){v1=this._getColumnByKey(J1.columnKey);w1=v1.data("p13nData");}if(this._bMultiUnitBehaviorEnabled&&((F1&&F1.isCurrencyField)||(w1&&w1.isCurrency))){z1=F1?F1.unit:w1.unit;if(z1&&!B1[z1]){B1[z1]={index:K1,descending:L1};}}C1[A1]={};if(C1[z1]){delete B1[z1];}else if(B1[A1]){delete B1[A1];}e.push(new p(A1,L1));}}},this);var H1=Object.keys(B1),I1;if(H1.length){H1.reverse().forEach(function(J1){I1=t1?B1[J1].index+1:B1[J1].index;e.splice(I1,0,new p(J1,B1[J1].descending));});}}if(this._oCurrentVariant.filter){this._oCurrentVariant.filter.filterItems.forEach(function(J1){var K1=J1.value1,L1=J1.value2,M1;A1=null;E1=false;v1=null;if(this._aDeactivatedColumns.indexOf(J1.columnKey)<0){v1=this._getColumnByKey(J1.columnKey);}if(v1){if(v1.getFilterProperty){A1=v1.getFilterProperty();}w1=v1.data("p13nData");if(w1){E1=w1.type==="time";if(!A1){A1=w1["filterProperty"];}}}if(A1){if(E1){if(K1 instanceof Date){K1=y.getEdmTimeFromDate(K1);}if(L1 instanceof Date){L1=y.getEdmTimeFromDate(L1);}}else{var N1=w1&&w1.typeInstance&&w1.typeInstance.getName()==="sap.ui.model.odata.type.DateTimeOffset";if(K1 instanceof Date&&!N1&&this._oTableProvider&&this._oTableProvider.getIsUTCDateHandlingEnabled()){K1=D.localToUtc(K1);L1=L1?D.localToUtc(L1):L1;}}var O1=(J1.exclude?q1:i);if(J1.operation==="Empty"){var P1=J1.exclude?s.NE:s.EQ;if(w1.edmType==="Edm.String"||w1.type==="string"){if(!w1.nullable){O1.push(new r(A1,P1,""));}else{O1.push(new r({and:!!J1.exclude,filters:[new r(A1,P1,""),new r(A1,P1,null)]}));}}else if(w1.nullable){O1.push(new r(A1,P1,null));}}else{M1=J1.exclude?F.getTransformedExcludeOperation(J1.operation):J1.operation;O1.push(new r(A1,M1,K1,L1));}}},this);if(q1.length){r1=new r(q1,true);}}return{filters:i,excludeFilters:r1,sorters:e};};p1.prototype._getColumnByKey=function(e){var q1,r1,s1,i,t1;if(this._oTable){q1=this._oTable.getColumns();s1=q1.length;for(i=0;i<s1;i++){r1=q1[i];t1=r1.data("p13nData");if(t1&&t1.columnKey===e){return r1;}}}return null;};p1.prototype._getPathFromColumnKeyAndProperty=function(e,i){var q1=null,r1,s1;r1=this._getColumnByKey(e);if(r1){if(i=="sortProperty"&&r1.getSortProperty){q1=r1.getSortProperty();}else if(i=="filterProperty"&&r1.getFilterProperty){q1=r1.getFilterProperty();}else if(i=="leadingProperty"&&r1.getLeadingProperty){q1=r1.getLeadingProperty();}if(!q1){s1=r1.data("p13nData");if(s1){q1=s1[i];}}}return q1;};p1.prototype._persistPersonalisation=function(){if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){var e=this.getCurrentVariantId();if(!this._bSaving){this._bSaving=true;this._oVariantManagement.fireSave({name:"Personalisation",implicit:true,global:false,overwrite:!!e,key:e,def:true});delete this._bSaving;}}};p1.prototype.getCurrentVariantId=function(){return this._oVariantManagement?this._oVariantManagement.getCurrentVariantId():"";};p1.prototype.setCurrentVariantId=function(e){if(this._oVariantManagement&&!this._oVariantManagement.isPageVariant()){this._oVariantManagement.setCurrentVariantId(e);}else{I.error("sap.ui.comp.smarttable.SmartTable.prototype.setCurrentVariantId: VariantManagement does not exist, or is a page variant");}return this;};p1.prototype.setDetailsButtonSetting=function(e){this.setProperty("detailsButtonSetting",e,true);return this;};p1.prototype.setEnablePaste=function(e){this.setProperty("enablePaste",e,true);var i=C.byId(this.getId()+"-btnPaste");if(i){i.setEnabled(this.getEnablePaste());}return this;};p1.prototype.isInitialised=function(){return!!this.bIsInitialised;};p1.prototype._aAvailablePanels=["Columns","Sort","Filter","Group"];p1.prototype.openPersonalisationDialog=function(e){if(!e||this._aAvailablePanels.indexOf(e)<0){I.warning("sap.ui.comp.smarttable.SmartTable.prototype.openPersonalisationDialog: "+e+" is not a valid panel!");return;}if(this._oPersController){var i={};i[e.toLowerCase()]={visible:true};this._oPersController.openDialog(i);}};p1.prototype.deactivateColumns=function(e){this._aDeactivatedColumns=e||[];this._bDeactivatingColumns=true;if(this._oPersController){this._oPersController.addToSettingIgnoreColumnKeys(this._aDeactivatedColumns);}this._bDeactivatingColumns=false;};p1.prototype._onInnerTablePaste=function(e){if(!this.getEnablePaste()||(!this.hasListeners("beforePaste")&&!this.hasListeners("paste"))){return;}var i=e.getParameter("data");var q1=i.slice(0);var r1=this._getColumnInfoForPaste();if(this.fireBeforePaste({columnInfos:r1})){sap.ui.require(["sap/ui/core/util/PasteHelper"],function(s1){s1.parse(q1,r1).then(function(t1){this.firePaste({result:t1});}.bind(this));}.bind(this));}};p1.prototype._getColumnInfoForPaste=function(){var e=[],q1=this._oTable.getColumns(),i,r1=q1.length,s1,t1,u1,v1,w1,x1;if(this._isMobileTable&&q1.length){q1=q1.sort(function(y1,z1){return y1.getOrder()-z1.getOrder();});}for(i=0;i<r1;i++){s1=q1[i];u1=null;x1=null;if(s1.getVisible()){if(s1.getLeadingProperty){u1=s1.getLeadingProperty();}t1=s1.data("p13nData");if(!u1&&t1){u1=t1["leadingProperty"];}v1=t1.type==="numeric"?"number":t1.type;w1=t1["typeInstance"];if(t1.isCurrency||v1==="number"){x1=t1.unit;}else if(t1.description&&t1.displayBehaviour!=="idOnly"){x1=t1.description;}}e.push({columnId:s1.getId(),property:u1,ignore:!u1,type:w1});w1=E.getType("Edm.String");if(x1){e.push({columnId:s1.getId(),additionalProperty:true,property:x1,type:w1});}}return e;};p1.prototype.exit=function(){var i,e;this.detachEvent("_change",this._onPropertyChange,this);if(this._oSmartFilter){this._oSmartFilter.detachSearch(this._reBindTable,this);this._oSmartFilter.detachFilterChange(this._filterChangeEvent,this);this._oSmartFilter=null;}if(this._oTableProvider&&this._oTableProvider.destroy){this._oTableProvider.destroy();}this._oTableProvider=null;if(this._oPersController&&this._oPersController.destroy){this._oPersController.destroy();}this._oPersController=null;if(this._oVariantManagement){this._oVariantManagement.detachSave(this._variantSaved,this);this._oVariantManagement.detachAfterSave(this._variantAfterSave,this);if(!this._oVariantManagement.isPageVariant()&&this._oVariantManagement.destroy){this._oVariantManagement.destroy();}}this._oNumberFormatInstance=null;z.cleanUpFullScreen(this);if(this._oEditModel){this._oEditModel.destroy();}if(this._oNoData&&this._oNoData.destroy){this._oNoData.destroy();}this.oNoData=null;if(this._aTableViewMetadata){i=this._aTableViewMetadata.length;while(i--){e=this._aTableViewMetadata[i];if(e&&!e.isColumnCreated&&e.template){e.template.destroy();}}}if(this._oShowHideDetailsButton){this._oShowHideDetailsButton.destroy();}this._oShowHideDetailsButton=null;this._aTableViewMetadata=null;this._mFieldMetadataByKey=null;this._mSelectExpandForGroup=null;this._oEditModel=null;this._oVariantManagement=null;this._oCurrentVariant=null;this._aExistingColumns=null;this._mLazyColumnMap=null;this._aColumnKeys=null;this._aDeactivatedColumns=null;this._aAlwaysSelect=null;this._oCustomToolbar=null;if(this._oToolbar&&!this._bToolbarInsertedIntoItems){this._oToolbar.destroy();}this._oToolbar=null;if(this._oUseExportToExcel&&!this.getUseExportToExcel()){this._oUseExportToExcel.destroy();}this._oUseExportToExcel=null;this._oTablePersonalisationButton=null;this._oP13nDialogSettings=null;if(this._oTemplate){this._oTemplate.destroy();}this._oTemplate=null;if(this._oColumnHeaderPopover){this._oColumnHeaderPopover.destroy();}this._oColumnHeaderPopover=null;this._oFilterButton=null;this._aSortButton=null;this._oInfoToolbar=null;this._oTableReady=null;this._oView=null;this._oTable=null;};return p1;});
