/*
 * SAPUI5
 * (c) Copyright 2009-2021 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/core/library","sap/m/library","sap/ui/comp/library","sap/ui/model/BindingMode","sap/m/TextArea","sap/m/Link","sap/m/CheckBox","sap/m/ComboBox","sap/ui/comp/smartfield/ComboBox","sap/m/DatePicker","sap/m/DateTimePicker","sap/m/FlexItemData","sap/m/HBox","sap/m/Input","sap/m/Select","sap/m/Text","sap/m/ExpandableText","sap/ui/core/Renderer","sap/ui/comp/navpopover/SmartLink","./ControlFactoryBase","./FieldControl","./ODataControlSelector","./ODataHelper","./ODataTypes","./TextArrangementDelegate","sap/m/ObjectNumber","sap/m/ObjectIdentifier","sap/m/ObjectStatus","sap/m/TimePicker","sap/ui/comp/navpopover/SemanticObjectController","sap/ui/comp/util/FormatUtil","sap/ui/comp/smartfield/Configuration","sap/ui/comp/odata/MetadataAnalyser","sap/ui/comp/odata/FiscalMetadata","sap/ui/comp/navpopover/NavigationPopoverHandler","sap/ui/core/InvisibleText","sap/base/Log","sap/base/assert","sap/base/security/URLListValidator","sap/base/util/merge","sap/base/strings/capitalize","sap/base/util/deepClone",'sap/base/strings/whitespaceReplacer'],function(c,m,l,B,T,L,C,a,b,D,d,F,H,I,S,f,E,R,g,h,j,O,k,o,p,q,r,s,t,u,v,w,M,x,N,y,z,A,U,G,J,K,P){"use strict";var V=c.ValueState;var Q=c.TextAlign;var W=m.InputType;var X=m.FlexJustifyContent;var Y=l.smartfield.CriticalityRepresentationType;var Z=l.smartfield.ControlContextType;var $=c.TextDirection;var _=m.FlexAlignContent;var a1=m.EmptyIndicatorMode;var b1;var c1=h.extend("sap.ui.comp.smartfield.ODataControlFactory",{constructor:function(e,i,n){h.call(this,e,i);this.sName="ODataControlFactory";this._oMetaData={annotations:{}};this._oMeta=n;this._oHelper=new k(e,this._oBinding);this._oFieldControl=new j(i,this._oHelper);this._oTypes=new o(i);this._oSelector=new O(this._oMetaData,i,this._oTypes);this.oTextArrangementDelegate=new p(this);this._bInitialized=false;this.bPending=false;this._oAmountInputFlexItemData=null;this._oUOMInputFlexItemData=null;this._oUOMTextFlexItemData=null;this.oMeasureField=null;b1=sap.ui.require("sap/ui/comp/smartfield/SmartField");if(!b1){throw new Error("SmartField module not loaded for "+this);}}});c1.prototype._init=function(e){this._oMetaData.model=e.model;this._oMetaData.path=e.path;this._oMetaData.entitySet=e.entitySetObject||this._oHelper.oMeta.getODataEntitySet(e.entitySet);if(this._oHelper.oMeta){A(this._oMetaData.entitySet,'The entity set named "'+e.entitySet+'" was not found in the "'+this._oHelper.oMeta.getODataEntityContainer().name+'" entity container of the service metadata document. - '+this.getMetadata().getName());}this._oMetaData.entityType=e.entityType||this._oHelper.oMeta.getODataEntityType(this._oMetaData.entitySet.entityType);this._oMetaData.navigationPath=e.navigationPath||null;if(this._oModel){this._oHelper.checkNavigationProperty(this._oMetaData,this._oParent);this._oHelper.getProperty(this._oMetaData);var i=this.getEdmProperty();A(!!i,'The EDM property "'+e.path+'" was not found in the "'+this._oMetaData.entityType.namespace+"."+this._oMetaData.entityType.name+'" entity type. - '+this.getMetadata().getName());if(i){this._oMetaData.annotations.text=this._oHelper.getTextProperty2(this._oMetaData);this._oMetaData.annotations.uom=this._oHelper.getUnitOfMeasure2(this._oMetaData);this._oHelper.getValueListData(this._oMetaData);this._oMetaData.annotations.lineitem=this._oHelper.getAnalyzer().getLineItemAnnotation(this._oMetaData.entitySet.entityType);this._oHelper.getUOMValueListAnnotationPath(this._oMetaData);this._oMetaData.annotations.semantic=M.getSemanticObjectsFromProperty(i);this._oMetaData.annotations.semanticKeys=this._oHelper.getAnalyzer().getSemanticKeyAnnotation(this._oMetaData.entitySet.entityType);if(this._oMetaData.annotations.uom){this._oMetaData.annotations.uom.annotations={};this._oHelper.getValueListData(this._oMetaData.annotations.uom);}this._oHelper.getUOMTextAnnotation(this._oMetaData);if(this._oParent&&this._oParent.getExpandNavigationProperties()){var n=this._oParent.getBindingContext(),d1=n&&n.getObject(),e1=d1&&d1.__metadata.created;if(!e1){var f1=this._oHelper.getAutoExpandProperties(i);if(f1.length>0){this._oParent.bindElement({path:"",parameters:{expand:f1,select:f1}});}}}}}else{this._oMetaData.modelObject=e.modelObject;this._oMetaData.property=e.property;this._oMetaData.property.valueListAnnotation=null;this._oMetaData.property.valueListKeyProperty=null;this._oMetaData.property.valueListEntitySet=null;this._oMetaData.property.valueListEntityType=null;this._oMetaData.annotations.text=e.annotations.text;this._oMetaData.annotations.uom=e.annotations.uom;if(this._oMetaData.annotations.uom&&!this._oMetaData.annotations.uom.annotations){this._oMetaData.annotations.uom.annotations={};}this._oMetaData.annotations.valuelist=e.annotations.valuelist;this._oMetaData.annotations.valuelistType=e.annotations.valuelistType;this._oMetaData.annotations.lineitem=e.annotations.lineitem;this._oMetaData.annotations.semantic=e.annotations.semantic;this._oMetaData.annotations.valuelistuom=e.annotations.valuelistuom;}};c1.prototype._initValueList=function(e){var i=this._oMetaData.property,n=e.primaryValueListAnnotation;this._oMetaData.annotations.valueListData=n;i.valueListAnnotation=n;i.valueListKeyProperty=this._oHelper.getODataValueListKeyProperty(n);i.valueListEntitySet=this._oHelper.oMeta.getODataEntitySet(n.valueListEntitySetName);i.valueListEntityType=this._oHelper.oMeta.getODataEntityType(this._oHelper.oMeta.getODataEntitySet(n.valueListEntitySetName).entityType);};c1.prototype._getTextArrangementType=function(){var e=null,i=p.getPaths("ValueList",this._oMetaData);if(i.keyField&&i.descriptionField){e=this._oTypes.getType(this._oMetaData.property,null,null,{composite:true,keyField:i.keyField,descriptionField:i.descriptionField,valueListNoValidation:this._oParent._getComputedTextInEditModeSource()==="ValueListNoValidation"});if(!(e.isA("sap.ui.comp.smartfield.type.TextArrangementString")||e.isA("sap.ui.comp.smartfield.type.TextArrangementGuid"))){e=null;}}return e;};c1.prototype._createEdmDisplay=function(){var i,e,n,d1,e1,f1=false,g1="getText",h1=this,i1={width:true,textAlign:true},j1=this.getEdmProperty(),k1=this._oParent.data("configdata"),l1=((k1&&(k1.isInnerControl!==true))||this._oParent.isContextTable()),m1=this._oSelector.checkComboBox(l1),n1=this._oSelector.checkDatePicker()||(j1?j1.type.startsWith("Edm.Date"):false);if(j1){d1=this._oHelper.oAnnotation.getText(j1);}if(this._checkLink()&&!this._oSelector.useObjectIdentifier()){return this._createLink(n1);}e1=this.createAttributes(null,this._oMetaData.property,i1);e1.emptyIndicatorMode=a1.On;this.oType=null;if(n1){this.oType=this._getDateFormatType();e1.text={model:this._oMetaData.model,path:this._oMetaData.path,type:this.oType};}else{if(this._bTextInDisplayModeValueList&&this._oMetaData.property&&this._oMetaData.property.valueListAnnotation){this.oType=this._getTextArrangementType();}if(!this.oType){this.oType=this._oTypes.getType(this._oMetaData.property);}e1.text={model:this._oMetaData.model,path:this._oHelper.getEdmDisplayPath(this._oMetaData),type:this.oType};}if(j1){e=this._oHelper.oAnnotation.isMasked(j1);if(e){e1.text.formatter=o.maskValue;}if(d1){n=this._oSelector.useObjectIdentifier(n1,e);if(n){delete e1.width;delete e1.textAlign;e1.text={path:this._oMetaData.path};e1.title={path:this._oHelper.getEdmDisplayPath(this._oMetaData)};if(this._oParent.hasListeners("press")){e1.titleActive=true;e1.titlePress=function(s1){h1._oParent.firePress(s1);};}else if(this._oMetaData.annotations.semantic&&this._oMetaData.annotations.semantic.defaultSemanticObject){var o1;var p1;var q1=this._oMetaData.annotations.semantic.additionalSemanticObjects.concat(this._oMetaData.annotations.semantic.defaultSemanticObject);u.getDistinctSemanticObjects().then(function(s1){o1=u.hasDistinctSemanticObject(q1,s1);if(o1){var t1=h1._oParent.getBindingInfo("value");var u1=t1.parts[0].path;var v1=h1._oHelper.oAnnotation.getLabel(h1._oMetaData.property.property);if(h1._oMetaData.annotations.lineitem&&h1._oMetaData.annotations.lineitem.labels&&h1._oMetaData.annotations.lineitem.labels[u1]){v1=h1._oMetaData.annotations.lineitem.labels[u1];}p1=new N({semanticObject:h1._oMetaData.annotations.semantic.defaultSemanticObject,additionalSemanticObjects:h1._oMetaData.annotations.semantic.additionalSemanticObjects,semanticObjectLabel:v1,fieldName:u1,navigationTargetsObtained:function(w1){var x1=sap.ui.getCore().byId(w1.getSource().getControl());var y1=w1.getParameters().mainNavigation;if(y1){y1.setDescription(x1.getText());}w1.getParameters().show(x1.getTitle(),y1,undefined,undefined);}});}});e1.titleActive={path:"$sapuicompsmartfield_distinctSO>/distinctSemanticObjects",formatter:function(s1){return u.hasDistinctSemanticObject(q1,s1);}};e1.titlePress=function(s1){if(o1&&p1){p1.setControl(s1.getSource(s1.getParameter("domRef")));p1.openPopover();}};}}else if(!(k1&&(k1.isInnerControl===true))){e1.text={};e1.text.parts=[];e1.text.parts.push(this._oMetaData.path);e1.text.parts.push(this._oHelper.getEdmDisplayPath(this._oMetaData));e1.text.formatter=function(s1,t1){if(m1.combobox){var u1=h1._formatDisplayBehaviour("defaultComboBoxReadOnlyDisplayBehaviour",s1,t1),v1=u1(s1,t1);return P(v1);}if(h1.oType&&!h1._bTextInDisplayModeValueList){s1=h1.oType.formatValue(s1,"string");}if(h1.oType&&h1.oType.isA("sap.ui.comp.odata.type.NumericText")&&s1===null&&t1){s1="";}return h1._formatDisplayBehaviour("defaultInputFieldDisplayBehaviour",s1,t1);};}}else if(this._oSelector.checkCheckBox()){e1.text.formatter=function(s1){return h1._formatDisplayBehaviour("defaultCheckBoxDisplayBehaviour",s1);};}}if(n){i=new r(this._oParent.getId()+"-objIdentifier",e1);if(this._oMetaData.annotations.semantic){i.setModel(u.getJSONModel(),"$sapuicompsmartfield_distinctSO");}}else{if(e1.text.type&&e1.text.type.isA("sap.ui.comp.smartfield.type.DateTime")&&e1.text.type.oConstraints&&e1.text.type.oConstraints.isDateOnly){e1.wrapping=false;}if(this._oParent.isContextTable()&&sap.ui.getCore().getConfiguration().getRTL()){e1.textDirection="LTR";}if(typeof e1.text.formatter==="undefined"){e1.text.formatter=function(s1){return P(s1);};}if(this._oHelper.oAnnotation.isMultiLineText(j1)){delete e1.width;i=new E(this._oParent.getId()+"-expandableText",e1);}else{i=new f(this._oParent.getId()+"-text",e1);}f1=this._oSelector._checkComboBox(l1).combobox&&(this._oParent.getFetchValueListReadOnly()||(d1===undefined));if(f1){g1=null;}}if(n&&k1&&k1.configdata&&k1.configdata.onText){delete k1.configdata.onText;}var r1={control:i,onCreate:"_onCreate",params:{getValue:g1,noValidations:true,type:null}};if(this.oType){r1.type={type:this.oType,property:this._oMetaData.property};}return r1;};c1.prototype._getDateFormatType=function(){var i=this.getFormatSettings("dateFormatSettings"),n=this.getEdmProperty(),d1;try{d1=K(i);}catch(e){d1=i;}if(d1&&n&&n.type==="Edm.DateTimeOffset"){d1.UTC=false;}return this._oTypes.getType(this._oMetaData.property,d1);};c1.prototype._createEdmTime=function(){var e=this.getFormatSettings("dateFormatSettings"),n={width:true,placeholder:true,valueState:true,valueStateText:true};var i=c1.getBoundPropertiesMapInfoForControl(t.getMetadata().getName(),{propertyName:"value"})[0];var d1={valueFormat:"HH:mm:ss"};d1=Object.assign(d1,this.createAttributes(i,this._oMetaData.property,n,{event:"change",parameter:"value"}));if(d1.width===""){d1.width="100%";}if(e){d1[i].type=this._oTypes.getType(this._oMetaData.property,e);}var e1=new t(this._oParent.getId()+"-timePicker",d1);return{control:e1,onCreate:"_onCreate",params:{getValue:"getValue",type:{type:d1.value.type,property:this._oMetaData.property}}};};c1.prototype._createObjectStatus=function(){var e=this.createAttributes(null,this._oMetaData.property,null),i=this._oHelper.oAnnotation.getText(this.getEdmProperty());var n=c1.getBoundPropertiesMapInfoForControl(s.getMetadata().getName(),{propertyName:"value"})[0];if(i){e[n]={parts:[this._oHelper.getEdmDisplayPath(this._oMetaData)]};}else{e[n]={model:this._oMetaData.model,path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property)};}this._addObjectStatusAttributes(e);var d1=new s(this._oParent.getId()+"-objStatus",e);return{control:d1,onCreate:"_onCreate",params:{getValue:"getText",noValidation:true}};};c1.prototype._addObjectStatusAttributes=function(e){var i,n=this._oParent.getControlProposal(),d1=n.getObjectStatus();if(d1){i=d1.getBindingInfo("criticality");}var e1=function(h1){var i1={0:V.None,1:V.Error,2:V.Warning,3:V.Success};var j1={"com.sap.vocabularies.UI.v1.CriticalityType/Neutral":V.Neutral,"com.sap.vocabularies.UI.v1.CriticalityType/Negative":V.Warning,"com.sap.vocabularies.UI.v1.CriticalityType/Critical":V.Error,"com.sap.vocabularies.UI.v1.CriticalityType/Positive":V.Success};return j1[h1]||i1[h1]||V.None;};var f1=function(){var h1={};h1[V.Error]="sap-icon://message-error";h1[V.Warning]="sap-icon://message-warning";h1[V.Success]="sap-icon://message-success";h1[V.None]=null;var i1;if(i){if(i.formatter){i1=i.formatter.apply(null,arguments);}else{i1=arguments[0];}}else{i1=d1.getCriticality();}if((i1===undefined)||(i1===null)){return null;}return h1[e1(i1)];};var g1=function(){if(!d1){return false;}return d1.getCriticalityRepresentationType()!==Y.WithoutIcon;};if(i){e.state={formatter:function(){var h1;if(i.formatter){h1=i.formatter.apply(null,arguments);}else{h1=arguments[0];}return e1(h1);},parts:i.parts};if(g1()){e.icon={formatter:f1,parts:i.parts};}}else{if(d1){e.state=e1(d1.getCriticality());}if(g1()){e.icon=f1();}}};c1.prototype._createEdmString=function(){var e={};if(this._oSelector.checkCheckBox()){return this._createCheckBox();}var i=this._oSelector.checkSelection();if(i.selection){return this._createSelect({valueHelp:c1.getValueHelpDropdownSettings(i)});}i=this._oSelector.checkComboBox();if(i.combobox){return this._createComboBox({valueHelp:c1.getValueHelpDropdownSettings(i),edit:true});}var n={width:true,textAlign:true,placeholder:true,tooltip:true,name:true,valueState:true,valueStateText:true};var d1=this.getEdmProperty();if(this._oHelper.oAnnotation.isMultiLineText(d1)){delete n["width"];return this._createMultiLineText({attributesNamesMap:n});}var e1=this._oParent.isTextInEditModeSourceNotNone(),f1=/Edm.String|Edm.Guid/.test(d1.type);if(e1||this._bTextInDisplayModeValueList){A(f1,"The ValueList and NavigationProperty"+"members of the sap.ui.comp.smartfield.TextInEditModeSource enumeration are only supported for OData "+"EDM Properties typed as Edm.String or Edm.Guid. - "+this.getMetadata().getName());}var g1=c1.getBoundPropertiesMapInfoForControl(I.getMetadata().getName(),{propertyName:"value"})[0];var h1=this._oParent._getComputedTextInEditModeSource(),i1,j1;if(this._oParent.data("defaultTextInEditModeSource")&&this._oParent.isPropertyInitial("textInEditModeSource")&&this._oParent.getMode()==="edit"){i1=true;}this.oTextArrangementDelegate.bValidMetadata=f1&&this.oTextArrangementDelegate.checkRequiredMetadata(h1,i1);if(this.oTextArrangementDelegate.bValidMetadata){j1=this.createAttributes("",this._oMetaData.property,n);e.valueListNoValidation=this._oParent._getComputedTextInEditModeSource()==="ValueListNoValidation";j1[g1]=this.oTextArrangementDelegate.getBindingInfo(e);}else{j1=this.createAttributes(g1,this._oMetaData.property,n);}if(x.isFiscalValue(d1)){j1.placeholder=j1.value.type.formatter.getPattern();return{control:new I(this._oParent.getId()+"-input",j1),onCreate:"_onCreate",params:{getValue:"getValue",type:{type:j1.value.type,property:this._oMetaData.property}}};}var k1=new I(this._oParent.getId()+"-input",j1);if(this._oHelper.oAnnotation.isMasked(d1)){k1.setType(W.Password);}var l1=this.getCustomDataConfiguration();if(this.oTextArrangementDelegate.bValidMetadata){this._handleEventingForTextArrangement({control:k1});}else{this._handleEventingForEdmString({control:k1,edmProperty:this._oMetaData.property.property,currency:l1&&l1.currency});}return{control:k1,onCreate:"_onCreate",params:{valuehelp:{annotation:i.annotation,noDialog:!this._oParent.getShowValueHelp(),noTypeAhead:!this._oParent.getShowSuggestion(),aggregation:"suggestionRows"},getValue:"getValue",type:{type:j1.value.type,property:this._oMetaData.property}}};};c1.getValueHelpDropdownSettings=function(e){return{annotation:e.annotation,noDialog:true,noTypeAhead:true};};c1.prototype._getMaxLength=function(){return this._oTypes.getMaxLength(this._oMetaData.property,this._oParent.getBindingInfo("value"));};c1.prototype._addAriaLabelledBy=function(e){var i,n,d1,e1=this._oParent.getControlContext();if((e1===Z.None)||(e1===Z.Form)||(e1===Z.SmartFormGrid)){h.prototype._addAriaLabelledBy.apply(this,arguments);d1=this._oParent.data("configdata");if(d1&&d1.configdata.isInnerControl&&d1.configdata.isUOM){if(e){n=e.control;if(n instanceof H){if(n.getItems().length>0){n=n.getItems()[0];}}}if(n&&n.getAriaLabelledBy&&n.getAriaLabelledBy().length===0){var f1=this.getEdmProperty();if(this._oHelper.oAnnotation.getLabel(f1)){i=new y({text:this._oHelper.oAnnotation.getLabel(f1)});n.addAriaLabelledBy(i);this._oParent.addAggregation("_ariaLabelInvisibleText",i);}}}}};c1.prototype._addAriaDescribedBy=function(){var e=this._oParent.getControlContext();if((e===Z.None)||(e===Z.Form)||(e===Z.SmartFormGrid)){h.prototype._addAriaDescribedBy.apply(this,arguments);}};c1.prototype._handleEventingForEdmString=function(e){var i=e.control;if(!i){return;}i.attachChange(function j1(n){var d1=this._getChangeEventParams(n),e1=n&&n.getParameters(),f1=n&&n.getSource();if(e1){var g1=e1.value;d1.value=g1;d1.newValue=g1;if(i._oSuggestionPopup&&i._oSuggestionPopup.isOpen()){if(!e1.validated){if(i._iPopupListSelectedIndex>=0){return;}}}if(e.currency){var h1=this.getCurrencyValidationSettings();h1.oSource=f1;if(this._oHelper.oAnnotation.isUpperCase(e.edmProperty)&&g1){g1=g1.toUpperCase();i.setValue(g1);}this.updateModelPropertiesForCurrency("value",h1);}try{this._oParent.fireChange(d1);}catch(i1){z.error(i1);}}}.bind(this));};c1.prototype._handleEventingForTextArrangement=function(e){var i=e.control;if(!i){return;}i.attachChange(function(n){var d1=this._getChangeEventParams(n);try{this._oParent.fireChange(d1);}catch(e1){z.error(e1);}}.bind(this));};c1.prototype.getUOMChangeHandler=function(e){return function(i){try{var n=e.smartFieldRootControl,d1=i.getParameters(),e1=d1.value,f1=i.getSource(),g1=e.currency,h1=g1?this.getCurrencyValidationSettings(e):this.getUnitValidationSettings(e);h1.oSource=f1;g1?this.updateModelPropertiesForCurrency("value",h1):this.updateModelPropertiesForUnit("value",h1);n.fireChange({value:e1,newValue:e1,unitChanged:!!e.unit,validated:!!d1.validated});}catch(i1){if(i1.validationUnitError){n.fireChange({value:e1,newValue:e1,unitChanged:!!e.unit,validated:!!d1.validated});}z.error(i1);}}.bind(this);};c1.prototype.getCurrencyValidationSettings=function(e){var i;if(e){i=e.smartFieldRootControl;}else{var n=this.getCustomDataConfiguration();i=n&&n.smartFieldRootControl;}var d1=i.getInnerControls();return{amountField:d1[0],currencyField:d1[1],errorState:i._oError,checkValidity:i.checkValuesValidity.bind(i),rootControl:i};};c1.prototype.getUnitValidationSettings=function(e){var i;if(e){i=e.smartFieldRootControl;}else{var n=this.getCustomDataConfiguration();i=n&&n.smartFieldRootControl;}var d1=i.getInnerControls();return{measureField:d1[0],unitField:d1[1],errorState:i._oError,checkValidity:i.checkUnitValidity.bind(i),rootControl:i};};c1.prototype.updateModelPropertiesForCurrency=function(e,i){var n=i.amountField,d1=i.currencyField,e1=i.oSource,f1=n.getValue(),g1,h1="";if(d1){var i1=d1.getMetadata().getName();g1=c1.getBoundPropertiesMapInfoForControl(i1,{propertyName:e})[0];var j1="get"+J(g1);h1=d1[j1]();}var k1=[f1,h1];var l1={rawValues:k1,handleSuccess:false};var m1=i.checkValidity(l1);function n1(q1){var r1=n.getModel(),s1=n.getBinding(e),t1,u1;if(d1){t1=d1.getBinding(g1);u1=t1.getType();}var v1=s1.getType(),w1=s1.getExternalValue(),x1=t1&&t1.getExternalValue(),y1=v1.parseValue(f1,"string",k1),z1=y1[1],A1=v1.formatValue(y1,"string"),B1=u1&&u1.formatValue(z1,"string");if(r1.getDefaultBindingMode()===B.TwoWay){if(!q1){s1.setValue(y1);}}if(!q1){n.setValue(A1);}var C1=false,D1=true;if(s1.hasValidation()&&!q1){var E1={element:n,property:e,type:v1,newValue:A1,oldValue:w1,mParameters:{originSource:e1}};n.fireValidationSuccess(E1,C1,D1);}if(t1&&t1.hasValidation()){var F1={element:d1,property:g1,type:u1,newValue:B1,oldValue:x1,mParameters:{originSource:e1}};d1.fireValidationSuccess(F1,C1,D1);}}function o1(q1){}function p1(){var q1=i.errorState;if(q1.bComplex&&q1.bFirst&&q1.bSecond){var r1=n.getBinding(e).getExternalValue();k1=[r1,h1];var l1={rawValues:k1,innerControls:[d1],handleSuccess:false};var m1=i.checkValidity(l1);m1.then(function(){return n1.call(this,true);}.bind(this)).catch(o1);}}m1.then(function(){return n1();}).catch(o1).finally(p1);};c1.prototype.updateModelPropertiesForUnit=function(e,i){var n=i.measureField,d1=i.unitField,e1=n.getValue(),f1,g1="";if(d1){var h1=d1.getMetadata().getName();f1=c1.getBoundPropertiesMapInfoForControl(h1,{propertyName:e})[0];var i1="get"+J(f1),j1=d1.getParent();if(d1.isA("sap.m.ComboBox")){g1=d1.getSelectedKey();}else if(this._getDisplayBehaviourConfiguration()&&j1&&(!j1.getEditable()||j1._oFactory._getTextArrangementType())){g1=j1.getBinding("value").getValue();}else{g1=d1[i1]();}}else if(this._checkSuppressUnit()){var k1=this.getMetaData().annotations.uom.path,l1=n.getBindingContext();g1=this._oModel.getData(k1,l1);}var m1=[e1,g1];var n1={rawValues:m1,handleSuccess:false};var o1=i.checkValidity(n1);if(o1){var p1=n.getModel(),q1=n.getBinding(e),r1,s1;if(d1){r1=d1.getBinding(f1);s1=r1.getType();}var t1=q1.getType(),u1=t1.parseValue(e1,"string",m1),v1=u1[1],w1,x1;if(v1===undefined&&d1&&!d1.getEditable){w1=t1.formatValue([u1[0],null],"string");x1=v1;}else{w1=t1.formatValue(u1,"string");if(!q1.isA("sap.ui.comp.smartfield.type.Unit")){v1=g1;}x1=s1&&s1.formatValue(v1,"string");}if(p1.getDefaultBindingMode()===B.TwoWay){q1.setValue(u1);}n.setValue(w1);if(d1&&d1.getEditable&&d1.getEditable()&&d1.getParent().getVisible()&&!d1.isA("sap.m.ComboBox")){d1.setValue(x1);}}};c1.prototype._createComboBox=function(e){var i=null,n=(this._oSelector&&this._oSelector._oParent&&this._oSelector._oParent.oParent&&this._oSelector._oParent.oParent.isA("sap.ui.comp.smartmultiedit.Field")||(this._oParent&&this._oParent.getFixedValueListValidationEnabled&&this._oParent.getFixedValueListValidationEnabled())),d1={width:true,textAlign:true,placeholder:true,tooltip:true,name:true,valueState:true},e1,f1;if(n){e1=c1.getBoundPropertiesMapInfoForControl(a.getMetadata().getName(),{propertyName:"value"})[0];f1={change:function(g1){if(g1.getParameter("itemPressed")){return;}var h1=g1.getSource().getSelectedKey();this._oParent.fireChange({value:h1,newValue:h1});}.bind(this)};}else{e1=c1.getBoundPropertiesMapInfoForControl(b.getMetadata().getName(),{propertyName:"value"})[0];f1={change:function(g1){if(this._oParent.getFirstInnerControl().setEnteredValue){this._oParent.getFirstInnerControl().setEnteredValue();}var h1=g1.getSource().getSelectedKey();if(!h1){h1=g1.getSource().getValue();}this._oParent.fireChange({value:h1,newValue:h1});}.bind(this)};}f1["selectionChange"]=this._oHelper.getSelectionChangeHandler(this._oParent);f1=Object.assign(f1,this.createAttributes(e1,this._oMetaData.property,d1));if(f1.width===""){f1.width="100%";}if(e.edit){if(n){i=new a(this._oParent.getId()+"-comboBoxEdit",f1);}else{i=new b(this._oParent.getId()+"-comboBoxEdit",f1);}}else{i=this._createDisplayedComboBox(f1);}return{control:i,onCreate:"_onCreate",params:{valuehelp:{annotation:e.valueHelp.annotation,aggregation:"items",noDialog:e.valueHelp.noDialog,noTypeAhead:e.valueHelp.noTypeAhead},getValue:"get"+e1[0].toUpperCase()+e1.slice(1),type:{type:f1[e1].type,property:this._oMetaData.property}}};};c1.prototype._createDisplayedComboBox=function(e){var i=a.extend("sap.ui.comp.smartfield.DisplayComboBox",{metadata:{library:"sap.ui.comp",properties:{wrapping:{type:"boolean",group:"Appearance",defaultValue:true}}},renderer:function(n,d1){var e1=d1.getWidth(),f1=d1.getValue(),g1=d1.getTextDirection(),h1=d1.getTextAlign(),i1=d1.getTooltip_AsString(),j1=d1.getWrapping();n.write("<span");n.writeControlData(d1);n.addClass("sapMText");n.addClass("sapUiSelectable");if(j1){if(f1&&(f1.length>0)&&!/\s/.test(f1)){n.addClass("sapMTextBreakWord");}}else{n.addClass("sapMTextNoWrap");}if(e1&&(f1!=="")){n.addStyle("width",e1);}else{n.addClass("sapMTextMaxWidth");}if(g1!==$.Inherit){n.writeAttribute("dir",g1.toLowerCase());}if(i1){n.writeAttributeEscaped("title",i1);}if(h1){h1=R.getTextAlign(h1,g1);if(h1){n.addStyle("text-align",h1);}}var k1=j1?"sapMTextRenderWhitespaceWrap":"sapMTextRenderWhitespace";n.addClass(k1);n.writeClasses();n.writeStyles();n.write(">");f1.replace(/\r\n|\n\r|\r/g,"\n");n.writeEscaped(f1);n.write("</span>");},updateDomValue:function(n){if(!this.isActive()){return this;}n=this._getInputValue(n);if(this.$().text()!==n){this.$().text(n);this._bCheckDomValue=true;}return this;},getValue:function(){return this.getProperty("value");},getFocusDomRef:function(){return this.getDomRef();},getEditable:function(){return false;}});return new i(this._oParent.getId()+"-comboBoxDisp",e);};c1.prototype._createSelect=function(e){var n={width:true,name:true,valueState:true};var i=c1.getBoundPropertiesMapInfoForControl(S.getMetadata().getName(),{propertyName:"value"})[0];var d1={change:this._oHelper.getSelectionChangeHandler(this._oParent),forceSelection:false};d1=Object.assign(d1,this.createAttributes(i,this._oMetaData.property,n));if(d1.width===""){d1.width="100%";}return{control:new S(this._oParent.getId()+"-select",d1),onCreate:"_onCreate",params:{valuehelp:{annotation:e.valueHelp.annotation,aggregation:"items",noDialog:e.valueHelp.noDialog,noTypeAhead:e.valueHelp.noTypeAhead},getValue:"getSelectedKey",type:{type:d1.selectedKey.type,property:this._oMetaData.property}}};};c1.prototype._createCheckBox=function(){var e=c1.getBoundPropertiesMapInfoForControl(C.getMetadata().getName(),{propertyName:"value"})[0];var i=this.createAttributes(e,null,{},{event:"select",parameter:"selected"});i.editable=(this._oParent.getEditable()&&this._oParent.getEnabled()&&this._oParent.getContextEditable());i.selected.type=this._oTypes.getAbapBoolean();return{control:new C(this._oParent.getId()+"-cBox",i),onCreate:"_onCreate",params:{getValue:"getSelected"}};};c1.prototype._createEdmDateTime=function(){var e=this.getFormatSettings("dateFormatSettings"),i;var n={width:true,textAlign:true,placeholder:true,name:true,valueState:true};var d1=this.createAttributes(null,this._oMetaData.property,n,{event:"change",parameter:"value"});if(this._oSelector.checkDatePicker()){i=c1.getBoundPropertiesMapInfoForControl(D.getMetadata().getName(),{propertyName:"value"})[0];d1[i]={path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property,e,{displayFormat:"Date"}),model:this._oMetaData.model,mode:this._oParent.getBindingMode("value")};if(e&&e.style){d1.displayFormat=e.style;}return{control:new D(this._oParent.getId()+"-datePicker",d1),onCreate:"_onCreate",params:{getValue:"getValue",type:{type:d1.value.type,property:this._oMetaData.property}}};}i=c1.getBoundPropertiesMapInfoForControl(d.getMetadata().getName(),{propertyName:"value"})[0];d1[i]={path:this._oMetaData.path,model:this._oMetaData.model,type:this._oTypes.getType(this._oMetaData.property,e),mode:this._oParent.getBindingMode("value")};return{control:new d(this._oParent.getId()+"-input",d1),onCreate:"_onCreate",params:{getValue:"getValue",type:{type:d1.value.type,property:this._oMetaData.property}}};};c1.prototype._createEdmDateTimeOffset=function(){var i=this.getFormatSettings("dateFormatSettings"),n;try{n=K(i);}catch(e){n=i;}if(n){n.UTC=false;}var d1=c1.getBoundPropertiesMapInfoForControl(d.getMetadata().getName(),{propertyName:"value"})[0];var e1={width:true,textAlign:true,placeholder:true,name:true,valueState:true};var f1=this.createAttributes(null,this._oMetaData.property,e1,{event:"change",parameter:"value"});f1[d1]={model:this._oMetaData.model,path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property,n),mode:this._oParent.getBindingMode("value")};return{control:new d(this._oParent.getId()+"-input",f1),onCreate:"_onCreate",params:{getValue:"getValue",type:{type:f1.value.type,property:this._oMetaData.property}}};};c1.prototype._createEdmNumeric=function(){var e=this._oSelector.checkComboBox();if(e.combobox){return this._createComboBox({valueHelp:{annotation:e.annotation,noDialog:true,noTypeAhead:true},edit:true});}var n={width:true,textAlign:true,placeholder:true,name:true,valueState:true};var i=c1.getBoundPropertiesMapInfoForControl(I.getMetadata().getName(),{propertyName:"value"})[0];var d1=this.createAttributes(i,this._oMetaData.property,n,{event:"change",parameter:"value"});if(this._oParent.isContextTable()&&sap.ui.getCore().getConfiguration().getRTL()){d1.textDirection="LTR";}return{control:new I(this._oParent.getId()+"-input",d1),onCreate:"_onCreate",params:{getValue:"getValue",type:{type:d1.value.type,property:this._oMetaData.property}}};};c1.prototype._createEdmUOM=function(){var e=this.getEdmProperty(),i=this._oMetaData.annotations.uom.property.property,n=this._oMetaData.annotations.uom&&this._oHelper.oAnnotation.isCurrency(e,i);var d1={currency:n,edmProperty:i};var e1=this._createEdmUOMAttributes(d1),f1=sap.ui.getCore().getConfiguration().getRTL(),g1=f1&&this._oParent.isContextTable(),h1=this._oParent.getId(),i1;if(g1){e1.textDirection="LTR";}var j1=new I(h1+"-input",e1);this.oMeasureField=j1;if(this._oParent.data("suppressUnit")==="true"){var k1={getValue:"getValue"};if(!n){k1.type={type:e1.value.type,property:this._oMetaData.property};}return{control:j1,onCreate:"_onCreate",params:k1};}if(!n){i1={type:e1.value.type,property:this._oMetaData.property};}var l1={change:this.getUOMChangeHandler({smartFieldRootControl:this._oParent,currency:n,unit:true}),textAlign:this._getEdmUOMTextAlignment()};var m1=c1.getBoundPropertiesMapInfoForControl(b1.getMetadata().getName(),{propertyName:"value"})[0];var n1=this._oHelper.getUOMPath(this._oMetaData);l1[m1]={model:this._oMetaData.model,path:n1};this.mapBindings(l1,c1._getEmbeddedSmartFieldMapSettings());if(this._oParent.getConfiguration()){l1.configuration=new w({preventInitialDataFetchInValueHelpDialog:this._getPreventInitialDataFetchInVHDialog()});}var o1=new b1(h1+"-sfEdit",l1),p1=this;o1.data("configdata",{"configdata":{currency:n,smartFieldRootControl:this._oParent,measureField:this.oMeasureField,isInnerControl:true,isUOM:!this._oParent.data("configdata"),model:this._oMetaData.model,navigationPath:this._oMetaData.annotations.uom.navigationPath||null,path:n1,entitySetObject:this._oMetaData.annotations.uom.entitySet,entityType:this._oMetaData.annotations.uom.entityType,property:this._oMetaData.annotations.uom.property,annotations:{valuelist:this._oMetaData.annotations.valuelistuom,valuelistType:this._oMetaData.annotations.uom.annotations.valuelistType,text:this._oMetaData.annotations.textuom},modelObject:this._oMetaData.modelObject||this._oModel,onText:function(r1){j1.setLayoutData(new F({growFactor:1}));o1.setLayoutData(p1._getStaticUOMTextFlexItemData({shrinkFactor:0,styleClass:"sapUiCompSmartFieldFlexItemUnitDisplay"}));o1.addStyleClass("sapUiCompSmartFieldUOMDisplayText");if(r1){if(g1&&(typeof r1.setTextDirection==="function")){r1.setTextDirection("LTR");}r1.addStyleClass("sapUiCompSmartFieldUnit");}},onInput:function(r1){j1.setLayoutData(p1._getDynamicAmountInputFlexItemData({control:o1}));o1.setLayoutData(p1._getStaticUOMInputFlexItemData({growFactor:0,styleClass:"sapUiCompSmartFieldFlexItemUnitEdit",minWidth:""}));if(r1){if(g1&&(typeof r1.setTextDirection==="function")){r1.setTextDirection("LTR");}r1.addStyleClass("sapUiCompSmartFieldUnit");}}}});o1.data("errorCheck","setComplexClientErrorSecondOperandNested");if(o1.getVisible()){j1.addStyleClass("smartFieldPaddingRight");}j1.addStyleClass("sapUiCompSmartFieldValue");var q1=new H({justifyContent:X.End,items:[j1,o1],fitContainer:true,width:this._oParent.getWidth()});q1.addStyleClass("sapUiCompUOM");q1.enhanceAccessibilityState=function(r1,s1){this._oParent.enhanceAccessibilityState(r1,s1);}.bind(this);if(this._oParent.isContextTable()){if(g1){q1.addStyleClass("sapUiCompDirectionLTR");}q1.addStyleClass("sapUiCompUOMInTable");if(this._oParent.getMode()!=="edit"){q1.addStyleClass("sapUiCompUOMInTableDisplay");}}return{control:q1,onCreate:"_onCreateUOM",params:{getValue:true,valuehelp:true,type:i1}};};c1.prototype._createEdmUOMAttributes=function(e){e=e||{};var i=this.createUOMDefaultAttributes(e);var n=c1.getBoundPropertiesMapInfoForControl(I.getMetadata().getName(),{propertyName:"value"})[0];var d1=e.currency||(this._oMetaData.annotations.uom&&this._oHelper.oAnnotation.isCurrency(this.getEdmProperty(),this._oMetaData.annotations.uom.property.property));i[n]={mode:B.OneWay,model:this._oMetaData.model,parts:[{path:this._oMetaData.path},{path:this._oHelper.getUOMPath(this._oMetaData)},{mode:'OneTime',path:d1?'/##@@requestCurrencyCodes':'/##@@requestUnitsOfMeasure',targetType:'any'}],type:d1?this._oTypes.getCurrencyType(this._oMetaData.property):this._oTypes.getUoMType(this._oMetaData.property)};return i;};c1.prototype.createUOMDefaultAttributes=function(e){return{textAlign:this._getEdmUOMTextAlignment(),placeholder:this.getAttribute("placeholder"),name:this.getAttribute("name"),change:this.getUOMChangeHandler({smartFieldRootControl:this._oParent,currency:e.currency}),valueState:this.getValueStateBindingInfoForRecommendationStateAnnotation()};};c1.prototype._getEdmUOMTextAlignment=function(){var e=this.getAttribute("textAlign");if(!e){e=Q.Initial;}if(e===Q.Initial){if(this._oParent.isContextTable()){return Q.End;}return Q.Begin;}return e;};c1.prototype._createEdmUOMDisplay=function(){var e=this,i=this._oHelper.getUOMPath(this._oMetaData),n=this._getEdmUOMTextAlignment(),d1=null,e1=this.getEdmProperty(),f1=sap.ui.getCore().getConfiguration().getRTL(),g1=f1&&this._oParent.isContextTable(),h1=this._oHelper.oAnnotation.isCurrency(e1);var i1=c1.getBoundPropertiesMapInfoForControl(f.getMetadata().getName(),{propertyName:"value"})[0];var j1={textAlign:n};j1[i1]={parts:[{path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property)},{path:i},{mode:'OneTime',path:h1?'/##@@requestCurrencyCodes':'/##@@requestUnitsOfMeasure',targetType:'any'}],model:this._oMetaData.model,formatter:this._oTypes.getDisplayFormatter(e1,{currency:h1,mask:this._oHelper.oAnnotation.isMasked(e1),type:this._oTypes.getType(this._oMetaData.property)}),useRawValues:true};if(g1){j1.textDirection="LTR";}j1.emptyIndicatorMode=a1.On;var k1=new f(this._oParent.getId()+"-text",j1);i=this._oHelper.getUOMPath(this._oMetaData);j1={change:this.getUOMChangeHandler({smartFieldRootControl:this._oParent,currency:h1,unit:true}),textAlign:this._getEdmUOMTextAlignment()};i1=c1.getBoundPropertiesMapInfoForControl(b1.getMetadata().getName(),{propertyName:"value"})[0];j1[i1]={model:this._oMetaData.model,path:i};this.mapBindings(j1,c1._getEmbeddedSmartFieldMapSettings());k1.addStyleClass("smartFieldPaddingRight");k1.addStyleClass("sapUiCompSmartFieldValue");if(this._checkSuppressUnit()){return{control:k1};}d1=new b1(this._oParent.getId()+"-sfDisp",j1);d1.data("configdata",{"configdata":{isInnerControl:true,isUOM:!this._oParent.data("configdata"),model:this._oMetaData.model,navigationPath:this._oMetaData.annotations.uom.navigationPath||null,path:i,entitySetObject:this._oMetaData.annotations.uom.entitySet,entityType:this._oMetaData.annotations.uom.entityType,property:this._oMetaData.annotations.uom.property,annotations:{valuelist:this._oMetaData.annotations.valuelistuom,text:this._oMetaData.annotations.textuom},modelObject:this._oMetaData.modelObject||this._oModel,onText:function(m1){if(m1){if(m1.setWrapping){m1.setWrapping(false);}if(g1&&(typeof m1.setTextDirection==="function")){m1.setTextDirection("LTR");}if(typeof m1.setEmptyIndicatorMode==="function"){m1.setEmptyIndicatorMode(a1.Off);}m1.addStyleClass("sapUiCompSmartFieldUnit");}},onInput:function(m1){k1.setLayoutData(new F({growFactor:0}));d1.setLayoutData(new F({growFactor:0}));if(m1){if(g1&&(typeof m1.setTextDirection==="function")){m1.setTextDirection("LTR");}m1.addStyleClass("sapUiCompSmartFieldUnit");}},getContextEditable:function(){return e._oParent.getContextEditable();}}});d1.data("errorCheck","setComplexClientErrorSecondOperandNested");var l1=new H({alignItems:_.Center,items:[k1,d1],fitContainer:true,width:this._oParent.getWidth()});l1.enhanceAccessibilityState=function(m1,n1){this._oParent.enhanceAccessibilityState(m1,n1);}.bind(this);if(this._oParent.isContextTable()){l1.setJustifyContent("End");this._oParent.addStyleClass("sapUiCompUOMInTable");if(g1){l1.addStyleClass("sapUiCompDirectionLTR");}l1.addStyleClass("sapUiCompUOMInTable");}return{control:l1};};c1.prototype._createEdmUOMObjectStatus=function(){var e,i=this.getEdmProperty(),n=this._oMetaData.annotations.uom&&this._oHelper.oAnnotation.isCurrency(i),d1=this._oTypes.getDisplayFormatter(i,{currency:n}),e1=this._oHelper.getUOMPath(this._oMetaData),f1={};var g1=c1.getBoundPropertiesMapInfoForControl(s.getMetadata().getName(),{propertyName:"value"})[0];f1[g1]={parts:[{path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property)},{path:e1},{mode:'OneTime',path:n?'/##@@requestCurrencyCodes':'/##@@requestUnitsOfMeasure',targetType:'any'}],formatter:function(){var h1=d1.apply(this,arguments);return h1+arguments[1];},useRawValues:true};this._addObjectStatusAttributes(f1);e=new s(this._oParent.getId()+"-objStatus",f1);e.addStyleClass("sapUiCompUOM");return{control:e};};c1.prototype._createEdmUOMObjectNumber=function(){var e,i,n=this._getEdmUOMTextAlignment();var d1=c1.getBoundPropertiesMapInfoForControl(q.getMetadata().getName(),{propertyName:"value"});if(this._oMetaData.annotations.uom&&this._oHelper.oAnnotation.isCurrency(this.getEdmProperty(),this._oMetaData.annotations.uom.property.property)){e={model:this._oMetaData.model,textAlign:n};e[d1[0]]={parts:[{path:this._oMetaData.path},{path:this._oHelper.getUOMPath(this._oMetaData)},{mode:'OneTime',path:'/##@@requestCurrencyCodes',targetType:'any'}],type:this._oTypes.getCurrencyType(this._oMetaData.property)};e[d1[1]]={path:this._oHelper.getUOMPath(this._oMetaData)};}else{e={model:this._oMetaData.model,textAlign:n};e[d1[0]]={path:this._oMetaData.path,type:this._oTypes.getType(this._oMetaData.property)};e[d1[1]]={path:this._oHelper.getUOMPath(this._oMetaData)};}i=new q(this._oParent.getId()+"-objNumber",e);i.addStyleClass("sapUiCompUOM");return{control:i};};c1.prototype._createEdmSemantic=function(){var e=this,i=this._oParent.getBindingPath("value"),n=this.getEdmProperty(),d1=this._oHelper.oAnnotation.getLabel(n);if(this._oMetaData.annotations.lineitem&&this._oMetaData.annotations.lineitem.labels&&this._oMetaData.annotations.lineitem.labels[i]){d1=this._oMetaData.annotations.lineitem.labels[i];}var e1={semanticObject:this._oMetaData.annotations.semantic.defaultSemanticObject,additionalSemanticObjects:this._oMetaData.annotations.semantic.additionalSemanticObjects,semanticObjectLabel:d1,fieldName:i,width:this.getAttribute("width"),createControlCallback:function(){var h1=this.createControl(true);if(h1){return h1.control;}return null;}.bind(this)};var f1=this._oHelper.oAnnotation.getText(n);this.oType=this._oTypes.getType(this._oMetaData.property);if(f1){e1.text={parts:[this._oMetaData.path,this._oHelper.getEdmDisplayPath(this._oMetaData)],model:this._oMetaData.model,formatter:function(h1,i1){if(e.oType){h1=e.oType.formatValue(h1,"string");}if(e.oType&&e.oType.isA("sap.ui.comp.odata.type.NumericText")&&h1===null&&i1){h1="";}if(h1&&i1){return e._formatDisplayBehaviour("defaultInputFieldDisplayBehaviour",h1,i1);}return h1?h1:"";}};e1.navigationTargetsObtained=function(h1){var i1=this.getBinding("text");if(!Array.isArray(i1.getValue())){h1.getParameters().show();return;}var j1=i1.getValue();var k1=e._getDisplayBehaviourConfiguration("defaultInputFieldDisplayBehaviour")||"idOnly";var l1=v.getTextsFromDisplayBehaviour(k1,j1[0],j1[1]);var m1=h1.getParameters().mainNavigation;if(m1){m1.setDescription(l1.secondText);}h1.getParameters().show(l1.firstText,m1,undefined,undefined);};}else{var g1=this._oHelper.getUOMPath(this._oMetaData);if(g1){e1.text={parts:[{path:i},{path:g1}],model:this._oMetaData.model,formatter:this._oHelper.oAnnotation.isCurrency(n,this._oMetaData.annotations.uom.property.property)?v.getAmountCurrencyFormatter():v.getMeasureUnitFormatter(),useRawValues:true};e1.uom={path:g1};}else{e1.text={path:i,model:this._oMetaData.model,type:this.oType};}}return{control:new g(this._oParent.getId()+"-sl",e1),onCreate:"_onCreate",params:{getValue:"getInnerControlValue"}};};c1.prototype._createMultiLineText=function(e){var i=c1.getBoundPropertiesMapInfoForControl(T.getMetadata().getName(),{propertyName:"value"})[0];var n=this.createAttributes(i,this._oMetaData.property,e.attributesNamesMap);var d1=this.getFormatSettings("multiLineSettings");n=G(n,d1);if(this._oParent.isContextTable()){n.width="100%";}var e1=new T(this._oParent.getId()+"-textArea",n);this._handleEventingForEdmString({control:e1,edmProperty:this._oMetaData.property.property});return{control:e1,onCreate:"_onCreate",params:{type:{type:n.value.type,property:this._oMetaData.property},getValue:"getValue"}};};c1.prototype._createLink=function(e){var i=this,n=this._oParent,d1=n.getBindingInfo("url");var e1={text:"",href:""};var f1=c1.getBoundPropertiesMapInfoForControl(L.getMetadata().getName(),{propertyName:"url"})[0];if(d1){e1[f1]=this._oBinding.toBinding(d1);}else{e1[f1]=n.getUrl();}if(n.hasListeners("press")){e1.press=function(m1){m1.preventDefault();n.firePress(m1);};}var g1=n.getBindingInfo("value");var h1=c1.getBoundPropertiesMapInfoForControl(L.getMetadata().getName(),{propertyName:"value"});if(g1){var i1=this._oMetaData,j1=i1.path,k1=i1.property.property;if(i1.annotations.text&&(k1.type==="Edm.String")){e1[h1[0]]={parts:[i1.path,this._oHelper.getEdmDisplayPath(i1)],formatter:this._formatText.bind(i)};}else if(c1.isSpecialLink(k1)){var l1=c1[c1._getLinkFormatterFunctionName(k1)];e1[h1[0]]={path:j1};e1[h1[1]]={path:j1,formatter:null};if(typeof l1==="function"){e1[h1[1]].formatter=l1;}}else if(e){e1[h1[0]]={path:j1,type:this._getDateFormatType()};}else{e1[h1[0]]=this._oBinding.toBinding(g1);}}else{e1[h1[0]]=n.getValue();}return{control:new L(n.getId()+"-link",e1),onCreate:"_onCreate",params:{noValidation:true}};};c1.prototype._createEdmBoolean=function(){var e=this._oSelector.checkComboBox(),i=this._oParent.getEditable()&&this._oParent.getEnabled()&&this._oParent.getContextEditable(),n=this,d1=null,e1;if(e.combobox){if(i||this._oParent.getFetchValueListReadOnly()){return this._createComboBox({valueHelp:{annotation:e.annotation,noDialog:true,noTypeAhead:true},edit:i});}}var f1,g1;if(i){g1=c1.getBoundPropertiesMapInfoForControl(C.getMetadata().getName(),{propertyName:"value"})[0];f1=this.createAttributes(g1,this._oMetaData.property,{},{event:"select",parameter:"selected"});e1=new C(this._oParent.getId()+"-cBoxBool",f1);d1={getValue:"getSelected"};}else{g1=c1.getBoundPropertiesMapInfoForControl(f.getMetadata().getName(),{propertyName:"value"})[0];f1=this.createAttributes(g1,this._oMetaData.property,{width:true,textAlign:true});f1.emptyIndicatorMode=a1.On;f1[g1]={model:this._oMetaData.model,path:this._oMetaData.path,formatter:function(h1){return n._formatDisplayBehaviour("defaultCheckBoxDisplayBehaviour",h1);}};e1=new f(this._oParent.getId()+"-text",f1);}return{control:e1,onCreate:"_onCreate",params:d1};};c1.prototype._createValueHelp=function(){var e=this._oParent.getContent();if(!e){return;}var i={annotation:this._oMetaData.annotations.valuelist,noDialog:!this._oParent.getShowValueHelp(),noTypeAhead:!this._oParent.getShowSuggestion(),aggregation:"suggestionRows"};this._getValueHelpDialogTitle(i);i.analyser=this._oHelper.getAnalyzer(this._oModel||this._oMetaData.modelObject);this.createValueHelp({control:e,edmProperty:this.getEdmProperty(),valueHelp:i,model:this._oModel||this._oMetaData.modelObject,onValueListChange:function(n){this._oParent.fireValueListChanged({changes:n.mParameters.changes});}.bind(this)});};c1.prototype.getValueListProviderConfiguration=function(e){var i=h.prototype.getValueListProviderConfiguration.apply(this,arguments);if(this._oHelper.oAnnotation.isUpperCase(this._oMetaData.property.property)){i.displayFormat="UpperCase";}return i;};c1.prototype._checkSuppressUnit=function(){if(this._oParent.data("suppressUnit")==="true"){return true;}var i=this._oParent.getBindingInfo("uomVisible");return(!i&&!this._oParent.getUomVisible());};c1.prototype.getEdmProperty=function(){var e=this._oHelper;if(e){return e.getEdmProperty(this._oMetaData);}return null;};c1.prototype.getEntityType=function(){if(this._oMetaData){return this._oMetaData.entityType;}return null;};c1.prototype._checkLink=function(){var i=this._oParent.getBindingInfo("url"),e=this.getEdmProperty();if(i||this._oParent.getUrl()||c1.isSpecialLink(e)){return true;}return this._oParent.hasListeners("press");};c1._getEmbeddedSmartFieldMapSettings=function(){return{"uomEditable":"editable","uomEnabled":"enabled","uomVisible":"visible","mandatory":"mandatory","contextEditable":"contextEditable"};};c1.getBoundPropertiesMapInfoForControl=function(e,i){i=i||{};var n=null;switch(e){case"sap.m.Input":case"sap.m.TimePicker":case"sap.m.DatePicker":case"sap.m.DateTimePicker":case"sap.m.TextArea":n={value:["value"]};break;case"sap.m.Text":case"sap.m.ObjectIdentifier":case"sap.ui.comp.navpopover.SmartLink":n={value:["text"]};break;case"sap.m.Link":n={url:["href"],value:["text","href"]};break;case"sap.m.ObjectStatus":n={value:["text","state","icon"]};break;case"sap.m.ObjectNumber":n={value:["number","unit"]};break;case"sap.m.Select":case"sap.m.ComboBox":case"sap.ui.comp.smartfield.DisplayComboBox":n={value:["selectedKey"]};break;case"sap.ui.comp.smartfield.ComboBox":n={value:["enteredValue"]};break;case"sap.m.CheckBox":n={value:["selected"]};break;case"sap.ui.comp.smartfield.SmartField":var d1=Object.keys(b1.getMetadata().getProperties());n={};d1.forEach(function(e1,f1,g1){n[e1]=[g1[f1]];});break;}if(n&&i.propertyName){return n[i.propertyName]||null;}return n;};c1.isSpecialLink=function(e){return M.isEmailAddress(e)||M.isPhoneNumber(e)||M.isURL(e);};c1._getLinkFormatterFunctionName=function(e){return"_format"+M.getLinkDisplayFormat(e);};c1._formatEmailAddress=function(e){return"mailto:"+e;};c1._formatPhoneNumber=function(e){return"tel:"+e;};c1._formatURL=function(e){return U.validate(e)?e:"";};c1.prototype._formatText=function(i,e){if(i&&e){return this._formatDisplayBehaviour("defaultInputFieldDisplayBehaviour",i,e);}return i||"";};c1.prototype._getCreator=function(e){return this._oSelector.getCreator(e);};c1.prototype._onCreate=function(e,i){var n,d1,e1=true,f1=this;if(i){if(i.noValidation){e1=false;}if(i.valuehelp&&this.shouldCreateValueHelpForControl(e)){this._getValueHelpDialogTitle(i.valuehelp);i.valuehelp.analyser=this._oHelper.getAnalyzer(this._oModel||this._oMetaData.modelObject);this.createValueHelp({control:e,edmProperty:this.getEdmProperty(),valueHelp:i.valuehelp,model:this._oModel||this._oMetaData.modelObject,onValueListChange:function(g1){f1._oParent.fireValueListChanged({changes:g1.mParameters.changes});}});}if(i.getValue){n=i.getValue;i.getValue=function(){return e[n]();};}if(i.type){d1=this._oFieldControl.getMandatoryCheck(i.type.property);if(d1){i.type.type.oFieldControl=d1;}}}if(e1){this.addValidations(e,this._oParent.data("errorCheck")||"setSimpleClientError");}if(!this._checkUOM()){e.addStyleClass("sapUiCompSmartFieldValue");}};c1.prototype._checkUOM=function(){var e=this._oParent.data("configdata");if(e&&e.configdata){if(e.configdata.onInput||e.configdata.onText){return true;}}return false;};c1.prototype.getValueStateBindingInfoForRecommendationStateAnnotation=function(e,i,n){e=e||this.getEdmProperty();var d1=e&&e["com.sap.vocabularies.UI.v1.RecommendationState"];if(!d1){return null;}A(!(d1.Path===undefined),'Missing "Path" attribute of the "com.sap.vocabularies.UI.v1.RecommendationState" annotation for "'+e.name+'" EDM property of "'+this._oMetaData.entityType.name+'" entity type. - '+this.getMetadata().getName());A(!(d1.Path===""),'Missing path name of "com.sap.vocabularies.UI.v1.RecommendationState" annotation for "'+e.name+'" EDM property of "'+this._oMetaData.entityType.name+'" entity type. - '+this.getMetadata().getName());i=i||this._oHelper.findProperty(this._oMetaData.entityType.property,d1.Path);A(!!i,'The EDM property was not found in the "'+this._oMetaData.entityType.name+'" entity type. - '+this.getMetadata().getName());if(i&&(i.type==="Edm.Byte")){return{model:n||this._oMetaData.model,path:d1.Path,formatter:c1.formatRecommendationState};}A(i&&(i.type==="Edm.Byte"),'The EDM property "'+i.name+'" of "'+this._oMetaData.entityType.name+'" entity type must be typed as Edm.Byte. - '+this.getMetadata().getName());return null;};c1.formatRecommendationState=function(e){e=String(e);switch(e){case"0":return V.None;case"1":return V.Information;case"2":return V.Warning;default:return V.None;}};c1.prototype._getDynamicAmountInputFlexItemData=function(e){var i="sapUiCompSmartFieldFlexItemAmountEdit",n="",d1=e.control;if(d1&&!d1.getVisible()){i="sapUiCompSmartFieldFlexItemAmountNoUnitEdit";n="100%";}var e1=this._oAmountInputFlexItemData;if(e1&&!e1.bIsDestroyed){e1.setMaxWidth(n);e1.setStyleClass(i);return e1;}this._oAmountInputFlexItemData=new F({growFactor:1,maxWidth:n,styleClass:i});return this._oAmountInputFlexItemData;};c1.prototype._getStaticUOMInputFlexItemData=function(e){var i=this._oUOMInputFlexItemData;if(i&&!i.bIsDestroyed){return i;}this._oUOMInputFlexItemData=new F(e);return this._oUOMInputFlexItemData;};c1.prototype._getStaticUOMTextFlexItemData=function(e){var i=this._oUOMTextFlexItemData;if(i&&!i.bIsDestroyed){return i;}this._oUOMTextFlexItemData=new F(e);return this._oUOMTextFlexItemData;};c1.prototype._getValueHelpDialogTitle=function(e){e.dialogtitle=this._oParent.getComputedTextLabel();if(!e.dialogtitle){var i=this.getEdmProperty();e.dialogtitle=this._oHelper.oAnnotation.getLabel(i)||i.name;}};c1.prototype._onCreateUOM=function(e,i){var n=e.getItems(),d1;this.addValidations(n[0],"setComplexClientErrorFirstOperand");if(i&&i.getValue){i.getValue=function(){return n[0].getValue();};}i.uom=function(){return n[1].getValue();};i.uomset=function(e1){n[1].setValue(e1);};if(i.type){d1=this._oFieldControl.getMandatoryCheck(i.type.property);if(d1){i.type.type.oFieldControl=d1;}}};c1.prototype.triggerCreationOfControls=function(e){try{if(e){this._init(e);}this._setUOMEditState();var i=this._hasBoundFieldControl();var n=this._bReBindOnVL&&i;if(!n){this._oFieldControl.bindProperties({metadata:this._oMetaData});}this._oParent._toggleInnerControlIfRequired();this._addLabelAndQuickInfo();if(!n){this._oParent.fireInitialise();}}catch(d1){z.error(d1,null,this.getMetadata().getName());}};c1.prototype._checkTextInDisplayModeValueList=function(){var e=this._oHelper.getValueListAnnotationPath(this._oMetaData),i=this.getEdmProperty();return!!(this._oMetaData.annotations&&this._oMetaData.annotations.valuelist!==undefined&&(i.type==="Edm.String"||i.type==="Edm.Guid")&&this._getDisplayBehaviourConfiguration("defaultInputFieldDisplayBehaviour")&&this._oParent.getMode()==="display"&&this._oParent.getFetchValueListReadOnly()&&e&&!this._oParent.getExpandNavigationProperties()&&!this._oHelper.startWithNavigationProperty(e,this._oMetaData)&&!this.isValueInitialWithTextArrangement(i));};c1.prototype.isValueInitialWithTextArrangement=function(e){return this._oParent._isValueInitial()&&this._oHelper.oAnnotation.getText(e);};c1.prototype.reBindIfNecessary=function(){if(this._bInitialized&&this.bPending===false&&this._checkTextInDisplayModeValueList()){if(!this._oModel){return;}this._oModel.getMetaModel().loaded().then(function(){var e;if(!this._oParent){return false;}this._init(this._oMeta);e=this._oMetaData.annotations.valuelist;if(typeof e==="string"){return this._oHelper.loadValueListAnnotation(e);}return false;}.bind(this)).then(function(e){if(e&&this._oParent&&this._oParent.getMode()==="display"){this.reBind();}}.bind(this)).catch(function(){});}};c1.prototype.reBind=function(){this._bReBindOnVL=true;this.bind().finally(function(){this._bReBindOnVL=false;}.bind(this));};c1.prototype._hasBoundFieldControl=function(){var e=this._oFieldControl.getPropertyNames();for(var i=0;i<e.length;i++){if(this._oParent.getBinding(e[i])){return true;}}return false;};c1.prototype.bind=function(){if(!(!this._bInitialized&&!this.bPending)&&!this._bReBindOnVL){return Promise.resolve();}this._bInitialized=true;var e=this._oParent.data("configdata");if(e&&e.configdata){this.triggerCreationOfControls(this._oMeta);return Promise.resolve();}if(!this._oModel){return Promise.resolve();}var i=!!(this._oParent&&this._oParent.isTextInEditModeSourceNotNone());if(!i&&this._oModel.bMetaModelLoaded&&(this._oParent.getMode()!=="display"||!this._oParent.getFetchValueListReadOnly())){this.triggerCreationOfControls(this._oMeta);return Promise.resolve();}this.bPending=true;var n=this._oModel.getMetaModel().loaded().catch(function(e1){z.error("The meta model could not be loaded.",e1,this.getMetadata().getName());}.bind(this));var d1=n.then(function f1(){if(!this._oParent){this.bPending=false;return Promise.reject();}this._init(this._oMeta);this._bTextInDisplayModeValueList=this._checkTextInDisplayModeValueList();if((this._oParent.getMode()!=="display"&&i)||this._bTextInDisplayModeValueList){var e1=this._oMetaData.annotations.valuelist;if(typeof e1==="string"){return this._oHelper.loadValueListAnnotation(e1);}else{this.bPending=false;this.triggerCreationOfControls();return Promise.reject();}}this.bPending=false;this.triggerCreationOfControls();}.bind(this)).then(function f1(e1){if(!i&&!this._bTextInDisplayModeValueList){return;}if(!this._oParent){return;}this.bPending=false;if(e1){this._initValueList(e1);}this.triggerCreationOfControls();if(e1&&this.oTextArrangementDelegate){this.oTextArrangementDelegate.fetchIDAndDescriptionCollectionIfRequired();if(!this.bHasListenerModelContextChange){this.bHasListenerModelContextChange=true;this._oParent.attachModelContextChange(this._handleModelContextChangeEvent.bind(this));}}}.bind(this)).catch(function(e1){if(e1){z.error(e1,null,this.getMetadata().getName()+".onMetaModelLoaded");}}.bind(this));return d1;};c1.prototype._handleModelContextChangeEvent=function(){if(this._oParent&&this._oParent.getModel()&&this._oParent.getBindingContext()){this.oTextArrangementDelegate.fetchIDAndDescriptionCollectionIfRequired();}};c1.prototype._addLabelAndQuickInfo=function(){var e=this.getDataProperty();e=e.property;var i=this._oHelper.oAnnotation.getLabel(e);var n=this._oHelper.oAnnotation.getQuickInfo(e);if(i){this._oParent._sAnnotationLabel=i;}if(n&&this._oParent.isPropertyInitial("tooltipLabel")){this._oParent.setTooltipLabel(n);}};c1.prototype.rebindOnCreated=function(){var e,i=this._oFieldControl.getControlFormatters(this._oMetaData,["editable"]);for(var n in i){e=this._oBinding.fromFormatter(this._oMetaData.model,i[n]);this._oParent.bindProperty(n,e);}};c1.prototype._setUOMEditState=function(){if(this._oFieldControl.hasUomEditState(this._oMetaData)){var e=this._oFieldControl.getUOMEditState(this._oMetaData);if(e){var i=this._oBinding.fromFormatter(this._oMetaData.model,e);this._oParent.bindProperty("uomEditState",i);}}};c1.prototype.getDataProperty=function(){return this._oMetaData.property;};c1.prototype.getDropdownItemKeyType=function(e){var i=e.getMetadata().getName();if((i==="sap.ui.comp.smartfield.DisplayComboBox")||(i==="sap.m.ComboBox")||(i==="sap.ui.comp.smartfield.ComboBox")||(i==="sap.m.Select")){var n=c1.getBoundPropertiesMapInfoForControl(i,{propertyName:"value"})[0];var d1=e.getBindingInfo(n);return(d1&&d1.type)||null;}return null;};c1.prototype.getMetaData=function(){return this._oMetaData;};c1.prototype.getODataHelper=function(){return this._oHelper;};c1.prototype._getChangeEventParams=function(e){var i,n={},d1=e&&e.getParameters();if(d1){i=d1.value;n.value=i;n.newValue=i;if(d1.validated){n.validated=d1.validated;}}else{n=e;}return n;};c1.prototype.destroy=function(){if(this._oFieldControl){this._oFieldControl.destroy();}if(this._oSelector){this._oSelector.destroy();}if(this._oTypes){this._oTypes.destroy();}if(this._oHelper){this._oHelper.destroy();}if(this.oType){this.oType.destroy();this.oType=null;}if(this.oTextArrangementDelegate){this.oTextArrangementDelegate.destroy();}this._oHelper=null;this._oFieldControl=null;this._oTypes=null;this._oSelector=null;this._oMetaData=null;this._oAmountInputFlexItemData=null;this._oUOMInputFlexItemData=null;this._oUOMTextFlexItemData=null;this.oMeasureField=null;this.oTextArrangementDelegate=null;h.prototype.destroy.apply(this,arguments);};return c1;},true);
