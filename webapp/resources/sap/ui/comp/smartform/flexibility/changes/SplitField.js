/*!
 * SAPUI5
 * (c) Copyright 2009-2021 SAP SE. All rights reserved.
 */
sap.ui.define([],function(){"use strict";var S={};S.applyChange=function(c,C,p){var o=c.getDefinition();var m=p.modifier;var A=p.appComponent;var v=p.view;var s=m.bySelector(o.content.sourceSelector,A,v);var l;var f=function(a,b){if(a.index>b.index){return 1;}else if(a.index<b.index){return-1;}};var P=m.bySelector(o.content.parentSelector,A,v);var n=o.content.newElementIds.slice();var d=[];var F;var L;var g;var i;return Promise.all([m.getAggregation(s,"elements"),m.getProperty(s,"elementForLabel"),m.getAggregation(P,"groupElements")]).then(function(V){F=V[0];L=V[1];g=V[2];i=g.indexOf(s);return m.getProperty(s,"label");}).then(function(a){if(a&&(typeof a!=="string")){return m.getProperty(a,"text");}return a;}).then(function(a){l=a;return F.reduce(function(b,e,I){if(I!==L){var N=n.pop();var h;return b.then(m.createControl.bind(m,"sap.ui.comp.smartform.GroupElement",p.appComponent,v,N)).then(function(j){h=j;d.push({groupElementSelector:m.getSelector(h,A),index:I});return Promise.resolve().then(m.removeAggregation.bind(m,s,"elements",e)).then(m.insertAggregation.bind(m,h,"elements",e,0,v)).then(m.insertAggregation.bind(m,P,"groupElements",h,i+I,v)).then(m.getProperty.bind(m,h,"label")).then(function(k){if(k&&(typeof k!=="string")){m.setProperty(k,"text",l);}else{m.setProperty(h,"label",l);}});});}else{d.push({groupElementSelector:m.getSelector(s,A),index:I});if(L!==0){m.setProperty(s,"elementForLabel",0);}return b.then(m.removeAggregation.bind(m,s,"elements",e)).then(m.insertAggregation.bind(m,s,"elements",e,0,v)).then(m.getProperty.bind(m,s,"label")).then(function(j){if(j&&(typeof j!=="string")){m.setProperty(j,"text",l);}else{m.setProperty(s,"label",l);}});}},Promise.resolve());}).then(function(){c.setRevertData({sourceControlSelector:o.content.sourceSelector,labelText:l,splittedFields:d.sort(f)});});};S.completeChangeContent=function(c,s,p){var m=p.modifier;var a=p.appComponent;var C=c.getDefinition();if(s.newElementIds){C.content.newElementIds=s.newElementIds.slice(0,-1);}else{throw new Error("oSpecificChangeInfo.newElementIds attribute required");}if(s.sourceControlId){C.content.sourceSelector=m.getSelector(s.sourceControlId,a);c.addDependentControl(s.sourceControlId,"sourceControl",p);}else{throw new Error("oSpecificChangeInfo.sourceControlId attribute required");}if(s.parentId){C.content.parentSelector=m.getSelector(s.parentId,a);c.addDependentControl(s.parentId,"parent",p);}else{throw new Error("oSpecificChangeInfo.parentId attribute required");}};S.revertChange=function(c,C,p){var v=p.view;var m=p.modifier;var a=p.appComponent;var r=c.getRevertData();var s=r.splittedFields;var o=m.bySelector(r.sourceControlSelector,a,v);return s.reduce(function(b,d){var g=m.bySelector(d.groupElementSelector,a,v);return b.then(m.getAggregation.bind(m,g,"elements")).then(function(f){var F=f[0];return Promise.resolve().then(m.removeAggregation.bind(m,g,"elements",F)).then(m.insertAggregation.bind(m,o,"elements",F,d.index,v));}).then(function(){if(g!==o){m.destroy(g);}});},Promise.resolve()).then(m.getProperty.bind(m,o,"label")).then(function(l){if(l&&(typeof l!=="string")){m.setProperty(l,"text",r.labelText);}else{m.setProperty(o,"label",r.labelText);}c.resetRevertData();});};S.getChangeVisualizationInfo=function(c){return{affectedControls:[c.getDefinition().content.sourceSelector],dependentControls:c.getDefinition().content.newElementIds};};return S;},true);
