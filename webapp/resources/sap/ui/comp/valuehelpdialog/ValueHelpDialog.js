/*
 * ! SAPUI5
 * (c) Copyright 2009-2021 SAP SE. All rights reserved.
 */
sap.ui.define(['sap/base/Log','sap/ui/comp/library','sap/m/Dialog','sap/m/MessageBox','sap/m/Token','./ItemsCollection','sap/ui/core/library','sap/m/VBox','sap/m/HBox','sap/m/FlexBox','sap/ui/comp/util/FormatUtil','sap/m/DialogRenderer','sap/m/FlexItemData','sap/m/Title','sap/m/Text','sap/m/Label','sap/m/Button','sap/m/Bar','sap/m/OverflowToolbarLayoutData','sap/m/Tokenizer','sap/m/Panel','sap/m/StandardListItem','sap/m/IconTabBar','sap/m/IconTabFilter','sap/m/library','sap/ui/core/InvisibleText','sap/ui/core/IconPool','sap/ui/table/library','sap/ui/table/Table','sap/ui/table/Column','sap/m/Table','sap/m/Column','sap/ui/layout/HorizontalLayout','sap/ui/layout/Grid','sap/ui/Device','sap/m/List','sap/m/Link','sap/ui/comp/p13n/P13nFilterPanel','sap/m/P13nConditionPanel','sap/m/P13nItem','sap/m/P13nAnyFilterItem','sap/m/CheckBox','sap/ui/comp/p13n/P13nOperationsHelper',"sap/ui/core/format/NumberFormat","sap/ui/core/ResizeHandler"],function(L,l,D,M,T,I,c,V,H,F,a,b,d,f,g,h,B,k,O,m,P,S,p,q,r,s,t,u,U,v,w,C,x,G,y,z,A,E,J,K,N,Q,R,W,X){"use strict";var Y;var Z=r.ButtonType;var $=r.OverflowToolbarPriority;var _=r.ListMode;var a1=r.ListType;var b1=c.HorizontalAlign;var c1=l.smartfilterbar.DisplayBehaviour;var d1={DESKTOP_LIST_VIEW:"DESKTOP_LIST_VIEW",DESKTOP_CONDITIONS_VIEW:"DESKTOP_CONDITIONS_VIEW",PHONE_MAIN_VIEW:"PHONE_MAIN_VIEW",PHONE_SEARCH_VIEW:"PHONE_SEARCH_VIEW",PHONE_LIST_VIEW:"PHONE_LIST_VIEW",PHONE_CONDITIONS_VIEW:"PHONE_CONDITIONS_VIEW"};var e1=D.extend("sap.ui.comp.valuehelpdialog.ValueHelpDialog",{metadata:{library:"sap.ui.comp",properties:{basicSearchText:{type:"string",group:"Misc",defaultValue:""},supportMultiselect:{type:"boolean",group:"Misc",defaultValue:true},supportRanges:{type:"boolean",group:"Misc",defaultValue:false},supportRangesOnly:{type:"boolean",group:"Misc",defaultValue:false},key:{type:"string",group:"Misc",defaultValue:""},keys:{type:"string[]",group:"Misc",defaultValue:null},descriptionKey:{type:"string",group:"Misc",defaultValue:""},maxIncludeRanges:{type:"string",group:"Misc",defaultValue:'-1'},maxExcludeRanges:{type:"string",group:"Misc",defaultValue:'-1'},displayFormat:{type:"string",group:"Misc",defaultValue:""},tokenDisplayBehaviour:{type:"string",group:"Misc",defaultValue:""},filterMode:{type:"boolean",group:"Misc",defaultValue:false},_enhancedExcludeOperations:{type:"boolean",group:"Misc",defaultValue:false,visibility:"hidden"}},aggregations:{filterBar:{type:"sap.ui.comp.filterbar.FilterBar",multiple:false}},events:{ok:{parameters:{tokens:{type:"sap.m.Token[]"}}},cancel:{},selectionChange:{parameters:{tableSelectionParams:{type:"object"},updateTokens:{type:"object[]"},useDefault:{type:"boolean",defaultValue:false},table:{type:"object"}}},tokenRemove:{parameters:{tokenKeys:{type:"string[]"},useDefault:{type:"boolean",defaultValue:false}}},updateSelection:{parameters:{tokenKeys:{type:"string[]"},useDefault:{type:"boolean",defaultValue:false}}}}},renderer:{apiVersion:2}});e1.prototype.setSupportMultiselect=function(e){this.setProperty("supportMultiselect",e);this._updatePropertySupportMultiselect(e);this._oTokenizerGrid.setVisible(e);this._oButtonOk.setVisible(e);return this;};e1.prototype._updatePropertySupportMultiselect=function(e){if(!this._oTable){return undefined;}if(!this._isPhone()){if(this._oTable.setSelectionMode){this._oTable.setSelectionMode(e?u.SelectionMode.MultiToggle:u.SelectionMode.Single);}}else if(this._oTable.setMode){this._oTable.setMode(e?_.MultiSelect:_.SingleSelectLeft);}return this;};e1.prototype.setSupportRanges=function(e){this.setProperty("supportRanges",e);this._updateNavigationControl();return this;};e1.prototype.setSupportRangesOnly=function(e){this.setProperty("supportRangesOnly",e);this._updateNavigationControl();return this;};e1.prototype.setTitle=function(e){this.setProperty("title",e);this._updateDlgTitle();return this;};e1.prototype.setFilterBar=function(o){this.setAggregation("filterBar",o);if(this._oMainLayout&&o){if(this._isPhone()){if(this._oFilterBar){this._oContentContainer.removeItem(this._oFilterBar);this._oFilterBar.detachInitialise(this._handleFilterBarInitialize);}}else if(this._oFilterBar){this._oMainLayout.removeItem(this._oFilterBar);this._oFilterBar.detachInitialise(this._handleFilterBarInitialize);}this._oFilterBar=o;this._oFilterBar.attachInitialise(this._handleFilterBarInitialize,this);if(this._oFilterBar){this._oFilterBar.addStyleClass("compVHSearch");if(this._isPhone()){var e=sap.ui.getCore().byId(this._oFilterBar.getBasicSearch());if(e&&e.isA("sap.m.SearchField")){e.setShowSearchButton(true);e.attachSearch(function(j){if(j.mParameters.refreshButtonPressed!==undefined){this.getFilterBar().search();}}.bind(this));}this._oFilterBar.setShowGoOnFB(false);this._oColSearchBox.setLayoutData(new d({shrinkFactor:0}));this._oContentContainer.insertItem(this._oColSearchBox,0);this._oFilterBar.setLayoutData(new d({shrinkFactor:0}));this._oContentContainer.insertItem(this._oFilterBar,1);this._oFilterBar.attachSearch(function(j){this._updateView(d1.PHONE_LIST_VIEW);}.bind(this));if(this._currentViewMode===d1.PHONE_LIST_VIEW){this._oFilterBar.setVisible(true);this._oFilterBar.setFilterBarExpanded(false);this._handleFilterBarInitialize();}}else{this._oFilterBar._setCollectiveSearch(this._oColSearchBox);this._oMainLayout.insertItem(this._oFilterBar,0);}}if(h1(this._oTabBar)){this.setInitialFocus(this._oTabBar.getItems()[0]);}else if(this._oFilterBar._oSearchButton){this.setInitialFocus(this._oFilterBar._oSearchButton);}if(this._oFilterBar._oBasicSearchField){var i=this._oFilterBar._oBasicSearchField;i.setValue(this.getBasicSearchText());if(!h1(this._oTabBar)){this.setInitialFocus(i);}}}return this;};e1.prototype._handleFilterBarInitialize=function(){if(this._currentViewMode===d1.PHONE_LIST_VIEW){this._oFilterBar._handleVisibilityOfToolbar();var e=this._oFilterBar&&this._oFilterBar.getFilterGroupItems()&&this._oFilterBar.getFilterGroupItems().length>0;this._oAdvancedSearchLink.setVisible(e);this._oFilterBar.setShowGoButton(!(this._oFilterBar&&this._oFilterBar.getBasicSearch()));}this._setToolbarSpacerWidth();if(h1(this._oTabBar)){this.setInitialFocus(this._oTabBar.getItems()[0]);}else if(this._oFilterBar&&this._oFilterBar._oBasicSearchField){this.setInitialFocus(this._oFilterBar._oBasicSearchField);}};e1.prototype.getFilterBar=function(){return this._oFilterBar;};e1.prototype.setBasicSearchText=function(e){this.setProperty("basicSearchText",e);if(this._oFilterBar&&this._oFilterBar._oBasicSearchField){this._oFilterBar._oBasicSearchField.setValue(e);}return this;};e1.prototype.setTokens=function(e){var j=true;if(e.length){var n=0,o;for(var i=0;i<e.length;i++){var i1=e[i];if(i1.data("range")){var j1=Object.assign({},i1.data("range"));o=i1.getKey();if(!o){do{o="range_"+n;n++;}while(this._oSelectedRanges[o]);}var k1=this._getFormatedRangeTokenText(j1.operation,j1.value1,j1.value2,j1.exclude,j1.keyField);this._addToken2Tokenizer(o,k1,this._getTokenizer(),j1.keyField);this._oSelectedRanges[o]=j1;j=false;}else{o=i1.getKey();var l1=i1.getText();var m1=i1.data("longKey");var n1=i1.data("row");if(!m1){m1=o;}this._oSelectedItems.add(m1,n1?n1:i1.getText());var o1=new T(g1.call(this,m1));o1.setKey(m1);o1.setText(l1);o1.setTooltip(l1);this._getTokenizer().addToken(o1);}}}else{this._oSelectedItems.removeAll();this._oSelectedRanges={};this._getTokenizer().destroyTokens();}if(j){this._updateTokenizer();}};e1.prototype.open=function(){if(!this._oTable&&!(this._isPhone()&&(this.getSupportRangesOnly()||this.getFilterMode()))){return f1.call(this).then(function(){return this.open();}.bind(this));}this._bIgnoreSelectionChange=false;if(this._oColSearchBox){this._bIsMdcCollectiveSearch=this._oColSearchBox.isA("sap.ui.mdc.filterbar.vh.CollectiveSearchSelect");if(this._bIsMdcCollectiveSearch){this.bCollectiveSearchActive=this._oColSearchBox.getVisible();}else{this.bCollectiveSearchActive=this.oSelectionTitle.getVisible()&&this.oSelectionButton.getVisible();this._oColSearchBox.setVisible(this.bCollectiveSearchActive);}}if(!this._isPhone()){if(this.getSupportRangesOnly()||this.getFilterMode()){this._updateView(d1.DESKTOP_CONDITIONS_VIEW);}if(this.isPropertyInitial("contentWidth")){this.setContentWidth(this._getDefaultContentWidth());}}else{this._updateView(d1.PHONE_MAIN_VIEW);}D.prototype.open.apply(this);if(h1(this._oTabBar)){this.setInitialFocus(this._oTabBar.getItems()[0]);}else if(this._oFilterBar&&this._oFilterBar._oBasicSearchField){this.setInitialFocus(this._oFilterBar._oBasicSearchField);}else if(!this._oFilterBar&&this._currentViewMode==="DESKTOP_CONDITIONS_VIEW"){if(this._oFilterPanel&&this._oFilterPanel._oConditionPanel){var o=this._oFilterPanel._oConditionPanel._oConditionsGrid.getAggregation("content")[0].operation;this.setInitialFocus(o);}}return this;};e1.prototype.getTable=function(){L.warning("Please use getTableAsync to prevent synchronous calls.",this);if(!this._oTable){this._createDefaultTable();}return this._oTable;};e1.prototype.getTableAsync=function(){if(this._oTablePromise){return this._oTablePromise;}else if(!this._oTable){return f1.call(this);}else{return new Promise(function(e){e(this._oTable);}.bind(this));}};e1.prototype.setTable=function(o){if(this._oTable){this._oMainLayout.removeItem(this._oTable);if(this._bTableCreatedInternal){this._oTable.destroy();this._oTable=null;}}this._bTableCreatedInternal=(arguments.length>1)&&(arguments[1]==true);if(o&&o.isA("sap.ui.comp.smarttable.SmartTable")){this._oTable=o.getTable();}else{this._oTable=o;}if(this._oTable&&this._oTable.isA("sap.ui.table.Table")){this._oTable.setEnableBusyIndicator(true);if(this._oTable.isA("sap.ui.table.AnalyticalTable")){Y=sap.ui.require("sap/ui/table/AnalyticalColumn");}}this._oTable.setLayoutData(new d({shrinkFactor:0,growFactor:1}));this.theTable=this._oTable;this._initializeTable();this._oMainLayout.addItem(o);};e1.prototype._getDefaultContentWidth=function(){var i;if(y.system.desktop){i=1080;}else if(y.system.tablet){if(y.orientation.landscape){i=920;}else if(y.orientation.portrait){i=600;}}return i+"px";};e1.prototype.resetTableState=function(){if(this._oTable){if(this._oTable.unbindRows){this._oTable.unbindRows();}this._updateNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_PRESSSEARCH"));}};e1.prototype.TableStateSearchData=function(){this._updateNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_PRESSSEARCH"));};e1.prototype._updateNoDataText=function(n){if(this._oTable){if(this._oTable.setNoData){this._oTable.setNoData(n);}else if(this._oTable.setNoDataText){this._oTable.setNoDataText(n);}}};e1.prototype.TableStateDataFilled=function(){this._updateNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_NODATA"));};e1.prototype.TableStateDataSearching=function(){this._updateNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_SEARCHING"));};e1.prototype.init=function(){D.prototype.init.apply(this);this._oTokenIdCount={};this._bTableCreatedInternal=false;this._aIncludeRangeOperations={};this._aExcludeRangeOperations={};this._bInitTokensHaveChanged;this.setStretch(this._isPhone());this.setResizable(!this._isPhone());this.setDraggable(!this._isPhone());this.bCollectiveSearchActive=false;this.addStyleClass("compValueHelpDialog");this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");this._sTableTitle1=this._oRb.getText("VALUEHELPDLG_TABLETITLE1");this._sTableTitle2=this._oRb.getText("VALUEHELPDLG_TABLETITLE2");this._sTableTitleNoCount=this._oRb.getText("VALUEHELPDLG_TABLETITLENOCOUNT");this._currentViewMode=null;this._oSelectedItems=new I();this._oSelectedRanges={};this._oOperationsHelper=new R();this._fnRejectTablePromise;this._createHeaderBar();this._createCollectiveSearch();this._createTokenizer();this._updateTokenizer();this._oNavigationContainer=new V(this.getId()+"-navigationContainer",{width:"100%",layoutData:new d({growFactor:0,shrinkFactor:0})});this._oContentContainer=new V(this.getId()+"-vbox",{width:"100%",height:"100%"}).addStyleClass("compVHContentContainerVbox");this._oContainersWrapper=new F(this.getId()+"-containersWrapper",{alignItems:"Start",height:"100%",width:"100%",direction:"Column",justifyContent:"SpaceBetween",items:[this._oNavigationContainer,this._oContentContainer]});this.addContent(this._oContainersWrapper);this._oMainLayout=new V(this.getId()+"-mainLayout",{fitContainer:true,items:[this._oFilterBar],layoutData:new d({growFactor:1,shrinkFactor:0,styleClass:"mainLayout"})});this._createNavigationControl();this._updateNavigationControl();this._oContentContainer.addItem(this._oMainLayout);if(this.getMaxIncludeRanges()==="-1"&&this.getMaxExcludeRanges()!=="0"&&!this.getFilterMode()){this._oContentContainer.addItem(this._oTokenizerGrid);}this._createFooterControls();this.setVerticalScrolling(false);this.setHorizontalScrolling(false);if(!y.system.desktop){this._oContentContainer.attachBrowserEvent("touchmove",function(e){e.setMarked();});}if(!this._isPhone()){this._updateView(d1.DESKTOP_LIST_VIEW);}};e1.prototype._updateView=function(n){if(this._currentViewMode===n){return;}switch(n){case d1.DESKTOP_LIST_VIEW:this._validateRanges(function(){this._oTokenizerGrid.setVisible(this.getSupportMultiselect());this._oMainLayout.removeAllItems();if(this._oTabBar&&this._oTabBar.getSelectedKey()!==d1.DESKTOP_LIST_VIEW){this._oTabBar.setSelectedKey(d1.DESKTOP_LIST_VIEW);}this._oMainLayout.addItem(this._oFilterBar);this._oMainLayout.addItem(this._oTable);this._updateDlgTitle();}.bind(this),function(){this._oTabBar.setSelectedKey(d1.DESKTOP_CONDITIONS_VIEW);this._updateView(d1.DESKTOP_CONDITIONS_VIEW);}.bind(this));break;case d1.DESKTOP_CONDITIONS_VIEW:if(this.getSupportRanges()){this._oMainLayout.removeAllItems();if(this._oTabBar&&this._oTabBar.getSelectedKey()!==d1.DESKTOP_CONDITIONS_VIEW){this._oTabBar.setSelectedKey(d1.DESKTOP_CONDITIONS_VIEW);}this._createAddRanges();this._oButtonOk.setVisible(this.getSupportRangesOnly()||this.getSupportMultiselect());this._oTokenizerGrid.setVisible(this.getSupportMultiselect());if(!(this.getMaxIncludeRanges()==="-1"&&this.getMaxExcludeRanges()!=="0"&&!this.getFilterMode())){this._oTokenizerGrid.setVisible(false);}}break;case d1.PHONE_MAIN_VIEW:this.setVerticalScrolling(false);this._oColSearchBox.setVisible(false);this._oMainListMenu.setVisible(true);this._updateNavigationControl();this._oAdvancedSearchLink.setVisible(false);if(this._oFilterBar){this._oFilterBar.setVisible(false);this._oFilterBar.setFilterBarExpanded(false);}if(this._oTable){this._oTable.setVisible(false);}this._oTokenizerGrid.setVisible(this.getSupportMultiselect());if(!(this.getMaxIncludeRanges()==="-1"&&this.getMaxExcludeRanges()!=="0"&&!this.getFilterMode())){this._oTokenizerGrid.setVisible(false);}if(this._oRanges){this._oRanges.setVisible(false);}this._oButtonGo.setVisible(false);this._oButtonClear.setVisible(false);this._oButtonOk.setVisible(true);this._oButtonCancel.setVisible(true);this._oBackButton.setVisible(false);this._bNoneMainView=false;if(!(this._oSelectItemLI.getVisible()&&this._oDefineConditionsLI.getVisible())){this._bNoneMainView=true;if(this._oSelectItemLI.getVisible()){this._updateView(d1.PHONE_LIST_VIEW);}if(this._oDefineConditionsLI.getVisible()){this._updateView(d1.PHONE_CONDITIONS_VIEW);}return;}break;case d1.PHONE_LIST_VIEW:this.setVerticalScrolling(true);this._oColSearchBox.setVisible(this.bCollectiveSearchActive);if(this._bIsMdcCollectiveSearch){this._oColSearchBox.addStyleClass("sapUiTinyMarginBegin");this._oColSearchBox.oText.removeStyleClass("sapUiMdcCollectiveSearchSelectTextPhoneMaxWidth");}this._oMainListMenu.setVisible(false);if(this._oFilterBar){var e=this._oFilterBar&&this._oFilterBar.getFilterGroupItems()&&this._oFilterBar.getFilterGroupItems().length>0;this._oAdvancedSearchLink.setVisible(e);this._oFilterBar.setShowGoButton(!(this._oFilterBar&&this._oFilterBar.getBasicSearch()));this._oFilterBar.setVisible(true);this._oFilterBar.setFilterBarExpanded(false);}if(this._oTable){this._oTable.setVisible(true);}this._oTokenizerGrid.setVisible(false);if(this._oRanges){this._oRanges.setVisible(false);}this._oButtonGo.setVisible(false);this._oButtonClear.setVisible(false);this._oButtonOk.setVisible(this.getSupportMultiselect());this._oButtonCancel.setVisible(true);this._oBackButton.setVisible(!this._bNoneMainView);break;case d1.PHONE_SEARCH_VIEW:this.setVerticalScrolling(true);this._oColSearchBox.setVisible(false);this._oMainListMenu.setVisible(false);if(this._oFilterBar){this._oFilterBar.setVisible(true);this._oFilterBar.setFilterBarExpanded(true);}this._oAdvancedSearchLink.setVisible(false);if(this._oTable){this._oTable.setVisible(false);}this._oTokenizerGrid.setVisible(false);if(this._oRanges){this._oRanges.setVisible(false);}this._oButtonGo.setVisible(true);this._oButtonClear.setVisible(this._oFilterBar&&this._oFilterBar.getShowClearOnFB());this._oButtonOk.setVisible(false);this._oButtonCancel.setVisible(true);this._oBackButton.setVisible(true);break;case d1.PHONE_CONDITIONS_VIEW:this.setVerticalScrolling(true);this._oColSearchBox.setVisible(false);this._oMainListMenu.setVisible(false);if(this._oFilterBar){this._oFilterBar.setVisible(false);}this._oAdvancedSearchLink.setVisible(false);if(this._oTable){this._oTable.setVisible(false);}this._oTokenizerGrid.setVisible(false);if(!this._oRanges){this._createAddRanges();}if(this._oRanges){this._oRanges.setVisible(true);}this._oButtonGo.setVisible(false);this._oButtonClear.setVisible(false);this._oButtonOk.setVisible(true);this._oButtonCancel.setVisible(true);this._oBackButton.setVisible(!this._bNoneMainView);break;default:break;}if(this._oMainListMenu&&this._oContentContainer){if(this._oFilterBar){this._oFilterBar._handleVisibilityOfToolbar();}this._oContentContainer.rerender();}this._currentViewMode=n;this._updateDlgTitle();};e1.prototype._changeTableRowSelectionForKey=function(e,j){var i;var o=this._oTable;this._bIgnoreSelectionChange=true;if(o&&o.isA("sap.ui.table.Table")){var n=o.getBinding("rows");if(n){if(n.aKeys){for(i=0;i<n.aKeys.length;i++){if(decodeURIComponent(n.aKeys[i])===e){if(j){o.addSelectionInterval(i,i);}else{o.removeSelectionInterval(i,i);}break;}}}else{this.oRows=o.getBinding("rows");if(this.oRows.aIndices){for(i=0;i<this.oRows.aIndices.length;i++){var i1=o.getContextByIndex(this.oRows.aIndices[i]);if(i1){var j1=i1.getObject();if(j1[this.getKey()]===e){if(j){o.addSelectionInterval(i,i);}else{o.removeSelectionInterval(i,i);}break;}}}}}}}else{for(i=0;i<o.getItems().length;i++){var k1=o.getItems()[i];var l1=k1.getBindingContext().getObject();if(l1[this.getKey()]===e){o.setSelectedItem(k1,j);break;}}}this._bIgnoreSelectionChange=false;};e1.prototype.update=function(){var i,j,o,e;var n;var i1=this._oSelectedItems.getItems();var j1={tokenKeys:i1,useDefault:false};this._bIgnoreSelectionChange=true;if(this._hasListeners("updateSelection")){this.fireUpdateSelection(j1);}else{j1.useDefault=true;}if(j1.useDefault){if(this._oTable&&this._oTable.isA("sap.ui.table.Table")){this.oRows=this._oTable.getBinding("rows");this._oTable.clearSelection();if(this.oRows&&this.oRows.aKeys){var k1=this.getKeys();var l1=k1&&k1.length>1?this.getKey()+"=":"";for(j=0;j<i1.length;j++){n=i1[j];var m1=l1+"'"+n+"'";for(i=0;i<this.oRows.aKeys.length;i++){var n1=this.oRows.aKeys[i];if(n1===undefined){continue;}n1=decodeURIComponent(n1);var o1=n1===n;if(o1||n1.indexOf(m1)>=0){if(!o1){this._oSelectedItems.remove(n);var p1=this._getTokenByKey(n,this._getTokenizer());if(p1){p1.setKey(n1);}}e=this._oTable.getContextByIndex(i);if(e){o=e.getObject();this._oSelectedItems.add(n1,o);}this._oTable.addSelectionInterval(i,i);break;}}}}else if(this.oRows&&this.oRows.aIndices){this._oTable.clearSelection();var q1=this._oTable.getBinding("rows").getContexts();for(j=0;j<i1.length;j++){var r1=i1[j];for(i=0;i<this.oRows.aIndices.length;i++){e=q1[i];if(e){o=e.getObject();if(o[this.getKey()]===r1){this._oSelectedItems.add(o[this.getKey()],o);this._oTable.addSelectionInterval(i,i);break;}}}}}}else{var s1=this._oTable;for(j=0;j<i1.length;j++){n=i1[j];for(i=0;i<s1.getItems().length;i++){var t1=s1.getItems()[i];var u1=t1.getBindingContext().getObject();if(u1[this.getKey()]===n){s1.setSelectedItem(t1,true);break;}}}}}this._bIgnoreSelectionChange=false;this._updateTitles();};e1.prototype._createHeaderBar=function(){this._oTitle=new f(this.getId()+"-title");var o=null;if(this._isPhone()){o=new B(this.getId()+"-back",{visible:false,type:Z.Back,press:function(i){if(this._currentViewMode===d1.PHONE_SEARCH_VIEW){this._updateView(d1.PHONE_LIST_VIEW);}else{this._updateView(d1.PHONE_MAIN_VIEW);}}.bind(this)});this._oBackButton=o;}this._oTitle.addStyleClass("sapUiSmallMarginBeginEnd");var e=new k(this.getId()+"-header",{contentLeft:[o,this._oTitle],design:"Header"});this.setCustomHeader(e);this.getCustomHeader().addStyleClass("sapContrastPlus");};e1.prototype._createCollectiveSearch=function(){this.oSelectionTitle=new g(this.getId()+"-selTitle",{visible:false,wrapping:false}).addStyleClass("compVHColSearchText");if(y.system.tablet&&!y.system.desktop){this.oSelectionTitle.addStyleClass("compVHColSearchTextTabletMaxWidth");}else{this.oSelectionTitle.addStyleClass("compVHColSearchTextMaxWidth");}this.oSelectionButton=new B(this.getId()+"-selButton",{icon:"sap-icon://slim-arrow-down",tooltip:this._oRb.getText("VALUEHELPVALDLG_SEARCHTEMPLATES_TOOLTIP"),type:Z.Transparent,visible:false,ariaLabelledBy:this.oSelectionTitle}).addStyleClass("compVHColSearchBtn");this._oColSearchBox=new H(this.getId()+"-selBox",{fitContainer:true,visible:this.oSelectionButton.getVisible(),items:[this.oSelectionTitle,this.oSelectionButton]}).addStyleClass("compVHColSearchVBox");};e1.prototype._createFooterControls=function(){this._oButtonOk=new B(this.getId()+"-ok",{text:this._oRb.getText("VALUEHELPDLG_OK"),press:this._onCloseAndTakeOverValues.bind(this),visible:this.getSupportMultiselect(),type:Z.Emphasized,layoutData:new O({priority:$.NeverOverflow})});this._oButtonCancel=new B(this.getId()+"-cancel",{text:this._oRb.getText("VALUEHELPDLG_CANCEL"),press:this._onCancel.bind(this),layoutData:new O({priority:$.NeverOverflow})});if(this._isPhone()){this._oButtonGo=new B(this.getId()+"-go",{text:this._oRb.getText("VALUEHELPDLG_GO"),type:Z.Emphasized,press:this._onGo.bind(this),visible:false,layoutData:new O({priority:$.NeverOverflow})});this._oButtonClear=new B(this.getId()+"-clear",{text:this._oRb.getText("VALUEHELPDLG_CLEAR"),press:this._onClear.bind(this),visible:false,layoutData:new O({priority:$.NeverOverflow})});this.addButton(this._oButtonGo);this.addButton(this._oButtonClear);}this.addButton(this._oButtonOk);this.addButton(this._oButtonCancel);};e1.prototype._createTokenizer=function(){if(this._oTokenizerGrid){return this._oTokenizerGrid;}this._oSelectedTokenTitle=new s(this.getId()+"-selectedTokenTitle");this._oSelectedTokens=new m(this.getId()+"-selectedTokens",{tokenUpdate:function(e){if(this._ignoreRemoveToken){return;}if(e.getParameter("type")===m.TokenChangeType.Removed){var n=e.getParameter("removedTokens");var i1=[];var j1=[];for(var j=0;j<n.length;j++){var k1=n[j];var l1=k1.getKey();if(this._oSelectedRanges&&this._oSelectedRanges[l1]){j1.push(l1);this._removeToken(l1);}else{i1.push(l1);this._oSelectedItems.remove(l1);this._removeTokenFromTokenizer(l1,this._getTokenizer());}}this._removeRangeByKey(j1);var m1={tokenKeys:i1,useDefault:false};if(this._hasListeners("tokenRemove")){this._bIgnoreSelectionChange=true;this.fireTokenRemove(m1);this._bIgnoreSelectionChange=false;}else{m1.useDefault=true;}if(m1.useDefault){i1.forEach(function(i){this._changeTableRowSelectionForKey(i,false);}.bind(this));}if(n.length===1){setTimeout(function(){var n1=this._getTokenizer().getTokens();if(n1){var i=n1.length-1;if(i>=0){n1[i].focus();}else{this._manageFocusAfterRemoveTokens();}}}.bind(this));}this._updateTitles();}}.bind(this),ariaLabelledBy:this._oSelectedTokenTitle}).addStyleClass("compVHTokensDiv");this._oRemoveAllSelectedItemsBtn=new B(this.getId()+"-removeSelItems",{type:Z.Transparent,icon:t.getIconURI("decline"),tooltip:this._oRb.getText("VALUEHELPVALDLG_REMOVETOKENS_TOOLTIP"),press:function(){this._getTokenizer().destroyTokens();this._removeRangeByKey(Object.keys(this._oSelectedRanges));this._oSelectedItems.removeAll();this._bIgnoreSelectionChange=true;if(this._oTable&&this._oTable.clearSelection){this._oTable.clearSelection();}if(this._oTable&&this._oTable.removeSelections){this._oTable.removeSelections();}this._bIgnoreSelectionChange=false;this._updateTitles();this._manageFocusAfterRemoveTokens();}.bind(this),ariaDescribedBy:this._oSelectedTokenTitle}).addStyleClass("compVHRemoveAllBtn");var o=new x(this.getId()+"-selItemsBox",{content:[this._getTokenizer(),this._oRemoveAllSelectedItemsBtn]}).addStyleClass("compVHTokenizerHLayout");this._oIncludeTokenGrid=new G(this.getId()+"-selItemsGrid",{width:"100%",defaultSpan:"L12 M12 S12",hSpacing:0,vSpacing:0,content:[this._oSelectedTokenTitle,o]}).addStyleClass("sapUiRespGridOverflowHidden");this._oTokenizerPanel=new P(this.getId()+"-tokenPanel",{expanded:y.system.desktop,expandable:false,expandAnimation:true,headerText:"",width:"auto",content:[this._oIncludeTokenGrid],expand:function(e){this._updateTokenizer();if(e.mParameters.expand&&this._oTable&&!(this._oTable.isA("sap.m.Table"))){var i=window.document.getElementById(this.getId()+"-scrollCont");if(i&&i.scrollTop){i.stop().animate({scrollTop:"1000"},1000);}}}.bind(this)}).addStyleClass("compVHBackgroundTransparent").addStyleClass("compVHTokensPanel").addStyleClass("compValueHelpDialogTokens");if(this._isPhone()){this._getTokenizer().addStyleClass("sapMTokenizerMultiLine");}this._oTokenizerGrid=new G(this.getId()+"-tokenizerGrid",{width:"100%",defaultSpan:"L12 M12 S12",hSpacing:0,vSpacing:0,content:this._oTokenizerPanel}).addStyleClass("compVHDBackground").addStyleClass("sapUiRespGridOverflowHidden");return this._oTokenizerGrid;};e1.prototype._addToken2Tokenizer=function(e,i,o,j){var n=(typeof i==="string")?i:"";var i1=this._getTokenByKey(e,o);if(!i1){i1=new T(g1.call(this,e,j));i1.setKey(e);o.addToken(i1);this._updateTokenizer();}if(i1){i1.setText(i);i1.setTooltip(n);}};e1.prototype._getTokenByKey=function(e,o){var j=o.getTokens();for(var i=0;i<j.length;i++){var n=j[i];if(n.getKey()===e){return n;}}return null;};e1.prototype._removeToken=function(e){this._removeTokenFromTokenizer(e,this._getTokenizer());};e1.prototype._removeTokenFromTokenizer=function(e,o){var i=this._getTokenByKey(e,o);if(i){this._ignoreRemoveToken=true;o.removeToken(i);i.destroy();this._ignoreRemoveToken=false;this._updateTokenizer();return true;}return false;};e1.prototype._updateTokenizer=function(){this._bInitTokensHaveChanged=true;var e=false;if(this._oTokenizerPanel){e=this._oTokenizerPanel.getExpanded();}var n=this._getTokenizer().getTokens().length;var i=this._oRb.getText("VALUEHELPDLG_SELECTEDITEMS_CONDITIONS");var j=this._oRb.getText("VALUEHELPDLG_NONESELECTEDITEMS_CONDITIONS");var o=i.replace("{0}",n.toString());var i1=n===0?j:o;if(this._oTokenizerPanel){if(!e){i1="";if(n!==0){i1=o;}if(i1===""){i1=j;}}this._oTokenizerPanel.setHeaderText(i1);this._oSelectedTokenTitle.setText(i1);}else{this._oSelectedTokenTitle.setText(i1);}this._oRemoveAllSelectedItemsBtn.setEnabled(n!==0);this._oIncludeTokenGrid.removeStyleClass("displayNone");};e1.prototype._createNavigationControl=function(){if(!this._isPhone()){this._oTabBar=new p(this.getId()+"-navigation",{expandable:false,items:[new q(this.getId()+"-itemstable",{visible:true,text:this._getTabSearchAndSelectText(),key:d1.DESKTOP_LIST_VIEW}),new q(this.getId()+"-ranges",{visible:true,text:this._getTabRangesText(),key:d1.DESKTOP_CONDITIONS_VIEW})],select:function(o){this._updateView(o.getParameters().key);}.bind(this)});this._oTabBar.setLayoutData(new d({shrinkFactor:0}));this._oNavigationContainer.addItem(this._oTabBar);}else{this._oSelectItemLI=new S(this.getId()+"-itemstable",{type:a1.Navigation,title:this._getTabSearchAndSelectText()}).data("key",d1.PHONE_LIST_VIEW);this._oDefineConditionsLI=new S(this.getId()+"-ranges",{type:a1.Navigation,title:this._getTabRangesText()}).data("key",d1.PHONE_CONDITIONS_VIEW);this._oMainListMenu=new z(this.getId()+"-navigation",{mode:_.None,items:[this._oSelectItemLI,this._oDefineConditionsLI],itemPress:function(e){if(e){this._updateView(e.mParameters.listItem.data("key"));}}.bind(this)});this._oMainListMenu.setLayoutData(new d({shrinkFactor:0}));this._oContentContainer.addItem(this._oMainListMenu);this._oAdvancedSearchLink=new A(this.getId()+"-advancedSearchLink",{text:this._oRb.getText("FILTER_BAR_ADV_FILTERS_DIALOG"),press:function(){this._updateView(d1.PHONE_SEARCH_VIEW);}.bind(this)}).addStyleClass("compVHAdvancedSearchLink");this._oAdvancedSearchLink.setLayoutData(new d({shrinkFactor:0,alignSelf:"End"}));this._oContentContainer.addItem(this._oAdvancedSearchLink);}};e1.prototype._updateNavigationControl=function(){var e=!this.getSupportRangesOnly();var i=this.getSupportRangesOnly()||this.getSupportRanges();if(this._oTabBar){var j=this._oTabBar.getItems();j[0].setVisible(e);j[1].setVisible(i);this._oTabBar.setVisible(e&&i);this._updateDlgTitle();}if(this._oMainListMenu){this._oSelectItemLI.setVisible(e);this._oDefineConditionsLI.setVisible(i);}};e1.prototype._removeRangeByKey=function(e){var i=e;if(typeof i==="string"){i=[i];}i.forEach(function(e,j,i){var n=this._oSelectedRanges[e];if(!n._oGrid){delete this._oSelectedRanges[e];if(this._oFilterPanel){var o=this._oFilterPanel.getConditionPanel();if(i.length==1){o.removeCondition(e);}else{o._removeConditionFromMap(e);}}}},this);if(i.length>1&&this._oFilterPanel){var o=this._oFilterPanel.getConditionPanel();o._clearConditions();o._fillConditions();}};e1.prototype._createAddRanges=function(){if(!this._oRanges){if(!sap.ui.require('sap/m/P13nFilterPanel')){sap.ui.require(['sap/m/P13nFilterPanel'],function(){this._oRanges=this._createRanges();this._oMainLayout.addItem(this._oRanges);}.bind(this));}else{this._oRanges=this._createRanges();this._oMainLayout.addItem(this._oRanges);}}else{this._oMainLayout.addItem(this._oRanges);}};e1.prototype._createRanges=function(){var e,o;this._oFilterPanel=new E(this.getId()+"-filterPanel",{maxIncludes:this.getMaxIncludeRanges(),maxExcludes:this.getMaxExcludeRanges(),containerQuery:true,enableEmptyOperations:true,filterItemChanged:function(j1){var k1=j1.getParameter("reason");var l1=j1.getParameter("key");var m1=j1.getParameter("itemData");if(m1&&k1==="added"){var n1={exclude:m1.exclude,keyField:m1.columnKey,operation:m1.operation,value1:m1.value1,value2:m1.value2};this._oSelectedRanges[l1]=n1;var n=new N({key:l1,exclude:m1.exclude,columnKey:m1.columnKey,operation:m1.operation});n.setValue1(m1.value1);n.setValue2(m1.value2);this._oFilterPanel.addFilterItem(n);var o1=this._getFormatedRangeTokenText(n1.operation,n1.value1,n1.value2,n1.exclude,n1.keyField);this._addToken2Tokenizer(l1,o1,this._getTokenizer(),n1.keyField);this._updateTokenizer();}if(m1&&k1==="updated"){var n1=this._oSelectedRanges[l1];n1.exclude=m1.exclude;n1.keyField=m1.columnKey;n1.operation=m1.operation;n1.value1=m1.value1;n1.value2=m1.value2;var o1=this._getFormatedRangeTokenText(n1.operation,n1.value1,n1.value2,n1.exclude,n1.keyField);this._addToken2Tokenizer(l1,o1,this._getTokenizer(),n1.keyField);this._updateTokenizer();}if(k1==="removed"){delete this._oSelectedRanges[l1];this._removeToken(l1);this._updateTokenizer();}this._updateTabRangesTitle();}.bind(this)});this._oFilterPanel.bIsSingleIntervalRange=this.bIsSingleIntervalRange;if(this.getProperty("_enhancedExcludeOperations")){this._oFilterPanel._enableEnhancedExcludeOperations();}o=this._oFilterPanel.getConditionPanel();o.setDisplayFormat(this.getDisplayFormat());this._oFilterPanel.setSuggestCallback(this._fSuggestCallback);o._sAddRemoveIconTooltipKey="CONDITION";if(this._aIncludeRangeOperations){for(e in this._aIncludeRangeOperations){this._oFilterPanel.setIncludeOperations(this._aIncludeRangeOperations[e],e);}}if(this._aExcludeRangeOperations){for(e in this._aExcludeRangeOperations){this._oFilterPanel.setExcludeOperations(this._aExcludeRangeOperations[e],e);}}if(this._aRangeKeyFields){this._aRangeKeyFields.forEach(function(j1){this._oFilterPanel.addItem(new K({columnKey:j1.key,text:j1.label,typeInstance:j1.typeInstance,type:j1.type,maxLength:j1.maxLength,formatSettings:j1.formatSettings,scale:j1.scale,precision:j1.precision,isDefault:j1.isDefault,values:null,nullable:j1.nullable!=="false"}));},this);}if(this._oSelectedRanges){for(var i in this._oSelectedRanges){var j=this._oSelectedRanges[i];var n=new N({key:i,exclude:j.exclude,columnKey:j.keyField,operation:j.operation});n.setValue1(j.value1);n.setValue2(j.value2);this._oFilterPanel.addFilterItem(n);}}var i1=new G(this.getId()+"-rangeFieldsGrid",{width:"100%",defaultSpan:"L12 M12 S12",vSpacing:0,hSpacing:0,content:[this._oFilterPanel]}).addStyleClass("sapUiRespGridOverflowHidden");this._sValidationDialogTitle=this._oRb.getText("VALUEHELPVALDLG_TITLE");this._sValidationDialogMessage=this._oRb.getText("VALUEHELPVALDLG_MESSAGE");this._sValidationDialogFieldMessage=this._oRb.getText("VALUEHELPVALDLG_FIELDMESSAGE");return i1;};e1.prototype.suggest=function(e){this._fSuggestCallback=e;if(this._oFilterPanel){this._oFilterPanel.setSuggestCallback(this._fSuggestCallback);}};e1.prototype._getKeyFieldByKey=function(e){var o;if(this._aRangeKeyFields){this._aRangeKeyFields.some(function(i){if(typeof i!=="string"){if(i.key===e){o=i;return true;}}return false;});}return o;};e1.prototype._validateRanges=function(e,i){if(this._oRanges){if(!this._oRanges.getParent()){e();return;}var j=this._oFilterPanel.validateConditions();if(!j){M.show(this._sValidationDialogMessage,{icon:M.Icon.WARNING,title:this._sValidationDialogTitle,actions:[M.Action.OK,M.Action.CANCEL],styleClass:this.$().closest(".sapUiSizeCompact").length?"sapUiSizeCompact":"",onClose:function(n){if(n===M.Action.OK&&e){e();}if(n===M.Action.CANCEL&&i){i();}}});return;}}e();};e1.prototype.setUpdateSingleRowCallback=function(e){this.fSingleRowCallback=e;this._updateNavigationControl();};e1.prototype._createDefaultTable=function(){if(!this._isPhone()){this.setTable(new U(this.getId()+"-table"),true);}else{this.setTable(new w(this.getId()+"-table"),true);this.TableStateSearchData();}};function f1(){if(!(this._oTablePromise instanceof Promise)){this._oTablePromise=new Promise(function(e,i){this._fnRejectTablePromise=i;if(!this._isPhone()){var o=new U(this.getId()+"-table");this.setTable(o,true);e(o);}else{var o=new w(this.getId()+"-table");this.setTable(o,true);this.TableStateSearchData();e(o);}}.bind(this));}return this._oTablePromise;}e1.prototype._initializeTable=function(){if(this._oTable&&this._oTable.isA("sap.ui.table.Table")){this._oTable.setTitle(y.system.desktop?this._sTableTitleNoCount:null);if(this._bTableCreatedInternal){this._oTable.setSelectionBehavior(u.SelectionBehavior.Row);}this._oTable.setSelectionMode(this.getSupportMultiselect()?u.SelectionMode.MultiToggle:u.SelectionMode.Single);this._updateNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_PRESSSEARCH"));this._oTable.setVisibleRowCountMode(u.VisibleRowCountMode.Fixed);this._oTable.setMinAutoRowCount(y.system.desktop?5:4);this._oTable.attachRowSelectionChange(function(o){if(this._bIgnoreSelectionChange||!o.getParameter("userInteraction")){return;}var j={tableSelectionParams:o.mParameters,updateTokens:[],useDefault:false,table:this._oTable};if(this._hasListeners("selectionChange")){this._bIgnoreSelectionChange=true;this.fireSelectionChange(j);this._bIgnoreSelectionChange=false;j.updateTokens.forEach(function(r1){this._addRemoveTokenByKey(r1.sKey,r1.oRow,r1.bSelected);}.bind(this));}else{j.useDefault=true;}if(j.useDefault){var i1=o.getSource();var j1=i1.getBinding("rows");var k1=i1.getSelectedIndices();var l1=o.getParameter("rowIndices");var m1=o.getParameter("selectAll");var n1=j1.isLengthFinal?j1.isLengthFinal():true;var i,n=k1.length;var o1;var p1=0;if(n1){if(j1.aKeys){for(i=0;i<n;i++){o1=k1[i];if(!j1.aKeys[o1]){p1++;}}}}else if(m1){p1=99999999;}if(p1!==0){var q1=function(){j1.attachEventOnce("dataReceived",function(){if(m1){i1.selectAll();l1=i1.getSelectedIndices();}this._handleSelectionUpdateTokens(i1,l1);}.bind(this));if(m1){if(n1){j1.getContexts(0,n);}else{j1.getContexts(0,p1);}}else{j1.getContexts(l1[0],l1[l1.length-1]);}}.bind(this);if(p1<=400){q1();return;}else{M.show(this._oRb.getText("VALUEHELPDLG_SELECTIONFAILEDLOAD"),{icon:M.Icon.WARNING,title:this._oRb.getText("VALUEHELPDLG_SELECTIONFAILEDLOADTITLE"),actions:[M.Action.OK,M.Action.CANCEL],initialFocus:M.Action.CANCEL,styleClass:this.$().closest(".sapUiSizeCompact").length?"sapUiSizeCompact":"",onClose:function(r1){if(r1===M.Action.OK){q1();}else{this.update();}}.bind(this)});return;}}this._handleSelectionUpdateTokens(i1,l1);}this._updateTitles();if(!this.getSupportMultiselect()){this._bIgnoreSelectionChange=true;this._onCloseAndTakeOverValues();}}.bind(this));this._oTable.addStyleClass("compVHMainTable");if(!this._oTable.getParent()||!this._oTable.getParent().isA("sap.ui.comp.smarttable.SmartTable")){this._oTable.bindAggregation("columns","columns>/cols",function(i,o){var j,n,i1,j1=o.getProperty("tooltip");if(o.getProperty("type")==="string"){n={path:o.getProperty("template")};}if(o.getProperty("type")==="boolean"){j=new Q(i+"-control",{enabled:false,selected:{path:o.getProperty("template")}});}else{j=new g(i+"-control",{wrapping:false,text:{path:o.getProperty("template"),type:o.getProperty("oType")},tooltip:n});}if(this._oTable.isA("sap.ui.table.AnalyticalTable")){i1=new Y(i,{label:"{columns>label}",template:j,width:"{columns>width}",hAlign:j instanceof Q?b1.Center:b1.Begin,filterProperty:o.getProperty("filter")});}else{i1=new v(i,{label:"{columns>label}",template:j,width:"{columns>width}",hAlign:j instanceof Q?b1.Center:b1.Begin,sortProperty:o.getProperty("sort"),sorted:o.getProperty("sorted"),sortOrder:o.getProperty("sortOrder"),filterProperty:o.getProperty("filter")});}if(j1){i1.applySettings({tooltip:j1});}return i1;}.bind(this));}}else{this._oTable.setMode(this.getSupportMultiselect()?_.MultiSelect:_.SingleSelectLeft);this._oTable.setGrowing(true);this._oTable.attachSelectionChange(function(o){if(this._bIgnoreSelectionChange){return;}var j=o.mParameters;var i1={tableSelectionParams:o.mParameters,updateTokens:[],useDefault:false,table:this._oTable};if(this._hasListeners("selectionChange")){this._bIgnoreSelectionChange=true;this.fireSelectionChange(i1);this._bIgnoreSelectionChange=false;i1.updateTokens.forEach(function(o1){this._addRemoveTokenByKey(o1.sKey,o1.oRow,o1.bSelected);}.bind(this));}else{i1.useDefault=true;}if(i1.useDefault){var j1=j.selected;var i,n=j.listItems.length;for(i=0;i<n;i++){var k1=j.listItems[i];var l1=k1.getBindingContext();var m1=l1?l1.getObject():null;if(m1){var n1=m1[this.getKey()];if(!this.getSupportMultiselect()){this._oSelectedItems.removeAll();}this._addRemoveTokenByKey(n1,m1,j1);}}}if(!this.getSupportMultiselect()){this._onCloseAndTakeOverValues();}}.bind(this));if(!this._oTable.getParent()||!this._oTable.getParent().isA("sap.ui.comp.smarttable.SmartTable")){var e=0;this._oTable.bindAggregation("columns","columns>/cols",function(i,o){var j=o.getProperty("label");var n=this._oTable.getColumns().length>=2;e++;return new C(this._oTable.getId()+"-column"+e,{header:new h(this._oTable.getId()+"-column"+e+"-label",{text:j}),demandPopin:n,minScreenWidth:n?(this._oTable.getColumns().length+1)*10+"rem":"1px"});}.bind(this));}}};e1.prototype._handleSelectionUpdateTokens=function(o,e){var i,n=e.length;var j;var i1;var j1;var k1=false;if(o.getBinding("rows").aKeys){k1=true;}if(!this.getSupportMultiselect()){this._oSelectedItems.removeAll();}for(i=0;i<n;i++){j=e[i];i1=o.getContextByIndex(j);j1=i1?i1.getObject():null;if(j1){var l1;if(k1){l1=i1.sPath.substring(1);}else{l1=j1[this.getKey()];}this._addRemoveTokenByKey(l1,j1,o.isIndexSelected(j));}}};e1.prototype._addRemoveTokenByKey=function(i,o,j){try{i=decodeURIComponent(i);}catch(e){}if(j){this._oSelectedItems.add(i,o);this._addToken2Tokenizer(i,this._getFormatedTokenText(i),this._getTokenizer());}else{this._oSelectedItems.remove(i);this._removeTokenFromTokenizer(i,this._getTokenizer());}};e1.prototype._onCloseAndTakeOverValues=function(){var e=this;var j=function(){var n;var o=e._oSelectedItems.getSelectedItemsTokenArray(e.getKey(),e.getDescriptionKey(),e.getTokenDisplayBehaviour());if(e._oSelectedRanges){var i=0;for(var i1 in e._oSelectedRanges){n=e._oSelectedRanges[i1];var j1=n.tokenValue;if(!j1){j1=e._getFormatedRangeTokenText(n.operation,n.value1,n.value2,n.exclude,n.keyField);}if(!n._oGrid||n._oGrid.select.getSelected()){var k1=new T({key:"range_"+i}).data("range",{"exclude":n.exclude,"operation":n.operation,"keyField":n.keyField,"value1":n.value1,"value2":n.value2});k1.setText(j1);k1.setTooltip(typeof j1==="string"?j1:null);o.push(k1);i++;}}}e.fireOk({"tokens":o,"_tokensHaveChanged":e._bInitTokensHaveChanged});};this._validateRanges(j);};e1.prototype._onCancel=function(){this.fireCancel();};e1.prototype._onGo=function(){this._oFilterBar.search();};e1.prototype._onClear=function(){this._oFilterBar.clear();};e1.prototype._updateTitles=function(){this._updateTableTitle();this._updateTokenizer();this._updateTabSearchAndSelectTitle();this._updateTabRangesTitle();};e1.prototype._updateDlgTitle=function(){var e="";var i;if(this._oTitle){if(this._oTabBar&&!this._oTabBar.getVisible()&&!this.getFilterMode()){if(this._oTabBar.getSelectedKey()===d1.DESKTOP_LIST_VIEW){e="VALUEHELPDLG_TITLE";}else if(this._oTabBar.getSelectedKey()===d1.DESKTOP_CONDITIONS_VIEW){if(this.getMaxIncludeRanges()==="1"&&this.getMaxExcludeRanges()==="0"){e="VALUEHELPDLG_SINGLECONDITION_TITLE";}else{e="VALUEHELPDLG_RANGESTITLE";}}}else if(this._isPhone()&&!this.getFilterMode()){switch(this._currentViewMode){case d1.PHONE_MAIN_VIEW:e="";break;case d1.PHONE_LIST_VIEW:i=this._getTabSearchAndSelectText();break;case d1.PHONE_SEARCH_VIEW:e="FILTER_BAR_ADV_FILTERS_DIALOG";break;case d1.PHONE_CONDITIONS_VIEW:if(this.getMaxIncludeRanges()==="1"&&this.getMaxExcludeRanges()==="0"){e="VALUEHELPDLG_SINGLECONDITION_TITLE";}else{i=this._getTabRangesText();}break;default:break;}}if(!i){i=this.getTitle();}if(e){i=this._oRb.getText(e,i);}if(i){this._oTitle.setText(i);this._oFilterPanel&&this._oFilterPanel.setInnerTitle(this.getTitle());}}};e1.prototype._updateTableTitle=function(){if(!this._oTable){return;}var i=0;this.oRows=this._oTable.getBinding("rows");if(this.oRows){i=this.oRows.getLength();}if(!this._oNumberFormatInstance){this._oNumberFormatInstance=W.getFloatInstance();}if(i>0&&this.oRows.isLengthFinal&&this.oRows.isLengthFinal()){var e=this._oNumberFormatInstance.format(i);this._setTableTitle(this._sTableTitle1.replace("{0}",e));}else{this._setTableTitle(this._sTableTitleNoCount);}};e1.prototype._getTabSearchAndSelectText=function(){var o=this._oTable;if(o){if(o.isA("sap.ui.comp.smarttable.SmartTable")){o=o.getTable();}var n=0;if(o.getSelectedIndices){n=o.getSelectedIndices().length;}else if(o.getSelectedItems){n=o.getSelectedItems().length;}if(n>0){return this._oRb.getText("VALUEHELPDLG_ITEMSTABLE_SELECT",[n]);}}return this._oRb.getText("VALUEHELPDLG_ITEMSTABLE_SELECT").replace("({0})","");};e1.prototype._getTabRangesText=function(){if(this._oSelectedRanges&&Object.keys(this._oSelectedRanges).length>0){var n=Object.keys(this._oSelectedRanges).length;return this._oRb.getText("VALUEHELPDLG_RANGES",[n]);}return this._oRb.getText("VALUEHELPDLG_RANGES").replace("({0})","");};e1.prototype._updateTabSearchAndSelectTitle=function(){var e=!this.getSupportRangesOnly();if(e){if(this._oTabBar){this._oTabBar.getItems()[0].setText(this._getTabSearchAndSelectText());}if(this._oMainListMenu&&this._oSelectItemLI){this._oSelectItemLI.setTitle(this._getTabSearchAndSelectText());}}};e1.prototype._updateTabRangesTitle=function(){var e=this.getSupportRangesOnly()||this.getSupportRanges();if(e){if(this._oTabBar){this._oTabBar.getItems()[1].setText(this._getTabRangesText());}if(this._oMainListMenu&&this._oDefineConditionsLI){this._oDefineConditionsLI.setTitle(this._getTabRangesText());}}};e1.prototype._setTableTitle=function(e){if(y.system.desktop&&this._oTable&&!(this._oTable.isA("sap.m.Table"))){if(this._oTable.getTitle()){this._oTable.getTitle().setText(e);}else{this._oTable.setTitle(e);}}else{this._oTable.addStyleClass("compValueHelpSmallMarginTop");}};e1.prototype.onAfterRendering=function(){D.prototype.onAfterRendering.apply(this);if(this._oTable){this._updateTitles();}if(!this._isPhone()&&this.getContentHeight()===""){if(this.getSupportRangesOnly()&&(this.getMaxExcludeRanges()==="-1"||this.getMaxIncludeRanges()==="-1")){this.setContentHeight("70%");}else{var o=this.getDomRef("scroll");var e=o.clientHeight;this.setContentHeight(e+"px");}if(this._oTable&&this._oTable.isA("sap.ui.table.Table")){this._oTable.setVisibleRowCountMode(u.VisibleRowCountMode.Auto);}}this._bInitTokensHaveChanged=false;this._registerResizeHandler();};e1.prototype.onsapbackspace=function(e){if(this._ignoreRemoveToken||!e.srcControl||!e.srcControl.isA("sap.m.Token")){return;}var j=e.srcControl.getKey?e.srcControl.getKey():"",n=[];if((e.type==="sapbackspace"||e.type==="sapdelete")&&j){if(this._oSelectedRanges&&this._oSelectedRanges[j]){n.push(j);this._removeToken(j);}else{this._oSelectedItems.remove(j);this._removeTokenFromTokenizer(j,this._getTokenizer());}}this._removeRangeByKey(n);var o={tokenKeys:[j],useDefault:false};if(this._hasListeners("tokenRemove")){this._bIgnoreSelectionChange=true;this.fireTokenRemove(o);this._bIgnoreSelectionChange=false;}else{o.useDefault=true;}if(o.useDefault){this._changeTableRowSelectionForKey(j,false);}setTimeout(function(){var i1=this._getTokenizer().getTokens();if(i1){var i=i1.length-1;if(i>=0){i1[i].focus();}else{this._manageFocusAfterRemoveTokens();}}}.bind(this));this._updateTitles();};e1.prototype.onsapdelete=e1.prototype.onsapbackspace;e1.prototype._getDialogOffset=function(e){var i=e||this._$Window.width();var j={small:600,large:1024};var n=function(o){var i1=parseInt(window.getComputedStyle(document.body).fontSize);return(o*i1)*2;};var o=1;if(i>j.small&&i<j.large){o=2;}else if(i>=j.large){o=2;}return{top:n(o),left:n(o)};};e1.prototype.exit=function(){D.prototype.exit.apply(this);if(typeof this._fnRejectTablePromise==="function"){this._fnRejectTablePromise();}this.removeDelegate(this._onBeforeRenderingInputEventDelegate);var e=function(o){if(o&&o.destroy){o.destroy();}return null;};this._oTokenizerGrid=e(this._oTokenizerGrid);this._oRanges=e(this._oRanges);this._oFilterPanel=e(this._oFilterPanel);if(this._bTableCreatedInternal){this._oTable=e(this._oTable);}this._oTable=null;this.theTable=null;this._oNumberFormatInstance=null;this._oTabBar=e(this._oTabBar);this._oMainListMenu=e(this._oMainListMenu);this._oContentContainer=e(this._oContentContainer);this._oVarManagment=e(this._oVarManagment);this._aRangeKeyFields=e(this._aRangeKeyFields);this._aIncludeRangeOperations=e(this._aIncludeRangeOperations);this._aExcludeRangeOperations=e(this._aExcludeRangeOperations);if(this._oFilterBar){this._oFilterBar.detachInitialise(this._handleFilterBarInitialize);this._oFilterBar=e(this._oFilterBar);}this._oRb=e(this._oRb);this._sTableTitle1=e(this._sTableTitle1);this._sTableTitle2=e(this._sTableTitle2);this._sTableTitleNoCount=e(this._sTableTitleNoCount);this._sValidationDialogTitle=e(this._sValidationDialogTitle);this._sValidationDialogMessage=e(this._sValidationDialogMessage);this._sValidationDialogFieldMessage=e(this._sValidationDialogFieldMessage);this._oSelectedItems=e(this._oSelectedItems);this._oSelectedRanges=e(this._oSelectedRanges);this._oButtonOk=e(this._oButtonOk);this._oButtonCancel=e(this._oButtonCancel);if(this._oButtonGo){this._oButtonGo=e(this._oButtonGo);}if(this._oButtonClear){this._oButtonClear=e(this._oButtonClear);}if(this._oColSearchBox){this._oColSearchBox=e(this._oColSearchBox);}};e1.prototype.setRangeKeyFields=function(e){this._aRangeKeyFields=e;if(this._aRangeKeyFields){this._aRangeKeyFields.some(function(i){if(i.typeInstance&&i.typeInstance.isA("sap.ui.model.odata.type.DateTime")){var o=i.typeInstance;if(!o.oFormat){o.formatValue(new Date(),"string");}if(o.oFormat){o.oFormat.oFormatOptions.UTC=false;}}});}};e1.prototype.getRangeKeyFields=function(){return this._aRangeKeyFields;};e1.prototype.setIncludeRangeOperations=function(o,e){e=e||"default";this._aIncludeRangeOperations[e]=o;if(this._oFilterPanel){this._oFilterPanel.setIncludeOperations(this._aIncludeRangeOperations[e],e);}};e1.prototype.setExcludeRangeOperations=function(o,e){e=e||"default";this._aExcludeRangeOperations[e]=o.map(function(i){return this._oOperationsHelper.getCorrespondingExcludeOperation(i);}.bind(this));if(this._oFilterPanel){this._oFilterPanel.setExcludeOperations(this._aExcludeRangeOperations[e],e);}};e1.prototype._getFormatedTokenText=function(e){var i=this._oSelectedItems.getItem(e);var j=i[this.getDescriptionKey()];var n=i[this.getKey()];if(j===undefined){if(typeof i==="string"){j=i;}else{j=e;}}else{j=a.getFormattedExpressionFromDisplayBehaviour(this.getTokenDisplayBehaviour()?this.getTokenDisplayBehaviour():c1.descriptionAndId,n,j);}return j;};e1.prototype._getFormatedRangeTokenText=function(o,e,i,j,n){var i1=this._getKeyFieldByKey(n);var j1=e;var k1=i;var l1=true;if(i1){if(!i1.typeInstance&&J._createKeyFieldTypeInstance){J._createKeyFieldTypeInstance(i1);}if(i1.typeInstance){j1=i1.typeInstance.formatValue(e,"string",l1);k1=i1.typeInstance.formatValue(i,"string",l1);}}var m1=a.getFormattedRangeText(o,j1,k1,j);if(this._aRangeKeyFields&&this._aRangeKeyFields.length>1&&i1&&i1.label&&m1!==""){m1=i1.label+": "+m1;}return m1;};e1.prototype._isPhone=function(){return y.system.phone;};e1.prototype._hasListeners=function(e){if(this._bTableCreatedInternal){return false;}return this.hasListeners(e);};e1.prototype._rotateSelectionButtonIcon=function(e){if(!y.system.phone){var o=sap.ui.getCore().byId(this.oSelectionButton.$("img")[0].id);if(e){o.addStyleClass("sapUiVHImageExpand");}else{o.removeStyleClass("sapUiVHImageExpand");}}};e1.prototype._getTokenizer=function(){return this._oSelectedTokens;};e1.prototype._getTabSearchAndSelect=function(){var e=!this.getSupportRangesOnly();if(e){if(this._oTabBar){return this._oTabBar.getItems()[0];}if(this._oMainListMenu&&this._oSelectItemLI){return this._oSelectItemLI;}}return null;};e1.prototype._getTabDefneConditions=function(){var e=this.getSupportRangesOnly()||this.getSupportRanges();if(e){if(this._oTabBar){return this._oTabBar.getItems()[1];}if(this._oMainListMenu&&this._oDefineConditionsLI){return this._oDefineConditionsLI;}}return null;};e1.prototype._registerResizeHandler=function(){D.prototype._registerResizeHandler.apply(this,arguments);X.register(this,this._onResize.bind(this));};e1.prototype._onResize=function(){D.prototype._onResize.apply(this,arguments);this._setToolbarSpacerWidth();};e1.prototype._setToolbarSpacerWidth=function(){var o,e,j;if(!this._oFilterBar){return;}if(this._oFilterBar._oToolbar){e=this._oFilterBar._oToolbar.getContent();for(var i=0;i<e.length;i++){if(e[i].isA("sap.m.ToolbarSpacer")){o=e[i];break;}}}if(o&&this._oFilterBar.getBasicSearch()){j=this.getDomRef()&&parseInt(this.getDomRef().style.width);if(j>=1000){o.setWidth("6rem");}else if(j<1000&&j>700){o.setWidth("4rem");}else{o.setWidth("0.5rem");}}};e1.prototype._manageFocusAfterRemoveTokens=function(){var o,e=this._oFilterPanel?this._oFilterPanel.getConditionPanel():undefined;if(this._currentViewMode.toLowerCase().indexOf("list")>-1){this._oButtonOk.focus();}else{this._onAfterRenderingInputDelegate={onAfterRendering:function(){o.focus();}};this._onBeforeRenderingInputEventDelegate={onBeforeRendering:function(){if(o.getDomRef()){o.removeDelegate(this._onAfterRenderingInputDelegate,this);}}};o=e._oConditionsGrid.getAggregation("content")[0].value1;o.addDelegate(this._onAfterRenderingInputDelegate,this);o.addDelegate(this._onBeforeRenderingInputEventDelegate,this);o.focus();}};function g1(e,i){if(!i){i=this.getKey();}e=e.replace(/[^a-zA-Z0-9]/g,"");i=i.replace(/[^a-zA-Z0-9]/g,"");var j=i?i+"-"+e:e;if(!this._oTokenIdCount[j]){this._oTokenIdCount[j]=0;}this._oTokenIdCount[j]++;return this.getId()+"-token-"+j+"_"+this._oTokenIdCount[j];}function h1(e){if(e){var i=e.getItems();return i[0].getVisible()&&i[1].getVisible();}else{return false;}}return e1;});
