/*
 * ! SAPUI5
 * (c) Copyright 2009-2021 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/core/format/NumberFormat","sap/ui/core/format/DateFormat","sap/m/P13nConditionPanel","sap/ui/comp/odata/ODataType","sap/ui/model/odata/type/Currency","sap/ui/model/odata/type/Unit"],function(N,D,P,O,C,U){"use strict";var F={CHAR_FIGURE_SPACE:'\u2007',CHAR_PUNCTUATION_SPACE:'\u2008',MAX_CURRENCY_DIGITS:3,getFormattedExpressionFromDisplayBehaviour:function(d,i,s){return F.getFormatterFunctionFromDisplayBehaviour(d)(i,s);},getFormatterFunctionFromDisplayBehaviour:function(d){switch(d){case"descriptionAndId":return F._getTextFormatterForDescriptionAndId;case"idAndDescription":return F._getTextFormatterForIdAndDescription;case"descriptionOnly":return F._getTextFormatterForDescriptionOnly;default:return F._getTextFormatterForIdOnly;}},_processText:function(t,p){if(p){return t;}return t.secondText?t.firstText+" ("+t.secondText+")":t.firstText;},_getTextFormatterForDescriptionAndId:function(i,d,p){return F._processText({firstText:d?d:i,secondText:d?i:undefined},p);},_getTextFormatterForIdAndDescription:function(i,d,p){return F._processText({firstText:i,secondText:d?d:undefined},p);},_getTextFormatterForDescriptionOnly:function(i,d,p){return F._processText({firstText:d,secondText:undefined},p);},_getTextFormatterForIdOnly:function(i,d,p){return F._processText({firstText:i,secondText:undefined},p);},getTextsFromDisplayBehaviour:function(d,i,s){return F.getFormatterFunctionFromDisplayBehaviour(d)(i,s,true);},getFormattedRangeText:function(o,v,V,e){return P.getFormatedConditionText(o,v,V,e);},_initialiseCurrencyFormatter:function(){if(!F._oCurrencyFormatter){F._oCurrencyFormatter=N.getCurrencyInstance({showMeasure:false});}if(!F._fAmountCurrencyFormatter){F._fAmountCurrencyFormatter=function(a,c){var v,i;v=F._oCurrencyFormatter.format(a,c);i=F._oCurrencyFormatter.oLocaleData.getCurrencyDigits(c);return F._applyPadding(v,i,F.MAX_CURRENCY_DIGITS);};}},_initialiseUnitFormatter:function(){if(!F._oUnitFormatter){F._oUnitFormatter=N.getUnitInstance({showMeasure:false,maxFractionDigits:3,minFractionDigits:3});}if(!F._fMeasureUnitFormatter){F._fMeasureUnitFormatter=function(v,u){return F._oUnitFormatter.format(v,u);};}},_applyPadding:function(v,s,m){var p;if(typeof v!=="string"){return"";}if(s===0){v+=F.CHAR_PUNCTUATION_SPACE;}p=m-s;if(p){v=v.padEnd(v.length+p,F.CHAR_FIGURE_SPACE);}return v;},_getFractionDigitDifference:function(t,v,f,m){if(!v){return 0;}var d=v.indexOf(t.oOutputFormat.oFormatOptions.decimalSeparator);if(d<0){return 0;}var i=v.substr(d+1).length;if(i<=m&&i>f){return i-f;}if(i>m&&f<m){return m-f;}return 0;},getAmountCurrencyFormatter:function(p){var m=0,c,a;F._initialiseCurrencyFormatter();return function(A,s,b){var v,i;if(A===undefined||A===null||s==="*"){return"";}if(!b){return F._fAmountCurrencyFormatter(A,s);}if(!a){a=b;m=F._getMaxCurrencyFractionDigits(a);if(!c){c=F._getCurrencyInstance(p);}}i=a&&a[s]?a[s].UnitSpecificScale:F._oCurrencyFormatter.oLocaleData.getCurrencyDigits(s);v=c.formatValue([A,s||null,a],"string");if(p){i+=F._getFractionDigitDifference(c,v,i,m);}return F._applyPadding(v,i,m);};},_getMaxCurrencyFractionDigits:function(c){var m=0;for(var e in c){if(c[e].UnitSpecificScale&&c[e].UnitSpecificScale>m){m=c[e].UnitSpecificScale;}}return m;},_getCurrencyInstance:function(p){return new C({showMeasure:false,preserveDecimals:p});},getCurrencySymbolFormatter:function(){F._initialiseCurrencyFormatter();if(!F._fCurrencySymbolFormatter){F._fCurrencySymbolFormatter=function(c){if(!c||c==="*"){return"";}return F._oCurrencyFormatter.oLocaleData.getCurrencySymbol(c);};}return F._fCurrencySymbolFormatter;},getMeasureUnitFormatter:function(p){F._initialiseUnitFormatter();var m=0,u,c;return function(v,s,a){if(v===undefined||v===null||s==="*"){return"";}if(a){if(!c){c=a;m=F._getMaxMeasureUnitFractionDigit(c);if(!u){u=F._getUnitInstance(p,m);}}v=u.formatValue([v,s,c],"string");var i=c[s]&&c[s].UnitSpecificScale!=null?c[s].UnitSpecificScale:m;if(p){i+=F._getFractionDigitDifference(u,v,i,m);}return F._applyPadding(v,i,(m||3));}return F._fMeasureUnitFormatter(v,s)+F.CHAR_FIGURE_SPACE;};},getInlineMeasureUnitFormatter:function(p){var m=0,u,c;if(!F._fInlineMeasureFormatter){F._fInlineMeasureFormatter=function(v,s){if(v===undefined||v===null||s==="*"){return"";}if(!s){return v;}return v+F.CHAR_FIGURE_SPACE+s;};}return function(v,s,a){if(a){if(!c){c=a;m=F._getMaxMeasureUnitFractionDigit(c);if(!u){u=F._getUnitInstance(p,m);}}v=u.formatValue([v,s,c],"string");return v+F.CHAR_FIGURE_SPACE+s;}return F._fInlineMeasureFormatter(v,s);};},_getUnitInstance:function(p,m){return new U({showMeasure:false,preserveDecimals:p,maxFractionDigits:m});},_getMaxMeasureUnitFractionDigit:function(c){var m=0;for(var e in c){var u=c[e].UnitSpecificScale;if(u>3){c[e].UnitSpecificScale=3;u=3;}if(m<3&&u>m&&u<=3){m=u;}}return m;},getInlineAmountFormatter:function(p){var c,m;F._initialiseCurrencyFormatter();if(!F._fInlineAmountFormatter){F._fInlineAmountFormatter=function(a,s){var v;if(a===undefined||a===null||s==="*"){return"";}v=F._oCurrencyFormatter.format(a,s);return v+F.CHAR_FIGURE_SPACE+s;};}return function(a,s,b){if(a===undefined||a===null||s==="*"){return"";}if(!b){return F._fInlineAmountFormatter(a,s);}if(!m){m=b;if(!c){c=F._getCurrencyInstance(p);}}var v=c.formatValue([a,s||null,m],"string");return v+F.CHAR_FIGURE_SPACE+s;};},getInlineGroupFormatterFunction:function(f,d,o,p){var i,r=f.type==="Edm.String"&&!f.isCalendarDate&&!f.isDigitSequence;if(f.unit){if(f.isCurrencyField){return F.getInlineAmountFormatter(p);}else{i=F.getInlineMeasureUnitFormatter(p);return function(v,u){var V=v;if(f.modelType){V=f.modelType.formatValue(v,"string");}return i(V,u);};}}else if(!d&&r&&f.description){return F.getFormatterFunctionFromDisplayBehaviour(f.displayBehaviour);}else if(f.type==="Edm.DateTime"&&f.displayFormat==="Date"&&o&&o["UTC"]){var c={displayFormat:"Date"};var s={isCalendarDate:f.isCalendarDate};var a=O.getType(f.type,o,c,s);return function(v){return a.formatValue(v,"string");};}else if(f.modelType){return function(v){return f.modelType.formatValue(v,"string");};}},getWidth:function(f,m,M){var w=f.maxLength||f.precision,W,i;if(!m){m=30;}if(!M){M=3;i=true;}if(f.type==="Edm.DateTime"&&f.displayFormat==="Date"||f.isCalendarDate){w="9em";}else if(w){if(f.type==="Edm.String"&&f.description&&f.displayBehaviour&&(f.displayBehaviour==="descriptionAndId"||f.displayBehaviour==="descriptionOnly")){w="Max";}if(w==="Max"){w=m+"";}W=parseInt(w);if(!isNaN(W)){W+=0.75;if(W>m){W=m;}else if(W<M){W=M;}w=W+"em";}else{w=null;}}if(!w){if(f.type==="Edm.Boolean"){if(i){M+=0.25;}w=M+"em";}else{w=m+"em";}}return w;},getEdmTimeFromDate:function(d){if(!F._oTimeFormat){F._oTimeFormat=D.getTimeInstance({pattern:"'PT'HH'H'mm'M'ss'S'"});}return F._oTimeFormat.format(d);},parseFilterNumericIntervalData:function(v){var r=[],R=v.match(RegExp("^(-?[^-]*)-(-?[^-]*)$"));if(R&&R.length>=2){r.push(R[1]);r.push(R[2]);}return r;},parseDateTimeOffsetInterval:function(v){var V=v.split('-'),r=[v],n=0;if((V.length%2)===0){r=[];for(var i=0;i<V.length/2;i++){n=v.indexOf('-',++n);}r.push(v.substr(0,n).replace(/\s+/g,''));r.push(v.substr(n+1).replace(/\s+/g,''));}return r;},_getFilterType:function(f){if(f.isFiscalDate){return"date";}else if(f.isDigitSequence){return"numc";}else if(O.isNumeric(f.type)){return"numeric";}else if(f.type==="Edm.DateTime"&&f.displayFormat==="Date"){return"date";}else if(f.type==="Edm.DateTimeOffset"){return"datetime";}else if(f.type==="Edm.String"){if(f.isCalendarDate){return"stringdate";}return"string";}else if(f.type==="Edm.Boolean"){return"boolean";}else if(f.type==="Edm.Time"){return"time";}return undefined;}};return F;},true);
