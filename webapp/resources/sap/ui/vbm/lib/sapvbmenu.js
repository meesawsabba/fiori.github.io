/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
sap.ui.define(["sap/ui/unified/Menu","sap/ui/unified/MenuItem","./sapvbi"],function(M,a){"use strict";VBI.Menus=function(){var m={};m.m_menus=[];m.clear=function(){for(var n=m.m_menus.length-1;n>=0;--n){m.m_menus[n].destroy();m.m_menus.pop();}m.m_menus=[];};m.loadMainMenu=function(d,c){var o=new M();m.loadMenu(o,d,c,o.getId());o.vbi_data={};o.vbi_data.menuRef=d.id;o.vbi_data.VBIName=d.name;o.attachItemSelect(function(e){var r={};r.refid=e.mParameters.item.vbi_data.refid;r.menu=o;m.OnSelected(r);});m.m_menus.push(o);return o;};m.loadMenu=function(o,d,c,i){var b=jQuery.type(d.MenuItem)=='object';var e=(b?1:d.MenuItem.length);for(var f=0;f<e;++f){var s=(b?d.MenuItem:d.MenuItem[f]);if(s.active=="false"){continue;}var g;g=i+"_"+f;var t=s.Separator==undefined?s.text:"---------------------------";var h=new a("vbimi_"+g,{text:t});h.vbi_data={};if((s.disabled=="true")||(s.Separator!=undefined)){h.setEnabled(false);}o.addItem(h);if(s.icon){h.setIcon(s.icon);}if(VBI.m_bTrace){VBI.Trace("Adding Menuitem: menuitem_"+g+" with text "+t);}if(s.MenuItem!=undefined){var S=new M("vbim_"+g);h.setSubmenu(S);m.loadMenu(S,s,c,g);}else if(s.id!=""){h.vbi_data.refid=s.id;}}};m.deleteMenu=function(b){var i=m.findMenuIdxByName(b);if(i>=0){var l=m.m_menus.length-1;m.m_menus[i].destroy();if(i!=l){m.m_menus[i]=m.m_menus[l];}m.m_menus.pop();return i;}return-1;};m.getMainScene=function(c){if(c.m_SceneManager.m_SceneArray.length==1){return c.m_SceneManager.m_SceneArray[0].m_ID;}return undefined;};m.load=function(d,c){sap.ui.getCore().loadLibrary("sap.ui.unified");m.m_context=c;if(d.Set){if(d.Set.name!=undefined){m.deleteMenu(d.Set.name);}else{m.clear();}if(jQuery.type(d.Set)=='object'){if(d.Set.Menu){m.loadMainMenu(d.Set.Menu,c);}}else if(jQuery.type(d.Set)=='array'){for(var n=0;n<d.Set.length;++n){if(d.Set[n].Menu){m.loadMainMenu(d.Set[n].Menu,c);}}}}};m.findMenuByID=function(b){if(m.m_menus){for(var i=0;i<m.m_menus.length;++i){if(m.m_menus[i].vbi_data.menuRef==b){return m.m_menus[i];}}}return null;};m.findMenuIdxByName=function(b){if(m.m_menus){for(var i=0;i<m.m_menus.length;++i){if(m.m_menus[i].vbi_data.VBIName==b){return i;}}}return-1;};m.OnSelected=function(r){var b=r.menu.vbi_data.object;if(r.refid==undefined){return;}var s=m.m_context.m_SceneManager.GetSceneByName(r.menu.vbi_data.scene);var c=m.m_context.m_Actions;if(c){if(c.findAction("ContextMenu",s,b)){var d=new VBI.Actions.Action();d.m_name="FCODE_SELECT";d.m_id=r.refid;s.m_Ctx.FireAction(d,s,b,null,null,r.menu.vbi_data.instance);}}};return m;};});
