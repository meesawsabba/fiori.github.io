/*!
 * (c) Copyright 2010-2019 SAP SE or an SAP affiliate company.
 */
sap.ui.define(["jquery.sap.global","sap/zen/crosstab/utils/Utils"],function(q,U){"use strict";q.sap.declare("sap.zen.crosstab.ColResizer");sap.zen.crosstab.ColResizer=function(c){var t=this;var d=c.getDataArea();var r=c.getRowHeaderArea();var R=null;var o=null;var a=null;var j=null;var J=null;var b=null;var m=0;var i=0;var f=false;var u;var I=false;this.initialize=function(){u=c.getUtils();I=c.getPropertyBag().isRtl();J=c.getTableDiv();b=c.getRenderSizeDiv();a=u.getRtlAwareBoundingClientRect(b[0]);j=q(document.getElementById(c.getId()+"_colResizeRuler"));this.attachEvents();};this.attachEvents=function(){J.unbind("dblclick");J.bind("dblclick",this.onDoubleClick);j.unbind("mousemove",this.onMouseMove);j.bind("mousemove",this.onMouseMove);var e=J.find(".sapzencrosstab-columnResizeHandleWithSort, .sapzencrosstab-columnResizeHandle");q.each(e,function(g,D){var h=q(D);h.unbind("mousedown",t.onMouseDown);h.bind("mousedown",t.onMouseDown);h.unbind("mouseup",t.executeonMouseUp);h.bind("mouseup",t.executeonMouseUp);h.unbind("mousemove",t.onMouseMove);h.bind("mousemove",t.onMouseMove);});};this.onDoubleClick=function(e){t.determineResizeCell(e,true);if(R){t.resizeCol(R,-1);R=null;U.cancelEvent(e);}};this.onMouseUp=function(e){var n;if(R&&o){n=t.calculateNewColWidth(e);if(n>0){t.resizeCol(R,n);}R=null;o=null;j.css("visibility","hidden");f=false;q(document).off("mouseup",t.onMouseUp);U.cancelEvent(e);}};this.onMouseDown=function(e){if(!R){t.determineResizeCell(e);if(R){o=u.getRtlAwareBoundingClientRect(document.getElementById(R.getId()));m=e.clientX;j.outerHeight(b.outerHeight());i=o.end-j.outerWidth()-a.begin;j.css(I?"right":"left",i+"px");q(document).on("mouseup",t.onMouseUp);U.cancelEvent(e);}}};this.onMouseMove=function(e){var C;if(R&&o){C=i+t.getDelta(e);if(C!==i){C=Math.max(C,(o.begin-a.begin));if(!f){j.css("visibility","visible");f=true;}j.css(I?"right":"left",C+"px");}U.cancelEvent(e);}};this.isResizeAction=function(){if(R&&o){return true;}return false;};this.determineResizeCell=function(e,g){var l;var A;R=sap.ui.getCore().byId(e.target.id.slice(5));if(!g&&R.getColSpan()>1){l=R.getCol()+R.getColSpan()-1;A=R.getArea();R=A.getCellWithColSpan(A.getRowCnt()-1,l);if(!R){R=A.getCellWithRowSpan(A.getRowCnt()-1,l);}}};this.calculateNewColWidth=function(e){var D;var n=-1;if(R&&o){D=t.getDelta(e);if(D!==0){n=o.width+D;n=Math.max(1,n);}}return n;};this.getDelta=function(e){if(I){return(m-e.clientX);}else{return(e.clientX-m);}};this.resizeCol=function(C,w){var e=C.getArea();if(e.isColHeaderArea()){this.setColWidths(C,e,d,w);}else if(e.isDimHeaderArea()){this.setColWidths(C,e,r,w);}this.sendUpdateColWidthCommand(C,w);c.invalidate();};this.setColWidths=function(C,e,l,w){var E;var g;var h;E=C.getCol()+C.getColSpan()-1;if(w>0){e.setColWidth(E,w);e.setUserResizedCol(E);l.setColWidth(E,w);l.setUserResizedCol(E);}else{g=0;h=C.getCol()+C.getColSpan()-C.getEffectiveColSpan();for(g=E;g>=h;g--){e.resetColWidth(g);l.resetColWidth(g);e.setUserResizedCol(g);l.setUserResizedCol(g);}}};this.sendUpdateColWidthCommand=function(C,w){var s=c.getUpdateColWidthCommand();if(s!=null&&s.length>0){var T=C.getTableCol();s=s.replace("__COL__",T);s=s.replace("__WIDTH__",Math.round(w));var A=new Function(s);A();}};};return sap.zen.crosstab.ColResizer;});
