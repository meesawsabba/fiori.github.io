/*!
 * (c) Copyright 2010-2019 SAP SE or an SAP affiliate company.
 */
sap.ui.define(["jquery.sap.global","sap/zen/crosstab/utils/Measuring","sap/zen/crosstab/utils/Utils"],function(q,M,U){"use strict";q.sap.declare("sap.zen.crosstab.rendering.ScrollbarRenderer");sap.zen.crosstab.rendering.ScrollbarRenderer=function(c,r,m,d){var s=0;var h=false;var v=false;var H=false;var o=null;var V=null;var a=null;var i=c.getPropertyBag().isPixelScrolling();function w(e){r.write("<div");r.writeAttributeEscaped("id",c.getId()+"_upperRightPad");r.writeAttribute("class","sapzencrosstab-UpperRightScrollPad");r.addStyle("width",s+"px");r.addStyle("height",e+"px");r.writeStyles();r.write(">");r.write("</div>");}function b(S,e){var A=null;var I=0;var B=0;if(!c.getVScrollbar()){A=new sap.ui.core.ScrollBar();c.setVScrollbar(A);}A=c.getVScrollbar();A.setVertical(true);if(H===true&&!h){I=q(document.getElementById(c.getId()+"_renderSizeDiv")).outerHeight()-s;}else{I=S;}B=I-e;A.setSize(B+"px");r.renderControl(A);}function f(){r.write("<td");r.writeAttribute("class","sapzencrosstab-VScrollCell");r.write(">");}function g(S){var e=m.getUpperScrollDivHeight();r.write("<table");r.writeAttributeEscaped("id",c.getId()+"_vScrollTab");r.writeAttribute("class","sapzencrosstab-VScrollTable");r.write(">");r.write("<tr>");f();w(e);r.write("</td>");r.write("</tr>");r.write("<tr>");f();b(S,e);r.write("</td>");r.write("</tr>");r.write("</table>");}function j(){r.write("<div");r.writeAttributeEscaped("id",c.getId()+"_vScrollDiv");r.addStyle("position","absolute");r.addStyle("top","0px");r.addStyle(c.getPropertyBag().isRtl()?"left":"right","0px");r.addStyle("width",s+"px");var e=m.getRenderSizeDivSize().iHeight;if(h){e=Math.min(c.getContentHeight()-s,e);}r.addStyle("height",e+"px");r.writeStyles();r.write(">");g(e);r.write("</div>");}function k(){var W=0;var D=q(document.getElementById(c.getId()+"_upperLeft_scrollDiv"));var e=c.getUtils();var P=c.getPropertyBag();if(D.length>0){W=e.isMsIE()||(P.isRtl()&&e.isMozilla())?D.width():D.outerWidth();}if(W===0){D=q(document.getElementById(c.getId()+"_lowerLeft_scrollDiv"));W=e.isMsIE()||(P.isRtl()&&e.isMozilla())?D.width():D.outerWidth();}return W;}function l(L){if(!H){r.write("<div");r.writeAttributeEscaped("id",c.getId()+"_lowerLeftPad");r.writeAttribute("class","sapzencrosstab-LowerLeftScrollPad");r.addStyle("width",L+"px");r.addStyle("height",s+"px");r.writeStyles();r.write(">");r.write("</div>");}else{var e=null;if(!c.getHorizontalHeaderScrollbar()){e=new sap.ui.core.ScrollBar();c.setHorizontalHeaderScrollbar(e);}e=c.getHorizontalHeaderScrollbar();e.setVertical(false);var A=k();e.setSize(A+"px");r.renderControl(e);}}function n(H){if(H===true){r.write("<td");r.writeAttributeEscaped("id",c.getId()+"_hScrollTableCell");r.writeAttribute("class","sapzencrosstab-HScrollCell sapzencrosstab-HScrollCellWithHeaderScrollRightBorder");}else{r.write("<td");r.writeAttribute("class","sapzencrosstab-HScrollCell");}r.write(">");}function p(){r.write("<div");r.writeAttributeEscaped("id",c.getId()+"_lowerRightPad");r.writeAttribute("class","sapzencrosstab-LowerRightScrollPad");r.addStyle("width",s+"px");r.addStyle("height",s+"px");r.writeStyles();r.write(">");r.write("</div>");}function t(S,L){if(h===true){var e=null;if(!c.getHScrollbar()){e=new sap.ui.core.ScrollBar();c.setHScrollbar(e);}e=c.getHScrollbar();e.setVertical(false);e.setSize((S-L-(v?s:0))+"px");r.renderControl(e);}else{r.write("<div");r.writeAttributeEscaped("id",c.getId()+"_lowerMiddlePad");r.writeAttribute("class","sapzencrosstab-LowerMiddleScrollPad");r.addStyle("width",(S-L-(v?s:0))+"px");r.addStyle("height",s+"px");r.writeStyles();r.write(">");r.write("</div>");}}function u(){var D=q(document.getElementById(c.getId()+"_lowerLeft"));var L=D.outerWidth();r.write("<table");r.writeAttributeEscaped("id",c.getId()+"_hScrollTab");r.writeAttribute("class","sapzencrosstab-HScrollTable");r.write(">");r.write("<tr>");n(H);l(L);r.write("</td>");var S=c.getContentWidth();n();t(S,L);r.write("</td>");if(v){n();p();r.write("</td>");}r.write("</tr>");r.write("</table>");}function x(){r.write("<div");r.writeAttributeEscaped("id",c.getId()+"_hScrollDiv");r.addStyle("position","absolute");var T=c.getPropertyBag().getToolbarHeight();r.addStyle("bottom",T+"px");r.addStyle("height",s+"px");var W=c.getContentWidth();r.addStyle("width",W+"px");r.addStyle("height",s+"px");r.writeStyles();r.write(">");u(W);r.write("</div>");}this.renderScrollbars=function(S){h=S.bHasHScrollbar;v=S.bHasVScrollbar;H=S.bHasHHeaderScrollbar;if(h||v||H){s=m.getBrowserScrollbarWidth();if(s===0){if(v){var e=new sap.ui.core.ScrollBar();c.setVScrollbar(e);}if(h){var A=new sap.ui.core.ScrollBar();c.setHScrollbar(A);}if(H){var B=new sap.ui.core.ScrollBar();c.setHorizontalHeaderScrollbar(B);}}else{var T=d.getElement(c.getId());var I=T.html();if(v){j();}if(h||H){x();}r.write(I);r.flush(T[0]);}}};this.attachHandlers=function(e,A,B){this.detachHandlers();o=e;V=A;a=B;if(o&&c.getHScrollbar()){c.getHScrollbar().attachScroll(o);c.getHScrollbar().attachBrowserEvent("mousedown touchstart",U.cancelEvent);}if(V&&c.getVScrollbar()){c.getVScrollbar().attachScroll(V);c.getVScrollbar().attachBrowserEvent("mousedown touchstart",U.cancelEvent);this.attachMouseWheelHandler();}if(a&&c.getHorizontalHeaderScrollbar()){c.getHorizontalHeaderScrollbar().attachScroll(a);c.getHorizontalHeaderScrollbar().attachBrowserEvent("mousedown touchstart",U.cancelEvent);}};this.attachMouseWheelHandler=function(){if(!c.getPropertyBag().isMobileMode()){var T=c.getTableDiv();if(/Firefox/i.test(window.navigator.userAgent)){T[0].addEventListener("DOMMouseScroll",this.vScrollMouseWheelFireFox);}else{T.on("mousewheel",this.vScrollMouseWheel);}}};this.detachMouseWheelHandler=function(){if(!c.getPropertyBag().isMobileMode()){var T=c.getTableDiv();if(/Firefox/i.test(window.navigator.userAgent)){T[0].removeEventListener("DOMMouseScroll",this.vScrollMouseWheelFireFox);}else{T.off("mousewheel",this.vScrollMouseWheel);}}};function y(e){return e&&e/Math.abs(e);}this.vScrollMouseWheelFireFox=function(e){var F=y(e.detail);z(e,F);};this.vScrollMouseWheel=function(e){var F=-y(e.originalEvent.wheelDelta);z(e,F);};function z(e,F){if(c.hasLoadingPages()===false){var S=0;var A=0;if(i===true){S=120;A=parseInt(c.getVScrollbar().getContentSize(),10);}else{S=3;A=c.getVScrollbar().getSteps();}var N=c.getVScrollPos()+F*S;N=Math.max(0,N);N=Math.min(N,A);c.getRenderEngine().scrollVertical(N,true);}U.cancelEvent(e);}this.detachHandlers=function(){if(o&&c.getHScrollbar()){c.getHScrollbar().detachScroll(o);c.getHScrollbar().detachBrowserEvent("mousedown touchstart",U.cancelEvent);}if(V&&c.getVScrollbar()){c.getVScrollbar().detachScroll(V);c.getVScrollbar().detachBrowserEvent("mousedown touchstart",U.cancelEvent);this.detachMouseWheelHandler();}if(a&&c.getHorizontalHeaderScrollbar()){c.getHorizontalHeaderScrollbar().detachScroll(a);c.getHorizontalHeaderScrollbar().detachBrowserEvent("mousedown touchstart",U.cancelEvent);}o=null;V=null;a=null;};this.destroy=function(){this.detachHandlers();s=0;h=false;v=false;o=null;V=null;};this.setScrollbarSteps=function(){if(c.getPropertyBag().isPixelScrolling()){this.setScrollbarStepsInPixelMode();}else{this.setScrollbarStepsInStepMode();}if(H){this.setHorizontalHeaderScrollbarSteps();}};this.setHorizontalHeaderScrollbarSteps=function(){var e=c.getHorizontalHeaderScrollbar();if(e){var D=null;if(c.hasDimensionHeaderArea()){D=c.getId()+"_dimHeaderArea_container";}else if(c.hasRowHeaderArea()){D=c.getId()+"_rowHeaderArea_container";}if(D){var J=q(document.getElementById(D));e.setContentSize(J.outerWidth()+"px");e.rerender();}}};this.adjustHorizontalHeaderScrollbarContainerSize=function(){var e=c.getHorizontalHeaderScrollbar();if(e){var T=q(document.getElementById(c.getId()+"_hScrollTableCell"));if(T.length>0){var W=parseInt(T.css("border-right-width"),10)+parseInt(T.css("border-left-width"),10);e.setSize((parseInt(e.getSize(),10)-W)+"px");e.rerender();}}};this.setScrollbarStepsInPixelMode=function(){var e=c.getVScrollbar();var A=c.getHScrollbar();var D=q(document.getElementById(c.getId()+"_dataArea_container"));if(e){var B=0;if(!c.hasDataArea()){var C=q(document.getElementById(c.getId()+"_rowHeaderArea_container"));B=C.outerHeight();}else{B=D.outerHeight();}e.setContentSize(B+"px");e.rerender();}if(A){var W=0;if(!c.hasDataArea()){var E=q(document.getElementById(c.getId()+"_colHeaderArea_container"));W=E.outerWidth();}else{W=D.outerWidth();}A.setContentSize(W+"px");A.rerender();}};this.setScrollbarStepsInStepMode=function(){var R=m.getRenderSizeDivSize();var D=c.getDataArea();var e=c.getVScrollbar();var A=c.getHScrollbar();if(e){var C=m.getAreaHeight(c.getColumnHeaderArea());var B=R.iHeight-C;var E=D.getRenderStartRow();var F=E+D.getRenderRowCnt();var G=1;for(var I=E;I<F;I++){B-=D.getRowHeight(I);if(B<0){break;}G++;}e.setSteps(Math.max(1,D.getRowCnt()-G));e.rerender();}if(A){var J=m.getAreaWidth(c.getRowHeaderArea());var K=R.iWidth-J;var L=D.getRenderStartCol();var N=L+D.getRenderColCnt();var O=1;for(var P=L;P<N;P++){K-=D.getColWidth(P);if(K<0){break;}O++;}A.setSteps(Math.max(1,D.getColCnt()-O));A.rerender();}};this.adjustHScrollbarWidth=function(S){var D=q(document.getElementById(c.getId()+"_lowerLeftPad"));var e=q(document.getElementById(c.getId()+"_lowerRight_scrollDiv"));D.width(S);var A=c.getHScrollbar();A.setSize(e.outerWidth()+"px");A.rerender();};this.adjustVScrollbarHeight=function(S){var D=q(document.getElementById(c.getId()+"_upperRightPad"));var e=q(document.getElementById(c.getId()+"_lowerRight_scrollDiv"));D.height(S);var A=c.getVScrollbar();A.setSize(e.outerHeight()+"px");A.rerender();};};return sap.zen.crosstab.rendering.ScrollbarRenderer;});
