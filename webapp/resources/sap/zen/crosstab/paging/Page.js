/*!
 * (c) Copyright 2010-2019 SAP SE or an SAP affiliate company.
 */
sap.ui.define("sap/zen/crosstab/paging/Page",["jquery.sap.global","sap/zen/crosstab/paging/PagingConstants","sap/zen/crosstab/rendering/RenderingConstants","sap/zen/crosstab/DataCell","sap/zen/crosstab/HeaderCell"],function(q,P,R,D,H){"use strict";q.sap.declare("sap.zen.crosstab.paging.Page");sap.zen.crosstab.paging.Page=function(p,s,o){var S=P.PAGE_STATUS_UNKNOWN;var a=0;var b=0;var c=o.getTileRowCnt();var d=o.getTileColCnt();var C=o.getCellMerger();var e=o.getDataHandler();var f=o.getCrosstab();var g=f.getDimensionHeaderArea();var h=f.getColumnHeaderArea();var r=f.getRowHeaderArea();var j=f.getDataArea();var k={};var A=[];l();function l(){A.push(g.getAreaType());A.push(h.getAreaType());A.push(r.getAreaType());A.push(j.getAreaType());}this.getPageKey=function(){return s;};this.getRow=function(){};this.getCol=function(){};this.getPosition=function(){return p;};this.getStatus=function(){return S;};this.setStatus=function(N){S=N;};this.getPageDataRowCnt=function(){return a;};this.getPageDataColCnt=function(){return b;};this.receiveData=function(i,N){a=i.sentdatarows;b=i.sentdatacols;c=i.tilerows;d=i.tilecols;e.determineBasicAreaData(i,N);y();var O={};O.iRowOffset=p.iRow*c;O.iColOffset=p.iCol*d;O.bIsFirstPage=N;O.oCrosstabAreasToBeFilled=k;O.oCrosstabData=i;e.jsonToDataModel(O);E();z();};this.removeData=function(){S=P.PAGE_STATUS_UNKNOWN;k={};B(j);t();m();};function m(){var i=0;var N=null;for(i=0;i<A.length;i++){N=k[A[i]];if(N){I(N,false);N.oArea.decreaseLoadingPageCnt();}}}function n(i,T){var N=x(i,T);if(N.iRefCnt===0){N.iStatus=P.PAGE_STATUS_UNKNOWN;o.setHeaderTileInfo(i,T,N);B(i);}}function t(){n(g,0);n(r,p.iRow);n(h,p.iCol);}function u(){w(g,0);w(r,p.iRow);w(h,p.iCol);}function v(i,T,S){var N=o.getHeaderTileInfo(i,T);N.iStatus=S;o.setHeaderTileInfo(i,T,N);}function w(i,T){var N=o.getHeaderTileInfo(i,T);N.iRefCnt++;o.setHeaderTileInfo(i,T,N);}function x(i,T){var N=o.getHeaderTileInfo(i,T);N.iRefCnt--;o.setHeaderTileInfo(i,T,N);return N;}function y(){k={};B(j,0);if(o.getHeaderTileInfo(r,p.iRow).iStatus!==P.PAGE_STATUS_LOADED){B(r,p.iRow);}if(o.getHeaderTileInfo(h,p.iCol).iStatus!==P.PAGE_STATUS_LOADED){B(h,p.iCol);}if(o.getHeaderTileInfo(g,0).iStatus!==P.PAGE_STATUS_LOADED){B(g,0);}}function z(){var i=0;var N=null;for(i=0;i<A.length;i++){N=k[A[i]];if(N){J(N,false);K(N,false);N.oArea.decreaseLoadingPageCnt();}}}function B(i,T){var N=i.getAreaType();var O={};O.oArea=i;O.oAreaRegion=L(i);O.iTileIndex=T;k[N]=O;}this.provideLoadingCells=function(i){S=P.PAGE_STATUS_LOADING;F(i);u();G();};function E(){S=P.PAGE_STATUS_LOADED;var i=null;i=k[h.getAreaType()];if(i){C.mergeColHeaderCells(p.iCol);v(i.oArea,p.iCol,P.PAGE_STATUS_LOADED);}i=k[r.getAreaType()];if(i){C.mergeRowHeaderCells(p.iRow);v(i.oArea,p.iRow,P.PAGE_STATUS_LOADED);}i=k[g.getAreaType()];if(i){v(i.oArea,0,P.PAGE_STATUS_LOADED);}}function F(i){k={};B(j,0);if(i.isDataArea()){if(o.getHeaderTileInfo(r,p.iRow).iStatus===P.PAGE_STATUS_UNKNOWN){B(r,p.iRow);v(r,p.iRow,P.PAGE_STATUS_LOADING);}if(o.getHeaderTileInfo(h,p.iCol).iStatus===P.PAGE_STATUS_UNKNOWN){B(h,p.iCol);v(h,p.iCol,P.PAGE_STATUS_LOADING);}if(o.getHeaderTileInfo(g,0).iStatus===P.PAGE_STATUS_UNKNOWN){B(g,0);v(g,0,P.PAGE_STATUS_LOADING);}}else{if(i.isColHeaderArea()){B(i,p.iCol);v(i,p.iCol,P.PAGE_STATUS_LOADING);}else if(i.isRowHeaderArea()){B(i,p.iRow);v(i,p.iRow,P.PAGE_STATUS_LOADING);}else if(i.isDimensionHeaderArea()){B(i,0);v(i,0,P.PAGE_STATUS_LOADING);}}}function G(){var i=0;var N=null;for(i=0;i<A.length;i++){N=k[A[i]];if(N){I(N,true);J(N,true);K(N,true);N.oArea.increaseLoadingPageCnt();}}}function I(i,N){var O=0;var Q=0;var T=null;var U=i.oAreaRegion;var V=i.oArea;for(O=U.iStartRow;O<=U.iEndRow;O++){for(Q=U.iStartCol;Q<=U.iEndCol;Q++){if(N){T=M(V,O,Q);}V.insertCell(T,O,Q);}}}function J(i,N){var O=i.oAreaRegion;var Q=i.oArea;var T=0;for(T=O.iStartCol;T<=O.iEndCol;T++){Q.changeColWidthTemporaryFlag(T,s,N);}}function K(i,N){var O=i.oAreaRegion;var Q=i.oArea;var T=0;for(T=O.iStartRow;T<=O.iEndRow;T++){Q.changeRowHeightTemporaryFlag(T,s,N);}}function L(i){var N={};if(i.isDimHeaderArea()){N.iStartRow=0;N.iEndRow=i.getRowCnt()-1;N.iStartCol=0;N.iEndCol=i.getColCnt()-1;}else if(i.isRowHeaderArea()){N.iStartRow=p.iRow*c;N.iEndRow=Math.min(N.iStartRow+c-1,i.getRowCnt()-1);N.iStartCol=0;N.iEndCol=i.getColCnt()-1;}else if(i.isColHeaderArea()){N.iStartRow=0;N.iEndRow=i.getRowCnt()-1;N.iStartCol=p.iCol*d;N.iEndCol=Math.min(N.iStartCol+d-1,i.getColCnt()-1);}else if(i.isDataArea()){N.iStartRow=p.iRow*c;N.iEndRow=Math.min(N.iStartRow+c-1,i.getRowCnt()-1);N.iStartCol=p.iCol*d;N.iEndCol=Math.min(N.iStartCol+d-1,i.getColCnt()-1);}return N;}function M(i,N,O){var Q=null;if(i.isDataArea()){Q=new D();Q.addStyle(R.STYLE_DATA_CELL);}else{Q=new H();Q.addStyle(R.STYLE_HEADER_CELL);Q.setRowSpan(1);Q.setColSpan(1);}Q.setArea(i);Q.setRow(N);Q.setCol(O);Q.setLoading(true);Q.addStyle(R.STYLE_LOADING);return Q;}};return sap.zen.crosstab.paging.Page;});
