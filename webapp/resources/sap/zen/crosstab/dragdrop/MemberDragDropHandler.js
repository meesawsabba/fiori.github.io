/*!
 * (c) Copyright 2010-2019 SAP SE or an SAP affiliate company.
 */
sap.ui.define(["jquery.sap.global","sap/zen/crosstab/dragdrop/DragDropUtils","sap/zen/crosstab/dragdrop/DragDropAreaRenderer","sap/zen/crosstab/dragdrop/DragDropHoverManager","sap/zen/crosstab/TextConstants","sap/zen/crosstab/utils/Utils"],function(q){"use strict";q.sap.declare("sap.zen.crosstab.dragdrop.MemberDragDropHandler");sap.zen.crosstab.dragdrop.MemberDragDropHandler=function(c,d,D,o,a){var t=this;var v;var V;var p;var I;var m={"sIdSuffix":"member_droparea_above","sCssClassName":"sapzencrosstab-rowAboveCellMemberDropArea"};var M={"sIdSuffix":"member_droparea_below","sCssClassName":"sapzencrosstab-rowBelowCellMemberDropArea"};var b={"sIdSuffix":"member_droparea_before","sCssClassName":"sapzencrosstab-columnBeforeCellMemberDropArea"};var f={"sIdSuffix":"member_droparea_after","sCssClassName":"sapzencrosstab-columnAfterCellMemberDropArea"};this.init=function(e){I=c.getPropertyBag().isRepeatTexts();p=e;v=D.getBoundingClientRect(c.getRowHeaderAreaDiv()[0]);V=D.getBoundingClientRect(c.getColHeaderAreaDiv()[0]);this.removeRowHeaderDropAreas();this.enableMemberDragDrop();};this.removeRowHeaderDropAreas=function(){var J;if(!c.getPropertyBag().isPixelScrolling()){J=c.getRenderSizeDiv();J.find(".sapzencrosstab-rowAboveCellMemberDropArea").remove();J.find(".sapzencrosstab-rowBelowCellMemberDropArea").remove();J.find(".sapzencrosstab-columnBeforeCellMemberDropArea").remove();J.find(".sapzencrosstab-columnAfterCellMemberDropArea").remove();}};this.getMemberCellHtml=function(C){var J;var e;var w;var H;J=q(document.getElementById(C.getId()));e=q(document.getElementById(C.getId()+"_cellLayoutDiv"));w=e.outerWidth();H="<td class=\""+J.attr("class")+" sapzencrosstab-DragHeaderCell"+"\">";H+="<div style=\"width: "+w+"px\">"+C.getText()+"</div></td>";return H;};this.createMemberCellDragObject=function(A,e){var H;var C;var n;var r;var i;var L;var J;if(A.getArea().isRowHeaderArea()){C="sapzencrosstab-RowHeaderArea";}else if(A.getArea().isColHeaderArea()){C="sapzencrosstab-ColumnHeaderArea";}H="<table style=\"z-index: 9999;border-collapse: collapse\" class=\""+C+"\"><tbody>";L=e.length;H+=D.getDeleteDragGhostCellRowHtml(L);if(A.getArea().isRowHeaderArea()){n=e[0];r=q(document.getElementById(n.getId())).outerHeight();H+="<tr style=\"height: "+r+"px\">";for(i=0;i<L;i++){n=e[i];H+=this.getMemberCellHtml(n);}H+="</tr>";}else if(A.getArea().isColHeaderArea()){for(i=0;i<L;i++){n=e[i];r=q(document.getElementById(n.getId())).outerHeight();H+="<tr style=\"height: "+r+"px\">";H+=this.getMemberCellHtml(n);H+="</tr>";}}H+="</tbody></table>";J=q(H);c.setDragAction(true);return J;};this.restrictDropIndexLimitsForHierarchyMember=function(C,e,A){var r=c.getRowHeaderArea();var i=c.getColumnHeaderArea();var R;var n;var T;var F=-1;var L=-1;var s=null;var u=null;if(C.getAlignment()==="TOP"||C.getAlignment==="DEFAULT"){if(A==="ROWS"){for(R=e.iMinIndex;R<=e.iMaxIndex;R++){T=r.getCellWithRowSpan(R,C.getCol(),true);if(T&&T.getLevel()===C.getLevel()&&T.getParentMemberId()===C.getParentMemberId()){if(F<0){F=R;}else{s=T;}}}if(F>-1){e.iMinIndex=F;}if(s){e.iMaxIndex=s.getRow()+s.getRowSpan()-1;}}else if(A==="COLS"){for(n=e.iMinIndex;n<=e.iMaxIndex;n++){T=i.getCellWithColSpan(C.getRow(),n,true);if(T&&T.getLevel()===C.getLevel()&&T.getParentMemberId()===C.getParentMemberId()){if(F<0){F=n;}else{s=T;}}}if(F>-1){e.iMinIndex=F;}if(s){e.iMaxIndex=s.getCol()+s.getColSpan()-1;}}}else{if(A==="ROWS"){for(R=e.iMaxIndex;R>=e.iMinIndex;R--){T=r.getCellWithRowSpan(R,C.getCol(),true);if(T&&T.getLevel()===C.getLevel()&&T.getParentMemberId()===C.getParentMemberId()){if(L<0){L=R;}else{u=T;}}}if(u){e.iMinIndex=u.getRow();}if(L>-1){e.iMaxIndex=L;}}else if(A==="COLS"){for(n=e.iMaxIndex;n>=e.iMinIndex;n--){T=i.getCellWithColSpan(C.getRow(),n,true);if(T&&T.getLevel()===C.getLevel()&&T.getParentMemberId()===C.getParentMemberId()){if(L<0){L=n;}else{u=T;}}}if(u){e.iMinIndex=u.getCol();}if(L>-1){e.iMaxIndex=L;}}}return e;};this.filterResultCellsFromDropIndexLimits=function(e,C,A){var T;var r=c.getRowHeaderArea();var i=c.getColumnHeaderArea();var R;var n;if(A==="ROWS"){R=e.iMinIndex;T=r.getCellWithRowSpan(R,C.getCol());if(!T){T=r.getCellWithColSpan(R,C.getCol());}while(T&&T.isResult()&&R<e.iMaxIndex){e.iMinIndex=T.getRow()+T.getRowSpan();R++;T=r.getCellWithColSpan(R,C.getCol());}R=e.iMaxIndex;T=r.getCellWithRowSpan(R,C.getCol());if(!T){T=r.getCellWithColSpan(R,C.getCol());}while(T&&T.isResult()&&R>e.iMinIndex){e.iMaxIndex=T.getRow()-1;R--;T=r.getCellWithColSpan(R,C.getCol());}}else if(A==="COLS"){n=e.iMinIndex;T=i.getCellWithColSpan(C.getRow(),n);if(!T){T=i.getCellWithRowSpan(R,C.getCol());}while(T&&T.isResult()&&n<e.iMaxIndex){e.iMinIndex=T.getCol()+T.getColSpan();n++;T=i.getCellWithRowSpan(C.getRow(),n);}n=e.iMaxIndex;T=i.getCellWithColSpan(C.getRow(),n);if(!T){T=i.getCellWithRowSpan(R,C.getCol());}while(T&&T.isResult()&&R>e.iMinIndex){e.iMaxIndex=T.getCol()-1;n--;T=i.getCellWithRowSpan(C.getRow(),n);}}return e;};this.determineDropIndexLimitsFromPeerCell=function(P,A){var i=0;var B;var e;var n;var C;var r={};r.iMinIndex=-1;r.iMaxIndex=-1;if(I&&P.getMergeKey()&&P.getMergeKey().length>0){if(A==="COLS"){n=c.getColHeaderArea();B=n.getRenderStartCol();e=B+n.getRenderColCnt();for(i=B;(i<e)&&(r.iMaxIndex===-1);i++){C=n.getCell(P.getRow(),i);if(C.getMergeKey()===P.getMergeKey()&&r.iMinIndex===-1){r.iMinIndex=i;}if(C.getMergeKey()!==P.getMergeKey()&&r.iMinIndex>-1){r.iMaxIndex=i-1;}}}else{n=c.getRowHeaderArea();B=n.getRenderStartRow();e=B+n.getRenderRowCnt();for(i=B;(i<e)&&(r.iMaxIndex===-1);i++){C=n.getCell(i,P.getCol());if(C.getMergeKey()===P.getMergeKey()&&r.iMinIndex===-1){r.iMinIndex=i;}if(C.getMergeKey()!==P.getMergeKey()&&r.iMinIndex>-1){r.iMaxIndex=i-1;}}}if(r.iMaxIndex===-1){r.iMaxIndex=e;}}else{if(A==="COLS"){r.iMinIndex=P.getCol();r.iMaxIndex=P.getCol()+P.getColSpan()-1;}else{r.iMinIndex=P.getRow();r.iMaxIndex=P.getRow()+P.getRowSpan()-1;}}return r;};this.findDropIndexLimits=function(C,e){var i={};var n;var P;n=c.getHeaderInfo().findStartIndexOfPreviousDimension(e.sDimensionName,e.sAxisName);if(e.sAxisName==="ROWS"){if(!c.getHeaderInfo().isFirstDimensionOnAxis(e)){P=c.getRowHeaderArea().getCellWithRowSpan(C.getRow(),n);i=this.determineDropIndexLimitsFromPeerCell(P,e.sAxisName);}else{i.iMinIndex=c.getRowHeaderArea().getRenderStartRow();i.iMaxIndex=i.iMinIndex+c.getRowHeaderArea().getRenderRowCnt()-1;}}else if(e.sAxisName==="COLS"){if(!c.getHeaderInfo().isFirstDimensionOnAxis(e)){P=c.getColumnHeaderArea().getCellWithColSpan(n,C.getCol());i=this.determineDropIndexLimitsFromPeerCell(P,e.sAxisName);}else{i.iMinIndex=c.getColumnHeaderArea().getRenderStartCol();i.iMaxIndex=i.iMinIndex+c.getColumnHeaderArea().getRenderColCnt()-1;}}i=this.filterResultCellsFromDropIndexLimits(i,C,e.sAxisName);if(C.getLevel()>-1){i=this.restrictDropIndexLimitsForHierarchyMember(C,i,e.sAxisName);}return i;};this.findPreviousPeerCell=function(C,A,i){var r=c.getRowHeaderArea();var e=c.getColumnHeaderArea();var T;var R;var n;var P=null;if(C.getAlignment()==="TOP"||C.getAlignment==="DEFAULT"){if(A==="ROWS"){for(R=C.getRow();R>=i.iMinIndex&&!P;R--){T=r.getCellWithRowSpan(R,C.getCol(),true);if(T&&T.getId()!==C.getId()&&T.getLevel()===C.getLevel()){P=T;}}}else if(A==="COLS"){for(n=C.getCol();n>=i.iMinIndex&&!P;n--){T=e.getCellWithColSpan(C.getRow(),n,true);if(T&&T.getId()!==C.getId()&&T.getLevel()===C.getLevel()){P=T;}}}}else{if(A==="ROWS"){for(R=C.getRow();R<=i.iMaxIndex&&!P;R++){T=r.getCellWithRowSpan(R,C.getCol(),true);if(T&&T.getId()!==C.getId()&&T.getLevel()===C.getLevel()){P=T;}}}else if(A==="COLS"){for(n=C.getCol();n<=i.iMaxIndex&&!P;n++){T=e.getCellWithColSpan(C.getRow(),n,true);if(T&&T.getId()!==C.getId()&&T.getLevel()===C.getLevel()){P=T;}}}}if(P){if(P.getParentMemberId()!==C.getParentMemberId()){P=null;}}return P;};function g(){var C;var e;var H;var i;var J;var P;var n;var r;var s;H=c.getHeaderInfo();e=a.getCellFromJqCell(this);C=D.getEffectiveCell(e);if(C){D.setCurrentJqDragCell(q(document.getElementById(C.getId())));if(I){i=D.getAllMemberCellsInRowOrCol(C);}else{i=H.getMemberCellsForSameDimension(C);}D.saveRevertCellPosInfo(e,i);J=t.createMemberCellDragObject(C,i);D.setCursorAt(e,J);n=H.getDimensionInfoForMemberCell(C);P=sap.zen.Dispatcher.instance.createDragDropPayload(c.getId());P.oDragDropInfo=D.buildDimensionDragDropInfo(n);s=t.findDropIndexLimits(C,n);P.oDragDropInfo.oDropIndexLimits=s;if(C.getLevel()>-1){P.oDragDropInfo.bIsHierarchyMember=true;}P.oDragDropInfo.bIsMemberDrag=true;r=c.getUtils().translateCellCoordinatesForBackend(C);if(r){P.oDragDropInfo.iMemberRow=r.row;P.oDragDropInfo.iMemberCol=r.col;}sap.zen.Dispatcher.instance.setDragDropPayload(P);}return J;}this.checkBasicMemberDropAccept=function(P,s){if(!P){return false;}if(P.oDragDropInfo.sAxisName!==s){return false;}if(D.isDragFromOtherCrosstab(P)){return false;}if(D.isInterComponentDrag(P)){return false;}if(!P.oDragDropInfo.bIsMemberDrag){return false;}return true;};this.returnFromMemberCellAcceptCheck=function(C,A){C.setRevertDrop(!A);sap.zen.Dispatcher.instance.setDropAccepted(C.getId(),A);return A;};this.checkDropLimitsAgainstCells=function(e,i,n,A){var r;var s;if(n.iMinIndex===-1&&n.iMaxIndex===-1){return true;}if(n.iMinIndex===n.iMaxIndex){return false;}r=true;if(A==="ROWS"){if(e.getRow()===i.getRow()){r=false;}else{if(e.getCol()>0){s=i.getRow()+i.getRowSpan()-1;r=n.iMinIndex<=s&&n.iMaxIndex>=s;}}}else if(A==="COLS"){if(e.getCol()===i.getCol()){r=false;}else{if(e.getRow()>0){s=i.getCol()+i.getColSpan()-1;r=n.iMinIndex<=s&&n.iMaxIndex>=s;}}}else{r=false;}return r;};this.checkMatchingHierarchyLevels=function(e,i){if(i.getLevel()>-1&&e.getLevel()>-1){return(i.getLevel()===e.getLevel()&&i.getParentMemberId()===e.getParentMemberId());}return true;};function h(e){var i;var n;var P;var r;var A;var s;var u;if(!c.isDragAction()||c.isBlocked()){return false;}P=sap.zen.Dispatcher.instance.getDragDropPayload();s=P.oDragDropInfo;i=a.getCellFromJqCell(q(this));i=D.getEffectiveCell(i);u=c.getHeaderInfo().getDimensionInfoForMemberCell(i);if(!t.checkBasicMemberDropAccept(P,u.sAxisName)){return t.returnFromMemberCellAcceptCheck(i,false);}r=P.oDragDropInfo.oDropIndexLimits;n=a.getCellFromJqCell(e);n=D.getEffectiveCell(n);A=t.checkDropLimitsAgainstCells(n,i,r,s.sAxisName);if(!A){return t.returnFromMemberCellAcceptCheck(i,false);}A=t.checkMatchingHierarchyLevels(n,i);if(!A){return t.returnFromMemberCellAcceptCheck(i,false);}return t.returnFromMemberCellAcceptCheck(i,true);}this.returnFromMemberAreaAcceptCheck=function(J,A){J.data("xtabrevertdrop",!A);sap.zen.Dispatcher.instance.setDropAccepted(J.attr("id"),A);return A;};this.checkDropAreaDropLimits=function(e,i,n,A,r){var s;var u;if(n.iMinIndex!==n.iMaxIndex&&!r){if(i.isResult()){if(A==="ROWS"){if(i.getRow()+i.getRowSpan()-1===n.iMaxIndex){return false;}}else if(A==="COLS"){if(i.getCol()+i.getColSpan()-1===n.iMaxIndex){return false;}}}s={"iMinIndex":Math.max(0,n.iMinIndex-1),"iMaxIndex":n.iMaxIndex};}else{s=n;}u=this.checkDropLimitsAgainstCells(e,i,s,A);return u;};this.getDropCellFromAnchorCell=function(A,e,s,i){var n=null;if(s==="ROWS"){n=c.getRowHeaderArea().getCellWithColSpan(A.getRow(),e.getCol(),true);if(!n){n=c.getRowHeaderArea().getCellWithRowSpan(A.getRow(),e.getCol(),true);}if(n&&!i){if((A.getRow()+A.getRowSpan())!==(n.getRow()+n.getRowSpan())){n=null;}}}else if(s==="COLS"){n=c.getColumnHeaderArea().getCellWithRowSpan(e.getRow(),A.getCol(),true);if(!n){n=c.getColumnHeaderArea().getCellWithColSpan(e.getRow(),A.getCol(),true);}if(n&&!i){if((A.getCol()+A.getColSpan())!==(n.getCol()+n.getColSpan())){n=null;}}}return n;};this.checkAreaMoveOnPreviousCell=function(e,i,A,s,n){if(s==="ROWS"){if(i.getRow()===e.getRow()||(A.getRow()+A.getRowSpan())===e.getRow()){if(!n){return false;}}}else if(s==="COLS"){if(i.getCol()===e.getCol()||(A.getCol()+A.getColSpan())===e.getCol()){if(!n){return false;}}}return true;};this.isDropCellOneBelowOrBeforeBlock=function(e,i,A){var n;if(A==="ROWS"){n=e.getRow()+e.getRowSpan()-1;}else if(A==="COLS"){n=e.getCol()+e.getColSpan()-1;}return(Math.max(0,n)===Math.max(0,(i.iMinIndex-1)));};this.getNextCell=function(C,A){var F;if(A==="ROWS"){F=c.getRowHeaderArea().getCellWithRowSpan(C.getRow()+C.getRowSpan(),C.getCol());}else if(A==="COLS"){F=c.getColumnHeaderArea().getCellWithColSpan(C.getRow(),C.getCol()+C.getColSpan());}return F;};this.checkAreaMoveOnPreviousHierarchyPeerOrBeginOfFollowing=function(e,i,n,A,r){var P;var F;var C=i;if(e.getLevel()>-1&&i.getLevel()>-1){P=this.findPreviousPeerCell(e,A,n);if(P){if(i.getId()===P.getId()){return false;}if((A==="ROWS"&&(i.getRow()+i.getRowSpan()-1)===(P.getRow()-1))||(A==="COLS"&&(i.getCol()+i.getColSpan()-1)===(P.getCol()-1))){if(e.getLevel()!==i.getLevel()&&r){return false;}}else{if(!this.isDropCellOneBelowOrBeforeBlock(i,n,A)){if(!this.checkMatchingHierarchyLevels(e,i)){return false;}}}}else{if(!this.isDropCellOneBelowOrBeforeBlock(i,n,A)){if(!r&&i.getLevel()!==e.getLevel()){F=this.getNextCell(i,A);if(F){P=this.findPreviousPeerCell(F,A,n);if(P&&P.getId()===e.getId()){return false;}C=F;}}if(!this.checkMatchingHierarchyLevels(e,C)){return false;}}}}return true;};function j(e){var P;var J;var i;var n;var A;var s;var r;var u;var w;var x;var y;var z;if(!c.isDragAction()||c.isBlocked()){return false;}P=sap.zen.Dispatcher.instance.getDragDropPayload();J=q(this);A=D.getDropAreaTypeFromDropAreaId(J.attr("id"));s=(A==="droparea_above"||A==="droparea_below")?"ROWS":"COLS";w=(A==="droparea_above"||A==="droparea_before");if(!t.checkBasicMemberDropAccept(P,s)){return t.returnFromMemberAreaAcceptCheck(J,false);}n=D.getCrosstabHeaderCellFromDraggable(e);n=D.getEffectiveCell(n);r=n.getArea().isRowHeaderArea()?"ROWS":"COLS";if(r!==s){return t.returnFromMemberAreaAcceptCheck(J,false);}z=sap.ui.getCore().getControl(J.data("xtabcellid"));i=t.getDropCellFromAnchorCell(z,n,r,w);i=D.getEffectiveCell(i);if(!i||(i&&(i.getId()===n.getId()))){return t.returnFromMemberAreaAcceptCheck(J,false);}y=P.oDragDropInfo;x=y.oDropIndexLimits;u=t.checkDropAreaDropLimits(n,i,x,r,w);if(!u){return t.returnFromMemberAreaAcceptCheck(J,false);}u=t.checkAreaMoveOnPreviousCell(n,i,z,r,w);if(!u){return t.returnFromMemberAreaAcceptCheck(J,false);}u=t.checkAreaMoveOnPreviousHierarchyPeerOrBeginOfFollowing(n,i,x,r,w);if(!u){return t.returnFromMemberAreaAcceptCheck(J,false);}return t.returnFromMemberAreaAcceptCheck(J,true);}this.getCommonDropCommand=function(C,s){var e;var n;e=sap.zen.Dispatcher.instance.getDragDropPayload().oDragDropInfo;if(e.sAxisName==="ROWS"){n=C.row;}else if(e.sAxisName==="COLS"){n=C.col;}s=s.replace("__AXIS__",e.sAxisName);s=s.replace("__ROW__",e.iMemberRow);s=s.replace("__COL__",e.iMemberCol);s=s.replace("__NEW_INDEX__",n);return s;};function k(e,u){var i;var C;var s;if(D.checkDropAllowedOnCrosstabElement(e)){i=a.getCellFromJqCell(q(this));i=D.getEffectiveCell(i);C=c.getUtils().translateCellCoordinatesForBackend(i);s=t.getCommonDropCommand(C,d.swapmemberscommand);c.getUtils().executeCommandAction(s);D.resetDragDrop();}else if(!D.checkMouseInRenderSizeDiv(e)){sap.zen.Dispatcher.instance.onUnhandledDrop(e,u);}}function l(e,u){var A;var i;var n;var C;var s;var r;var w;var x;var y;var B=false;if(D.checkDropAllowedOnCrosstabElement(e)){r=sap.zen.Dispatcher.instance.getDragDropPayload().oDragDropInfo;w=r.oDropIndexLimits;x=r.sAxisName;A=sap.ui.getCore().getControl(q(this).data("xtabcellid"));i=D.getCrosstabHeaderCellFromDraggable(q(u.draggable));i=D.getEffectiveCell(i);s=D.getDropAreaTypeFromDropAreaId(q(this).attr("id"));if(s==="droparea_above"||s==="droparea_before"){B=true;}n=t.getDropCellFromAnchorCell(A,i,x,B);n=D.getEffectiveCell(n);if(t.isDropCellOneBelowOrBeforeBlock(n,w,x)){B=true;if(x==="ROWS"){n=c.getRowHeaderArea().getCellWithRowSpan(w.iMinIndex,n.getCol());}else if(x==="COLS"){n=c.getColumnHeaderArea().getCellWithColSpan(n.getRow(),w.iMinIndex);}}if(i.getLevel()!==n.getLevel()){n=t.getNextCell(n,x);B=true;}C=c.getUtils().translateCellCoordinatesForBackend(n);y=t.getCommonDropCommand(C,d.insertmembercommand);y=y.replace("__INSERT_BEFORE__",B);c.getUtils().executeCommandAction(y);D.resetDragDrop();}else if(!D.checkMouseInRenderSizeDiv(e)){sap.zen.Dispatcher.instance.onUnhandledDrop(e,u);}}this.getLeftOfBeginCellInRowHeader=function(r,C){var s;var R;var i;var T=C;var e;s=C.getCol();i=s;R=C.getRow();if(R<r.getRenderStartRow()+r.getRenderRowCnt()-1){R++;}while(T&&i>=0){T=r.getCellWithColSpan(R,i);if(T){C=T;i=T.getCol()-1;}}e=D.getBoundingClientRect(document.getElementById(C.getId()));return e.begin;};this.getTopOfBeginCellInColHeader=function(C,e){var s;var r;var i;var T=e;var R;s=e.getRow();r=s;i=e.getCol();if(i<C.getRenderStartCol()+C.getRenderColCnt()-1){i++;}while(T&&r>=0){T=C.getCellWithRowSpan(r,i);if(T){e=T;r=T.getRow()-1;}}R=D.getBoundingClientRect(document.getElementById(e.getId()));return R.top;};this.isRowContainsResultCell=function(r,R){var i=0;var C=null;for(i=0;i<r.getColCnt();i++){C=r.getCellWithColSpan(R,i);if(C&&C.isResult()){return true;}}return false;};this.isColContainsResultCell=function(C,e){var i=0;var n=null;for(i=0;i<C.getRowCnt();i++){n=C.getCellWithRowSpan(i,e);if(n&&n.isResult()){return true;}}return false;};this.enableRowHeaderCellsAndAreas=function(){var C=0;var r=0;var s=0;var e=0;var R;var i;var n;var J;var u;var F;var O=false;var w=null;var x=false;var y=false;R=c.getRowHeaderArea();if(!c.hasRowHeaderArea()||(R&&R.getRenderRowCnt()<2)){O=true;}if(p){F=p.getTableCol()+p.getColSpan()-1;if(!p.isSplitPivotCell()&&p.sScalingAxis==="ROWS"){F--;}}else{F=0;}s=R.getRenderStartRow();e=s+R.getRenderRowCnt()-1;for(r=s;r<=e;r++){if(I){x=this.isRowContainsResultCell(R,r);}for(C=0;C<=F;C++){i=R.getCellWithColSpan(r,C);if(!i&&r===s){i=R.getCellWithRowSpan(r,C);}if(i){if(O){w=c.getHeaderInfo().getDimensionInfoByCol(i.getTableCol());if(!w){return;}}u=q(document.getElementById(i.getId()));n=D.getBoundingClientRect(u[0]);if(C===F&&!O){if(r===s&&n.top>=v.top){m.iEnd=0;J=o.createAboveDropArea(i,m);D.makeDropAreaDroppable(J,"sapzencrosstab-rowAboveCellMemberDropArea",j,l);}if(n.bottom<=v.bottom){M.iEnd=0;M.iBegin=this.getLeftOfBeginCellInRowHeader(R,i);J=o.createBelowDropArea(i,M);D.makeDropAreaDroppable(J,"sapzencrosstab-rowBelowCellMemberDropArea",j,l);}}if(I){y=x;}else{y=i.isResult();}if(!y&&n.top<v.bottom){D.makeCellDraggable(u,g);if(!O){D.makeCellDroppable(u,h,k);}}}}}};this.enableColHeaderCellsAndAreas=function(){var C=0;var r=0;var s=0;var e;var i;var R;var J;var E=0;var n;var F;var O=false;var u=null;var w=false;var x=false;var y={};e=c.getColumnHeaderArea();if(!c.hasColHeaderArea()||(e&&e.getRenderColCnt()<2)){O=true;}if(p){F=p.getTableRow()+p.getRowSpan()-1;if(!p.isSplitPivotCell()&&p.sScalingAxis==="COLS"){F--;}}else{F=0;}s=e.getRenderStartCol();E=s+e.getRenderColCnt()-1;for(r=0;r<=F;r++){for(C=s;C<=E;C++){if(I){if(typeof y[C]!="undefined"){w=y[C];}else{w=this.isColContainsResultCell(e,C);y[C]=w;}}i=e.getCellWithRowSpan(r,C);if(!i&&C===s){i=e.getCellWithColSpan(r,C);}if(i){if(O){u=c.getHeaderInfo().getDimensionInfoByRow(i.getTableRow());if(!u){return;}}n=q(document.getElementById(i.getId()));R=D.getBoundingClientRect(n[0]);if(r===F&&!O){if(C===s&&R.begin>=V.begin){b.iBottom=0;J=o.createBeforeDropArea(i,b);D.makeDropAreaDroppable(J,"sapzencrosstab-columnBeforeCellMemberDropArea",j,l);}if(R.end<=V.end){f.iBottom=0;f.iTop=this.getTopOfBeginCellInColHeader(e,i);J=o.createAfterDropArea(i,f);D.makeDropAreaDroppable(J,"sapzencrosstab-columnAfterCellMemberDropArea",j,l);}}if(I){x=w;}else{x=i.isResult();}if(!x&&R.begin<V.end){D.makeCellDraggable(n,g);if(!O){D.makeCellDroppable(n,h,k);}}}}}};this.enableMemberDragDrop=function(){this.enableRowHeaderCellsAndAreas();this.enableColHeaderCellsAndAreas();};this.removeMember=function(e,u,i){if(i.bIsMemberDrag&&i.iMemberRow>-1&&i.iMemberCol>-1&&!i.bIsHierarchyMember){var C=d.removemembercommand.replace("__AXIS__",i.sAxisName);C=C.replace("__ROW__",i.iMemberRow);C=C.replace("__COL__",i.iMemberCol);c.getUtils().executeCommandAction(C);}else{sap.zen.Dispatcher.instance.setDragDropCanceled(true);}};};return sap.zen.crosstab.dragdrop.MemberDragDropHandler;});
