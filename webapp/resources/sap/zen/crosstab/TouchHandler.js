/*!
 * (c) Copyright 2010-2019 SAP SE or an SAP affiliate company.
 */
sap.ui.define(["jquery.sap.global","sap/zen/crosstab/utils/Utils","sap/zen/crosstab/TextConstants","sap/ui/unified/Menu","sap/ui/commons/Menu","sap/ui/unified/MenuItem","sap/ui/commons/MenuItem","sap/ui/commons/TextView","sap/m/Text","sap/ui/core/Popup"],function(q,U,T,a,C,b,c,d,f,P){"use strict";q.sap.declare("sap.zen.crosstab.TouchHandler");sap.zen.crosstab.TouchHandler=function(E,o){var D=o.getDataArea();var r=o.getRowHeaderArea();var g=o.getColumnHeaderArea();var h=o.getDimensionHeaderArea();var l=0;var L=0;var t=false;var m=false;var j=q(document.getElementById(D.getId()));var k=q(document.getElementById(r.getId()));var n=q(document.getElementById(g.getId()));var p=q(document.getElementById(h.getId()));var s="";var u=null;var v="800";var V=0;var H=0;var R=0;var w=0;var N=0;var x=0;var O=0;var y=0;var z=null;var A=null;var I=2;var B=null;var F=null;var G=null;var J=false;var K;function M(e){var b1=null;var i=0;var c1=sap.ui.getCore().getControl(e.target.id);var d1=null;var e1=null;if(c1&&(c1.isMobileResize&&c1.isMobileResize())){b1=c1;}else{var f1=q(e.target).parents("td");if(f1){for(i=0;i<f1.length;i++){d1=q(f1[i]);e1=d1.attr("id");if(e1&&e1.length>0){c1=sap.ui.getCore().getControl(e1);if(c1&&(c1.isMobileResize&&c1.isMobileResize())){b1=c1;break;}}}}}return b1;}function Q(e){if(K){var i=e.getParameter("item").oSelectedCell;if(i){K.resizeCol(i,-1);}}}function S(){if(!B){B=sap.ui.getCore().getControl("resizemenu");if(B){B.getItems()[0].destroy();B.destroy();}if(U.isDispatcherAvailable()===true&&sap.zen.Dispatcher.instance.isMainMode()){B=new a("resizemenu",{ariaDescription:"Crosstab Menu",tooltip:"Menu containing crosstab related actions"});}else{B=new C("resizemenu",{ariaDescription:"Crosstab Menu",tooltip:"Menu containing crosstab related actions"});}B.addStyleClass("sapzencrosstab-MenuStyle");var e=null;if(U.isDispatcherAvailable()===true&&sap.zen.Dispatcher.instance.isMainMode()){e=new b("item1",{text:o.getPropertyBag().getText(T.MOBILE_MENUITEM_COLWIDTH_ADJUST_TEXT_KEY)});}else{e=new c("item1",{text:o.getPropertyBag().getText(T.MOBILE_MENUITEM_COLWIDTH_ADJUST_TEXT_KEY)});}e.attachSelect(Q);B.addItem(e);}}function W(){R=(D.getRowCnt()+"").length;w=(D.getColCnt()+"").length;z=new P();var e=null;if(U.isDispatcherAvailable()===true&&sap.zen.Dispatcher.instance.isMainMode()){e=new f();}else{e=new d();}z.setContent(e);z.setDurations(125,500);z.setAutoClose(true);A=z.getContent();A.addStyleClass("sapzencrosstab-ScrollPopup");A.setWrapping(false);var i=P.Dock;z.setPosition(i.CenterCenter,i.CenterCenter,document.getElementById(o.getId()+"_renderSizeDiv"),"0");}function X(){var e=o.getPropertyBag().getText(T.ROW_TEXT_KEY)+": "+U.padWithZeroes(N+1,R)+"/"+r.getRowCnt();var i=o.getPropertyBag().getText(T.COL_TEXT_KEY)+": "+U.padWithZeroes(x+1,w)+"/"+g.getColCnt();var b1=e+" "+i;z.getContent().setProperty("text",b1,true);z.getContent().rerender();}function Y(e){U.cancelEvent(e);V=0;H=0;N=0;x=0;if(B){B.close();}s=e.currentTarget.getAttribute("id");if(e.originalEvent.touches&&e.originalEvent.touches.length){e=e.originalEvent.touches[0];}else if(e.originalEvent.changedTouches&&e.originalEvent.changedTouches.length){e=e.originalEvent.changedTouches[0];}l=e.pageX;L=e.pageY;t=true;m=false;if(u){window.clearTimeout(u);u=null;}u=setTimeout(function(){t=false;m=false;var i=M(e);if(i){S();var b1=q(document.getElementById(i.getId()));if(b1.length>0){var c1=sap.ui.core.Popup.Dock;B.getItems()[0].oSelectedCell=i;B.open(false,b1,c1.BeginBottom,c1.BeginTop,b1,0+" "+0,sap.ui.core.Collision.flip);}}},v);}function Z(i,e){var b1=o.getHorizontalHeaderScrollbar();if(b1){y=b1.getScrollPosition();x=Math.max(y-i,0);if(e>0){o.scrollHeaderHorizontal(x);}}}function $(i,e,b1,c1){if(o.getPropertyBag().isPixelScrolling()){if(F){O=F.getScrollPosition();N=Math.max(O-e,0);}if(G){y=G.getScrollPosition();x=Math.max(y-i,0);}if(F&&c1>0){o.scrollVertical(N);}if(G&&b1>0){o.scrollHorizontal(x);}}else{if(z.getOpenState()===sap.ui.core.OpenState.CLOSED){z.open(-1);}if(F){if(o.getRenderEngine().isVScrolledToEnd()){if(U.sign(e)>0){V-=U.sign(e);}else{V=0;}}else{V-=U.sign(e);}O=r.getRenderStartRow();N=Math.max(Math.floor(V/I)+O,0);N=Math.min(D.getRowCnt()-1,N);}if(G){if(o.getRenderEngine().isHScrolledToEnd()){if(U.sign(i)>0){H-=U.sign(i);}else{H=0;}}else{H-=U.sign(i);}y=g.getRenderStartCol();x=Math.max(Math.floor(H/I)+y,0);x=Math.min(D.getColCnt()-1,x);}X();}}function _(e){U.cancelEvent(e);if(t==false){return true;}if(e.originalEvent.touches&&e.originalEvent.touches.length){e=e.originalEvent.touches[0];}else if(e.originalEvent.changedTouches&&e.originalEvent.changedTouches.length){e=e.originalEvent.changedTouches[0];}var i=e.pageX;var b1=e.pageY;var c1=i-l;var d1=b1-L;var e1=Math.abs(d1);var f1=Math.abs(c1);if(e1>f1&&f1<10){c1=0;f1=0;}else if(f1>e1&&e1<10){d1=0;e1=0;}if(c1==0&&d1==0){m=false;return true;}m=true;if(u){window.clearTimeout(u);u=null;}F=o.getVScrollbar();G=o.getHScrollbar();J=false;if(s===r.getId()){J=o.isHeaderHScrolling()&&(c1!==0);if(!J){c1=0;f1=0;}}else if(s===g.getId()){d1=0;e1=0;}else if(s===h.getId()){J=o.isHeaderHScrolling()&&(c1!==0);if(!J){c1=0;f1=0;}d1=0;e1=0;}if(J===true){Z(c1,f1);}else{$(c1,d1,f1,e1);}l=e.pageX;L=e.pageY;return null;}function a1(e){U.cancelEvent(e);if(u){window.clearTimeout(u);u=null;}if(t==false){return true;}if(!m){E.executeOnClickAction(e);}t=false;m=false;if(!J){if(!o.getPropertyBag().isPixelScrolling()){if((z.getOpenState()===sap.ui.core.OpenState.OPEN)||(z.getOpenState()===sap.ui.core.OpenState.OPENING)){z.close();}var i=false;if(N!==O){o.scrollVertical(N);i=true;}if(x!==y){o.scrollHorizontal(x);i=true;}if(i===true){E.attachEvents();}}V=0;H=0;}}this.registerTouchEvents=function(e){W();var i="touchstart";if(o.getPropertyBag().isTestMobileMode()&&!o.getPropertyBag().isMobileMode()){i="mousedown";}j.unbind(i);j.bind(i,Y);k.unbind(i);k.bind(i,Y);n.unbind(i);n.bind(i,Y);p.unbind(i);p.bind(i,Y);i="touchmove";if(o.getPropertyBag().isTestMobileMode()&&!o.getPropertyBag().isMobileMode()){i="mousemove";}e.unbind(i);e.bind(i,_);i="touchend";if(o.getPropertyBag().isTestMobileMode()&&!o.getPropertyBag().isMobileMode()){i="mouseup";}e.unbind(i);e.bind(i,a1);};this.setColResizer=function(e){K=e;};};return sap.zen.crosstab.TouchHandler;});
