/*
 * SAPUI5
  (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/ui/model/json/JSONModel","sap/ovp/cards/custom/Component","sap/viz/ui5/controls/common/feeds/FeedItem","sap/zen/commons/thirdparty/lodash"],function(L,J,C,F,_){"use strict";var I=C.extend("sap.zen.dsh.InACard.Component",{metadata:{manifest:"json",properties:{contentFragment:{type:"string",defaultValue:"sap.zen.dsh.InACard.fragment.InACard"},controllerName:{type:"string",defaultValue:"sap.zen.dsh.InACard.controller.InACard"},footerFragment:{type:"string",defaultValue:""},widgetType:{widgetType:"sap.zen.dsh.WidgetType",defaultValue:"pivot"},dataProviderName:"string"}},init:function(){var t=this;C.prototype.init.apply(t,arguments);t.setModel(t.getComponentData().model,"om");t.setModel(t.getComponentData().model,"$FlexVariants");var g=sap.ui.getCore().byId("mainView");if(g&&!g.getModel("$FlexVariants")){g.setModel(t.getModel("om"),"$FlexVariants");}var c=sap.ui.getCore().byId("viewPortContainer")&&sap.ui.getCore().byId("viewPortContainer").getPages();c=c&&c[0].getComponentHandle&&c[0].getComponentHandle()&&c[0].getComponentHandle().getInstance();if(c&&!c.getModel("$FlexVariants")){c.setModel(t.getModel("om"),"$FlexVariants");}var d;t.getRootControl().setBusy(true);t.rootControlLoaded().then(function(){return t.getRootControl().loaded();}).then(function(){t.setDataProviderName(t.getRootControl().getModel("ovpCardProperties").getProperty("/dataProviderName"));return t.getModel("om").dataLoaded();}).then(function(){d=t.getModel("om").getDataProvider(t.getRootControl().getModel("ovpCardProperties").getProperty("/dataProviderName"));t.getRootControl().getModel("ovpCardProperties").setProperty("/title",d.QueryTitle||d.QueryName);var D=t.getRootControl().getModel("ovpCardProperties").getProperty("/dataProviderName");var v=t.getRootControl().byId("idVizFrame");var b=_.clone(v.getBindingInfo("vizProperties"));b.parts[0].path=["/dataProvider/",D,"/Chart/vizProperties"].join("");var f=t.getRootControl().byId("flatDS");var B=_.clone(f.getBindingInfo("dimensions"));B.path=["/dataProvider/",D,"/FlatDimensions"].join("");f.bindAggregation("dimensions",B);var o=_.clone(f.getBindingInfo("measures"));o.path=["/dataProvider/",D,"/Measures"].join("");f.bindAggregation("measures",o);var a=_.clone(f.getBindingInfo("data"));a.path=["/dataProvider/",D,"/FlatResultSet"].join("");f.bindAggregation("data",a);t.getModel("om").attachRequestCompleted(function(){v.bindProperty("vizProperties",b);v.destroyFeeds();var e=t.getModel("om").getProperty(["/dataProvider/",D,"/Chart/Feeds"].join(""));_.forEach(e,function(h){v.addFeed(new F({type:h.type,uid:h.uid,values:h.values}));});var V=t.getRootControl();_.forEach(V.byId("flatDS").getDimensions(),function(h){h.bindProperty("value","om>"+h.getIdentity());});_.forEach(V.byId("flatDS").getMeasures(),function(m){m.bindProperty("value","om>"+m.getIdentity());});V.byId("idVizFrame").setVizProperties(_.clone(V.byId("idVizFrame").getVizProperties()));});return t.getModel("om").synchronize();}).catch(function(e){L.error(e);}).then(function(){t.getRootControl().setBusy(false);});}});return I;});
