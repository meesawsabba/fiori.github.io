/*!
 * SAPUI5
  (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define("sap/zen/dsh/olap/OlapListBinding",["sap/base/Log","jquery.sap.global","sap/ui/model/ChangeReason","sap/ui/model/ListBinding","sap/zen/dsh/olap/calculateId","sap/zen/commons/thirdparty/lodash"],function(L,q,C,a,c,_){"use strict";var O=a.extend("sap.zen.dsh.olap.OlapListBinding",{constructor:function(m,p,b,s,f,P){var t=this;var d=null;var i=[];var l=null;t.oContext=b;var e=null;var g=null;var h=null;var j=null;var k=null;a.apply(t,[m,p,t.oContext,s,f,P]);function r(S,n){var o=S;var v=n;if(!o){o=0;}if(!v){v=d;}var E=Math.min(o+v,i.length);var w=m.resolve(p,t.oContext);if(w&&!w.endsWith("/")){w+="/";}return _.map(_.range(o,E),function(x){try{return m.getContext(w+i[x]);}catch(y){L.error(y);}});}t.setContext=function(o){if(t.oContext!==o){t.oContext=o;if(t.isRelative()){t.update();t._fireChange({reason:C.Context});}}};t.getLength=function(){return d;};function u(){return i.length;}t.updateIndices=function(){i=_.map(l,function(o,n){return n;});};t.sort=function(){throw new Error("OlapListBinding does not support client side sort");};t.applySort=function(){throw new Error("OlapListBinding does not support client side sort");};t.filter=function(){throw new Error("OlapListBinding does not support client side filter");};t.applyFilter=function(){throw new Error("OlapListBinding does not support client side filter");};t.getDistinctValues=function(n){var M={};return _.reduce(l,function(R,o){var v=m.getProperty(n,o);if(!M[v]){M[v]=true;R.push(v);}return R;},[]);};t.getId=_.constant(c());t.getContexts=function(S,n){var o=n;var v=S;e=v;h=o;if(!v){v=0;}if(!o){o=d;}var w=r(v,o);var x=null;try{x=_.map(w,function(y){try{return t.getContextData(y);}catch(E){L.error(E);}});if(j&&v<g){delete w.diff;}g=v+o;k=w.slice(0);j=x.slice(0);}catch(E){L.warning("OlapListBinding: Cyclic dependency");L.error(E);throw new Error("Cyclic dependeny");}return w;};t.getCurrentContexts=function(){return k||[];};t.updateIndices=function(){i=_.map(l,function(o,n){return n;});};t.update=function(){var o=m.getProperty(p,t.oContext);if(o){l=q.extend(true,(Array.isArray(o)?[]:{}),o);t.updateIndices();d=u();}else{l=[];i=[];d=0;}};t.checkUpdate=function(F){var o=null;if(t.bSuspended&&!t.bIgnoreSuspend&&!F){return;}var n=false;o=m.getProperty(t.sPath,t.oContext);if(!(o&&o.length===0&&!l)&&(o&&((!l||l.length!==o.length)))){n=true;}if(!q.sap.equal(l,o)){t.update();}var v=r(e,h);if(k){n=(k.length!==v.length)?true:_.some(j,function(w,x){return t.getContextData(v[x])!==w;});}else{n=v&&v.length;}if(n||F){t._fireChange({reason:C.Change});}};a.apply(t,arguments);}});return O;});
