/*
 * SAPUI5
  (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["jquery.sap.global","sap/base/Log","sap/ui/commons/Carousel","sap/zen/dsh/utils/BaseHandler"],function(q,L,C,B){"use strict";C.extend("com.sap.ip.bi.FragmentGallery",{initDesignStudio:function(){this.setAnimationDuration(100);},previousContentLength:{},renderer:{},orientations:{HORIZONTAL:"horizontal",VERTICAL:"vertical"},mode:{IMAGE:"image",TEXT:"text",IMAGETEXT:"imagetext"},afterDesignStudioUpdate:function(){var d=this.getItemSize();if(this.orientation===this.orientations.HORIZONTAL){this.removeStyleClass("zenFragmentGallery-Vertical");this.addStyleClass("zenFragmentGallery-Horizontal");if(d!==undefined){this.setDefaultItemWidth(d);}}else{this.removeStyleClass("zenFragmentGallery-Horizontal");this.addStyleClass("zenFragmentGallery-Vertical");if(d!==undefined){this.setDefaultItemHeight(d);}}this.setOrientation(this.orientation);this.addStyleClass("zenFragmentGallery");var g=this.items;if(!g||g.length===0){this.destroyContent();var b=this.createItem("","","");this.addContent(b);this.setProperty("firstVisibleIndex",0);this.previousContentLength=JSON.parse(g).length;}else{this.destroyContent();var i=JSON.parse(g);this.createItemContent(i,this.oControlProperties.dragDrop);this.refreshSelection();if(this.previousContentLength>JSON.parse(g).length&&this.getFirstVisibleIndex()>0){var c=this.previousContentLength-JSON.parse(g).length;if(c>0){this.setProperty("firstVisibleIndex",this.getFirstVisibleIndex()-(c));}else{this.setProperty("firstVisibleIndex",0);}}this.previousContentLength=JSON.parse(g).length;return this;}this.refreshSelection();},refreshSelection:function(){var c=this.getContent();for(var i=0;i<c.length;i++){var l=c[i];if(l.zenKey===this.selectedId){l.zenSelected=true;}else{l.zenSelected=false;}if(l.getDomRef()!=null){if(l.zenSelected){q(l.getDomRef().parentElement).addClass("selectedItem");}else{q(l.getDomRef().parentElement).removeClass("selectedItem");}}}},createItemContent:function(a,d){var g=this.getGalleryMode().toLowerCase();if(this.orientation===this.orientations.HORIZONTAL){this.removeStyleClass("zenFragmentGallery-Vertical");this.addStyleClass("zenFragmentGallery-Horizontal");}else{this.removeStyleClass("zenFragmentGallery-Horizontal");this.addStyleClass("zenFragmentGallery-Vertical");}for(var i=0;i<a.length;i++){var b;if(g===this.mode.IMAGE){b=this.createItem(a[i].key,a[i].text,a[i].image,"");}else if(g===this.mode.TEXT||g===this.mode.IMAGETEXT){b=this.createItem(a[i].key,a[i].text,a[i].image,a[i].description);}if(d){var c=new B.dispatcher.dragArea(b,"",{bmid:a[i].key,title:a[i].text},null,null,null,null,null,null);B.dispatcher.dragHandlerInstance.registerDragArea(c);}this.addContent(b);}},createImage:function(k,t,i,o,d){if(i===""||i.indexOf("/aad/")===0||i.indexOf("http")===0){}else{i=this.ImagePrefix+i;}o.src=i;o.alt=t;if(d!=null&&d.length>0){o.tooltip=d;}else{o.tooltip=t;}var I=new sap.ui.commons.Image(o);I.addStyleClass("zenFragmentGallery-Image-thumb");I.addDelegate({onAfterRendering:function(a){q(a.srcControl.getFocusDomRef()).attr("draggable","false");}});I.zenKey=k;return I;},createText:function(k,t,i,d){var T=new sap.ui.commons.TextView(this.sId+"txt-"+k,{text:t,width:"100%",height:"100%",wrapping:true,enabled:true,visible:true,textAlign:sap.ui.core.TextAlign.Center,tooltip:d});T.zenKey=k;return T;},createItem:function(k,t,i,d){var a=this;var g=a.items;if(g){var b=JSON.parse(g);if(b.length>0&&b[0].key==="ZEN_BLANK"){b.splice(0,1);this.setItems(JSON.stringify(b));}}var c=this.getGalleryMode().toLowerCase();var e;if(c===this.mode.IMAGE){e=t;}else{e=d;}var l=new sap.zen.commons.layout.AbsoluteLayout(this.sId+"ly-"+k,{width:"100%",height:"100%",tooltip:e}).attachBrowserEvent("click",function(){a.setSelectedId(k);a.fireDesignStudioPropertiesChanged(["selectedId"]);a.fireDesignStudioEvent("onSelectionChange");});var f,h;if(c===this.mode.IMAGE){f=this.createImage(k,t,i,{width:"80%",height:"80%"},"");if(f!=null){l.addContent(f);l.zenImage=f;l.addStyleClass("zenFragmentGallery-Image");}}else if(c===this.mode.TEXT){h=this.createText(k,t,i,d);if(h!=null){l.addStyleClass("zenFragmentGallery-Txt");l.addContent(h,{});}}else if(c===this.mode.IMAGETEXT){l.addStyleClass("zenFragmentGallery-ImgTxt");var j=new sap.zen.commons.layout.AbsoluteLayout(this.sId+"image"+k,{width:"50%",height:"100%"});var m=new sap.zen.commons.layout.AbsoluteLayout(this.sId+"text"+k,{width:"50%",height:"100%"});f=this.createImage(k,t,i,{width:"50%",height:"50%"},d);h=this.createText(k,t,i,d);j.addContent(f,{top:"25%",left:"25%"});m.addContent(h);var n=new sap.ui.commons.Image({src:"zen.rt.components.ui5/fragmentgallery/images/delete/delete_normal.svg",visible:true});l.attachBrowserEvent("mouseenter",function(){n.setVisible(true);}).attachBrowserEvent("mouseleave",function(){n.setVisible(false);});n.attachBrowserEvent("mouseenter",function(){n.setVisible(true);n.setSrc("zen.rt.components.ui5/fragmentgallery/images/delete/delete_hover.svg");});n.attachBrowserEvent("mouseleave",function(){n.setSrc("zen.rt.components.ui5/fragmentgallery/images/delete/delete_normal.svg");});n.attachPress(function(){a.setSelectedId(k);a.fireDesignStudioPropertiesChanged(["selectedId"]);a.fireDesignStudioEvent("onDeletion");});l.addContent(j,{left:"0px"}).addContent(m,{right:"0px"});if(k!==""&&this.oControlProperties.deletionAllowed){m.addContent(n,{right:"0px"});n.setVisible(false);}l.zenImage=f;}l.onAfterRendering=function(){if(l.zenSelected){q(l.getDomRef().parentElement).addClass("selectedItem");}else{q(l.getDomRef().parentElement).removeClass("selectedItem");}};l.layoutID=this.sId+"ly-"+k;l.zenKey=k;l.zenText=t;l.zenURL=i;return l;},createImageLayout:function(i){var t=this;if(i!=null){var I=new sap.zen.commons.layout.AbsoluteLayout(this.sId+"ly-"+i.key,{width:"45%",}).attachBrowserEvent("click",function(){t.setSelectedId(i.key);t.fireDesignStudioPropertiesChanged(["selectedId"]);t.fireDesignStudioEvent("onSelectionChange");});var o=this.createImage(i.key,i.text,i.image,{width:"100%",height:"100%"},"");I.addContent(o);I.addStyleClass("hover");I.onAfterRendering=function(){if(I.zenSelected){q(I.getDomRef().parentElement).addClass("selectedItem");}else{q(I.getDomRef().parentElement).removeClass("selectedItem");}};I.zenKey=i.key;I.zenText=i.text;return I;}},setGalleryMode:function(v){v=v.toLowerCase();if(v===""){v=this.mode.IMAGE;}if(this.galleryMode!==v){this.galleryMode=v;}},setItems:function(v){if(this.items===v){return;}else{this.items=v;}},getItems:function(){return this.items;},removeItem:function(k){if(this.itemKeyExists(k)){var a=this.items;var b=JSON.parse(a);for(var i=0;i<b.length;i++){if(b[i].key===k){this.setDeletionKey(b[i].key);}}this.setItems(JSON.stringify(b));this.fireDesignStudioPropertiesChanged(["deletionKey"]);}},itemKeyExists:function(k){if(this.items!==undefined){var a=JSON.parse(this.items);for(var i=0;i<a.length;i++){if(a[i].key===k){return true;}}}return false;},getGalleryMode:function(){return this.galleryMode.toLowerCase();},getItemSize:function(){return this.itemSize;},setItemSize:function(v){this.itemSize=v;},setImageUrl:function(v){this.ImageUrl=v;this.ImagePrefix=this.ImageUrl.substring(0,this.ImageUrl.indexOf("DUMMY.PNG"));},getImageUrl:function(){return this.ImageUrl;},setGalleryOrientation:function(v){if(!v){v=this.orientations.HORIZONTAL;}this.orientation=v;},getGalleryOrientation:function(){return this.orientation;},setSelectedId:function(v){if(v){this.selectedId=v;}},getSelectedId:function(){return this.selectedId;},selectedIdExists:function(k){var t=this;var c=t.getContent();for(var i=0;i<c.length;i++){if(c[i].zenKey===k){return true;}}return false;},setDeletionKey:function(v){if(v==null){v="";}this.deletionKey=v;},getDeletionKey:function(){if(this.deletionKey==null||this.deletionKey===undefined){return"";}return this.deletionKey;},updateLastItemStyle:function(){var a={};var c=q(document.getElementById(this.sId+"-contentarea"));var s=q(document.getElementById(this.sId+"-scrolllist"));var m=10;var i,b,n;if(this.orientation===this.orientations.HORIZONTAL){for(i=0;i<this.getContent().length;i++){var d;try{d=this.getContent()[i].getWidth();if(d.substr(-1)==="%"){d=this.getItemSize();}}catch(e){L.error(e);d=this.getItemSize();}}var f=Math.max(0,parseInt(d,m));var t=Math.floor(this.getDomRef().clientWidth);b=t-this.getHandleSize()*2-1;n=this.getVisibleItems();if(n===0){n=Math.floor(b/f);}var g=c.width();var v=((this._iMaxWidth*n)+(n*m));if((v+m)>g){if(this.getFirstVisibleIndex()===0){a["margin-left"]=0;}else{a["margin-left"]=-((v+m)-g);}}}else{for(i=0;i<this.getContent().length;i++){var h;try{h=this.getContent()[i].getHeight();if(h.substr(-1)==="%"){h=this.getItemSize();}}catch(e){L.error(e);h=this.getItemSize();}}var j=Math.max(0,parseInt(h,m));var k=Math.floor(this.getDomRef().clientHeight);b=k-this.getHandleSize()*2-1;n=this.getVisibleItems();if(n===0){n=Math.floor(b/j);}this._iMaxHeight=b/n;var l=c.height();var o=((this._iMaxHeight*n)+(n*m));if((o+10)>l){if(this.getFirstVisibleIndex()===0){a["margin-top"]=0;}else{a["margin-top"]=-((o+m)-l);}}}s.animate(a,this.getAnimationDuration());},showPrevious:function(){if(this.getFirstVisibleIndex()>0&&this.getContent()[this.getFirstVisibleIndex()]!==this.getContent()[0]){var a={};a[this._sAnimationAttribute]=0;var s=q.sap.byId(this.getId()+"-scrolllist");if(s.children("li").length<2){return;}s.stop(true,true);s.css(this._sAnimationAttribute,-this._iMaxWidth);var $=s.children("li:last");var b=s.children("li:first");this._showAllItems();$.insertBefore(b);s.append($.sapExtendedClone(true));var t=this;s.children("li:last").remove();t.setProperty("firstVisibleIndex",t._getContentIndex(s.children("li:first").attr("id")),true);t._hideInvisibleItems();s.animate(a,this.getAnimationDuration());}},showNext:function(){var m=10;var t={};var c,i;if(this.orientation===this.orientations.HORIZONTAL){t=this.getDomRef().clientWidth;for(i=0;i<this.getContent().length;i++){try{c=this.getContent()[i].getWidth();if(c.substr(-1)==="%"){c=this.getItemSize();}}catch(e){L.error(e);c=this.getItemSize();}}}else if(this.orientation===this.orientations.VERTICAL){t=this.getDomRef().clientHeight;for(i=0;i<this.getContent().length;i++){try{c=this.getContent()[i].getHeight();if(c.substr(-1)==="%"){c=this.getItemSize();}}catch(e){L.error(e);c=this.getItemSize();}}}var a=Math.max(0,parseInt(c,m));var b=t-this.getHandleSize()*2-1;var n=this.getVisibleItems();if(n===0){n=Math.floor(b/a);}if((this.getFirstVisibleIndex()+n)<this.getContent().length){var A={};A[this._sAnimationAttribute]=-this._iMaxWidth;var s=q.sap.byId(this.getId()+"-scrolllist");s.stop(true,true);var d=this._sAnimationAttribute;var $=s.children("li:first");var f=this;this._showAllItems();$.appendTo(s);$.sapExtendedClone(true).insertBefore(s.children("li:first"));s.animate(A,this.getAnimationDuration(),function(){s.children("li:first").remove();q(this).css(d,"0px");f.setProperty("firstVisibleIndex",f._getContentIndex(s.children("li:first").attr("id")),true);f._hideInvisibleItems();});}else{this.updateLastItemStyle();}}});});
