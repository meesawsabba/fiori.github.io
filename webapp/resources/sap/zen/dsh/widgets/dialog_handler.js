/*
 * SAPUI5
  (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["jquery.sap.global","sap/zen/commons/thirdparty/lodash","sap/zen/dsh/utils/BaseHandler","sap/m/Dialog"],function(jQuery,_,BaseHandler,MDialog){"use strict";var DialogHandler=function(){BaseHandler.apply(this,arguments);var dispatcher=BaseHandler.dispatcher;this.createAndAdd=function(c,C,o,a,A){if(sap.zen.designmode){if(o.width){this._componentWidth=o.width;}if(o.height){this._componentHeight=o.height;}o.leftmargin=C.fullscreen?0:(Math.floor(jQuery(document).width()/2-o.width/2));o.topmargin=C.fullscreen?0:(Math.floor(jQuery(document).height()/2-o.height/2));if(C.fullscreen){o.width=jQuery(document).width();o.height=jQuery(document).height();}var l=this.createAbsoluteLayout();l.addStyleClass("uidialogzenroot");l.oDialogProperties={isAbsLayout:true};l.titleArea=this.createTitleAreaForDesignMode(this.oAbsLayout,C);l.contentArea=this.createContentAreaForDesignMode(this.oAbsLayout,C);l.footerArea=this.createFooterAreForDesignModea(this.oAbsLayout,C);a(l,A);BaseHandler.dispatcher.updateComponentProperties(l,o);this.init(l,C,o);l.fnOrigAfterRendering=l.onAfterRendering;l.onAfterRendering=function(){if(this.fnOrigAfterRendering){this.fnOrigAfterRendering();}var t=this;setTimeout(function(){if(t.footerArea){var d=t.footerArea.getPositions();var e=0;for(var i=d.length-1;i>=0;i--){var f=d[i];f.updatePosition({"right":e+"px","top":"0px"});e+=f.$().width();}}},50);};l.onAfterRendering();return l;}else{var b=this.createDefaultProxy(C["id"]);b.oDialogProperties={isAbsLayout:false,oComponentProperties:null,oProperties:null,tDialogContent:[],oMsgComponent:null,oMsgControl:null};a(b,A);this.init(b,C,o);return b;}};this.update=function(c,C,o){C=C||{};if(o.width){this._componentWidth=o.width;}if(o.height){this._componentHeight=o.height;}var a=o.width?o.width:this._componentWidth;var b=o.height?o.height:this._componentHeight;var d=Math.floor(jQuery(document).width()/2-a/2);var e=Math.floor(jQuery(document).height()/2-b/2);o.leftmargin=C.fullscreen?1:d;o.topmargin=C.fullscreen?1:e;if(C.fullscreen){o.width=jQuery(document).width();o.height=jQuery(document).height();}this.init(c,C,o);if(sap.zen.designmode||!Object.prototype.hasOwnProperty.call(C,"show")){var l=c.oDialogProperties.isAbsLayout?c:c.oDialogProperties.oAbsLayout;if(l){l.onAfterRendering();}}return c;};this.init=function(c,C,o){if(sap.zen.designmode){var l,a;if(c.footerArea&&C.Buttons){c.footerArea.removeAllContent();for(var i in C.Buttons){l=C.Buttons[i].Button;a=new sap.m.Button({text:l.text,enabled:l.buttonenabled==="X",visible:l.buttonvisible==="X"});c.footerArea.addContent(a,{"top":"-1000px"});}}if(c.titleArea&&C.title){c.titleArea.removeAllContent();var b=this.createTextView({text:C.title});b&&c.titleArea.addContent(b);}if(C.content){var d=c.contentArea;var e=C.content;this.updateChildren(e,d,function(n,f){dispatcher.insertIntoAbsoluteLayoutContainer(d,n,f);},function(f){d.removeContent(f);});}}else{this.extractDialogProperties(c,C,o);this.initDialog(c);}};if(sap.zen.designmode){sap.zen.designmode.DialogContainerDecorator=function(d,p,h){"use strict";sap.zen.designmode.AbsLayoutDecorator.apply(this,arguments);this._debugInfo="DialogContainerDecorator";var a=this;function f(e){var C=h.getAllChildren(p,true);for(var g in C){var o=d.getDecorator(C[g].o);if(o){e(o);}}}function c(j,e){var r={};var g=j.position();var i=e.position();if(this.origPos){var l=this.origPos.left-g.left;var n=l+(i.left);r["left"]=n+"px";var t=this.origPos.top-g.top;var k=t+(i.top);r["top"]=k+"px";}return r;}var s=this.create;var b=this.update;this.create=function(){s.apply(this,arguments);};this.moveBegin=function(){sap.zen.designmode.DecoratorManager.instance.abortMove();this.origPos=this.jqDecorator.position();};this.moveEnd=function(){f(function(C){if(C){var e=c.bind(a,C.$(),a.jqDecorator)();C.$().css(e);}});};this.update=function(){b.apply(this,arguments);};this.getDockingVisualizers=function(){return{};};};}this.createTitleAreaForDesignMode=function(p){var l=this.createAbsoluteLayout();l.addStyleClass("uidialogzentitle");p.insertContent(l,0);return l;};this.createFooterAreaForDesignMode=function(p){var l=this.createAbsoluteLayout();l.addStyleClass("uidialogzenfooter sapMFooter-CTX");p.insertContent(l,2,{"bottom":"0px","left":"0px"});return l;};this.createContentAreaForDesignMode=function(p){var l=this.createAbsoluteLayout();l.addStyleClass("uidialogzencontent");p.insertContent(l,1,{"top":"2.5rem"});return l;};this.extractDialogProperties=function(c,C,o){c.oDialogProperties.oComponentProperties=o;c.oDialogProperties.oProperties=C;c.oDialogProperties.oMsgComponent=null;c.oDialogProperties.tDialogContent=[];if(C.content&&C.content.length>0){for(var i=0;i<C.content.length;i++){var l=C.content[i];if(l&&l.component){if(l.component.type==="MESSAGEVIEW_COMPONENT"&&!c.oDialogProperties.oMsgComponent){c.oDialogProperties.oMsgComponent=l.component;}else{c.oDialogProperties.tDialogContent.push(l);}}}}};this.initDialog=function(c){if(!c||!c.oDialogProperties||!c.oDialogProperties.oProperties){return;}var l=c.oDialogProperties.oProperties;var a=Object.prototype.hasOwnProperty.call(l,"show")&&l.show;if(!c.oDialog){if(a){c.oDialog=new MDialog(c.getId()+"_dlg",{stretch:l.fullscreen,resizable:l.resizable,draggable:l.draggable});c.oDialog.attachAfterClose(this.dialogCallbackOnAfterClose(c));}}if(c.oDialog){if(l.title){c.oDialog.setTitle(l.title);}this.initDialogMessage(c);this.initDialogContent(c);this.initDialogButtons(c);if(a){this.showDialog(c);}else{this.hideDialog(c);}}};this.initDialogMessage=function(c){if(!c||!c.oDialogProperties){return;}if(c.oDialogProperties.oMsgComponent){var l=dispatcher.getComponentIdForControlId(c.oDialogProperties.oMsgComponent.content.control.id)==null;if(l){c.oDialogProperties.oMsgControl=dispatcher.dispatchCreateControl(c.oDialogProperties.oMsgComponent);}else{dispatcher.dispatchUpdateControl(c.oDialogProperties.oMsgComponent);dispatcher.updateComponentProperties(c.oDialogProperties.oMsgControl,c.oDialogProperties.oMsgComponent);}}};this.initDialogContent=function(c){if(!c||!c.oDialog||!c.oDialogProperties){return;}var l=null;l=sap.ui.getCore().byId(c.getId()+"_abslayout");if(!l){l=this.createAbsoluteLayout(c.getId()+"_abslayout");l.zenControlType="absolutelayout";l.setVisible(false);l.onAfterRendering=this.dialogCallbackOnAfterRendering(l,c);}dispatcher.updateComponentProperties(l,c.oDialogProperties.oComponentProperties);this.updateChildren(c.oDialogProperties.tDialogContent,l,function(n,i){dispatcher.insertIntoAbsoluteLayoutContainer(l,n,i);},function(C){l.removeContent(C);});l.setVisible(true);if(c.oDialogProperties.oProperties.fullscreen){l.setWidth("100%");}c.oDialog.removeAllContent();c.oDialog.insertContent(l,0);};this.initDialogButtons=function(c){if(!c||!c.oDialog||!c.oDialogProperties||!c.oDialogProperties.oProperties){return;}var l=c.oDialogProperties.oProperties;if(l.Buttons&&l.Buttons.length){c.oDialog.removeAllButtons();for(var i in l.Buttons){var a=l.Buttons[i].Button;var b=this.createButton(a.name);b.setText(a.text);b.setEnabled(a.buttonenabled==="X");b.setVisible(a.buttonvisible==="X");if(a.onclick){(function(s){b.attachPress(function(){var d=new Function(s);d();});})(a.onclick);}else{b.setEnabled(false);}c.oDialog.addButton(b);}}};this.initDialogFooter=function(c){if(!c||!c.oDialog||!c.oDialogProperties.oMsgControl){return;}var l=sap.ui.getCore().byId(c.oDialog.getId()+"-footer");if(!l){return;}var a=c.oDialogProperties.oMsgControl;var b=[];b.push(a);var d=l.getContent();if(d){for(var i=0;i<d.length;i++){var e=d[i];if(e&&e!==a){b.push(e);}}}l.removeAllContent();for(i=0;i<b.length;i++){e=b[i];if(e){l.addContent(e);}}};this.showDialog=function(c){if(!c||!c.oDialog){return;}if(!c.oDialog.isOpen()){c.oDialog.open();}};this.hideDialog=function(c){if(!c||!c.oDialog){return;}if(c.oDialog.isOpen()){c.oDialog.close();}};this.dialogCallbackOnAfterClose=function(oControl){return function(){oControl.oDialog=null;this.removeAllButtons();this.removeAllContent();this.destroy();var loMsgControl=sap.ui.getCore().byId(oControl.oDialogProperties.oMsgControl.getId());if(!loMsgControl){dispatcher.dispatchRemove(oControl.oDialogProperties.oMsgControl);}if(oControl.oDialogProperties.oProperties.command){eval(oControl.oDialogProperties.oProperties.command);}};};this.dialogCallbackOnAfterRendering=function(o,c){o.fOrigOnAfterRendering=o.onAfterRendering;var t=this;return function(){if(this.fOrigOnAfterRendering){this.fOrigOnAfterRendering();}t.initDialogFooter(c);};};this.fnOrigRemove=this.remove;this.remove=function(c){if(this.fnOrigRemove&&sap.zen.designmode.DecoratorManager.instance.getDecorator(c)){this.fnOrigRemove.apply(this,c);}};this.applyForChildren=function(a,f){if(!a.getPositions){return null;}var l=a.getPositions();for(var i=0;i<l.length;i++){var b=l[i].getControl();if(b){var c=f(b);if(c)return c;}}return null;};this.getDefaultProxyClass=function(){return["sap.m.Text"];};this.getType=function(){return"dialog";};this.getDecorator=function(){return"DialogContainerDecorator";};this.fnOrigGetAllChildren=this.getAllChildren;this.getAllChildren=function(c,i){if(i){var r={},l=0;for(var a in c.getPositions()){var b=c.getPositions()[a].getControl().getPositions();b.map(function(p){var d=p.getControl();if(d){var e=dispatcher.getComponentIdForControl(d);if(e){r[e]={i:l,o:d};l++;}}});}return r;}else{if(this.fnOrigGetAllChildren){return this.fnOrigGetAllChildren.apply(this,arguments);}}return null;};};var instance=new DialogHandler();BaseHandler.dispatcher.addHandlers(instance.getType(),instance);return instance;});
