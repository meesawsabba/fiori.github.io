/*
 * SAPUI5
  (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["jquery.sap.global","sap/zen/commons/thirdparty/lodash","sap/ui/model/json/JSONModel","sap/m/VBox","sap/m/Label","sap/m/Token","sap/m/Tokenizer","sap/m/Button","sap/m/Toolbar","sap/m/SearchField","sap/m/StandardListItem","sap/m/SelectDialog","sap/ui/core/BusyIndicator","sap/ui/model/Sorter","sap/ui/model/Filter","sap/zen/dsh/utils/BaseHandler","sap/zen/dsh/widgets/ValueHelpDialog","sap/zen/dsh/widgets/emptyComponent","sap/zen/dsh/ValueHelpRangeOperation","sap/ui/comp/util/FormatUtil","sap/ui/core/format/DateFormat"],function(q,_,J,V,L,T,a,B,b,S,c,d,f,g,F,h,k,E,l){"use strict";var m=h.dispatcher;var n=function(){h.apply(this,arguments);var t=this;this.oClipboard={};this.create=function(C,e){var i=t.createUI5Identifier(e["id"]);var j;var y=new J();y.setData(e);var z=y.getProperty("/property/memberselector")||y.getProperty("/property/popupreference");if(z){j=C?C:new E(i);j.onAfterRendering=function(){new Function(t.prepareCommand(j.getModel().getProperty("/command/showfilterdialog"),"__STRING__",j.getModel().getProperty("/characteristics/0/characteristic/name")))();j.onAfterRendering=undefined;};}else{j=C?C:new V(i).addStyleClass("sapzenfilterpanelM");if(!y.getProperty("/property/showembedded")){j.addStyleClass("sapzendimensionfilterM");}}if(!y.getProperty("/property/variablescreen")){j.ZEN_IdToDimensionMap={};}j.setModel(y);if(C){j.removeAllItems();}if(!z){this.addItems(j);j.ZEN_submit=this.submitExternal(y,true);j.ZEN_submit_with_apply=this.submitExternal(y,true,true);j.ZEN_check=this.submitExternal(y,false);j.ZEN_cancel=function(){new Function(y.getProperty("/command/cancelonlyfilter"))();};}var A=j.exit;j.exit=function(){if(A){A.apply(j,arguments);}(sap.zen.dsh.sapbi_page.appComponent&&sap.zen.dsh.sapbi_page.appComponent._bIsBeingDestroyed)||new Function(y.getProperty("/command/destroyfiltercomponent"))();};if(!this.isDesignModeD4LIncluded()){if(e.visible){j.removeStyleClass("zenHideFilterPanel");}else{j.addStyleClass("zenHideFilterPanel");}}return j;};this.update=function(C,e,j){if(C&&e){var y=e.view;if(this.isDesignModeD4LIncluded()||e.newds){C.ZEN_multiInput=[];C=this.create(C,e,j);if(y!=="DIALOG"){return C;}}if(e.changeVisibility){if(e.visible){C.removeStyleClass("zenHideFilterPanel");}else{C.addStyleClass("zenHideFilterPanel");}if(y==="SUBMIT"){C.ZEN_submit();}else if(y==="SUBMIT_WITH_APPLY"){C.ZEN_submit_with_apply();}else if(y==="CANCEL"){C.ZEN_cancel();}return C;}var z=C.getModel();var A=z.getProperty("/filters"),D;var G=z.getProperty("/property/variablescreen");var H=e.filters;if(H){A=z.getProperty("/filters");var I=false;for(var K in H){var M=H[K];D=A[K];if(!D||!M){continue;}I=true;if(e.filtercanceled||!D.dirty||G){if(G&&D.dirty){M.dirty=true;}A[K]=M;if(z.getProperty("/dialog/name")===K){z.setProperty("/dialog/filters",M);}}}z.setProperty("/filters",I?A:H);x(z,"/filters");}var N=e.validatedfilters;if(N){A=z.getProperty("/filters");for(K in N){var O=N[K];D=A[K];if(!D||!O){continue;}if(D&&D.dirty){O.dirty=true;A[K]=O;if(z.getProperty("/dialog/name")===K){z.setProperty("/dialog/filters",O);}}}x(z,"/filters");}var P=z.getProperty("/axis");var Q=false;var R=z.getProperty("/characteristics");if(R){for(i=0;i<R.length;i++){if(R[i].characteristic.axisdirty){Q=true;break;}}}var U=Q||(P&&(P.rows.dirty||P.columns.dirty));if(y==="DEFAULT"&&(e.filtercanceled||!U)&&!w(e.characteristics,R)){z.setProperty("/characteristics",e.characteristics);}var W=-1;if(y==="DIALOG"){z.setProperty("/dialog",e.dialog);if(e.characteristics&&!w(e.characteristics,R)){z.setProperty("/characteristics",e.characteristics);}var X=this.getValueHelpDialog(C);X.open();X.update();C.zenValueHelpDialog=X;}else if(y==="DIALOG_SEARCH"){var Y=e.dialog;z.setProperty("/dialog/selection",Y.selection);var Z=z.getProperty("/dialog/hierarchical");if(Z){var $=Y.members;if($){for(var i=0;i===W+1;i++){var a1=$[""+i];if(!a1){continue;}a1.level=0;W=i;}}}z.setProperty("/dialog/members",Y.members);if(C.zenValueHelpDialog){if(Z&&C.zenValueHelpDialog.getTable().collapseAll){C.zenValueHelpDialog.getTable().collapseAll();}C.zenValueHelpDialog.update();C.zenValueHelpDialog.getFilterBar().setBusy(false);if(Y.selection.maxelements||(Y.members&&(Z||Y.members.size>0))){C.zenValueHelpDialog.TableStateSearchData();}else{C.zenValueHelpDialog.TableStateDataFilled();}}}else if(y==="EXPAND_NODE"){var b1=z.getProperty(e.path).level;var c1=e.member;c1.level=b1;for(i=0;i===W+1;i++){a1=c1[""+i];if(!a1){continue;}a1.level=b1+1;W=i;}z.setProperty(e.path,e.member);if(C.zenValueHelpDialog){C.zenValueHelpDialog.update(e.messages);}}else if(y==="SUBMIT"){C.ZEN_submit();}else if(y==="SUBMIT_WITH_APPLY"){C.ZEN_submit_with_apply();}else if(y==="CANCEL"){C.ZEN_cancel();}}return C;};this.addItems=function(C){var e=C.getModel();var j=e.getProperty("/property/showembedded");if(j){var y=e.getProperty("/property/navigationpanel");var z=new S({liveChange:function(D){var G=D.getParameter("newValue");var H=new F(y?"entry/text":"characteristic/text",sap.ui.model.FilterOperator.Contains,G);var I=[H];var K=e.getProperty("/visibleprompts");if(K){I.push(s(K));}C.ZEN_multiInput=[];var M=C.ZENCharLists;for(var i=0;i<M.length;i++){M[i].getBinding("formElements").filter(I);}}});var A=new b({content:[null,z]});if(e.getProperty("/property/variablescreen")&&e.getProperty("/visibleprompts")){A.addContent(p(C,z));}C.addItem(A);}C.addItem(this.getMainItem(C));};this.getMainItem=function(C){var e=new sap.ui.layout.form.Form({editable:true,formContainers:[this.getMainContent(C)],layout:new sap.ui.layout.form.ResponsiveGridLayout({labelSpanXL:3,labelSpanL:4,labelSpanM:5,labelSpanS:12,adjustLabelSpan:false})});return e;};this.getMainContent=function(C){var e;var i=C.getModel();if(i){var j=i.getProperty("/visibleprompts");if(j){e=this.getFormContainer(C,[s(j)]);}else{e=this.getFormContainer(C);}}return e;};this.getFormContainer=function(C,e,i){var j=new sap.ui.layout.form.FormContainer({formElements:{path:"/characteristics",factory:this.getFromElementsFactory(C,i),filters:e}});C.ZENCharLists=[j];return j;};this.getFromElementsFactory=function(C,e){return function(i,j){var y=j.getModel();var z=y.getProperty(e?j.getPath("entry/name"):j.getPath("characteristic/name"));var A=e?u(y,z):j.getPath("characteristic");if(!A){return new sap.ui.layout.form.FormElement({visible:false});}var D=t.getInput(y,z,A,C);C.ZEN_multiInput=[];C.ZEN_multiInput.push(D);var G;var H;if(y.getProperty("/property/variablescreen")){G=C.getId()+"-"+t.createUI5Identifier(z);H=G+"-label";}if(y.getProperty("/property/label")){var I=new L(H).bindProperty("text",{path:A,formatter:function(M){return M.text;}});I.bindProperty("tooltip",{path:A,formatter:function(M){return M.text;}});I.bindProperty("required",{path:A,formatter:function(M){return M.mandatory;}});}var K=new sap.ui.layout.form.FormElement(G,{label:I,fields:[D]});if(C.ZEN_IdToDimensionMap){C.ZEN_IdToDimensionMap[K.getId()]=z;}return K;};};this.getInput=function(M,y,z,C){var A=this.getCharacteristicByName(M,y);var D=M.getProperty(z+"/type");var G=M.getProperty(z+"/hierarchical");var H=M.getProperty(z+"/supportsMultiSelection");var I=M.getProperty(z+"/supportsInterval");var K=M.getProperty(z+"/supportsRange");var N=M.getProperty(z+"/supportsExcluding");var O=M.getProperty(z+"/showValueHelp");var P,Q;if(M.getProperty("/property/variablescreen")){Q=C.getId()+"-"+t.createUI5Identifier(y)+"-input";}if((D==="DATE"&&!H&&!N&&!K&&!G)||(D==="TIME"&&!H&&!I)){if(I){P=new sap.m.DateRangeSelection(Q,{dateValue:{path:"/filters",mode:sap.ui.model.BindingMode.OneWay,formatter:this.getFilterFormatter(y,D,M,"from")},secondDateValue:{path:"/filters",mode:sap.ui.model.BindingMode.OneWay,formatter:this.getFilterFormatter(y,D,M,"to")},change:function(e){if(e.getParameter("valid")){P.setValueState(sap.ui.core.ValueState.None);C.hasClientError=false;var i=e.getParameter("from")?e.getParameter("from"):e.getParameter("to");var j=e.getParameter("to")?e.getParameter("to"):e.getParameter("from");var W=t.createRange(false,"BT",i,null,j,null);var X=t.createTokenFromRange(M,y,A,W);var Y=[];Y.push(X);t.applyTokensToFilter(P.getModel(),y,Y,false);}else{P.setValueState(sap.ui.core.ValueState.Error);C.hasClientError=true;v();}}});}else{if(D==="DATE"){P=new sap.m.DatePicker(Q,{valueFormat:"yyyyMMdd",dateValue:{path:"/filters",mode:sap.ui.model.BindingMode.OneWay,formatter:this.getFilterFormatter(y,D,M,"from")},change:function(e){if(e.getParameter("valid")){P.setValueState(sap.ui.core.ValueState.None);C.hasClientError=false;var i=e.getParameter("value");var j=t.createRange(false,l.EQ,i,null,null,null);var W=t.createTokenFromRange(M,y,A,j);var X=[];X.push(W);t.applyTokensToFilter(P.getModel(),y,X,false);}else{P.setValueState(sap.ui.core.ValueState.Error);C.hasClientError=true;v();}}});}else if(D==="TIME"){P=new sap.m.TimePicker(Q,{valueFormat:"HH:mm:ss",dateValue:{path:"/filters",mode:sap.ui.model.BindingMode.OneWay,formatter:this.getFilterFormatter(y,D,M,"from")},change:function(e){if(e.getParameter("valid")){P.setValueState(sap.ui.core.ValueState.None);C.hasClientError=false;var i=e.getParameter("value");var j=t.createRange(false,sap.zen.dsh.ValueHelpRangeOperation.EQ,i,null,null,null);var W=t.createTokenFromRange(M,y,A,j);var X=[];X.push(W);t.applyTokensToFilter(P.getModel(),y,X,false);}else{P.setValueState(sap.ui.core.ValueState.Error);C.hasClientError=true;v();}}});}}}else{P=new sap.m.MultiInput(Q,{showValueHelp:O?true:false,enableMultiLineMode:{path:"/filters",mode:sap.ui.model.BindingMode.OneWay,formatter:this.applyFilterToTokens(C,M,y)},tokenUpdate:function(e){if(e.getParameter("type")===sap.m.MultiInput.TokenChangeType.Removed){var W=e.getParameter("removedTokens");var X=P.getTokens().filter(function(b1){return W.every(function(c1){return c1!==b1;});});t.applyTokensToFilter(P.getModel(),y,X,true);}else if(e.getParameter("type")===sap.m.MultiInput.TokenChangeType.Added){var Y=e.getParameter("addedTokens");var Z=t.getTokensFromClipboard(y);if(Z){for(var i=0;i<Y.length;i++){var $=Y[i];if(!$){continue;}for(var j=0;j<Z.length;j++){var a1=Z[j];if(!a1){continue;}if($.getText()===a1.getText()){$.setKey(a1.getKey());$.setText(a1.getText());$.setTooltip(a1.getTooltip());$.data(a1.data());Z.splice(i,1);break;}}}}t.clearClipboard(y);X=P.getTokens().filter(function(b1){return Y.every(function(c1){return c1!==b1;});});X=X.concat(Y);t.applyTokensToFilter(P.getModel(),y,X,true);}}});P.addValidator(function(e){var i=new T({key:e.text,text:e.text,tooltip:e.text});return i;});var R=P.getAggregation("tokenizer");R._copy=function(){if(a.prototype._copy){a.prototype._copy.apply(this,arguments);}t.addTokensToClipboard(y,this.getSelectedTokens());};}if(O&&P.attachValueHelpRequest){var U=function(){f.show(0);new Function(t.prepareCommand(M.getProperty("/command/showfilterdialog"),"__STRING__",y))();};P.attachValueHelpRequest(U);}P.addEventDelegate({onfocusin:function(){C.$().css("z-index","1");},onfocusout:function(){C.$().css("z-index","");},oncopy:function(){}});P.oZenControl=C;return P;};this.addTokensToClipboard=function(e,j){if(!this.oClipboard[e]){this.oClipboard[e]=[];}for(var i=0;i<j.length;i++){var y=j[i];if(!y){continue;}var z=this.copyToken(y);this.oClipboard[e].push(z);}};this.getTokensFromClipboard=function(e){return this.oClipboard[e];};this.clearClipboard=function(e){this.oClipboard[e]=[];};this.getFilterFormatter=function(e,i,M,j){return function(y){if(y&&e&&y[e]){var z=y[e];if(z.ranges){var A=z.ranges[0];if(A){var C=A[j];if(C){if(i==="DATE"){return t.getDateFormat().parse(C.key);}else if(i==="TIME"){return t.getTimeFormat().parse(C.key);}}}}}return null;};};this.getDateFormat=function(){return sap.ui.core.format.DateFormat.getInstance({pattern:"yyyyMMdd",strictParsing:true});};this.getTimeFormat=function(){return sap.ui.core.format.DateFormat.getTimeInstance({pattern:"HH:mm:ss",strictParsing:true});};this.applyFilterToTokens=function(C,M,e){return function(A){if(C.ZEN_multiInput[0].getId()!==this.getId()){C.ZEN_multiInput[0]=this;}if(!A||!e||!A[e]){this.setTokens([]);return true;}var j=[];var y=A[e];if(y&&y.ranges&&y.ranges.length>0){var z=t.getCharacteristicByName(M,e);for(var i=0;i<y.ranges.length;i++){var D=y.ranges[i];if(!D){continue;}var G=t.createTokenFromRange(M,e,z,D);if(G){G.data("validated",true);j.push(G);}}}this.setTokens(j);return true;};};this.applyTokensToFilter=function(M,e,j,y){var z=this.getCharacteristicByName(M,e);var A=M.getProperty("/filters");var C=null;if(A){C=A[e];}if(C){C.dirty=true;C.input=[];C.ranges=[];for(var i=0;i<j.length;i++){var D=j[i];if(!D){continue;}var G=false;if(D.data("validated")){G=D.data("validated");}var H=this.createRangeFromToken(M,e,z,D);if(H){var I=this.isRangeARangeDefinition(H);if(!G&&(y&&!I)){C.input.push(H.from.key);}else{C.ranges.push(H);}}}}var K=M.getProperty("/property/pauserefresh");if(!K){this.submitAll(M,!M.getProperty("/property/variablescreen"),!K);}else{this.submitAll(M,false,!K);}};this.createTokenFromRange=function(M,i,C,R){if(!R||!R.from){return null;}if(!C){C=this.getCharacteristicByName(M,i);}var j=M.getProperty("/property/memberdisplay");var y;if(!C.supportsValueHelp){y=true;}var z,A;if(C.type==="DATE"){z=this.getDateFormat();A=sap.ui.core.format.DateFormat.getDateInstance();}else if(C.type==="TIME"){z=this.getTimeFormat();A=sap.ui.core.format.DateFormat.getTimeInstance();}var D=this.isRangeARangeDefinition(R);if(z){D=true;}var G,H,I,K;if(R.from){G=(R.from.key&&R.from.key.length>0)||!R.from.displaykey?R.from.key:R.from.displaykey;H=(R.from.displaykey&&R.from.displaykey.length>0)||!R.from.key?R.from.displaykey:D?R.from.key:R.from.text;if(z){H=G;try{if(H){K=z.parse(H);if(!K){K=H;}I=A.format(K);}}catch(e){}}else{if(y||H===R.from.text){I=sap.ui.comp.util.FormatUtil.getFormattedExpressionFromDisplayBehaviour("idOnly",H);}else{I=sap.ui.comp.util.FormatUtil.getFormattedExpressionFromDisplayBehaviour(this.getValueHelpDialogMemberDisplay(j),H,R.from.text);}}if(!I||I.length<=0){I=H;}}else{H="";I="";}var N,O,P,Q;if(R.to){N=(R.to.key&&R.to.key.length>0)||!R.to.displaykey?R.to.key:R.to.displaykey;O=(R.to.displaykey&&R.to.displaykey.length>0)||!R.to.key?R.to.displaykey:D?R.to.key:R.to.text;if(z){O=N;try{if(O){Q=z.parse(O);if(!Q){Q=O;}P=A.format(Q);}}catch(e){}}else{if(y||O===R.to.text){P=sap.ui.comp.util.FormatUtil.getFormattedExpressionFromDisplayBehaviour("idOnly",O);}else{P=sap.ui.comp.util.FormatUtil.getFormattedExpressionFromDisplayBehaviour(this.getValueHelpDialogMemberDisplay(j),O,R.to.text);}}if(!P||P.length<=0){P=O;}}else{O="";P="";}var U=R.operation?R.operation:sap.zen.dsh.ValueHelpRangeOperation.EQ;var W=R.exclude?true:false;var X="key";var Y=null;var Z=null;if(C.compound){I=H;P=O;}if(!D){Y=G;Z=I;}else{Y="range"+"_"+W+"_"+U+"_"+H+"_"+O;Z=k.prototype._getFormattedRangeTokenText(U,I,P,W,X);}var $=new sap.m.Token({key:Y,text:Z,tooltip:Z});$.data("range",{"isRange":D,"exclude":W,"operation":U,"keyField":X,"value1":K?K:H,"textFrom":I,"value2":Q?Q:O,"textTo":P});return $;};this.copyToken=function(e){if(!e){return null;}var i=new T({key:e.getKey(),text:e.getText(),tooltip:e.getTooltip()});i.data(e.data());return i;};this.createRangeFromToken=function(M,e,C,i){if(!i){return null;}if(!C){C=this.getCharacteristicByName(M,e);}var j=null;var y=null;var z=i.getKey();var A=i.getText();var D=null;var G=null;var H=i.data("longKey");var I=false;if(i.data("range")){var K=i.data("range");I=K.isRange;j=K.exclude;y=K.operation;if(I){z=K.value1;A=K.textFrom;D=K.value2;G=K.textTo;}}else{if(H){z=H;}}var N=null;if(z){if(C.type==="DATE"){N=this.getDateFormat();if(z.getDate){z=N.format(z);}}else if(C.type==="TIME"){N=this.getTimeFormat();if(z.getTime){z=N.format(z);}}}if(D){if(C.type==="DATE"){if(!N){N=this.getDateFormat();}if(D.getDate){D=N.format(D);}}else if(C.type==="TIME"){if(!N){N=this.getTimeFormat();}if(D.getTime){D=N.format(D);}}}var O=this.createRange(j,y,z,A,D,G);return O;};this.createRange=function(e,i,j,y,z,A){if(j===null||j===undefined){return null;}var C={};if(e){C.exclude=e;}if(i){C.operation=i;}if(j!==null&&j!==undefined){C.from={};C.from.key=j;if(y){C.from.text=y;}}if(z!==null&&z!==undefined){C.to={};C.to.key=z;if(A){C.to.text=A;}}return C;};this.isRangeARangeDefinition=function(R){var e=true;if(!R.exclude&&(!R.operation||R.operation===sap.zen.dsh.ValueHelpRangeOperation.EQ)){e=false;}return e;};this.submitExternal=function(M,e,i){return function(j,y){return t.submitAll(M,e,i,j,y);};};this.submitAll=function(M,e,j,y,z){var A=[];var C=M.getProperty("/filters");if(C){for(var D in C){var G=C[D];if(!G){continue;}if(G.dirty){var H=this.getCharacteristicByName(M,D);G.dirty=!M.getProperty("/property/variablescreen")&&!e;var I={};I.name=D;if(G.input!==undefined&&G.input!==null){I.input=[];if((Array&&Array.isArray(G.input))||(typeof G.input==="object"&&G.input.constructor===Array)){I.input=G.input;}else{I.input.push(G.input);}}I.ranges=[];A.push(I);var K=G.ranges.length;for(var i=0;i<K;i++){var N=G.ranges[i];if(!N){continue;}var O={};if(H.type!=="DATE"&&N.operation&&N.operation!==sap.zen.dsh.ValueHelpRangeOperation.EQ&&!N.exclude&&N.from.displaykey){O.from=N.from.displaykey;}else{O.from=N.from.key;}if(H.type!=="DATE"&&N.to&&N.to.displaykey){O.to=N.to.displaykey;}else if(N.to){O.to=N.to.key;}if(N.operation&&N.operation!==sap.zen.dsh.ValueHelpRangeOperation.EQ){O.operation=N.operation;}if(N.exclude){O.exclude=true;}I.ranges.push(O);}}}}var P=M.getProperty("/characteristics");if(P){var Q;for(i=0;i<P.length;i++){var R=P[i];if(!R){continue;}if(R.characteristic.axisdirty){if(!Q){Q=M.getProperty("/axis");}R.characteristic.axisdirty=!e;}}if(!Q&&(M.getProperty("/axis/rows/dirty")||M.getProperty("/axis/columns/dirty"))){Q=M.getProperty("/axis");}if(e&&Q){M.setProperty("/axis/rows/dirty",undefined);M.setProperty("/axis/columns/dirty",undefined);}var U=M.getProperty("/property/variablescreen");if(Q||A.length>0||(U&&e)){if(U){sap.zen.MessageViewHandler.clearMessages();}if(!Q){Q={};}var W={filters:A,axis:Q};if(y&&z){var X=t.prepareCommand(z,y,JSON.stringify(W));return X;}else{X=t.prepareCommand(M.getProperty(j?"/command/submitfilter":"/command/submitonlyfilter"),"__STRING__",JSON.stringify(W));X=t.prepareCommand(X,"__BOOLEAN__",e?"X":" ");new Function(X)();}}}};this.getValueHelpDialog=function(C){var y=C.getModel();var z=y.getProperty("/dialog/name");var A=y.getProperty("/command/destroyfilterdialog");var D=-1;var G=y.getProperty("/dialog/type");var H=y.getProperty("/dialog/compound");var I=y.getProperty("/dialog/hierarchical");var K=y.getProperty("/dialog/supportsMultiSelection");var M=y.getProperty("/dialog/supportsInterval");var N=y.getProperty("/dialog/supportsRange");var O=y.getProperty("/dialog/supportsIncludingPattern");var P=y.getProperty("/dialog/supportsExcluding");var Q=y.getProperty("/dialog/supportsExcludingPattern");var R=y.getProperty("/dialog/supportsValueHelpRange");var U=y.getProperty("/dialog/showValueHelpRangesOnly");var W=y.getProperty("/dialog/showValueHelpConditionEQ");var X=y.getProperty("/dialog/requiresValueHelpRange");var Y=y.getProperty("/dialog/range/visible");var Z=C.getId()+"_ValueHelpDialog";var $=new k({id:Z,title:"{/dialog/title}",supportMultiselect:K?true:false,supportRanges:X?true:false,supportRangesOnly:U?true:false,key:"key",descriptionKey:H?"":"text",ok:function(e){var j=e.getParameter("tokens");t.applyTokensToFilter(y,z,j,false);C.zenValueHelpDialog=null;new Function(t.prepareCommand(A,"__BOOLEAN__"," "))();$.close();},cancel:function(){C.zenValueHelpDialog=null;new Function(t.prepareCommand(A,"__BOOLEAN__","X"))();$.close();},afterClose:function(){if(C.zenValueHelpDialog){C.zenValueHelpDialog=null;new Function(t.prepareCommand(A,"__BOOLEAN__","X"))();}$.destroy();},afterOpen:function(){sap.ui.core.BusyIndicator.hide();}});if(I){$.setTable(new sap.ui.table.TreeTable());}if(X||Y){var a1=[];if(W){a1.push(sap.zen.dsh.ValueHelpRangeOperation.EQ);}if(R){a1.push(sap.zen.dsh.ValueHelpRangeOperation.BT);}if(!K){$.setMaxIncludeRanges("1");}else{if(N){a1.push(sap.zen.dsh.ValueHelpRangeOperation.LT);a1.push(sap.zen.dsh.ValueHelpRangeOperation.LE);a1.push(sap.zen.dsh.ValueHelpRangeOperation.GT);a1.push(sap.zen.dsh.ValueHelpRangeOperation.GE);if(O){a1.push(sap.zen.dsh.ValueHelpRangeOperation.Contains);a1.push(sap.zen.dsh.ValueHelpRangeOperation.StartsWith);a1.push(sap.zen.dsh.ValueHelpRangeOperation.EndsWith);}}else if(M){$.setMaxIncludeRanges("1");}}$.setIncludeRangeOperations(a1);if(G==="DATE"){$.setIncludeRangeOperations(a1,"date");}else if(G==="TIME"){$.setIncludeRangeOperations(a1,"time");}}else{$.setMaxIncludeRanges("0");}if(P){var b1=[];b1.push(sap.zen.dsh.ValueHelpRangeOperation.EQ);if(R||Y){b1.push(sap.zen.dsh.ValueHelpRangeOperation.BT);}if(!K){$.setMaxExcludeRanges("1");}else{if(N){b1.push(sap.zen.dsh.ValueHelpRangeOperation.LT);b1.push(sap.zen.dsh.ValueHelpRangeOperation.LE);b1.push(sap.zen.dsh.ValueHelpRangeOperation.GT);b1.push(sap.zen.dsh.ValueHelpRangeOperation.GE);if(Q){b1.push(sap.zen.dsh.ValueHelpRangeOperation.Contains);b1.push(sap.zen.dsh.ValueHelpRangeOperation.StartsWith);b1.push(sap.zen.dsh.ValueHelpRangeOperation.EndsWith);}}else if(M){$.setMaxExcludeRanges("1");}}$.setExcludeRangeOperations(b1);}else{$.setMaxExcludeRanges("0");}var c1=$.getTable();if(I&&c1.attachToggleOpenState){var d1;c1.attachToggleOpenState(function(e){var j=e.getParameters();$._bIgnoreSelectionChange=true;if(j.expanded){var n1=j.rowContext;var y=n1.oModel;if(y.getProperty(n1.sPath+"/0/node")){var o1=t.prepareCommand(y.getProperty("/command/expandnode"),"__STRING__",y.getProperty(n1.sPath+"/key"));o1=t.prepareCommand(o1,"__STRING2__",n1.sPath);new Function(o1)();}else{$.update();}}});var e1=c1.onclick;c1.onclick=function(){if(e1){e1.apply(c1,arguments);}$._bIgnoreSelectionChange=false;if(d1){C.zenValueHelpDialog.update();d1=false;}};$.attachTokenRemove(function(e){var n1=e.getParameters().tokenKeys;if(n1&&n1.length>0){var o1=c1.getBinding("rows").getContexts(0);if(o1&&o1.length>0){for(var i=0;i<n1.length;i++){var p1=n1[i];if(!p1){continue;}for(var j=0;j<o1.length;j++){var q1=o1[j];if(!q1){continue;}var r1=q1.getObject();if(r1["key"]===p1){c1.removeSelectionInterval(j,j);$.setChildSelection(false,r1);$.update();}}}}}});$.attachUpdateSelection(function(e){c1.clearSelection();var n1=e.getParameters().tokenKeys;if(n1&&n1.length>0){var o1=c1.getBinding("rows").getContexts(0);if(o1&&o1.length>0){for(var i=0;i<n1.length;i++){var p1=n1[i];if(!p1){continue;}var q1=null;for(var j=0;j<o1.length;j++){var r1=o1[j];if(!r1){continue;}var s1=r1.getObject();if(q1!==null){if(q1<s1.lLevel){c1.addSelectionInterval(j,j);}else{q1=null;}}else if(s1["key"]===p1){this._oSelectedItems.add(s1["key"],s1);c1.addSelectionInterval(j,j);q1=s1.lLevel;}}}}}});$.attachSelectionChange(function(e){var j=c1.getBinding("rows");var n1=false;if(j.aKeys){n1=true;}var o1=e.getParameter("tableSelectionParams").rowIndices;var p1=e.getParameter("tableSelectionParams").selectAll&&!$.getFilterBar().ZEN_searchValue;if(p1&&o1.length){$.removeAllSelections(false);}if(!this.getSupportMultiselect()){$.removeAllSelections(true);}for(var i=0;i<o1.length;i++){var q1=o1[i];var r1=c1.getContextByIndex(q1);var s1=r1?r1.getObject():null;if(s1){var t1;if(n1){t1=r1.sPath.substring(1);}else{t1=s1["key"];}if(c1.isIndexSelected(q1)||p1){if(!p1||!s1.level){$.setSelection(true,t1,s1);$.setChildSelection(false,s1);}}else{$.setSelection(false,t1,s1);$.setChildSelection(false,s1);}}}$.update();});}var f1=new J();var g1=y.getProperty("/property/memberdisplay");$.setTokenDisplayBehaviour(this.getValueHelpDialogMemberDisplay(g1));if(g1==="KEY"){f1.setData({cols:[{label:y.getProperty("/text/key"),template:"displaykey"}]});}else if(g1==="TEXT"){f1.setData({cols:[{label:y.getProperty("/text/text"),template:"text"}]});}else if(g1==="KEY_TEXT"){f1.setData({cols:[{label:y.getProperty("/text/key"),template:"displaykey"},{label:y.getProperty("/text/text"),template:"text"}]});}else if(g1==="TEXT_KEY"){f1.setData({cols:[{label:y.getProperty("/text/text"),template:"text"},{label:y.getProperty("/text/key"),template:"displaykey"}]});}c1.setModel(f1,"columns");var h1={label:y.getProperty("/text/key"),key:"key"};if((Y||P)){if(G==="DATE"){h1.type="date";}else if(G==="TIME"){h1.type="time";}}$.setRangeKeyFields([h1]);$.setModel(y);c1.bindRows("/dialog/members");if(C.$().closest(".sapUiSizeCompact").length>0){$.addStyleClass("sapUiSizeCompact");}this.applyFilterToTokens(C,y,y.getProperty("/dialog/name")).call($,y.getProperty("/filters"));var i1=new sap.m.SearchField({width:"95%",placeholder:"{/text/search}"});var j1;if(I){j1=y.getProperty("/dialog/members");if(j1){for(var i=0;i===D+1;i++){var k1=j1[""+i];if(!k1){continue;}k1.level=0;D=i;}}}if(!y.getProperty("/dialog/nosearch")&&(y.getProperty("/dialog/selection/maxelements")||I)){i1.setBusyIndicatorDelay(0);$.TableStateSearchData();i1.attachSearch(function(e){i1.setBusy(true);$.TableStateDataSearching();var j=e.getParameters().query;i1.ZEN_searchValue=j;new Function(t.prepareCommand(y.getProperty("/command/membersearch"),"__STRING__",j))();});}else{j1=y.getProperty("/dialog/members");if(j1){for(i=0;i<j1.length;i++){var l1=j1[i];if(!l1){continue;}var m1="";if(g1!=="KEY"){m1+=l1.text;}if(g1!=="TEXT"){if(m1){m1+=" ";}m1+=l1.displaykey;}l1.searchstring=m1;}}i1.setShowSearchButton(false);i1.attachLiveChange(function(e){var j=e.getParameters().newValue?e.getParameters().newValue.toUpperCase():"";var n1=["\\\\","\\^","\\$","\\+","\\.","\\(","\\)","\\[","\\]","\\{","\\}"];for(var i=0;i<n1.length;i++){var o1=n1[i];if(!o1){continue;}j=j.replace(new RegExp(o1,"g"),o1);}j=j.replace(/\?/g,".").replace(/\*/g,".*?");var p1=new sap.ui.model.Filter("searchstring","Wildcard",j);p1.fnTest=function(q1){return q1.search(new RegExp(j))!==-1;};if(!y.getProperty("/dialog/selection/maxelements")&&!y.getProperty("/dialog/hierarchical")){$._bIgnoreSelectionChange=true;$.getTable().getBinding("rows").filter([p1]);$._bIgnoreSelectionChange=false;$.update();}});$.TableStateDataFilled();}$.setFilterBar(i1);return $;};this.getValueHelpDialogMemberDisplay=function(e){switch(e){case"TEXT_KEY":return"descriptionAndId";case"KEY_TEXT":return"idAndDescription";case"TEXT":return"descriptionOnly";default:return"idOnly";}};this.getVariableTechnicalName=function(e){return e.substring(e.indexOf(":")+1,e.length);};function p(C,e){var j=C.getModel();return new B({icon:"sap-icon://action-settings",press:function(){var y=new d({items:{path:"/characteristics",template:new c({title:"{characteristic/text}",selected:{path:"/visibleprompts",formatter:function(z){var A=t.getVariableTechnicalName(this.getBindingContext().getProperty("characteristic/name"));for(var i=0;i<z.length;i++){if(z[i]===A){return true;}}return false;}}}),filters:[r()],sorter:new g({path:"characteristic/text"})},growingThreshold:0,multiSelect:true,liveChange:function(i){var z=new sap.ui.model.Filter("characteristic/text",sap.ui.model.FilterOperator.Contains,i.getParameter("value"));i.getParameter("itemsBinding").filter([r(),z]);},cancel:function(){y.destroy();},confirm:function(z){var A=[];var D=z.getParameter("selectedContexts");for(var i=0;i<D.length;i++){var G=D[i];if(!G){continue;}var H=G.getProperty("characteristic/name");var I=H.substring(H.indexOf(":")+1,H.length);A.push(I);}j.setProperty("/visibleprompts",A);e.setValue("");C.ZENCharLists[0].getBinding("formElements").filter([s(A)]);new Function(t.prepareCommand(j.getProperty("/command/setvisibleprompts"),"__ARRAY__",JSON.stringify(A)))();}});y.setModel(j);y.open();}});}function r(){return new sap.ui.model.Filter({path:"characteristic",test:function(e){return e.mandatory?false:true;}});}function s(e){return new sap.ui.model.Filter({path:"characteristic",test:function(j){if(j.mandatory){return true;}var y=t.getVariableTechnicalName(j.name);for(var i=0;i<e.length;i++){if(e[i]===y){return true;}}return false;}});}function u(M,e){var j=M.getProperty("/characteristics");if(j){for(var i=0;i<j.length;i++){var y=j[i].characteristic;if(!y){continue;}if(y.name===e){return"/characteristics/"+i+"/characteristic";}}}return null;}function v(){var e=document.getElementsByClassName("zenDialogOkButton");if(e&&e.length){var i=sap.ui.getCore().byId(e[0].id);if(i){i.setEnabled(false);}}}function w(e,j){if((!e&&j)||(e&&!j)){return false;}if(e&&j){if(e.length!==j.length){return false;}for(var i=0;i<e.length;i++){var y=e[i].characteristic;var z=j[i].characteristic;if(!y||!z){continue;}if(y.name!==z.name||y.axis!==z.axis){return false;}}}return true;}this.isDesignModeD4LIncluded=function(){return sap.zen.designmode;};function x(M,e){var i=M.aBindings.slice(0);q.each(i,function(j,y){if(y.sPath===e){y.checkUpdate(true);}});}this.getCharacteristicByName=function(M,e){var j=M.getProperty("/characteristics");for(var i=0;i<j.length;i++){var y=j[i].characteristic;if(!y){continue;}if(y.name===e){return y;}}return null;};this.getContextMenuAction=function(C,e,D){var i=e.getModel().getProperty("/command/createcontextmenu");if(i&&e.ZEN_IdToDimensionMap){var j=this.getListItemElement(D);if(j&&j[0]){var y=e.ZEN_IdToDimensionMap[j[0].id];var z;if(y){var A=t.prepareCommand(i,"__STRING__",C);A=t.prepareCommand(A,"__STRING2__",y);A=t.prepareCommand(A,"__STRING3__",z);A=t.prepareCommand(A,"__STRING4__",D[0].id);return new Function(A);}}}return null;};this.getListItemElement=function(D){if(D.hasClass("sapzenfilterpanelM-ListItem")){return D;}else{return D.parents(".sapzenfilterpanelM-ListItem");}};this.getType=function(){return"filter";};this.getDecorator=function(){return"DataSourceControlDecorator";};};var o=new n();m.addHandlers(o.getType(),o,"DataSourceControlDecorator");m.addHandlers("filterpanel",o,"DataSourceControlDecorator");return o;});
