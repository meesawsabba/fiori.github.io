/*!
 * SAPUI5
  (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["jquery.sap.global","sap/base/Log","sap/zen/dsh/utils/BaseHandler","sap/zen/dsh/widgets/utilities/SDKUtilsHelper","sap/zen/dsh/widgets/dataMappers/helpers/SDKChartTypeHelper","sap/zen/dsh/widgets/dataMappers/helpers/SDKDataMapperHelper","sap/zen/dsh/widgets/charts/ChartException","sap/zen/dsh/widgets/sap_viz/CrossTableDataSet"],function(q,L,B,S,a,b,C,c){"use strict";L.info("Loaded SDKChartDataMapper");function d(){var _=this;var e=null;var f=null;var g=null;var h=null;var k=null;var l=null;var m=null;var n=null;var o={"key":"12345","isFake":true,"text":"Key Figures","axis":"ROWS","axis_index":0,"containsMeasures":true,"members":[{"key":"","text":"","scalingFactor":0,"unitOfMeasure":"","formatString":""}]};this.getDataMapperHelper=function(){if(m==null)m=new b(this.getMeasureCounter());return m;};this.getChartTypeHelper=function(){if(n==null)n=new a();return n;};this.getMessages=function(){return this.messgaes;};this.setMessages=function(i){this.messgaes=i;};var s=function(i){e=i;};this.getMeasureAxis=function(){return e;};var p=function(i){f=i;};this.getMeasureIndex=function(){return f;};var t=function(i){g=i;};this.getMeasureCounter=function(){return g;};var u=function(i){l=i;};this._getDataExist=function(){return l;};var v=function(r){h=r;};this._getRowDimensionCounter=function(){return h;};var w=function(i){k=i;};this._getColDimensionCounter=function(){return k;};this.setDataFeeding=function(i){this.dataFeeding=i;};this.getDataFeeding=function(){return this.dataFeeding;};this.setTotalMeasure=function(i){var j=0;var r;for(var z=0;z<i.length;z++){r=i[z][0]||0;j=j+r;}_.total=j;};this.getTotalMeasure=function(){return _.total;};this.setNumberOfDimensions=function(i){var j=i.dimensions;var r=0;var z=0;q.each(j,function(A,D){if(D.axis=="COLUMNS"&&!D.containsMeasures)r++;else if(D.axis=="ROWS"&&!D.containsMeasures)z++;});v(z);w(r);};this.setInfo=function(j,r){var z=true;for(var A=0;A<j.data.length;A++){if(j.data[A]!=null){z=false;break;}}if(this._getColDimensionCounter()==0){o.axis="COLUMNS";}if(z){if(!this.getUtilsHelper().hasMeasures(j)){j.dimensions.push(o);}}var D=0;var E="";var F=-1;for(var i=0;i<j.dimensions.length;i++){var G=j.dimensions[i];if(G.containsMeasures==true){E=G.axis;D=G.members.length;F=i;break;}}if(D==0){j.dimensions.push(o);E=o.axis;D=o.members.length;}s(E);p(F);t(D);this.setNumberOfDimensions(j);u(!z);x(j,r);};this.validateData=function(){};var x=function(j,r){var z=_.getChartTypeHelper();if((z.isScatterBubbleChart(r))||(z.isRadarChart(r))){_.validateData(r);}else if(z.isDualChart(r)){if(j.dualAxis!=undefined){var A=0;var D=0;for(var i=0;i<j.dualAxis.length;i++){if(j.dualAxis[i][1]=="axis1")A++;else D++;}if(A==0&&D==0)throw new C(_.getMessages().datasource_no_measures);}_.validateData(j,r);}else{_.validateData();}};this.setAnalysisAxisValue=function(){};this.getAnalysisAxisValue=function(){return null;};this.getxAxisValues=function(i){this.setInfo(i);var j=_.createAnalysisAxisGroup(i);var r=y(i,j);this.setTotalMeasure(r[0].data[0].values);for(var z in j){if(j[z].index==1){return j[z].data[0].values;}}};var y=function(i,j){var r=_.getMeasureAxis();var z=_.getMeasureIndex();var A={};q.each(i.dimensions,function(E,F){if(F.containsMeasures){A=F.members;}});var D;if(i.cvomType&&i.cvomType==="viz/waterfall"||i.cvomType==="viz/horizontal_waterfall"||i.cvomType==="viz/stacked_waterfall"||i.cvomType.indexOf("pie")!==-1){r=_.getMeasureAxis();z=_.getMeasureIndex();A={};q.each(i.dimensions,function(E,F){if(F.containsMeasures){A=F.members;}});D=_.createMeasureValues(i,A,r,z);}else{D=_.createMeasureValues(i,j);}return D;};this.createDataSet=function(i){var j={};j.analysisAxis=_.createAnalysisAxisGroup(i);j.measureValuesGroup=y(i,j.analysisAxis);var r=new c();r.data(j);return r;};this.findKeyFigureAxis=function(j){for(var i=0;i<j.dimensions.length;i++){if(j.dimensions[i].containsMeasures){return j.dimensions[i].axis;}}};this.setDimensionsOnAxis=function(z,A,D,E,F,G,H){var I={};var J=[];I.index=z;I.data=[];var K=-1;var M=0;var N=-1;var _=this;q.each(G,function(i,Q){if(N==-1||Q[M]==N){q.each(Q,function(j,R){if(R!=-1&&(!A.dimensions[j].containsMeasures||H)){if(N!=-1&&N)if(K==-1)K=j;if(J[j-K]==undefined)J[j-K]=[];var T=_.getDimensionLabel(A.dimensions[j].members[R],A.presentationValue);J[j-K].push(T);}else if(A.dimensions[j].containsMeasures&&N==-1){M=j;N=R;}});}});for(var r=0;r<A.dimensions.length;r++){var O=A.dimensions[r];if((O.containsMeasures&&!H)||O.axis!=E){continue;}var P={};P.name=O.text;P.type="Dimension";P.values=J[r-K];I.data.push(P);}D.push(I);};this.createAnalysisAxis=function(){return null;};this.createAnalysisAxisGroup=function(i){var j=this.getMeasureAxis();var r=this.getMeasureCounter();var z=1;var A=1;if(j=="COLUMNS")z=r;else if(j=="ROWS")A=r;return this.createAnalysisAxis(i,A,z,this._getRowDimensionCounter(),this._getColDimensionCounter());};this.getValues=function(i,j,r,z,D,A,E,F,G){var H=[];var I=this.getDataMapperHelper();if(j=="ROWS"){if(F){H=I.getAllRowValuesInArray(i,r,D,z,E);}else{H=I.getAllRowValuesInOneArray(i,r,D,A,z,E,G);}}else if(j=="COLUMNS"){if(z)H=I.getFirstMeasureColValuesInArray(i,r,D);else if(F){H=I.getAllColValuesInArray(i,r,D,E);}else if(G){H=I.getAllColValuesInOneArrayRows(i,r,D,A,E);}else{H=I.getAllColValuesInOneArray(i,r,D,A,E);}}return H;};this.getIDimensionOnRows=function(i,j,r){var D=0;if(j[r].data[0]!=undefined){D=j[r].data[0].values.length;}return D;};this.mergeValues=function(i,j,r){if(r=="ROWS"){i.push(j[0]);}else if(r=="COLUMNS"){q.each(j,function(z,A){i[z].push(A[0]);});}};this.mapData=function(i,j){j.dualAxis=i.dualAxis;this.setInfo(j,i.cvomType);var r={};j.presentationValue=i.mProperties.presentation.selectedValue;j.newChartOptionsProperties=i.newChartOptionsProperties;j.cvomType=i.cvomType;r.ds=this.createDataSet(j);r.dataFeeding=this.getChartDataFeeding(i);this.setAnalysisAxisValue(r.ds);return r;};this.getChartDataFeeding=function(i){var j=this.getChartTypeHelper();var r=this.getMeasureCounter();var z=i.getChartDataFeedingHelper();var A=(this.getMeasureAxis()=="ROWS")?this._getRowDimensionCounter():this._getColDimensionCounter();if((i.isGenericViz)||((i.newChartOptionsProperties!==undefined)&&(i.newChartOptionsProperties.feeds!==undefined)))return z.genericDataFeeding(i,this.getMeasureAxis(),this.getMeasureIndex(),h,k);if(j.isScatterChart(i.cvomType)){return i.getDataFeeding(this.getMeasureAxis(),this.getMeasureIndex(),h,k);}else if(j.isBubbleChart(i.cvomType)){var D=false;if(r>3)D=true;return i.getDataFeeding(this.getMeasureAxis(),this.getMeasureIndex(),h,k,D);}else if(j.isRadarChart(i.cvomType)){return i.getDataFeeding(this.getMeasureAxis(),this.getMeasureIndex(),h,k,r);}else if(j.isDualChart(i.cvomType)){return i.getDataDualFeeding(this.getMeasureAxis(),this.getMeasureIndex(),h,k);}else{return i.getDataFeeding(this.getMeasureAxis(),this.getMeasureIndex(),h,k,A);}};this.getLegendValues=function(i,j){var r=i.getData();var z=this.getMeasuresHelper();var A=[""];if(!(r))return null;this.setInfo(r,i.cvomType);var D={};r.axesSwapped=i.axesSwapped;r.presentationValue=i.mProperties.presentation.selectedValue;r.cvomType=i.cvomType;D.ds=i.getMappedData().ds;var E=this.getMeasureIndex();var F=this.getMeasureAxis();if(j&&F!=j)return null;var G=this.getMeasureCounter();var H=this._getRowDimensionCounter();var I=this._getColDimensionCounter();if(j=="ROWS"){return z.getMeasureTuplesCombination(r,E);}if(i.getDataFeeding()==undefined){var J=0;if(i.cvomType=="viz/multi_pie"||i.cvomType=="viz/stacked_waterfall"){J=1;}else if(i.cvomType=="viz/waterfall"||i.cvomType=="viz/horizontal_waterfall"||i.cvomType=="viz/horizontal_waterfall")return z.getMeasureTuples(D.ds);return z.getRowDimTuples(D.ds,J);}if(i.cvomType=="viz/multi_radar"||i.cvomType=="viz/radar"){if(H==0&&I==0&&F=="COLUMNS")return A;else if(H==0)return z.getMeasureTuples(D.ds);else if(i.cvomType=="viz/multi_radar")return z.getRowDimTuples(D.ds,1);}if(G>0&&H>0&&F=="ROWS"){A=z.getMeasureAndRowDimTuples(D.ds,E-I);}if(F=="COLUMNS"){if(H==0&&I==0){A=z.getRowDimTuples(D.ds,0);}else if(H==0&&I>1){A=z.getRowDimTuples(D.ds,1);}else if(H>0&&I==0){A=z.getRowDimTuples(D.ds,0);}else{A=z.getRowDimTuples(D.ds,1);}}else if(G>0&&H==0&&F=="ROWS"){A=z.getMeasureTuples(D.ds);}return A;};this.getLegendValuesFromData=function(j,r,z,A){var D=this.getMeasuresHelper();var E=[""];if(!(j))return null;this.setInfo(j,z);var F={};j.axesSwapped=r;j.presentationValue=A;F.ds=this.createDataSet(j);var G=this.getMeasureIndex();var H=this.getMeasureAxis();var I=this.getMeasureCounter();var J=this._getRowDimensionCounter();var K=this._getColDimensionCounter();var M=0;if(z=="viz/multi_pie"||z=="viz/stacked_waterfall"||z=="viz/pie"){if(z!="viz/pie")M=1;return D.getRowDimTuples(F.ds,M);}else if(z=="viz/waterfall"||z=="viz/horizontal_waterfall"||z=="viz/horizontal_waterfall")return D.getMeasureTuples(F.ds);else if(z=="viz/multi_radar"||z=="viz/radar"){if(J==0&&K==0&&H=="COLUMNS")return E;else if(J==0)return D.getMeasureTuples(F.ds);else if(z=="viz/multi_radar")return D.getRowDimTuples(F.ds,1);}if(this.getChartTypeHelper().isScatterBubbleChart(j.cvomType)&&J>0){for(var i=0;i<j.dimensions.length;i++){var N=j.dimensions[i];if(N.axis==="ROWS"&&N.axis_index===0){E=j.dimensions[i].members.map(function(O){return O.text;});break;}}}else if(H=="COLUMNS"){if(J==0&&K==0){E=D.getRowDimTuples(F.ds,0);}else if(J==0&&K>1){E=D.getRowDimTuples(F.ds,1);}else if(J>0&&K==0){E=D.getRowDimTuples(F.ds,0);}else{E=D.getRowDimTuples(F.ds,1);}}else if(I>0&&J>0&&H=="ROWS"){E=D.getMeasureAndRowDimTuples(F.ds,G-K);}else if(I>0&&J==0&&H=="ROWS"){if(this.getChartTypeHelper().isDualChart(z)){E=["Axis 1","Axis 2"];}else{E=D.getMeasureTuples(F.ds);}}return E;};this.setEmptyDimension=function(i,j){var r={};var z={};r.index=i;r.data=[];z.name="";z.type="Dimension";z.values=[""];r.data.push(z);j.push(r);};this.getDimensionLabel=function(i){return i.text;};this.getUtilsHelper=function(){if(this._utilsHelper!=null||this._utilsHelper!=undefined){return this._utilsHelper;}this._utilsHelper=new S();return this._utilsHelper;};}return d;});
