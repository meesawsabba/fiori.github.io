/*
 * SAPUI5
  (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["jquery.sap.global","sap/zen/commons/thirdparty/lodash","sap/ui/layout/HorizontalLayout","sap/m/OverflowToolbarLayoutData","sap/ui/layout/Grid","sap/m/Dialog","sap/m/Panel","sap/m/List","sap/m/StandardListItem","sap/m/VBox","sap/m/HBox","sap/m/Token","sap/m/FlexItemData","sap/m/IconTabBar","sap/m/IconTabFilter","sap/ui/core/IconPool","sap/m/Link","sap/m/Button","sap/m/Text","sap/m/Title","sap/m/Bar","sap/ui/core/InvisibleText","sap/m/Tokenizer","sap/zen/dsh/ValueHelpRangeOperation","sap/zen/dsh/utils/BaseHandler","sap/zen/dsh/widgets/messageview_m_handler","sap/m/library","sap/ui/comp/library","sap/ui/table/library","sap/ui/comp/valuehelpdialog/ItemsCollection","sap/ui/core/format/DateFormat","sap/m/P13nConditionPanel","sap/m/P13nFilterPanel","sap/ui/model/odata/type/Boolean","sap/ui/table/Table"],function(q,_,H,O,G,D,P,L,S,V,a,T,F,I,b,c,d,B,e,f,g,h,k,l,m){"use strict";var n=D.extend("sap.zen.dsh.ValueHelpDialog",{metadata:{properties:{basicSearchText:{type:"string",group:"Misc",defaultValue:""},supportMultiselect:{type:"boolean",group:"Misc",defaultValue:true},supportRanges:{type:"boolean",group:"Misc",defaultValue:false},supportRangesOnly:{type:"boolean",group:"Misc",defaultValue:false},key:{type:"string",group:"Misc",defaultValue:""},keys:{type:"string[]",group:"Misc",defaultValue:null},descriptionKey:{type:"string",group:"Misc",defaultValue:""},maxIncludeRanges:{type:"string",group:"Misc",defaultValue:"-1"},maxExcludeRanges:{type:"string",group:"Misc",defaultValue:"-1"},displayFormat:{type:"string",group:"Misc",defaultValue:""},tokenDisplayBehaviour:{type:"string",group:"Misc",defaultValue:""},filterMode:{type:"boolean",group:"Misc",defaultValue:false}},aggregations:{filterBar:{type:"sap.ui.core.Control",multiple:false}},events:{ok:{parameters:{tokens:{type:"sap.m.Token[]"}}},cancel:{},selectionChange:{parameters:{tableSelectionParams:{type:"object"},updateTokens:{type:"object[]"},useDefault:{type:"boolean",defaultValue:false}}},tokenRemove:{parameters:{tokenKeys:{type:"string[]"},useDefault:{type:"boolean",defaultValue:false}}},updateSelection:{parameters:{tokenKeys:{type:"string[]"},useDefault:{type:"boolean",defaultValue:false}}}}},renderer:sap.m.DialogRenderer.render});n.prototype.update=function(t){this._bIgnoreSelectionChange=true;var s=this._oSelectedItems.getItems();var u={tokenKeys:s,useDefault:false};if(this._hasListeners("updateSelection")){this.fireUpdateSelection(u);}else{u.useDefault=true;}if(u.useDefault){if(sap.ui.table.Table&&this._oTable instanceof sap.ui.table.Table){this.oRows=this._oTable.getBinding("rows");this._oTable.clearSelection();if(this.oRows.aKeys){var v=this.getKeys();var w=v&&v.length>1?this.getKey()+"=":"";for(var i=0;i<s.length;i++){var x=s[j];var y=w+"'"+x+"'";for(var j=0;j<this.oRows.aKeys.length;j++){var z=this.oRows.aKeys[j];var A=z===x;if(A||z.indexOf(y)>=0){if(!A){this._oSelectedItems.remove(x);var C=this._getTokenByKey(x,this._oSelectedTokens);if(C){C.setKey(z);}}var E=this._oTable.getContextByIndex(j);if(E){J=E.getObject();this._oSelectedItems.add(z,J);}this._oTable.addSelectionInterval(j,j);}}}}else if(this.oRows.aIndices){this._oTable.clearSelection();for(i=0;i<s.length;i++){x=s[i];for(j=0;j<this.oRows.aIndices.length;j++){E=this._oTable.getContextByIndex(j);if(!E){continue;}if(E){var J=E.getObject();if(J[this.getKey()]===x){this._oSelectedItems.add(J[this.getKey()],J);this._oTable.addSelectionInterval(j,j);}}}}}}else{var K=this._oTable;for(i=0;i<s.length;i++){x=s[i];for(j=0;j<K.getItems().length;j++){var M=K.getItems()[j];if(!M){continue;}var N=M.getBindingContext().getObject();if(N[this.getKey()]===x){K.setSelectedItem(M,true);}}}}}this._bIgnoreSelectionChange=false;this._updateTitles();this._updateMessageView(t);};n.prototype.init=function(){D.prototype.init.apply(this);this._bTableCreatedInternal=false;this._aIncludeRangeOperations={};this._aExcludeRangeOperations={};this.setStretch(this._isPhone());this.setResizable(!this._isPhone());this.setDraggable(!this._isPhone());this.bCollectiveSearchActive=false;this.addStyleClass("compValueHelpDialog");this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");this._sTableTitle1=this._oRb.getText("VALUEHELPDLG_TABLETITLE1");this._sTableTitle2=this._oRb.getText("VALUEHELPDLG_TABLETITLE2");this._sTableTitleNoCount=this._oRb.getText("VALUEHELPDLG_TABLETITLENOCOUNT");this._currentViewMode=null;this._oSelectedItems=new sap.ui.comp.valuehelpdialog.ItemsCollection();this._oSelectedRanges={};this._createHeaderBar();this._createCollectiveSearch();this._createTokenizer();this._updateTokenizer();this._oVBox=new V({fitContainer:true});this.addContent(this._oVBox);this._oMainLayout=new V({fitContainer:true,items:[this._oFilterBar],layoutData:new F({growFactor:1,shrinkFactor:0})});this._createNavigationControl();this._updateNavigationControl();this._oVBox.addItem(this._oMainLayout);if(this.getMaxIncludeRanges()==="-1"&&this.getMaxExcludeRanges()!=="0"&&!this.getFilterMode()){this._oVBox.addItem(this._oTokenizerGrid);}this._createFooterControls();this.setVerticalScrolling(false);this.setHorizontalScrolling(false);if(!sap.ui.Device.system.desktop){this._oVBox.attachBrowserEvent("touchmove",function(E){E.setMarked();});}if(!this._isPhone()){this._updateView(sap.zen._ValueHelpViewMode.DESKTOP_LIST_VIEW);}};n.prototype._createHeaderBar=function(){this._oTitle=new f();var i=null;if(this._isPhone()){i=new B({visible:false,type:sap.m.ButtonType.Back,press:function(){if(this._currentViewMode===sap.zen._ValueHelpViewMode.PHONE_SEARCH_VIEW){this._updateView(sap.zen._ValueHelpViewMode.PHONE_LIST_VIEW);}else{this._updateView(sap.zen._ValueHelpViewMode.PHONE_MAIN_VIEW);}}.bind(this)});this._oBackButton=i;}this.setCustomHeader(new g({contentLeft:i,contentMiddle:this._oTitle}));};n.prototype._createCollectiveSearch=function(){this.oSelectionTitle=new e({visible:false,wrapping:false}).addStyleClass("compVHColSearchText");this.oSelectionButton=new B({icon:"sap-icon://arrow-down",tooltip:this._oRb.getText("VALUEHELPVALDLG_SEARCHTEMPLATES_TOOLTIP"),type:sap.m.ButtonType.Transparent,visible:false,ariaLabelledBy:this.oSelectionTitle}).addStyleClass("compVHColSearchBtn");this._oColSearchBox=new a({fitContainer:true,visible:this.oSelectionButton.getVisible(),items:[this.oSelectionTitle,this.oSelectionButton]}).addStyleClass("compVHColSearchVBox");};n.prototype._createTokenizer=function(){if(this._oTokenizerGrid){return this._oTokenizerGrid;}this._oSelectedTokenTitle=new h();this._oSelectedTokens=new k({tokenUpdate:function(C){if(this._ignoreRemoveToken){return;}if(C.getParameter("type")===k.TokenChangeType.Removed){var t=[];var u=[];var v=C.getParameter("removedTokens");for(var i=0;i<v.length;i++){var w=v[i];if(!w){continue;}var x=w.getKey();if(this._oSelectedRanges&&this._oSelectedRanges[x]){u.push(x);this._removeToken(x);}else{t.push(x);this._oSelectedItems.remove(x);this._removeTokenFromTokenizer(x,this._oSelectedTokens);}}this._removeRangeByKey(u,false);var y={tokenKeys:t,useDefault:false};if(this._hasListeners("tokenRemove")){this._bIgnoreSelectionChange=true;this.fireTokenRemove(y);this._bIgnoreSelectionChange=false;}else{y.useDefault=true;}if(y.useDefault){t.forEach(function(z){this._changeTableRowSelectionForKey(z,false);}.bind(this));}if(v.length===1){setTimeout(function(){if(this._oSelectedTokens.getTokens()){var i=this._oSelectedTokens.getTokens().length-1;if(i>=0){this._oSelectedTokens.getTokens()[i].focus();}}}.bind(this));}this._updateTitles();}}.bind(this),ariaLabelledBy:this._oSelectedTokenTitle}).addStyleClass("compVHTokensDiv");this._oRemoveAllSelectedItemsBtn=new B({type:sap.m.ButtonType.Transparent,icon:c.getIconURI("sys-cancel"),tooltip:this._oRb.getText("VALUEHELPVALDLG_REMOVETOKENS_TOOLTIP"),press:function(){this._oSelectedTokens.destroyTokens();this._removeRangeByKey(Object.keys(this._oSelectedRanges),false);this._oSelectedItems.removeAll();this._bIgnoreSelectionChange=true;if(this._oTable&&this._oTable.clearSelection){this._oTable.clearSelection();}if(this._oTable&&this._oTable.removeSelections){this._oTable.removeSelections();}this._bIgnoreSelectionChange=false;this._updateTitles();}.bind(this),ariaLabelledBy:this._oSelectedTokenTitle}).addStyleClass("compVHRemoveAllBtn");var j=new H({content:[this._oSelectedTokens,this._oRemoveAllSelectedItemsBtn]}).addStyleClass("compVHTokenizerHLayout");this._oIncludeTokenGrid=new G({width:"100%",defaultSpan:"L12 M12 S12",hSpacing:0,vSpacing:0,content:[this._oSelectedTokenTitle,j]});this._oExcludedTokenTitle=new e().addStyleClass("compVHSelectedItemsText");this._oExcludedTokens=new k({tokenChange:function(C){if(this._ignoreRemoveToken){return;}if(C.getParameter("type")===k.TokenChangeType.Removed||C.getParameter("type")===sap.m.Tokenizer.TokenChangeType.RemovedAll){var t=[];var u=C.getParameter("removedTokens");if(!u||u.length===0){u=[C.getParameter("token")];}for(var i=0;i<u.length;i++){var v=u[i];if(!v){continue;}var w=v.getKey();if(this._oSelectedRanges&&this._oSelectedRanges[w]){t.push(w);}}this._removeRangeByKey(t,true);this._updateTitles();}}.bind(this),ariaLabelledBy:this._oExcludedTokenTitle}).addStyleClass("compVHTokensDiv");this._oRemoveAllExcludeItemsBtn=new B({type:sap.m.ButtonType.Transparent,icon:sap.ui.core.IconPool.getIconURI("sys-cancel"),tooltip:this._oRb.getText("VALUEHELPVALDLG_REMOVETOKENS_TOOLTIP"),press:function(){this._oExcludedTokens.destroyTokens();this._removeRangeByKey(Object.keys(this._oSelectedRanges),true);this._updateTitles();}.bind(this),ariaLabelledBy:this._oExcludedTokenTitle}).addStyleClass("compVHRemoveAllBtn");var s=new H({content:[this._oExcludedTokens,this._oRemoveAllExcludeItemsBtn]}).addStyleClass("compVHTokenizerHLayout");this._oExcludeTokenGrid=new sap.ui.layout.Grid({width:"100%",defaultSpan:"L12 M12 S12",hSpacing:0,vSpacing:0,content:[this._oExcludedTokenTitle,s]});this._oTokenizerPanel=new P({expanded:sap.ui.Device.system.desktop,expandable:true,expandAnimation:true,headerText:"",width:"auto",content:[this._oIncludeTokenGrid,this._oExcludeTokenGrid],expand:function(E){this._updateTokenizer();if(E.mParameters.expand&&!(this._oTable instanceof sap.m.Table)){var i=q.sap.domById(this.getId()+"-scrollCont");if(i&&i.scrollTop){i.stop().animate({scrollTop:"1000"},1000);}}}.bind(this)}).addStyleClass("compVHBackgroundTransparent").addStyleClass("compVHTokensPanel").addStyleClass("compValueHelpDialogTokens");if(this._isPhone()){this._oSelectedTokens.addStyleClass("sapMTokenizerMultiLine");this._oExcludedTokens.addStyleClass("sapMTokenizerMultiLine");}this._oTokenizerGrid=new G({width:"100%",defaultSpan:"L12 M12 S12",hSpacing:0,vSpacing:0,content:this._oTokenizerPanel}).addStyleClass("compVHDarkBackground");return this._oTokenizerGrid;};n.prototype._createNavigationControl=function(){if(!this._isPhone()){this._oTabBar=new I({upperCase:true,expandable:false,items:[new b({visible:true,text:this._oRb.getText("VALUEHELPDLG_ITEMSTABLE"),key:sap.zen._ValueHelpViewMode.DESKTOP_LIST_VIEW}),new b({visible:true,text:this._oRb.getText("VALUEHELPDLG_RANGESTITLE",[""]),key:sap.zen._ValueHelpViewMode.DESKTOP_CONDITIONS_VIEW})],select:function(C){this._updateView(C.getParameters().key);}.bind(this)});this._oTabBar.setLayoutData(new F({shrinkFactor:0}));this._oVBox.addItem(this._oTabBar);}else{this._oSelectItemLI=new S({type:sap.m.ListType.Navigation,title:this._oRb.getText("VALUEHELPDLG_ITEMSTABLE")}).data("key",sap.zen._ValueHelpViewMode.PHONE_LIST_VIEW);this._oDefineConditionsLI=new S({type:sap.m.ListType.Navigation,title:this._oRb.getText("VALUEHELPDLG_RANGESTITLE",[""])}).data("key",sap.zen._ValueHelpViewMode.PHONE_CONDITIONS_VIEW);this._oMainListMenu=new L({mode:sap.m.ListMode.None,items:[this._oSelectItemLI,this._oDefineConditionsLI],itemPress:function(E){if(E){this._updateView(E.mParameters.listItem.data("key"));}}.bind(this)});this._oMainListMenu.setLayoutData(new F({shrinkFactor:0}));this._oVBox.addItem(this._oMainListMenu);this._oAdvancedSearchLink=new d({text:this._oRb.getText("VALUEHELPDLG_ADVANCEDSEARCH"),press:function(){this._updateView(sap.zen._ValueHelpViewMode.PHONE_SEARCH_VIEW);}.bind(this)}).addStyleClass("compVHAdvancedSearchLink");this._oAdvancedSearchLink.setLayoutData(new F({shrinkFactor:0}));this._oVBox.addItem(this._oAdvancedSearchLink);}};n.prototype._createFooterControls=function(){var i=this._getMessageView();var j=i.getMessageButton();this.addButton(j);this._oButtonOk=new B({text:this._oRb.getText("VALUEHELPDLG_OK"),press:this._onCloseAndTakeOverValues.bind(this),layoutData:new O({priority:sap.m.OverflowToolbarPriority.NeverOverflow})});this._oButtonCancel=new B({text:this._oRb.getText("VALUEHELPDLG_CANCEL"),press:this._onCancel.bind(this),layoutData:new O({priority:sap.m.OverflowToolbarPriority.NeverOverflow})});if(this._isPhone()){this._oButtonGo=new B({text:this._oRb.getText("VALUEHELPDLG_GO"),type:sap.m.ButtonType.Emphasized,press:this._onGo.bind(this),visible:false,layoutData:new O({priority:sap.m.OverflowToolbarPriority.NeverOverflow})});this._oButtonClear=new B({text:this._oRb.getText("VALUEHELPDLG_CLEAR"),press:this._onClear.bind(this),visible:false,layoutData:new O({priority:sap.m.OverflowToolbarPriority.NeverOverflow})});this.addButton(this._oButtonGo);this.addButton(this._oButtonClear);}this.addButton(this._oButtonOk);this.addButton(this._oButtonCancel);};n.prototype._getMessageView=function(){if(!this._oMessageView){var i=this.getId()+"_MessageView";this._oMessageView=new sap.zen.MessageViewHandler.MessageView(i,null,null,null);}return this._oMessageView;};n.prototype._updateMessageView=function(t){var i=this._getMessageView();if(i){i.init(t);}};n.prototype._updateView=function(i){if(this._currentViewMode===i){return;}switch(i){case sap.zen._ValueHelpViewMode.DESKTOP_LIST_VIEW:this._validateRanges(function(){this._oTokenizerGrid.setVisible(this.getSupportMultiselect());this._oMainLayout.removeAllItems();if(this._oTabBar&&this._oTabBar.getSelectedKey()!==sap.zen._ValueHelpViewMode.DESKTOP_LIST_VIEW){this._oTabBar.setSelectedKey(sap.zen._ValueHelpViewMode.DESKTOP_LIST_VIEW);}this._oMainLayout.addItem(this._oFilterBar);this._oMainLayout.addItem(this._oTable);this._updateDlgTitle();}.bind(this),function(){this._oTabBar.setSelectedKey(sap.zen._ValueHelpViewMode.DESKTOP_CONDITIONS_VIEW);this._updateView(sap.zen._ValueHelpViewMode.DESKTOP_CONDITIONS_VIEW);}.bind(this));break;case sap.zen._ValueHelpViewMode.DESKTOP_CONDITIONS_VIEW:if(this.getSupportRanges()){this.bCollectiveSearchActive=this.oSelectionTitle.getVisible()&&this.oSelectionButton.getVisible();this._oMainLayout.removeAllItems();if(this._oTabBar&&this._oTabBar.getSelectedKey()!==sap.zen._ValueHelpViewMode.DESKTOP_CONDITIONS_VIEW){this._oTabBar.setSelectedKey(sap.zen._ValueHelpViewMode.DESKTOP_CONDITIONS_VIEW);}this._oMainLayout.addItem(this._getRanges());this._oTokenizerGrid.setVisible(this.getSupportMultiselect());if(!(this.getMaxIncludeRanges()==="-1"&&this.getMaxExcludeRanges()!=="0"&&!this.getFilterMode())){this._oTokenizerGrid.setVisible(false);}}break;case sap.zen._ValueHelpViewMode.PHONE_MAIN_VIEW:this.setVerticalScrolling(false);this._oColSearchBox.setVisible(false);this._oMainListMenu.setVisible(true);this._updateNavigationControl();this._oAdvancedSearchLink.setVisible(false);if(this._oFilterBar&&this._oFilterBar.setFilterBarExpanded){this._oFilterBar.setVisible(false);this._oFilterBar.setFilterBarExpanded(false);}this._oTable.setVisible(false);this._oTokenizerGrid.setVisible(this.getSupportMultiselect());if(!(this.getMaxIncludeRanges()==="-1"&&this.getMaxExcludeRanges()!=="0"&&!this.getFilterMode())){this._oTokenizerGrid.setVisible(false);}if(this._oRanges){this._oRanges.setVisible(false);}this._oButtonGo.setVisible(false);this._oButtonClear.setVisible(false);this._oButtonOk.setVisible(true);this._oButtonCancel.setVisible(true);this._oBackButton.setVisible(false);this._bNoneMainView=false;if(!this._oTokenizerGrid.getVisible()&&!(this._oSelectItemLI.getVisible()&&this._oDefineConditionsLI.getVisible())){this._bNoneMainView=true;if(this._oSelectItemLI.getVisible()){this._updateView(sap.zen._ValueHelpViewMode.PHONE_LIST_VIEW);}if(this._oDefineConditionsLI.getVisible()){this._updateView(sap.zen._ValueHelpViewMode.PHONE_CONDITIONS_VIEW);}return;}break;case sap.zen._ValueHelpViewMode.PHONE_LIST_VIEW:this.setVerticalScrolling(true);this._oColSearchBox.setVisible(this.bCollectiveSearchActive);this._oMainListMenu.setVisible(false);if(this._oFilterBar&&this._oFilterBar.getFilterGroupItems){var s=this._oFilterBar&&this._oFilterBar.getFilterGroupItems()&&this._oFilterBar.getFilterGroupItems().length>0;this._oAdvancedSearchLink.setVisible(s);this._oFilterBar.setShowGoButton(!(this._oFilterBar&&this._oFilterBar.getBasicSearch()));this._oFilterBar.setVisible(true);this._oFilterBar.setFilterBarExpanded(false);}this._oTable.setVisible(true);this._oTokenizerGrid.setVisible(false);if(this._oRanges){this._oRanges.setVisible(false);}this._oButtonGo.setVisible(false);this._oButtonClear.setVisible(false);this._oButtonCancel.setVisible(true);this._oBackButton.setVisible(!this._bNoneMainView);break;case sap.zen._ValueHelpViewMode.PHONE_SEARCH_VIEW:this.setVerticalScrolling(true);this._oColSearchBox.setVisible(false);this._oMainListMenu.setVisible(false);if(this._oFilterBar){this._oFilterBar.setVisible(true);this._oFilterBar.setFilterBarExpanded(true);}this._oAdvancedSearchLink.setVisible(false);this._oTable.setVisible(false);this._oTokenizerGrid.setVisible(false);if(this._oRanges){this._oRanges.setVisible(false);}this._oButtonGo.setVisible(true);this._oButtonClear.setVisible(true);this._oButtonOk.setVisible(false);this._oButtonCancel.setVisible(true);this._oBackButton.setVisible(true);break;case sap.zen._ValueHelpViewMode.PHONE_CONDITIONS_VIEW:this.setVerticalScrolling(true);this._oColSearchBox.setVisible(false);this._oMainListMenu.setVisible(false);if(this._oFilterBar){this._oFilterBar.setVisible(false);}this._oAdvancedSearchLink.setVisible(false);this._oTable.setVisible(false);this._oTokenizerGrid.setVisible(false);if(!this._oRanges){this._oMainLayout.addItem(this._getRanges());}this._oRanges.setVisible(true);this._oButtonGo.setVisible(false);this._oButtonClear.setVisible(false);this._oButtonOk.setVisible(true);this._oButtonCancel.setVisible(true);this._oBackButton.setVisible(!this._bNoneMainView);break;default:break;}if(this._oMainListMenu&&this._oVBox){if(this._oFilterBar&&this._oFilterBar._handleVisibilityOfToolbar){this._oFilterBar._handleVisibilityOfToolbar();}this._oVBox.rerender();}this._currentViewMode=i;this._updateDlgTitle();if(i===sap.zen._ValueHelpViewMode.DESKTOP_LIST_VIEW){this.update();}};n.prototype._updatePropertySupportMultiselect=function(i){if(!this._oTable){return undefined;}if(!this._isPhone()){if(this._oTable.setSelectionMode){this._oTable.setSelectionMode(i?sap.ui.table.SelectionMode.MultiToggle:sap.ui.table.SelectionMode.Single);}}else if(this._oTable.setMode){this._oTable.setMode(i?sap.m.ListMode.MultiSelect:sap.m.ListMode.SingleSelectLeft);}return this;};n.prototype._updateNoDataText=function(N){if(this._oTable){if(this._oTable.setNoDataText){this._oTable.setNoDataText(N);}else if(this._oTable.setNoData){this._oTable.setNoData(N);}}};n.prototype._updateTitles=function(){this._updateTableTitle();this._updateTokenizer();};n.prototype._updateDlgTitle=function(){var i="";if(this._oTitle){if(this._oTabBar&&!this._oTabBar.getVisible()&&!this.getFilterMode()){if(this._oTabBar.getSelectedKey()===sap.zen._ValueHelpViewMode.DESKTOP_LIST_VIEW){i="VALUEHELPDLG_TITLE";}else if(this._oTabBar.getSelectedKey()===sap.zen._ValueHelpViewMode.DESKTOP_CONDITIONS_VIEW){if(this.getMaxIncludeRanges()==="1"&&this.getMaxExcludeRanges()==="0"){i="VALUEHELPDLG_SINGLECONDITION_TITLE";}else{i="VALUEHELPDLG_RANGESTITLE";j="";}}}else if(this._isPhone()&&!this.getFilterMode()){switch(this._currentViewMode){case sap.zen._ValueHelpViewMode.PHONE_MAIN_VIEW:i="";break;case sap.zen._ValueHelpViewMode.PHONE_LIST_VIEW:i="VALUEHELPDLG_ITEMSTABLE";break;case sap.zen._ValueHelpViewMode.PHONE_SEARCH_VIEW:i="VALUEHELPDLG_ADVANCEDSEARCH";break;case sap.zen._ValueHelpViewMode.PHONE_CONDITIONS_VIEW:if(this.getMaxIncludeRanges()==="1"&&this.getMaxExcludeRanges()==="0"){i="VALUEHELPDLG_SINGLECONDITION_TITLE";}else{i="VALUEHELPDLG_RANGESTITLE";j="";}break;default:break;}}var j=null;if(!j){j=this.getTitle();}if(i){j=this._oRb.getText(i,j);}if(j){this._oTitle.setText(j);}}};n.prototype._updateTableTitle=function(){if(!this._oTable){return;}this.oRows=this._oTable.getBinding("rows");var i=false;if(i&&this.getModel()&&this.getModel().isCountSupported){i=this.getModel().isCountSupported();}var j=0;if(i){if(this.oRows){j=this.oRows.getLength();}this._setTableTitle(this._sTableTitle1.replace("{0}",j));}else{this._setTableTitle(this._sTableTitleNoCount);}};n.prototype._updateTokenizer=function(){var i=false;if(this._oTokenizerPanel){i=this._oTokenizerPanel.getExpanded();}var j=this._oSelectedTokens.getTokens().length;var s=this._oExcludedTokens.getTokens().length;var t=this._oRb.getText("VALUEHELPDLG_SELECTEDITEMS");var u=this._oRb.getText("VALUEHELPDLG_NONESELECTEDITEMS");var v=t.replace("{0}",j.toString());var w=this._oRb.getText("VALUEHELPDLG_EXCLUDEDITEMS",s.toString());var x=j===0?u:v;if(this._oTokenizerPanel){if(!i){if(this._isPhone()){v=this._oRb.getText("VALUEHELPDLG_SELECTEDITEMS_SHORT",j.toString());w=this._oRb.getText("VALUEHELPDLG_EXCLUDEDITEMS_SHORT",s.toString());}x="";if(j!==0){x=v;}if(s!==0){x+=(j!==0?" / ":"")+w;}if(x===""){x=u;}}else if(j===0&&s!==0){x=w;w="";}this._oTokenizerPanel.setHeaderText(x);this._oSelectedTokenTitle.setText(x);}else{this._oSelectedTokenTitle.setText(x);}this._oRemoveAllSelectedItemsBtn.setEnabled(j!==0);this._oExcludedTokenTitle.setText(w);if(j===0&&s!==0){this._oIncludeTokenGrid.addStyleClass("displayNone");if(!this._isPhone()){this._oExcludedTokenTitle.addStyleClass("displayNone");}}else{this._oIncludeTokenGrid.removeStyleClass("displayNone");this._oExcludedTokenTitle.removeStyleClass("displayNone");}if(s===0){this._oExcludeTokenGrid.addStyleClass("displayNone");}else{this._oExcludeTokenGrid.removeStyleClass("displayNone");}};n.prototype._updateNavigationControl=function(){var i=!this.getSupportRangesOnly();var j=this.getSupportRangesOnly()||this.getSupportRanges();if(this._oTabBar){var s=this._oTabBar.getItems();s[0].setVisible(i);s[1].setVisible(j);this._oTabBar.setVisible(i&&j);this._updateDlgTitle();}if(this._oMainListMenu){this._oSelectItemLI.setVisible(i);this._oDefineConditionsLI.setVisible(j);}};n.prototype._updateFooterControls=function(){};n.prototype.setSupportMultiselect=function(i){this.setProperty("supportMultiselect",i);this._updatePropertySupportMultiselect(i);this._oTokenizerGrid.setVisible(i);return this;};n.prototype.setSupportRanges=function(i){this.setProperty("supportRanges",i);this._updateNavigationControl();return this;};n.prototype.setSupportRangesOnly=function(i){this.setProperty("supportRangesOnly",i);this._updateNavigationControl();return this;};n.prototype.setTitle=function(t){this.setProperty("title",t);this._updateDlgTitle();return this;};n.prototype.setBasicSearchText=function(t){this.setProperty("basicSearchText",t);if(this._oFilterBar&&this._oFilterBar._oBasicSearchField){this._oFilterBar._oBasicSearchField.setValue(t);}return this;};n.prototype.setUpdateSingleRowCallback=function(s){this.fSingleRowCallback=s;this._updateNavigationControl();};n.prototype._isPhone=function(){return sap.ui.Device.system.phone;};n.prototype._hasListeners=function(i){if(this._bTableCreatedInternal){return false;}return this.hasListeners(i);};n.prototype._rotateSelectionButtonIcon=function(i){if(!sap.ui.Device.system.phone){var j=sap.ui.getCore().byId(this.oSelectionButton.$("img")[0].id);if(i){j.addStyleClass("sapUiVHImageExpand");}else{j.removeStyleClass("sapUiVHImageExpand");}}};n.prototype.onAfterRendering=function(){sap.m.Dialog.prototype.onAfterRendering.apply(this);if(this._oTable){this._updateTitles();}if(!this._isPhone()&&this.getContentHeight()===""){if(this.getSupportRangesOnly()&&(this.getMaxExcludeRanges()==="-1"||this.getMaxIncludeRanges()==="-1")){this.setContentHeight("70%");}else{var i=this.getDomRef("scroll");var j=i.clientHeight;this.setContentHeight(j+"px");}if(sap.ui.table.Table&&this._oTable&&this._oTable instanceof sap.ui.table.Table){this._oTable.setVisibleRowCountMode(sap.ui.table.VisibleRowCountMode.Auto);}}};n.prototype._getDialogOffset=function(w){var i=w||this._$Window.width();var j={small:600,large:1024};var s=1;if((i>j.small&&i<j.large)||i>=j.large){s=2;}var t=function(u){var v=parseInt(window.getComputedStyle(document.body).fontSize,10);return(u*v)*2;};return{top:t(s),left:t(s)};};n.prototype.suggest=function(s){this._fSuggestCallback=s;if(this._oFilterPanel){if(this._oFilterPanel._oIncludeFilterPanel){this._oFilterPanel._oIncludeFilterPanel._fSuggestCallback=this._fSuggestCallback;}if(this._oFilterPanel._oExcludeFilterPanel){this._oFilterPanel._oExcludeFilterPanel._fSuggestCallback=this._fSuggestCallback;}}};n.prototype.open=function(){this._bIgnoreSelectionChange=false;this.bCollectiveSearchActive=this.oSelectionTitle.getVisible()&&this.oSelectionButton.getVisible();if(this._oColSearchBox){this._oColSearchBox.setVisible(this.bCollectiveSearchActive);}if(!this._isPhone()){if(this.getSupportRangesOnly()||this.getFilterMode()){this._updateView(sap.zen._ValueHelpViewMode.DESKTOP_CONDITIONS_VIEW);}else if(!this._oTable){this._createDefaultTable();}this.setContentWidth(this._getDefaultContentWidth());}else{if(!this._oTable){this._createDefaultTable();}this._updateView(sap.zen._ValueHelpViewMode.PHONE_MAIN_VIEW);}sap.m.Dialog.prototype.open.apply(this);return this;};n.prototype.exit=function(){var i=function(j){if(j&&j.destroy){j.destroy();}return null;};this._oTokenizerGrid=i(this._oTokenizerGrid);this._oRanges=i(this._oRanges);this._oFilterPanel=i(this._oFilterPanel);if(this._bTableCreatedInternal){this._oTable=i(this._oTable);}this._oTable=null;this.theTable=null;this._oTabBar=i(this._oTabBar);this._oMainListMenu=i(this._oMainListMenu);this._oVBox=i(this._oVBox);this._oVarManagment=i(this._oVarManagment);this._aRangeKeyFields=i(this._aRangeKeyFields);this._aIncludeRangeOperations=i(this._aIncludeRangeOperations);this._aExcludeRangeOperations=i(this._aExcludeRangeOperations);if(this._oFilterBar){this._oFilterBar=i(this._oFilterBar);}this._oRb=i(this._oRb);this._sTableTitle1=i(this._sTableTitle1);this._sTableTitle2=i(this._sTableTitle2);this._sTableTitleNoCount=i(this._sTableTitleNoCount);this._sValidationDialogTitle=i(this._sValidationDialogTitle);this._sValidationDialogMessage=i(this._sValidationDialogMessage);this._sValidationDialogFieldMessage=i(this._sValidationDialogFieldMessage);this._oSelectedItems=i(this._oSelectedItems);this._oSelectedRanges=i(this._oSelectedRanges);this._oButtonOk=i(this._oButtonOk);this._oButtonCancel=i(this._oButtonCancel);if(this._oButtonGo){this._oButtonGo=i(this._oButtonGo);}if(this._oButtonClear){this._oButtonClear=i(this._oButtonClear);}if(this._oColSearchBox){this._oColSearchBox=i(this._oColSearchBox);}};n.prototype._onCloseAndTakeOverValues=function(){var t=this;var C=function(){var j=t._oSelectedItems.getSelectedItemsTokenArray(t.getKey(),t.getDescriptionKey(),t.getTokenDisplayBehaviour());if(t._oSelectedRanges){var i=0;for(var s in t._oSelectedRanges){var u=t._oSelectedRanges[s];var v=u.tokenValue;if(!v){v=t._getFormattedRangeTokenText(u.operation,u.value1,u.value2,u.exclude,u.keyField);}if(!u._oGrid||u._oGrid.select.getSelected()){var w=new sap.m.Token({key:"range_"+i}).data("range",{"isRange":true,"exclude":u.exclude,"operation":u.operation,"keyField":u.keyField,"value1":u.value1,"value2":u.value2});w.setText(v);w.setTooltip(typeof v==="string"?v:null);j.push(w);i++;}}}t.fireOk({"tokens":j});};this._validateRanges(C);};n.prototype._onCancel=function(){this.fireCancel();};n.prototype._onGo=function(){this._oFilterBar.search();};n.prototype._onClear=function(){this._oFilterBar.clear();};n.prototype.setFilterBar=function(C){this.setAggregation("filterBar",C);if(this._oMainLayout&&C){if(this._isPhone()){if(this._oFilterBar){this._oVBox.removeItem(this._oFilterBar);}}else if(this._oFilterBar){this._oMainLayout.removeItem(this._oFilterBar);}this._oFilterBar=C;if(this._oFilterBar){this._oFilterBar.addStyleClass("compVHSearch");if(this._isPhone()){if(this._oFilterBar.getBasicSearch){var i=sap.ui.getCore().byId(this._oFilterBar.getBasicSearch());if(i instanceof sap.m.SearchField){i.setShowSearchButton(true);i.attachSearch(function(E){if(E.mParameters.refreshButtonPressed!==undefined){this.getFilterBar().search();}}.bind(this));}this._oFilterBar.setShowGoOnFB(false);}this._oColSearchBox.setLayoutData(new F({shrinkFactor:0}));this._oVBox.insertItem(this._oColSearchBox,0);if(this._oFilterBar.setLayoutData){this._oFilterBar.setLayoutData(new F({shrinkFactor:0}));}this._oVBox.insertItem(this._oFilterBar,1);this._oFilterBar.attachSearch(function(){this._updateView(sap.zen._ValueHelpViewMode.PHONE_LIST_VIEW);}.bind(this));if(this._currentViewMode===sap.zen._ValueHelpViewMode.PHONE_LIST_VIEW&&this._oFilterBar.setFilterBarExpanded){this._oFilterBar.setVisible(true);this._oFilterBar.setFilterBarExpanded(false);this._handleFilterBarInitialize();}}else{if(this._oFilterBar._setCollectiveSearch){this._oFilterBar._setCollectiveSearch(this._oColSearchBox);}this._oMainLayout.insertItem(this._oFilterBar,0);}}if(this._oFilterBar._oSearchButton){this.setInitialFocus(this._oFilterBar._oSearchButton);}if(this._oFilterBar._oBasicSearchField){var j=this._oFilterBar._oBasicSearchField;j.setValue(this.getBasicSearchText());this.setInitialFocus(j);}}return this;};n.prototype._handleFilterBarInitialize=function(){if(this._currentViewMode===sap.ui.comp.valuehelpdialog._ValueHelpViewMode.PHONE_LIST_VIEW){this._oFilterBar._handleVisibilityOfToolbar();var i=this._oFilterBar&&this._oFilterBar.getFilterGroupItems()&&this._oFilterBar.getFilterGroupItems().length>0;this._oAdvancedSearchLink.setVisible(i);this._oFilterBar.setShowGoButton(!(this._oFilterBar&&this._oFilterBar.getBasicSearch()));}};n.prototype.getFilterBar=function(){return this._oFilterBar;};n.prototype.setTable=function(t){if(this._oTable){this._oMainLayout.removeItem(this._oTable);}this._bTableCreatedInternal=(arguments.length>1)&&(arguments[1]===true);if(t instanceof sap.ui.comp.smarttable.SmartTable){this._oTable=t.getTable();}else{this._oTable=t;}this._oTable.setLayoutData(new F({shrinkFactor:0,growFactor:1}));this.theTable=this._oTable;this._initializeTable();this._oMainLayout.addItem(t);};n.prototype.getTable=function(){if(!this._oTable){this._createDefaultTable();}return this._oTable;};n.prototype._setTableTitle=function(t){if(sap.ui.Device.system.desktop&&!(this._oTable instanceof sap.m.Table)){if(this._oTable.getTitle()){this._oTable.getTitle().setText(t);}else{this._oTable.setTitle(t);}}};n.prototype.resetTableState=function(){if(this._oTable){if(this._oTable.unbindRows){this._oTable.unbindRows();}this._updateNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_PRESSSEARCH"));}};n.prototype._getDefaultContentWidth=function(){var i=0;if(this._oTable){i=this._oTable.getColumns().length;}var j=Math.max(1080,i*130);return j+"px";};n.prototype.TableStateSearchData=function(){this._updateNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_PRESSSEARCH"));};n.prototype.TableStateDataFilled=function(){this._updateNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_NODATA"));};n.prototype.TableStateDataSearching=function(){this._updateNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_SEARCHING"));};n.prototype._createDefaultTable=function(){this.setTable(new sap.ui.table.Table(),true);};n.prototype._initializeTable=function(){if(sap.ui.table.Table&&this._oTable instanceof sap.ui.table.Table){this._oTable.setTitle(sap.ui.Device.system.desktop?this._sTableTitleNoCount:null);if(this._bTableCreatedInternal){this._oTable.setSelectionBehavior(sap.ui.table.SelectionBehavior.Row);}this._oTable.setSelectionMode(this.getSupportMultiselect()?sap.ui.table.SelectionMode.MultiToggle:sap.ui.table.SelectionMode.Single);this._updateNoDataText(this._oRb.getText("VALUEHELPDLG_TABLE_PRESSSEARCH"));this._oTable.setVisibleRowCountMode(sap.ui.table.VisibleRowCountMode.Fixed);this._oTable.setMinAutoRowCount(sap.ui.Device.system.desktop?5:4);this._oTable.addStyleClass("compVHMainTable");}else{this._oTable.setMode(this.getSupportMultiselect()?sap.m.ListMode.MultiSelect:sap.m.ListMode.SingleSelectLeft);this._oTable.setGrowing(true);}this._oTable.attachRowSelectionChange(o.bind(this));if(!(this._oTable.getParent()instanceof sap.ui.comp.smarttable.SmartTable)){this._oTable.bindAggregation("columns","columns>/cols",p.bind(this));}};function o(C){if(this._bIgnoreSelectionChange||!C.getParameter("userInteraction")){return;}var j=C.mParameters;var s={tableSelectionParams:C.mParameters,updateTokens:[],useDefault:false};if(this._hasListeners("selectionChange")){this._bIgnoreSelectionChange=true;this.fireSelectionChange(s);this._bIgnoreSelectionChange=false;s.updateTokens.forEach(function(J){this._addRemoveTokenByKey(J.sKey,J.oRow,J.bSelected);}.bind(this));}else{s.useDefault=true;}var i=0;var t=0;var u=null;var v=null;var w=null;if(s.useDefault){if(sap.ui.table.Table&&this._oTable instanceof sap.ui.table.Table){var x=C.getSource();var y=C.getParameter("rowIndices");for(i=0;i<y.length;i++){t=y[i];u=x.getContextByIndex(t);v=u?u.getObject():null;if(!v){sap.m.MessageBox.show(this._oRb.getText("VALUEHELPDLG_SELECTIONFAILED"),{icon:sap.m.MessageBox.Icon.ERROR,title:this._oRb.getText("VALUEHELPDLG_SELECTIONFAILEDTITLE"),actions:[sap.m.MessageBox.Action.OK],styleClass:this.$().closest(".sapUiSizeCompact").length?"sapUiSizeCompact":""});return;}}if(!this.getSupportMultiselect()){this._oSelectedTokens.destroyTokens();this._oSelectedItems.removeAll();}var z=false;if(x.getBinding("rows").aKeys){z=true;}for(i=0;i<y.length;i++){t=y[i];var A=x.isIndexSelected(t);u=x.getContextByIndex(t);v=u?u.getObject():null;if(v){if(z){w=u.sPath.substring(1);}else{w=v[this.getKey()];}this._addRemoveTokenByKey(w,v,A);this._changeTableRowSelectionForKey(w,A);}}}else{for(i=0;i<j.listItems.length;i++){var E=j.listItems[i];u=E.getBindingContext();v=u?u.getObject():null;if(v){w=v[this.getKey()];this._addRemoveTokenByKey(w,v,j.selected);}}}}if(sap.ui.table.Table&&this._oTable instanceof sap.ui.table.Table){this._updateTitles();}}function p(i,C){if(sap.ui.table.Table&&this._oTable instanceof sap.ui.table.Table){var j,s;if(C.getProperty("type")==="string"){s={path:C.getProperty("template")};}if(C.getProperty("type")==="boolean"){j=new sap.m.CheckBox({enabled:false,selected:{path:C.getProperty("template")}});}else{j=new sap.m.Text({wrapping:false,text:{path:C.getProperty("template"),type:C.getProperty("oType")},tooltip:s});}if(this._oTable instanceof sap.ui.table.AnalyticalTable){return new sap.ui.table.AnalyticalColumn(i,{label:"{columns>label}",tooltip:"{columns>tooltip}",template:j,width:"{columns>width}",hAlign:j instanceof sap.m.CheckBox?sap.ui.core.HorizontalAlign.Center:sap.ui.core.HorizontalAlign.Begin,filterProperty:C.getProperty("filter")});}else{return new sap.ui.table.Column(i,{label:"{columns>label}",tooltip:"{columns>tooltip}",template:j,width:"{columns>width}",hAlign:j instanceof sap.m.CheckBox?sap.ui.core.HorizontalAlign.Center:sap.ui.core.HorizontalAlign.Begin,sortProperty:C.getProperty("sort"),sorted:C.getProperty("sorted"),sortOrder:C.getProperty("sortOrder"),filterProperty:C.getProperty("filter")});}}else{var t=C.getProperty("label");var u=this._oTable.getColumns().length>=2;return new sap.m.Column({header:new sap.m.Label({text:t}),demandPopin:u,minScreenWidth:u?(this._oTable.getColumns().length+1)*10+"rem":"1px"});}}n.prototype._changeTableRowSelectionForKey=function(j,s){this._bIgnoreSelectionChange=true;var t=this._oTable;if(sap.ui.table.Table&&t instanceof sap.ui.table.Table){var u=t.getBinding("rows");if(u){if(u.aKeys){for(var i=0;i<u.aKeys.length;i++){if(u.aKeys[i]===j){if(s){t.addSelectionInterval(i,i);}else{t.removeSelectionInterval(i,i);}}}}else{this.oRows=t.getBinding("rows");if(this.oRows.aIndices){for(i=0;i<this.oRows.aIndices.length;i++){var v=t.getContextByIndex(i);var w=null;if(v){w=v.getObject();}else{w=t.getBinding("rows").oList[this.oRows.aIndices[i]];}if(w[this.getKey()]===j){if(s){t.addSelectionInterval(i,i);}else{t.removeSelectionInterval(i,i);}}}}}}}else{for(i=0;i<t.getItems().length;i++){var x=t.getItems()[i];var y=x.getBindingContext().getObject();if(y[this.getKey()]===j){t.setSelectedItem(x,s);break;}}}this._bIgnoreSelectionChange=false;};n.prototype.removeAllSelections=function(i){this._oSelectedItems.removeAll();this._oSelectedTokens.removeAllTokens();if(i){this._oSelectedTokens.destroyTokens();}};n.prototype.setSelection=function(s,i,R){var j=true;if(!i){i=R?R.key:undefined;}if(i){if(s){this._oSelectedItems.add(i,R);this._addToken2Tokenizer(i,this._getFormattedTokenText(i),this._oSelectedTokens);}else{this._oSelectedItems.remove(i);j=this._removeTokenFromTokenizer(i,this._oSelectedTokens);}}return j;};n.prototype.setChildSelection=function(s,R,i){if(R){if(i){this.setSelection(s,R.key,R);}var j=_.filter(R,function(C){return C.key&&!C.node;}.bind(this));if(!j||j.length<=0){return;}_.forEach(j,function(C){this.setChildSelection(s,C,true);}.bind(this));}};n.prototype.setTokens=function(t){var j=null;if(!t||!t.length){this._oSelectedItems.removeAll();this._oSelectedRanges={};return;}for(var i=0;i<t.length;i++){var s=t[i];if(!s){continue;}var u=s.getKey();var v=s.getText();var w=s.data("longKey");var x=s.data("row");var y=null;var z=false;if(s.data("range")){y=s.data("range");z=y.isRange;}if(y){j=this._getKeyFieldByKey(y.keyField);y.value1=this._convertValue2Object(y.value1,j.type);y.value2=this._convertValue2Object(y.value2,j.type);}if(z){var A=this._getFormattedRangeTokenText(y.operation,y.value1,y.value2,y.exclude,y.keyField);this._addToken2Tokenizer(u,A,y.exclude?this._oExcludedTokens:this._oSelectedTokens);this._oSelectedRanges[u]=y;}else{if(w){u=w;}this._oSelectedItems.add(u,x?x:v);var C=new T({key:u,text:v,tooltip:v});this._oSelectedTokens.addToken(C);}}};n.prototype._convertValue2Object=function(v,t){if(!v){return v;}var i=v;switch(t){case"date":i=new Date(v);break;case"time":i=new Date(v);if(!i||(i.getDate&&Number.isNaN(i.getDate()))){i=sap.ui.core.format.DateFormat.getTimeInstance().parse(v);}break;case"datetime":i=new Date(v);break;case"numeric":i=parseFloat(v);break;case"boolean":if(v===""){i=null;}else{i=v=="true";}break;default:break;}return i;};n.prototype._getTokenByKey=function(j,t){var s=t.getTokens();for(var i=0;i<s.length;i++){var u=s[i];if(!u){continue;}if(u.getKey()===j){return u;}}return null;};n.prototype._addRemoveTokenByKey=function(i,R,j){if(j){this._oSelectedItems.add(i,R);this._addToken2Tokenizer(i,this._getFormattedTokenText(i),this._oSelectedTokens);}else{this._oSelectedItems.remove(i);this._removeTokenFromTokenizer(i,this._oSelectedTokens);}};n.prototype._removeToken=function(i){if(!this._removeTokenFromTokenizer(i,this._oSelectedTokens)){this._removeTokenFromTokenizer(i,this._oExcludedTokens);}};n.prototype._addToken2Tokenizer=function(i,t,j){var s=(typeof t==="string")?t:"";var u=this._getTokenByKey(i,j);if(!u){u=new sap.m.Token({key:i});j.addToken(u);this._updateTokenizer();}if(u){u.setText(t);u.setTooltip(s);}};n.prototype._removeTokenFromTokenizer=function(i,t){var j=this._getTokenByKey(i,t);if(j){this._ignoreRemoveToken=true;t.removeToken(j);this._ignoreRemoveToken=false;this._updateTokenizer();return true;}return false;};n.prototype._getFormattedTokenText=function(i){var j=this._oSelectedItems.getItem(i);var s=j[this.getDescriptionKey()];var t=j["displaykey"];if(!t){t=s;}if(s===undefined){if(typeof j==="string"){s=j;}else{s="";}}if(s===""){s=t;}else{if(t===s){s="";}s=sap.ui.comp.util.FormatUtil.getFormattedExpressionFromDisplayBehaviour(this.getTokenDisplayBehaviour()?this.getTokenDisplayBehaviour():sap.ui.comp.smartfilterbar.ControlConfiguration.DISPLAYBEHAVIOUR.descriptionAndId,t,s);}return s;};n.prototype._getRanges=function(){if(!this._oRanges){this._oRanges=this._createRanges();}return this._oRanges;};n.prototype._createRanges=function(){this._oFilterPanel=new sap.m.P13nFilterPanel({maxIncludes:this.getMaxIncludeRanges(),maxExcludes:this.getMaxExcludeRanges(),containerQuery:true,addFilterItem:function(E){var z=E.mParameters;var A={exclude:z.filterItemData.getExclude(),keyField:z.filterItemData.getColumnKey(),operation:z.filterItemData.getOperation(),value1:z.filterItemData.getValue1(),value2:z.filterItemData.getValue2()};this._oSelectedRanges[z.key]=A;var C=this._getKeyFieldByKey(A.keyField);A.value1=this._convertValue2Object(A.value1,C.type);A.value2=this._convertValue2Object(A.value2,C.type);this._oFilterPanel.addFilterItem(z.filterItemData);var J=this._getFormattedRangeTokenText(A.operation,A.value1,A.value2,A.exclude,A.keyField);this._addToken2Tokenizer(z.key,J,A.exclude?this._oExcludedTokens:this._oSelectedTokens);this._updateTokenizer();}.bind(this),removeFilterItem:function(E){var z=E.mParameters;delete this._oSelectedRanges[z.key];this._removeToken(z.key);this._updateTokenizer();}.bind(this),updateFilterItem:function(E){var z=E.mParameters;var A=this._oSelectedRanges[z.key];A.exclude=z.filterItemData.getExclude();A.keyField=z.filterItemData.getColumnKey();A.operation=z.filterItemData.getOperation();A.value1=z.filterItemData.getValue1();A.value2=z.filterItemData.getValue2();var C=this._getKeyFieldByKey(A.keyField);A.value1=this._convertValue2Object(A.value1,C.type);A.value2=this._convertValue2Object(A.value2,C.type);var J=this._getFormattedRangeTokenText(A.operation,A.value1,A.value2,A.exclude,A.keyField);this._addToken2Tokenizer(z.key,J,A.exclude?this._oExcludedTokens:this._oSelectedTokens);this._updateTokenizer();}.bind(this)});this._oFilterPanel._oIncludeFilterPanel.setDisplayFormat(this.getDisplayFormat());this._oFilterPanel._oExcludeFilterPanel.setDisplayFormat(this.getDisplayFormat());this._oFilterPanel._oIncludeFilterPanel._fSuggestCallback=this._fSuggestCallback;this._oFilterPanel._oExcludeFilterPanel._fSuggestCallback=this._fSuggestCallback;this._oFilterPanel._oIncludeFilterPanel._sAddRemoveIconTooltipKey="CONDITION";this._oFilterPanel._oExcludeFilterPanel._sAddRemoveIconTooltipKey="CONDITION";if(this._aIncludeRangeOperations){for(var i in this._aIncludeRangeOperations){this._oFilterPanel.setIncludeOperations(this._aIncludeRangeOperations[i],i);}}if(this._aExcludeRangeOperations){for(i in this._aExcludeRangeOperations){this._oFilterPanel.setExcludeOperations(this._aExcludeRangeOperations[i],i);}}if(this._aRangeKeyFields){this._aRangeKeyFields.forEach(function(z){this._oFilterPanel.addItem(new sap.m.P13nItem({columnKey:z.key,text:z.label,type:z.type,maxLength:z.maxLength,formatSettings:z.formatSettings,scale:z.scale,precision:z.precision,isDefault:z.isDefault,values:z.type==="boolean"?this._getBooleanValues():null}));},this);}if(this._oSelectedRanges){for(var j in this._oSelectedRanges){var s=this._oSelectedRanges[j];var t=this._getKeyFieldByKey(s.keyField);var u;if(t.type==="date"){u=sap.ui.core.format.DateFormat.getDateInstance();}else if(t.type==="time"){u=sap.ui.core.format.DateFormat.getTimeInstance();}var v=s.value1;var w=s.value2;if(u){v=u.format(v);w=u.format(w);}var x=new sap.m.P13nFilterItem({key:j,exclude:s.exclude,columnKey:s.keyField,operation:s.operation});x.setValue1(v);x.setValue2(w);this._oFilterPanel.addFilterItem(x);}}var y=new sap.ui.layout.Grid({width:"100%",defaultSpan:"L12 M12 S12",vSpacing:0,hSpacing:0,content:[this._oFilterPanel]});this._sValidationDialogTitle=this._oRb.getText("VALUEHELPVALDLG_TITLE");this._sValidationDialogMessage=this._oRb.getText("VALUEHELPVALDLG_MESSAGE");this._sValidationDialogFieldMessage=this._oRb.getText("VALUEHELPVALDLG_FIELDMESSAGE");return y;};n.prototype.getRangeKeyFields=function(){return this._aRangeKeyFields;};n.prototype._getKeyFieldByKey=function(i){var j;if(this._aRangeKeyFields){this._aRangeKeyFields.some(function(s){if(typeof s!=="string"&&s.key===i){j=s;return true;}return false;});}return j;};n.prototype._removeRangeByKey=function(i,j){var s=i;if(typeof s==="string"){s=[s];}s.forEach(function(i,u,v){var w=this._oSelectedRanges[i];if(w.exclude===j&&!w._oGrid){delete this._oSelectedRanges[i];if(this._oFilterPanel){var t=w.exclude?this._oFilterPanel._oExcludeFilterPanel:this._oFilterPanel._oIncludeFilterPanel;if(v.length===1){t.removeCondition(i);}else{t._removeConditionFromMap(i);}}}},this);if(s.length>1&&this._oFilterPanel){var t=j?this._oFilterPanel._oExcludeFilterPanel:this._oFilterPanel._oIncludeFilterPanel;t._clearConditions();t._fillConditions();}};n.prototype._validateRanges=function(C,i){if(this._oRanges){if(!this._oRanges.getParent()){C();return;}var j=this._oFilterPanel.validateConditions();if(!j){sap.m.MessageBox.show(this._sValidationDialogMessage,{icon:sap.m.MessageBox.Icon.WARNING,title:this._sValidationDialogTitle,actions:[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],styleClass:this.$().closest(".sapUiSizeCompact").length?"sapUiSizeCompact":"",onClose:function(s){if(s===sap.m.MessageBox.Action.OK&&C){C();}if(s===sap.m.MessageBox.Action.CANCEL&&i){i();}}});return;}}C();};n.prototype.setRangeKeyFields=function(R){this._aRangeKeyFields=R;};n.prototype.setIncludeRangeOperations=function(i,t){t=t||"default";this._aIncludeRangeOperations[t]=i;if(this._oFilterPanel){this._oFilterPanel.setIncludeOperations(this._aIncludeRangeOperations[t],t);}};n.prototype.setExcludeRangeOperations=function(t,i){i=i||"default";this._aExcludeRangeOperations[i]=t;if(this._oFilterPanel){this._oFilterPanel.setExcludeOperations(this._aExcludeRangeOperations[i],i);}};n.prototype._getFormattedRangeTokenText=function(i,v,j,s,t){var u="";var w=null;var x=this._getKeyFieldByKey(t);if(x){switch(x.type){case"numc":w={format:function(A){return this.oType.formatValue(A,"string");},oType:new sap.ui.model.odata.type.String({},x.formatSettings)};break;case"numeric":var y;if(x.precision||x.scale){y={};if(x.precision){y["maxIntegerDigits"]=parseInt(x.precision,10);}if(x.scale){y["maxFractionDigits"]=parseInt(x.scale,10);}}w=sap.ui.core.format.NumberFormat.getFloatInstance(y);break;case"date":w=sap.ui.core.format.DateFormat.getDateInstance(q.extend({},x.formatSettings,{strictParsing:true}));v=new Date(v);j=j!==""?new Date(j):null;break;case"time":w=sap.ui.core.format.DateFormat.getTimeInstance(q.extend({},x.formatSettings,{strictParsing:true}));v=new Date(v);j=j!==""?new Date(j):null;break;case"datetime":w=sap.ui.core.format.DateFormat.getDateTimeInstance(q.extend({},x.formatSettings,{strictParsing:true}));v=new Date(v);j=j!==""?new Date(j):null;break;case"boolean":var z=this._getBooleanValues();v=z[v?2:1];j=z[j?2:1];break;case"stringdate":if(sap.m.P13nConditionStringDateFormatter){w=new sap.m.P13nConditionStringDateFormatter(q.extend({},x.formatSettings,{strictParsing:true}));}break;default:break;}if(w){if(v){v=w.format(v);}if(j){j=w.format(j);}}}if(v!==""){switch(i){case l.Initial:u="=''";break;case l.EQ:u="="+v;break;case l.GT:u=">"+v;break;case l.GE:u=">="+v;break;case l.LT:u="<"+v;break;case l.LE:u="<="+v;break;case l.Contains:u=v;if(!u.startsWith("*")){u="*"+u;}if(!u.endsWith("*")){u=u+"*";}break;case l.StartsWith:u=v;if(!u.endsWith("*")){u=u+"*";}break;case l.EndsWith:u=v;if(!u.startsWith("*")){u="*"+u;}break;case l.BT:if(j!==""){u=v+"..."+j;break;}break;default:break;}}if(s&&u!==""){u="!("+u+")";}if(this._aRangeKeyFields&&this._aRangeKeyFields.length>1&&x&&x.label&&u!==""){u=x.label+": "+u;}return u;};n.prototype._getBooleanValues=function(){var i=new sap.ui.model.odata.type.Boolean();var j=null;if(i){j=["",i.formatValue(false,"string"),i.formatValue(true,"string")];}return j;};sap.zen._ValueHelpViewMode={DESKTOP_LIST_VIEW:"DESKTOP_LIST_VIEW",DESKTOP_CONDITIONS_VIEW:"DESKTOP_CONDITIONS_VIEW",PHONE_MAIN_VIEW:"PHONE_MAIN_VIEW",PHONE_SEARCH_VIEW:"PHONE_SEARCH_VIEW",PHONE_LIST_VIEW:"PHONE_LIST_VIEW",PHONE_CONDITIONS_VIEW:"PHONE_CONDITIONS_VIEW"};var r=new n();m.dispatcher.addHandlers(r.getType(),r,"DataSourceControlDecorator");return n;});
