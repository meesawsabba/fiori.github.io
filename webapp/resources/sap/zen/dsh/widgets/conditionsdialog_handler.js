/*
 * SAPUI5
  (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["jquery.sap.global","sap/base/Log","sap/zen/commons/thirdparty/lodash","sap/zen/dsh/utils/BaseHandler"],function(q,L,_,B){"use strict";var C=function(){var h=this;B.apply(this,arguments);this.sLocalizationPrefix="com.sap.zen.firefly.impl.";this.oRessources=q.sap.resources({url:sap.ui.resource("sap.zen.dsh","i18n/localization/localization.properties")});this.getRuntimeText=function(t){return h.oRessources.getText(h.sLocalizationPrefix+t);};function c(o){if(o&&o.condition&&o.condition.thresholds){o.condition.thresholds=o.condition.thresholds.map(function(t){if(typeof t.value1!=="number"){t.value1=Number(t.value1);}if(t.value2&&typeof t.value2!=="number"){t.value2=Number(t.value2);}return t;});}}this.create=function(o,f){c(f);var m=new sap.ui.model.json.JSONModel();m.setData(f);var i=o||new sap.m.Button(f.id,{visible:false});var D=g(m);i.ZEN_ConditionsDialog=D;i.exit=function(){if(i.ZEN_ConditionsDialog){i.ZEN_ConditionsDialog.destroy();i.ZEN_ConditionsDialog=null;}};D.open();return i;};function g(m){var D=new sap.m.Dialog({resizable:true,draggable:true,contentHeight:"420px",contentWidth:"715px"});var l=new sap.m.VBox({fitContainer:true});var r=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");var f=b(m);var F=f.getContent()[0];var A=e();l.addItem(f);l.addItem(d(F));l.addItem(A);D.addContent(l);D.addButton(new sap.m.Button({text:r.getText("VALUEHELPDLG_OK"),press:function(){new Function(h.prepareCommand(D.getModel().getProperty("/submitCommand"),"__JSON__",JSON.stringify({thresholds:F.getConditions(),dimensionEvaluationType:A.getContent()[1].getSelectedItem().getKey(),evaluateRulesWithAnd:Boolean(A.getContent()[3].getSelectedIndex())})))();D.close();},layoutData:new sap.m.OverflowToolbarLayoutData({priority:sap.m.OverflowToolbarPriority.NeverOverflow})}));D.addButton(new sap.m.Button({text:r.getText("VALUEHELPDLG_CANCEL"),press:function(){D.close();},layoutData:new sap.m.OverflowToolbarLayoutData({priority:sap.m.OverflowToolbarPriority.NeverOverflow})}));D.setTitle(h.getRuntimeText("CONDITIONSDLG_TITLE"));D.attachBeforeOpen(function(){F.setConditions(m.getProperty("/condition/thresholds"));});D.setModel(m);return D;}function b(m){var f=new sap.m.P13nFilterPanel({containerQuery:true,maxExcludes:0,items:{path:"/measures",template:new sap.m.P13nItem({columnKey:"{key}",text:"{text}",type:"numeric"})}});var o=f._oIncludeFilterPanel;var O=o._getFormatedConditionText;o._getFormatedConditionText=function(s,v,V,E,k){var j=O.apply(o,arguments);if(j!==""){return j;}var l="";if(v!==""&&v!==undefined){var K=null;if(this._aKeyFields&&this._aKeyFields.length>1){for(var i=0;i<this._aKeyFields.length;i++){var n=this._aKeyFields[i];if(typeof n!=="string"){if(n.key===k&&n.text){K=n.text;break;}}}}l=s+" "+v;if(K&&l!==""){l=K+": "+l;}}return l;};o._fillOperationListItems=function(i,j,t){if(t==="_STRING_"){t="";}if(t==="_TIME_"){t="_DATE_";}if(t==="_BOOLEAN_"){t="";}i.destroyItems();for(var k in j){var s=j[k],T;if(s.indexOf("ZEN")===0){T=h.getRuntimeText("CONDITIONPANEL_OPTION"+t+j[k]);}else{T=o._oRb.getText("CONDITIONPANEL_OPTION"+t+j[k]);if(q.sap.startsWith(T,"CONDITIONPANEL_OPTION")){T=o._oRb.getText("CONDITIONPANEL_OPTION"+j[k]);}}i.addItem(new sap.ui.core.ListItem({key:j[k],text:T,tooltip:T}));}};f.setIncludeOperations([sap.m.P13nConditionOperation.EQ,"ZENNEQ",sap.m.P13nConditionOperation.BT,sap.m.P13nConditionOperation.LT,sap.m.P13nConditionOperation.LE,sap.m.P13nConditionOperation.GT,sap.m.P13nConditionOperation.GE,"ZENTopN","ZENTopPercent","ZENTopSum","ZENBottomN","ZENBottomPercent","ZENBottomSum"],"numeric");f.setConditions(m.getProperty("/condition/thresholds"));return new sap.ui.layout.form.SimpleForm({editable:true,title:h.getRuntimeText("CONDITIONSDLG_RULES"),content:[f]});}function d(f){return new sap.m.Button({text:h.getRuntimeText("CONDITIONSDLG_ADDITIONAL_RemoveAllRules"),icon:"sap-icon://undo",press:function(){f.setConditions([]);}});}function e(){var f=new sap.ui.layout.form.SimpleForm({editable:true,title:h.getRuntimeText("CONDITIONSDLG_ADDITIONAL_SETTINGS")});f.addContent(new sap.m.Label({text:h.getRuntimeText("CONDITIONPANEL_OPTION_ZENTypeOfDimensionEvaluation")}));f.addContent(new sap.m.Select({selectedKey:"{/condition/dimensionEvaluationType}",items:[new sap.ui.core.Item({key:"mostDetailedOnRows",text:h.getRuntimeText("CONDITIONPANEL_OPTION_ZENDetailsOnRows")}),new sap.ui.core.Item({key:"mostDetailedOnCols",text:h.getRuntimeText("CONDITIONPANEL_OPTION_ZENDetailsOnColumns")}),new sap.ui.core.Item({key:"allInDrilldown",text:h.getRuntimeText("CONDITIONPANEL_OPTION_ZENIndependent")})]}));f.addContent(new sap.m.Label({text:h.getRuntimeText("CONDITIONPANEL_OPTION_ZENEvaluateRulesWith")}));f.addContent(new sap.m.RadioButtonGroup({selectedIndex:0,buttons:[new sap.m.RadioButton({text:h.getRuntimeText("CONDITIONPANEL_OPTION_ZENOr")}),new sap.m.RadioButton({text:h.getRuntimeText("CONDITIONPANEL_OPTION_ZENAnd")})]}));return f;}this.update=function(o,f,i){if(o&&f){c(f);var D=o.ZEN_ConditionsDialog;if(D){D.getModel().setProperty("/",f);if(!D.isOpen()){D.open();}}else{this.create(o,f,i);}}};this.getType=function(){return"conditions_dialog";};};var a=new C();B.dispatcher.addHandlers(a.getType(),a);return a;});
