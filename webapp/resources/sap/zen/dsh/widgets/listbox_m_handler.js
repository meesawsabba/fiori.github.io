/*
 * SAPUI5
  (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["jquery.sap.global","sap/zen/commons/thirdparty/lodash","sap/zen/dsh/utils/BaseHandler","sap/m/List","sap/m/StandardListItem"],function(jQuery,_,BaseHandler,List,StandardListItem){"use strict";StandardListItem.extend("sap.zen.StandardListItemWithKey",{metadata:{properties:{key:"string"}},renderer:{}});List.extend("sap.zen.MListWithHeight",{metadata:{properties:{height:"sap.ui.core.CSSSize"}},renderer:{},onAfterRendering:function(e){if(List.prototype.onAfterRendering){List.prototype.onAfterRendering.apply(this,[e]);}var h=this.getHeight();var j=this.$();if(h!=="auto"){j.height(h);}this.$().addClass("zenScrollableMListbox");}});var ListBoxHandler=function(){BaseHandler.apply(this,arguments);var dispatcher=BaseHandler.dispatcher;var that=this;this.create=function(oChainedControl,oControlProperties){var id=oControlProperties["id"];var oControl=new sap.m.ScrollContainer(id);var oListBox=new sap.m.List(id+"_LB");oListBox.addStyleClass("zenListBox-FontSize");oListBox.setIncludeItemInSelection(true);oControl.setVertical(true);oControl.setHorizontal(false);oControl.addContent(oListBox);init(oControl,oControlProperties);oListBox.attachSelect(function(oControlEvent){var keys="";var indices=oControlEvent.oSource.getSelectedItems();for(var j=0;j<indices.length;j++){var item=indices[j];keys+=item.getKey();keys+="|SeP|";}var command=that.prepareCommand(oControlProperties.command,"__KEYS__",keys);eval(command);});return oControl;};this.update=function(l,c){if(c){init(l,c);}return l;};function itemsAreChanged(c,C){var s=C.selectedItems;var S=[],i;if(s){for(i=0;i<s.length;i++){S.push(dispatcher.getValue(s[i],"key"));}}var g=c.getSelectedItems();if(g){if(g.length!==S.length){return true;}var a=0;for(i=0;i<g.length;i++){if(jQuery.inArray(g[i].getKey(),S)!==-1){a++;}}if(a!=S.length){return true;}}var m=getUI5ModeForDSMode(C.selectionMode);if(c.getMode()!==m){return true;}var b=C.items;var A=c.getItems();if(A.length!==b.length){return true;}for(i=0;i<b.length;i++){var d=b[i];var n=d.item.key;var e=d.item.val_0;if(e.length===0){e=n;}var o=A[i].getKey();var f=A[i].getTitle();if(n!==o||e!==f){return true;}}return false;}function getUI5ModeForDSMode(d){if(d==="SINGLE_LEFT"){return sap.m.ListMode.SingleSelectLeft;}else if(d==="SINGLE_MASTER"){return sap.m.ListMode.SingleSelectMaster;}else if(d==="MULTI"){return sap.m.ListMode.MultiSelect;}return sap.m.ListMode.SingleSelect;}function init(c,C){var l=c.getContent()[0];if(!itemsAreChanged(l,C)){return;}l.removeAllItems();if(!l.previousItems){l.previousItems=[];}var m=getUI5ModeForDSMode(C.selectionMode);l.setMode(m);var s=C.selectedItems;var i,k;if(s){var a={};for(i=0;i<s.length;i++){k=dispatcher.getValue(s[i],"key");a[k]=true;}}var b=C.items;for(i=0;i<b.length;i++){var d=b[i];k=d.item.key;var t=d.item.val_0;var I=new sap.zen.StandardListItemWithKey(i);I.setKey(k);if(t.length===0){t=k;}I.setTitle(t);l.addItem(I);if(a&&a[k]){l.setSelectedItem(I);}}}this.getType=function(){return"listbox";};this.getDecorator=function(){return"DataSourceControlDecorator";};};var instance=new ListBoxHandler();BaseHandler.dispatcher.addHandlers(instance.getType(),instance);return instance;});
