/*
 * SAPUI5
  (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["jquery.sap.global","sap/base/Log"],function(q,L){"use strict";L.info("Create com.sap.ip.bi.SelectionTable");sap.designstudio.sdk.Component.subclass("com.sap.ip.bi.SelectionTable",function(){var C="sapzencrosstab-TableDiv";var a="sapzencrosstab-Crosstab";var b="sapzencrosstab-HeaderRow sapzencrosstab-DimensionHeaderArea";var c="sapzencrosstab-HeaderCellDefault";var d="sapzencrosstab-HeaderCellDefault sapzencrosstab-HeaderCellTotal";var f="sapzencrosstab-DataCellDefault";var g="sapzencrosstab-DataCellDefault sapzencrosstab-DataCellAlternating";var h="sapzencrosstab-DataCellDefault sapzencrosstab-DataCellTotal";var k="sapzencrosstab-DataCellDefault sapzencrosstab-DataCellTotal sapzencrosstab-DataCellAlternating";var l="sapzencrosstab-CollapseNode";var m="sapzencrosstab-ExpandNode";var n="sapzencrosstab-HeaderCellDivHierarchy";var o="sapzencrosstab-DataCellSelectData";var p="sapzencrosstab-HoverDataCell";var r="sapzencrosstab-HeaderCellDefault";var D="data-dim-";var t=this;var s=null;var u=undefined;var _=2;var w=0;var z=0;var A=0;var B=0;var E=0;var F=0;var G=[];var H=[];var I=[];var J=[];var K=[];this.init=function(){this.$().addClass(C);this.$().css("overflow-x","scroll");this.$().css("overflow-y","scroll");};this.afterUpdate=function(){if(this.jqTable==null&&s&&s.formattedData&&s.formattedData.length>0){M();G=N(w,z);H=N(w,z);I=N(w,z);J=N(w,z);K=N(w,z);O();S();V();Y();b1();}};function M(){var e=s.axis_columns;E=e.length;var j=s.axis_rows;F=j.length;A=0;var v=e[0];for(var i=0;i<v.length;i++){if(v[i]>-1){A++;}}B=v.length-A;w=B+E;z=A+F;}function N(x,y){var e=new Array(x);for(var i=0;i<x;i++){e[i]=new Array(y);}return e;}function O(){P(0,0,B,A);G[0][0]=B;H[0][0]=A;I[0][0]="";J[0][0]="topleft";}function P(e,v,x,y){for(var i=v;i<v+y;i++){for(var j=e;j<e+x;j++){G[j][i]=-1;H[j][i]=-1;}}}function Q(e,i){var j=G[e][i];if(j===-1){return true;}var v=H[e][i];if(v===-1){return true;}return false;}function R(e){var j="";var v=e.level;if(v){for(var i=0;i<v;i++){j+="&nbsp;&nbsp;";}var x="";var y=e.nodeState;if(y){x=(y==="EXPANDED")?l:m;}j+="<span style=\"display: inline-block; vertical-align: middle\" class=\""+n+" "+x+"\"></span>";j+="&nbsp;"+e.text;}else{j=e.text;}return j;}function S(){var e=B;for(var i=0;i<A;i++){for(var j=0;j<E;j++){if(!Q(e+j,i)){var v=T(j,i);var x=U(j,i);P(e+j,i,v,x);var y=s.axis_columns[j][i];var k1=s.dimensions[i].members[y];var l1=R(k1);var m1=k1.type;G[e+j][i]=v;H[e+j][i]=x;I[e+j][i]=l1;J[e+j][i]=(m1==="RESULT")?"header-bold":"header";K[e+j][i]=D+i+"="+y;j+=v-1;}}}}function T(e,v){var x=1;var y=s.axis_columns[e][v];for(var i=e+1;i<s.axis_columns.length;i++){var k1=s.axis_columns[i][v];if(y===k1){for(var j=0;j<v;j++){var l1=s.axis_columns[e][j];var m1=s.axis_columns[i][j];if(l1!==m1){return x;}}x++;}else{break;}}return x;}function U(e,j){var v=1;var x=s.dimensions[j].members[s.axis_columns[e][j]];if(x.type==="RESULT"){for(var i=j+1;i<A;i++){var y=s.dimensions[i].members[s.axis_columns[e][i]];if(y.type==="RESULT"){v++;}else{break;}}}return v;}function V(){var e=A;var i=A;for(var j=0;j<B;j++){for(var v=0;v<F;v++){if(!Q(j,i+v)){var x=X(j,v);var y=W(j,v);P(j,i+v,x,y);var k1=e+j;var l1=s.axis_rows[v][k1];var m1=s.dimensions[k1].members[l1];var n1=R(m1);var o1=m1.type;G[j][i+v]=x;H[j][i+v]=y;I[j][i+v]=n1;J[j][i+v]=(o1==="RESULT")?"header-bold":"header";K[j][i+v]=D+k1+"="+l1;v+=y-1;}}}}function W(e,v){var x=A;var y=1;var k1=s.axis_rows[v][x+e];for(var i=v+1;i<s.axis_rows.length;i++){var l1=s.axis_rows[i][x+e];if(k1===l1){for(var j=0;j<e;j++){var m1=s.axis_rows[v][x+j];var n1=s.axis_rows[i][x+j];if(m1!==n1){return y;}}y++;}else{break;}}return y;}function X(e,j){var v=A;var x=1;var y=s.dimensions[v+e].members[s.axis_rows[j][v+e]];if(y.type==="RESULT"){for(var i=e+1;i<B;i++){var k1=s.dimensions[v+i].members[s.axis_rows[j][v+i]];if(k1.type==="RESULT"){x++;}else{break;}}}return x;}function Y(){var e=B;var i=A;var j=0;for(var v=0;v<F;v++){for(var x=0;x<E;x++){G[e+x][i+v]=1;H[e+x][i+v]=1;I[e+x][i+v]=s.formattedData[j];J[e+x][i+v]=$(x,v);K[e+x][i+v]=Z(s.tuples[j]);j++;}}}function Z(e){var j="";for(var i=0;i<e.length;i++){j+=D+i+"="+e[i]+" ";}return j;}function $(e,i){if(a1(e,i)){return(i%2==0)?"data-bold-even":"data-bold-odd";}return(i%2==0)?"data-even":"data-odd";}function a1(e,j){var v=s.axis_columns[e],i;for(i=0;i<A;i++){var x=s.dimensions[i].members[v[i]];if(x.type==="RESULT"){return true;}}var y=A;var k1=s.axis_rows[j];for(i=0;i<B;i++){var l1=s.dimensions[y+i].members[k1[y+i]];if(l1.type==="RESULT"){return true;}}return false;}function b1(){t.$().empty();var e="<table class=\""+a+"\">";for(var i=0;i<z;i++){e+="<tr class=\""+b+"\">";for(var j=0;j<w;j++){if(!Q(j,i)){var v="";var x=J[j][i];switch(x){case"topleft":case"header":v=c;break;case"header-bold":v=d;break;case"data-odd":v=g;break;case"data-bold-odd":v=k;break;case"data-even":v=f;break;case"data-bold-even":v=h;break;}var y=G[j][i];var k1=H[j][i];var l1=I[j][i];var m1=K[j][i];m1=(!m1)?"":" "+m1;if(y>1){m1+=" colspan="+y;}if(k1>1){m1+=" rowspan="+k1;}m1+=" class='"+v+"'";e+="<td"+m1+">"+l1+"</td>";j+=y-1;}}e+="</tr>";}e+="</table>";t.jqTable=q(e);t.jqTable.click(c1);t.$().append(t.jqTable);g1();}function c1(e){var i=q(e.target).hasClass(f);if(!i&&_===0)return;d1(i);q.each(e.target.attributes,function(j,v){if(v.name.indexOf(D)===0){var x=parseInt(v.name.substring(D.length),10);var y=parseInt(v.value);var k1=u[x];u[x]=e1(k1,y);}});t.firePropertiesChangedAndEvent(["visSelection","currrentSelectionShape"],"onSelect");}function d1(e){if(!u||e){u=s.dimensions.map(function(){return[];});}return u;}function e1(e,j){var x=[];var y=false;for(var i=0;i<e.length;i++){var v=e[i];if(v<j){x.push(v);}else if(v===j){y=true;}else{if(!y){x.push(j);y=true;}x.push(v);}}if(!y){x.push(j);}return x;}function f1(e){var j=1;for(var i=0;i<e.length;i++){var v=e[i];v=v+j;if(v<u[i].length){e[i]=v;return true;}else{e[i]=0;j=1;}}return j==0;}function g1(){if(t.jqTable){q("."+o,t.jqTable).removeClass(o);q("."+p,t.jqTable).removeClass(p);var i=d1().map(function(){return 0;});do{var e="";q.each(u,function(v,x){var y=x[i[v]];if(y!==undefined){var k1="[data-dim-"+v+"=\""+y+"\"]";e+=k1;q("."+r+k1,t.jqTable).addClass(p);}});var j=q(e,t.jqTable);j.addClass(o);}while(f1(i));}}this.data=function(v){if(v===undefined){return s;}else{s=v;this.jqTable=null;return this;}};this.visSelection=function(v){if(v===undefined){var j={};q.each(d1(false),function(n1,v){var o1=s.dimensions[n1];var y=o1.key;if(o1.containsMeasures){y="(MEASURES_DIMENSION)";}if(v.length===1){j[y]=h1(o1,v[0]);}else if(v.length>1){j[y]=v.map(function(i){return h1(o1,i);});}});return JSON.stringify(j);}else{if(v!==""&&s){d1(true);try{var x=JSON.parse(v);for(var y in x){if(Object.prototype.hasOwnProperty.call(x,y)){var k1=i1(y);var l1=x[y];if(Array.isArray(l1)){u[k1]=l1.map(function(i){return j1(k1,i);});}else{var m1=j1(k1,l1);u[k1]=[m1];}}}g1();}catch(e){}}return this;}};function h1(e,v){var i=e.members[v];var j=i.key;if(i.type==="RESULT"){j="(RESULT_MEMBER)";}return j;}function i1(e){var j=s.dimensions;for(var i=0;i<j.length;i++){if(e==="(MEASURES_DIMENSION)"&&j[i].containsMeasures){return i;}var v=j[i].key;if(e===v){return i;}}throw"Dimension "+e+" not found";}function j1(e,j){var v=s.dimensions[e].members;for(var i=0;i<v.length;i++){if(j==="(RESULT_MEMBER)"&&v[i].type==="RESULT"){return i;}var x=v[i].key;if(j===x){return i;}}throw"Member "+j+" not found";}this.currrentSelectionShape=function(v){if(v!==undefined)return this;var e=false;var j=false;for(var i=0;i<s.dimensions.length;i++){var x=s.dimensions[i];if(d1(false)[i].length===0){if(x.axis==="ROWS")j=true;else e=true;}}if(e&&j)return 2;if(e||j)return 1;return 0;};this.selectionShape=function(v){if(v===undefined){return _;}_=v;return this;};});});
