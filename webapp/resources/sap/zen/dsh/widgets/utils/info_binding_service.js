/*
 * SAPUI5
  (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["jquery.sap.global","sap/zen/commons/thirdparty/lodash","sap/zen/dsh/utils/BaseHandler","sap/zen/dsh/widgets/utils/info_chart_exception"],function(q,_,B,I){"use strict";function c(h,m){return _.map(h,function(i){return{"feed":i.id,"source":_.map(i.values,function(j){if(j.type==="MND"){return{"measureNames":m};}else{return j.id;}})};});}function g(h,i,m){var t={"Dimension":"String","Measure":"Number"};return _.map(i,function(j){var k=_.find(h,{feed:j.id});var l=[];if(k&&k.source){l=_.map(k.source,function(s){if(_.isObject(s)){return{id:"MND",type:"MND",measureNames:m};}else{return{id:s,type:j.type,dataType:k.feed==="timeAxis"?"Date":t[j.type]};}});}return{"id":j.id,"values":l};});}function a(i,h){var j=_.map(i.fields,"id");return _.map(h,function(k){var l=_.filter(k.source,function(m){return _.isObject(m)||_.includes(j,m);});return{feed:k.feed,source:l};});}function b(i,h){var j=_.reduce(h,function(k,l){return _.union(k,l.source);},[]);return _.reduce(i.fields,function(o,k){if(!_.includes(j,k.id)){o.push(_.pick(k,"id","type","dataType"));}return o;},[]);}function v(h,i){var F=sap.viz.moduleloader.require.config({context:"lw-vizservices"})("sap/viz/vizservices/service/feed/FeedService");var V=F.validate(h,i);if(!V.valid){var E={"chartType":h,"feeds":i,"validationResult":V};var m=p(V,"results.bindings.valueAxis.missing")||p(V,"results.bindings.valueAxis2.missing");var j=p(V,"results.bindings.categoryAxis.missing");if(m&&j){throw new I("bindings.missing.measuresAndDimensions",E);}else if(m){throw new I("bindings.missing.measures",E);}else if(j){throw new I("bindings.missing.dimensions",E);}else{throw new I("bindings.error",E);}}}function p(o,h){return _.reduce(h.split("."),function(i,j){return i&&i[j];},o);}function d(h){return sap.viz.api.metadata.Viz.get(h).bindings;}function e(h){return _.map(_.filter(h,{type:"Measure"}),"id");}function f(m,h){var t=_.find(h,function(k){return k.feed==="timeAxis";});if(t&&_.isArray(t.source)&&t.source[0]){var i=t.source[0];var j=_.find(m.fields,function(k){return k.id===i;});j.dataType="Date";}return m;}return{suggestBindings:function(h,i,o,j){var k;var m;var l=Boolean(j&&j!==h);var n;k=d(h);m=_.map(_.filter(k,{type:"Measure"}),"id");var s;if(l){var r=d(j);var t=e(r);var u=g(o,r,t);var w=sap.viz.vizservices.BVRService.switchFeeds(j,u,h).feedItems;s=c(w,m);}var x=a(i,s||o);m=e(k);var y=g(x,k,m);i=f(i,x);var z=b(i,x);n=sap.viz.vizservices.BVRService.suggestFeeds(h,y,z).feedItems;return c(n,m);},validateBindings:function(h,i){var j=d(h);var m=e(j);v(h,g(i,j,m));}};});
