/*
 * SAPUI5
  (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["jquery.sap.global","sap/zen/commons/thirdparty/lodash","sap/zen/dsh/utils/BaseHandler","sap/ui/core/Popup","sap/m/Panel","sap/m/BackgroundDesign"],function(jQuery,_,BaseHandler){"use strict";var PopupmHandler=function(){var me=this;BaseHandler.apply(me,arguments);var dispatcher=BaseHandler.dispatcher;function init(p,c){var C=c.content;var a=p.getContent()[0];if(C){me.updateChildren(C,p,function(n,i){dispatcher.insertIntoAbsoluteLayoutContainer(a,n,i);},function(o){a.removeContent(o);});}}this.applyForChildren=function(p,f){var a=p.getContent()[0];var c=a.getContent();for(var i=0;i<c.length;i++){var C=c[i];if(C){f(C);}}};me.getDecorator=function(){return"PopupDecorator";};me.getType=function(){return"popupm";};me.createAndAdd=function(c,C,o,a,i){var p=new sap.m.Panel({content:[this.createAbsoluteLayout()]}).addStyleClass("zenmpopup");p.custProp={};setCommand(p,"CLOSE",C.command);setOriginalPositions(p,o);a(p,i);BaseHandler.dispatcher.updateComponentProperties(p,o);init(p,C);me.updatePanelBg(p,C);if(sap.zen.designmode)p.addStyleClass("zenborder");else{p.addEventDelegate({onAfterRendering:function(e){e.srcControl.removeEventDelegate(this);p.setVisible(false);jQuery(p.getParent().getDomRef()).addClass("zenmpopuphidden");}});}return p;};me.update=function(c,C,o){C=C||{};init(c,C);me.updatePanelBg(c,C);var p=c.custProp.popup;if(!sap.zen.designmode){if(C.show===false)me.hide(c,C);else if(C.show===true||(p&&p.isOpen()))me.show(c,C,o);}return c;};me.updatePanelBg=function(p,c){if(p&&c.backgroundDesign){if(c.backgroundDesign==="TRANSPARENT"){p.setBackgroundDesign(sap.m.BackgroundDesign.Transparent);}else if(c.backgroundDesign==="SOLID"){p.setBackgroundDesign(sap.m.BackgroundDesign.Solid);}else if(c.backgroundDesign==="TRANSLUCENT"){p.setBackgroundDesign(sap.m.BackgroundDesign.Translucent);}}};me.show=function(c,C,o){var p=c.custProp.popup;var u=true;if(!p){u=false;p=me.createPopup(c,C);if(C.openCentered){me.repositionPopup(p);p.zenOpenCentered=true;}p.getContent().toggleStyleClass("autoHeight",isAuto(o.height));p.getContent().toggleStyleClass("autoWidth",isAuto(o.width));p.open();}if(!C.openCentered&&!p.zenOpenCentered){var a=getOriginalPositions(c,o);var b="px";var d=isAuto(a.topmargin)?a.topmargin:a.topmargin+b;var e=isAuto(a.rightmargin)?a.rightmargin:a.rightmargin+b;var f=isAuto(a.bottommargin)?a.bottommargin:a.bottommargin+b;var g=isAuto(a.leftmargin)?a.leftmargin:a.leftmargin+b;var h=isAuto(o.height)?o.height:o.height+b;var i=isAuto(o.width)?o.width:o.width+b;i=dispatcher.calcWidthUseOrderOfPriority(g,e,i);h=dispatcher.calcWidthUseOrderOfPriority(d,f,h);if(c.getDomRef()){var j={};if(d)j.top=d;if(e)j.right=e;if(f)j.bottom=f;if(g)j.left=g;if(h)j.height=h;if(i)j.width=i;p.getContent().toggleStyleClass("autoHeight",isAuto(o.height));p.getContent().toggleStyleClass("autoWidth",isAuto(o.width));jQuery(c.getDomRef()).css(j);}}else{if(u)setTimeout(function(){me.repositionPopup(p);},10);}};me.popupOpened=function(e){var p=e.oSource.getContent();jQuery(p.getDomRef()).attr("tabindex",0);if(e.oSource.getAutoClose())jQuery(p.getDomRef()).focus();};me.resizeHandler=function(){var a=getOpenCenterPopups();for(var p in a){me.repositionPopup(a[p]);}};me.repositionPopup=function(p){if(p)p.setPosition("center center","center center",window,"0 0","fit");};me.hide=function(c){var p=c.custProp.popup;if(p&&p.isOpen())p.close();};me.createPopup=function(c,C){if(C.modal)C.autoclose=false;c.setVisible(true);var p=new sap.ui.core.Popup(c,!!C.modal,true,!!C.autoclose);p.attachClosed(function(){me.handlePopupClosed(c);});p.attachOpened(me.popupOpened);if(C.openCentered)addOpenCenterPopup(p);c.custProp.popup=p;return p;};me.handlePopupClosed=function(oControl){var commandStr=getCommand(oControl,"CLOSE");if(commandStr){var command=me.prepareCommand(commandStr,"__VALUE__","false");eval(command);}var popup=oControl.custProp.popup;if(popup){removeOpenCenterPopup(popup);popup.destroy();oControl.custProp.popup=null;}};function isAuto(p){return p===undefined||p==="auto";}function setOriginalPositions(c,C){if(c.custProp){if(!c.custProp.positions)c.custProp.positions={};c.custProp.positions.topmargin=C.topmargin;c.custProp.positions.leftmargin=C.leftmargin;c.custProp.positions.rightmargin=C.rightmargin;c.custProp.positions.bottommargin=C.bottommargin;}}function getOriginalPositions(C,o){var c;if(C.custProp&&C.custProp.positions)c=C.custProp.positions;if(c){if(o.leftmargin)c.leftmargin=o.leftmargin;if(o.topmargin)c.topmargin=o.topmargin;if(o.rightmargin)c.rightmargin=o.rightmargin;if(o.bottommargin)c.bottommargin=o.bottommargin;}return c;}function getCommand(C,t){var c;if(C.custProp&&C.custProp.commands)c=C.custProp.commands[t];return c;}function setCommand(c,t,a){if(c.custProp){if(!c.custProp.commands)c.custProp.commands={};c.custProp.commands[t]=a;}}function removeOpenCenterPopup(p){if(me.openCenterPopups&&me.openCenterPopups[p.getId()]){delete me.openCenterPopups[p.getId()];me.openCenterPopupsCount--;if(me.openCenterPopupsCount===0){jQuery(window).off("resize",me.resizeHandler);}}}function addOpenCenterPopup(p){if(!me.openCenterPopups){me.openCenterPopups={};me.openCenterPopupsCount=0;}me.openCenterPopups[p.getId()]=p;if(me.openCenterPopupsCount===0)jQuery(window).on("resize",me.resizeHandler);me.openCenterPopupsCount++;}function getOpenCenterPopups(){return me.openCenterPopups;}};var handler=new PopupmHandler();return handler;});
