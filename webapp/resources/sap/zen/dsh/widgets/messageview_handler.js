/*
 * SAPUI5
  (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["jquery.sap.global","sap/zen/dsh/utils/BaseHandler","sap/ui/model/json/JSONModel"],function(q,B,J){"use strict";sap.zen.MessageViewHandler=function(){B.apply(this,arguments);this.getType=function(){return"messageview";};var d=null,j=null;var r={hDist:15,vDist1:15,vDist2:80,oMainLayout:undefined,oPopup:undefined,iInitialLayoutHeight:0,bDynamicHeight:undefined};var t={},h=null,b={},c="180px",f="60px",p={top:"auto",bottom:"auto",left:"auto",right:"auto"};this.create=function(C,o,e){var i=o["id"],n;o=o||{};if(o.texts){t=o.texts;}if(o.log_command){sap.zen.MessageViewHandler.JSMessageHandler.sLogCommand=o.log_command;}if(o.application_properties){b=o.application_properties;sap.zen.MessageViewHandler.JSMessageHandler.sMessageTypes=o.application_properties.message_types;}else{n=new sap.ui.commons.Button(i,{"width":"150px","height":"50px"});n.setVisible(false);sap.zen.MessageViewHandler.JSMessageHandler.oNotificationButton=n;sap.zen.MessageViewHandler.JSMessageHandler.createSavedMessages();return n;}n=this.buildUI(i,e);if(o.messages){g(o);j.setData(d.getData());}else if(sap.zen.MessageViewHandler.JSMessageHandler.oOldDataModel&&!sap.zen.MessageViewHandler.bIsVariableScreen){d.setData(sap.zen.MessageViewHandler.JSMessageHandler.oOldDataModel);j.setData(d.getData());sap.zen.MessageViewHandler.JSMessageHandler.oOldDataModel=null;}else{n.setVisible(false);}sap.zen.MessageViewHandler.JSMessageHandler.oNotificationButton=n;sap.zen.MessageViewHandler.JSMessageHandler.createSavedMessages();var R=n;if(!sap.zen.MessageViewHandler.bIsVariableScreen){var A=this.createAbsoluteLayout(i+"_abs");A.setHorizontalScrolling(sap.ui.core.Scrolling.None);A.setVerticalScrolling(sap.ui.core.Scrolling.None);A.insertContent(n,0);if(!A.fSaveOnAfterRendering){A.fSaveOnAfterRendering=A.onAfterRendering;A.onAfterRendering=function(){if(A.fSaveOnAfterRendering){A.fSaveOnAfterRendering();}if(!sap.zen.MessageViewHandler.bIsVariableScreen){var k=q("#sap-ui-blocklayer-popup");var l=q(window.document.getElementById(this.getId()));if(k&&k.length>0&&k.css("visibility")==="visible"&&k.outerWidth()>0&&k.outerHeight()>0){var z=k.css("z-index");if(z&&z.length>0){var Z=parseInt(z,10);l.css("z-index",""+(Z+1));}}else{l.css("z-index","auto");}}};}R=A;}return R;};this.update=function(C,o,e){if(o&&o.messages&&o.messages.length>0&&d){g(o);j.setData(d.getData());var i;if(C.getContent){i=C.getContent()[0];}else{i=C;}i.setVisible(true);i.removeStyleClass("zenDialogMsgButton");}if(e){this.setMessagePosition(e);}return C;};this.buildUI=function(i,C){d=new sap.zen.MessageViewHandler.DataModel();sap.zen.MessageViewHandler.JSMessageHandler.oDataModel=d;sap.zen.MessageViewHandler.JSMessageHandler.oRenderData=r;var D=d.getData();j=new J();sap.zen.MessageViewHandler.JSMessageHandler.oJsonModel=j;j.setData(D);sap.ui.getCore().setModel(j);var m=new sap.ui.commons.layout.BorderLayout();sap.zen.MessageViewHandler.JSMessageHandler.oRenderData.oMainLayout=m;m.addStyleClass("sapzenmessageview-PopupContainer");var R=new sap.ui.commons.RowRepeater("",{design:"BareShell",numberOfRows:15,currentPage:1});R.bindAggregation("rows",{path:"/data",factory:function(I,l){var s=new sap.ui.commons.layout.BorderLayout();s.addStyleClass("sapzenmessageview-RowRepeaterRow");s.setWidth("320px");s.setHeight("60px");var E=function(e){var s;var u;if(e.oSource){s=e.oSource.oParent.oParent;u=this;}else{s=sap.ui.getCore().byId(q(e.target.parentElement.parentElement.parentElement.parentElement).attr("id"));u=s.getBegin().getContent()[0];}var z=s.getBottom();if(z.getVisible()){s.setHeight(f);z.setVisible(false);u.removeStyleClass("sapzenmessageview-ExpandImageActive");s.removeStyleClass("sapzenmessageview-RowRepeaterRowActive");}else{s.setHeight(c);z.setVisible(true);u.addStyleClass("sapzenmessageview-ExpandImageActive");s.addStyleClass("sapzenmessageview-RowRepeaterRowActive");}};var u=new sap.ui.commons.Image();u.addStyleClass("sapzenmessageview-ExpandImage");u.setSrc(sap.zen.createStaticMimeUrl("zen.rt.components/resources/img/transparent.png"));u.setAlt(t.expand);u.attachPress(E);s.addContent(sap.ui.commons.layout.BorderLayoutAreaTypes.begin,u);s.setAreaData(sap.ui.commons.layout.BorderLayoutAreaTypes.begin,{size:"36px",visible:true});var v=new sap.ui.commons.layout.HorizontalLayout();var L=new sap.ui.commons.Image();var w="sapzenmessageview-LevelImageInfo";var M=j.getProperty(l+"/message/level");if(M==="ERROR"){w="sapzenmessageview-LevelImageError";}else if(M==="WARNING"){w="sapzenmessageview-LevelImageWarning";}L.setSrc(sap.zen.createStaticMimeUrl("zen.rt.components/resources/img/transparent.png"));L.addStyleClass(w);v.addContent(L);var T=new sap.ui.commons.TextView();T.setDesign(sap.ui.commons.TextViewDesign.H2);T.addStyleClass("sapzenmessageview-HeaderText");T.bindProperty("text",l+"/message/short_text");T.setWrapping(false);v.addContent(T);v.attachBrowserEvent("click",E);s.addContent(sap.ui.commons.layout.BorderLayoutAreaTypes.center,v);s.setAreaData(sap.ui.commons.layout.BorderLayoutAreaTypes.center,{visible:true});var x=new sap.ui.commons.Image();x.setSrc(sap.zen.createStaticMimeUrl("zen.rt.components/resources/img/transparent.png"));x.addStyleClass("sapzenmessageview-RemoveImage");x.setAlt(t.remove);x.attachPress(function(e){d.remove(e.oSource.getBindingContext().sPath);j.setData(d.getData());});s.addContent(sap.ui.commons.layout.BorderLayoutAreaTypes.end,x);s.setAreaData(sap.ui.commons.layout.BorderLayoutAreaTypes.end,{size:"39px",visible:true});var y=new sap.ui.commons.TextView();y.bindProperty("text",l+"/message/long_text");s.addContent(sap.ui.commons.layout.BorderLayoutAreaTypes.bottom,y);s.setAreaData(sap.ui.commons.layout.BorderLayoutAreaTypes.bottom,{size:"120px",contentAlign:"left",visible:false});return s;}});var n=new sap.ui.commons.TextView("",{text:t.no_notifications});n.setDesign(sap.ui.commons.TextViewDesign.H1);n.addStyleClass("sapzenmessageview-NoNotifications");R.setNoData(n);m.addContent(sap.ui.commons.layout.BorderLayoutAreaTypes.center,R);var H=new sap.ui.commons.layout.BorderLayout();H.addStyleClass("sapzenmessageview-PopupContainerHeader");h=new sap.ui.commons.TextView();h.bindProperty("text","/length",function(l){return l+" "+(l===1?t.notification_header_singular:t.notification_header);});h.setDesign(sap.ui.commons.TextViewDesign.H1);H.addContent(sap.ui.commons.layout.BorderLayoutAreaTypes.center,h);var o=new sap.ui.commons.Button();o.setText(t.clear_all);o.attachPress(function(){d.removeAll();j.setData(d.getData());P.close(100);});H.addContent(sap.ui.commons.layout.BorderLayoutAreaTypes.end,o);H.setAreaData(sap.ui.commons.layout.BorderLayoutAreaTypes.begin,{size:"75px",visible:true});H.setAreaData(sap.ui.commons.layout.BorderLayoutAreaTypes.center,{visible:true});H.setAreaData(sap.ui.commons.layout.BorderLayoutAreaTypes.end,{size:"75px",visible:true});m.addContent(sap.ui.commons.layout.BorderLayoutAreaTypes.top,H);m.setAreaData(sap.ui.commons.layout.BorderLayoutAreaTypes.top,{visible:true});m.attachBrowserEvent("mousedown",function(){q.sap.delayedCall(0,this,function(){o.focus();});});var N=new sap.ui.commons.Button(i,{text:"{/length}",icon:sap.zen.createStaticMimeUrl("zen.rt.components/resources/img/transparent.png")});if(!sap.zen.MessageViewHandler.bIsVariableScreen){N.setWidth(sap.zen.MessageViewHandler.width+"px");N.setHeight(sap.zen.MessageViewHandler.height+"px");}d.addMaxLevelChangeListener(function(e){N.removeStyleClass("sapzenmessageview-ButtonLevelImageInfo");N.removeStyleClass("sapzenmessageview-ButtonLevelImageWarning");N.removeStyleClass("sapzenmessageview-ButtonLevelImageError");var s;if(e==="INFO"){s="sapzenmessageview-ButtonLevelImageInfo";}else if(e==="WARNING"){s="sapzenmessageview-ButtonLevelImageWarning";}else{s="sapzenmessageview-ButtonLevelImageError";}N.addStyleClass(s);});this.setMessagePosition(C);var P=new sap.ui.core.Popup(m,false,true,false);r.oPopup=P;var k=this;N.attachPress(function(){if(P.isOpen()){P.close(100);}else{k.openMessagePopup(P);}});if(sap.zen.dsh.sapbi_isMobile){m.attachBrowserEvent("touchstart",function(){var l=q(this.$().children()[1]);if(l.scrollTop()===0){l.scrollTop(1);}});m.attachBrowserEvent("touchmove",function(e){var l=q(this.$().children()[1]);var s=(R.$().height()-l.outerHeight())-1;if(s<5||!q(e.target).parents("#"+l.attr("id")).length){return false;}if(l.scrollTop()<1){l.scrollTop(0);}if(l.scrollTop()>=s){l.scrollTop(s);}e.stopPropagation();});}P.attachClosed(function(){if(!j.getProperty("/length")){N.setVisible(false);}});P.setAnimations(function($,e,l){$.css("top",p.top);$.css("bottom",p.bottom);$.css("left",p.left);$.css("right",p.right);l();},function($,e,l){l();});return N;};this.openMessagePopup=function(P){var m,e,o=[];p={top:"auto",bottom:"auto",left:"auto",right:"auto"};if(b.message_popup_position==="LEFT"){if(b.message_position==="BOTTOMLEFT"||b.message_position==="BOTTOMRIGHT"){m=e=sap.ui.core.Popup.Dock.LeftBottom;o[0]=r.hDist;o[1]=b.message_position==="BOTTOMLEFT"?-r.vDist2:-r.vDist1;if(sap.zen.MessageViewHandler.fCalculationCallback){sap.zen.MessageViewHandler.fCalculationCallback(o,b.message_popup_position,b.message_position);}p.left=(o[0]>=0?o[0]:-o[0])+"px";p.bottom=(o[1]>=0?o[1]:-o[1])+"px";}else{m=e=sap.ui.core.Popup.Dock.LeftTop;o[0]=r.hDist;o[1]=b.message_position==="TOPLEFT"?r.vDist2:r.vDist1;if(sap.zen.MessageViewHandler.fCalculationCallback){sap.zen.MessageViewHandler.fCalculationCallback(o,b.message_popup_position,b.message_position);}p.left=(o[0]>=0?o[0]:-o[0])+"px";p.top=(o[1]>=0?o[1]:-o[1])+"px";}}else{if(b.message_position==="BOTTOMLEFT"||b.message_position==="BOTTOMRIGHT"){m=e=sap.ui.core.Popup.Dock.RightBottom;o[0]=-r.hDist;o[1]=b.message_position==="BOTTOMRIGHT"?-r.vDist2:-r.vDist1;if(sap.zen.MessageViewHandler.fCalculationCallback){sap.zen.MessageViewHandler.fCalculationCallback(o,b.message_popup_position,b.message_position);}p.right=(o[0]>=0?o[0]:-o[0])+"px";p.bottom=(o[1]>=0?o[1]:-o[1])+"px";}else{m=e=sap.ui.core.Popup.Dock.RightTop;o[0]=-r.hDist;o[1]=b.message_position==="TOPRIGHT"?r.vDist2:r.vDist1;if(sap.zen.MessageViewHandler.fCalculationCallback){sap.zen.MessageViewHandler.fCalculationCallback(o,b.message_popup_position,b.message_position);}p.right=(o[0]>=0?o[0]:-o[0])+"px";p.top=(o[1]>=0?o[1]:-o[1])+"px";}}P.setPosition(m,e,document,o.join(" "));P.open(100);};this.setMessagePosition=function(C){var i=r.vDist1;var R=r.hDist;if(!sap.zen.MessageViewHandler.bIsVariableScreen){C.width="0";C.height="0";i=i+sap.zen.MessageViewHandler.height;R=R+sap.zen.MessageViewHandler.width;}else{C.width=sap.zen.MessageViewHandler.width;C.height=sap.zen.MessageViewHandler.height;}if(b.message_position==="BOTTOMLEFT"){C.leftmargin=r.hDist;C.bottommargin=i;C.topmargin="auto";C.rightmargin="auto";}else if(b.message_position==="BOTTOMRIGHT"){C.leftmargin="auto";C.bottommargin=i;C.topmargin="auto";C.rightmargin=R;}else if(b.message_position==="TOPLEFT"){C.leftmargin=r.hDist;C.bottommargin="auto";C.topmargin=r.vDist1;C.rightmargin="auto";}else if(b.message_position==="TOPRIGHT"){C.leftmargin="auto";C.bottommargin="auto";C.topmargin=r.vDist1;C.rightmargin=R;}};var g=function(C){var m;for(var i=0;i<C.messages.length;i++){m=C.messages[i];d.add(m);}};};sap.zen.MessageViewHandler.DataModel=function(){this.oDataObject={};this.oDataObject.data=[];this.oDataObject.data.messageNumber=0;this.maxLevelChangelisteners=[];this.add=function(m){this.oDataObject.data.unshift(m);this.oDataObject.length=this.oDataObject.data.length;this.maxLevelNotify();};this.remove=function(b){var l=b.lastIndexOf("/");var i=parseInt(b.substring(l+1));this.oDataObject.data.splice(i,1);this.oDataObject.length=this.oDataObject.data.length;this.maxLevelNotify();};this.removeAll=function(){this.oDataObject.data=[];this.oDataObject.length=0;this.maxLevelNotify();};this.getData=function(){return this.oDataObject;};this.setData=function(d){for(var i=0;i<d.length;i++){this.add(d[i]);}};this.maxLevelNotify=function(){var o=this.oDataObject.maxLevel,i;this.oDataObject.maxLevel="INFO";for(i=0;i<this.oDataObject.data.length&&(this.oDataObject.maxLevel==="INFO"||this.oDataObject.maxLevel==="WARNING");i++){if(this.oDataObject.data[i].message.level==="WARNING"){this.oDataObject.maxLevel="WARNING";}else if(this.oDataObject.data[i].message.level==="ERROR"){this.oDataObject.maxLevel="ERROR";}}if(o!==this.oDataObject.maxLevel){for(i=0;i<this.maxLevelChangelisteners.length;i++){this.maxLevelChangelisteners[i](this.oDataObject.maxLevel);}}};this.addMaxLevelChangeListener=function(l){this.maxLevelChangelisteners.push(l);};};sap.zen.MessageViewHandler.createMessage=function(l,s,L,b){sap.zen.MessageViewHandler.JSMessageHandler.createMessage(l,s,L,b);};sap.zen.MessageViewHandler.clearMessages=function(){sap.zen.MessageViewHandler.JSMessageHandler.clearAllMessages();};sap.zen.MessageViewHandler.logMessage=function(l,s,L){sap.zen.MessageViewHandler.JSMessageHandler.createLogMessage(l,s,L);};sap.zen.MessageViewHandler.setSize=function(s){sap.zen.MessageViewHandler.width=s.width;sap.zen.MessageViewHandler.height=s.height;};sap.zen.MessageViewHandler.setVariableScreen=function(i){if(!i){sap.zen.MessageViewHandler.width=150;sap.zen.MessageViewHandler.height=50;sap.zen.MessageViewHandler.JSMessageHandler.setPopupAutoClose(false);sap.zen.MessageViewHandler.JSMessageHandler.setPopupAreaIds([]);sap.zen.MessageViewHandler.JSMessageHandler.setDistanceToButton(80);sap.zen.MessageViewHandler.JSMessageHandler.allowDynSizeBehavior(false);}else{if(sap.zen.MessageViewHandler.JSMessageHandler.oRenderData){var p=sap.zen.MessageViewHandler.JSMessageHandler.oRenderData.oPopup;if(p){p.close();}var d=sap.zen.MessageViewHandler.JSMessageHandler.oDataModel.getData().data;if(d&&d.length>0){sap.zen.MessageViewHandler.JSMessageHandler.oOldDataModel=d;}else{sap.zen.MessageViewHandler.JSMessageHandler.oOldDataModel=null;}}}sap.zen.MessageViewHandler.bIsVariableScreen=i;};sap.zen.MessageViewHandler.registerOffsetCalulationCallback=function(c){sap.zen.MessageViewHandler.fCalculationCallback=c;};sap.zen.MessageViewHandler.width=150;sap.zen.MessageViewHandler.height=50;sap.zen.MessageViewHandler.bIsVariableScreen=false;sap.zen.MessageViewHandler.info="INFO";sap.zen.MessageViewHandler.warning="WARNING";sap.zen.MessageViewHandler.error="ERROR";sap.zen.MessageViewHandler.JSMessageHandler=new function(){var s=undefined;this.oDataModel=undefined;this.oOldDataModel=undefined;this.oJsonModel=undefined;this.oRenderData=undefined;this.oNotificationButton=undefined;this.sLogCommand=undefined;this.sMessageTypes=undefined;this.bAutoClose=false;this.aPopupAreaIds=[];this.setDistanceToButton=function(d){this.oRenderData.vDist2=d;};this.setPopupAutoClose=function(A){this.bAutoClose=A;};this.setPopupAreaIds=function(p){this.aPopupAreaIds=p;};this.allowDynSizeBehavior=function(A){function d(o){var D=q(document.getElementById(t.oRenderData.oMainLayout.getId()));var b=parseInt(D.css("bottom"),10);var w=parseInt(q(window).innerHeight(),10);if(w-t.oRenderData.iInitialLayoutHeight-b<0){if(!t.oRenderData.bDynamicHeight||o===true){D.css("top","1px");D.addClass("sapzenmessageview-AutoHeight");t.oRenderData.bDynamicHeight=true;}}else{if(t.oRenderData.bDynamicHeight===true||o===true){D.css("top","auto");D.removeClass("sapzenmessageview-AutoHeight");t.oRenderData.bDynamicHeight=false;}}}function r(){clearTimeout(p);if(t.oRenderData.oPopup.isOpen()){d(true);}else{p=setTimeout(r,150);}}var t=this;var p;if(A){this.oRenderData.oMainLayout.oldOnAfterRendering=this.oRenderData.oMainLayout.onAfterRendering;this.oRenderData.oMainLayout.onAfterRendering=function(){if(this.oldOnAfterRendering){this.oldOnAfterRendering();}if(t.oRenderData.iInitialLayoutHeight===0){t.oRenderData.iInitialLayoutHeight=parseInt(q(document.getElementById(this.getId())).css("height"),10);}t.oRenderData.oPopup.setAutoClose(t.bAutoClose);if(t.bAutoClose){var D=[],i,b,o;for(i=0;i<t.aPopupAreaIds.length;i++){b=t.aPopupAreaIds[i];if(b){o=q(document.getElementById(b));if(o&&o.length>0){D.push(o[0]);}}}D.push(document.getElementById(t.oNotificationButton.getId()));t.oRenderData.oPopup.setAutoCloseAreas(D);}p=setTimeout(r,150);};q(window).resize(d);}else{if(this.oRenderData.oMainLayout.oldOnAfterRendering){this.oRenderData.oMainLayout.onAfterRendering=this.oRenderData.oMainLayout.oldOnAfterRendering;}}};this.clearAllMessages=function(){if(this.oDataModel){this.oDataModel.removeAll();if(this.oJsonModel){this.oJsonModel.setData(this.oDataModel.getData());}}};this.createLogMessage=function(l,S,L){if(!this.oNotificationButton){this.saveMessage(l,S,L,true,true);}else{this.logMessage(l,S,L);}};this.createMessage=function(l,S,L,b){if(!this.oNotificationButton){this.saveMessage(l,S,L,b,false);}else{this.createMessageInternal(l,S,L);if(b){this.logMessage(l,S,L);}}};this.saveMessage=function(l,S,L,b,c){if(!s){s=[];}var m={};m.sLevel=l;m.sShortText=S;m.sLongText=L;m.bLogMessage=b;m.bLogOnly=c;s.push(m);};this.createSavedMessages=function(){if(s){for(var i=0;i<s.length;i++){var m=s[i];if(!m.bLogOnly){this.createMessageInternal(m.sLevel,m.sShortText,m.sLongText);}if(m.bLogMessage){this.logMessage(m.sLevel,m.sShortText,m.sLongText);}}s=undefined;}};this.logMessage=function(l,S,L){if(this.sLogCommand){var c=this.sLogCommand;c=B.dispatcher.prepareCommand(c,"__LEVEL__",l);c=B.dispatcher.prepareCommand(c,"__SHORTTEXT__",S);c=B.dispatcher.prepareCommand(c,"__LONGTEXT__",L);var A=new Function(c);A();}};this.createMessageInternal=function(l,S,L){var v=true;if(!this.sMessageTypes){v=false;}else{if(l!==sap.zen.MessageViewHandler.error&&l!==sap.zen.MessageViewHandler.warning&&l!==sap.zen.MessageViewHandler.info){v=false;}if(l===sap.zen.MessageViewHandler.warning&&this.sMessageTypes==="ERRORS"){v=false;}if(l===sap.zen.MessageViewHandler.info&&this.sMessageTypes==="ERRORS"){v=false;}if(l===sap.zen.MessageViewHandler.info&&this.sMessageTypes==="WARNINGSERRORS"){v=false;}}if(v){var m={};var n={};n.msg_idx=0;n.id="FrontEnd-Message-"+new Date().getTime();n.short_text=S;n.long_text=L;n.level=l;m.message=n;this.oDataModel.add(m);this.oJsonModel.setData(this.oDataModel.getData());this.oNotificationButton.setVisible(true);if(!sap.ui.getCore().getUIDirty()){var t=this;window.setTimeout(function(){t.oNotificationButton.invalidate();},10);}}};}();var a=new sap.zen.MessageViewHandler();B.dispatcher.addHandlers(a.getType(),a);return a;});
