/*
 * SAPUI5
  (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["jquery.sap.global","sap/zen/dsh/utils/BaseHandler","sap/ui/core/IconPool"],function(q,B){sap.zen.MessageViewHandler=function(){B.apply(this,arguments);sap.zen.MessageViewHandler.tTexts={};sap.zen.MessageViewHandler.info="INFO";sap.zen.MessageViewHandler.warning="WARNING";sap.zen.MessageViewHandler.error="ERROR";var m=B.dispatcher.dshPrefix+"MESSAGE_messageview1";var f=B.dispatcher.dshPrefix+"FOOTERBAR_footerbar";var p=B.dispatcher.dshPrefix+"PANEL_BODY_panel1";this.tMessageViews={};this.oldMessagesAfterVarScreen=[];sap.zen.MessageViewHandler.setVariableScreen=function(M){if(M){if(a.oMessageView){var l=sap.ui.getCore().byId(a.oMessageView.getMessageButton().getId());if(l){this.oldMessagesAfterVarScreen=l.oMsgPopover.getModel().getData();}}}a.varScreenMode=M;};sap.zen.MessageViewHandler.createMessage=function(l,c,d,e){if(a.oMessageView){a.oMessageView.createMessage(l,c,d,e);}};sap.zen.MessageViewHandler.logMessage=function(l,c,d){if(a.oMessageView){a.oMessageView.logMessage(l,c,d);}};sap.zen.MessageViewHandler.clearMessages=function(){if(a.oMessageView){a.oMessageView.clearMessages();}};this.createAndAdd=function(c,d,e,i,I){var l=this.create(c,d,e);if(i){i(l,I,e);}B.dispatcher.updateComponentProperties(l,e,i);return l;};this.create=function(c,C){this.sLogCommand=C.log_command;var l=C["id"];this.oMessageView=new sap.zen.MessageViewHandler.MessageView(l,null,b,_);this.tMessageViews[this.oMessageView.getId()]=this.oMessageView;var d=this.oMessageView.getMessageButton();this.init(d,C);return d;};this.update=function(c,C){if(C){this.init(c,C);}};this.init=function(c,C){var l=this.oMessageView;var d=C["id"];if(l.getId()!==d){l=this.tMessageViews[d];}if(C.texts){sap.zen.MessageViewHandler.tTexts=C.texts;}l.init(C.messages);};this.updateFooterBar=function(M){if(m!==M.getId()){return;}var l=sap.ui.getCore().byId(f);var c=sap.ui.getCore().byId(p);if(l&&c){var d=M.getVisible();l.setHeight(d?"40px":"0px");var e=c.getPositions()[0];var g=e.getBottom();if(d&&g!=="40px"){e.setBottom("40px");c.invalidate();}if(!d&&g!=="0px"){e.setBottom("0px");c.invalidate();}}};function _(){if(this.oMessageView.onAfterRenderingOriginal){this.oMessageView.onAfterRenderingOriginal();}if(!a.varScreenMode){var j=q("#sap-ui-blocklayer-popup");var c=null;if(j&&j.length>0&&j.css("visibility")==="visible"&&j.outerWidth()>0&&j.outerHeight()>0){var z=j.css("z-index");if(z&&z.length>0){var Z=parseInt(z,10);c.css("z-index",""+(Z+1));}}else{c.css("z-index","auto");}}}function b(M){var l=M.getMessageButton();a.updateFooterBar(l);}window._handleMessageView_onAfterInitMessages=function(){if(sap.zen.MessageViewHandler.oldMessagesAfterVarScreen&&!a.varScreenMode){var l=sap.zen.MessageViewHandler.oldMessagesAfterVarScreen.slice();delete sap.zen.MessageViewHandler.oldMessagesAfterVarScreen;return l;}return null;};var s=this.remove;this.remove=function(c){if(c.oMsgPopover){c.oMsgPopover.destroy();}s.apply(this,arguments);};this.getHighestMessageLevel=function(M){if(a.oMessageView){a.oMessageView.getHighestMessageLevel(M);}};this.getType=function(){return"messageview";};sap.zen.MessageViewHandler.MessageView=function(c,t,F,o,d){var e=this;this.id=c;this.oMsgBtn=null;this.logCommand;this.getId=function(){return this.id;};this.getMessageButton=function(){return this.oMsgBtn;};this.onAfterUpdate=function(){};this.onAfterRendering=function(){if(!e.oMsgBtn.oOriginalFuncOnAfterRendering){e.oMsgBtn.oOriginalFuncOnAfterRendering();}};this.onAfterInitMessages=function(){};function g(c,t,F,o,d){var i=sap.ui.getCore().byId(c);if(i){i.destroy();}var v=new sap.m.Button({id:c,icon:sap.ui.core.IconPool.getIconURI("message-popup"),text:"",type:sap.m.ButtonType.Emphasized,press:function(){this.oMsgPopover.toggle(this);}});var w=new sap.m.MessagePopoverItem({type:"{type}",title:"{title}",description:"{description}"});var x=new sap.m.Button({icon:"sap-icon://delete",press:function(){v.oMsgPopover.getModel().setData([]);v.setVisible(false);e.onAfterUpdate(e);}});v.oMsgPopover=new sap.m.MessagePopover({items:{path:"/",template:w},headerButton:x});h(F);j(v,o);k(d);e.oMsgBtn=v;l(v,t);return v;}function h(i){if(!e.onAfterUpdateOriginal){e.onAfterUpdateOriginal=e.onAfterUpdate;}if(i){e.onAfterUpdate=i;}}function j(M,i){if(!e.onAfterRenderingOriginal){e.onAfterRenderingOriginal=e.onAfterRendering;}if(i){e.onAfterRendering=i;}if(!M.oOriginalFuncOnAfterRendering){M.oOriginalFuncOnAfterRendering=M.onAfterRendering;}M.onAfterRendering=e.onAfterRenderingOriginal;}function k(i){if(!e.onAfterInitMessagesOriginal){e.onAfterInitMessagesOriginal=e.onAfterInitMessages;}if(i){e.onAfterInitMessages=i;}}this.init=function(t){l(this.oMsgBtn,t);};function l(M,t){var i,v=[];if(M.oMsgPopover){i=M.oMsgPopover.getModel();if(i){var w=i.getData();if(w){v=w;v=[];}}}var x=r(v,t);if(M.oMsgPopover.getModel()){M.oMsgPopover.getModel().setData(x);}else{i=new sap.ui.model.json.JSONModel();i.setData(x);M.oMsgPopover.setModel(i);}n(M);}this.update=function(){n(this.oMsgBtn);};function n(M){var i=M.oMsgPopover.getModel().getData()?M.oMsgPopover.getModel().getData().length:0;var v=sap.zen.MessageViewHandler.tTexts&&sap.zen.MessageViewHandler.tTexts.notification_header?i+" "+sap.zen.MessageViewHandler.tTexts.notification_header:i+"";M.setText(i);M.setTooltip(v);M.setVisible(i>0);e.onAfterUpdate(e);}function r(i,v){var w=[];var x=0;var y={};if(i&&i.length>0){for(x=0;x<i.length;x++){var z=i[x].message;y={};if(z.level==="ERROR"){y.type="Error";}else if(z.level==="WARNING"){y.type="Warning";}else{y.type="Information";}y.title=z.short_text;y.description=z.long_text;w.push(y);}}if(v&&v.length>0){for(x=0;x<v.length;x++){var A=v[x].message;y={};if(A.level==="ERROR"){y.type="Error";}else if(A.level==="WARNING"){y.type="Warning";}else{y.type="Information";}y.title=A.short_text;y.description=A.long_text;w.push(y);}}else{if(u()){if(w){return w;}else{return[];}}var C=false;var D=e.onAfterInitMessages(e,C);if(C){return D;}return[];}return w;}function u(){if(typeof(sap.zen.dsh.DSH_deployment)!=="undefined"){return true;}else{return false;}}this.getHighestMessageLevel=function(M){var v=M.getData();var w=false;for(var i=0;i<v.length;i++){var x=v[i];if(x.type==="Error"){return"message-error";}else if(x.type==="Warning"){w=true;}}if(w){return"message-warning";}return"message-information";};this.createMessage=function(i,v,w,x){if(!this.oMsgBtn){return;}var y={};if(i==="ERROR"){y.type="Error";}else if(i==="WARNING"){y.type="Warning";}else{y.type="Information";}y.title=v;y.description=w;var z;if(this.oMsgBtn.oMsgPopover&&this.oMsgBtn.oMsgPopover.getModel()){z=this.oMsgBtn.oMsgPopover.getModel();z.setData([y]);}else{z=new sap.ui.model.json.JSONModel();z.setData([y]);z.oMsgPopover.setModel(z);}this.update();if(x){this.logMessage(i,v,w);}};this.logMessage=function(i,v,w){if(this.logCommand){var x=this.logCommand;x=B.dispatcher.prepareCommand(x,"__LEVEL__",i);x=B.dispatcher.prepareCommand(x,"__SHORTTEXT__",v);x=B.dispatcher.prepareCommand(x,"__LONGTEXT__",w);var y=new Function(x);y();}};this.clearMessages=function(){if(!this.oMsgBtn){return;}if(this.oMsgBtn.oMsgPopover&&this.oMsgBtn.oMsgPopover.getModel()){var i=this.oMsgBtn.oMsgPopover.getModel();i.setData([]);this.update();}};this.oMsgBtn=g(c,t,F,o,d);};};var a=new sap.zen.MessageViewHandler();B.dispatcher.addHandlers(a.getType(),a);return a;});
