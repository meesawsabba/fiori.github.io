/*!
 * SAPUI5
  (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define("sap/zen/dsh/dialogs/Open",["sap/base/Log","sap/ui/core/Fragment","sap/ui/model/json/JSONModel","sap/m/MessageBox","sap/zen/dsh/utils/ResourceModel","sap/zen/dsh/utils/ResourceBundle","sap/zen/commons/thirdparty/lodash"],function(L,F,J,M,R,a,_){"use strict";var d;var r,f;function h(b,c){r=b;f=c;}var t;function g(c){return c.runAsOwner(function(){return Promise.resolve(F.load({name:"sap.zen.dsh.fragment.Open",controller:{search:function(){d.setBusy(true);Promise.resolve(null).then(function(){return d.getModel("om").getCatalog(sap.ui.getCore().byId("fbotext").getValue(),sap.ui.getCore().byId("fbosystem").getSelectedKey(),sap.ui.getCore().byId("fbotype").getSelectedKey());}).then(function(o){t.getModel().setData(o.catalog);t.clearSelection();d.setBusy(false);}).catch(function(e){L.error(e.stack);d.setBusy(false);M.show(e.message,{icon:M.Icon.ERROR,title:d.getModel("i18n").getResourceBundle().getText("ERROR_OPEN"),actions:[M.Action.CLOSE]});});},onOkValueHelp:function(e){d.close();r({name:e.getParameter("tokens")[0].getKey(),systemName:sap.ui.getCore().byId("fbosystem").getSelectedKey(),package:e.getParameter("tokens")[0].data().row.Package,schema:e.getParameter("tokens")[0].data().row.Schema,type:e.getParameter("tokens")[0].data().row.Type||"query"});},onCancelValueHelp:function(){d.close();r(null);}}})).then(function(D){d=D;d.setModel(R,"i18n");d.openQuery=function(o){d.setBusy(true);d.open.apply(d);d.getTableAsync().then(function(T){t=T;d.setModel(new J());t.setModel(new J());t.setModel(new J(),"columns");t.getModel("columns").setData({cols:[{label:"Key",template:"key"},{label:"Description",template:"Description"},{label:"Package",template:"Package"},{label:"Schema",template:"Schema"},{label:"Type",template:"Type"}]});t.bindRows("/");t.getModel().setData([]);D.setModel(o,"om");return o.getCatalog(sap.ui.getCore().byId("fbotext").getValue(),sap.ui.getCore().byId("fbosystem").getSelectedKey(),sap.ui.getCore().byId("fbotype").getSelectedKey());}).then(function(b){var e=b||{};e.multipleValues=false;e.Description=a.getText("OPEN");d.getModel().setData(e);t.getModel().setData(e.catalog);if(t.bindRows){t.bindRows("/");}d.setTokens([]);d.setBusy(false);}).catch(function(e){d.setBusy(false);f(e);});return new Promise(h);};return d;});});}return g;});
