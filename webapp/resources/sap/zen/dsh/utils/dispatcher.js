/*
 * SAPUI5
  (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define("sap/zen/dsh/utils/dispatcher",["jquery.sap.global","sap/base/Log","sap/zen/dsh/utils/request"],function(q,L,R){q.sap.declare("sap.zen.dsh.utils.Dispatcher");sap.zen.dsh.sapbi_page=sap.zen.dsh.sapbi_page||{};var D=function(){var t=this;var m={};var c={};var a={};var s=false;var l=[];var I=false;var d=0;var b=null;var g=false;var u={};var o={};var h;var n;var p;var C;if(sap.zen.dsh.sapbi_page.m_profileMode&&q.sap.measure.getActive()){var H=0;}this.reset=function(){c={};a={};};this.addHandler=function(T,i,e){if(sap.zen.dsh.sapbi_page.m_profileMode&&q.sap.measure.getActive()){L.info("Register Handler "+H);if(!q.sap.measure.getMeasurement("zen addHandler "+H)){q.sap.measure.start("zen addHandler "+H,"addHandler/"+T);}else{q.sap.measure.end("zen addHandler "+H);q.sap.measure.start("zen addHandler "+(++H),"addHandler/"+T);}}var f=m[T];if(!f){f=[];m[T]=f;}f[i]=e;};this.addHandlers=function(T,e,f){this.addHandler(T,0,e);if(sap.zen.designmode){this.addHandler(T,1,new sap.zen.designmode.DefaultDesignHandler(null,f,e));}};this.getHandlers=function(T){var e=m[T];if(e){return e.slice();}var f="No handler found for type "+T;L.error(f);throw new Error(f);};this.removeHandlers=function(T){delete m[T];};this.dispatchDelta=function(e){this.deleteMessageStack();s=true;I=false;l=e;this.resizeControlsForNotification=[];for(var i=0;i<e.length;i++){var f=e[i];if(f.component){this.dispatchUpdateControl(f.component,false);}else{this.dispatchUpdateControl(f,true);}this.notifyControlsOfResize();}B();this.doAfterDispatchingWork();s=false;l=[];this.renderDeferredObjects();return true;};this.resizeControlsForNotification=[];this.registerControlForResizeNotificationIfNecessary=function(e,f,i,j,k,F,G){if(f&&i&&e){var J=true;for(var K in i){if(Object.prototype.hasOwnProperty.call(i,K)){var M=f[K];if(!M){J=false;break;}if(i[K]!==M){J=false;break;}}}if(j!==null&&k){if(j!=k&&k!=="auto"){J=false;}}if(F!==null&&G){if(F!=G&&G!=="auto"){J=false;}}if(!J){this.resizeControlsForNotification.push(e);}}};this.notifyControlsOfResize=function(){for(var i=0;i<this.resizeControlsForNotification.length;i++){var e=this.resizeControlsForNotification[i];for(var f in a){if(Object.prototype.hasOwnProperty.call(a,f)){var j=a[f];if(!(typeof j.obj==="string")){var k=j.obj.getId();var F=true;if(e.getId()!==k){var G=q(document.getElementById(e.getId())).find("#"+q.sap.encodeCSS(k));F=(G&&G.length>0);}if(F){var J=a[f].handler;var K=J["beginResize"];if(K){K.call(J,{});}K=J["endResize"];if(K){K.call(J,{});}}}}}}};this.dragHandler=function(){var t=this;this.dragAreas=[];this.dropAreas=[];this.activeDragArea=null;this.registerActiveDragArea=function(e){if(this.activeDragArea===null){this.activeDragArea=e;return;}throw new Error("Unregister active drag area first!");};this.unregisterActiveDragArea=function(){this.activeDragArea=null;};this.isDragAreaActive=function(){return this.activeDragArea!==null;};this.getDragAreas=function(){return this.dragAreas;};this.registerDragArea=function(e){if(this.dragAreas.indexOf(e)===-1){this.dragAreas.push(e);}};this.unregisterDragArea=function(e){var i=this.dragAreas.indexOf(e);if(i>-1){this.dragAreas.splice(i,1);}};var f=[];this.notifyAffectedDropAreas=function(e){var k,i,j;var F=this.getAllAffectedDropAreas();for(i=0;i<F.length;i++){var G=F[i];k=false;for(j=0;j<f.length;j++){var J=f[j];if(J===G){k=true;break;}}if(!k){G.execInCallback(e,{"drag":this.activeDragArea,"drop":G});this.activeDragArea.execInCallback(e,{"drag":this.activeDragArea,"drop":G});}G.execMoveCallback(e,{"drag":this.activeDragArea,"drop":G});this.activeDragArea.execMoveCallback(e,{"drag":this.activeDragArea,"drop":G});}for(i=0;i<f.length;i++){var K=f[i];k=false;for(j=0;j<F.length;j++){var M=F[j];if(K===M){k=true;break;}}if(!k){K.execOutCallback(e,{"drag":this.activeDragArea,"drop":K});this.activeDragArea.execOutCallback(e,{"drag":this.activeDragArea,"drop":K});}}f=F;};this.getDropAreas=function(){return this.dropAreas;};this.registerDropArea=function(e){if(this.dropAreas.indexOf(e)===-1){this.dropAreas.push(e);}};this.unregisterDropArea=function(e){var i=this.dropAreas.indexOf(e);if(i>-1){this.dropAreas.splice(i,1);}};this.zIndexObjects=null;this.calculateZIndex=function(){if(this.zIndexObjects===null){this.zIndexObjects=q("body").find("*");}};this.getAllAffectedDropAreas=function(){this.calculateZIndex();var e=[];if(this.activeDragArea===null){return e;}var j=-1;var k=null;for(var i=0;i<this.dropAreas.length;i++){var F=this.dropAreas[i];var G=F.getIndex(this.zIndexObjects);if(F.isPointWithinDropInfoRegion(this.activeDragArea.getMousePosX(),this.activeDragArea.getMousePosY())&&G>j){k=F;j=G;}}if(k===null){return e;}e.push(k);return e;};this.executeDrop=function(e){var j=this.getAllAffectedDropAreas();var k;for(var i=0;i<j.length;i++){k=j[i];k.execDropCallback(e,{"drag":this.activeDragArea,"drop":k});}this.activeDragArea.execDropCallback(e,{"drag":this.activeDragArea,"drop":k});this.cleanup();};this.abort=function(){var e=this.getAllAffectedDropAreas();for(var i=0;i<e.length;i++){var j=e[i];j.execOutCallback(this.activeDragArea);}this.activeDragArea.execOutCallback(j);this.cleanup();};this.cleanup=function(){t.zIndexObjects=null;f=[];};};this.dragHandlerInstance=new this.dragHandler();this.dragAreaBase=function(j,T,M,O,i,f){this.jqObj=j;this.sType=T;this.fMove=M;this.fOut=O;this.fIn=i;this.fDrop=f;this.phxObj=null;this.init=function(){if(this.jqObj instanceof sap.ui.core.Element){this.phxObj=j;}else{this.jqObj=j;}};this.getJQObject=function(){if(this.phxObj){return this.phxObj.$();}return this.jqObj;};this.getPhxObject=function(){return this.phxObj;};this.getType=function(){return this.sType;};this.execMoveCallback=function(e,k){if(this.fMove){this.fMove(e,k);}};this.execOutCallback=function(e,k){if(this.fOut){this.fOut(k);}};this.execInCallback=function(e,k){if(this.fIn){this.fIn(k);}};this.execDropCallback=function(e,k){if(this.fDrop){this.fDrop(e,k);}};this.isDragArea=function(){return false;};this.isDropArea=function(){return false;};};this.dragArea=function(j,T,P,f,i,M,O,k,F){D.instance.dragAreaBase.apply(this,[j,T,M,O,k,F]);this.fDown=i;this.fCreate=f;this.oPayload=P;this.jqDragClone=null;this.dragging=false;var t=this;var G=function(e){t.mouseMove(e);};var J=function(e){t.mouseUp(e);};var K=function(){t.abort();};this.isDragArea=function(){return true;};this.getPayload=function(){return this.oPayload;};this.iXStart=null;this.iYStart=null;this.lastMousePosX=null;this.lastMousePosY=null;this.getMousePosX=function(){return this.lastMousePosX;};this.getMousePosY=function(){return this.lastMousePosY;};this.getDragCloneX=function(){return this.iXStart;};this.getDragCloneY=function(){return this.iYStart;};var N=function(e){var V=t.execDownCallback(e,this);if(V===undefined||V===true){D.instance.dragHandlerInstance.registerActiveDragArea(t);t.lastMousePosX=e.pageX;t.lastMousePosY=e.pageY;q(document.body).addClass("zenSplitUserSel");q(document).bind("mousemove",G);q(document).bind("mouseup",J);q(document).bind("keydown",K);}};var Q=this.init;this.init=function(){Q.apply(this,arguments);var e=this.getPhxObject();if(!e){e=this.getJQObject();e.bind("mousedown",N);}else{e.attachBrowserEvent("mousedown",N);}};var S=function(e){if(t.iXStart===null){t.iXStart=t.getJQObject().offset().left;}if(t.iYStart===null){t.iYStart=t.getJQObject().offset().top;}if(t.lastMousePosX===null){t.lastMousePosX=e.pageX;}if(t.lastMousePosY===null){t.lastMousePosY=e.pageY;}};var U=function(e){var V=e.pageX-t.lastMousePosX;var W=e.pageY-t.lastMousePosY;t.lastMousePosX=e.pageX;t.lastMousePosY=e.pageY;t.iXStart=t.iXStart+V;t.iYStart=t.iYStart+W;if(t.getDragClone()){t.getDragClone().css("left",t.getDragCloneX()+"px");t.getDragClone().css("top",t.getDragCloneY()+"px");}};this.updatePositions=function(e){S(e);U(e);};this.mouseMove=function(e){if(this.isDragging()===false){this.setDragClone(t.createDragObject(e));this.setDragging(true);}this.updatePositions(e);D.instance.dragHandlerInstance.notifyAffectedDropAreas(e);this.execMoveCallback(e,this);};this.mouseUp=function(e){this.updatePositions(e);D.instance.dragHandlerInstance.executeDrop(e);this.cleanup();};this.abort=function(){D.instance.dragHandlerInstance.abort();this.cleanup();};this.cleanup=function(){q(document).unbind("mousemove",G);q(document).unbind("mouseup",J);q(document).unbind("keydown",K);D.instance.dragHandlerInstance.unregisterActiveDragArea(this);this.setDragging(false);this.iXStart=null;this.iYStart=null;this.lastMousePosX=null;this.lastMousePosY=null;q(document.body).removeClass("zenSplitUserSel");if(this.getDragClone()){this.getDragClone().remove();}};this.getDragClone=function(){return this.jqDragClone;};this.setDragClone=function(e){this.jqDragClone=e;};this.createDragObject=function(e){if(this.fCreate){return this.fCreate(e,this);}else{var V=this.getJQObject().clone();V.css("position","absolute");V.css("top",this.getJQObject().offset().top+"px");V.css("left",this.getJQObject().offset().left+"px");V.css("width",this.getJQObject().outerWidth()+"px");V.css("height",this.getJQObject().outerHeight()+"px");V.addClass("zenDragClone");V.appendTo(q(document.body));return V;}};this.setDragging=function(e){this.dragging=e;};this.isDragging=function(){return this.dragging;};this.execDownCallback=function(e,V){if(this.fDown){return this.fDown(e,V);}return null;};this.init();};this.dropArea=function(j,T,M,O,i,f,X,Y,W,e){D.instance.dragAreaBase.apply(this,arguments);this.iWidth=W;this.iHeight=e;this.iX=X;this.iY=Y;this.getX=function(){if((this.iX===null||this.iX===undefined)){var k=this.getJQObject();if(k===null||k===undefined||(k.length!==null&&k.length!==undefined&&k.length===0)){return null;}return k.offset().left;}return this.iX;};this.getY=function(){if((this.iY===null||this.iY===undefined)){var k=this.getJQObject();if(k===null||k===undefined||(k.length!==null&&k.length!==undefined&&k.length===0)){return null;}return k.offset().top;}return this.iY;};this.getWidth=function(){if(this.iWidth===null||this.iWidth===undefined){var k=this.getJQObject();if(k===null||k===undefined||(k.length!==null&&k.length!==undefined&&k.length===0)){return null;}return k.outerWidth();}return this.iWidth;};this.getHeight=function(){if(this.iHeight===null||this.iHeight===undefined){var k=this.getJQObject();if(k===null||k===undefined||(k.length!==null&&k.length!==undefined&&k.length===0)){return null;}return k.outerHeight();}return this.iHeight;};this.isDropArea=function(){return true;};this.getXPlusWidth=function(){var k=this.getX();if(k===null){return null;}var F=this.getWidth();if(F===null){return null;}return(k+F);};this.getYPlusHeight=function(){var k=this.getY();if(k===null){return null;}var F=this.getHeight();if(F===null){return null;}return(k+F);};this.getIndex=function(J){return J.index(this.getJQObject());};this.isPointWithinDropInfoRegion=function(X,Y){var k=X;var F=Y;var G=this.getX();var J=this.getY();var K=this.getXPlusWidth();var N=this.getYPlusHeight();if(G===null||J===null||K===null||N===null){return false;}if(G<=k&&k<K&&J<=F&&F<N){return true;}return false;};this.init();};this.aDebugJsonLogger=[];this.aDebugJsonReplay=[];this.loggerDiv=null;this.numberDiv=null;this.jsonArea=null;this.replayDiv=null;this.replayJsonEnder="<ENDOFJSON>";this.replayDivId=null;this.replayIndex=0;this.getStringifiedJson=function(j){return JSON.stringify(j,null,"    ");};this.convertStringToArray=function(j){if(!j){return[];}var J=j.split(this.replayJsonEnder);var e=[];for(var i=0;i<J.length;i++){if(J[i].length>0){e.push(JSON.parse(J[i]));}}return e;};this.logJson=function(j,f,k){if(!this.replayDiv||this.replayDiv.css("display")==="none"){this.aDebugJsonLogger.push(j);}this.replayDivId=k;var t=this;var F="100%";if(this.loggerDiv===null){this.loggerDiv=q("<div id='sapZenDebugJsonLogger'/>");if(f){this.loggerDiv.height("15px");this.loggerDiv.width("10px");}else{this.loggerDiv.width(F);this.loggerDiv.height("100%");}this.loggerDiv.css("left","0");this.loggerDiv.css("top","0");this.loggerDiv.css("position","absolute");this.loggerDiv.css("background-color","red");this.loggerDiv.css("overflow","hidden");if(!f){this.loggerDiv.css("display","none");}this.numberDiv=q("<span id='sapZenDebugJsonLoggerNumber'/>");this.numberDiv.css("background-color","white");this.numberDiv.html(this.aDebugJsonLogger.length-1);this.jsonArea=q("<textarea id='sapZenDebugJsonLoggerArea' />");this.jsonArea.width("100%");this.jsonArea.css("height","-webkit-calc(100% - 50px)");this.jsonArea.css("height","calc(100% - 50px)");this.jsonArea.css("height","-moz-calc(100% - 50px)");this.jsonArea.css("font-family","Courier New, monospace");this.jsonArea.css("overflow","auto");this.jsonArea.css("-webkit-overflow-scrolling","touch");this.jsonArea.bind("touchmove",function(e){e.stopPropagation();});this.jsonArea.val(this.getStringifiedJson(this.aDebugJsonLogger[this.aDebugJsonLogger.length-1]));this.numberDiv.bind("click",function(){if(t.loggerDiv.width()===10){t.loggerDiv.width(F);t.loggerDiv.height("100%");}else{t.loggerDiv.width("10px");t.loggerDiv.height("15px");}});var G=q("<button id='sapZenDebugJsonLoggerBtnBackward' height='20px'/>");G.html("<");G.bind("click",function(){var Q=parseInt(t.numberDiv.html())-1;if(Q>=0){t.numberDiv.html(Q);t.jsonArea.val(t.getStringifiedJson(t.aDebugJsonLogger[Q]));}});var J=q("<button id='sapZenDebugJsonLoggerBtnForward' height='20px'/>");J.html(">");J.bind("click",function(){var Q=parseInt(t.numberDiv.html())+1;if(Q<t.aDebugJsonLogger.length){t.numberDiv.html(Q);t.jsonArea.val(t.getStringifiedJson(t.aDebugJsonLogger[Q]));}});var K=q("<button id='sapZenDebugJsonLoggerBtnSummary' height='20px'/>");K.html("Summary");K.bind("click",function(){var e="";for(var i=0;i<=t.aDebugJsonLogger.length-1;i++){e+="JSON: Z"+i+"\r\n\r\n\r\n";e+=t.getStringifiedJson(t.aDebugJsonLogger[i]);e+="\r\n\r\n\r\n";}t.jsonArea.val(e);});var M=q("<button id='sapZenDebugJsonLoggerBtnReplay' height='20px'/>");M.html("Replay");M.bind("click",function(){var e="";for(var i=0;i<=t.aDebugJsonLogger.length-1;i++){e+=JSON.stringify(t.aDebugJsonLogger[i]);e+=t.replayJsonEnder;}t.jsonArea.val(e);});this.numberDiv.appendTo(this.loggerDiv);this.jsonArea.appendTo(this.loggerDiv);G.appendTo(this.loggerDiv);J.appendTo(this.loggerDiv);K.appendTo(this.loggerDiv);M.appendTo(this.loggerDiv);this.loggerDiv.appendTo(q(document.body));this.replayDiv=q("<div id='sapZenDebugJsonLoggerReplayDiv'/>");this.replayDiv.css("right","0");this.replayDiv.css("bottom","4px");this.replayDiv.css("position","absolute");this.replayDiv.css("background-color","red");this.replayDiv.css("display","none");this.replayDiv.width("56px");this.replayDiv.height("25px");this.replayDiv.appendTo(q(document.body));var N=q("<button id='sapZenDebugJsonLoggerBtnReplayBck'/>");N.html("<");N.bind("click",function(){if(t.replayIndex>0){t.replayIndex--;sap.zen.dsh.sapbi_phx(t.replayDivId,{"delta":[t.aDebugJsonReplay[0]]});for(var i=1;i<=t.replayIndex;i++){sap.zen.dsh.sapbi_phx(t.replayDivId,t.aDebugJsonReplay[i]);}}});var O=q("<button id='sapZenDebugJsonLoggerBtnReplayFwd'/>");O.html(">");O.bind("click",function(){if(t.replayIndex<t.aDebugJsonReplay.length-1){t.replayIndex++;sap.zen.dsh.sapbi_phx(t.replayDivId,t.aDebugJsonReplay[t.replayIndex]);}});N.appendTo(this.replayDiv);O.appendTo(this.replayDiv);var P=function(e){if(e.ctrlKey&&e.altKey&&e.which===68){if(t.loggerDiv.css("display")!=="none"){t.loggerDiv.css("display","none");}else{t.loggerDiv.css("display","inline");}}if(e.ctrlKey&&e.altKey&&e.which===80){if(t.replayDiv.css("display")!=="none"){t.replayDiv.css("display","none");}else{t.replayDiv.css("display","inline");t.aDebugJsonReplay=t.convertStringToArray(prompt("Copy JSON",""));t.aDebugJsonLogger=t.aDebugJsonReplay;t.numberDiv.html(0);t.jsonArea.val(t.getStringifiedJson(t.aDebugJsonLogger[0]));sap.zen.dsh.sapbi_phx(t.replayDivId,{"delta":[t.aDebugJsonReplay[0]]});}}};q(document).bind("keydown",P);}else{if(parseInt(this.numberDiv.html())===this.aDebugJsonLogger.length-2||(this.replayDiv&&this.replayDiv.css("display")!=="none")){var Q=this.aDebugJsonLogger.length-1;this.numberDiv.html(Q);this.jsonArea.val(this.getStringifiedJson(this.aDebugJsonLogger[Q]));}}};var r={};function v(e){if(e.content.control){var f=e.content.control.content;if(f){for(var i=0;i<f.length;i++){var j=f[i];r[j.component.id]=e.id;v(j.component);}}}}function w(N){var e=r[N];if(e){return w(e)+"/"+N;}return N;}var x=0;this.dispatchCreateControl=function(e,f,i){var j="";if(this.dshPrefix){j=this.dshPrefix;}if(e.id===j+"ROOT"||e.id===j+"ROOT_DIALOG"){this.resetDispatcher(e.id);}if(sap.zen.dsh.sapbi_page.m_profileMode&&q.sap.measure.getActive()){if(e.id===j+"ROOT"){r={};}if(!r[e.id]){v(e);}q.sap.measure.start("zen create "+e.id,"dispatch/create/"+w(e.id)+":"+e.type);}if(!f){f=function(){};}var k;if(e.content){k=e.content.control;if(!k){throw new Error("Missing control in component JSON");}}var F=y(k,e,f,i);if(F){this.setComponentIdForControl(e.id,F);F.zenControlType=k&&k.type.toLowerCase();}if(sap.zen.dsh.sapbi_page.m_profileMode&&q.sap.measure.getActive()){q.sap.measure.end("zen create "+e.id);}this.doAfterDispatchingWork();return F;};this.doAfterDispatchingWork=function(){var t=this;if(window.eclipse_needsReadyEvents){if(window.eclipse_sendZenUrl){this.sendZenUrlReady();}else{setTimeout(function(){t.sendZenUrlReady();},100);}}};this.bIsReadyEventEnabled=true;this.enableReady=function(e){this.bIsReadyEventEnabled=e;};this.sendZenUrlReady=function(){if(window.eclipse_sendZenUrl&&this.bIsReadyEventEnabled){window.eclipse_sendZenUrl("zen://ready");}};this.dispatchCreateNestedControl=function(e,f,i){var j=null;var k=t.getHandlers(e.type.toLowerCase())[0];if(k){j=k.createAndAdd(j,e,null,f,i);}if(j&&k.styleClasses[j.getId()]){j.removeStyleClass(k.styleClasses[j.getId()]);}if(j&&!e["cssclass"]){var F=e["cssclass"];if(F){j.addStyleClass(F);}k.styleClasses[j.getId()]=F;}return j;};function y(e,f,i,j){var k=null;var F=t.getHandlers(e.type.toLowerCase());for(var G in F){if(Object.prototype.hasOwnProperty.call(F,G)){var J=F[G];k=J.createAndAdd(k,e,f,i,j);if(k.addStyleClass){k.addStyleClass("zenControl");}if(!(typeof f["cssclass"]=="undefined"||!J.styleClasses)){if(J.styleClasses[k.getId()]){k.removeStyleClass(J.styleClasses[k.getId()]);}var K=f["cssclass"];if(K){k.addStyleClass(K);}J.styleClasses[k.getId()]=K;}}}return k;}this.dispatchUpdateControl=function(e,i){if(sap.zen.dsh.sapbi_page.m_profileMode&&q.sap.measure.getActive()){q.sap.measure.start("zen update "+e.id,"dispatch/update/"+w(e.id)+":"+e.type);}if(e.content&&!e.content.control&&e.type==="CROSSTAB_COMPONENT"){e.content.control=dummyTable;e.content.control.id=e.content.control.id+(x++);}var f=this.getRootControlForComponentId(e.id);if(!f){return;}var j=f.zenControlType;var k;if(e.content){var F=e.content;k=F&&F.control;}var G=this.getHandlers(j);for(var J in G){if(Object.prototype.hasOwnProperty.call(G,J)){var K=G[J];if(!(typeof e["cssclass"]==="undefined"||!K.styleClasses)){if(K.styleClasses[f.getId()]){f.removeStyleClass(K.styleClasses[f.getId()]);}var M=e["cssclass"];if(M){f.addStyleClass(M);}K.styleClasses[f.getId()]=M;}K.updateComponent(f,k,e,i);}}if(sap.zen.dsh.sapbi_page.m_profileMode&&q.sap.measure.getActive()){q.sap.measure.end("zen update "+e.id);}};this.updateComponentProperties=function(e,f){if(f&&e&&this.isApplicationRoot(e)){if(f.width!=="auto"&&f.height!=="auto"){var i=this.createAbsoluteLayoutInfo(f);e.zenOldLayoutArgs=i;e.$().css(i);var j=this.calcWidthUseOrderOfPriority(i.left,i.right,f.width);var k=this.calcHeightUseOrderOfPriority(i.top,i.bottom,f.height);this.setWidthHeight(e,j,k);}return;}this.updateComponentPropertiesBase(e,f);};this.suppressRendering=function(){return s;};var z={};this.registerForDeferredRendering=function(e){z[e.getId()]=e;};this.isDeferredRendering=function(){return I;};this.renderDeferredObjects=function(){I=true;var i=false;for(var e in z){if(Object.prototype.hasOwnProperty.call(z,e)){i=true;var P=z[e];P.invalidate();}}if(i){sap.ui.getCore().applyChanges();}z={};I=false;};this.isSingleDelta=function(i){if(l.length!==1){return false;}if(!l[0].component){return false;}if(l[0].component.content&&l[0].component.content.control&&l[0].component.content.control.content){return false;}if(l[0].component.id===i){return true;}return false;};this.addMessageOverlay=function(e,T,S,f){if(e.zenMessageControl){this.removeMessageOverlay(e);}if(e.showLoadingState){var j=e.getParent().$();var i=q("<div/>");var k=false;i.attr("id",e.getId()+"_loadingState");i.addClass("componentLoadingState");if(q.support.opacity){i.addClass("zenLoadingStateOpacity");}else{i.addClass("zenLoadingStateFilter");}j.append(i);e.zenMessageControl=i;var F="";if(j.width()<=200||j.height()<=90){F=" hideLoadingStateClass";k=true;}var G="";if(j.width()<=68||j.height()<=14){G=" hideLoadingStateClassIcon";k=true;}var J=q("<div/>");J.attr("id",e.getId()+"_loadingStateBox");J.addClass("componentLoadingStateBox"+F);if(q.support.opacity){J.addClass("zenLoadingStateOpacity75");}else{J.addClass("zenLoadingStateFilter75");}j.append(J);e.zenMessageControlBox=J;if(T!==""){var K=q("<div/>");K.attr("id",e.getId()+"_loadingState_message");K.addClass("componentLoadingStateMessage"+F);K.addClass("componentLoadingStateMessageDT");if(S){K.addClass("componentLoadingStateMessageWithIcon");}K.attr("title",T);K.html(T);j.append(K);e.zenMessageText=K;}else{J.addClass("componentLoadingStateBoxNoText");}if(S){var M=q("<div/>");M.attr("id",e.getId()+"_loadingState_icon");M.addClass("componentLoadingStateIconBackground"+G);M.addClass("componentLoadingStateIcon");j.append(M);e.zenMessageIcon=M;}else{J.addClass("componentLoadingStateBoxNoIcon");}if(f&&k){var N=e;var O=e;while(N&&/ROOT_absolutelayout$/.exec(N.sId)===null){var P=N.$();if(P){if(P.width()>200&&P.height()>90&&O instanceof sap.ui.core.Control){D.instance.putOnMessageStack(O,e,function(){D.instance.addMessageOverlay(e,T,S,false);});O.onAfterRendering=function(){D.instance.execMessageStack(this);};break;}}O=N;N=N.getParent();}}}};this.aMessageStack=[];this.putOnMessageStack=function(e,f,i){if(this.aMessageStack[e.sId]){this.aMessageStack[e.sId].elements[f.sId]=i;}else{var O=e.onAfterRendering;var j=[];j[f.sId]=i;this.aMessageStack[e.sId]={oldOnAfterRendering:O,elements:j,exec:function(P){if(this.oldOnAfterRendering){this.oldOnAfterRendering.apply(P,arguments);}for(var k in this.elements){if(Object.prototype.hasOwnProperty.call(this.elements,k)){this.elements[k]();}}P.onAfterRendering=this.oldOnAfterRendering;}};}};this.execMessageStack=function(e){var S=this.aMessageStack[e.sId];if(S){S.exec(e);delete this.aMessageStack[e.sId];}};this.deleteMessageStack=function(){for(var e in this.aMessageStack){if(Object.prototype.hasOwnProperty.call(this.aMessageStack,e)){var f=sap.ui.getCore().byId(e);if(f){f.onAfterRendering=this.aMessageStack[e].oldOnAfterRendering;}}}this.aMessageStack=[];};this.removeMessageOverlay=function(e){e.zenMessageControl.remove();if(e.zenMessageControlBox){e.zenMessageControlBox.remove();}if(e.zenMessageText){e.zenMessageText.remove();}if(e.zenMessageIcon){e.zenMessageIcon.remove();}};this.updateComponentPropertiesBase=function(e,f){if(!f||!e||this.isApplicationRoot(e)){return;}var i=this.createAbsoluteLayoutInfo(f);var j=this.calcWidthUseOrderOfPriority(i.left,i.right,f.width);var k=this.calcHeightUseOrderOfPriority(i.top,i.bottom,f.height);var F=this.getAbsoluteLayoutInfo(e);var G=e.$().width();var J=e.$().height();this.setWidthHeight(e,j,k);this.setAbsoluteLayoutInfo(e,i);this.registerControlForResizeNotificationIfNecessary(e,F,i,G,j,J,k);if(f.message||f.showLoadingState!==undefined){if(!f.showLoadingState&&f.message===undefined){if(e.zenMessageControl){e.showLoadingState=false;this.removeMessageOverlay(e);e.onAfterRendering=e.oldAfterRenderingForDispatching||e.onAfterRendering;delete e.oldAfterRenderingForDispatching;delete e.showLoadingState;delete e.showLoadingStateText;delete e.showLoadingStateIcon;delete e.zenMessageControl;}}else{var N=f.showLoadingState||f.message!==undefined;var K="";var S=true;if(f.showLoadingStateText){K=f.showLoadingStateText;}else if(f.message&&f.message._v&&sap.zen.designmode){K=f.message._v;}else if(f.message&&f.message._v&&!sap.zen.designmode&&f.message.visibleAtRuntime===true){K=f.message._v;}if(f.message&&f.message._v){S=false;}if(f.showLoadingState){S=true;}if(e.showLoadingState!==N||e.showLoadingStateText!==K||e.showLoadingStateIcon!==S){if(!e.zenMessageControl){e.oldAfterRenderingForDispatching=e.onAfterRendering;}e.showLoadingState=N;e.showLoadingStateText=K;e.showLoadingStateIcon=S;this.addMessageOverlay(e,e.showLoadingStateText,e.showLoadingStateIcon,true);e.onAfterRendering=function(){if(this.oldAfterRenderingForDispatching){this.oldAfterRenderingForDispatching();}D.instance.addMessageOverlay(this,this.showLoadingStateText,this.showLoadingStateIcon,true);};}}}if(f.visible===false){if(q.support.opacity){e.addStyleClass("zenInvisibleWithOpacity");}else{e.addStyleClass("zenInvisibleWithFilter");}}else if(f.visible===true){if(q.support.opacity){e.removeStyleClass("zenInvisibleWithOpacity");}else{e.removeStyleClass("zenInvisibleWithFilter");}}};this.calcWidthUseOrderOfPriority=function(e,f,i){if(e&&e!=="auto"&&f&&f!=="auto"){return"auto";}return i;};this.calcHeightUseOrderOfPriority=function(e,f,i){if(e&&e!=="auto"&&f&&f!=="auto"){return"auto";}return i;};var A={};this.getTransferControl=function(e){var f=this.getRootControlForComponentId(e);delete A[f.getId()];return f;};this.addTransferControl=function(e,f){f(e);A[e.getId()]=e;};function B(){for(var i in A){if(Object.prototype.hasOwnProperty.call(A,i)){var e=A[i];t.dispatchRemove(e);}}A={};}this.dispatchRemove=function(e){var f=e.zenControlType;var i=this.getHandlers(f);for(var j=i.length-1;j>=0;j--){var k=i[j];if(k.styleClasses&&k.styleClasses[e.getId()]){delete k.styleClasses[e.getId()];}if(k.remove){k.remove(e);}}var F=this.getComponentIdForControl(e);if(F){this.removeComponentId(F);}};this.cleanChildrenControls=function(i){var e={},k;for(k in c){if(Object.prototype.hasOwnProperty.call(c,k)&&c[k]){if(c[k].getId().indexOf(i)>-1&&c[k].getId()!==i){c[k].destroy();c[k]=null;e[k]=k;}}}for(k in e){if(Object.prototype.hasOwnProperty.call(c,k)&&c[k]){removeComponentId(k);}}};this.cleanAllControls=function(){c={};};this.setAbsoluteLayoutInfo=function(e,f){var i=e.getParent();var j=this.getAbsoluteLayoutInfo(e);if(i.updatePosition){f=q.extend(q.extend({},j),f);i.updatePosition(f);e.zenOldLayoutArgs=f;}return f;};this.getAbsoluteLayoutInfo=function(e){return e.zenOldLayoutArgs;};this.createAbsoluteLayoutInfo=function(e){var f=e.leftmargin;var i=e.rightmargin;var j=e.topmargin;var k=e.bottommargin;var F={};if(j){if(j==="auto"){F.top="";}else{F.top=j+"px";}}if(f){if(f==="auto"){F.left="";}else{F.left=f+"px";}}if(i){if(i==="auto"){F.right="";}else{F.right=i+"px";}}if(k){if(k==="auto"){F.bottom="";}else{F.bottom=k+"px";}}return F;};this.insertIntoAbsoluteLayoutContainer=function(e,f,i){e.insertContent(f,i);if(f.zenMessageControl){this.addMessageOverlay(f,f.showLoadingStateText,f.showLoadingStateIcon,true);}};this.getValue=function(e,f){if(e[f]){return e[f]["_v"];}return null;};this.isApplicationRoot=function(e){var i=e.getId();if(i==="ROOT_grid"||/ROOT_absolutelayout$/.exec(i)!==null){return true;}var P=e.getParent();if(P){return false;}return true;};this.setWidthHeight=function(e,f,i){if(f&&e.setWidth){if(f!=="auto"){if(f.indexOf&&f.indexOf("%")>-1){e.setWidth(f);}else{e.setWidth(f+"px");}}else{e.setWidth("auto");}}if(i&&e.setHeight){if(i!=="auto"){if(i.indexOf&&i.indexOf("%")>-1){e.setHeight(i);}else{e.setHeight(i+"px");}}else{e.setHeight("auto");}}};this.setComponentIdForControl=function(e,f){c[e]=f;};this.getComponentIds=function(){var e=[];for(var f in c){if(Object.prototype.hasOwnProperty.call(c,f)){e.push(f);}}return e;};this.removeComponentId=function(e){delete c[e];};this.getComponentIdForControlId=function(e){for(var k in c){if(Object.prototype.hasOwnProperty.call(c,k)&&c[k].getId()===e){return k;}}return null;};this.getControlForId=function(e){for(var k in c){if(Object.prototype.hasOwnProperty.call(c,k)&&c[k].getId()===e){return c[k];}}return null;};this.getComponentIdForControl=function(e){var f=e.getId();return this.getComponentIdForControlId(f);};this.getRootControlForComponentId=function(i){if(c[i]){if(c[i].bIsDestroyed===true){c[i]=null;}}return c[i];};this.getGridInfo=function(G){var e={};e.noOfRows=G.getRows().length;e.noOfCols=G.getRows()[0].getCells().length;e.heights=[];e.widths=G.aWidths;var f=G.getRows();for(var i=0;i<f.length;i++){var j=f[i];var k=j.getHeight();e.heights[i]=k;}return e;};this.findControlById=function(G,i){var e=null;var f=function(j,k,F,J){if(j){if(j.getId&&j.getId()===i){e={control:j,row:k,col:F,contentIndex:J};}var K=t.getHandlers(j.zenControlType);if(K[0].applyForChildren){K[0].applyForChildren(j,f);}}};this.getHandlers(G.zenControlType)[0].applyForChildren(G,f);return e;};this.createDelayedResizeHandler=function(f,i,j,k,F){var S=0;var G=0;var J=null;var K=function(e){J=e;if(S===0){if(f){f(e);}G=window.setInterval(function(){if(i){i(J);}},F);}else{window.clearTimeout(S);}S=window.setTimeout(function(){S=0;window.clearInterval(G);if(j){j(J);}J=null;},k);};return K;};this.registerResizeHandler=function(e,f){a[e]={"handler":f,"obj":e};};this.deregisterResizeHandler=function(e){delete a[e];};this.registerGlobalHandlers=function(){function f(F,e){for(var i in a){if(Object.prototype.hasOwnProperty.call(a,i)){var j=a[i].handler;var k=j[F];if(k){k.call(j,e);}}}}q&&q(window).bind("resize",this.createDelayedResizeHandler(function(e){f("beginResize",e);},function(e){f("updateResize",e);},function(e){f("endResize",e);},300,500));};this.getLogicalParent=function(e){return e.getParent().getParent();};this.disableContextMenu=function(){q(document).bind("contextmenu",function(e){return e.ctrlKey;});};this.prepareCommand=function(T,P,V){V=(V+"").replace(/\\/g,"\\\\");V=V.replace(/'/g,"\\'");V=V.replace(/\r/g,"");V=V.replace(/\n/g,"");if(typeof(sap.zen.dsh.DSH_deployment)!=="undefined"){V=V.replace(/\\/g,"\\\\");V=V.replace(/'/g,"\\'");}V=V.replace(/[$]*/g,"$&$&");return T.replace(P,V);};this.dispatchAdvancedPropertyCall=function(e,f,i,j,k,F){var G=this.getRootControlForComponentId(e);if(G){var J=G.zenControlType;var K=this.getHandlers(J);for(var M in K){if(Object.prototype.hasOwnProperty.call(K,M)){var N=K[M];if(N.advancedPropertyCall){var O=N.advancedPropertyCall(G,f,i,j,k,F);if(O){return O;}}}}}};this.pauseDispatching=function(){d++;};this.resumeDispatching=function(){if(d>0){d--;if(d===0){var f=b;b=null;if(f)f();}}};this.isPaused=function(f){if(d>0){if(b!=null){L.error("Undispatched Delayed Data found "+b);}b=f;return true;}return false;};this.isDispatching=function(){return g;};this.resetDispatcher=function(e){var f="",i;if(this.dshPrefix){f=this.dshPrefix;}if(e===f+"ROOT"){i=this.getRootControlForComponentId(f+"ROOT");if(i){this.dispatchRemove(i);}}if(R){R.que.instance.stopScheduling();i=this.getRootControlForComponentId(f+"ROOT_DIALOG");if(i){this.dispatchRemove(i);}R.que.instance.continueScheduling();}if(e===f+"ROOT"){this.reset();}};function E(){if(sap.zen.dsh.sapbi_page.m_profileMode&&q.sap.measure.getActive()){var e=q.sap.measure.getAllMeasurements();var T=sap.ui.getCore().byId("RenderingStatisticsTree");var M=null;var S="Step"+sapbi_statisticsStepCounter++;var j;if(T){M=T.getModel().getData();M["root"][S]={};M["root"][S]["text"]=S;}for(j=0;j<e.length;j++){var f=e[j];if(f&&f.id.substr(0,3)==="zen"){if(M){var i=f.info.split(":");var F=i[0].split("/");var G=M["root"][S];var J="";for(var k=0;k<F.length;k++){J=F[k];if(!G[J]){G[J]={};G[J]["text"]=J;}G=G[J];}G["text"]=J+": "+f.duration+" ms";}q.sap.measure.remove(f.id);}}if(M){T.getModel().setData(M);var K=sap.ui.getCore().byId("ZEN_PROFILING");K.setMinWidth("50%");K.setMinHeight("50%");var N=q(document.getElementById(K.getId()));var O=N.parent();var P=O.css("top");if(P&&P.charAt(0)==="-"){K.close();setTimeout(function(){K.open();},500);}else{K.open();}}if(sapbi_showUI5Measures){L.info("Other: ");for(j=0;j<e.length;j++){f=e[j];if(f&&f.id.substr(0,3)!=="zen"){q.sap.measure.remove(f.id);}}}}}this.dispatch=function(j,f){g=true;try{if(j.delta){this.dispatchDelta(j.delta);}else if(j.component){this.dispatchCreateControl(j.component,f);}else if(j.control){this.dispatchCreateControl(j.control,f);}E();this.loadCustomCss();if(sap.zen.designmode){if(window.eclipse_sendZenUrl){sap.zen.designmode.DecoratorManager.instance.sendZenUrl("ready");}else{setTimeout(function(){sap.zen.designmode.DecoratorManager.instance.sendZenUrl("ready");},100);}sap.zen.designmode.DecoratorManager.instance.afterDispatching();}}finally{g=false;}};this.sdkDataSources={};this.sdkDsFindInstances=function(e){var f=this.sdkDataSources[e];if(!f){f={};this.sdkDataSources[e]=f;}return f;};this.sdkDsFindEntryForComponent=function(e,f){var i=this.sdkDsFindInstances(f);var j=i[e];if(!j){j={};i[e]=j;}return j;};this.sdkDsFindEntryFor=function(e,P,f){var i=this.sdkDsFindEntryForComponent(e,f);var j=i[P];if(!j){j={data:{dimensions:[]}};i[P]=j;}return j;};this.sdkDsRender=function(e,P,f,S,O){var i=this.sdkDsFindEntryFor(e,P,f);i.selection=S;i.options=O;var j=D.instance.getRootControlForComponentId(f);if(j){var k=j.widget;k.updateDataInto(S,O,i.data);}return i.data;};this.sdkDsRenderMetadata=function(e,P,f,S,O){return this.sdkDsRender(e,P,f,S,O);};this.sdkDsCallFunction=function(e,f,i,j,k){var F=this.getRootControlForComponentId(e);if(F){var G=F.widget;var J=G[f].call(G,i,j,k);G.lastCallbackResult=function(K){if(K===undefined&&J){return JSON.stringify(J);}return null;};G.firePropertiesChanged(["lastCallbackResult"]);}};this.sdkDsUnregister=function(e,f){var i=this.sdkDsFindInstances(f);delete i[e];};this.sdkDsDelete=function(e){delete this.sdkDataSources[e];};this.changeTheme=function(T){var t=this;var e=sap.ui.getCore();var f=e.getConfiguration().getTheme();if(f!==T){var O=function(){t.resumeDispatching();e.detachThemeChanged(O);};this.pauseDispatching();e.attachThemeChanged(O);e.applyTheme(T);}};this.closeContextMenu=function(){if(C){C.close();}};this.registerContextMenu=function(e){C=e;};this.cancelDragDropOperation=function(){var e;if(h){this.setDragDropCanceled(true);q.each(o,function(f,i){e=t.getControlForId(f);if(e){setTimeout(function(){i.call(e);},0);}});}};this.registerEscKeyHandler=function(){if(!n){q(document).on("keydown",function(e){if(e.which===27){t.cancelDragDropOperation();}});n=true;}};this.setDragDropCanceled=function(e){if(h){h.bDragOperationCanceled=e;}};this.isDragDropCanceled=function(){if(h){return h.bDragOperationCanceled;}return true;};this.registerDragDropCancelHandler=function(e,f){this.registerEscKeyHandler();o[e]=f;};this.deRegisterDragDropCancelHandler=function(e){delete o[e];};this.registerUnhandledDropHandler=function(e,f){u[e]=f;};this.deRegisterUnhandledDropHandler=function(e){delete UnhandledDropHandlerRegistry[e];};this.setDragDropPayload=function(P){h=P;};this.getDragDropPayload=function(){return h;};this.onUnhandledDrop=function(e,f){if(h){var i=u[h.sComponentId];if(i){var S=t.getControlForId(h.sComponentId);if(S){i.call(S,e,f,h);}}}};this.setInterComponentDragDropEnabled=function(e){p=e;};this.isInterComponentDragDropEnabled=function(){return p;};this.createDragDropPayload=function(e){h={"sComponentId":e,"oDragDropInfo":{"sDimensionName":"","sAttributeName":"","sAxisName":"","bIsMeasureStructure":false,"bIsMemberDrag":false,"iMemberRow":-1,"iMemberCol":-1},"oInterComponentAcceptStatus":{},"bDragOperationCanceled":false};return h;};this.setDropAccepted=function(e,f){if(h){h.oInterComponentAcceptStatus[e]=f;}};this.isDropAcceptedForDroppable=function(e){if(h){return h.oInterComponentAcceptStatus[e];}return false;};this.mainMode=false;this.setMainMode=function(M){this.mainMode=M;};this.isMainMode=function(){return this.mainMode;};this.bCompactMode=false;this.setCompactMode=function(e){if(!q(document.body).hasClass("sapUiSizeCozy")){if(e){q(document.body).addClass("sapUiSizeCompact");}else{q(document.body).removeClass("sapUiSizeCompact");}}this.bCompactMode=e;};this.isCompactMode=function(){return this.bCompactMode;};this.sCustomCssUrl=null;this.bCustomCssLoaded=false;this.registerCustomCSS=function(e){this.sCustomCssUrl=e;};this.customCssExists=function(){return this.sCustomCssUrl!==null&&this.sCustomCssUrl!=="";};this.loadCustomCss=function(){if(!this.bCustomCssLoaded&&this.customCssExists()){sap.zen.dsh.sapbi_page.loadCssInclude(this.sCustomCssUrl);this.bCustomCssLoaded=true;}};};D.instance=new D();D.instance.registerGlobalHandlers();return D.instance;});
