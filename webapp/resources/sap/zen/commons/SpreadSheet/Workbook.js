/*!
 * SAPUI5
  (c) Copyright 2009-2020 SAP SE. All rights reserved
 */
sap.ui.define("sap/zen/commons/SpreadSheet/Workbook",["sap/zen/commons/thirdparty/xlsx-protobi"],function(X){function W(){var t=this;t.SheetNames=[];t.Sheets={};t.allowStyles=true;t.formatIndexMap={};t.formatIndex=164;t.addWorksheet=function(s){var l={};t.SheetNames.push(s);t.Sheets[s]=l;l.curRow=-1;l.maxRow=-1;l.maxCol=-1;l["!merges"]=[];return l;};t.closeWorkSheet=function(x){var l=t.getRange(0,0,x.maxRow+1,x.maxCol+1);x["!ref"]=X.utils.encode_range(l);};t.getRow=function(x,r){var l={};l.ws=x;l.row=r;l.curCol=-1;return l;};t.createRow=function(x){x.curRow++;var l=t.getRow(x,x.curRow);if(x.curRow>x.maxRow){x.maxRow=x.curRow;}return l;};t.getCell=function(x,c){var l={};l.ws=x.ws;l.row=x.row;l.column=c;var a=t.getCellRef(l.row,l.column);x.ws[a]=l;return l;};t.getCellRef=function(r,c){var l=X.utils.encode_cell({r:r,c:c});return l.toString();};t.addCell=function(x){x.curCol++;var l=t.getCell(x,x.curCol);if(x.curCol>x.ws.maxCol){x.ws.maxCol=x.curCol;}return l;};t.copyCell=function(x,o){if(x.s){o.s=x.s;}if(x.v){o.v=x.v;}if(x.t){o.t=x.t;}if(x.f){o.f=x.f;}if(x.z){o.z=x.z;}if(x.w){o.w=x.w;}};t.mergeCell=function(x,r,c){var l=r,a=c;if(l<1){l=1;}if(a<1){a=1;}var b=t.getRange(x.row,x.column,x.row+l-1,x.column+a-1);if(l>1||a>1){x.ws["!merges"].push(b);}var d=null,e=null,i=0;for(i=1;i<l;i++){d=t.getRow(x.ws,x.row+i);e=t.getCell(d,x.column);t.copyCell(x,e);}for(i=1;i<a;i++){d=t.getRow(x.ws,x.row);e=t.getCell(d,x.column+i);t.copyCell(x,e);}};t.getRange=function(f,a,b,c){return{s:{r:f,c:a},e:{r:b,c:c}};};t.setCell=function(x,c){if(x.row>x.ws.maxRow){x.ws.maxRow=x.row;}if(x.column>x.ws.maxCol){x.ws.maxCol=x.column;}var l="FFDCE6F0";var a="FFCCCCCC";var b="FFE5E5E5";var d="FFFFFF00";var e="Calibri";var f=11;var g="top";var h="left";var i={style:"medium",color:{rgb:a}};var j={top:i,bottom:i,left:i,right:i};var k={font:{name:e,sz:f,bold:false},alignment:{vertical:g,horizontal:h,wrapText:false,indent:0}};var m={font:{name:e,sz:f,bold:false},alignment:{vertical:g,horizontal:h,wrapText:false,indent:0},border:j};var n={font:{name:e,sz:f,bold:false},fill:{fgColor:{rgb:l}},alignment:{vertical:g,horizontal:h,wrapText:false,indent:0},border:j};var o={font:{name:e,sz:f,bold:false},fill:{fgColor:{rgb:b}},alignment:{vertical:g,horizontal:h,wrapText:false,indent:0},border:j};var p={font:{name:e,sz:f,bold:false},fill:{fgColor:{rgb:d}},alignment:{vertical:g,horizontal:h,wrapText:false,indent:0},border:j};if(c.getStyle().toString()!=="NONE"&&t.allowStyles===true){if(c.getStyle().toString()==="GROUP"){x.s=n;}else if(c.getStyle().toString()==="HEADER"){x.s=o;}else if(c.getStyle().toString()==="TOTAL"){x.s=p;}else{x.s=m;}}else{x.s=k;}x.v=c.getFormattedValue();x.t="s";x.s.alignment.horizontal="left";if(c.getValueType().toString()==="NUMBER"||c.getValueType().toString()==="NUMBER_AS_STRING"){x.s.alignment.horizontal="right";if(c.getValueType().toString()==="NUMBER"){x.v=c.getValue();x.t="n";}}else if(c.getValueType().toString()==="DATE"){x.v=c.getValue();x.t="d";}if(c.getFormula()){x.f=c.getFormula();}if(c.getValueType().toString()==="NUMBER_AS_STRING"){c.setFormatString(null);}if(c.getValueType().toString()==="NUMBER"){x.s.numFmt=c.getFormatString();}if(c.getFormatString()!=null&&c.getFormatString().length>0){x.z=c.getFormatString();var q=t.formatIndexMap[c.getFormatString()];if(!q){while(X.SSF.get_table()[t.formatIndex]){t.formatIndex++;}q=t.formatIndex;t.formatIndexMap[c.getFormatString()]=q;t.formatIndex++;X.SSF.load(c.getFormatString(),q);}x.z=X.SSF.get_table()[q];X.utils.format_cell(x);}else{x.w=c.getFormattedValue();}t.mergeCell(x,c.getRowSpan(),c.getColSpan());};t.save=function(a){var l=t.getAsBinary();var b=new Blob([l],{type:"application/octet-stream"});var c=URL.createObjectURL(b);var s=(function(){var d=document.createElement("a");document.body.appendChild(d);d.style="display: none";return function(c,a){d.href=c;d.download=a;d.click();};}());if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(b,a);}else{s(c,a);}var f=function(){window.URL.revokeObjectURL(c);};setTimeout(f,1);};t.getAsBinary=function(){var l=X.write(t,{bookType:"xlsx",bookSST:true,type:"binary",cellDates:true});function s(b){var a=new ArrayBuffer(b.length);var c=new Uint8Array(a);for(var i=0;i!=b.length;++i){c[i]=b.charCodeAt(i)&0xFF;}return a;}var a=s(l);return a;};}return W;});
