/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2021 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/fe/macros/ResourceModel","sap/ui/model/odata/v4/AnnotationHelper","sap/base/Log","sap/fe/core/CommonUtils","sap/fe/navigation/SelectionVariant","sap/fe/core/helpers/StableIdHelper","sap/fe/core/helpers/ModelHelper","sap/ui/model/Context","sap/ui/Device","sap/m/library"],function(R,O,L,C,S,a,M,b,D,m){"use strict";var V=m.ValueColor;var H={getPathToKey:function(c){return c.getObject();},isVisible:function(t,i){var o=i.context.getModel(),p=i.context.getPath(),A=o.getObject(p+"@"),h=A["@com.sap.vocabularies.UI.v1.Hidden"];return typeof h==="object"?"{= !${"+h.$Path+"} }":!h;},isDialog:function(A,i){var o=i.context.getModel(),p=i.context.getPath(),c=o.getObject(p+"/@$ui5.overload@com.sap.vocabularies.Common.v1.IsActionCritical");if(c){return"Dialog";}else if(A){var d=Array.isArray(A)?A[0]:A;if(d.$Parameter&&d.$Parameter.length>1){return"Dialog";}else{return"None";}}},getParameterEditMode:function(t,i){var o=i.context.getModel(),p=i.context.getPath(),A=o.getObject(p+"@"),f=A["@com.sap.vocabularies.Common.v1.FieldControl"],c=A["@Org.OData.Core.V1.Immutable"],d=A["@Org.OData.Core.V1.Computed"];if(f&&f.$Path){if(f.$Path==="ReadOnly"){return sap.ui.mdc.enum.EditMode.ReadOnly;}else{return("{= %{"+f.$Path+"} ? "+"'"+sap.ui.mdc.enum.EditMode.ReadOnly+"'"+" : "+"'"+sap.ui.mdc.enum.EditMode.Editable+"'"+" }");}}if(f&&f.$EnumMember){if(f.$EnumMember==="com.sap.vocabularies.Common.v1.FieldControlType/ReadOnly"){return sap.ui.mdc.enum.EditMode.ReadOnly;}}if(c||d){return sap.ui.mdc.enum.EditMode.ReadOnly;}return sap.ui.mdc.enum.EditMode.Editable;},getMetaPath:function(t,i){return(i&&i.context&&i.context.getPath())||undefined;},isDesktop:function(){return D.system.desktop===true;},getTargetCollection:function(c,n){var p=c.getPath(),P,e,d;if(c.getMetadata().getName()==="sap.ui.model.Context"&&(c.getObject("$kind")==="EntitySet"||c.getObject("$ContainsTarget")===true)){return p;}if(c.getModel){p=(c.getModel().getMetaPath&&c.getModel().getMetaPath(p))||c.getModel().getMetaModel().getMetaPath(p);}P=p.split("/").filter(function(s){return s&&s!="$Type";});e="/"+P[0];if(P.length===1){return e;}d=n===undefined?P.slice(1).join("/$NavigationPropertyBinding/"):n;return e+"/$NavigationPropertyBinding/"+d;},isPropertyFilterable:function(p,i,d){var o=i.context.getModel(),P=i.context.getPath(),s=H.getLocationForPropertyPath(o,P),c=P.replace(s+"/","");if(d&&(d.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"||d.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation")){return false;}return C.isPropertyFilterable(o,s,c);},getLocationForPropertyPath:function(o,p){var l;var c=p.slice(0,p.lastIndexOf("/"));if(o.getObject(c+"/$kind")==="EntityContainer"){l=c.length+1;c=p.slice(l,p.indexOf("/",l));}return c;},gotoActionParameter:function(c){var p=c.getPath(),P=c.getObject(p+"/$Name");var s;if(p.indexOf("@$ui5.overload")>-1){s=p.split("@$ui5.overload")[0];}else{var A=p.split("/0/")[0].split(".");s="/"+A[A.length-1]+"/";}return s+P;},getEntitySetName:function(o,e){var E=o.getObject("/");for(var k in E){if(typeof E[k]==="object"&&E[k].$Type===e){return k;}}},getActionPath:function(A,r,s,c){var d=A.getPath().split("/@")[0];s=!s?A.getObject(A.getPath()):s;if(s&&s.indexOf("(")>-1){s=s.split("(")[0];}else{var e=A.getObject(d).$Type;var E=this.getEntitySetName(A.getModel(),e);if(E){d="/"+E;}}if(c){return A.getObject(d+"/"+s+"@Org.OData.Core.V1.OperationAvailable");}if(r){return d+"/"+s;}else{return{sContextPath:d,sProperty:A.getObject(d+"/"+s+"@Org.OData.Core.V1.OperationAvailable/$Path"),sBindingParameter:A.getObject(d+"/"+s+"/@$ui5.overload/0/$Parameter/0/$Name")};}},getEditMode:function(A,d,f,e,c,u,E,p){if(e==="Display"||e==="ReadOnly"||e==="Disabled"){return e;}var g,i,s,h,j,k,F,l,n,I,o,q=E&&E.$Key.indexOf(p)>-1;if(d==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"||(A&&A["@com.sap.vocabularies.Common.v1.SemanticObject"]&&!(A["@com.sap.vocabularies.Common.v1.ValueListReferences"]||A["@com.sap.vocabularies.Common.v1.ValueListMapping"]||A["@com.sap.vocabularies.Common.v1.ValueList"]||A["@com.sap.vocabularies.Common.v1.ValueListWithFixedValues"]))){return"Display";}if(A&&A["@Org.OData.Core.V1.Computed"]){g=A["@Org.OData.Core.V1.Computed"].Bool?A["@Org.OData.Core.V1.Computed"].Bool=="true":true;}if(A&&A["@Org.OData.Core.V1.Immutable"]){i=A["@Org.OData.Core.V1.Immutable"].Bool?A["@Org.OData.Core.V1.Immutable"].Bool=="true":true;}if(q&&!g&&i){return"{= %{@$ui5.context.isTransient} === true ? 'Editable' : 'Display'}";}j=g||i||q;if(c&&c.indexOf("{")===0){c="$"+c;}n=typeof g==="undefined"?typeof i==="undefined":!g;if(f){if(f.indexOf("{")===0){I="$"+f+" === '1'";o="$"+f+" === '0'";}else{j=j||f=="com.sap.vocabularies.Common.v1.FieldControlType/ReadOnly";}}var r;var t;var v;var w;if(I){w=e==="Editable"?"'ReadOnly'":"$"+e+" === 'Editable' ? 'ReadOnly'  : 'Display'";if(n){t=e==="Editable"?c+" ? 'Editable' : 'ReadOnly'":"$"+e+" === 'Editable' ? "+c+"? 'Editable' : 'ReadOnly'  : 'Display'";v=e==="Editable"?"'Disabled'":"$"+e+" === 'Editable' ? 'Disabled' : 'Display'";}else{t=e==="Editable"?"'ReadOnly'":"$"+e+" === 'Editable' ? 'ReadOnly' : 'Display'";v=e==="Editable"?"'Disabled'":"$"+e+" === 'Editable' ? 'Disabled' : 'Display'";}}else{t="'Display'";v="'Display'";w="'Display'";}k=e&&e.indexOf("{")===0?"$"+e:"'"+e+"'";if(j){if(!n){if(e&&e.indexOf("{")===0){return"{= "+t+"}";}t=t.split("'")&&t.split("'")[1];return t;}else{if(I){if(c&&c.indexOf("$")===0){return("{= "+c+" ? ("+o+"? "+"'Disabled'"+" : "+I+"? "+"'ReadOnly'"+" : "+k+") : "+t+"}");}else if(c=="true"){return("{= "+o+"? "+"'Disabled'"+" : "+I+"? "+"'ReadOnly'"+" : "+"${ui>/editMode} === 'Editable'"+"}");}else{return"{= "+t+"}";}}else if(f=="com.sap.vocabularies.Common.v1.FieldControlType/ReadOnly"){k="'ReadOnly'";}if(c&&c.indexOf("$")===0){return"{= "+c+" ?"+"${ui>/editMode} === 'Editable'"+" : "+t+"}";}else if(c=="true"){return"{= "+k+"}";}else{return"{= "+t+"}";}}}if(I){if(u&&u.indexOf("{")===0){k="$"+u+" === '1' ? 'EditableReadOnly' : "+k;}else if(u==="com.sap.vocabularies.Common.v1.FieldControlType/ReadOnly"){k="EditableReadOnly";}s=o+" ? "+v+" :"+I+" ? "+w+" :"+k;r="{= "+s+"}";}else if(u&&(u.indexOf("{")===0||u==="com.sap.vocabularies.Common.v1.FieldControlType/ReadOnly")){F=u.indexOf("{")===0?"$"+u+" === '1'":undefined;l=e==="Editable"?"'EditableReadOnly'":"$"+e+" === 'Editable' ? 'EditableReadOnly' : 'Display'";if(F){s=F+" ? "+l+" :"+k;}else{s=l;}r="{= "+s+"}";}else{s=k;r=e;}var x;if(c&&c.indexOf("$")===0){x="{= "+c+" ? "+t+" : "+s+"}";}else if(c=="true"){x="{= "+t+"}";}else{x="{= "+s+"}";}h=n?r:x;return h;},getNavigationContext:function(c){return O.getNavigationPath(c.getPath());},getNavigationPath:function(p,k){var s=p.startsWith("/");var P=p.split("/").filter(function(c){return!!c;});if(s){P.shift();}if(!k){P.pop();}return P.join("/");},getActionContext:function(A){return H.getActionPath(A,true);},getPathToBoundActionOverload:function(A){var p=H.getActionPath(A,true);return p+"/@$ui5.overload/0";},addSingleQuotes:function(v){return"'"+v+"'";},generateFunction:function(f){var p="";for(var i=1;i<arguments.length;i++){p+=arguments[i];if(i<arguments.length-1){p+=", ";}}var F=f+"()";if(p){F=f+"("+p+")";}return F;},getHeaderDataPointLinkVisibility:function(p,l,f){var v;if(f){v=l?"{= ${internal>isHeaderDPLinkVisible/"+p+"} === true && "+f+"}":"{= ${internal>isHeaderDPLinkVisible/"+p+"} !== true && "+f+"}";}else{v=l?"{= ${internal>isHeaderDPLinkVisible/"+p+"} === true}":"{= ${internal>isHeaderDPLinkVisible/"+p+"} !== true}";}return v;},objectToString:function(p){var n=Object.keys(p).length,P="";for(var k in p){var v=p[k];if(v&&typeof v==="object"){v=this.objectToString(v);}P+=k+": "+v;if(n>1){--n;P+=", ";}}var o="{ "+P+"}";return o;},removeEscapeCharacters:function(e){return e?e.replace(/\\?\\([{}])/g,"$1"):undefined;},stringifyObject:function(s){if(!s){return undefined;}else{var o=JSON.parse(s);if(typeof o==="object"&&!Array.isArray(o)){var u={ui5object:true};Object.assign(u,o);return JSON.stringify(u);}else{var t=Array.isArray(o)?"Array":typeof o;L.error("Unexpected object type in stringifyObject ("+t+") - only works with object");throw new Error("stringifyObject only works with objects!");}}},stringifyCustomData:function(d){var o={ui5object:true};o["customData"]=d instanceof b?d.getObject():d;return JSON.stringify(o);},parseCustomData:function(d){var d=typeof d==="string"?JSON.parse(d):d;if("customData"in d){return d["customData"];}return d;},_getDraftAdministrativeDataType:function(o,e){return o.requestObject("/"+e+"/DraftAdministrativeData/");},getPopoverText:function(c,e){return H._getDraftAdministrativeDataType(c.getModel(),e).then(function(d){var B="{parts: [{path: 'HasDraftEntity', targetType: 'any'}, "+"{path: 'DraftAdministrativeData/InProcessByUser'}, "+"{path: 'DraftAdministrativeData/LastChangedByUser'} ";if(d.InProcessByUserDescription){B+=" ,{path: 'DraftAdministrativeData/InProcessByUserDescription'}";}if(d.LastChangedByUserDescription){B+=", {path: 'DraftAdministrativeData/LastChangedByUserDescription'}";}B+="], formatter: 'sap.fe.macros.field.FieldRuntime.formatDraftOwnerTextInPopover'}";return B;});},getContextPath:function(v,i){return i&&i.context&&i.context.getPath();},getSortConditions:function(p,P){if(p&&this._isPresentationVariantAnnotation(P)&&p.SortOrder){var s={sorters:[]};p.SortOrder.forEach(function(c){var o={};o.name=c.Property.$PropertyPath;o.descending=!!c.Descending;s.sorters.push(o);});return JSON.stringify(s);}return undefined;},_isPresentationVariantAnnotation:function(A){return(A.indexOf("@com.sap.vocabularies.UI.v1.PresentationVariant")>-1||A.indexOf("@com.sap.vocabularies.UI.v1.SelectionPresentationVariant")>-1);},createPresentationPathContext:function(p){var P=p.sPath.split("@")||[];var o=p.getModel();if(P.length&&P[P.length-1].indexOf("com.sap.vocabularies.UI.v1.SelectionPresentationVariant")>-1){var s=p.sPath.split("/PresentationVariant")[0];return o.createBindingContext(s+"@sapui.name");}return o.createBindingContext(p.sPath+"@sapui.name");},getPressHandlerForDataFieldForIBN:function(d,c,n){var N={navigationContexts:c?c:"${$source>/}.getBindingContext()"};if(d.RequiresContext&&!d.Inline&&n){N.applicableContexts="${internal>ibn/"+d.SemanticObject+"-"+d.Action+"/aApplicable/}";N.notApplicableContexts="${internal>ibn/"+d.SemanticObject+"-"+d.Action+"/aNotApplicable/}";N.label="'"+d.Label+"'";}if(d.Mapping){N.semanticObjectMapping=this.addSingleQuotes(JSON.stringify(d.Mapping));}return this.generateFunction(n?"._intentBasedNavigation.navigateWithConfirmationDialog":"._intentBasedNavigation.navigate",this.addSingleQuotes(d.SemanticObject),this.addSingleQuotes(d.Action),this.objectToString(N));},getEntitySet:function(c){var p=c.getPath();return M.getEntitySetPath(p);},_isRatingIndicator:function(c){if(c.isA("sap.fe.core.controls.FieldWrapper")){var v=Array.isArray(c.getContentDisplay())?c.getContentDisplay()[0]:c.getContentDisplay();if(v&&v.isA("sap.m.RatingIndicator")){return true;}}return false;},_updateStyleClassForRatingIndicator:function(f,l){var c=Array.isArray(f.getContentDisplay())?f.getContentDisplay()[0]:f.getContentDisplay();var v=Array.isArray(f.getContentEdit())?f.getContentEdit()[0]:f.getContentEdit();if(l){c.addStyleClass("sapUiNoMarginBottom");c.addStyleClass("sapUiNoMarginTop");v.removeStyleClass("sapUiTinyMarginBottom");}else{c.addStyleClass("sapUiNoMarginBottom");c.removeStyleClass("sapUiNoMarginTop");v.addStyleClass("sapUiTinyMarginBottom");}},handleVisibilityOfMenuActions:function(v){var c=[];if(Array.isArray(v)){for(var i=0;i<v.length;i++){if(v[i].split("{=").length>0){v[i]=v[i].split("{=")[1].slice(0,-1);}c.push("("+v[i]+")");}}return c.length>0?"{= "+c.join(" || ")+"}":v;},getCriticalityCalculationBinding:function(i,v,d,t,A,s,T,c){var e=V.Neutral;v="%"+v;d=d||-Infinity;t=t||d;A=A||t;c=c||Infinity;T=T||c;s=s||T;d=d&&(+d?+d:"%"+d);t=t&&(+t?+t:"%"+t);A=A&&(+A?+A:"%"+A);s=s&&(+s?+s:"%"+s);T=T&&(+T?+T:"%"+T);c=c&&(+c?+c:"%"+c);if(i.indexOf("Minimize")>-1){e="{= "+v+" <= "+s+" ? '"+V.Good+"' : "+v+" <= "+T+" ? '"+V.Neutral+"' : "+"("+c+" && "+v+" <= "+c+") ? '"+V.Critical+"' : '"+V.Error+"' }";}else if(i.indexOf("Maximize")>-1){e="{= "+v+" >= "+A+" ? '"+V.Good+"' : "+v+" >= "+t+" ? '"+V.Neutral+"' : "+"("+d+" && "+v+" >= "+d+") ? '"+V.Critical+"' : '"+V.Error+"' }";}else if(i.indexOf("Target")>-1){e="{= ("+v+" <= "+s+" && "+v+" >= "+A+") ? '"+V.Good+"' : "+"(("+v+" >= "+t+" && "+v+" < "+A+") || ("+v+" > "+s+" && "+v+" <= "+T+")) ? '"+V.Neutral+"' : "+"(("+d+" && ("+v+" >= "+d+") && ("+v+" < "+t+")) || (("+v+" > "+T+") && "+c+" && ("+v+" <= "+c+"))) ? '"+V.Critical+"' : '"+V.Error+"' }";}else{L.warning("Case not supported, returning the default Value Neutral");}return e;},_getCriticalityFromEnum:function(c){var i;if(c==="com.sap.vocabularies.UI.v1.CriticalityType/Negative"){i=V.Error;}else if(c==="com.sap.vocabularies.UI.v1.CriticalityType/Positive"){i=V.Good;}else if(c==="com.sap.vocabularies.UI.v1.CriticalityType/Critical"){i=V.Critical;}else{i=V.Neutral;}return i;},getValueCriticality:function(d,v){var r,c=[];if(v&&v.length>0){v.forEach(function(o){if(o.Value&&o.Criticality.$EnumMember){var s="${"+d+"} === '"+o.Value+"' ? '"+H._getCriticalityFromEnum(o.Criticality.$EnumMember)+"'";c.push(s);}});r=c.length>0&&c.join(" : ")+" : undefined";}return r?"{= "+r+" }":undefined;},getMeasureAttributeIndex:function(i,c){var d=c.Measures,e,f=c.MeasureAttributes,s=d&&d[i]&&d[i].$PropertyPath,g=-1,h=function(j,o,k){if((o&&o.Measure&&o.Measure.$PropertyPath)===j){g=k;return true;}};if(f){e=f.some(h.bind(null,s));}return e&&g>-1&&g;},getMeasureAttributeForMeasure:function(c){var o=c.getModel(),s=c.getPath(),d=s.substring(0,s.lastIndexOf("Measure")),i=s.replace(/.*\//,"");return o.requestObject(d).then(function(e){var f=e.MeasureAttributes,g=H.getMeasureAttributeIndex(i,e);var h=g>-1&&f[g]&&f[g].DataPoint?d+"MeasureAttributes/"+g+"/":L.warning("DataPoint missing for the measure")&&undefined;return h?h+"DataPoint/$AnnotationPath/":h;});},isDraftParentEntityForContainment:function(t,T){if(t){if(T&&T.parentEntitySet&&T.parentEntitySet.sPath){var p=T.parentEntitySet.sPath;var d=T.parentEntitySet.oModel.getObject(p+"@com.sap.vocabularies.Common.v1.DraftRoot");var o=T.parentEntitySet.oModel.getObject(p+"@com.sap.vocabularies.Common.v1.DraftNode");if(d||o){return true;}else{return false;}}}else{return false;}},getDataFromTemplate:function(d){var s=d.getPath().split("/");var c=s[s.length-1];var e="/"+s.slice(1,-2).join("/")+"/@";var f=d.getObject(e);var t=f.Template;var g=t.split("}");var h=[];for(var i=0;i<g.length-1;i++){var k=g[i].split("{")[1].trim();h.push(k);}var j=Object.keys(f.Data).indexOf(c)-1;return"/"+s.slice(1,-2).join("/")+"/Data/"+h[j];},notLastIndex:function(t,e){var c=t.Template;var s=c.split("}");var d=[];var f=false;for(var i=0;i<s.length-1;i++){var g=s[i].split("{")[1].trim();d.push(g);}d.forEach(function(c){if(t.Data[c]===e&&d.indexOf(c)!==d.length-1){f=true;}});return f;},getDelimiter:function(t){return t.split("}")[1].split("{")[0].trim();},getParameters:function(c,i){if(c){var o=i.context.getModel();var p=i.context.getPath();var P=C.getParameterInfo(o,p);if(P.parameterProperties){return Object.keys(P.parameterProperties);}}return[];}};H.isPropertyFilterable.requiresIContext=true;H.getPopoverText.requiresIContext=true;return H;},true);
