/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2021 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/mdc/odata/v4/TableDelegate","sap/ui/core/Core","sap/ui/mdc/util/FilterUtil","sap/ui/mdc/odata/v4/util/DelegateUtil","sap/ui/mdc/odata/v4/FilterBarDelegate","sap/ui/mdc/odata/v4/ODataMetaModelUtil","sap/ui/mdc/odata/v4/TypeUtil","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/base/Log","sap/fe/macros/DelegateUtil","sap/fe/core/helpers/ModelHelper"],function(T,C,F,D,a,O,b,c,d,L,M,e){"use strict";var f=Object.assign({},T);f.fetchProperties=function(t){var m=this._getModel(t);var p;if(!m){p=new Promise(function(r){t.attachModelContextChange({resolver:r},o,this);}.bind(this)).then(function(m){return this._createPropertyInfos(t,m);}.bind(this));}else{p=this._createPropertyInfos(t,m);}return p.then(function(P){if(t.data){t.data("$tablePropertyInfo",P);}return P;});};function o(E,g){var t=E.getSource();var m=this._getModel(t);if(m){t.detachModelContextChange(o);g.resolver(m);}}f._createPropertyInfos=function(t,m){var g=t.getDelegate().payload;var p=[];var E="/"+g.collectionName;var h=m.getMetaModel();return h.requestObject(E+"@").then(function(i){var s=i["@Org.OData.Capabilities.V1.SortRestrictions"]||{};var S=O.getSortRestrictionsInfo(s);var j=i["@Org.OData.Capabilities.V1.FilterRestrictions"];var k=O.getFilterRestrictionsInfo(j);var l=M.getCustomData(t,"columns");l.customData.forEach(function(n){p.push({name:n.path,path:n.path,label:n.label,sortable:S[n.path]?S[n.path].sortable:n.sortable,filterable:k[n.path]?k[n.path].filterable:n.filterable,typeConfig:M.isTypeFilterable(n.$Type)?t.getTypeUtil().getTypeConfig(n.$Type):undefined,maxConditions:O.isMultiValueFilterExpression(k.propertyInfo[n.path])?-1:1});});return p;});};f.updateBindingInfo=function(m,g,B){T.updateBindingInfo.apply(this,[m,g,B]);if(!m){return;}if(g&&B){B.path=B.path||g.collectionPath||"/"+g.collectionName;B.model=B.model||g.model;}if(!B){B={};}var h=C.byId(m.getFilter()),i=m.isFilteringEnabled(),j;var I,k;var l=[];var t=m.data("$tablePropertyInfo");if(i){j=m.getConditions();I=F.getFilterInfo(m,j,t);if(I.filters){l.push(I.filters);}}if(h){j=h.getConditions();if(j){var p=D.getParameterNames(h);k=F.getFilterInfo(h,j,t,p);if(k.filters){l.push(k.filters);}var P=D.getParametersInfo(h,j);if(P){B.path=P;}}B.parameters.$search=h.getSearch()||undefined;}B.parameters.$select=t.reduce(function(q,n){if(n.path&&n.path.indexOf("/")===-1){q=q?q+","+n.path:n.path;}return q;},"");if(e.isDraftSupported(m.getModel().getMetaModel(),B.path)){l.push(new c("IsActiveEntity",d.EQ,true));}B.filters=new c(l,true);};f.getFilterDelegate=function(){return a;};f.getTypeUtil=function(p){return b;};f._getModel=function(t){var m=t.getDelegate().payload;return t.getModel(m.model);};return f;});
