/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/helpers/ClassSupport","sap/fe/core/helpers/PasteHelper","sap/m/MessageBox","sap/ui/Device","sap/base/Log","./MacroAPI","sap/fe/macros/massedit/MassEditHandler","sap/fe/macros/DelegateUtil"],function(C,P,M,D,L,a,b,c){"use strict";var _,d,f,g,h,j,k,l,m,n,q,r,s,t,u,v,w,x,y,z,A,B,E,F,G,H,I,J,K,N,O,Q,R,S;var T=C.Event;var U=C.Property;var V=C.MacroContext;var W=C.EventHandler;var X=C.APIClass;function Y(e,p,i,o){if(!i)return;Object.defineProperty(e,p,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(o):void 0});}function Z(i,e){if(!(i instanceof e)){throw new TypeError("Cannot call a class as a function");}}function $(e,p){for(var i=0;i<p.length;i++){var o=p[i];o.enumerable=o.enumerable||false;o.configurable=true;if("value"in o)o.writable=true;Object.defineProperty(e,o.key,o);}}function a1(e,p,i){if(p)$(e.prototype,p);if(i)$(e,i);return e;}function b1(e,i){if(typeof i!=="function"&&i!==null){throw new TypeError("Super expression must either be null or a function");}e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:true,configurable:true}});if(i)c1(e,i);}function c1(o,p){c1=Object.setPrototypeOf||function c1(o,p){o.__proto__=p;return o;};return c1(o,p);}function d1(e){var i=g1();return function n1(){var o=h1(e),p;if(i){var m1=h1(this).constructor;p=Reflect.construct(o,arguments,m1);}else{p=o.apply(this,arguments);}return e1(this,p);};}function e1(e,i){if(i&&(typeof i==="object"||typeof i==="function")){return i;}return f1(e);}function f1(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return e;}function g1(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}function h1(o){h1=Object.setPrototypeOf?Object.getPrototypeOf:function h1(o){return o.__proto__||Object.getPrototypeOf(o);};return h1(o);}function i1(o,e,i){if(e in o){Object.defineProperty(o,e,{value:i,enumerable:true,configurable:true,writable:true});}else{o[e]=i;}return o;}function j1(e,p,i,o,m1){var n1={};Object.keys(o).forEach(function(o1){n1[o1]=o[o1];});n1.enumerable=!!n1.enumerable;n1.configurable=!!n1.configurable;if('value'in n1||n1.initializer){n1.writable=true;}n1=i.slice().reverse().reduce(function(n1,o1){return o1(e,p,n1)||n1;},n1);if(m1&&n1.initializer!==void 0){n1.value=n1.initializer?n1.initializer.call(m1):void 0;n1.initializer=undefined;}if(n1.initializer===void 0){Object.defineProperty(e,p,n1);n1=null;}return n1;}function k1(e,i){throw new Error('Decorating class property failed. Please ensure that '+'proposal-class-properties is enabled and runs after the decorators transform.');}var l1=(_=X("sap.fe.macros.TableAPI"),d=V(),f=U({type:"boolean"}),g=U({type:"string"}),h=U({type:"boolean",defaultValue:false}),j=U({type:"string",defaultValue:"ResponsiveTable"}),k=U({type:"boolean",defaultValue:true}),l=U({type:"boolean",defaultValue:false}),m=U({type:"boolean",defaultValue:false}),n=U({type:"string"}),q=U({type:"string"}),r=U({type:"boolean",defaultValue:false}),s=U({type:"boolean",defaultValue:true}),t=U({type:"boolean|string",defaultValue:true}),u=U({type:"string"}),v=U({type:"boolean"}),_(w=(x=function(e){b1(l1,e);var i=d1(l1);function l1(){var o;Z(this,l1);for(var p=arguments.length,m1=new Array(p),n1=0;n1<p;n1++){m1[n1]=arguments[n1];}o=i.call.apply(i,[this].concat(m1));Y(f1(o),"tableDefinition",y,f1(o));Y(f1(o),"readOnly",z,f1(o));Y(f1(o),"id",A,f1(o));Y(f1(o),"busy",B,f1(o));Y(f1(o),"type",E,f1(o));Y(f1(o),"enableExport",F,f1(o));Y(f1(o),"enablePaste",G,f1(o));Y(f1(o),"enableFullScreen",H,f1(o));Y(f1(o),"selectionMode",I,f1(o));Y(f1(o),"header",J,f1(o));Y(f1(o),"enableAutoColumnWidth",K,f1(o));Y(f1(o),"headerVisible",N,f1(o));Y(f1(o),"rowPress",O,f1(o));Y(f1(o),"personalization",Q,f1(o));Y(f1(o),"variantManagement",R,f1(o));Y(f1(o),"enableDataStateFilter",S,f1(o));return o;}a1(l1,[{key:"onTableRowPress",value:function o1(o,p,m1,n1){if(m1&&m1.isA("sap.ui.model.odata.v4.Context")&&typeof m1.getProperty("@$ui5.node.isExpanded")==="boolean"){return false;}else{p._routing.navigateForwardToContext(m1,n1);}}},{key:"onInternalDataReceived",value:function p(o){if(o.getParameter("error")){this.getController().messageHandler.showMessageDialog();}}},{key:"onPaste",value:function r1(o,p){var m1=this;if(!this.tableDefinition.control.enablePaste||!this.getModel("ui").getProperty("/isEditable")){return;}var n1=o.getParameter("data"),o1=o.getSource(),p1=o1.data()["enablePaste"];var q1;if(p1===true||p1==="true"){P.parseDataForTablePaste(n1,o1).then(function(s1){if(s1&&s1.length>0){return p._editFlow.createMultipleDocuments(o1.getRowBinding(),s1,m1.tableDefinition.control.createAtEnd,true);}}).catch(function(s1){L.error("Error while pasting data",s1);});}else{q1=sap.ui.getCore().getLibraryResourceBundle("sap.fe.core");M.error(q1.getText("T_OP_CONTROLLER_SAPFE_PASTE_DISABLED_MESSAGE"),{title:q1.getText("C_COMMON_SAPFE_ERROR")});}}},{key:"onPasteButtonPressed",value:function p1(){var o=this;var p=sap.ui.getCore().getLibraryResourceBundle("sap.fe.templates"),m1=D.os.name,n1=D.system;var o1=p.getText("T_OP_CONTROLLER_TABLE_PASTE_BUTTON_ACTION_MESSAGE_WINDOWS_DESKTOP");if(n1.phone||n1.tablet&&!n1.combi){o1=p.getText("T_OP_CONTROLLER_TABLE_PASTE_BUTTON_ACTION_MESSAGE_TOUCH_DEVICE");}else if(n1.desktop){switch(m1){case"win":o1=p.getText("T_OP_CONTROLLER_TABLE_PASTE_BUTTON_ACTION_MESSAGE_WINDOWS_DESKTOP");break;case"mac":o1=p.getText("T_OP_CONTROLLER_TABLE_PASTE_BUTTON_ACTION_MESSAGE_IOS_DESKTOP");break;}}M.information(o1,{onClose:function(){if(o.content){var q1;(q1=o.content.getAggregation("_content"))===null||q1===void 0?void 0:q1.applyFocusInfo({preventScroll:true});}}});}},{key:"onBeforeExport",value:function r1(o){var p;var m1=o.getParameters().userExportSettings.splitCells,n1=sap.ui.getCore().getConfiguration().getRTL(),o1=o.getSource(),p1=(p=o.getParameters().exportSettings.workbook)===null||p===void 0?void 0:p.columns,q1=this.tableDefinition.columns;l1.updateExportSettings(p1,q1,o1,m1,n1);}},{key:"onDataStateChange",value:function o1(o){var p=o.getSource();var m1=o.getParameter("filteredMessages");if(m1){var n1=p.getModel("internal");n1.setProperty("filteredMessages",m1,p.getBindingContext("internal"));}}},{key:"onMassEditButtonPressed",value:function n1(o,p){var m1=this.content;b.openMassEditDialog(m1,p);}}],[{key:"shouldFilterDataStateMessage",value:function n1(o,p){var m1=p.getParent();while(!m1.isA("sap.fe.macros.TableAPI")){m1=m1.getParent();}return m1.tableDefinition.enableDataStateFilter;}},{key:"updateExportSettings",value:function p1(o,p,m1,n1,o1){o.forEach(function(q1){var r1=[];p===null||p===void 0?void 0:p.forEach(function(s1){var t1=s1;if(n1){var u1=p.some(function(s1){return s1.unit===q1.property;});var v1=l1._getFieldGroupExportLabel(q1,t1,m1);if(v1){r1.unshift(v1);}var w1=l1._getDataFieldDescriptionLabel(q1,t1,m1,u1);if(w1){r1.unshift(w1);}if(t1.isDataPointFakeTargetProperty&&t1.relativePath===q1.property){q1.property=[q1.property];}}if(t1.exportContactProperty&&s1.propertyInfos){var x1,y1,z1,A1;if(((x1=s1.propertyInfos)===null||x1===void 0?void 0:x1.length)===1&&((y1=s1.propertyInfos)===null||y1===void 0?void 0:y1.toString())===q1.property.toString()){q1.property=t1.exportContactProperty;q1.label=t1.label;}else if(((z1=s1.propertyInfos)===null||z1===void 0?void 0:z1.length)>1&&(A1=t1.propertyInfos)!==null&&A1!==void 0&&A1.some(function(C1){return q1.property.includes(C1);})&&Array.isArray(q1.property)){var B1;q1.property=(B1=q1.property)===null||B1===void 0?void 0:B1.map(function(C1){var D1;return(D1=t1.propertyInfos)!==null&&D1!==void 0&&D1.some(function(E1){return E1===C1;})?t1.exportContactProperty:C1;});}}});r1.push(c.getLocalizedText(q1.label,m1));if(r1.length>1){r1=r1.filter(function(s1,t1){if(r1.indexOf(s1)==t1){return s1;}});}if(o1){r1.reverse();}q1.label=r1.join(" - ");});return o;}},{key:"_getFieldGroupExportLabel",value:function s1(o,p,m1){var n1,o1,p1;if((o.columnId.indexOf("::FieldGroup::")!==-1||(n1=p.exportSettings)!==null&&n1!==void 0&&n1.fieldLabel&&o.columnId.indexOf("__column")!==-1)&&((o1=p.propertyInfos)!==null&&o1!==void 0&&o1.includes(o.property)||(p1=p.propertyInfos)!==null&&p1!==void 0&&p1.includes("Property::"+o.property))){var q1;var r1=((q1=p.exportSettings)===null||q1===void 0?void 0:q1.fieldLabel)||p.label;return c.getLocalizedText(r1,m1);}}},{key:"_getDataFieldDescriptionLabel",value:function s1(o,p,m1,n1){var o1,p1,q1,r1;if(p.propertyInfos&&((o1=p.propertyInfos)===null||o1===void 0?void 0:o1.length)>1&&!n1&&((p1=p.propertyInfos)!==null&&p1!==void 0&&p1.includes(o.property)||(q1=p.propertyInfos)!==null&&q1!==void 0&&q1.includes("Property::"+o.property))&&((r1=p.relativePath)===null||r1===void 0?void 0:r1.indexOf("@com.sap.vocabularies.UI.v1.FieldGroup"))===-1){return c.getLocalizedText(p.label,m1);}}}]);return l1;}(a),(y=j1(x.prototype,"tableDefinition",[d],{configurable:true,enumerable:true,writable:true,initializer:null}),z=j1(x.prototype,"readOnly",[f],{configurable:true,enumerable:true,writable:true,initializer:null}),A=j1(x.prototype,"id",[g],{configurable:true,enumerable:true,writable:true,initializer:null}),B=j1(x.prototype,"busy",[h],{configurable:true,enumerable:true,writable:true,initializer:null}),E=j1(x.prototype,"type",[j],{configurable:true,enumerable:true,writable:true,initializer:null}),F=j1(x.prototype,"enableExport",[k],{configurable:true,enumerable:true,writable:true,initializer:null}),G=j1(x.prototype,"enablePaste",[l],{configurable:true,enumerable:true,writable:true,initializer:null}),H=j1(x.prototype,"enableFullScreen",[m],{configurable:true,enumerable:true,writable:true,initializer:null}),I=j1(x.prototype,"selectionMode",[n],{configurable:true,enumerable:true,writable:true,initializer:null}),J=j1(x.prototype,"header",[q],{configurable:true,enumerable:true,writable:true,initializer:null}),K=j1(x.prototype,"enableAutoColumnWidth",[r],{configurable:true,enumerable:true,writable:true,initializer:null}),N=j1(x.prototype,"headerVisible",[s],{configurable:true,enumerable:true,writable:true,initializer:null}),O=j1(x.prototype,"rowPress",[T],{configurable:true,enumerable:true,writable:true,initializer:null}),Q=j1(x.prototype,"personalization",[t],{configurable:true,enumerable:true,writable:true,initializer:null}),R=j1(x.prototype,"variantManagement",[u],{configurable:true,enumerable:true,writable:true,initializer:null}),S=j1(x.prototype,"enableDataStateFilter",[v],{configurable:true,enumerable:true,writable:true,initializer:null}),j1(x.prototype,"onTableRowPress",[W],Object.getOwnPropertyDescriptor(x.prototype,"onTableRowPress"),x.prototype),j1(x.prototype,"onInternalDataReceived",[W],Object.getOwnPropertyDescriptor(x.prototype,"onInternalDataReceived"),x.prototype),j1(x.prototype,"onPaste",[W],Object.getOwnPropertyDescriptor(x.prototype,"onPaste"),x.prototype),j1(x.prototype,"onPasteButtonPressed",[W],Object.getOwnPropertyDescriptor(x.prototype,"onPasteButtonPressed"),x.prototype),j1(x.prototype,"onBeforeExport",[W],Object.getOwnPropertyDescriptor(x.prototype,"onBeforeExport"),x.prototype),j1(x.prototype,"onDataStateChange",[W],Object.getOwnPropertyDescriptor(x.prototype,"onDataStateChange"),x.prototype),j1(x.prototype,"onMassEditButtonPressed",[W],Object.getOwnPropertyDescriptor(x.prototype,"onMassEditButtonPressed"),x.prototype)),x))||w);return l1;},false);
