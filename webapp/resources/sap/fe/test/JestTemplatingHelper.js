/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/macros/PhantomUtil","sap/ui/model/odata/v4/lib/_MetadataRequestor","sap/ui/model/odata/v4/ODataMetaModel","sap/ui/core/util/XMLPreprocessor","sap/base/Log","xpath","fs","@sap/cds-compiler","prettier","sap/ui/base/BindingParser","sap/ui/model/json/JSONModel","sap/ui/core/InvisibleText","sap/base/util/merge","path","sap/fe/core/converters/ConverterContext","sap/fe/core/services/SideEffectsServiceFactory"],function(P,_,O,X,L,x,f,c,p,B,J,I,m,a,C,S){"use strict";var b={};var d=p.format;var t=c.to;var g=c.compileSources;L.setLevel(1,"sap.ui.core.util.XMLPreprocessor");jest.setTimeout(40000);var n={"macros":"sap.fe.macros","macro":"sap.fe.macros","macrodata":"http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1","log":"http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1","unittest":"http://schemas.sap.com/sapui5/preprocessorextension/sap.fe.unittesting/1","control":"sap.fe.core.controls","core":"sap.ui.core","m":"sap.m","f":"sap.ui.layout.form","mdc":"sap.ui.mdc","mdcField":"sap.ui.mdc.field","u":"sap.ui.unified","macroMicroChart":"sap.fe.macros.microchart","microChart":"sap.suite.ui.microchart"};var s=x.useNamespaces(n);var r=function(e){P.register(e);};b.registerMacro=r;var u=function(e){X.plugIn(null,e.namespace,e.name);if(e.publicName){X.plugIn(null,e.publicNamespace,e.publicName);}};b.unregisterMacro=u;var h=function(e,F){return s(e,F);};expect.extend({toHaveControl:function(e,F){var G=h("/root".concat(F),e);return{message:function(){var H=j(e);return"did not find controls matching ".concat(F," in generated xml:\n ").concat(H);},pass:G&&G.length>=1};},toNotHaveControl:function(e,F){var G=h("/root".concat(F),e);return{message:function(){var H=j(e);return"There is a control matching ".concat(F," in generated xml:\n ").concat(H);},pass:G&&G.length===0};}});b.runXPathQuery=h;var i=function(e,F,G){var H="string(/root".concat(e,"/@").concat(F,")");return h(H,G);};b.getControlAttribute=i;var j=function(e){var F=new window.XMLSerializer();var G=F.serializeToString(e).replace(/(?:[\t ]*(?:\r?\n|\r))+/g,"\n").replace(/\\"/g,'"');return d(G,{parser:"html"});};b.serializeXML=j;var k=function(e){var F=f.readFileSync(e,"utf-8");var G=g({"string.cds":F},{});var H=t.edmx(G,{service:"sap.fe.test.JestService"});var K=a.resolve(e,"..","gen");var M=a.resolve(K,a.basename(e).replace(".cds",".xml"));if(!f.existsSync(K)){f.mkdirSync(K);}f.writeFileSync(M,H);return M;};b.compileCDS=k;var l=function(M){try{var F={scopeObject:{},scopeType:"",settings:{}};return Promise.resolve(new S().createInstance(F).then(function(G){var H=G.getInterface();H.getContext=function(){return{scopeObject:{getModel:function(){return{getMetaModel:function(){return M;}};}}};};return H;}));}catch(e){return Promise.reject(e);}};b.getFakeSideEffectsService=l;var o=function(){var e=[];return{addIssue:function(F,G,H){e.push({issueCategory:F,issueSeverity:G,details:H});},getIssues:function(){return e;},checkIfIssueExists:function(F,G,H){return e.find(function(K){K.issueCategory===F&&K.issueSeverity===G&&K.details===H;});}};};b.getFakeDiagnostics=o;var q=function(e,F){var G=e.entitySets.find(function(K){return K.name===F.entitySet;});var H=y(G,G);return new C(e,F,o(),m,H);};b.getConverterContextForTest=q;var v={};var w=function(M){try{function F(){return v[M];};var R=_.create({},"4.0",{});var G=function(){if(!v[M]){var H=new O(R,M,undefined,null);return Promise.resolve(H.fetchEntityContainer()).then(function(){v[M]=H;});}}();return Promise.resolve(G&&G.then?G.then(F):F(G));}catch(e){return Promise.reject(e);}};b.getMetaModel=w;var y=function(e,F){var G={startingEntitySet:e,navigationProperties:[],targetObject:F,targetEntitySet:e,targetEntityType:e.entityType};G.contextLocation=G;return G;};b.getDataModelObjectPathForProperty=y;var z=function(e){var F=B.complexParser(e);for(var G=arguments.length,H=new Array(G>1?G-1:0),K=1;K<G;K++){H[K-1]=arguments[K];}return F.formatter.apply(undefined,H);};b.evaluateBinding=z;var A=function(e,F){var G=B.complexParser(e);var H=new J(F);var K=new I();K.bindProperty("text",G);K.setModel(H);K.setBindingContext(H.createBindingContext("/"));return K.getText();};b.evaluateBindingWithModel=A;var D=function(F,M,G,H){try{var K="<root>".concat(F,"</root>");var N=new window.DOMParser();var Q=N.parseFromString(K,"text/xml");if(!H.hasOwnProperty("converterContext")){H=Object.assign(H,{"converterContext":new J({})});}return Promise.resolve(w(M)).then(function(R){var T={models:Object.assign({metaModel:R},H),bindingContexts:{}};Object.keys(G).forEach(function(U){expect(typeof R.getObject(G[U])).toBeDefined();var V=H[U]||R;T.bindingContexts[U]=V.createBindingContext(G[U]);T.models[U]=V;});if(T.models["this"]){T.bindingContexts["this"]=T.models["this"].createBindingContext("/");}return X.process(Q.firstElementChild,{name:"Test Fragment"},T);});}catch(e){return Promise.reject(e);}};b.getTemplatingResult=D;var E=function(F,M,G,H){try{return Promise.resolve(D(F,M,G,H)).then(j);}catch(e){return Promise.reject(e);}};b.getTemplatedXML=E;return b;},false);
