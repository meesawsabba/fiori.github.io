/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2021 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/base/util/merge","./TemplatePage","sap/ui/test/OpaBuilder","sap/ui/test/Opa5","sap/fe/test/Utils","sap/fe/test/builder/FEBuilder","sap/fe/test/builder/MacroFieldBuilder","sap/fe/test/builder/OverflowToolbarBuilder","sap/fe/test/api/FooterActionsOP","sap/fe/test/api/FooterAssertionsOP","sap/fe/test/api/HeaderActions","sap/fe/test/api/HeaderAssertions","sap/fe/test/api/FormActions","sap/fe/test/api/FormAssertions","sap/fe/test/api/APIHelper"],function(m,T,O,a,U,F,b,c,d,e,H,f,g,h,A){"use strict";function i(N){return"fe::table::"+N.split("/").join("::")+"::LineItem";}function j(E){return"fe::Chart::"+E+"::Chart";}function _(v,q){return c.create(v).hasId(q.id);}function k(v,q){return F.create(v).hasId(q.id);}function l(v,q){var r=F.create(v);if(U.isOfType(q,String)){r.hasType("sap.uxap.ObjectPageSubSection");r.hasProperties({title:q});}else if(q.fieldGroupId){r.hasId(q.fieldGroupId);if(q.fullSubSectionId){r.has(O.Matchers.ancestor(q.fullSubSectionId,false));}}else{r.hasId(q.id);}return r;}function n(s,q){var M,r;if(!U.isOfType(s,String)){if(typeof s.section==="string"&&!s.subSection){r=s.section==="EditableHeaderSection"?"fe::"+s.section+"-anchor":q+"::"+s.section+"-anchor";M=O.Matchers.children(F.Matchers.id(new RegExp(U.formatMessage("{0}$",r))));}else{throw new Error("not supported section and subsection parameters for creating a control id: "+s.section+"/"+s.subSection);}}else{M=O.Matchers.children(F.Matchers.states({controlType:"sap.m.Button",text:s}));}return M;}function o(M,s){if(!M){throw new Error("vMenuAction parameter missing");}var q=s+"::"+M+"-anchor-unifiedmenu";return F.create().hasType("sap.ui.unified.MenuItem").hasId(new RegExp(U.formatMessage("{0}$",q))).doPress().description(U.formatMessage("Executing action '{0}' from currently open action menu",M));}function p(P,q){var s=P.appId,C=P.componentId,V=s+"::"+C,r=V+"--fe::ObjectPage",t="fe::HeaderFacet",u="fe::ObjectPage-OPHeaderContent",v="fe::FooterBar",w="fe::FacetSection",x="fe::FacetSubSection",y="fe::Form",z="fe::FormContainer",B="fe::HeaderFacet::FormContainer",D=V+"--fe::Breadcrumbs",E="fe::ObjectPage-anchBar",G="fe::Paginator",I="EditableHeaderForm::EditableHeaderTitle",J={DISPLAY:"Display",EDITABLE:"Editable"},R=sap.ui.getCore().getLibraryResourceBundle("sap.fe.core"),K=Array.prototype.slice.call(arguments,1);return T.apply(T,[V,{actions:{onTable:function(L){if(!U.isOfType(L,String)){L={id:i(L.property)};}return this._onTable(L);},onChart:function(L){var M;if(L){M=!U.isOfType(L,String)?j(L.property):L;}return this._onChart({id:M});},onFooter:function(){return new d(_(this,{id:v}),{id:v});},onHeader:function(){return new H(k(this,{id:r}),{id:r,headerId:t,headerContentId:u,viewId:V,paginatorId:G,breadCrumbId:D});},onForm:function(L){if(!U.isOfType(L,String)){if(L.section){L.id=x+"::"+L.section;L.fullSubSectionId=V+"--"+L.id;}if(L.fieldGroup){if(L.isHeaderFacet){L.fieldGroupId=B+"::"+L.fieldGroup;}else{L.fieldGroupId=z+"::"+L.fieldGroup;}}}return new g(l(this,L),L);},iCollapseExpandPageHeader:function(L){return this._iCollapseExpandPageHeader(L);},iClickQuickViewMoreLinksButton:function(){return O.create(this).hasType("sap.m.Button").has(O.Matchers.resourceBundle("text","sap.ui.mdc","info.POPOVER_DEFINE_LINKS")).doPress().description("Pressing 'More Links' button").execute();},iClickLinkWithText:function(L){return O.create(this).hasType("sap.m.Link").hasProperties({text:L}).doPress().description("Navigating via link '"+L+"'").execute();},iCheckLinksCount:function(L){return O.create(this).hasType("sap.ui.mdc.link.PanelListItem").check(function(M){if(M.length===L+1){return true;}else{return false;}},true).description("Seeing QuickView Card with "+L+" target applications in ObjectPage").execute();},iEnableLink:function(L){return O.create(this).hasType("sap.m.ColumnListItem").hasAggregationProperties("cells",{text:L}).isDialogElement().doPress("selectMulti").description("The CheckBox for link "+L+" is selected").execute();},iPressKeyboardShortcutOnSection:function(S,L){return this._iPressKeyboardShortcut(undefined,S,L,"sap.uxap.ObjectPageSection");},iGoToSection:function(S){var L=O.create(this).hasId(E);if(U.isOfType(S,Object)&&typeof S.section==="string"&&typeof S.subSection==="string"){var M={section:S.section};return L.has(n(M,w)).doOnChildren(O.create(this).hasType("sap.m.Button").has(O.Matchers.childrenMatcher(O.create(this).hasType("sap.ui.core.Icon"),true)).doPress()).success(function(){return o(S.subSection,x).execute();}).description("Selecting section "+S.section).execute();}else{return L.has(n(S,w)).doPress().description("Selecting section "+(S.section||S)).execute();}},iOpenSectionWithTitle:function(N){return this.iGoToSection(N);},iEnterValueForFieldInEditableHeader:function(L){return b.create(this).hasId(V+"--fe::"+I).doEnterText(L).description("Entering '"+L+" in field ").execute();},iOpenVHDInDialog:function(L){return O.create(this).isDialogElement().hasId(L+"-inner-vhi").doPress().description("Opening value help for '"+L+"' from within a dialog").execute();},iConfirmVHDInDialog:function(L){return O.create(this).isDialogElement().hasId(L+"-ok").doPress().description("Comfirmed VHD opened in dialog").execute();},iEnterValueForFieldInCreateDialog:function(L,M){return O.create(this).isDialogElement().hasId(L).doEnterText(M).description("Entering Text in the field '"+L+"'in the create dialog with value '"+M+"'").execute();},iClickOnMessageButton:function(){return O.create(this).hasType("sap.fe.common.MessageButton").doPress().description("Clicked on Message Button").execute();},iCheckMessageButtonTooltip:function(L){return O.create(this).hasType("sap.fe.common.MessageButton").check(function(M){return M[0].getTooltip()===L;},true).description("Checking tooltip of MessageButton").execute();},iClickOnMessage:function(M){return O.create(this).hasType("sap.m.MessageListItem").hasProperties({title:M.MessageText,groupAnnouncement:M.GroupLabel}).isDialogElement(true).description("MessageItem with correct text and group label").doOnChildren(O.create(this).hasType("sap.m.Link").hasProperties({text:M.MessageText}).doPress().description("Click on the message")).execute();}},assertions:{onTable:function(L){if(!U.isOfType(L,String)){L={id:i(L.property)};}return this._onTable(L);},onChart:function(L){var M;if(L){M=!U.isOfType(L,String)?j(L.property):L;}return this._onChart({id:M});},onFooter:function(){return new e(_(this,{id:v}),{id:v});},onHeader:function(){return new f(k(this,{id:r}),{id:r,headerId:t,headerContentId:u,viewId:V,paginatorId:G,breadCrumbId:D});},onForm:function(L){if(!U.isOfType(L,String)){if(L.section){L.id=x+"::"+L.section;L.fullSubSectionId=V+"--"+L.id;}if(L.fieldGroup){L.fieldGroupId=z+"::"+L.fieldGroup;}}return new h(l(this,L),L);},iSeeLinkWithText:function(L){return O.create(this).hasType("sap.m.Link").hasProperties({text:L}).description("Seeing link with text '"+L+"'").execute();},iSeeTextWithText:function(L){return O.create(this).hasType("sap.m.Text").hasProperties({text:L}).description("Seeing Text with text '"+L+"'").execute();},iSeeTitleWithText:function(L){return O.create(this).hasType("sap.m.Title").hasProperties({text:L}).description("Seeing Title with text '"+L+"'").execute();},iSeeContactDetailsPopover:function(L){return(O.create(this).hasType("sap.ui.mdc.link.Panel").description("Contact card with title '"+L+"' is present").execute());},iSeeQuickViewPopover:function(){return O.create(this).hasType("sap.ui.mdc.link.Panel").description("Seeing Quick View Details in ObjectPage").execute();},iSeeContactPopoverWithAvatarImage:function(L){return O.create(this).hasType("sap.ui.mdc.link.Panel").check(function(M){var N=M.some(function(Q){return Q.src===L;});return N===false;},true).description("Seeing Contact Card with Avatar Image in ObjectPage").execute();},iSeeQuickViewMoreLinksButton:function(){return O.create(this).isDialogElement(true).hasType("sap.m.Button").has(O.Matchers.resourceBundle("text","sap.ui.mdc","info.POPOVER_DEFINE_LINKS")).description("The 'More Links' button found").execute();},iSeeObjectPageInDisplayMode:function(){return this._iSeeObjectPageInMode(J.DISPLAY);},iSeeObjectPageInEditMode:function(){return this._iSeeObjectPageInMode(J.EDITABLE);},_iSeeObjectPageInMode:function(M){return O.create(this).hasId(V).viewId(null).has(function(L){return L.getModel("ui").getProperty("/editMode")===M;}).description("Object Page is in mode '"+M+"'").execute();},iSeeSectionWithTitle:function(L){return O.create(this).hasType("sap.uxap.ObjectPageSection").hasProperties({title:L}).description("Seeing section with title '"+L+"'").execute();},iSeeSubSectionWithTitle:function(L){return O.create(this).hasType("sap.uxap.ObjectPageSubSection").hasProperties({title:L}).description("Seeing sub-section with title '"+L+"'").execute();},iSeeSectionButtonWithTitle:function(L,S){return F.create(this).hasId(E).has(O.Matchers.children(F.Matchers.states(m({},{controlType:"sap.m.Button",text:L},S)))).description(U.formatMessage("Seeing section button with title '{0}' and state='{1}'",L,S)).execute();},iSeeFlpLink:function(L){return O.create(this).hasType("sap.ui.mdc.link.PanelListItem").isDialogElement(true).hasProperties({text:L}).description("FLP link with text '"+L+"' is present").execute();},iSeeSimpleFormWithLabel:function(L){return O.create(this).hasType("sap.m.Label").isDialogElement(true).hasProperties({text:L}).description("SimpleForm has label '"+L+"' is present").execute();},iSeeSimpleFormWithText:function(L){return O.create(this).hasType("sap.ui.layout.form.SimpleForm").isDialogElement(true).doOnChildren(O.create(this).hasType("sap.m.Text").hasProperties({text:L})).description("SimpleForm has text '"+L+"' is present").execute();},iSeeSimpleFormWithLink:function(L){return O.create(this).hasType("sap.ui.layout.form.SimpleForm").isDialogElement(true).doOnChildren(O.create(this).hasType("sap.m.Link").hasProperties({text:L})).description("SimpleForm has link '"+L+"' is present").execute();},iSeeSimpleFormWithTitle:function(L){return O.create(this).hasType("sap.ui.core.Title").isDialogElement(true).hasProperties({text:L}).description("SimpleForm has label '"+L+"' is present").execute();},iSeeSelectLinksDialog:function(){return O.create(this).hasType("sap.m.Title").isDialogElement(true).has(O.Matchers.resourceBundle("text","sap.ui.mdc","info.SELECTION_DIALOG_ALIGNEDTITLE")).description("Seeing dialog open").execute();},iDoNotSeeFlpLink:function(L){return O.create(this).hasType("sap.m.Link").isDialogElement(true).check(function(M){var N=M.some(function(Q){return Q.getText()===L;});return N===false;},true).description("FLP link with text '"+L+"' is not found").execute();},iSeeTitleLink:function(L,M){return O.create(this).hasType("sap.m.Link").isDialogElement(true).hasProperties({text:L,href:M}).description("QuickView Title link with text '"+L+"' is found").execute();},iSeeQuickViewTitleWithText:function(L){return O.create(this).hasType("sap.ui.mdc.link.Panel").check(function(M){var N=M.some(function(Q){return Q.text===L;});return N===false;},true).description("Seeing QuickView with Title in ListReport").execute();},iSeeQuickViewFieldWithText:function(L){return O.create(this).hasType("sap.fe.core.controls.FieldWrapper").check(function(M){var N=M.some(function(Q){return Q.text===L;});return N===false;},true).description("Seeing QuickView Form with Text in ListReport").execute();},iSeeCreateConfirmation:function(){return this._iSeeTheMessageToast(R.getText("C_TRANSACTION_HELPER_OBJECT_CREATED"));},iSeeSaveConfirmation:function(){return this._iSeeTheMessageToast(R.getText("C_TRANSACTION_HELPER_OBJECT_SAVED"));},iSeeDeleteConfirmation:function(){return this._iSeeTheMessageToast(R.getText("C_TRANSACTION_HELPER_OBJECT_PAGE_DELETE_TOAST_SINGULAR"));},iSeeConfirmMessageBoxWithTitle:function(L){return O.create(this).hasType("sap.m.Dialog").isDialogElement(true).hasProperties({title:L}).description("Seeing Message dialog open").execute();},iSeeMoreFormContent:function(S){return O.create(this).hasId(y+"::"+S+"::MoreContent").description("Seeing More Form Content in "+S).execute();},iDoNotSeeMoreFormContent:function(S){return O.create(this).hasType("sap.ui.layout.form.Form").check(function(L){var M=L.some(function(N){return N.getId().includes(S+"::MoreContent");});return M===false;}).description("Not Seeing More Form Content in "+S).execute();},iSeeControlVMTableTitle:function(L,N){return O.create(this).hasType("sap.m.Title").hasId(i(N)+"::VM-text").hasProperties({text:L}).description("Seeing variant title '"+L+"'").execute();},iCheckValueOfFieldInCreateDialog:function(L,M,N,Q){return b.create(this).isDialogElement().hasId(L).hasValue(M,N).hasProperties({required:!!Q}).description(U.formatMessage("Seeing field '{0}' with value '{1}'",L,[].concat(M,N||[]))).execute();},iSeeMessageView:function(){return O.create(this).hasType("sap.m.MessageView").isDialogElement(true).description("MessageView is visible").execute();},iCheckMessageItemsOrder:function(L){return O.create(this).hasType("sap.m.MessageView").check(function(M){var N=M[0].getItems();return(N[0].getGroupName()===L[0].GroupLabel&&N[1].getGroupName()===L[1].GroupLabel&&N[0].getTitle()===L[0].MessageText&&N[1].getTitle()===L[1].MessageText);},true).isDialogElement(true).description("MessageItems are correctly ordered").execute();},iCheckMessageItemProperties:function(L,M){return O.create(this).hasType("sap.m.MessageView").check(function(N){var Q=N[0].getItems();return(Q[M].getGroupName()===L.GroupLabel&&Q[M].getTitle()===L.MessageText&&Q[M].getSubtitle()===L.SubTitle&&Q[M].getActiveTitle()===L.ActiveTitle);},true).isDialogElement(true).description("MessageItem is correctly displayed").execute();},iCheckValueForFieldInCreateDialog:function(L,M,N){return b.create(this).isDialogElement().hasId(L).hasValue(M).hasProperties({required:!!N}).description(U.formatMessage("Seeing Create dialog parameter '{0}' with value '{1}'",L,M)).execute();},iClickBackOnMessageView:function(){return O.create(this).hasType("sap.m.MessageView").isDialogElement(true).doOnChildren(O.create(this).hasType("sap.m.Button").hasProperties({icon:"sap-icon://nav-back"}).doPress().description("Click on the message view back")).execute();},iCheckVisibilityOfButtonWithText:function(L,M){return O.create(this).hasType("sap.m.Button").mustBeVisible(M).hasProperties({text:L,visible:M}).description("Button '"+L+"' is "+(M?"visible":"NOT visible")).execute();},iCheckFieldVisibilityInMassEditDialog:function(L,M){return O.create(this).isDialogElement().hasType("sap.m.ComboBox").check(function(N){var Q=N.some(function(S){return S.getId()===L;});return Q===M;}).description("Checking visibility of field in mass edit dialog").execute();}}}].concat(K));}return p;});
