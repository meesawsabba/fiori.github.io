/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2021 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/model/odata/v4/ODataMetaModel","sap/ui/core/util/XMLPreprocessor","sap/ui/core/XMLTemplateProcessor","sap/fe/macros/macroLibrary","sap/fe/core/TemplateModel","sap/fe/macros/ResourceModel"],function(O,X,a,m,T){"use strict";function t(Q,s,M,f,u,r,b){var S="./test/",R={read:function(){return Promise.resolve(M);},mHeaders:{}},o=new O(R,S+"$metadata",undefined,null);m.deregister();if(u){m.register();}function c(g,D,B,h){var p={models:Object.assign({},h),bindingContexts:{}};Object.keys(B).forEach(function(k){var i=h[k]||o;if(!(i instanceof sap.ui.model.Model)&&!(i instanceof sap.ui.model.odata.v4.ODataMetaModel)){i=new T(i,o);}g.ok(typeof i.getObject(B[k])!=="undefined",k+": "+B[k]+" exists");p.bindingContexts[k]=i.createBindingContext(B[k]);p.models[k]=i;});if(p.models["this"]){p.bindingContexts["this"]=p.models["this"].createBindingContext("/");}return Promise.resolve(X.process(D,{},p));}Q.module("Smoke Tests for "+s);Q.test("Check if metadata is available",function(g){return Promise.all([o.requestObject("/").then(function(E){g.ok(E,"Entity Container found");}),o.requestObject("/$").then(function(h){g.ok(h,"Metadata Document found");})]);});var d;function e(F){F.fileType=F.fileType||"fragment";Q.module("Tests for "+s+" against "+F.fileType+" "+F.sFragmentName+(F.sDescription?" ("+F.sDescription+")":""),{beforeEach:function(){if(r){d=b.stub(r,"getText").callsFake(function(k){if(k==="T_NEW_OBJECT"){return"New Object";}else{return"(Unnamed Object)";}});}},afterEach:function(){if(d){d.restore();}}});F.tests.forEach(function(g,i){Q.test(g.description||"Test "+F.fileType+" scope: "+i,function(h){return o.requestObject("/$").then(function(){return a.loadTemplatePromise(F.sFragmentName,F.fileType);}).then(function(D){return c(h,D,g.mBindingContexts,Object.assign({},F.mModels,g.mModels));}).then(function(D){var E=[].filter.call(D.ownerDocument.querySelectorAll("*"),k),j,n=0;function k(q){return q.getAttribute("unittest:id")!==null;}function l(q,v,j){function w(A){if(v[A]===undefined){h.ok(!q.hasAttribute(A),'unittest:id="'+j+"\": attribute '"+A+"' is expected not to be rendered");}else{var x=q.getAttribute(A);h.strictEqual(x,v[A],'unittest:id="'+j+"\": attribute '"+A+"' properly created as "+x);}}if(v){n++;Object.keys(v).forEach(w);}}E.forEach(p);function p(q){j=q.getAttribute("unittest:id");l(q,g.oExpectedResultsPerTest[j],j);}h.equal(n,Object.keys(g.oExpectedResultsPerTest).length,"All tests have been executed for this test case");}).catch(function(E){var j=g.sExpectedException;if(E&&j){h.strictEqual(E.message||E,j,"expected exception occurred: "+j);}else{throw E;}});});});}f.forEach(e);}return{testFragments:t};});
