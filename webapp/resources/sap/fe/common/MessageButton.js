/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2017 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/m/Button","sap/m/Dialog","sap/m/library","sap/fe/common/MessagePopover","sap/fe/core/CommonUtils","sap/ui/core/MessageType","sap/ui/model/Filter","sap/ui/model/Sorter","sap/ui/model/FilterOperator","sap/uxap/ObjectPageLayout","sap/base/Log"],function(B,D,L,M,C,c,F,S,d,O,f){"use strict";var g=L.ButtonType;var h=B.extend("sap.fe.common.MessageButton",{metadata:{properties:{},events:{messageChange:{}},aggregations:{customFilters:{type:"sap.fe.common.MessageFilter",multiple:true,singularName:"customFilter"}}},renderer:{}});function _(a,i){return a===i.getId();}function m(a,i){return a.some(function(b){if(b===i.getId()){return true;}return false;});}function n(){clearTimeout(this._setMessageDataTimeout);this._setMessageDataTimeout=setTimeout(function(){var a,b=g.Default,j=this.oMessagePopover.getItems(),k=j.length,l={Error:0,Warning:0,Success:0,Information:0},R=sap.ui.getCore().getLibraryResourceBundle("sap.fe.core"),T,U,V;if(k>0){for(var i=0;i<k;i++){if(!j[i].getType()||j[i].getType()==""){++l["Information"];}else{++l[j[i].getType()];}}if(l[c.Error]>0){b=g.Negative;}else if(l[c.Critical]>0||l[c.Warning]>0){b=g.Critical;}else if(l[c.Success]>0){b=g.Success;}else if(l[c.Information]>0){b=g.Neutral;}if(l.Error>0){this.setText(l.Error);}else{this.setText("");}if(l.Error===1){T="C_COMMON_SAPFE_ERROR_MESSAGES_PAGE_TITLE_ERROR";}else if(l.Error>1){T="C_COMMON_SAPFE_ERROR_MESSAGES_PAGE_MULTIPLE_ERROR_TOOLTIP";}else if(!l.Error&&l.Warning){T="C_COMMON_SAPFE_ERROR_MESSAGES_PAGE_WARNING_TOOLTIP";}else if(!l.Error&&!l.Warning&&l.Information){T="C_MESSAGE_HANDLING_SAPFE_ERROR_MESSAGES_PAGE_TITLE_INFO";}else if(!l.Error&&!l.Warning&&!l.Information&&l.Success){T="C_MESSAGE_HANDLING_SAPFE_ERROR_MESSAGES_PAGE_TITLE_SUCCESS";}if(T){V=R.getText(T);U=l.Error?l.Error+" "+V:V;this.setTooltip(U);}this.setIcon(a);this.setType(b);this.setVisible(true);var W=sap.ui.getCore().byId(this.sViewId);if(W){var X=W.getController().pageReady;X.waitPageReady().then(function(){return this._applyGroupingAsync(W);}.bind(this)).finally(function(){this.fireMessageChange({iMessageLength:k});}.bind(this)).catch(function(e){f.error("fail grouping messages");});}if(k>1){this.oMessagePopover.navigateBack();}}else{this.setVisible(false);this.fireMessageChange({iMessageLength:k});}}.bind(this),100);}function o(){var a,V,b,e,i,j,k,l,R,U=[],T=null;function W(){var $=function(a1){var b1=Infinity,c1=sap.ui.getCore().byId(a1[0]),d1=sap.ui.getCore().byId(a1[0]);while(c1){var e1=c1 instanceof D?d1.getParent().findElements(true).indexOf(d1):Infinity;if(c1 instanceof D){if(b1>e1){b1=e1;d1.focus();}return false;}c1=c1.getParent();}return true;};return new F({path:"controlIds",test:$,caseSensitive:true});}function X(){var $=function(a1){if(!a1.length){return false;}var b1=sap.ui.getCore().byId(a1[0]);while(b1){if(b1.getId()===k){return true;}if(b1 instanceof D){return false;}b1=b1.getParent();}return false;};return new F({path:"controlIds",test:$,caseSensitive:true});}if(!this.sViewId){this.sViewId=this._getViewId(this.getId());}k=this.sViewId;a=this.getAggregation("customFilters");if(a){a.forEach(function($){U.push(new F({path:$.getProperty("path"),operator:$.getProperty("operator"),value1:$.getProperty("value1"),value2:$.getProperty("value2")}));});}i=this.getBindingContext();if(!i){this.setVisible(false);return;}else{j=i.getPath();V=new F({filters:[new F({path:"validation",operator:d.EQ,value1:true}),X()],and:true});b=new F({filters:[V,new F({path:"target",operator:d.StartsWith,value1:j})],and:false});R=new F({filters:[W()]});}var Y=new F({filters:[b,R],and:true});if(U.length>0){e=new F({filters:[U,Y],and:false});}else{e=Y;}this.oItemBinding.filter(e);this.oObjectPageLayout=G(this,this.oObjectPageLayout);if(this.oObjectPageLayout){var Z=this;l=new S("",null,null,function($,a1){var b1,c1;if(!T){T=Z.oObjectPageLayout&&Z.oObjectPageLayout.getSections();}b1=p($,T);c1=p(a1,T);if(b1<c1){return-1;}if(b1>c1){return 1;}return 0;});this.oItemBinding.sort(l);}}function p(a,b){if(b){var e,i,l,j,k,R,T,U;for(j=b.length-1;j>=0;--j){e=b[j];i=e.getSubSections();for(k=i.length-1;k>=0;--k){l=i[k];T=l.findElements(true);R=T.filter(_.bind(this,a.getControlId()));U=j+1;if(R.length>0){a.sectionName=e.getTitle();a.subSectionName=l.getTitle();return U*10+(k+1);}}}if(!a.sectionName&&!a.subSectionName&&a.persistent){return 1;}return 999;}return 999;}function q(a){var i=sap.ui.fl.Utils.getViewForControl(this).getBindingContext("internal");i.setProperty("errorNavigationSectionFlag",true);var b=a.getParameter("item"),j=b.getBindingContext("message").getObject(),k=new RegExp("^/").test(j.getTarget()),l,R,V=sap.ui.getCore().byId(this.sViewId),T=this.oMessagePopover;if(T&&T.isOpen()){T.close();}var U=function(j,X,e,Z){var $=V.findElements(true);var a1=j.getControlIds().filter(function(j1){return $.some(function(k1){return k1.getId()===j1;});}).map(function(j1){return sap.ui.getCore().byId(j1);});var b1=a1.filter(function(j1){return!j1.isA("sap.m.Table")&&!j1.isA("sap.ui.Table.table");});if(b1.length>0){b1[0].focus();}else if(a1.length>0){a1[0].focus();var c1=X.findElements(true,function(j1){return j1.isA("sap.m.ColumnListItem");});if(c1.length>0&&c1[0]){var d1=c1[e];var e1=W(d1,j);var f1=j.getTarget().split("/").pop();var g1=X.getParent().getTableDefinition().columns.find(function(j1){return j1.key==="DataField::"+f1&&j1.availability!=="Hidden";});if(e1){var h1=e1.isA("sap.fe.macros.FieldAPI")?e1.getContent().getContentEdit()[0]:e1.getItems()[0].getContent().getContentEdit()[0];h1.focus();}else if(g1){c1[e].focus();}else{var i1=j.getTarget().split("/").pop();if(i1){V.getModel("internal").setProperty("/messageTargetProperty",i1);}V.getController()._routing.navigateForwardToContext(d1.getBindingContext());}}}};function W(e,j){var Z=j.controlIds.map(function($){var a1=e.findElements(true,function(b1){return b1.getId()===$;});return a1.length>0?sap.ui.getCore().byId($):null;}).reduce(function($,a1){return a1?a1:$;});return Z;}if(b.getGroupName().indexOf("Table:")!==-1){var X;if(k){X=j.controlIds.map(function(e){var l=sap.ui.getCore().byId(e);var Z=l&&l.getParent();return Z&&Z.isA("sap.ui.mdc.Table")&&Z.getHeader()===b.getGroupName().split(", Table: ")[1]?Z:null;}).reduce(function(e,Z){return Z?Z:e;});if(X){R=b.getGroupName().split(", ")[0];t(X,this.oObjectPageLayout,R).then(function(){var Z=this._getTableRefErrorContext(X);var $=Z.getProperty(b.getBindingContext("message").getObject().getId());var a1=function(X,e,c1){var d1=A(X),b1=v(X).getFirstVisibleRow();if(d1.length>0&&d1[0]){var e1=d1[e-b1],f1=W(e1,j);var g1=e1.getCells().find(function(k1){return k1.getEditable&&k1.getEditable();});var h1=j.getTarget().split("/").pop();var i1=X.getParent().getTableDefinition().columns.find(function(k1){return k1.key==="DataField::"+h1&&k1.availability!=="Hidden";});if(f1){f1.focus();}else if(i1){g1.getContent().getContentEdit()[0].focus();}else{var j1=j.getTarget().split("/").pop();if(j1){V.getModel("internal").setProperty("/messageTargetProperty",j1);}V.getController()._routing.navigateForwardToContext(e1.getBindingContext());}return{targetRow:e1,targetCell:f1};}return{targetRow:null,targetCell:null};};if(X.data("tableType")==="GridTable"&&$.rowIndex!==""){var b1=v(X).getFirstVisibleRow();X.scrollToIndex($.rowIndex).then(function(){var e=A(X),c1,d1;if(e.length>0&&e[0]){c1=e[0].getParent().getFirstVisibleRow();d1=b1-c1!==0;}if(d1){var e1=new Promise(function(f1){sap.ui.getCore().attachEvent("UIUpdated",f1);});return e1;}return null;}).then(function(){setTimeout(function(){a1(X,$.rowIndex,this);}.bind(this),0);}.bind(this)).catch(function(e){f.error("Error while focusing on error");});}else if(X.data("tableType")==="ResponsiveTable"&&$){U.bind(this)(j,X,$.rowIndex,this);}else{U.bind(this)(j);}}.bind(this)).catch(function(){f.error("Fail to navigate to Error control");});}}else{l=sap.ui.getCore().byId(j.controlIds[0]);var Y=sap.ui.getCore().byId(this.oObjectPageLayout.getSelectedSection());if(Y.findElements(true).indexOf(l)===-1){R=b.getGroupName().split(", ")[0];s(this.oObjectPageLayout,R);}l.focus();}}else{R=b.getGroupName().split(", ")[0];s(this.oObjectPageLayout,R);U(j);}}function r(a,b){if(b){var e=a.getSections();var j;for(var i=0;i<e.length;i++){if(e[i].getVisible()&&e[i].getTitle()===b){j=e[i];break;}}return j;}}function s(a,b){var U=a.getUseIconTabBar();if(U){var e=r(a,b);var i=a.getSelectedSection();if(e&&i!==e.getId()){a.setSelectedSection(e.getId());}}}function t(T,a,b){var R=T.getRowBinding();var e=T.getBindingContext();var i=a.getBindingContext();var j=!(e===i);s(a,b);return new Promise(function(k){if(j){R.attachEventOnce("change",function(){k();});}else{k();}});}function u(e){var a=e.getParent();while(a&&!a.isA("sap.ui.mdc.Table")){a=a.getParent();}var b=a&&a.isA("sap.ui.mdc.Table")?a:undefined;return b;}function v(a){return a.findElements(true,function(e){return e.isA("sap.ui.table.Table");})[0];}function w(e){var a=e.getParent();while(a&&!a.isA("sap.ui.table.Row")&&!a.isA("sap.ui.table.CreationRow")&&!a.isA("sap.m.ColumnListItem")){a=a.getParent();}var T=a&&(a.isA("sap.ui.table.Row")||a.isA("sap.ui.table.CreationRow")||a.isA("sap.m.ColumnListItem"))?a:undefined;return T;}function x(e){var T=w(e),R;if(T.isA("sap.ui.table.Row")){R=T.getIndex();}else{R=T.getTable().getItems().findIndex(function(a){return a.getId()===T.getId();});}return R;}function y(e){var a=function(e,T){return T.getCells().findIndex(function(l){return l.getId()===e.getId();});};var b=function(e,T){var l=e.getParent(),R=a(l,T);while(l&&R<0){l=l.getParent();R=a(l,T);}return R;};var T=w(e),i;i=b(e,T);if(T.isA("sap.ui.table.CreationRow")){var j=T.getCells()[i].getId(),k=T.getTable().getColumns();i=k.findIndex(function(l){if(l.getCreationTemplate()){return j.search(l.getCreationTemplate().getId())>-1?true:false;}else{return false;}});}return i;}function z(T,a){var b;var e=T.getColumns().find(function(a,l){return l.getDataProperty()===a;}.bind(this,a));if(!e){var i=T.getControlDelegate().getColumnsFor(T).find(function(l){if(!!l.template&&l.propertyInfos){return(l.propertyInfos[0]===a||l.propertyInfos[0].replace("Property::","")===a);}else{return false;}});if(i){e=i;a=e.name;b=T.getColumns().find(function(l){return a===l.getDataProperty();}).getHeader();}else{var j=T.getControlDelegate().getColumnsFor(T);e=j.find(function(j,a,l){if(l.key.indexOf("::FieldGroup::")!==-1){return l.propertyInfos.find(function(R){return j.find(function(l){return l.relativePath===a;});});}}.bind(this,j,a));if(e&&e.label){var k=T.getColumns().some(function(l){return l.getHeader()===e.label;});}b=k&&e.label;a=k&&e.key;}}else{b=e&&e.getHeader();}return{sTableTargetColName:b,sTableTargetColProperty:a};}function A(a){return a.findElements(true,function(e){return e.isA("sap.ui.table.Row");});}function E(T,a){var R=function(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");};var b=a.getTarget().replace(new RegExp(R(T.getBindingContext().getPath()+"/"+T.getRowBinding().getPath())+"\\(.*\\)/"),"");return b;}function G(e,a){if(a){return a;}a=e;while(a&&!(a instanceof O)){a=a.getParent();}return a;}function H(T,i){var a=T.getColumns()[i].getDataProperty();var b=T.getControlDelegate().getColumnsFor(T).find(function(e){return e.name===a&&!!e.template;});return b;}function I(T){var a,b=H(T,0);if(b){if(b.propertyInfos){a=b.propertyInfos[0].replace("Property::","");}else{a=undefined;}}else{a=T.getColumns()[0].getDataProperty();}return a;}function J(T,a){var b=sap.ui.getCore().byId(a);if(!b.isA("sap.ui.table.Table")&&!b.isA("sap.m.Table")){return T.findElements(true,function(e){return e.getId()===b;});}return false;}function K(a){var b=a.getParent();while(b&&!b.isA("sap.ui.table.Row")&&!b.isA("sap.ui.table.CreationRow")&&!b.isA("sap.m.ColumnListItem")){b=b.getParent();}return!!b&&b.isA("sap.ui.table.CreationRow");}function N(a,T,b,e,R,i,j,k){var l;var U=I(j);var V=a.getBindingContext("message").getObject().getTarget().split("/").pop();var W=j.getParent().getTableDefinition().columns.find(function(c1){return c1.key==="DataField::"+V;});var X=W?W.label+" ("+R.getText("T_COLUMN_INDICATOR_IN_TABLE_DEFINITION")+")":R.getText("T_MESSAGE_ITEM_SUBTITLE_INDICATOR_UNKNOWN");if(k){l=C.getTranslatedText("T_MESSAGE_ITEM_SUBTITLE",R,[R.getText("T_MESSAGE_ITEM_SUBTITLE_CREATION_ROW_INDICATOR"),e?e:R.getText("T_MESSAGE_ITEM_SUBTITLE_INDICATOR_UNKNOWN")]);}else{var U=I(j);l=T.length>0?C.getTranslatedText("T_MESSAGE_ITEM_SUBTITLE",R,[b&&U?b.getValue(U):R.getText("T_MESSAGE_ITEM_SUBTITLE_INDICATOR_UNKNOWN"),e?e:X]):null;}a.setSubtitle(l);var Y=Object.keys(j.getModel().getMetaModel().getObject(j.data("entityType")));var Z=sap.ui.require("sap/ui/core/Component");var $=j&&Z.getOwnerComponentFor(j)&&Z.getOwnerComponentFor(j).getNavigation();var a1=false;if($&&Object.keys($).indexOf(j.getRowBinding().sPath)!=-1){a1=$[j.getRowBinding().sPath]&&$[j.getRowBinding().sPath].detail&&$[j.getRowBinding().sPath].detail.route?true:false;}var b1=a1&&j.getRowAction()&&j.getRowAction().indexOf("Navigation")!=-1&&Y.indexOf(i)!=-1?true:false;a.setActiveTitle(!l||b1||k||(!!e?!!b:!!e));return l;}function P(e,a){return!a.some(function(e,b){var i=e.getParent();while(i&&i!==b){i=i.getParent();}return i?true:false;}.bind(this,e));}function Q(a){var T=sap.ui.getCore().getMessageManager().getMessageModel().getData();sap.ui.getCore().getMessageManager().removeAllMessages();T.forEach(function(e){if(e!==a){sap.ui.getCore().getMessageManager().addMessages([e]);}});}h.prototype.init=function(){B.prototype.init.apply(this,arguments);this.attachPress(this.handleMessagePopoverPress,this);this.oMessagePopover=new M();this.oItemBinding=this.oMessagePopover.getBinding("items");this.oItemBinding.attachChange(n,this);var a=this.getId();if(a){this.oMessagePopover.addCustomData(new sap.ui.core.CustomData({key:"messageButtonId",value:a}));}this.attachModelContextChange(o.bind(this));this.oMessagePopover.attachActiveTitlePress(q.bind(this));};h.prototype.handleMessagePopoverPress=function(e){this.oMessagePopover.toggle(e.getSource());};h.prototype._applyGroupingAsync=function(V){var W=[];var a=V.getBindingContext();var b=function(V){var R=[];var e=this.oItemBinding.getContexts().map(function(i){return i.getObject();});var j=V.getBindingContext();if(j){var k=V.getContent()[0];this.getVisibleSectionsFromObjectPageLayout(k).forEach(function(l){l.getSubSections().forEach(function(U){U.findElements(true).forEach(function(X){if(X.isA("sap.ui.mdc.Table")){for(var i=0;i<e.length;i++){var Y=X.getRowBinding();if(Y){var Z=j.getPath()+"/"+X.getRowBinding().getPath();if(e[i].target.indexOf(Z)===0){R.push({table:X,subsection:U});break;}}}}});});});}return R;};var T=b.bind(this)(V);T.forEach(function(e){var i=e.table,j=e.subsection;if(!i.getBindingContext()||i.getBindingContext().getPath()!==a.getPath()){j.setBindingContext(a);if(!i.getRowBinding().isLengthFinal()){W.push(new Promise(function(k){i.getRowBinding().attachEventOnce("dataReceived",function(){k();});}));}}});return Promise.all(W).then(function(){V.getModel().checkMessages();return new Promise(function(e){setTimeout(function(){this._applyGrouping();e();}.bind(this),0);}.bind(this));}.bind(this)).catch(function(){f.error("Error while grouping the messages in the messagePopOver");});};h.prototype.getVisibleSectionsFromObjectPageLayout=function(a){return a.getSections().filter(function(b){return b.getVisible();});};h.prototype._applyGrouping=function(){var a,b;this.oObjectPageLayout=G(this,this.oObjectPageLayout);if(!this.oObjectPageLayout){return;}a=this.oMessagePopover.getItems();b=this.getVisibleSectionsFromObjectPageLayout(this.oObjectPageLayout);var e=this._checkControlIdInSections(a,false);if(e){this._fnEnableBindings(b);}};h.prototype._getTableRefErrorContext=function(T){var a=T.getModel("internal");if(!T.getBindingContext("internal").getProperty("refError")){a.setProperty("refError",{},T.getBindingContext("internal"));}var R=T.getBindingContext("internal").getPath()+"/refError/"+T.getBindingContext().getPath().replace("/","$")+"$"+T.getRowBinding().getPath().replace("/","$");var b=a.getContext(R);if(!b.getProperty("")){a.setProperty("",{},b);}return b;};h.prototype._getBackendMessageToRemove=function(T,a,e){var b,i=this._getTableRefErrorContext(T),j=Object.keys(i.getProperty()).filter(function(k){return Object.keys(i.getProperty()[k]).every(function(l){return k!==a.getId()&&i.getProperty()[k][l]===e[l];});}),V=sap.ui.getCore().getMessageManager().getMessageModel().getData().map(function(k){return k.id;});if(j.length>0){V.indexOf(j[0]);b=sap.ui.getCore().getMessageManager().getMessageModel().getData()[V.indexOf(j[0])];}return b;};h.prototype._updateInternalModel=function(T,R,a,b,e,i){var j;if(i){j={rowIndex:"CreationRow",targetColProperty:a?a:""};}else{j={rowIndex:T?R:"",targetColProperty:a?a:""};}var k=b.getModel("internal"),l=this._getTableRefErrorContext(b);var V=sap.ui.getCore().getMessageManager().getMessageModel().getData().map(function(W){return W.id;}),U;if(l.getProperty()){U=Object.keys(l.getProperty()).filter(function(W){return V.indexOf(W)===-1;});U.forEach(function(W){delete l.getProperty()[W];});}k.setProperty(e.getId(),Object.assign({},l.getProperty(e.getId())?l.getProperty(e.getId()):{},j),l);};h.prototype._getControlFromMessageRelatingToSubSection=function(e,i){var j=i.getBindingContext("message").getObject();var k=e.findElements(true,function(a){return m(j.getControlIds(),a);}).sort(function(a,b){if(a.isA("sap.ui.mdc.Table")&&!b.isA("sap.ui.mdc.Table")){return-1;}return 1;});return k;};h.prototype._setGroupLabelForTransientMsg=function(a,b){this.sLastActionText=this.sLastActionText?this.sLastActionText:sap.ui.getCore().getLibraryResourceBundle("sap.fe.core").getText("T_MESSAGE_BUTTON_SAPFE_MESSAGE_GROUP_LAST_ACTION");a.setGroupName(this.sLastActionText+": "+b);};h.prototype._computeMessageGroupAndSubTitle=function(a,b,e,i,j,k){this.oItemBinding.detachChange(n,this);var R=a.getBindingContext("message").getObject();var T,U,V,W,X,Y,Z,$,l,a1,b1,c1=sap.ui.getCore().getLibraryResourceBundle("sap.fe.core"),d1=new RegExp("^/").test(R.getTarget()),e1,f1;if(d1){for(l=0;l<i.length;l++){T=i[l];b1=T;if(T.isA("sap.m.Table")||T.isA("sap.ui.table.Table")){U=T.getParent();X=U.getHeader();var g1=U.getRowBinding();if(g1&&g1.isLengthFinal()&&U.getBindingContext()){Z=E(U,R);var h1=z(U,Z);V=T.isA("sap.ui.table.Table")?g1.getContexts():g1.getCurrentContexts();$=h1.sTableTargetColName;Y=Z;Z=h1.sTableTargetColProperty;W=V.find(function(R,r1){return r1&&R.getTarget().indexOf(r1.getPath())===0;}.bind(this,R));var i1;if(!W){i1=R.controlIds.find(function(U,r1){return J(U,r1);}.bind(this,U));}if(i1){var j1=sap.ui.getCore().byId(i1);f1=K(j1);}N(a,V,W,$,c1,Y,U,f1);a1=W&&W.getIndex();this._updateInternalModel(W,a1,Z,U,R);}}else{a.setActiveTitle(true);var k1=P(b1,i);if(k1){a.setSubtitle("");break;}}}}else{b1=i[0];U=u(b1);if(U){X=U.getHeader();var l1=y(b1);Z=l1>-1?U.getColumns()[l1].getDataProperty():undefined;Y=Z;$=Z&&l1>-1?U.getColumns()[l1].getHeader():undefined;f1=w(b1).isA("sap.ui.table.CreationRow");if(!f1){a1=x(b1);V=U.getRowBinding().getCurrentContexts();W=V[a1];}N(a,V,W,$,c1,Y,U,f1);this._updateInternalModel(W,a1,Z,U,R,f1);if(W){var m1={rowIndex:W?a1:"",targetColProperty:Z?Z:""};e1=this._getBackendMessageToRemove(U,R,m1);}}}if(R.persistent&&k){this._setGroupLabelForTransientMsg(a,k);}else{a.setGroupName(b.getTitle()+(e.getTitle()&&j?", "+e.getTitle():"")+(X?", "+c1.getText("T_MESSAGE_GROUP_TITLE_TABLE_DENOMINATOR")+": "+X:""));var n1=this._getViewId(this.getId());var o1=sap.ui.getCore().byId(n1);var p1=R.getTarget()&&R.getTarget().split("/").pop();var q1=o1.getModel("internal");if(q1&&q1.getProperty("/messageTargetProperty")&&p1&&p1==q1.getProperty("/messageTargetProperty")){this.oMessagePopover.fireActiveTitlePress({"item":a});q1.setProperty("/messageTargetProperty",false);}}this.oItemBinding.attachChange(n,this);if(e1&&!d1){Q(e1);}return b1;};h.prototype._checkControlIdInSections=function(a,e){var b,l,V,R,i,j,k;this.sGeneralGroupText=this.sGeneralGroupText?this.sGeneralGroupText:sap.ui.getCore().getLibraryResourceBundle("sap.fe.core").getText("T_MESSAGE_BUTTON_SAPFE_MESSAGE_GROUP_GENERAL");V=this.getVisibleSectionsFromObjectPageLayout(this.oObjectPageLayout);if(V){var T=this._getViewId(this.getId());var U=sap.ui.getCore().byId(T);var W=U&&U.getBindingContext("internal")&&U.getBindingContext("internal").getProperty("sActionName");if(W){U.getBindingContext("internal").setProperty("sActionName",null);}for(i=a.length-1;i>=0;--i){R=a[i];var X=true;for(j=V.length-1;j>=0;--j){b=V[j];l=b.getSubSections();for(k=l.length-1;k>=0;--k){var Y=l[k];var Z=this._getControlFromMessageRelatingToSubSection(Y,R);if(Z.length>0){var $=this._computeMessageGroupAndSubTitle(R,b,Y,Z,l.length>1,W);if($&&!$.isA("sap.m.Table")&&!$.isA("sap.ui.table.Table")){j=k=-1;}X=false;}}}if(X){var a1=R.getBindingContext("message").getObject();R.setActiveTitle(false);if(a1.persistent&&W){this._setGroupLabelForTransientMsg(R,W);}else{R.setGroupName(this.sGeneralGroupText);}}if(!e&&R.getGroupName()===this.sGeneralGroupText&&this._findTargetForMessage(R)){return true;}}}};h.prototype._findTargetForMessage=function(a){var b=a.getBindingContext("message")&&a.getBindingContext("message").getObject();if(b&&b.target){var e=this.oObjectPageLayout&&this.oObjectPageLayout.getModel()&&this.oObjectPageLayout.getModel().getMetaModel(),i=e&&e.getMetaPath(b.target),j=e&&e.getObject(i);if(j&&j.$kind=="Property"){return true;}}};h.prototype._fnEnableBindings=function(a){for(var i=0;i<a.length;i++){var b=a[i];var e=false;var j=b.getSubSections();for(var k=0;k<j.length;k++){var l=j[k];var R=l.getBlocks();if(R){for(var T=0;T<l.getBlocks().length;T++){if(R[T].getContent&&!R[T].getContent().isA("sap.fe.macros.TableAPI")){e=true;break;}}if(e){l.setBindingContext(undefined);}}if(l.getBindingContext()&&this._findMessageGroupAfterRebinding()){l.getBindingContext().getBinding().attachDataReceived(this._findMessageGroupAfterRebinding());}}}};h.prototype._findMessageGroupAfterRebinding=function(){var a=this.oMessagePopover.getItems();this._checkControlIdInSections(a,true);};h.prototype._getViewId=function(a){var V,b=sap.ui.getCore().byId(a);while(b){if(b instanceof sap.ui.core.mvc.View){V=b.getId();break;}b=b.getParent();}return V;};return h;},true);
