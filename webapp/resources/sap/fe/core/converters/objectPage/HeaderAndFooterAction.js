/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["../ManifestSettings","sap/fe/core/converters/controls/Common/Action","sap/fe/core/converters/helpers/ConfigurableObject","sap/fe/core/helpers/BindingExpression","sap/fe/core/converters/helpers/Key","sap/fe/core/templating/DataModelPathHelper","../helpers/BindingHelper"],function(M,A,C,B,K,D,a){"use strict";var _={};var U=a.UI;var s=a.singletonPathVisitor;var b=a.Draft;var i=D.isPathDeletable;var c=K.KeyHelper;var d=B.constant;var e=B.ifElse;var f=B.and;var g=B.fn;var h=B.equal;var n=B.not;var j=B.compileBinding;var k=B.annotationExpression;var P=C.Placement;var l=A.getSemanticObjectMapping;var m=A.getEnabledForAnnotationAction;var o=A.ButtonType;var p=M.ActionType;function q(E,F){var G,H,J;return((G=E.annotations)===null||G===void 0?void 0:(H=G.UI)===null||H===void 0?void 0:(J=H.Identification)===null||J===void 0?void 0:J.filter(function(L){var N,O,Q;if((L===null||L===void 0?void 0:(N=L.annotations)===null||N===void 0?void 0:(O=N.UI)===null||O===void 0?void 0:(Q=O.Hidden)===null||Q===void 0?void 0:Q.valueOf())!==true){var R,S,T,V,W;if((L===null||L===void 0?void 0:L.$Type)==="com.sap.vocabularies.UI.v1.DataFieldForAction"&&!!L.Determining===F&&(!(L!==null&&L!==void 0&&(R=L.ActionTarget)!==null&&R!==void 0&&R.isBound)||(L===null||L===void 0?void 0:(S=L.ActionTarget)===null||S===void 0?void 0:(T=S.annotations)===null||T===void 0?void 0:(V=T.Core)===null||V===void 0?void 0:(W=V.OperationAvailable)===null||W===void 0?void 0:W.valueOf())!==false)){return true;}}return false;}))||[];}_.getIdentificationDataFieldForActions=q;function r(E,F){var G,H,J;return((G=E.annotations)===null||G===void 0?void 0:(H=G.UI)===null||H===void 0?void 0:(J=H.Identification)===null||J===void 0?void 0:J.filter(function(L){var N,O,Q;if((L===null||L===void 0?void 0:(N=L.annotations)===null||N===void 0?void 0:(O=N.UI)===null||O===void 0?void 0:(Q=O.Hidden)===null||Q===void 0?void 0:Q.valueOf())!==true){if((L===null||L===void 0?void 0:L.$Type)==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"&&!!L.Determining===F){return true;}}return false;}))||[];}var I=["UI.CriticalityType/VeryPositive","UI.CriticalityType/Positive","UI.CriticalityType/Negative","UI.CriticalityType/VeryNegative"];function t(E,F){var G=E.getDataModelObjectPath(),H=G.navigationProperties.map(function(Q){return Q.name;}),J=k(F,H,undefined,function(Q){return s(Q,E,[]);}),L=E.getManifestWrapper(),N=L.getViewLevel(),O=N>1?U.IsEditable:n(U.IsEditable);return e(F===undefined||F.valueOf()===false,O,f(O,h(J,false)));}_.getDeleteButtonVisibility=t;function u(E,F){return e(F!==undefined,F,e(E!==undefined,h(E,true),d(true)));}_.getDeleteButtonEnabled=u;function v(E,F){var G;var H=E.getEntitySet(),J=H&&(G=H.annotations.Common)!==null&&G!==void 0&&G.DraftRoot?true:false,L=E.getDataModelObjectPath(),N=L.navigationProperties.map(function(S){return S.name;}),O=k(F,N,undefined,function(S){return s(S,E,N);}),Q=n(U.IsEditable);var R=e(F===undefined||F.valueOf()===false,Q,f(Q,h(O,false)));return e(J,f(R,b.HasNoDraftForCurrentUser),R);}_.getEditButtonVisibility=v;function w(E){var F,G;var H=E.getEntitySet(),J=H&&(F=H.annotations.Common)!==null&&F!==void 0&&F.DraftRoot?true:false,L=H&&(G=H.annotations.Session)!==null&&G!==void 0&&G.StickySessionSupported?true:false;var N;if(J){var O,Q;N=H===null||H===void 0?void 0:(O=H.annotations.Common)===null||O===void 0?void 0:(Q=O.DraftRoot)===null||Q===void 0?void 0:Q.EditAction;}else if(L){var R,S;N=H===null||H===void 0?void 0:(R=H.annotations.Session)===null||R===void 0?void 0:(S=R.StickySessionSupported)===null||S===void 0?void 0:S.EditAction;}if(N){var T,V;var W=E.getAbsoluteAnnotationPath(N),X=(T=E.getEntityTypeAnnotation(W))===null||T===void 0?void 0:(V=T.annotation)===null||V===void 0?void 0:V.actions;if(X!==null&&X!==void 0&&X.length){var Y,Z;var $=X[0];if(($===null||$===void 0?void 0:(Y=$.annotations)===null||Y===void 0?void 0:(Z=Y.Core)===null||Z===void 0?void 0:Z.OperationAvailable)===null){return"{= ${#"+N+"} ? true : false }";}else{return m(E,$);}}}return true;}_.getEditButtonEnabled=w;function x(E){var F,G,H,J,L,N,O,Q;var R=E.getEntitySet(),S=E.getEntityType(),T=R&&((F=R.annotations)===null||F===void 0?void 0:(G=F.Session)===null||G===void 0?void 0:G.StickySessionSupported),V=R&&((H=R.annotations.Common)===null||H===void 0?void 0:H.DraftRoot),W=R&&((J=R.annotations)===null||J===void 0?void 0:(L=J.Capabilities)===null||L===void 0?void 0:L.DeleteRestrictions),X=R&&((N=R.annotations.UI)===null||N===void 0?void 0:(O=N.UpdateHidden)===null||O===void 0?void 0:O.valueOf()),Y=E.getDataModelObjectPath(),Z=i(Y),$=Z?j(Z):Z,a1=q(E.getEntityType(),false);var b1=a1.filter(function(n1){return I.indexOf(n1===null||n1===void 0?void 0:n1.Criticality)>-1;}).map(function(n1){var o1,p1;return{type:p.DataFieldForAction,annotationPath:E.getEntitySetBasedAnnotationPath(n1.fullyQualifiedName),key:c.generateKeyFromDataField(n1),visible:j(n(h(k((o1=n1.annotations)===null||o1===void 0?void 0:(p1=o1.UI)===null||p1===void 0?void 0:p1.Hidden),true))),enabled:m(E,n1.ActionTarget),isNavigable:true};});if((V!==null&&V!==void 0&&V.EditAction||T!==null&&T!==void 0&&T.EditAction)&&X!==true){var c1,d1,e1,f1;var g1=(R===null||R===void 0?void 0:(c1=R.annotations.UI)===null||c1===void 0?void 0:(d1=c1.UpdateHidden)===null||d1===void 0?void 0:d1.valueOf())!==undefined?R===null||R===void 0?void 0:(e1=R.annotations.UI)===null||e1===void 0?void 0:e1.UpdateHidden:S===null||S===void 0?void 0:(f1=S.annotations.UI)===null||f1===void 0?void 0:f1.UpdateHidden;b1.push({type:p.Primary,key:"EditAction",visible:j(v(E,g1)),enabled:w(E)});}if($&&$!=="false"||(W===null||W===void 0?void 0:(Q=W.Deletable)===null||Q===void 0?void 0:Q.valueOf())!==false&&$!=="false"){var h1,i1,j1,k1;var l1=(R===null||R===void 0?void 0:(h1=R.annotations.UI)===null||h1===void 0?void 0:(i1=h1.DeleteHidden)===null||i1===void 0?void 0:i1.valueOf())!==undefined?R===null||R===void 0?void 0:(j1=R.annotations.UI)===null||j1===void 0?void 0:j1.DeleteHidden:S===null||S===void 0?void 0:(k1=S.annotations.UI)===null||k1===void 0?void 0:k1.DeleteHidden;b1.push({type:p.Secondary,key:"DeleteAction",visible:j(t(E,l1)),enabled:j(u(W===null||W===void 0?void 0:W.Deletable,Z)),parentEntityDeleteEnabled:$});}if(V!==null&&V!==void 0&&V.EditAction&&X!==true){b1.push({type:p.SwitchToActiveObject,key:"SwitchToActiveObject"});b1.push({type:p.SwitchToDraftObject,key:"SwitchToDraftObject"});}var m1=r(E.getEntityType(),false);m1.filter(function(n1){return I.indexOf(n1===null||n1===void 0?void 0:n1.Criticality)===-1;}).map(function(n1){var o1,p1,q1,r1,s1,t1,u1;var v1={semanticObjectMapping:n1.Mapping?l(n1.Mapping):[]};if(((o1=n1.RequiresContext)===null||o1===void 0?void 0:o1.valueOf())===true){throw new Error("RequiresContext property should not be true for header IBN action : "+n1.Label);}else if(((p1=n1.Inline)===null||p1===void 0?void 0:p1.valueOf())===true){throw new Error("Inline property should not be true for header IBN action : "+n1.Label);}b1.push({type:p.DataFieldForIntentBasedNavigation,text:(q1=n1.Label)===null||q1===void 0?void 0:q1.toString(),annotationPath:E.getEntitySetBasedAnnotationPath(n1.fullyQualifiedName),buttonType:o.Ghost,visible:j(n(h(k((r1=n1.annotations)===null||r1===void 0?void 0:(s1=r1.UI)===null||s1===void 0?void 0:(t1=s1.Hidden)===null||t1===void 0?void 0:t1.valueOf()),true))),enabled:n1.NavigationAvailable!==undefined?j(h(k((u1=n1.NavigationAvailable)===null||u1===void 0?void 0:u1.valueOf()),true)):true,key:c.generateKeyFromDataField(n1),isNavigable:true,press:j(g("._intentBasedNavigation.navigate",[k(n1.SemanticObject),k(n1.Action),v1])),customData:j({semanticObject:k(n1.SemanticObject),action:k(n1.Action)})});});a1.filter(function(n1){return I.indexOf(n1===null||n1===void 0?void 0:n1.Criticality)===-1;}).map(function(n1){var o1,p1;b1.push({type:p.DataFieldForAction,annotationPath:E.getEntitySetBasedAnnotationPath(n1.fullyQualifiedName),key:c.generateKeyFromDataField(n1),visible:j(n(h(k((o1=n1.annotations)===null||o1===void 0?void 0:(p1=o1.UI)===null||p1===void 0?void 0:p1.Hidden),true))),enabled:m(E,n1.ActionTarget),isNavigable:true});});return b1;}_.getHeaderDefaultActions=x;function y(E){var F,G,H;var J=E.getEntityType();var L=((F=J.annotations)===null||F===void 0?void 0:(G=F.UI)===null||G===void 0?void 0:(H=G.Identification)===null||H===void 0?void 0:H.filter(function(N){var O,Q,R;return(N===null||N===void 0?void 0:(O=N.annotations)===null||O===void 0?void 0:(Q=O.UI)===null||Q===void 0?void 0:(R=Q.Hidden)===null||R===void 0?void 0:R.valueOf())===true;}))||[];return L.map(function(N){return{type:p.Default,key:c.generateKeyFromDataField(N)};});}_.getHiddenHeaderActions=y;function z(E,F){var G,H,J,L,N,O,Q;var R=F.getEntitySet();var S=F.getEntityType();var T=R&&((G=R.annotations)===null||G===void 0?void 0:(H=G.Session)===null||H===void 0?void 0:H.StickySessionSupported),V=R&&(((J=R.annotations.Common)===null||J===void 0?void 0:(L=J.DraftRoot)===null||L===void 0?void 0:L.term)||((N=R.annotations)===null||N===void 0?void 0:(O=N.Session)===null||O===void 0?void 0:(Q=O.StickySessionSupported)===null||Q===void 0?void 0:Q.term)),W=V==="com.sap.vocabularies.Common.v1.DraftRoot"||T&&(T===null||T===void 0?void 0:T.SaveAction),X=E>1,Y=V==="com.sap.vocabularies.Common.v1.DraftRoot"||T&&(T===null||T===void 0?void 0:T.DiscardAction);var Z=q(F.getEntityType(),true);var $=Z.filter(function(a1){return I.indexOf(a1===null||a1===void 0?void 0:a1.Criticality)>-1;}).map(function(a1){var b1,c1;return{type:p.DataFieldForAction,annotationPath:F.getEntitySetBasedAnnotationPath(a1.fullyQualifiedName),key:c.generateKeyFromDataField(a1),visible:j(n(h(k((b1=a1.annotations)===null||b1===void 0?void 0:(c1=b1.UI)===null||c1===void 0?void 0:c1.Hidden),true))),enabled:m(F,a1.ActionTarget),isNavigable:true};});if((R===null||R===void 0?void 0:R.entityTypeName)===(S===null||S===void 0?void 0:S.fullyQualifiedName)&&W){$.push({type:p.Primary,key:"SaveAction"});}if(X){$.push({type:p.DefaultApply,key:"ApplyAction"});}Z.filter(function(a1){return I.indexOf(a1===null||a1===void 0?void 0:a1.Criticality)===-1;}).map(function(a1){var b1,c1;$.push({type:p.DataFieldForAction,annotationPath:F.getEntitySetBasedAnnotationPath(a1.fullyQualifiedName),key:c.generateKeyFromDataField(a1),visible:j(n(h(k((b1=a1.annotations)===null||b1===void 0?void 0:(c1=b1.UI)===null||c1===void 0?void 0:c1.Hidden),true))),enabled:m(F,a1.ActionTarget),isNavigable:true});});if(Y){$.push({type:p.Secondary,key:"CancelAction",position:{placement:P.End}});}return $;}_.getFooterDefaultActions=z;return _;},false);
