/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/BindingExpression","sap/fe/core/converters/helpers/BindingHelper","sap/fe/core/templating/PropertyHelper","sap/fe/core/templating/DataModelPathHelper","sap/fe/core/templating/FieldControlHelper","sap/fe/core/formatters/ValueFormatter"],function(M,B,a,P,D,F,v){"use strict";var _={};var i=F.isDisabledExpression;var b=F.isNonEditableExpression;var c=F.isReadOnlyExpression;var g=D.getPathRelativeLocation;var d=D.isPathUpdatable;var e=D.getTargetEntitySetPath;var f=P.isProperty;var h=P.isPathExpression;var j=P.isKey;var k=P.isImmutable;var l=P.isComputed;var m=P.hasValueHelp;var n=P.getAssociatedCurrencyProperty;var o=P.getAssociatedUnitProperty;var U=a.UI;var p=B.or;var q=B.not;var r=B.isTruthy;var s=B.isConstant;var t=B.ifElse;var u=B.formatResult;var w=B.equal;var x=B.constant;var y=B.compileBinding;var z=B.annotationExpression;var A=B.and;var C=B.addTypeInformation;var E=M.getInvolvedDataModelObjects;var G=M.convertMetaModelContext;var H={"Edm.Boolean":{type:"sap.ui.model.odata.type.Boolean"},"Edm.Byte":{type:"sap.ui.model.odata.type.Byte"},"Edm.Date":{type:"sap.ui.model.odata.type.Date"},"Edm.DateTimeOffset":{constraints:{"$Precision":"precision"},type:"sap.ui.model.odata.type.DateTimeOffset"},"Edm.Decimal":{constraints:{"@Org.OData.Validation.V1.Minimum/$Decimal":"minimum","@Org.OData.Validation.V1.Minimum@Org.OData.Validation.V1.Exclusive":"minimumExclusive","@Org.OData.Validation.V1.Maximum/$Decimal":"maximum","@Org.OData.Validation.V1.Maximum@Org.OData.Validation.V1.Exclusive":"maximumExclusive","$Precision":"precision","$Scale":"scale"},type:"sap.ui.model.odata.type.Decimal"},"Edm.Double":{type:"sap.ui.model.odata.type.Double"},"Edm.Guid":{type:"sap.ui.model.odata.type.Guid"},"Edm.Int16":{type:"sap.ui.model.odata.type.Int16"},"Edm.Int32":{type:"sap.ui.model.odata.type.Int32"},"Edm.Int64":{type:"sap.ui.model.odata.type.Int64"},"Edm.SByte":{type:"sap.ui.model.odata.type.SByte"},"Edm.Single":{type:"sap.ui.model.odata.type.Single"},"Edm.Stream":{type:"sap.ui.model.odata.type.Stream"},"Edm.String":{constraints:{"@com.sap.vocabularies.Common.v1.IsDigitSequence":"isDigitSequence","$MaxLength":"maxLength","$Nullable":"nullable"},type:"sap.ui.model.odata.type.String"},"Edm.TimeOfDay":{constraints:{"$Precision":"precision"},type:"sap.ui.model.odata.type.TimeOfDay"}};_.EDM_TYPE_MAPPING=H;var I=function(a1){var b1=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var c1=arguments.length>2?arguments[2]:undefined;var d1=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;if(!a1||typeof a1==="string"){return y(false);}var e1=true;if(b1!==null){e1=t(b(b1),false,U.IsEditable);}var f1=h(a1)&&a1.$target||a1;var g1=d(c1,a1);var h1=t(p(q(g1),l(f1),j(f1),k(f1),b(f1)),t(p(l(f1),b(f1)),false,U.IsTransientBinding),U.IsEditable);if(d1){return A(h1,e1);}return y(A(h1,e1));};_.getEditableExpression=I;var J=function(a1,b1){var c1=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(!a1||typeof a1==="string"){return y(true);}var d1=true;if(b1!==null){d1=t(i(b1),false,true);}var e1=h(a1)&&a1.$target||a1;var f1=t(i(e1),false,true);if(c1){return A(f1,d1);}return y(A(f1,d1));};_.getEnabledExpression=J;var K=function(a1,b1){var c1=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var d1=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var e1=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;if(!a1||typeof a1==="string"){return"Display";}var f1=h(a1)&&a1.$target||a1;var g1=I(a1,e1,b1,true);var h1=J(a1,e1,true);var i1=n(f1);var j1=i1||o(f1);var k1="Editable";if(j1){k1=t(p(c(j1),l(j1),c1),"EditableReadOnly","Editable");}var l1=p(c(f1),c(e1));var m1=t(h1,t(g1,k1,t(A(!s(l1)&&l1,U.IsEditable),"ReadOnly","Display")),t(U.IsEditable,"Disabled","Display"));if(d1){return m1;}return y(m1);};_.getEditMode=K;var L=function(a1){var b1,c1,d1,e1;var f1=a1.targetObject;var g1=(b1=f1.annotations)===null||b1===void 0?void 0:(c1=b1.Measures)===null||c1===void 0?void 0:c1.ISOCurrency;var h1=g1?g1:(d1=f1.annotations)===null||d1===void 0?void 0:(e1=d1.Measures)===null||e1===void 0?void 0:e1.Unit;if(h1){return y(p(r(z(h1)),q(U.IsTotal)));}else{return y(x(true));}};_.hasValidAnalyticalCurrencyOrUnit=L;var N=function(a1,b1,c1){var d1=h(a1)&&a1.$target||a1;var e1=n(d1)||o(d1);if(!e1){return y(c1);}var f1=A(q(c(e1)),q(l(e1)));return y(t(f1,b1,c1));};_.ifUnitEditable=N;var O=function(a1,b1){var c1,d1,e1,f1,g1,h1,i1,j1,k1,l1,m1;if(!a1||typeof a1==="string"){return"Value";}var n1=h(a1)&&a1.$target||a1;var o1=b1&&b1.targetEntityType;var p1=(c1=n1.annotations)===null||c1===void 0?void 0:(d1=c1.Common)===null||d1===void 0?void 0:d1.Text;var q1=typeof p1!=="string"&&(p1===null||p1===void 0?void 0:(e1=p1.annotations)===null||e1===void 0?void 0:(f1=e1.UI)===null||f1===void 0?void 0:(g1=f1.TextArrangement)===null||g1===void 0?void 0:g1.toString())||(o1===null||o1===void 0?void 0:(h1=o1.annotations)===null||h1===void 0?void 0:(i1=h1.UI)===null||i1===void 0?void 0:(j1=i1.TextArrangement)===null||j1===void 0?void 0:j1.toString());var r1=p1?"DescriptionValue":"Value";if(p1&&q1||o1!==null&&o1!==void 0&&(k1=o1.annotations)!==null&&k1!==void 0&&(l1=k1.UI)!==null&&l1!==void 0&&(m1=l1.TextArrangement)!==null&&m1!==void 0&&m1.toString()){if(q1==="UI.TextArrangementType/TextOnly"){r1="Description";}else if(q1==="UI.TextArrangementType/TextLast"){r1="ValueDescription";}else if(q1==="UI.TextArrangementType/TextSeparate"){r1="Value";}else{r1="DescriptionValue";}}return r1;};_.getDisplayMode=O;var Q=function(a1,b1,c1){var d1=h(a1)&&a1.$target||a1;return m(d1)?y(b1):y(t(w(c1,"Editable"),"Value",b1));};_.getFieldDisplay=Q;var R=function(a1,b1){var c1=b1;if(a1._type==="Property"){var d1=H[a1.type];if(d1){var e1,f1;c1.type=d1.type;if(d1.constraints){var g1,h1,i1,j1;c1.constraints={};if(d1.constraints.$Scale&&a1.scale!==undefined){c1.constraints.scale=a1.scale;}if(d1.constraints.$Precision&&a1.precision!==undefined){c1.constraints.precision=a1.precision;}if(d1.constraints.$MaxLength&&a1.maxLength!==undefined){c1.constraints.maxLength=a1.maxLength;}if(d1.constraints.$Nullable&&a1.nullable===false){c1.constraints.nullable=a1.nullable;}if(d1.constraints["@Org.OData.Validation.V1.Minimum/$Decimal"]&&((g1=a1.annotations)===null||g1===void 0?void 0:(h1=g1.Validation)===null||h1===void 0?void 0:h1.Minimum)!==undefined&&!isNaN(a1.annotations.Validation.Minimum)){c1.constraints.minimum="".concat(a1.annotations.Validation.Minimum);}if(d1.constraints["@Org.OData.Validation.V1.Maximum/$Decimal"]&&((i1=a1.annotations)===null||i1===void 0?void 0:(j1=i1.Validation)===null||j1===void 0?void 0:j1.Maximum)!==undefined&&!isNaN(a1.annotations.Validation.Maximum)){c1.constraints.maximum="".concat(a1.annotations.Validation.Maximum);}}if((c1===null||c1===void 0?void 0:(e1=c1.type)===null||e1===void 0?void 0:e1.indexOf("sap.ui.model.odata.type.Int"))===0){if(!c1.formatOptions){c1.formatOptions={};}c1.formatOptions=Object.assign(c1.formatOptions,{parseAsString:false,emptyString:""});}if(c1.type==="sap.ui.model.odata.type.String"){var k1,l1,m1;if(!c1.formatOptions){c1.formatOptions={};}c1.formatOptions.parseKeepsEmptyString=true;if((k1=d1.constraints)!==null&&k1!==void 0&&k1["@com.sap.vocabularies.Common.v1.IsDigitSequence"]&&(l1=a1.annotations)!==null&&l1!==void 0&&(m1=l1.Common)!==null&&m1!==void 0&&m1.IsDigitSequence){c1.constraints.isDigitSequence=true;}}if((c1===null||c1===void 0?void 0:(f1=c1.type)===null||f1===void 0?void 0:f1.indexOf("sap.ui.model.odata.type.Double"))===0){if(!c1.formatOptions){c1.formatOptions={};}c1.formatOptions=Object.assign(c1.formatOptions,{parseAsString:false,emptyString:""});}}}return c1;};_.formatWithTypeInformation=R;var S=function(a1,b1){var c1,d1,e1,f1;var g1=H[a1===null||a1===void 0?void 0:a1.type]||(b1?H[b1]:undefined);var h1={type:g1.type,constraints:{},formatOptions:{}};if(f(a1)){var i1,j1,k1,l1,m1,n1,o1,p1,q1,r1,s1,t1,u1,v1,w1,x1,y1;h1.constraints={scale:(i1=g1.constraints)!==null&&i1!==void 0&&i1.$Scale?a1.scale:undefined,precision:(j1=g1.constraints)!==null&&j1!==void 0&&j1.$Precision?a1.precision:undefined,maxLength:(k1=g1.constraints)!==null&&k1!==void 0&&k1.$MaxLength?a1.maxLength:undefined,nullable:(l1=g1.constraints)!==null&&l1!==void 0&&l1.$Nullable?a1.nullable:undefined,minimum:(m1=g1.constraints)!==null&&m1!==void 0&&m1["@Org.OData.Validation.V1.Minimum/$Decimal"]&&!isNaN((n1=a1.annotations)===null||n1===void 0?void 0:(o1=n1.Validation)===null||o1===void 0?void 0:o1.Minimum)?"".concat((p1=a1.annotations)===null||p1===void 0?void 0:(q1=p1.Validation)===null||q1===void 0?void 0:q1.Minimum):undefined,maximum:(r1=g1.constraints)!==null&&r1!==void 0&&r1["@Org.OData.Validation.V1.Maximum/$Decimal"]&&!isNaN((s1=a1.annotations)===null||s1===void 0?void 0:(t1=s1.Validation)===null||t1===void 0?void 0:t1.Maximum)?"".concat((u1=a1.annotations)===null||u1===void 0?void 0:(v1=u1.Validation)===null||v1===void 0?void 0:v1.Maximum):undefined,isDigitSequence:h1.type==="sap.ui.model.odata.type.String"&&(w1=g1.constraints)!==null&&w1!==void 0&&w1["@com.sap.vocabularies.Common.v1.IsDigitSequence"]&&(x1=a1.annotations)!==null&&x1!==void 0&&(y1=x1.Common)!==null&&y1!==void 0&&y1.IsDigitSequence?true:undefined};}h1.formatOptions={parseAsString:(h1===null||h1===void 0?void 0:(c1=h1.type)===null||c1===void 0?void 0:c1.indexOf("sap.ui.model.odata.type.Int"))===0||(h1===null||h1===void 0?void 0:(d1=h1.type)===null||d1===void 0?void 0:d1.indexOf("sap.ui.model.odata.type.Double"))===0?false:undefined,emptyString:(h1===null||h1===void 0?void 0:(e1=h1.type)===null||e1===void 0?void 0:e1.indexOf("sap.ui.model.odata.type.Int"))===0||(h1===null||h1===void 0?void 0:(f1=h1.type)===null||f1===void 0?void 0:f1.indexOf("sap.ui.model.odata.type.Double"))===0?"":undefined,parseKeepsEmptyString:h1.type==="sap.ui.model.odata.type.String"?true:undefined};return h1;};_.getTypeConfig=S;var T=function(a1,b1){var c1,d1,e1,f1,g1;var h1=a1.targetObject;var i1=(c1=h1.annotations)===null||c1===void 0?void 0:(d1=c1.Measures)===null||d1===void 0?void 0:d1.Unit;var j1=g(a1.contextLocation,a1.navigationProperties).map(function(np){return np.name;});b1=R(h1,b1);if(((e1=i1)===null||e1===void 0?void 0:e1.toString())==="%"){return u([b1],v.formatWithPercentage);}var k1=i1?"sap.ui.model.odata.type.Unit":"sap.ui.model.odata.type.Currency";i1=i1?i1:(f1=h1.annotations)===null||f1===void 0?void 0:(g1=f1.Measures)===null||g1===void 0?void 0:g1.ISOCurrency;var l1=i1.$target?R(i1.$target,z(i1,j1)):z(i1,j1);return C([b1,l1],k1);};_.getBindingWithUnitOrCurrency=T;var V=function(a1){var b1=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"Begin";var c1=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"Begin";return y(t(w(a1,"Display"),b1,c1));};_.getAlignmentExpression=V;var W=function(a1,b1){if(b1&&b1.context){return G(b1.context);}return null;};W.requiresIContext=true;_.getConverterContext=W;var X=function(a1,b1){if(b1&&b1.context){return E(b1.context);}return null;};X.requiresIContext=true;_.getDataModelObjectPath=X;var Y=function(a1){return y(a1);};_.getExpressionBinding=Y;var Z=function(a1){if(a1){var b1=E(a1);return e(b1);}return null;};_.getTargetEntitySet=Z;var $=function(a1){var b1;if((b1=a1.navigationProperties)!==null&&b1!==void 0&&b1.length){var c1=(a1===null||a1===void 0?void 0:a1.navigationProperties.findIndex(function(d1){if(d1.isCollection){var e1,f1;if((e1=a1.contextLocation)!==null&&e1!==void 0&&(f1=e1.navigationProperties)!==null&&f1!==void 0&&f1.length){var g1;return((g1=a1.contextLocation)===null||g1===void 0?void 0:g1.navigationProperties.findIndex(function(h1){return h1.name===d1.name;}))===-1;}return true;}return false;}))>-1;if(c1){return true;}}return false;};_.isCollectionField=$;return _;},false);
