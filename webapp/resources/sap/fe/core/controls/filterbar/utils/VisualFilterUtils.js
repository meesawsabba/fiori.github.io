/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2021 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/fe/core/templating/FilterHelper","sap/ui/core/format/NumberFormat","sap/ui/mdc/condition/Condition","sap/base/Log"],function(F,N,C,L){"use strict";return{applyMedianScaleToChartData:function(I,v,V,s){var a;var d=[];var m=I.data("measure");var o=v.getBindingContext("internal");a=(I.getPoints&&I.getPoints())||(I.getBars&&I.getBars())||(I.getSegments&&I.getSegments());for(var i=0;i<a.length;i++){d.push(a[i].getBindingContext().getObject());}var b=this._getMedianScaleFactor(d,m);if(b&&b.iShortRefNumber&&b.scale){o.setProperty("scalefactor/"+s,b.scale);o.setProperty("scalefactorNumber/"+s,b.iShortRefNumber);}else{o.setProperty("scalefactor/"+s,"");o.setProperty("scalefactorNumber/"+s,"");var S=v.byId(V+"::ScaleUoMTitle");var M=v.byId(V+"::MeasureDimensionTitle");var t=S.getText();if(t===" | "){S.setVisible(false);M.setTooltip(M.getText());}}},_getMedianScaleFactor:function(d,m){d.sort(function(a,b){if(Number(a[m])<Number(b[m])){return-1;}if(Number(a[m])>Number(b[m])){return 1;}return 0;});if(d.length>0){var M=d.length/2,c=M%1===0?(parseFloat(d[M-1][m])+parseFloat(d[M][m]))/2:parseFloat(d[Math.floor(M)][m]),v=c,s;for(var i=0;i<14;i++){s=Math.pow(10,i);if(Math.round(Math.abs(v)/s)<10){break;}}}var f=N.getIntegerInstance({style:"short",showScale:false,shortRefNumber:s});for(var i=0;i<d.length;i++){var D=d[i],S=f.format(D[m]),e=S.split(".");if((!e[1]&&parseInt(e[0],10)===0)||(e[1]&&parseInt(e[0],10)===0&&e[1].indexOf("0")===0)||S/1000>=1000){s=undefined;break;}}return{iShortRefNumber:s,scale:s?f.getScale():""};},getFormattedNumber:function(v,s,n,c){v=typeof v==="string"?Number(v.replace(/,/g,"")):v;if(c){var a=N.getCurrencyInstance({showMeasure:false});return a.format(parseFloat(v),c);}else if(s){var f=N.getFloatInstance({style:"short",showScale:false,shortRefNumber:s,shortDecimals:n});return f.format(parseFloat(v));}else{var f=N.getFloatInstance({decimals:n});return f.format(parseFloat(v));}},applyUOMToTitle:function(i,c,v,I){var u=i.data("uom"),U;var s;if(u&&u["ISOCurrency"]){U=u["ISOCurrency"];s=U.$Path?c[U.$Path]:U;}else if(u&&u["Unit"]){U=u["Unit"];}if(U){var a=U.$Path?c[U.$Path]:U;var o=v.getBindingContext("internal");o.setProperty("uom/"+I,a);if(s){o.setProperty("currency/"+I,a);}}},updateChartScaleFactorTitle:function(i,v,V,I){if(!i.data("scalefactor")){this.applyMedianScaleToChartData(i,v,V,I);}else{var f=N.getIntegerInstance({style:"short",showScale:false,shortRefNumber:i.data("scalefactor")});var o=v.getBindingContext("internal");o.setProperty("scalefactor/"+I,f.getScale());}},applyErrorMessageAndTitle:function(s,a,i,v){var I=v.getBindingContext("internal");I.setProperty(i,{});I.setProperty(i,{"errorMessageTitle":s,"errorMessage":a,"showError":true});},checkMulitUnit:function(c,u){var d=[];if(c&&u){for(var i=0;i<c.length;i++){var a=c[i]&&c[i].getObject();d.push(a[u]);}}return!!d.reduce(function(b,k){return b===k?b:NaN;});},setMultiUOMMessage:function(d,i,I,r,v){var u=i.data("uom");var s=u&&u["ISOCurrency"]&&u["ISOCurrency"].$Path;var a=u&&u["Unit"]&&u["Unit"].$Path;var U=s||a;var b,c;if(U){if(!this.checkMulitUnit(d,U)){if(s){b=r.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE");c=r.getText("M_VISUAL_FILTERS_MULTIPLE_CURRENCY",U);this.applyErrorMessageAndTitle(b,c,I,v);L.warning("Filter is set for multiple Currency for"+U);}else if(a){b=r.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE");c=r.getText("M_VISUAL_FILTERS_MULTIPLE_UNIT",U);this.applyErrorMessageAndTitle(b,c,I,v);L.warning("Filter is set for multiple UOMs for"+U);}}}},setNoDataMessage:function(i,r,v){var s=r.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE");var a=r.getText("M_VISUAL_FILTER_NO_DATA_TEXT");this.applyErrorMessageAndTitle(s,a,i,v);},convertFilterCondions:function(f){var c={};Object.keys(f).forEach(function(k){var a=[];var b=f[k];for(var i=0;i<b.length;i++){var v=b[i].value2?[b[i].value1,b[i].value2]:[b[i].value1];a.push(C.createCondition(b[i].operator,v,null,null,"Validated"));}if(a.length){c[k]=a;}});return c;},getCustomConditions:function(R,v,p){var a,b;if(v.$Type==="Edm.DateTimeOffset"){a=this._parseDateTime(F.getTypeCompliantValue(this._formatDateTime(R.Low),v.$Type));b=R.High?this._parseDateTime(F.getTypeCompliantValue(this._formatDateTime(R.High),v.$Type)):null;}else{a=R.Low;b=R.High?R.High:null;}return{operator:R.Option?F.getOperator(R.Option.$EnumMember||R.Option):null,value1:a,value2:b,path:p};},_parseDateTime:function(v){return this._getDateTimeTypeInstance().parseValue(v,"string");},_formatDateTime:function(v){return this._getDateTimeTypeInstance().formatValue(v,"string");},_getDateTimeTypeInstance:function(){return new sap.ui.model.odata.type.DateTimeOffset({pattern:"yyyy-MM-ddTHH:mm:ssZ",calendarType:"Gregorian"},{V4:true});}};});
