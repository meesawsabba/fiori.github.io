/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2021 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/base/util/ObjectPath","sap/base/util/extend","sap/base/Log","sap/ui/core/XMLTemplateProcessor","sap/ui/core/util/XMLPreprocessor","sap/ui/core/Fragment","sap/ui/model/json/JSONModel","sap/ui/core/mvc/ControllerExtension","sap/ui/core/mvc/OverrideExecution","sap/ui/core/routing/HashChanger","sap/m/library"],function(O,e,L,X,a,F,J,C,b,H,l){"use strict";var o;var S=C.extend("sap.fe.core.controllerextensions.Share",{metadata:{methods:{openShareSheet:{"public":true,"final":true},adaptShareMetadata:{"public":true,"final":false,overrideExecution:b.After}}},openShareSheet:function(c){this._openShareSheetImpl(c);},adaptShareMetadata:function(s){return s;},_openShareSheetImpl:function(c){var t=this,s,f,h=H.getInstance().getHash(),B=H.getInstance().hrefForAppSpecificHash?H.getInstance().hrefForAppSpecificHash(""):"",d={url:h?B+h:window.location.hash,title:document.title,email:{url:"",title:""},jam:{url:"",title:""},tile:{url:"",title:"",subtitle:"",icon:"",queryUrl:""}};o=c;return Promise.resolve(t.adaptShareMetadata(d)).then(function(m){f={shareEmailPressed:function(){var r=sap.ui.getCore().getLibraryResourceBundle("sap.fe.core");var E=m.email.title?m.email.title:r.getText("T_SHARE_UTIL_HELPER_SAPFE_EMAIL_SUBJECT",[m.title]);l.URLHelper.triggerEmail(null,E,window.location.origin+window.location.pathname+(m.email.url?m.email.url:m.url));},onSaveTilePress:function(){setTimeout(function(){sap.ui.getCore().byId("bookmarkDialog").attachAfterClose(function(){o.focus();});},0);},shareJamPressed:function(){t._doOpenJamShareDialog(m.jam.title?m.jam.title:m.title,m.jam.url?m.jam.url:window.location.origin+window.location.pathname+m.url);}};f.onCancelPressed=function(){s.close();};f.setShareSheet=function(k){c.shareSheet=k;};var T=new J({}),p={bindingContexts:{"this":T.createBindingContext("/")},models:{"this":T}};var g={title:m.tile.title?m.tile.title:m.title,subtitle:m.tile.subtitle,icon:m.tile.icon,url:m.tile.url?m.tile.url:m.url,queryUrl:m.tile.queryUrl};if(c.shareSheet){s=c.shareSheet;var i=s.getModel("share");t._setStaticShareData(i);var n=e(i.getData(),g);i.setData(n);s.openBy(c);}else{var j="sap.fe.macros.share.ShareSheet",P=X.loadTemplate(j,"fragment");Promise.resolve(a.process(P,{name:j},p)).then(function(k){return F.load({definition:k,controller:f});}).then(function(A){s=A;s.setModel(new J(g||{}),"share");var i=s.getModel("share");t._setStaticShareData(i);var n=e(i.getData(),g);i.setData(n);c.addDependent(s);s.openBy(c);f.setShareSheet(s);}).catch(function(E){L.error("Error while opening the share fragment",E);});}}).catch(function(E){L.error("Error while fetching the share model data",E);});},_setStaticShareData:function(s){var r=sap.ui.getCore().getLibraryResourceBundle("sap.fe.core");s.setProperty("/jamButtonText",r.getText("T_COMMON_SAPFE_SHARE_JAM"));s.setProperty("/emailButtonText",r.getText("T_SEMANTIC_CONTROL_SEND_EMAIL"));var g=O.get("sap.ushell.Container.getUser");s.setProperty("/jamVisible",!!g&&g().isJamActive());s.setProperty("/saveAsTileVisible",!!(sap&&sap.ushell&&sap.ushell.Container));},_doOpenJamShareDialog:function(t,u){var s=sap.ui.getCore().createComponent({name:"sap.collaboration.components.fiori.sharing.dialog",settings:{object:{id:u,share:t}}});s.open();}});return S;});
