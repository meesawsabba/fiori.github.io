/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2021 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/core/mvc/ControllerExtension","sap/ui/core/mvc/OverrideExecution","sap/fe/core/actions/sticky","sap/base/Log","sap/m/Text","sap/m/Button","sap/m/Dialog","sap/fe/core/CommonUtils","sap/fe/core/BusyLocker","sap/fe/core/library","sap/ui/model/odata/v4/ODataListBinding","sap/fe/core/helpers/SemanticKeyHelper","sap/fe/core/helpers/EditState","sap/fe/core/helpers/FPMHelper","sap/ui/core/message/Message","sap/ui/core/MessageType"],function(C,O,s,L,T,B,D,a,b,F,c,S,E,d,M,f){"use strict";var g=F.CreationMode,P=F.ProgrammingModel,h=F.Constants,j=F.DraftStatus,k=F.EditMode;var l=C.extend("sap.fe.core.controllerextensions.EditFlow",{metadata:{methods:{editDocument:{"public":true,"final":true},updateDocument:{"public":true,"final":true},createDocument:{"public":true,"final":true},saveDocument:{"public":true,"final":true},cancelDocument:{"public":true,"final":true},deleteDocument:{"public":true,"final":true},deleteMultipleDocuments:{"public":true,"final":true},applyDocument:{"public":true,"final":true},invokeAction:{"public":true,"final":true},securedExecution:{"public":true,"final":true},onBeforeSave:{"public":true,"final":false,"overrideExecution":O.Instead}}},editDocument:function(o,p){p=p||{};var t=this,e=p.prepareOnEdit||undefined,i=true,m=this._getTransactionHelper();return m.editDocument(o,e,t.getView(),t._getMessageHandler()).then(function(n){var q=t._getProgrammingModel(o);if(q===P.Sticky){t._getInternalModel().setProperty("/sessionOn",true);}if(n){t._setEditMode(k.Editable,false);t._getMessageHandler().showMessageDialog();if(n!==o){return t._handleNewContext(n,true,undefined,i).then(function(){if(q===P.Sticky){t._handleStickyOn(n);}});}}});},deleteMultipleDocuments:function(e,p){return this.base.getView().getController()._editFlow.deleteMultipleDocuments(e,p);},updateDocument:function(o,p){var t=this,e=t._getTransactionHelper(),i=t._getProgrammingModel(o)===P.Draft;this._getMessageHandler().removeTransitionMessages();return this._syncTask(function(){e.handleDocumentModifications();E.setEditStateDirty();t._getMessageHandler().removeTransitionMessages();if(i){t._setDraftStatus(j.Saving);}return p.then(function(){if(i){var m=t.getView().getBindingContext(),n=m.getModel().getMetaModel(),q=n.getMetaContext(m.getPath()).getObject("@sapui.name"),r=S.getSemanticKeys(n,q);if(r&&r.length){var u=t.base.getAppComponent().getRoutingService().getLastSemanticMapping(),v=u&&u.semanticPath,w=S.getSemanticPath(m,true);if(v!==w){return t._handleNewContext(m,true,undefined,true).then(function(){t._setDraftStatus(j.Saved);});}else{t._setDraftStatus(j.Saved);}}else{t._setDraftStatus(j.Saved);}}},function(){if(i){t._setDraftStatus(j.Clear);}}).catch(function(m){L.error("Error while updating the document",m);}).finally(function(){t._getMessageHandler().showMessageDialog();});});},createDocument:function(v,p){var t=this,e=this._getTransactionHelper(),o=this._getGlobalUIModel(),i,m=0,r=t.getView().getController().oResourceBundle,n=!p||(p.creationMode!==g.Inline&&p.creationMode!==g.CreationRow&&p.creationMode!==g.External),q=Promise.resolve([]),A=a.getAppComponent(this.getView());A.getRouterProxy().removeIAppStateKey();if(p.creationMode===g.External){return this._syncTask().then(function(){var H=t.getView().getController(),J=a.getAbsoluteMetaPathForListBinding(t.getView(),v);H.handlers.onChevronPressNavigateOutBound(H,p.outbound,undefined,J);});}if(p.creationMode===g.CreationRow&&p.creationRow){i=p.creationRow.getParent();var u=i.getCreationRow().data("customValidationFunction");if(u){var w=u.substring(0,u.lastIndexOf(".")||-1).replace(/\./gi,"/"),x=u.substring(u.lastIndexOf(".")+1,u.length),y=p.creationRow.getBindingContext().getObject();delete y["@$ui5.context.isTransient"];q=d.validationWrapper(w,x,y,t.base.getView(),i.getBindingContext("internal"));}if(i.getCreationRow().data("disableAddRowButtonForEmptyData")==="true"){var I=i.getBindingContext("internal");I.setProperty("creationRowFieldValidity",{});}}if(p.creationMode===g.Inline&&p.tableId){i=this.getView().byId(p.tableId);}function z(H,J){J.then(function(N){return N.created();}).then(function(){var K=t.getView().getBindingContext();if(!a.hasTransientContext(H)){var A=a.getAppComponent(t.getView());A.getSideEffectsService().requestSideEffectsForNavigationProperty(H.getPath(),K);}}).catch(function(K){L.error("Error while creating the document",K);});}function G(V){var u=i&&i.getCreationRow().data("customValidationFunction"),H=i&&i.getBindingContext("internal").getProperty("creationRowCustomValidity"),J=sap.ui.getCore().getMessageManager(),K=[],N,Q;J.getMessageModel().getData().forEach(function(R){if(R.code===u){J.removeMessages(R);}});V.forEach(function(R){if(R.messageTarget){N=sap.ui.getCore().getControl(H[R.messageTarget].fieldId);Q=N.getBindingContext().getPath()+"/"+N.getBindingPath("value");if(J.getMessageModel().getData().filter(function(W){return W.target===Q;}).length===0){J.addMessages(new M({message:R.messageText,processor:t.getView().getModel(),type:f.Error,code:u,technical:false,persistent:false,target:Q}));}var U=J.getMessageModel().getData().filter(function(W){return W.target===Q;});U[0].addControlId(H[R.messageTarget].fieldId);}else{K.push({code:u,text:R.messageText,persistent:true,type:f.Error});}});if(K.length>0){t._getMessageHandler().showMessageDialog({customMessages:K});}}n&&b.lock(o);return this._syncTask(q).then(function(V){if(V.length>0){G(V);L.error("Custom Validation failed");return;}var H,J,K;p=p||{};if(v&&typeof v==="object"){J=v;}else if(typeof v==="string"){J=new c(t.getView().getModel(),v);p.creationMode=g.Sync;delete p.createAtEnd;}else{throw new Error("Binding object or path expected");}K=J.getModel();m=J.iMaxLength||0;var N=p.creationMode;return Promise.resolve(t._getProgrammingModel(J)).then(function(Q){H=Q;if(N&&N!==g.NewPage){return N;}else{var R=K.getMetaModel();if(!J.isRelative()){var U=J.getPath(),W=H===P.Draft?R.getObject(U+"@com.sap.vocabularies.Common.v1.DraftRoot/NewAction"):R.getObject(U+"@com.sap.vocabularies.Session.v1.StickySessionSupported/NewAction");if(W){var X=R.getObject("/"+W+"/@$ui5.overload/0/$Parameter")||[];if(X.length>1){return g.Deferred;}}}var Y=R.getMetaPath(J.getHeaderContext().getPath());var Z=a.getNonComputedVisibleFields(R,Y);if(Z.length>0){return g.Deferred;}return g.Async;}}).then(function(N){var Q,R,U=p.creationRow,W,X=Promise.resolve(),Y,Z,$=K.getMetaModel(),_=t._getRoutingListener();if(N!==g.Deferred){if(N===g.CreationRow){W=U.getBindingContext();Z=$.getMetaPath(W.getPath());Y=W.getObject();p.data={};Object.keys(Y).forEach(function(b1){var c1=$.getObject(Z+"/"+b1);if(c1&&c1.$kind==="NavigationProperty"){return;}p.data[b1]=Y[b1];});X=t._checkForValidationErrors(W);}if(N===g.CreationRow||N===g.Inline){p.keepTransientContextOnFailed=false;p.busyMode="Local";t._handleCreateEvents(J);}Q=X.then(function(){if(!p.parentControl){p.parentControl=t.getView();}return e.createDocument(J,p,r,t._getMessageHandler());});}var a1;switch(N){case g.Deferred:a1=_.navigateForwardToContext(J,{bDeferredContext:true,editable:true});break;case g.Async:a1=_.navigateForwardToContext(J,{asyncContext:Q,editable:true});break;case g.Sync:R={editable:true};if(H==P.Sticky||p.createAction){R.transient=true;}a1=Q.then(function(b1){if(!b1){var r=sap.ui.getCore().getLibraryResourceBundle("sap.fe.core");return _.navigateToMessagePage(r.getText("C_COMMON_SAPFE_DATA_RECEIVED_ERROR"),{title:r.getText("C_COMMON_SAPFE_ERROR"),description:r.getText("C_EDITFLOW_SAPFE_CREATION_FAILED_DESCRIPTION")});}else{return _.navigateForwardToContext(b1,R);}});break;case g.Inline:a1=z(J,Q);t._syncTask(Q);break;case g.CreationRow:a1=X.then(function(){var b1=W.getBinding(),c1;if(!p.bSkipSideEffects){z(J,Q);}c1=b1.create();U.setBindingContext(c1);c1.created().catch(function(){L.trace("transient fast creation context deleted");});return W.delete("$direct");}).catch(function(b1){if(b.isLocked(t.getView().getModel("ui"))){b.unlock(t.getView().getModel("ui"));}L.error("CreationRow navigation error: ",b1);});break;default:a1=Promise.reject("Unhandled creationMode "+N);break;}if(H===P.Sticky){t._getInternalModel().setProperty("/sessionOn",true);}if(Q){return Promise.all([Q,a1]).then(function(b1){t._setEditMode(k.Editable,true);var c1=b1[0];if(c1){E.setEditStateDirty();if(H===P.Sticky){t._handleStickyOn(c1);}}}).catch(function(b1){if(b1&&b1.navigateBackFromTransientState){_.navigateBackFromTransientState();}return Promise.reject(b1);});}});}).finally(function(){if(i&&i.isA("sap.ui.mdc.Table")){var H=p.creationMode===g.Inline?i.focusRow.bind(i):i.scrollToIndex.bind(i);i.getRowBinding().attachEventOnce("change",function(){switch(p.createAtEnd){case true:if(i.data("tableType")==="ResponsiveTable"&&i.getThreshold()){H(i.getThreshold(),true);}else{H(m,true);}break;case false:H(0,true);break;}});}n&&b.unlock(o);});},onBeforeSave:function(){return Promise.resolve();},saveDocument:function(o,p){p=p||{};var t=this,e=p.bExecuteSideEffectsOnError||undefined,i=true,m=this._getTransactionHelper(),r=t.getView().getController().oResourceBundle,n=p.bindings;return(this._syncTask().then(this._submitOpenChanges.bind(this,o)).then(this._checkForValidationErrors.bind(this,o)).then(this.base.editFlow.onBeforeSave.bind(this)).then(m.saveDocument.bind(m,o,r,e,n,t._getMessageHandler())).then(function(A){var q=t._getProgrammingModel(o);t._removeContextsFromPages();if(q===P.Sticky){t._getInternalModel().setProperty("/sessionOn",false);t._handleStickyOff(o);}t._setEditMode(k.Display,false);t._getMessageHandler().showMessageDialog();if(A!==o){t._handleNewContext(A,false,undefined,i);}}).catch(function(q){L.error("Error while saving the document",q);return Promise.reject(q);}));},toggleDraftActive:function(o){var e=o.getObject();var t=this;var i;var I=o&&this._getProgrammingModel(o)===P.Draft;var m=o.getModel().bindContext(o.getPath()+"/SiblingEntity").getBoundContext();if(!I||!((!e.IsActiveEntity&&e.HasActiveEntity)||(e.IsActiveEntity&&e.HasDraftEntity))){return;}if(!e.IsActiveEntity&&e.HasActiveEntity){i=false;}else if(e.IsActiveEntity&&e.HasDraftEntity){i=true;}m.requestCanonicalPath().then(function(n){return m.getModel().bindContext(n).getBoundContext();}).then(function(m){t._setEditMode(i?k.Editable:k.Display,false);t._handleNewContext(m,i,true,true);}).catch(function(n){return Promise.reject("Error in EditFlow.toggleDraftActive:"+n);});},cancelDocument:function(o,p){var t=this,e=this._getTransactionHelper(),r=t.getView().getController().oResourceBundle;p.cancelButton=p.control||p.cancelButton;return this._syncTask().then(e.cancelDocument.bind(e,o,p,r,t._getMessageHandler())).then(function(A){var i=true,m=t._getProgrammingModel(o);t._removeContextsFromPages();if(m===P.Sticky){t._getInternalModel().setProperty("/sessionOn",false);t._handleStickyOff(o);}t._setEditMode(k.Display,false);t._setDraftStatus(j.Clear);if(!A){E.setEditStateDirty();t._getRoutingListener().navigateBackFromContext(o);}else if(m===P.Draft){return t._fetchSemanticKeyValues(A).then(function(){if(p.bSkipBindingToView){return A;}else{return t._handleNewContext(A,false,true,i);}});}else{return t._handleNewContext(A,false,undefined,i);}});},deleteDocument:function(o,p){var t=this;var A=a.getAppComponent(t.getView());if(!p){p={bFindActiveContexts:false};}else{p.bFindActiveContexts=false;}return this._deleteDocumentTransaction(o,p).then(function(){E.setEditStateDirty();t._getRoutingListener().navigateBackFromContext(o);if(A){A.getShellServices().setBackNavigation();}});},applyDocument:function(o){var t=this,e=this._getGlobalUIModel();b.lock(e);return(this._submitOpenChanges(o).then(this._checkForValidationErrors.bind(this,o)).then(function(){t._getMessageHandler().showMessageDialog();t._getRoutingListener().navigateBackFromContext(o);return true;}).finally(function(){if(b.isLocked(e)){b.unlock(e);}}));},invokeAction:function(A,p){var t=this,o,e=this._getTransactionHelper(),i,m,n,q,r,v=this.getView();p=p||{};if((p.isA&&p.isA("sap.ui.model.odata.v4.Context"))||Array.isArray(p)||arguments.length===3){var u=p;p=arguments[2]||{};if(u){p.contexts=u;}else{p.model=this.getView().getModel();}}p.isNavigable=p.requiresNavigation||p.isNavigable;if(!p.parentControl){p.parentControl=this.getView();}if(p.prefix){o=this.getView().byId(p.prefix);if(o){p.internalModelContext=o.getBindingContext("internal");}}else{p.internalModelContext=v.getBindingContext("internal");}if(A&&A.indexOf("(")>-1){n=A.split("(");A=n[0];q=n[n.length-1].replaceAll(")","");}if(p.bStaticAction){if(o.isTableBound()){p.contexts=o.getRowBinding().getHeaderContext();}else{var w=o.data("rowsBindingInfo").path,x=new c(t.getView().getModel(),w);p.contexts=x.getHeaderContext();}if(q){var y=p.contexts.getModel().getMetaModel().getMetaContext(p.contexts.getPath()).getObject("$Type");if(q!==y){i=o;while(i){m=i.getBindingContext();if(m&&m.getModel().getMetaModel().getMetaContext(m.getPath()).getObject("$Type")===q){p.contexts=m;break;}else{i=i.getParent();}}if(!p.contexts){return Promise.reject("Context not found for entity type "+q);}}}if(p.enableAutoScroll){r=this._createActionPromise(A,o.sId);}}if(p.isNavigable){p.bGetBoundContext=false;}else{p.bGetBoundContext=true;}p.bObjectPage=v.getViewData().converterType==="ObjectPage";return this._syncTask().then(e.callAction.bind(e,A,p,t.getView(),t._getMessageHandler())).then(function(R){if(p.contexts){return t._refreshListIfRequired(t._getActionResponseDataAndKeys(A,R),p.contexts[0]).then(function(){return R;});}}).then(function(R){if(r){r.fResolver(R);}if(p.contexts){E.setEditStateDirty();}if(p.isNavigable){var z=R;if(Array.isArray(z)&&z.length===1){z=z[0];}if(z&&!Array.isArray(z)){var G=v.getModel().getMetaModel();var H=G.getMetaPath(z.getPath());var I=Array.isArray(p.contexts)?p.contexts[0]:p.contexts;var J=I&&G.getMetaPath(I.getPath());if(H!=undefined&&H===J){if(I.getPath()!==z.getPath()){t._getRoutingListener().navigateForwardToContext(z,{noHistoryEntry:false});}else{L.info("Navigation to the same context is not allowed");}}}}}).catch(function(z){if(r){r.fRejector();}if(z==h.CancelActionDialog){return Promise.reject("DialogÂ cancelled.");}else{return Promise.reject("Error in EditFlow.invokeAction:"+z);}});},securedExecution:function(e,p){var i=p&&p.busy&&p.busy.set!==undefined?p.busy.set:true,m=p&&p.busy&&p.busy.check!==undefined?p.busy.check:true,u=(p&&p.updatesDocument)||false,o=this._getGlobalUIModel(),n=this.base.getView().getBindingContext(),I=n&&this._getProgrammingModel(n)===P.Draft,t=this;if(m&&b.isLocked(o)){return Promise.reject("Application already busy therefore execution rejected");}if(i){b.lock(o);}if(u&&I){this._setDraftStatus(j.Saving);}this._getMessageHandler().removeTransitionMessages();return this._syncTask(e).then(function(){if(u){t._getTransactionHelper().handleDocumentModifications();E.setEditStateDirty();if(I){t._setDraftStatus(j.Saved);}}}).catch(function(q){if(u&&I){t._setDraftStatus(j.Clear);}return Promise.reject(q);}).finally(function(){if(i){b.unlock(o);}return t._getMessageHandler().showMessageDialog();});},handlePatchSent:function(e){var t=this;this.mPatchPromises=this.mPatchPromises?this.mPatchPromises:{};var p=new Promise(function(r,i){t.mPatchPromises[e.getSource()]={resolvePatchPromise:r,rejectPatchPromise:i};});this.updateDocument(e.getSource(),p);},handlePatchCompleted:function(e){var i=e.getParameter("success");if(i){this.mPatchPromises[e.getSource()].resolvePatchPromise();}else{this.mPatchPromises[e.getSource()].rejectPatchPromise();}delete this.mPatchPromises[e.getSource()];},_setEditMode:function(e,i){this.base.getView().getController()._editFlow.setEditMode(e,i);},_setDraftStatus:function(e){this.base.getView().getController()._editFlow.setDraftStatus(e);},_getRoutingListener:function(){return this.base.getView().getController()._editFlow.getRoutingListener();},_getGlobalUIModel:function(){return this.base.getView().getController()._editFlow.getGlobalUIModel();},_syncTask:function(t){return this.base.getView().getController()._editFlow.syncTask(t);},_getProgrammingModel:function(o){return this.base.getView().getController()._editFlow.getProgrammingModel(o);},_deleteDocumentTransaction:function(o,p){return this.base.getView().getController()._editFlow.deleteDocumentTransaction(o,p);},_handleCreateEvents:function(o){this.base.getView().getController()._editFlow.handleCreateEvents(o);},_getTransactionHelper:function(){return this.base.getView().getController()._editFlow.getTransactionHelper();},_getInternalModel:function(){return this.base.getView().getController()._editFlow.getInternalModel();},_createActionPromise:function(A,e){return this.base.getView().getController()._editFlow.createActionPromise(A,e);},_getCurrentActionPromise:function(){return this.base.getView().getController()._editFlow.getCurrentActionPromise();},_deleteCurrentActionPromise:function(){return this.base.getView().getController()._editFlow.deleteCurrentActionPromise();},_getMessageHandler:function(){return this.base.getView().getController()._editFlow.getMessageHandler();},_getActionResponseDataAndKeys:function(A,r){return this.base.getView().getController()._editFlow.getActionResponseDataAndKeys(A,r);},_submitOpenChanges:function(o){var m=o.getModel(),e=this._getGlobalUIModel();return m.submitBatch("$auto").then(function(){if(m.hasPendingChanges("$auto")){return Promise.reject("submit of open changes failed");}}).finally(function(){if(b.isLocked(e)){b.unlock(e);}});},_handleStickyOn:function(o){var t=this,A=a.getAppComponent(this.getView());if(!A.getRouterProxy().hasNavigationGuard()){var H=A.getRouterProxy().getHash(),i=this._getInternalModel();setTimeout(function(){A.getRouterProxy().setNavigationGuard();},0);A.getShellServices().setBackNavigation(t._onBackNavigationInSession.bind(t));this.fnDirtyStateProvider=function(n){var m=n.innerAppRoute,r=A.getRouterProxy(),p,q=i.getProperty("/sessionOn");if(!q){return;}if(!r.isNavigationFinalized()){p=false;H=m;}else if(H===m){p=true;}else if(r.checkHashWithGuard(m)||r.isGuardCrossAllowedByUser()){H=m;p=false;}else{p=true;}if(p){setTimeout(function(){A.getShellServices().setDirtyFlag(false);},0);}return p;};A.getShellServices().registerDirtyStateProvider(this.fnDirtyStateProvider);var e=this.getView().getModel("sap.fe.i18n");this.fnHandleSessionTimeout=function(){t._getMessageHandler().removeTransitionMessages();var m=new D({title:"{sap.fe.i18n>C_EDITFLOW_OBJECT_PAGE_SESSION_EXPIRED_DIALOG_TITLE}",state:"Warning",content:new T({text:"{sap.fe.i18n>C_EDITFLOW_OBJECT_PAGE_SESSION_EXPIRED_DIALOG_MESSAGE}"}),beginButton:new B({text:"{sap.fe.i18n>C_COMMON_DIALOG_OK}",type:"Emphasized",press:function(){t._handleStickyOff();t._getRoutingListener().navigateBackFromContext(o);}}),afterClose:function(){m.destroy();}});m.addStyleClass("sapUiContentPadding");m.setModel(e,"sap.fe.i18n");t.getView().addDependent(m);m.open();};this.getView().getModel().attachSessionTimeout(this.fnHandleSessionTimeout);this._fnStickyDiscardAfterNavigation=function(){var m=A.getRouterProxy().getHash();if(!m||!A.getRouterProxy().checkHashWithGuard(m)){t._discardStickySession(o);}};A.getRoutingService().attachRouteMatched(this._fnStickyDiscardAfterNavigation);}},_handleStickyOff:function(){var A=a.getAppComponent(this.getView());if(A.getRouterProxy){A.getRouterProxy().discardNavigationGuard();}if(this.fnDirtyStateProvider){A.getShellServices().deregisterDirtyStateProvider(this.fnDirtyStateProvider);this.fnDirtyStateProvider=null;}if(this.getView().getModel()&&this.fnHandleSessionTimeout){this.getView().getModel().detachSessionTimeout(this.fnHandleSessionTimeout);}A.getRoutingService().detachRouteMatched(this._fnStickyDiscardAfterNavigation);this._fnStickyDiscardAfterNavigation=null;this._setEditMode(k.Display,false);if(A){A.getShellServices().setBackNavigation();}},_handleNewContext:function(o,e,r,i){E.setEditStateDirty();return this._getRoutingListener().navigateToContext(o,{checkNoHashChange:true,editable:e,bPersistOPScroll:true,bRecreateContext:r,bDraftNavigation:i,showPlaceholder:false});},_checkForValidationErrors:function(o){var t=this;return this._syncTask().then(function(){var v=t.base.getView().getId();var m=sap.ui.getCore().getMessageManager().getMessageModel().getData(),e,n;if(!m.length){return Promise.resolve("No validation errors found");}for(var i=0;i<m.length;i++){n=m[i];if(n.validation){e=sap.ui.getCore().byId(n.getControlId());while(e){if(e.getId()===v){return Promise.reject("validation errors exist");}e=e.getParent();}}}});},_onBackNavigationInSession:function(){var t=this,v=t.getView(),A=a.getAppComponent(v),r=A.getRouterProxy();if(r.checkIfBackIsOutOfGuard()){var o=v&&v.getBindingContext();a.processDataLossConfirmation(function(){t._discardStickySession(o);history.back();},v,t._getProgrammingModel(o));return;}history.back();},_discardStickySession:function(o){s.discardDocument(o);this._handleStickyOff();},_refreshListIfRequired:function(r,o){if(!o||!r||!r.oData){return Promise.resolve();}var i=o.getBinding();if(i&&i.isA("sap.ui.model.odata.v4.ODataListBinding")){var t=this,m=r.oData,K=r.keys,n=o.getObject(),R=true;if(Object.keys(m).length){R=K.every(function(e){return n[e]===m[e];});if(!R){return new Promise(function(p,q){if(i.isRoot()){i.attachEventOnce("dataReceived",function(){p();});i.refresh();}else{var A=a.getAppComponent(t.getView());A.getSideEffectsService().requestSideEffects([{$NavigationPropertyPath:i.getPath()}],i.getContext()).then(function(){p();},function(){L.error("Error while refreshing the table");p();}).catch(function(e){L.error("Error while refreshing the table",e);});}});}}}return Promise.resolve();},_fetchSemanticKeyValues:function(o){var m=o.getModel().getMetaModel(),e=m.getMetaContext(o.getPath()).getObject("@sapui.name"),i=S.getSemanticKeys(m,e);if(i&&i.length){var r=i.map(function(K){return o.requestObject(K.$PropertyPath);});return Promise.all(r);}else{return Promise.resolve();}},_removeContextsFromPages:function(){var p=[];var A=a.getAppComponent(this.getView());if(A._isFclEnabled()){p=p.concat(A.getRootContainer().getMidColumnPages()||[]);p=p.concat(A.getRootContainer().getEndColumnPages()||[]);}else{p=A.getRootContainer().getPages()||[];}p.forEach(function(o){if(o.isA("sap.ui.core.ComponentContainer")){o=o.getComponentInstance();}if(o.getBindingContext()){o.setBindingContext(null);}});}});return l;});
