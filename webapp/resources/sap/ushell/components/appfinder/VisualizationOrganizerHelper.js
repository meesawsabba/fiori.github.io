// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/m/library","sap/ushell/Config","sap/ushell/EventHub","sap/ushell/resources"],function(m,C,E,r){"use strict";var B=m.ButtonType;var i;function g(){return sap.ui.getCore().byId("catalogView");}function a(){return sap.ui.getCore().byId("appFinderView");}function V(){var v,o,s=null;function b(){return C.last("/core/spaces/enabled");}function l(){if(v){return Promise.resolve(v);}o=o||new Promise(function(c){sap.ui.require(["sap/ushell/components/visualizationOrganizer/Component"],function(d){v=new d();c(v);});});return o;}if(b()){this.oDoable=E.on("trackHashChange").do(function(h){if(b()&&(h==="Shell-appFinder")){var c=g();if(!c){return;}c.setBusy(true);l().then(function(d){return d.requestData();}).then(function(){if(this.oModel){this.oModel.updateBindings(true);}var A=a();if(v.getPersonalizablePages().length===1&&A){var t=r.i18n.getText("VisualizationOrganizer.PageContextTitle",v.getPersonalizablePages()[0].title);A.getController()._updateShellHeader(t);}}.bind(this)).finally(function(){c.setBusy(false);});}}.bind(this));}this.setModel=function(c){this.oModel=c;};this.formatPinButtonTooltip=function(G,c,d){if(!b()){return this.formatPinButtonTooltip(G,c);}return v.formatPinButtonTooltip(d,s);};this.formatPinButtonSelectState=function(){if(!b()){return this.formatPinButtonSelectState.apply(this,arguments);}return false;};this.formatPinButtonIcon=function(c){if(!b()){return"sap-icon://pushpin-off";}return v.formatPinButtonIcon(c,!!s);};this.formatPinButtonType=function(c){if(!b()){return B.Default;}return v.formatPinButtonType(c,!!s);};this.onTilePinButtonClick=function(e){if(!b()){this.getController().onTilePinButtonClick(e);return;}v.onTilePinButtonClick(e,s);};this.getNavigationContext=function(){if(!b()){return this.getGroupContext.apply(this,arguments);}if(s){return{pageID:encodeURIComponent(s.pageID),sectionID:encodeURIComponent(s.sectionID)};}return null;};this.getNavigationContextAsText=function(){if(!b()){return this.getGroupNavigationContext.apply(this,arguments);}if(s){return JSON.stringify({pageID:encodeURIComponent(s.pageID),sectionID:encodeURIComponent(s.sectionID)});}return null;};this.updateModelWithContext=function(d){if(!b()){this._updateModelWithGroupContext.apply(this,arguments);return Promise.resolve();}return l().then(function(){return v.loadSectionContext(d);}).then(function(c){s=c;this.oView.getModel().updateBindings(true);if(s){var t=s.sectionTitle?r.i18n.getText("VisualizationOrganizer.AppFinderSectionContextTitle",s.sectionTitle):r.i18n.getText("VisualizationOrganizer.AppFinderSectionContextTitleUnnamed");this.oView.oPage.setTitle(t);if(this._updateShellHeader){return new Promise(function(e){setTimeout(function(){this._updateShellHeader(t);e();}.bind(this),0);}.bind(this));}}return Promise.resolve();}.bind(this));};this._loadVisualizationOrganizer=l;this._setSectionContext=function(c){s=c;};this.exit=function(){if(this.oDoable){this.oDoable.off();this.oDoable=null;}};this.onHierarchyAppsPinButtonClick=function(e){if(!b()){this.showGroupListPopover(e);return Promise.resolve(false);}return v.onHierarchyAppsPinButtonClick(e,s);};this.formatBookmarkPinButtonTooltip=function(G,c,d,e,f){if(!b()){return this.formatPinButtonTooltip(G,c,d,e,f);}return v.formatBookmarkPinButtonTooltip(c,s);};this.formatBookmarkPinButtonSelectState=function(c){if(!b()){return!!c;}return false;};this.formatBookmarkPinButtonIcon=function(c){if(!b()){return"sap-icon://pushpin-off";}return c>0?"sap-icon://accept":"sap-icon://add";};this.formatBookmarkPinButtonType=function(c){if(!b()){return B.Default;}return c>0?B.Emphasized:B.Default;};this.updateBookmarkCount=function(A){if(!b()){return this.updateBookmarkCount(A);}return v.updateBookmarkCount(A,s);};this.shouldPinButtonBeVisible=function(){return new Promise(function(c){var p=C.last("/core/shell/enablePersonalization");if(!b()||p){c(p);}else if(!C.last("/core/spaces/myHome/enabled")){c(false);}else{sap.ushell.Container.getServiceAsync("UserInfo").then(function(u){c(u.getUser().getShowMyHome());});}});};}return{getInstance:function(){if(!i){i=new V();}return i;},destroy:function(){if(i){i.exit();}i=null;}};});
