// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ushell/EventHub","sap/ushell/Config","sap/ushell/resources"],function(C,J,E,a,r){"use strict";return C.extend("sap.ushell.components.shell.Settings.spaces.SpacesSetting",{onInit:function(){this.oUserInfoService=sap.ushell.Container.getService("UserInfo");var u=this.oUserInfoService.getUser();var i=u.getImportBookmarksFlag();var I=a.last("/core/spaces/enabled");var s=I&&a.last("/core/spaces/myHome/enabled");var S=u.getShowMyHome();var m=i!=="done"&&i!=="not_required";var v=new J({isSpacesEnabled:I,isShowMyHomeVisible:s,isShowMyHomeSelected:S,isMyHomeImportVisible:s&&S&&m,isMyHomeImportSelected:i==="pending"});this.getView().setModel(v);this.getView().setModel(r.getTranslationModel(),"i18n");function b(c){v.setProperty("/isMyHomeImportSelected",!!c);}this.oImportBookmarksFlagListener=E.on("importBookmarksFlag").do(b);},onExit:function(){this.oImportBookmarksFlagListener.off();},onSave:function(){var m=this.getView().getModel(),u=this.oUserInfoService,U=u.getUser(),o=a.last("/core/spaces/enabled"),n=m.getProperty("/isSpacesEnabled"),O=U.getShowMyHome(),N=m.getProperty("/isShowMyHomeSelected"),b=U.getImportBookmarksFlag()==="pending",c=m.getProperty("/isMyHomeImportSelected");var R=false;var d=false;if(o!==n){U.setChangedProperties({propertyName:"spacesEnabled",name:"SPACES_ENABLEMENT"},o,n);d=true;R=true;}if(O!==N){U.setShowMyHome(N);d=true;R=true;}if(b!==c){var i=c?"pending":"dismissed";U.setImportBookmarksFlag(i);d=true;if(!R){E.emit("importBookmarksFlag",c);}}if(!d){return Promise.resolve();}return new Promise(function(e,f){u.updateUserPreferences().done(function(){U.resetChangedProperty("spacesEnabled");U.resetChangedProperty("showMyHome");U.resetChangedProperty("importBookmarks");e({refresh:R,noHash:true});}).fail(function(s){m.setProperty("/isSpacesEnabled",o);m.setProperty("/showMyHome",O);U.resetChangedProperty("spacesEnabled");U.resetChangedProperty("showMyHome");U.resetChangedProperty("importBookmarks");f(s);});});},onCancel:function(){var m=this.getView().getModel();m.setProperty("/isSpacesEnabled",a.last("/core/spaces/enabled"));m.setProperty("/showMyHome",this.oUserInfoService.getUser().getShowMyHome());}});});
