// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/resources","sap/ushell/Config"],function(r,C){"use strict";var P=function(){};P.prototype._getPageAndSpaceId=function(s){return sap.ushell.Container.getServiceAsync("URLParsing").then(function(u){if(!s){s=window.hasher.getHash();}var h=u.parseShellHash(s);var i={semanticObject:h.semanticObject||"",action:h.action||""};var H=h.params||{};var p=H.pageId||[];var S=H.spaceId||[];return this._parsePageAndSpaceId(p,S,i);}.bind(this));};P.prototype._parsePageAndSpaceId=function(p,s,i){return new Promise(function(a,b){this.getUserMyHomeEnablement().then(function(){if(p.length<1&&s.length<1){if(i.semanticObject==="Shell"&&i.action==="home"){this._getUserDefaultPage().then(function(R){a(R);}).catch(function(e){b(e);});return;}b(r.i18n.getText("PageRuntime.NoPageIdAndSpaceIdProvided"));}if(p.length===1&&s.length===0){b(r.i18n.getText("PageRuntime.OnlyPageIdProvided"));}if(p.length===0&&s.length===1){b(r.i18n.getText("PageRuntime.OnlySpaceIdProvided"));}if(p.length>1||s.length>1){b(r.i18n.getText("PageRuntime.MultiplePageOrSpaceIdProvided"));}if(p[0]===""){b(r.i18n.getText("PageRuntime.InvalidPageId"));}if(s[0]===""){b(r.i18n.getText("PageRuntime.InvalidSpaceId"));}a({pageId:p[0],spaceId:s[0]});}.bind(this));}.bind(this));};P.prototype.getUserMyHomeEnablement=function(){return new Promise(function(a,b){var u=sap.ushell.Container.getUser().getShowMyHome();C.emit("/core/spaces/myHome/userEnabled",u);a(u);});};P.prototype._getUserDefaultPage=function(){return new Promise(function(a,b){Promise.all([sap.ushell.Container.getServiceAsync("Menu"),this.getUserMyHomeEnablement()]).then(function(R){var m=R[0];m.getSpacesPagesHierarchy().then(function(s){if(s.spaces.length===0){b(r.i18n.getText("PageRuntime.NoAssignedSpace"));}var S=s.spaces.find(function(o){return(!!(o.id&&o.pages&&o.pages[0]&&o.pages[0].id));});if(S){a({spaceId:S.id,pageId:S.pages[0].id});}else{b(r.i18n.getText("PageRuntime.NoAssignedPage"));}});});}.bind(this));};return new P();});
