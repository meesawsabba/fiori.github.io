//@ui5-bundle sap/ushell/components/pages/Component-preload.js
//Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.predefine('sap/ushell/components/pages/ActionMode',["sap/ui/core/library","sap/m/MessageBox","sap/m/MessageToast","sap/ushell/resources","sap/ushell/EventHub","sap/base/Log","sap/ushell/renderers/fiori2/AccessKeysHandler"],function(c,M,a,r,E,L,A){"use strict";var b={};b.start=function(C){this.oController=C;C.getView().getModel("viewSettings").setProperty("/actionModeActive",true);C.handleMyHomeActionMode(true).catch(C._onError.bind(C));E.emit("enableMenuBarNavigation",false);var o=sap.ui.getCore().byId("ActionModeBtn");this.sActionButtonActivateText=o.getText();var s=r.i18n.getText("PageRuntime.EditMode.Exit");o.setTooltip(s);o.setText(s);A.attachEvent("editModeDone",this.save,this);};b.cancel=function(){this._cleanup();};b.save=function(){L.info("store actions in pages service");this._cleanup();};b._cleanup=function(){this.oController.getView().getModel("viewSettings").setProperty("/actionModeActive",false);this.oController.handleMyHomeActionMode(false).catch(this.oController._onError.bind(this.oController));E.emit("enableMenuBarNavigation",true);var o=sap.ui.getCore().byId("ActionModeBtn");o.setTooltip(this.sActionButtonActivateText);o.setText(this.sActionButtonActivateText);A.detachEvent("editModeDone",this.save,this);};b.addVisualization=function(e,s){var m=s.getBindingContext().getModel();var p=s.getBindingContext().getPath();var P=p.split("/");var i=parseInt(P[2],10);var d=m.getProperty("/pages/"+i+"/id");var S=m.getProperty(p+"/id");sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(C){var f="Shell-appfinder?&/catalog/"+JSON.stringify({pageID:encodeURIComponent(d),sectionID:encodeURIComponent(S)});C.toExternal({target:{shellHash:f}});});};b.addSection=function(e,s,p){var S=p.index;var P=s.getBindingContext().getPath();var d=P.split("/");var i=parseInt(d[2],10);return this.oController.getOwnerComponent().getPagesService().then(function(o){o.addSection(i,S);var D={onAfterRendering:function(){setTimeout(function(){s.getSections()[S].byId("title-edit").focus();},0);s.removeEventDelegate(D);}};s.addEventDelegate(D);});};b.deleteSection=function(e,s){return sap.ushell.Container.getServiceAsync("Message").then(function(m){var t=s.getTitle();var d=t?r.i18n.getText("PageRuntime.Message.Section.Delete",t):r.i18n.getText("PageRuntime.Message.Section.DeleteNoTitle");var f=r.i18n.getText("PageRuntime.Dialog.Title.Delete");function C(o){if(o===M.Action.DELETE){this.oController.getOwnerComponent().getPagesService().then(function(p){var P=s.getBindingContext().getPath(),g=s.getParent(),h=P.split("/"),i=parseInt(h[2],10),S=parseInt(h[4],10);p.deleteSection(i,S);a.show(r.i18n.getText("PageRuntime.MessageToast.SectionDeleted"));var j=g.getSections();if(j.length){var k=j[S!==0?S-1:S];k.focus();var l={onAfterRendering:function(){k.focus();k.removeEventDelegate(l);}};k.addEventDelegate(l);}else{var n={onAfterRendering:function(){g.focus();g.removeEventDelegate(n);}};g.addEventDelegate(n);}});}}m.confirm(d,C.bind(this),f,[M.Action.DELETE,M.Action.CANCEL]);}.bind(this));};b.resetSection=function(e,s){var p=s.getBindingContext().getPath();var P=p.split("/");var i=parseInt(P[2],10);var S=parseInt(P[4],10);return this.oController.getOwnerComponent().getPagesService().then(function(o){o.resetSection(i,S);a.show(r.i18n.getText("PageRuntime.MessageToast.SectionReset"));});};b.changeSectionTitle=function(e,s,p){var P=s.getBindingContext().getPath();var n=s.getProperty("title");var d=P.split("/");var i=parseInt(d[2],10);var S=parseInt(d[4],10);return this.oController.getOwnerComponent().getPagesService().then(function(o){o.renameSection(i,S,n);});};b.moveSection=function(e,s,p){var S=p.draggedControl.getBindingContext().getPath();var t=p.droppedControl.getBindingContext().getPath();var d=p.dropPosition;var T=t.split("/");var f=S.split("/");var P=parseInt(f[2],10);var i=parseInt(f[4],10);var g=parseInt(T[4],10);if(i===g-1&&d==="Before"||i===g+1&&d==="After"){return Promise.resolve();}if(d==="After"){g=g+1;}var C=this.oController.getOwnerComponent();return C.getPagesService().then(function(o){return o.moveSection(P,i,g);}).then(function(){s.announceMove();});};b.changeSectionVisibility=function(e,s,p){if(this.oController===undefined||p.visible===undefined){return Promise.resolve();}var P=s.getBindingContext().getPath();var v=p.visible;var d=P.split("/");var i=parseInt(d[2],10);var S=parseInt(d[4],10);return this.oController.getOwnerComponent().getPagesService().then(function(o){o.setSectionVisibility(i,S,v);});};return b;});
sap.ui.predefine('sap/ushell/components/pages/Component',["sap/ui/core/InvisibleMessage","sap/ui/core/UIComponent","sap/ushell/components/SharedComponentUtils","sap/ushell/resources"],function(I,U,S,r){"use strict";return U.extend("sap.ushell.components.pages.Component",{metadata:{manifest:"json",library:"sap.ushell"},init:function(){U.prototype.init.apply(this,arguments);S.toggleUserActivityLog();S.getEffectiveHomepageSetting("/core/home/sizeBehavior","/core/home/sizeBehaviorConfigurable");this.setModel(r.i18nModel,"i18n");this._oPagesService=sap.ushell.Container.getServiceAsync("Pages");this._oInvisibleMessageInstance=I.getInstance();},getPagesService:function(){return this._oPagesService;},getInvisibleMessageInstance:function(){return this._oInvisibleMessageInstance;},getComponentData:function(){return{};}});});
sap.ui.predefine('sap/ushell/components/pages/MyHomeImport',["sap/ushell/EventHub","sap/ushell/Config","sap/ushell/utils/HttpClient","sap/base/util/ObjectPath"],function(E,C,H,O){"use strict";var M={};var d="/UI2/Fiori2LaunchpadHome";M.getData=function(){if(!this.oPageSetPromise){this.oPageSetPromise=new Promise(function(r,a){var R="PageSets('%2FUI2%2FFiori2LaunchpadHome')"+"?$expand=Pages/PageChipInstances/ChipInstanceBags/ChipInstanceProperties"+"&$format=json";var h={"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0","Accept-Language":(sap.ui&&sap.ui.getCore().getConfiguration().getLanguage())||"",Accept:"application/json, text/plain"};var s=sap.ushell.Container.getUser().getLanguage();if(s){h["sap-language"]=s;}var S=sap.ushell.Container.getLogonSystem()?sap.ushell.Container.getLogonSystem().getClient():"";if(S){h["sap-client"]=S;}var o=(window["sap-ushell-config"].services&&window["sap-ushell-config"].services.PageBuilding)||{};var b=(O.get("config.services.pageBuilding.baseUrl",o.adapter)||"").replace(/\/?$/,"/");var c=new H(b,{headers:h});c.get(R).then(function(e){r(this.parseData.bind(this)(e));}.bind(this)).catch(a);}.bind(this));}return this.oPageSetPromise;};M.isImportEnabled=function(){return sap.ushell.Container.getServiceAsync("UserInfo").then(function(u){var U=u.getUser();var i=U.getImportBookmarksFlag();switch(i){case"done":case"dismissed":case"not_required":return false;case null:return this.getData().then(function(g){var I=!!(g.length);var s=I?"pending":"not_required";U.setImportBookmarksFlag(s);u.updateUserPreferences();U.resetChangedProperty("importBookmarks");return I;});default:return true;}}.bind(this));};M.parseData=function(r){try{var p=JSON.parse(r.responseText);if(p&&p.d){p=p.d;}var c=p.configuration&&JSON.parse(p.configuration)||{};var h=c.hiddenGroups||[];var P=p.Pages.results.filter(function(a){var i=a.scope==="PERSONALIZATION";var b=a.PageChipInstances.results.length>0;var I=h.indexOf(a.id)===-1;return i&&b&&I;});var g=c.order||[];P.sort(function(x,y){if(g.indexOf(x.id)>g.indexOf(y.id)){return 1;}if(g.indexOf(x.id)<g.indexOf(y.id)){return-1;}return 0;});var l=[];var D;var n=[];P.forEach(function(a){var L;if(a.layout){L=JSON.parse(a.layout);}var m={id:a.id,title:a.title,isLocked:a.isPersLocked==="X",isDefault:a.id===d,tileOrder:L&&L.order||[],linkOrder:L&&L.linkOrder||[],chips:a.PageChipInstances.results};if(m.isLocked){l.push(m);}else if(m.isDefault){D=m;}else{n.push(m);}});if(!C.last("/core/home/disableSortedLockedGroups")){l.sort(function(x,y){return x.title.toLowerCase()<y.title.toLowerCase()?-1:1;});}if(D){l=l.concat(D);}return l.concat(n);}catch(e){return null;}};M.setImportEnabled=function(e){E.emit("importBookmarksFlag",!!e);sap.ushell.Container.getServiceAsync("UserInfo").then(function(u){var U=u.getUser();var i=e?null:"dismissed";U.setImportBookmarksFlag(i);u.updateUserPreferences();U.resetChangedProperty("importBookmarks");});};return M;});
sap.ui.predefine('sap/ushell/components/pages/StateManager',["sap/ushell/utils","sap/ushell/EventHub"],function(S,E){"use strict";var a={};a.init=function(p,b){this.oPagesVisibility={};this.oPagesRuntimeNavContainer=p;this.oPagesNavContainer=b;this._oURLParsingService=sap.ushell.Container.getServiceAsync("URLParsing");this.oPagesRuntimeNavContainer.attachNavigate(this._onErrorPageNavigated,this);this.oPagesNavContainer.attachNavigate(this._onPageNavigated,this);this._onTabNavigatedBind=this._onTabNavigated.bind(this);document.addEventListener("visibilitychange",this._onTabNavigatedBind);this.oEventBus=sap.ui.getCore().getEventBus();this.oEventBus.subscribe("launchpad","setConnectionToServer",this._onEnableRequests,this);this.oEventBus.subscribe("sap.ushell","navigated",this._onShellNavigated,this);this.oEventHubListener=E.once("PagesRuntimeRendered").do(function(){this._setCurrentPageVisibility(true);}.bind(this));};a._onEnableRequests=function(c,e,d){if(!d||d.active===undefined){return;}this._setCurrentPageVisibility(d.active);};a._setCurrentPageVisibility=function(v,r,n){if(this.oPagesRuntimeNavContainer.getCurrentPage().isA("sap.m.MessagePage")&&!n){return;}var c=this.oPagesNavContainer.getCurrentPage();if(c){this._setPageVisibility(c,v,r);}};a._setPageVisibility=function(p,v,r){if(!p){return;}if(p.getContent()[0].isA("sap.ushell.ui.launchpad.Page")){var P=p.getBindingContext().getPath();this.oPagesVisibility[P]=v;this._visitVisualizations(p,function(b){b.setActive(v,r);});}};a._visitVisualizations=function(p,v){if(!v){return;}p.getContent()[0].getSections().forEach(function(s){s.getVisualizations().forEach(v);});};a._onShellNavigated=function(){return this._oURLParsingService.then(function(u){var h=window.hasher.getHash();var H=u.parseShellHash(h);if(h==="Shell-home"||(H.semanticObject==="Launchpad"&&H.action==="openFLPPage")){this._setCurrentPageVisibility(true,true);}else{this._setCurrentPageVisibility(false,false);}}.bind(this));};a._onTabNavigated=function(){return this._oURLParsingService.then(function(u){var h=window.hasher.getHash();var H=u.parseShellHash(h);if(h==="Shell-home"||(H.semanticObject==="Launchpad"&&H.action==="openFLPPage")){this._setCurrentPageVisibility(!document.hidden);}}.bind(this));};a._onPageNavigated=function(e){var p=e.getParameters();this._setPageVisibility(p.from,false,false);this._setPageVisibility(p.to,true,true);};a._onErrorPageNavigated=function(e){var t=e.getParameter("to");this._setCurrentPageVisibility(!t.isA("sap.m.MessagePage"),undefined,true);};a.getPageVisibility=function(p){return this.oPagesVisibility[p];};a.exit=function(){this.oEventBus.unsubscribe("sap.ushell","navigated",this._onPageNavigated,this);document.removeEventListener("visibilitychange",this._onTabNavigatedBind);this.oPagesNavContainer.detachNavigate(this._onPageNavigated,this);this.oPagesRuntimeNavContainer.detachNavigate(this._onErrorPageNavigated,this);this.oEventBus.unsubscribe("launchpad","setConnectionToServer",this._onEnableRequests,this);this.oEventHubListener.off();};return a;});
sap.ui.predefine('sap/ushell/components/pages/controller/ImportDialog.controller',["sap/ui/core/mvc/Controller","sap/ui/core/Fragment","sap/ui/model/json/JSONModel","sap/ushell/components/pages/MyHomeImport","sap/ushell/Config","sap/ushell/library","sap/ushell/resources","sap/ushell/utils/WindowUtils"],function(C,F,J,M,a,u,r,W){"use strict";var D=u.DisplayFormat;var c={"X-SAP-UI2-CHIP:SSB_NUMERIC":"ssuite/smartbusiness/tiles/numeric","X-SAP-UI2-CHIP:SSB_CONTRIBUTION":"ssuite/smartbusiness/tiles/contribution","X-SAP-UI2-CHIP:SSB_TREND":"ssuite/smartbusiness/tiles/trend","X-SAP-UI2-CHIP:SSB_DEVIATION":"ssuite/smartbusiness/tiles/deviation","X-SAP-UI2-CHIP:SSB_COMPARISON":"ssuite/smartbusiness/tiles/comparison","X-SAP-UI2-CHIP:SSB_BLANK":"ssuite/smartbusiness/tiles/blank","X-SAP-UI2-CHIP:SSB_DUAL":"ssuite/smartbusiness/tiles/dual"};return C.extend("sap.ushell.components.pages.controller.ImportDialog",{open:function(){if(!this._pFragmentLoad){this._pFragmentLoad=F.load({name:"sap.ushell.components.pages.view.ImportDialog",controller:this}).then(function(f){this._oDialog=f;this._oDialog.setModel(r.i18nModel,"i18n");this._oDialog.setModel(new J({busy:true,groups:[],PersonalizedGroups:[]}));M.getData().then(function(g){f.getModel().setData({busy:false,groups:g,PersonalizedGroups:g.map(function(b){return{title:b.isDefault?r.i18n.getText("my_group"):b.title,description:b.id,selected:true};})});}).catch(function(e){return sap.ushell.Container.getServiceAsync("Message").then(function(m){m.error(e);});});return this._oDialog;}.bind(this));}return this._pFragmentLoad.then(function(){this._oDialog.open();return this._oDialog;}.bind(this));},close:function(){if(this._oDialog){this._oDialog.close();}},doImport:function(){var m=this._oDialog.getModel();var s=[];m.getProperty("/PersonalizedGroups").forEach(function(b){if(b.selected){s.push(b.description);}});var g=this._prepareImport(s);this._saveImport(g);},_moveVisualization:function(p,g,i,t,d){var T=this._getSectionIndex(p,g,i,d);var b=this._getDefaultSectionIndex(p);var o=this._getDefaultSection(p);var s=0;if(o&&o.visualizations&&o.visualizations.length){s=o.visualizations.length-1;}return p.moveVisualization(this.iPageIndex,b,s,T,t);},_updateVisualization:function(p,g,t,i,v,d){if(t.bUpdateNeeded){var s=this._getSectionIndex(p,g,i,d);return p.updateVisualization(this.iPageIndex,s,v,t);}return Promise.resolve();},_addVisualization:function(g,t,v,i,s,b,d){if(t.isABookmark){if(t.isCustomBookmark){this.aPromiseChain.push(function(){return s.bookmark.addCustomBookmark(t.vizType,t,b).then(this._moveVisualization.bind(this,s.pages,g,i,v,d)).then(this._updateVisualization.bind(this,s.pages,g,t,i,v,d));}.bind(this));}else{this.aPromiseChain.push(function(){return s.bookmark.addBookmark(t,b).then(this._moveVisualization.bind(this,s.pages,g,i,v,d)).then(this._updateVisualization.bind(this,s.pages,g,t,i,v,d));}.bind(this));}}else{this.aPromiseChain.push(function(){var S=this._getSectionIndex(s.pages,g,i,d);var e=s.pages.getModel().getProperty("/pages/"+this.iPageIndex+"/sections/"+S+"/id");return s.pages.addVisualization(this.sPageId,e,t.vizId).then(this._updateVisualization.bind(this,s.pages,g,t,i,v,d));}.bind(this));}},_addToPresetSection:function(g,b,s,d,e){var p=this._getPresetSection(s.pages);var E=p.visualizations.filter(function(v){return v.displayFormatHint!=="compact";}).length;var f=p.visualizations.filter(function(v){return v.displayFormatHint==="compact";}).length;for(var i=0;i<g.tiles.length;++i){this._addVisualization(g,g.tiles[i],i+E,b,s,d,e);}for(var j=0;j<g.links.length;++j){this._addVisualization(g,g.links[j],j+f+E+g.tiles.length,b,s,d,e);}},_addSection:function(g,b,s,d,e){this.aPromiseChain.push(function(){var U=this._getSectionIndex(s.pages,g,b,e);return s.pages.addSection(this.iPageIndex,U,{title:g.title});}.bind(this));for(var i=0,l=g.tiles.length;i<l;++i){this._addVisualization(g,g.tiles[i],i,b,s,d,e);}for(var j=0,f=g.links.length;j<f;++j){this._addVisualization(g,g.links[j],j+g.tiles.length,b,s,d,e);}},_getMyHomeContentNode:function(b){var s=a.last("/core/spaces/myHome/myHomeSpaceId");return b.getContentNodes().then(function(d){var m=d.find(function(e){return e.id===s;});if(!m){return null;}return m.children.find(function(e){return e.id===this.sPageId;}.bind(this));}.bind(this));},_saveImport:function(g){this._oDialog.setBusy(true);var s;this.sPageId=a.last("/core/spaces/myHome/myHomePageId");this.aTilesUpdateNeeded=[];this.aTilesMoveNeeded=[];this.aPromiseChain=[];return Promise.all([sap.ushell.Container.getServiceAsync("Bookmark"),sap.ushell.Container.getServiceAsync("Message"),sap.ushell.Container.getServiceAsync("Pages"),sap.ushell.Container.getServiceAsync("UserInfo")]).then(function(S){s={bookmark:S[0],message:S[1],pages:S[2],userInfo:S[3]};return this._getMyHomeContentNode(s.bookmark);}.bind(this)).then(function(m){this.iPageIndex=s.pages.getPageIndex(this.sPageId);s.pages.enableImplicitSave(false);this._performImportOperations(g,s,m);return this._executeSequentially(this.aPromiseChain);}.bind(this)).then(function(){return this._savePersonalizations(s.pages);}.bind(this)).then(function(){s.message.info(r.i18n.getText("MyHome.InitialPage.Message.ImportSuccessful"));s.userInfo.getUser().setImportBookmarksFlag("done");return s.userInfo.updateUserPreferences();}).then(function(){W.refreshBrowser();}).catch(function(e){s.message.error(e);}).finally(function(){this._oDialog.setBusy(false);this.close();}.bind(this));},_performImportOperations:function(g,s,m){var G;var d=false;for(var i=0,l=g.length;i<l;++i){G=g[i];if(G.isDefault){this._addToPresetSection(G,i,s,m,d);d=true;}else{this._addSection(G,i,s,m,d);}}},_executeSequentially:function(p){return p.reduce(function(b,d){return b.then(function(){return d();});},Promise.resolve());},_getSectionIndex:function(p,g,b,d){var o=this._getPresetSectionIndex(p);if(!g.isDefault&&!g.isLocked&&!d){return o+b+1;}return o+b;},_getPresetSectionIndex:function(p){var s=p.getModel().getProperty("/pages/"+this.iPageIndex+"/sections/");return s.findIndex(function(b){return b.id===a.last("/core/spaces/myHome/presetSectionId");});},_getDefaultSectionIndex:function(p){var s=p.getModel().getProperty("/pages/"+this.iPageIndex+"/sections/");return s.findIndex(function(b){return b.default;});},_getPresetSection:function(p){var s=p.getModel().getProperty("/pages/"+this.iPageIndex+"/sections/");return s.find(function(b){return b.id===a.last("/core/spaces/myHome/presetSectionId");});},_getDefaultSection:function(p){var s=p.getModel().getProperty("/pages/"+this.iPageIndex+"/sections/");return s.find(function(b){return b.default;});},_gatherVizDataObjectFromChipInstance:function(o){var b;var d;var v={vizId:o.chipId,isABookmark:!!o.configuration};if(v.isABookmark){v.isCustomBookmark=["X-SAP-UI2-CHIP:/UI2/STATIC_APPLAUNCHER","X-SAP-UI2-CHIP:/UI2/DYNAMIC_APPLAUNCHER"].indexOf(o.chipId)===-1;b=JSON.parse(JSON.parse(o.configuration).tileConfiguration);v.title=b.display_title_text;v.url=b.navigation_target_url;v.icon=b.display_icon_url;v.info=b.display_info_text;v.subtitle=b.display_subtitle_text;v.serviceUrl=b.service_url;v.serviceRefreshInterval=b.service_refresh_interval;v.numberUnit=b.display_number_unit;v.vizConfig=o.configuration;}d=o.ChipInstanceBags.results;if(d.length){v.bUpdateNeeded=!v.isABookmark;if(v.isCustomBookmark){v.vizConfig={};v.loadManifest=true;v.vizType=c[o.chipId];v.chipConfig={chipId:o.chipId,bags:{},configuration:JSON.parse(o.configuration)};d.forEach(function(B){v.chipConfig.bags[B.id]={properties:{},texts:{}};B.ChipInstanceProperties.results.forEach(function(p){if(p.translatable==="X"){v.chipConfig.bags[B.id].texts[p.name]=p.value;}else{v.chipConfig.bags[B.id].properties[p.name]=p.value;}});});}d.filter(function f(e){return e.id==="tileProperties";}).forEach(function(B){B.ChipInstanceProperties.results.forEach(function(t){switch(t.name){case"display_title_text":v.title=t.value;break;case"display_subtitle_text":v.subtitle=t.value;break;case"display_info_text":v.info=t.value;break;case"display_search_keywords":v.searchKeyword=t.value;break;default:break;}});});d.filter(function f(e){return e.id==="sb_tileProperties";}).forEach(function(B){B.ChipInstanceProperties.results.forEach(function(t){switch(t.name){case"title":v.title=t.value;break;case"description":v.subtitle=t.value;break;default:break;}});});}return v;},_savePersonalizations:function(p){p.enableImplicitSave(true);return p.savePersonalization(this.sPageId).then(function(){p.enableImplicitSave(false);});},_prepareImport:function(g){var G={};var m=this._oDialog.getModel();var b=m.getProperty("/groups");var v;var V;b.forEach(function(o){if(g.indexOf(o.id)===-1){return;}v={};o.chips.forEach(function(e){V=this._gatherVizDataObjectFromChipInstance(e);v[e.instanceId]=V;}.bind(this));o.tiles=[];o.tileOrder.forEach(function(t){V=v[t];if(V){delete v[t];o.tiles.push(V);}});o.links=[];o.linkOrder.forEach(function(t){V=v[t];if(V){delete v[t];V.displayFormatHint=D.Compact;V.bUpdateNeeded=true;o.links.push(V);}});Object.keys(v).map(function(k){o.tiles.push(v[k]);});G[o.id]=o;}.bind(this));var d=[];var o;g.forEach(function(s){o=G[s];if(o){d.push(o);}});return d;}});});
sap.ui.predefine('sap/ushell/components/pages/controller/MyHome.controller',["sap/ushell/components/pages/MyHomeImport","sap/ui/model/json/JSONModel","sap/ui/core/mvc/Controller","sap/ushell/resources","sap/ushell/EventHub","sap/base/Log"],function(m,J,C,r,E,L){"use strict";return C.extend("sap.ushell.components.pages.controller.MyHome",{onInit:function(){this.oViewModel=new J({personalizationAvailable:false});var s=function(f){this.oViewModel.setProperty("/personalizationAvailable",!!f);}.bind(this);this.getView().setModel(r.i18nModel,"i18n");this.getView().setModel(this.oViewModel,"view");m.isImportEnabled().then(s);this.oImportBookmarksFlagListener=E.on("importBookmarksFlag").do(s);},onExit:function(){this.oImportBookmarksFlagListener.off();},connect:function(c){this.fnOnEdit=c.onEdit;this.fnOnOpenDialog=c.onOpenDialog;},onEditPress:function(){if(this.fnOnEdit){this.fnOnEdit();}},onImportDialogPress:function(){if(this.fnOnOpenDialog){this.fnOnOpenDialog();}},onMessageStripClose:function(){this.oViewModel.setProperty("/personalizationAvailable",false);m.setImportEnabled(false);sap.ui.require(["sap/m/MessageBox"],function(M){M.information(r.i18n.getText("MyHome.InitialPage.MessageStrip.Popup"));});}});});
sap.ui.predefine('sap/ushell/components/pages/controller/PageRuntime.controller',["sap/ui/core/library","sap/ushell/library","sap/ui/core/mvc/Controller","sap/ui/events/KeyCodes","sap/m/GenericTile","sap/ushell/resources","sap/ui/model/json/JSONModel","sap/ushell/Config","sap/m/library","sap/m/MessageToast","sap/ushell/components/pages/StateManager","sap/ushell/EventHub","sap/ushell/utils","sap/m/Button","sap/base/strings/capitalize","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ushell/components/pages/controller/PagesAndSpaceId","sap/ushell/components/pages/MyHomeImport","sap/ui/thirdparty/hasher","sap/base/Log"],function(c,u,C,K,G,r,J,a,l,M,s,E,U,B,b,F,d,P,e,h,L){"use strict";var I=c.InvisibleMessageMode;var f=l.LoadState;var D=u.DisplayFormat;return C.extend("sap.ushell.components.pages.controller.Pages",{onInit:function(){this._oVisualizationInstantiationServicePromise=sap.ushell.Container.getServiceAsync("VisualizationInstantiation");this._oURLParsingService=sap.ushell.Container.getServiceAsync("URLParsing");this._oViewSettingsModel=new J({sizeBehavior:a.last("/core/home/sizeBehavior"),actionModeActive:false,showHideButton:a.last("/core/catalog/enableHideGroups"),showAddButton:a.last("/core/catalog/enabled"),personalizationEnabled:a.last("/core/shell/enablePersonalization"),showPageTitle:false});this.getView().setModel(this._oViewSettingsModel,"viewSettings");this._sMyHomePageId=a.last("/core/spaces/myHome/myHomePageId");this._aConfigListeners=a.on("/core/home/sizeBehavior").do(function(S){this._oViewSettingsModel.setProperty("/sizeBehavior",S);}.bind(this));this._oErrorPageModel=new J({icon:"sap-icon://documents",text:"",description:"",details:""});this.getView().setModel(this._oErrorPageModel,"errorPage");this.oInitFinishedPromise=Promise.all([this._oVisualizationInstantiationServicePromise,this.getOwnerComponent().getPagesService()]).then(function(S){this._oVisualizationInstantiationService=S[0];this.getView().setModel(S[1].getModel());}.bind(this));E.emit("S4MyHomePlugin",this.byId("pagesNavContainer").getId());this.sCurrentTargetPageId="";var R=sap.ushell.Container.getRenderer();this._openFLPPage().then(function(){this.oContainerRouter=R.getRouter();this.oContainerRouter.getRoute("home").attachMatched(this._onPageComponentNavigation,this);this.oContainerRouter.getRoute("openFLPPage").attachMatched(this._onPageComponentNavigation,this);}.bind(this));this.bIsHomeIntentRootIntent=U.isFlpHomeIntent(R.getShellConfig().rootIntent);this.oErrorPage=this.byId("errorPage");this.oPagesNavContainer=this.byId("pagesNavContainer");this.oPagesRuntimeNavContainer=this.byId("pagesRuntimeNavContainer");s.init(this.oPagesRuntimeNavContainer,this.oPagesNavContainer);this.oEventHubListener=E.once("PagesRuntimeRendered").do(this._onFirstPageRendering.bind(this));this._oEventBus=sap.ui.getCore().getEventBus();this._oEventBus.subscribe("launchpad","shellFloatingContainerIsDocked",this._handleUshellContainerDocked,this);this._oEventBus.subscribe("launchpad","shellFloatingContainerIsUnDocked",this._handleUshellContainerDocked,this);this.oVisualizationInstantiationListener=E.on("VizInstanceLoaded").do(function(){this._setPerformanceMark();if(!this.oVisualizationInstantiationListenerTimeout){this.oVisualizationInstantiationListenerTimeout=setTimeout(function(){this.oVisualizationInstantiationListener.off();}.bind(this),5000);}}.bind(this));},_onFirstPageRendering:function(){var p=a.last("/core/shell/enablePersonalization");var m=a.last("/core/spaces/myHome/userEnabled")&&a.last("/core/spaces/myHome/enabled");if(p){this._createActionModeButton();}else if(m){sap.ushell.Container.getServiceAsync("Menu").then(function(o){return o.getMyHomeSpace();}).then(function(H){if(!H||!H.pages.length){return;}var g=H.pages[0].title;this._createActionModeButton(g);}.bind(this));}E.emit("firstSegmentCompleteLoaded",true);},_onPageComponentNavigation:function(){this._removeMyHomePage();this._openFLPPage();var A=sap.ui.getCore().byId("ActionModeBtn");if(A&&!this.bIsHomeIntentRootIntent){var R=sap.ushell.Container.getRenderer("fiori2");if(R.getShellConfig().moveEditHomePageActionToShellHeader){R.showHeaderEndItem(A.getId(),true);}else{R.showActionButton(A.getId(),true);}}},_setPerformanceMark:function(){U.setPerformanceMark("FLP-TTI-Homepage",{bUseUniqueMark:true,bUseLastMark:true});},_openFLPPage:function(){var p,S;return P._getPageAndSpaceId().then(function(i){p=i.pageId;S=i.spaceId;this.sCurrentTargetPageId=p;this.sCurrentTargetSpaceId=S;return Promise.all([this.oInitFinishedPromise,sap.ushell.Container.getServiceAsync("Menu")]).then(function(R){var m=R[1];return m.isSpacePageAssigned(S,p);}).then(function(A){if(!A){return Promise.reject("The combination of space and page is not assgined to the user.");}return this.getOwnerComponent().getPagesService();}.bind(this)).then(function(g){return g.loadPage(p);}).then(function(){this._showActionModeButton();if(this.sCurrentTargetPageId===p){if(this._isMyHomeRouteActive()){this._oViewSettingsModel.setProperty("/personalizationEnabled",true);if(this._isMyHomePageEmpty()){return this._navigateToInitialMyHome();}}else{this._oViewSettingsModel.setProperty("/personalizationEnabled",a.last("/core/shell/enablePersonalization"));}return this._navigate(p,S);}return Promise.resolve();}.bind(this)).then(this._notifyOnPageRuntimeRendered.bind(this)).catch(function(g){if(g instanceof Error){this._oErrorPageModel.setProperty("/text",r.i18n.getText("PageRuntime.GeneralError.Text"));}else{var j=r.i18n.getText("PageRuntime.CannotLoadPage.Description")+JSON.stringify(g);this._oErrorPageModel.setProperty("/icon","sap-icon://documents");this._oErrorPageModel.setProperty("/text",r.i18n.getText("PageRuntime.CannotLoadPage.Text",[p,S]));this._oErrorPageModel.setProperty("/description","");this._oErrorPageModel.setProperty("/details",j);}this.oPagesRuntimeNavContainer.to(this.oErrorPage);this._hideActionModeButton();this._cancelActionMode();this._notifyOnPageRuntimeRendered();}.bind(this));}.bind(this)).catch(this._onError.bind(this));},_onError:function(g){this._oErrorPageModel.setProperty("/icon","sap-icon://documents");this._oErrorPageModel.setProperty("/text",g||"");this._oErrorPageModel.setProperty("/description","");this._oErrorPageModel.setProperty("/details","");this.oPagesRuntimeNavContainer.to(this.oErrorPage);this._hideActionModeButton();this._cancelActionMode();this._notifyOnPageRuntimeRendered();},_navigate:function(t,g,k){var p=this.oPagesNavContainer.getPages().find(function(o){return t===o.data("pageId");});if(!p){return Promise.reject();}var m;return sap.ushell.Container.getServiceAsync("Menu").then(function(S){m=S;return m.hasMultiplePages(g);}).then(function(H){var S=this.oPagesNavContainer.getCurrentPage()===p;this._oViewSettingsModel.setProperty("/showPageTitle",H);this.oPagesNavContainer.to(p);this.oPagesRuntimeNavContainer.to(this.oPagesNavContainer);if(!S&&!k){this._cancelActionMode();}m.getSpaceAndPageTitles(g,t).then(function(T){var o={pageTitle:T.pageTitle,spaceTitle:T.spaceTitle,hash:h.getHash()};a.emit("/core/shell/model/currentSpaceAndPage",o);});}.bind(this));},_navigateToInitialMyHome:function(){if(!this._pLoadMyHomeView){this._pLoadMyHomeView=new Promise(function(g,i){sap.ui.require(["sap/ui/core/mvc/XMLView"],function(X){X.create({id:"sapUshellMyHomePage",viewName:"sap.ushell.components.pages.view.MyHomeStart"}).then(function(p){p.getController().connect({onEdit:this.pressActionModeButton.bind(this),onOpenDialog:this.openMyHomeImportDialog.bind(this)});g(p);}.bind(this)).catch(i);}.bind(this),i);}.bind(this));}return this._pLoadMyHomeView.then(function(p){this._cancelActionMode();this.oPagesNavContainer.insertPage(p,0);this.oPagesNavContainer.to(p);}.bind(this));},_notifyOnPageRuntimeRendered:function(){try{var p;var o=this.oPagesNavContainer.getCurrentPage();p=o&&o.getId();E.emit("S4Plugin_PagesRuntimeRendered",p);}catch(g){L.error("Error while trying to trigger the PagesRuntimeRendered event for the S/4 My Home plugin");}E.emit("PagesRuntimeRendered");if(E.last("AppRendered")!==undefined){E.emit("AppRendered",undefined);}},_pressViewDetailsButton:function(){var g=this._oErrorPageModel.getProperty("/details")||"";this._oErrorPageModel.setProperty("/description",g);},_copyToClipboard:function(){var t=document.createElement("textarea");try{t.contentEditable=true;t.readonly=false;t.textContent=this._oErrorPageModel.getProperty("/description");document.documentElement.appendChild(t);t.select();document.execCommand("copy");M.show(r.i18n.getText("PageRuntime.CannotLoadPage.CopySuccess"),{closeOnBrowserNavigation:false});}catch(o){M.show(r.i18n.getText("PageRuntime.CannotLoadPage.CopyFail"),{closeOnBrowserNavigation:false});}finally{t.parentNode.removeChild(t);}},_visualizationFactory:function(i,g){if(this._oVisualizationInstantiationService){var o=g.getObject();var p=g.getPath();var S=p.replace(/\/visualizations\/\d*\/?$/,"");var j=S.replace(/\/sections\/\d*\/?$/,"");var k=g.getModel().getProperty(S);var m=g.getModel().getProperty(j);var v=this._oVisualizationInstantiationService.instantiateVisualization(o);v.attachPress(this.onVisualizationPress,this);v.bindEditable("viewSettings>/actionModeActive");if(!k.default){this._addTileActions(v,m.id);}var n=g.getPath().split("/")[2];var A=!!s.getPageVisibility("/pages/"+n);v.setActive(A);return v;}return new G({state:f.Failed});},_addTileActions:function(v,p){var A=v.getAvailableDisplayFormats(),m=a.last("/core/spaces/myHome/userEnabled")&&a.last("/core/spaces/myHome/enabled"),g=p===this._sMyHomePageId;for(var i=0;i<A.length;i++){v.addTileAction(new B({text:"{i18n>VisualizationInstance.ConvertTo"+b(A[i])+"Action}",press:[A[i],this._updateVisualizationDisplayFormat,this]}));}v.addTileAction(new B({text:"{i18n>moveTileDialog_action}",press:[v,this._openMoveVisualizationDialog,this]}));if(m&&!g){v.addTileAction(new B({text:"{i18n>addToMyHome_action}",press:[v,this._addToMyHome,this]}));}},_openMoveVisualizationDialog:function(o,v){this._oVizInstanceToBeMoved=v;var V=v.getBindingContext().getPath();var g=V.split("/");var i="/pages/"+g[2]+"/sections";if(!this._oMoveVisualizationDialog){sap.ui.require(["sap/ui/core/Fragment"],function(j){j.load({name:"sap.ushell.components.pages.MoveVisualization",controller:this}).then(function(k){this._oMoveVisualizationDialog=k;this.getView().addDependent(k);k.bindObject({path:i});k.open();}.bind(this));}.bind(this));}else{this._oMoveVisualizationDialog.bindObject({path:i});this._oMoveVisualizationDialog.open();}},_addToMyHome:function(o,v){var V=v.getBindingContext().getObject();return this.getOwnerComponent().getPagesService().then(function(p){return p.copyVisualization(this._sMyHomePageId,null,V);}.bind(this)).then(function(){M.show(r.i18n.getText("PageRuntime.MessageToast.TileAddedToMyHome"));});},_confirmSelect:function(o){var g=new F("default",d.EQ,false);var i=o.getSource().getBinding("items");i.filter([g]);var v=this._oVizInstanceToBeMoved.getBindingContext().getPath();var V=v.split("/");var p=V[2];var j=V[4];var k=V[6];var t=o.getParameter("selectedItem").getBindingContext().getPath();var T=t.split("/");var m=T[4];var S=this._getAncestorControl(this._oVizInstanceToBeMoved,"sap.ushell.ui.launchpad.Section");var n=this._getAncestorControl(this._oVizInstanceToBeMoved,"sap.ushell.ui.launchpad.Page");var q=n.getSections();var w=q[m];var A=S.getItemPosition(this._oVizInstanceToBeMoved).area;this._oVizInstanceToBeMoved=null;var x=this.getOwnerComponent();return x.getPagesService().then(function(y){return y.moveVisualization(p,j,k,m,-1);}).then(function(R){var y=w.getVisualizations()[R.visualizationIndex];if(y){w.focusVisualization(y);}var z=this._getVizMoveAnnouncement(A,A);x.getInvisibleMessageInstance().announce(z,I.Polite);}.bind(this));},_onMoveTileSearch:function(o){var v=o.getParameter("value");var g=new F("title",d.Contains,v);var i=new F("default",d.EQ,false);var j=o.getParameter("itemsBinding");j.filter([g,i]);},_onMoveTileDialogClose:function(o){this._oVizInstanceToBeMoved=null;var g=new F("default",d.EQ,false);o.getSource().getBinding("items").filter([g]);},_updateVisualizationDisplayFormat:function(o,n){var g=o.getSource().getBindingContext();var p=g.getPath();var i=p.split("/");var O;var j=this.getOwnerComponent();return j.getPagesService().then(function(k){O=k.getModel().getProperty(p).displayFormatHint;var v={displayFormatHint:n};return k.updateVisualization(i[2],i[4],i[6],v);}).then(function(){var k=this._getVizMoveAnnouncement(O,n);j.getInvisibleMessageInstance().announce(k,I.Polite);}.bind(this));},onVisualizationPress:function(o){var S=o.getParameter("scope");var A=o.getParameter("action");var v=o.getSource();var g=v.getBindingContext();var p=g.getPath();var i=p.split("/");var j=this._getAncestorControl(v,"sap.ushell.ui.launchpad.Section");if(S==="Actions"&&A==="Remove"){return this.getOwnerComponent().getPagesService().then(function(k){var O=j.getItemPosition(v);k.deleteVisualization(i[2],i[4],i[6]);M.show(r.i18n.getText("PageRuntime.MessageToast.TileRemoved"));j._focusItem(O);});}return Promise.resolve();},onExit:function(){this.oContainerRouter.getRoute("home").detachMatched(this._onPageComponentNavigation,this);this.oContainerRouter.getRoute("openFLPPage").detachMatched(this._onPageComponentNavigation,this);this._aConfigListeners.off();this.oEventHubListener.off();this._oEventBus.unsubscribe("launchpad","shellFloatingContainerIsDocked",this._handleUshellContainerDocked,this);this._oEventBus.unsubscribe("launchpad","shellFloatingContainerIsUnDocked",this._handleUshellContainerDocked,this);s.exit();var A=sap.ui.getCore().byId("ActionModeBtn");if(A){A.destroy();}},_hideActionModeButton:function(){var A=sap.ui.getCore().byId("ActionModeBtn");if(A){A.setVisible(false);}},_showActionModeButton:function(){var A=sap.ui.getCore().byId("ActionModeBtn");if(A){A.setVisible(true);}},_createActionModeButton:function(p){var g=p?r.i18n.getText("PageRuntime.EditModeForPage.Activate",p):r.i18n.getText("PageRuntime.EditMode.Activate");var A={id:"ActionModeBtn",text:g,tooltip:g,icon:"sap-icon://edit",press:[this.pressActionModeButton,this]};var R=sap.ushell.Container.getRenderer("fiori2");var m=R.getShellConfig().moveEditHomePageActionToShellHeader;if(m){this._createHeaderActionModeButton(A);}else{this._createUserActionModeButton(A);}},_createHeaderActionModeButton:function(A){sap.ui.require(["sap/ushell/ui/shell/ShellHeadItem"],function(S){var o=new S(A);if(a.last("/core/extension/enableHelp")){o.addStyleClass("help-id-ActionModeBtn");}var R=sap.ushell.Container.getRenderer("fiori2");if(this.bIsHomeIntentRootIntent){R.showHeaderEndItem(o.getId(),false,["home"]);}else{R.showHeaderEndItem(o.getId(),true);}}.bind(this));},_createUserActionModeButton:function(A){var o={controlType:"sap.ushell.ui.launchpad.ActionItem",oControlProperties:A,bIsVisible:true,aStates:["home"]};if(!this.bIsHomeIntentRootIntent){o.aStates=null;o.bCurrentState=true;}sap.ushell.Container.getRenderer("fiori2").addUserAction(o).done(function(g){if(a.last("/core/extension/enableHelp")){g.addStyleClass("help-id-ActionModeBtn");}});},pressActionModeButton:function(){var v=this.getView().getModel("viewSettings");var A=v.getProperty("/actionModeActive");var p=v.getProperty("/personalizationEnabled");sap.ui.require(["sap/ushell/components/pages/ActionMode"],function(g){if(A){g.cancel();return;}else if(p||this._isMyHomeRouteActive()){g.start(this);}else{this.oPagesNavContainer.attachEventOnce("afterNavigate",function(){g.start(this);}.bind(this));this.oContainerRouter.navTo("home");}}.bind(this));},_cancelActionMode:function(){var A=this.getView().getModel("viewSettings").getProperty("/actionModeActive");if(A){sap.ui.require(["sap/ushell/components/pages/ActionMode"],function(g){g.cancel();});}},handleEditModeAction:function(H,o,S,p){sap.ui.require(["sap/ushell/components/pages/ActionMode"],function(A){A[H](o,S,p);});},_getAncestorControl:function(g,i){if(g&&g.isA&&g.isA(i)){return g;}else if(g&&g.getParent){return this._getAncestorControl(g.getParent(),i);}return null;},moveVisualization:function(o){var g=o.getParameter("draggedControl"),i=o.getParameter("droppedControl"),j=o.getParameter("dropPosition"),k=o.getParameter("browserEvent"),m=k&&k.keyCode,p=this._getAncestorControl(g,"sap.ushell.ui.launchpad.Page"),n=parseInt(g.getBindingContext().getPath().split("/")[2],10),q=this._getAncestorControl(g,"sap.ushell.ui.launchpad.Section"),t=p.indexOfSection(q),v=q.indexOfVisualization(g),w=q.getVisualizations()[v],x=q.getItemPosition(w),T,y,z,A,H;if(!i){var N=o.mParameters.browserEvent.keyCode===K.ARROW_UP,S=p.getSections();y=t;while(true){y=N?--y:++y;T=S[y];if(!T||T.getDefault()){w.invalidate();return Promise.resolve();}if(T.getShowSection()||T.getEditable()){z=T.getClosestCompactItemIndex(g.getDomRef(),N);A=T.getVisualizations()[z];H=T.getItemPosition(A);if(H.area!==x.area){H=x;}break;}}}else{if(i.isA("sap.ushell.ui.launchpad.section.CompactArea")){var O=i.getItems();if(O.length){i=O[O.length-1];j="After";}}T=this._getAncestorControl(i,"sap.ushell.ui.launchpad.Section");y=p.indexOfSection(T);if(T.getDefault()&&!q.getDefault()){w.invalidate();return Promise.resolve();}z=T.indexOfVisualization(i);A=T.getVisualizations()[z];H=T.getItemPosition(A);if(H.index===-1){H.area=x.area;}if(t===y){if(j==="Before"&&v<z){z--;}else if(j==="After"&&v>z){z++;}if(v===z&&H.area===x.area){w.invalidate();return Promise.resolve();}}else if(j==="After"){z++;}}if((t!==y)&&(m===K.ARROW_UP||m===K.ARROW_DOWN)&&(x.index>H.index)){z++;}var Q;var R=this.getOwnerComponent();return R.getPagesService().then(function(V){Q=V;Q.enableImplicitSave(false);return Q.moveVisualization(n,t,v,y,z);}).then(function(V){z=V.visualizationIndex;if(x.area!==H.area){var W={displayFormatHint:H.area};return Q.updateVisualization(n,y,z,W);}return Promise.resolve();}).then(function(){return Q.savePersonalization();}).then(function(){var V=T.getVisualizations()[z];if(V){T.focusVisualization(V);V.invalidate();}var W=this._getVizMoveAnnouncement(x.area,H.area);R.getInvisibleMessageInstance().announce(W,I.Polite);}.bind(this)).finally(function(){Q.enableImplicitSave(true);});},_getVizMoveAnnouncement:function(g,t){if(g===t){if(t===D.Compact){return r.i18n.getText("PageRuntime.Message.LinkMoved");}return r.i18n.getText("PageRuntime.Message.TileMoved");}else if(g===D.Compact){return r.i18n.getText("PageRuntime.Message.LinkConverted");}return r.i18n.getText("PageRuntime.Message.TileConverted");},onDragEnter:function(o){var t=o.getParameter("dragSession").getDropControl();if(t.getDefault()){o.preventDefault();}},onAreaDragEnter:function(o){var S=o.getParameter("sourceArea");var t=o.getParameter("targetArea");if(S===t){return;}var v=o.getParameter("dragControl");var A=v.getAvailableDisplayFormats();if(A.indexOf(t)===-1){if(t===D.Standard&&A.indexOf(D.StandardWide)>-1){return;}if(t===D.Flat&&A.indexOf(D.FlatWide)>-1){return;}o.getParameter("originalEvent").preventDefault();}},_handleUshellContainerDocked:function(g,i){this._oViewSettingsModel.setProperty("/ushellContainerDocked",i==="shellFloatingContainerIsDocked");},_isMyHomeRouteActive:function(){return a.last("/core/spaces/myHome/enabled")&&a.last("/core/spaces/myHome/userEnabled")&&a.last("/core/spaces/myHome/myHomeSpaceId")===this.sCurrentTargetSpaceId;},_getMyHomePageData:function(){var p=this.getView().getModel().getProperty("/pages")||[];for(var i=0;i<p.length;i++){if(p[i]&&p[i].id==="SAP_BASIS_PG_UI_MYHOME"){return p[i];}}return null;},_isMyHomePageEmpty:function(){var p=this._getMyHomePageData();if(p&&p.sections){return p.sections.every(function(S){var v=S.visualizations;return!(v&&v.length);});}return false;},handleMyHomeActionMode:function(g){if(this._isMyHomeRouteActive()){if(g){return this._enterMyHomeActionMode();}else if(this._isMyHomePageEmpty()){return this._navigateToInitialMyHome();}}return Promise.resolve();},_enterMyHomeActionMode:function(){return Promise.all([this._navigate(this.sCurrentTargetPageId,this.sCurrentTargetSpaceId,true),e.isImportEnabled()]).then(function(R){if(!R[1]){if(this._pMessageStrip){this._pMessageStrip.then(function(m){m.setVisible(false);});}return Promise.resolve();}if(!this._pMessageStrip){this._pMessageStrip=new Promise(function(g,i){sap.ui.require(["sap/ui/core/Fragment"],function(j){j.load({name:"sap.ushell.components.pages.view.MessageStrip",controller:this}).then(function(m){E.on("importBookmarksFlag").do(function(v){m.setVisible(!!v);});m.addStyleClass("sapUiSmallMarginBottom");g(m);}).catch(i);}.bind(this),i);}.bind(this));}return this._pMessageStrip.then(function(m){this.oPagesNavContainer.getCurrentPage().getContent()[0].setMessageStrip(m);}.bind(this));}.bind(this));},openMyHomeImportDialog:function(){if(!this._pLoadImportDialog){this._pLoadImportDialog=new Promise(function(g,i){sap.ui.require(["sap/ushell/components/pages/controller/ImportDialog.controller"],function(j){g(new j());},i);});}return this._pLoadImportDialog.then(function(i){return i.open();});},onImportDialogPress:function(){this.openMyHomeImportDialog();},onMessageStripClose:function(){e.setImportEnabled(false);sap.ui.require(["sap/m/MessageBox"],function(g){g.information(r.i18n.getText("MyHome.InitialPage.MessageStrip.Popup"));});},_removeMyHomePage:function(){this.oPagesNavContainer.removePage("sapUshellMyHomePage");},_sectionEnableReset:function(g,p){if(g===a.last("/core/spaces/myHome/presetSectionId")){return false;}return p;},_sectionEnableDelete:function(g,p){if(g===a.last("/core/spaces/myHome/presetSectionId")){return false;}return!p;}});});
sap.ui.predefine('sap/ushell/components/pages/controller/PagesAndSpaceId',["sap/ushell/resources","sap/ushell/Config"],function(r,C){"use strict";var P=function(){};P.prototype._getPageAndSpaceId=function(s){return sap.ushell.Container.getServiceAsync("URLParsing").then(function(u){if(!s){s=window.hasher.getHash();}var h=u.parseShellHash(s);var i={semanticObject:h.semanticObject||"",action:h.action||""};var H=h.params||{};var p=H.pageId||[];var S=H.spaceId||[];return this._parsePageAndSpaceId(p,S,i);}.bind(this));};P.prototype._parsePageAndSpaceId=function(p,s,i){return new Promise(function(a,b){this.getUserMyHomeEnablement().then(function(){if(p.length<1&&s.length<1){if(i.semanticObject==="Shell"&&i.action==="home"){this._getUserDefaultPage().then(function(R){a(R);}).catch(function(e){b(e);});return;}b(r.i18n.getText("PageRuntime.NoPageIdAndSpaceIdProvided"));}if(p.length===1&&s.length===0){b(r.i18n.getText("PageRuntime.OnlyPageIdProvided"));}if(p.length===0&&s.length===1){b(r.i18n.getText("PageRuntime.OnlySpaceIdProvided"));}if(p.length>1||s.length>1){b(r.i18n.getText("PageRuntime.MultiplePageOrSpaceIdProvided"));}if(p[0]===""){b(r.i18n.getText("PageRuntime.InvalidPageId"));}if(s[0]===""){b(r.i18n.getText("PageRuntime.InvalidSpaceId"));}a({pageId:p[0],spaceId:s[0]});}.bind(this));}.bind(this));};P.prototype.getUserMyHomeEnablement=function(){return new Promise(function(a,b){var u=sap.ushell.Container.getUser().getShowMyHome();C.emit("/core/spaces/myHome/userEnabled",u);a(u);});};P.prototype._getUserDefaultPage=function(){return new Promise(function(a,b){Promise.all([sap.ushell.Container.getServiceAsync("Menu"),this.getUserMyHomeEnablement()]).then(function(R){var m=R[0];m.getSpacesPagesHierarchy().then(function(s){if(s.spaces.length===0){b(r.i18n.getText("PageRuntime.NoAssignedSpace"));}var S=s.spaces.find(function(o){return(!!(o.id&&o.pages&&o.pages[0]&&o.pages[0].id));});if(S){a({spaceId:S.id,pageId:S.pages[0].id});}else{b(r.i18n.getText("PageRuntime.NoAssignedPage"));}});});}.bind(this));};return new P();});
sap.ui.require.preload({
	"sap/ushell/components/pages/MoveVisualization.fragment.xml":'<core:FragmentDefinition xmlns="sap.m" xmlns:core="sap.ui.core"><SelectDialog items="{path:\'\',filters:[{path:\'default\',operator:\'EQ\',value1:false}]}" search="_onMoveTileSearch" title="{i18n&gt;PageRuntime.Dialog.Title.MoveVisualization}" confirm="_confirmSelect" cancel="_onMoveTileDialogClose" contentWidth="400px" contentHeight="auto"><StandardListItem title="{title}"/></SelectDialog></core:FragmentDefinition>',
	"sap/ushell/components/pages/manifest.json":'{"_version":"1.21.0","sap.app":{"id":"sap.ushell.components.pages","applicationVersion":{"version":"1.96.0"},"i18n":{"bundleUrl":"../../renderers/fiori2/resources/resources.properties","supportedLocales":["","ar","bg","ca","cs","da","de","el","en","en_US","en_US_sappsd","en_US_saptrc","es","et","fi","fr","hi","hr","hu","it","iw","ja","kk","ko","lt","lv","ms","nl","no","pl","pt","ro","ru","sh","sk","sl","sv","th","tr","uk","vi","zh_CN","zh_TW"],"fallbackLocale":"en"},"ach":"CA-FLP-FE-COR","type":"component","title":"","resources":"resources.json"},"sap.ui":{"technology":"UI5","deviceTypes":{"desktop":true,"tablet":true,"phone":true}},"sap.ui5":{"componentName":"sap.ushell.components.pages","rootView":{"viewName":"sap.ushell.components.pages.view.PageRuntime","type":"XML","async":true},"dependencies":{"minUI5Version":"1.72","libs":{"sap.ui.core":{},"sap.m":{},"sap.f":{}}},"contentDensities":{"compact":true,"cozy":true}}}',
	"sap/ushell/components/pages/view/ImportDialog.fragment.xml":'<core:FragmentDefinition xmlns="sap.m" xmlns:core="sap.ui.core"><Dialog title="{i18n&gt;MyHome.ImportDialog.Title}" class="sapUiContentPadding" contentWidth="30rem"><content><Text text="{i18n&gt;MyHome.ImportDialog.Info}" class="sapUiSmallMarginBottom"/><List items="{/PersonalizedGroups}" mode="MultiSelect" growingThreshold="50" class="sapUiSmallMarginBottom" includeItemInSelection="true" busy="{/busy}"><StandardListItem title="{title}" selected="{selected}"/></List></content><beginButton><Button text="{i18n&gt;MyHome.ImportDialog.Button.AddAppsToPage}" press=".doImport" type="Emphasized" enabled="{= !${/busy}}"/></beginButton><endButton><Button text="{i18n&gt;MyHome.ImportDialog.Button.Cancel}" press=".close"/></endButton></Dialog></core:FragmentDefinition>',
	"sap/ushell/components/pages/view/MessageStrip.fragment.xml":'<core:FragmentDefinition xmlns="sap.m" xmlns:core="sap.ui.core"><MessageStrip text="{i18n&gt;MyHome.InitialPage.MessageStrip.Text}" showIcon="true" visible="{view&gt;/personalizationAvailable}" close=".onMessageStripClose" showCloseButton="true"><link><Link text="{i18n&gt;MyHome.InitialPage.MessageStrip.Link}" press=".onImportDialogPress"/></link></MessageStrip></core:FragmentDefinition>',
	"sap/ushell/components/pages/view/MyHomeStart.view.xml":'<View xmlns="sap.m" xmlns:core="sap.ui.core" xmlns:f="sap.f" controllerName="sap.ushell.components.pages.controller.MyHome"><Page showHeader="false"><core:Fragment fragmentName="sap.ushell.components.pages.view.MessageStrip" type="XML" class="sapUiSmallMargin"/><VBox class="sapUiSmallMargin" alignItems="Center" justifyContent="Center"><f:IllustratedMessage illustrationSize="Scene" illustrationType="sapIllus-NoData" title="{i18n&gt;MyHome.InitialPage.Title}" description="{i18n&gt;MyHome.InitialPage.Description}"><f:additionalContent><Button text="{i18n&gt;MyHome.InitialPage.Button.EditPage}" press=".onEditPress"/></f:additionalContent></f:IllustratedMessage></VBox></Page></View>',
	"sap/ushell/components/pages/view/PageRuntime.view.xml":'<mvc:View xmlns="sap.m" xmlns:core="sap.ui.core" xmlns:mvc="sap.ui.core.mvc" xmlns:dnd="sap.ui.core.dnd" xmlns:data="http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1" xmlns:launchpad="sap.ushell.ui.launchpad" controllerName="sap.ushell.components.pages.controller.PageRuntime" height="100%"><NavContainer id="pagesRuntimeNavContainer"><NavContainer id="pagesNavContainer" pages="{/pages}"><pages><Page data:pageId="{id}" showHeader="false" backgroundDesign="Transparent" floatingFooter="true"><content><launchpad:Page edit="{viewSettings&gt;/actionModeActive}" dataHelpId="Page-{id}" showTitle="{viewSettings&gt;/showPageTitle}" title="{title}" sections="{path:\'sections\',templateShareable:false,key:\'id\'}" addSectionButtonPressed=".handleEditModeAction(\'addSection\', $event, ${$source&gt;/}, ${$parameters&gt;/})" enableSectionReordering="{viewSettings&gt;/actionModeActive}" sectionDrop=".handleEditModeAction(\'moveSection\', $event, ${$source&gt;/}, ${$parameters&gt;/})"><launchpad:sections><launchpad:Section title="{title}" class="sapContrastPlus" sizeBehavior="{viewSettings&gt;/sizeBehavior}" dataHelpId="Section-{id}" default="{default}" visualizations="{path:\'visualizations\',factory:\'._visualizationFactory\',key:\'id\'}" enableGridBreakpoints="false" enableGridContainerQuery="{viewSettings&gt;/ushellContainerDocked}" editable="{viewSettings&gt;/actionModeActive}" add=".handleEditModeAction(\'addVisualization\', $event, ${$source&gt;/}, ${$parameters&gt;/})" delete=".handleEditModeAction(\'deleteSection\', $event, ${$source&gt;/}, ${$parameters&gt;/})" reset=".handleEditModeAction(\'resetSection\', $event, ${$source&gt;/}, ${$parameters&gt;/})" sectionVisibilityChange=".handleEditModeAction(\'changeSectionVisibility\', $event, ${$source&gt;/}, ${$parameters&gt;/})" titleChange=".handleEditModeAction(\'changeSectionTitle\', $event, ${$source&gt;/}, ${$parameters&gt;/})" enableVisualizationReordering="{viewSettings&gt;/personalizationEnabled}" areaDragEnter=".onAreaDragEnter" visualizationDrop=".moveVisualization($event, ${$source&gt;/}, ${$parameters&gt;/})" showSection="{visible}" visible="{= !!${visualizations}.length || ${viewSettings&gt;/actionModeActive} }" noVisualizationsText="{i18n&gt;PageRuntime.EditMode.EmptySection}" showNoVisualizationsText="{viewSettings&gt;/actionModeActive}" enableAddButton="{viewSettings&gt;/showAddButton}" enableResetButton="{parts:[\'id\',\'preset\'],formatter:\'._sectionEnableReset\'}" enableDeleteButton="{parts:[\'id\',\'preset\'],formatter:\'._sectionEnableDelete\'}" enableShowHideButton="{viewSettings&gt;/showHideButton}"/></launchpad:sections><launchpad:dragDropConfig><dnd:DropInfo groupName="Section" targetAggregation="sections" dragEnter=".onDragEnter" drop=".moveVisualization($event, ${$source&gt;/}, ${$parameters&gt;/})"/></launchpad:dragDropConfig></launchpad:Page></content><footer><Bar class="sapUshellDashboardFooter" visible="{viewSettings&gt;/actionModeActive}"><contentRight><Button text="{i18n&gt;closeEditMode}" type="Emphasized" press=".handleEditModeAction(\'save\', $event, ${$source&gt;/}, ${$parameters&gt;/})"/></contentRight><customData><core:CustomData key="sap-ui-fastnavgroup" value="true" writeToDom="true"/></customData></Bar></footer><landmarkInfo><PageAccessibleLandmarkInfo rootRole="Region" rootLabel="{i18n&gt;PageSectionRegion}" headerRole="None" contentRole="None" footerRole="None"/></landmarkInfo></Page></pages><customData><core:CustomData key="help-id" value="{= ${viewSettings&gt;/personalizationEnabled} ? \'general-page-id-pers-allowed\' : \'general-page-id-no-pers-allowed\'}" writeToDom="true"/></customData></NavContainer><MessagePage id="errorPage" showHeader="false" icon="{errorPage&gt;/icon}" text="{errorPage&gt;/text}" description="{errorPage&gt;/description}"><buttons><Button text="{i18n&gt;PageRuntime.CannotLoadPage.DetailsButton}" visible="{= !!${errorPage&gt;/details} &amp;&amp; !${errorPage&gt;/description}}" press="._pressViewDetailsButton"/><Button text="{i18n&gt;PageRuntime.CannotLoadPage.CopyButton}" visible="{= !!${errorPage&gt;/details}}" press="._copyToClipboard"/></buttons></MessagePage></NavContainer></mvc:View>'
},"sap/ushell/components/pages/Component-preload"
);
//# sourceMappingURL=Component-preload.js.map