// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/util/ObjectPath","sap/ui/Device","sap/ushell/components/_HeaderManager/PropertyStrategiesFactory","sap/ushell/components/StateHelper","sap/ushell/Config","sap/ushell/EventHub","sap/ushell/utils","sap/ushell/utils/clone","sap/ushell/ui/horizon/NewDesignSwitchItem"],function(O,D,_,S,C,E,u,a,N){"use strict";var h={application:{},centralAreaElement:null,headEndItems:[],headItems:[],headerVisible:true,newDesignSwitchVisible:C.last("/core/shellHeader/newDesignSwitchVisible"),newDesignSwitchActive:C.last("/core/shellHeader/newDesignSwitchActive"),showLogo:false,ShellAppTitleState:undefined,rootIntent:C.last("/core/shellHeader/rootIntent"),homeUri:C.last("/core/shellHeader/homeUri"),title:""};var H;var A;var o="endItemsOverflowBtn";var c;var B={blank:{},"blank-home":{},home:{headItems:[]},app:{headItems:["backBtn","homeBtn"]},minimal:{headItems:["homeBtn"]},standalone:{headItems:["backBtn"]},embedded:{headItems:["backBtn","homeBtn"]},"embedded-home":{headItems:[]},headerless:{headItems:["backBtn","homeBtn"],headerVisible:false},merged:{headItems:["backBtn","homeBtn"]},"headerless-home":{headerVisible:false},"merged-home":{},lean:{headItems:[]},"lean-home":{}};var d=[];function i(J,K){var L=J&&J.appState?J.appState:"home";H=w(J);A=K;c=D.media.getCurrentRange(D.media.RANGESETS.SAP_STANDARD).name;v();e();s(L);q();}function b(){f();}function e(){var J=E.on("setHeaderCentralAreaElement").do(function(P){n({propertyName:"centralAreaElement",value:P.id,aStates:S.getPassStates(P.states),bCurrentState:!!P.currentState,bDoNotPropagate:!!P.bDoNotPropagate});});d.push(J);d.push(E.on("updateHeaderOverflowState").do(g));D.media.attachHandler(g,this,D.media.RANGESETS.SAP_STANDARD);d.push(C.on("/core/shellHeader/headEndItems").do(k));d.push(C.on("/core/shell/model/currentSpaceAndPage").do(j));}function f(){if(d){d.forEach(function(J){J.off();});}D.media.detachHandler(g,this,D.media.RANGESETS.SAP_STANDARD);}function g(P){if(P&&P.name){c=P.name;}v();k();}function v(J){var K=C.last("/core/shell/model/currentState/stateName"),L=K==="merged"||K==="headerless",M=C.last("/core/shell/model/currentViewPortState")==="LeftCenter",P=true;if((J||c)==="Phone"&&!M||L){P=false;}n({propertyName:"showLogo",value:P,aStates:["home","app","blank","blank-home","minimal","lean"],bCurrentState:false,bDoNotPropagate:true});}function j(J){if(C.last("/core/spaces/enabled")&&(C.last("/core/spaces/homeNavigationTarget")==="origin_page")){if(J){((this&&this.updateStates)||n)({propertyName:"homeUri",value:"#"+J.hash});}}}function k(P){var J=C.last("/core/shellHeader/headEndItems"),K=J.indexOf(o)>-1,L=P&&P.name||c,M;if(L==="Phone"&&!K&&J.length>2){if(C.last("/core/shellHeader/newDesignSwitchVisible")&&J.indexOf("newDesignSwitchItem")===-1){var Q=N.getSwitchItem();l([Q.getId()],false,["home","app"],true);}l([o],false,["home","app"]);}else if(L!=="Phone"&&K){M=sap.ui.getCore().byId("headEndItemsOverflow");if(M){M.destroy();}r([o],false,["home","app"]);}}function l(J,K,L,M){n({propertyName:"headEndItems",value:J,aStates:L,bCurrentState:!!K,bDoNotPropagate:!!M});}function r(J,K,L){n({propertyName:"headEndItems",value:J,aStates:L,bCurrentState:!!K,action:"remove",bDoNotPropagate:false});}function m(J,K){var L={};Object.keys(J).forEach(function(M){var P=J[M];L[M]=Object.keys(P).reduce(function(T,Q){T[Q]=P[Q];return T;},a(K));});return L;}function n(P){var J=P.propertyName,K=!P.bCurrentState?S.getAllStateToUpdate(P.aStates,P.bDoNotPropagate):[],L=C.last("/core/shellHeader"),M=C.last("/core/shell/model/currentState/stateName"),Q=P.value,R;if(J.charAt(0)==="/"){J=J.substring(1);}R=_(J,P.action);if(!R){return;}if(!P.bCurrentState){H=x(H,J,R,K,Q);}if(K.indexOf(M)>-1||P.bCurrentState){var T=O.get(J.split("/"),L),U=R.execute(T,Q);if(T!==U){O.set(J.split("/"),U,L);z(J,L);}}if(P.bCurrentState){y(J,R,Q);}}function p(J){var K;for(K in J){if(J.hasOwnProperty(K)){u.updateProperties(H[K],J[K]);}}}function s(J){var K=H[J];if(!K){throw new Error("the state ("+J+") does not exist");}K.newDesignSwitchActive=C.last("/core/shellHeader/newDesignSwitchActive");C.emit("/core/shellHeader",a(K));}function q(J){var K=C.last("/core/shellHeader"),L,M;if(A&&A.customShellState){L=A.customShellState.currentState;}if(J&&A.extendedShellStates[J]){M=A.extendedShellStates[J].customState.currentState;}C.emit("/core/shellHeader",t(K,L,M));}function t(J,K,L){var R={};Object.keys(J).forEach(function(P){var M=_(P);var Q=a(J[P]);if(M){if(L){Q=M.execute(Q,L[P]);}if(K){Q=M.execute(Q,K[P]);}}R[P]=Q;});R.ShellAppTitleState=C.last("/core/shellHeader/ShellAppTitleState");return R;}function w(J){if(J){h.rootIntent=J.rootIntent;h.homeUri="#"+J.rootIntent;}var K=m(B,h);function L(P,K){var Q,R;for(Q in K){if(Q==="blank"||Q==="blank-home"){continue;}if((P==="openCatalogBtn")&&(Q==="lean"||Q==="lean-home")){continue;}if(P==="ContactSupportBtn"){if(["home","app","minimal","standalone","embedded","embedded-home","lean"].indexOf(Q)===-1){continue;}}R=K[Q].headEndItems.indexOf(P);if(R===-1){K[Q].headEndItems.push(P);}}}function M(T,K){var P;for(P in K){K[P].title=T;}}if(J){if(J.moveContactSupportActionToShellHeader){L("ContactSupportBtn",K);}if(J.moveAppFinderActionToShellHeader){L("openCatalogBtn",K);}if(J.title){M(J.title,K);}}return K;}function x(J,P,K,L,M){if(L.length===0){return J;}var Q=a(J);L.forEach(function(R){var T=Q[R],U;if(T){U=K.execute(O.get(P.split("/"),T),M);O.set(P.split("/"),U,T);}});return Q;}function y(P,J,K){var L,M;if(!A){return;}L=A.customShellState.currentState;M=J.execute(O.get(P.split("/"),L),K);O.set(P.split("/"),M,L);}function z(P,J){var R=P.split("/").shift();C.emit("/core/shellHeader/"+R,J[R]);}function F(J){var K;try{K=H[J];}catch(L){K=undefined;}return K;}function G(J,P){var K;try{K=F(J)[P];}catch(L){K=undefined;}return K;}function I(T){H=T;}return{init:i,destroy:b,switchState:s,updateStates:n,recalculateState:q,extendStates:p,handleCurrentSpaceAndPage:j,handleEndItemsOverflow:k,validateShowLogo:v,_createInitialState:w,_generateBaseHeaderState:m,_getBaseState:F,_getBaseStateMember:G,_resetBaseStates:I};});
