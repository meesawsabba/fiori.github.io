// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/utils","sap/ui/core/library","sap/ui/thirdparty/jquery","sap/base/Log","sap/ui/core/UIComponent","sap/ushell/services/AppConfiguration","sap/ushell/EventHub","sap/ushell/components/applicationIntegration/application/PostMessageAPIInterface","sap/ui/thirdparty/URI","sap/base/util/deepExtend","sap/ushell/Config","sap/ushell/utils/UrlParsing"],function(u,c,q,L,U,A,E,P,a,d,C,b){"use strict";var S="sap.ushell.";var D=new U();var o={"sap.ushell.services.CrossApplicationNavigation":{oServiceCalls:{hrefForExternal:{executeServiceCallFn:function(e){var i=new q.Deferred();sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(j){j.hrefForExternalAsync(e.oMessageData.body.oArgs,undefined,true).then(i.resolve,i.reject);});return i.promise();}},getSemanticObjectLinks:{executeServiceCallFn:function(e){var i=new q.Deferred();sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(j){j.getSemanticObjectLinks(e.oMessageData.body.sSemanticObject,e.oMessageData.body.mParameters,e.oMessageData.body.bIgnoreFormFactors,undefined,undefined,e.oMessageData.body.bCompactIntents).then(i.resolve,i.reject);});return i.promise();}},isIntentSupported:{executeServiceCallFn:function(e){var i=new q.Deferred();sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(j){j.isIntentSupported(e.oMessageData.body.aIntents).then(i.resolve,i.reject);});return i.promise();}},isNavigationSupported:{executeServiceCallFn:function(e){var i=new q.Deferred();sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(j){j.isNavigationSupported(e.oMessageData.body.aIntents).then(i.resolve,i.reject);});return i.promise();}},backToPreviousApp:{executeServiceCallFn:function(){sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(e){e.backToPreviousApp();});return new q.Deferred().resolve().promise();}},historyBack:{executeServiceCallFn:function(e){sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(i){i.historyBack(e.oMessageData.body.iSteps);});return new q.Deferred().resolve().promise();}},getAppStateData:{executeServiceCallFn:function(e){var i=new q.Deferred();sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(j){j.getAppStateData(e.oMessageData.body.sAppStateKey).then(i.resolve,i.reject);});return i.promise();}},toExternal:{executeServiceCallFn:function(e){var i=new q.Deferred(),j=d({},e.oMessageData.body.oArgs);u.storeSapSystemToLocalStorage(j);sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(k){k.toExternal(j).then(i.resolve,i.reject);});return i.promise();}},registerBeforeAppCloseEvent:{executeServiceCallFn:function(e){e.oContainer.setProperty("beforeAppCloseEvent",{enabled:true,params:e.oMessageData.body},true);return new q.Deferred().resolve().promise();}},expandCompactHash:{executeServiceCallFn:function(e){var i=new q.Deferred();sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(j){j.expandCompactHash(e.oMessageData.body.sHashFragment).then(i.resolve,i.reject);});return i.promise();}},getDistinctSemanticObjects:{executeServiceCallFn:function(){var e=new q.Deferred();sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(i){i.getDistinctSemanticObjects().then(e.resolve,e.reject);});return e.promise();}},getLinks:{executeServiceCallFn:function(e){var i=new q.Deferred();sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(j){j.getLinks(e.oMessageData.body).then(i.resolve,i.reject);});return i.promise();}},getPrimaryIntent:{executeServiceCallFn:function(e){var i=new q.Deferred();sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(j){j.getPrimaryIntent(e.oMessageData.body.sSemanticObject,e.oMessageData.body.mParameters).then(i.resolve,i.reject);});return i.promise();}},hrefForAppSpecificHash:{executeServiceCallFn:function(e){var i=new q.Deferred();sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(j){j.hrefForAppSpecificHashAsync(e.oMessageData.body.sAppHash).then(i.resolve,i.reject);});return i.promise();}},isInitialNavigation:{executeServiceCallFn:function(){var e=new q.Deferred();sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(i){i.isInitialNavigationAsync().then(function(I){e.resolve(I);});});return e.promise();}},getAppState:{executeServiceCallFn:function(e){var i=new q.Deferred();sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(j){j.getAppState(D,e.oMessageData.body.sAppStateKey).done(function(k){delete k._oServiceInstance;i.resolve(k);});});return i.promise();}},setInnerAppRoute:{executeServiceCallFn:function(e){var H=b.parseShellHash(window.hasher.getHash()),n;if(H.appSpecificRoute===e.oMessageData.body.appSpecificRoute){return new q.Deferred().resolve().promise();}H.appSpecificRoute=e.oMessageData.body.appSpecificRoute;n="#"+b.constructShellHash(H);window.hasher.changed.active=false;window.hasher.replaceHash(n);window.hasher.changed.active=true;return new q.Deferred().resolve().promise();}},setInnerAppStateData:{executeServiceCallFn:function(e){var i=new q.Deferred();f.prototype._createNewInnerAppState(e).then(i.resolve);return i.promise();}},resolveIntent:{executeServiceCallFn:function(e){var i=new q.Deferred();sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(j){j.resolveIntent(e.oMessageData.body.sHashFragment).then(i.resolve,i.reject);});return i.promise();}}}},"sap.ushell.ui5service.ShellUIService":{oServiceCalls:{setTitle:{executeServiceCallFn:function(e){return new q.Deferred().resolve(e.oContainer.getShellUIService().setTitle(e.oMessageData.body.sTitle)).promise();}},setBackNavigation:{executeServiceCallFn:function(e){return e.executeSetBackNavigationService(e.oMessage,e.oMessageData);}}}},"sap.ushell.services.ShellUIService":{oServiceCalls:{setTitle:{executeServiceCallFn:function(e){return new q.Deferred().resolve(e.oContainer.getShellUIService().setTitle(e.oMessageData.body.sTitle)).promise();}},setHierarchy:{executeServiceCallFn:function(e){return new q.Deferred().resolve(e.oContainer.getShellUIService().setHierarchy(e.oMessageData.body.aHierarchyLevels)).promise();}},setRelatedApps:{executeServiceCallFn:function(e){return new q.Deferred().resolve(e.oContainer.getShellUIService().setRelatedApps(e.oMessageData.body.aRelatedApps)).promise();}},setDirtyFlag:{executeServiceCallFn:function(e){sap.ushell.Container.setDirtyFlag(e.oMessageData.body.bIsDirty);return new q.Deferred().resolve().promise();}},showShellUIBlocker:{executeServiceCallFn:function(e){s(e.oMessageData.body.bShow);return new q.Deferred().resolve().promise();}},getFLPUrl:{executeServiceCallFn:function(e){var i=false;if(e.oMessageData.body&&e.oMessageData.body.bIncludeHash===true){i=true;}return new q.Deferred().resolve(sap.ushell.Container.getFLPUrl(i)).promise();}},getShellGroupIDs:{executeServiceCallFn:function(e){var i=new q.Deferred();sap.ushell.Container.getServiceAsync("Bookmark").then(function(B){B.getShellGroupIDs((e.oMessageData.body?e.oMessageData.body.bGetAll:undefined)).then(i.resolve,i.reject);});return i.promise();}},addBookmark:{executeServiceCallFn:function(e){var i=new q.Deferred();sap.ushell.Container.getServiceAsync("Bookmark").then(function(B){B.addBookmarkByGroupId(e.oMessageData.body.oParameters,e.oMessageData.body.groupId).then(i.resolve,i.reject);});return i.promise();}},addBookmarkDialog:{executeServiceCallFn:function(e){sap.ui["require"](["sap/ushell/ui/footerbar/AddBookmarkButton"],function(i){var j=new i();j.firePress({});});return new q.Deferred().resolve().promise();}},getShellGroupTiles:{executeServiceCallFn:function(e){var i=new q.Deferred();sap.ushell.Container.getServiceAsync("LaunchPage").then(function(l){l.getTilesByGroupId(e.oMessageData.body.groupId).then(i.resolve,i.reject);});return i.promise();}},sendUrlAsEmail:{executeServiceCallFn:function(e){var i=C.last("/core/shellHeader/application").title;var j=(i===undefined)?sap.ushell.resources.i18n.getText("linkToApplication"):sap.ushell.resources.i18n.getText("linkTo")+" '"+i+"'";f.prototype._sendEmail("",j,document.URL,"","",document.URL,true);return new q.Deferred().resolve().promise();}},sendEmailWithFLPButton:{executeServiceCallFn:function(e){var i=C.last("/core/shellHeader/application").title;var j=(i===undefined)?sap.ushell.resources.i18n.getText("linkToApplication"):sap.ushell.resources.i18n.getText("linkTo")+" '"+i+"'";f.prototype._sendEmail("",j,document.URL,"","",document.URL,e.oMessageData.body.bSetAppStateToPublic);return new q.Deferred().resolve().promise();}},sendEmail:{executeServiceCallFn:function(e){f.prototype._sendEmail(e.oMessageData.body.sTo,e.oMessageData.body.sSubject,e.oMessageData.body.sBody,e.oMessageData.body.sCc,e.oMessageData.body.sBcc,e.oMessageData.body.sIFrameURL,e.oMessageData.body.bSetAppStateToPublic);return new q.Deferred().resolve().promise();}},processHotKey:{executeServiceCallFn:function(e){var i;try{i=new KeyboardEvent("keydown",e.oMessageData.body);}catch(j){var I=document.createEvent("KeyboardEvent"),k="";if(e.oMessageData.body.altKey){k+="Alt ";}if(e.oMessageData.body.ctrlKey){k+="Control ";}if(e.oMessageData.body.shiftKey){k+="Shift ";}I.initKeyboardEvent("keydown",false,false,null,e.oMessageData.body.key,e.oMessageData.body.keyCode,k,0,false);i=I;}document.dispatchEvent(i);return new q.Deferred().resolve().promise();}}}},"sap.ushell.services.Container":{oServiceCalls:{setDirtyFlag:{executeServiceCallFn:function(e){sap.ushell.Container.setDirtyFlag(e.oMessageData.body.bIsDirty);return new q.Deferred().resolve().promise();}},getFLPUrl:{executeServiceCallFn:function(e){var i=false;if(e.oMessageData.body&&e.oMessageData.body.bIncludeHash===true){i=true;}return new q.Deferred().resolve(sap.ushell.Container.getFLPUrl(i)).promise();}},getFLPConfig:{executeServiceCallFn:function(e){var i=new q.Deferred();sap.ushell.Container.getFLPConfig().then(function(F){i.resolve(F);});return i.promise();}},getFLPPlatform:{executeServiceCallFn:function(e){var i=new q.Deferred();sap.ushell.Container.getFLPPlatform().then(i.resolve);return i.promise();}}}},"sap.ushell.services.AppState":{oServiceCalls:{getAppState:{executeServiceCallFn:function(e){var i=new q.Deferred();sap.ushell.Container.getServiceAsync("AppState").then(function(j){j.getAppState(e.oMessageData.body.sKey).done(function(k){delete k._oServiceInstance;i.resolve(k);}).fail(function(k){delete k._oServiceInstance;i.resolve(k);});});return i.promise();}},_saveAppState:{executeServiceCallFn:function(e){var i=new q.Deferred();sap.ushell.Container.getServiceAsync("AppState").then(function(j){j._saveAppState(e.oMessageData.body.sKey,e.oMessageData.body.sData,e.oMessageData.body.sAppName,e.oMessageData.body.sComponent,e.oMessageData.body.bTransient,e.oMessageData.body.iPersistencyMethod,e.oMessageData.body.oPersistencySettings).then(i.resolve,i.reject);});return i.promise();}},_loadAppState:{executeServiceCallFn:function(e){var i=new q.Deferred();sap.ushell.Container.getServiceAsync("AppState").then(function(j){j._loadAppState(e.oMessageData.body.sKey).then(i.resolve,i.reject);});return i.promise();}},deleteAppState:{executeServiceCallFn:function(e){var i=new q.Deferred();sap.ushell.Container.getServiceAsync("AppState").then(function(j){j.deleteAppState(e.oMessageData.body.sKey).then(i.resolve,i.reject);});return i.promise();}},makeStatePersistent:function(e){var i=new q.Deferred();sap.ushell.Container.getServiceAsync("AppState").then(function(j){j.makeStatePersistent(e.oMessageData.body.sKey,e.oMessageData.body.iPersistencyMethod,e.oMessageData.body.oPersistencySettings).then(i.resolve,i.reject);});return i.promise();}}},"sap.ushell.services.Bookmark":{oServiceCalls:{addBookmarkUI5:{executeServiceCallFn:function(e){var i=new q.Deferred();sap.ushell.Container.getServiceAsync("AppLifeCycle").then(function(j){j.getCurrentApplication().getSystemContext().then(function(k){f.prototype._stripBookmarkServiceUrlForLocalContentProvider(e.oMessageData.body.oParameters,k);sap.ushell.Container.getServiceAsync("Bookmark").then(function(B){B.addBookmark(e.oMessageData.body.oParameters,e.oMessageData.body.vContainer,k.id).then(i.resolve,i.reject);});});});return i.promise();}},addBookmark:{executeServiceCallFn:function(e){var i=new q.Deferred();sap.ushell.Container.getServiceAsync("Bookmark").then(function(B){B.addBookmarkByGroupId(e.oMessageData.body.oParameters,e.oMessageData.body.groupId).then(i.resolve,i.reject);});return i.promise();}},getShellGroupIDs:{executeServiceCallFn:function(){var e=new q.Deferred();sap.ushell.Container.getServiceAsync("Bookmark").then(function(B){B.getShellGroupIDs().then(e.resolve,e.reject);});return e.promise();}},addCatalogTileToGroup:{executeServiceCallFn:function(e){var i=new q.Deferred();sap.ushell.Container.getServiceAsync("Bookmark").then(function(B){B.addCatalogTileToGroup(e.oMessageData.body.sCatalogTileId,e.oMessageData.body.sGroupId,e.oMessageData.body.oCatalogData).then(i.resolve,i.reject);});return i.promise();}},countBookmarks:{executeServiceCallFn:function(e){var i=new q.Deferred();sap.ushell.Container.getServiceAsync("AppLifeCycle").then(function(j){j.getCurrentApplication().getSystemContext().then(function(k){sap.ushell.Container.getServiceAsync("Bookmark").then(function(B){B.countBookmarks(e.oMessageData.body.sUrl,k.id).then(i.resolve,i.reject);});});});return i.promise();}},deleteBookmarks:{executeServiceCallFn:function(e){var i=new q.Deferred();sap.ushell.Container.getServiceAsync("AppLifeCycle").then(function(j){j.getCurrentApplication().getSystemContext().then(function(k){sap.ushell.Container.getServiceAsync("Bookmark").then(function(B){B.deleteBookmarks(e.oMessageData.body.sUrl,k.id).then(i.resolve,i.reject);});});});return i.promise();}},updateBookmarks:{executeServiceCallFn:function(e){var i=new q.Deferred();sap.ushell.Container.getServiceAsync("AppLifeCycle").then(function(j){j.getCurrentApplication().getSystemContext().then(function(k){sap.ushell.Container.getServiceAsync("Bookmark").then(function(B){B.updateBookmarks(e.oMessageData.body.sUrl,e.oMessageData.body.oParameters,k.id).then(i.resolve,i.reject);});});});return i.promise();}},getContentNodes:{executeServiceCallFn:function(){var e=new q.Deferred();sap.ushell.Container.getServiceAsync("Bookmark").then(function(B){B.getContentNodes().then(e.resolve,e.reject);});return e.promise();}},addCustomBookmark:{executeServiceCallFn:function(e){var i=new q.Deferred();sap.ushell.Container.getServiceAsync("AppLifeCycle").then(function(j){j.getCurrentApplication().getSystemContext().then(function(k){sap.ushell.Container.getServiceAsync("Bookmark").then(function(B){B.addCustomBookmark(e.oMessageData.body.sVizType,e.oMessageData.body.oConfig,e.oMessageData.body.vContentNodes,k.id).then(i.resolve,i.reject);});});});return i.promise();}},countCustomBookmarks:{executeServiceCallFn:function(e){var i=new q.Deferred();sap.ushell.Container.getServiceAsync("AppLifeCycle").then(function(j){j.getCurrentApplication().getSystemContext().then(function(k){e.oMessageData.body.oIdentifier.contentProviderId=k.id;sap.ushell.Container.getServiceAsync("Bookmark").then(function(B){B.countCustomBookmarks(e.oMessageData.body.oIdentifier).then(i.resolve,i.reject);});});});return i.promise();}},updateCustomBookmarks:{executeServiceCallFn:function(e){var i=new q.Deferred();sap.ushell.Container.getServiceAsync("AppLifeCycle").then(function(j){j.getCurrentApplication().getSystemContext().then(function(k){e.oMessageData.body.oIdentifier.contentProviderId=k.id;sap.ushell.Container.getServiceAsync("Bookmark").then(function(B){B.updateCustomBookmarks(e.oMessageData.body.oIdentifier,e.oMessageData.body.oConfig).then(i.resolve,i.reject);});});});return i.promise();}},deleteCustomBookmarks:{executeServiceCallFn:function(e){var i=new q.Deferred();sap.ushell.Container.getServiceAsync("AppLifeCycle").then(function(j){j.getCurrentApplication().getSystemContext().then(function(k){e.oMessageData.body.oIdentifier.contentProviderId=k.id;sap.ushell.Container.getServiceAsync("Bookmark").then(function(B){B.deleteCustomBookmarks(e.oMessageData.body.oIdentifier).then(i.resolve,i.reject);});});});return i.promise();}},addBookmarkToPage:{executeServiceCallFn:function(e){var i=new q.Deferred();sap.ushell.Container.getServiceAsync("AppLifeCycle").then(function(j){j.getCurrentApplication().getSystemContext().then(function(k){sap.ushell.Container.getServiceAsync("Bookmark").then(function(B){B.addBookmarkToPage(e.oMessageData.body.oParameters,e.oMessageData.body.sPageId,k.id).then(i.resolve,i.reject);});});});return i.promise();}}}},"sap.ushell.services.AppLifeCycle":{oServiceCalls:{getFullyQualifiedXhrUrl:{executeServiceCallFn:function(e){var r="",x="",i=new q.Deferred(),p=e.oMessageData.body.path;if(p!==""&&p!==undefined&&p!==null){sap.ushell.Container.getServiceAsync("AppLifeCycle").then(function(j){j.getCurrentApplication().getSystemContext().then(function(k){x=k.getFullyQualifiedXhrUrl(p);var H="",l="",m="",F=sap.ushell.Container.getFLPUrl(true),n=new a(F);if(n.protocol()!==null&&n.protocol()!==undefined&&n.protocol()!==""){l=n.protocol()+"://";}if(n.hostname()!==null&&n.hostname()!==undefined&&n.hostname()!==""){H=n.hostname();}if(n.port()!==null&&n.port()!==undefined&&n.port()!==""){m=":"+n.port();}r=l+H+m+x;i.resolve(r);});});}return i.promise();}},getSystemAlias:{executeServiceCallFn:function(e){var i=e.oContainer.getSystemAlias();if(i===null||i===undefined){i="";}return new q.Deferred().resolve(i).promise();}}}},"sap.ushell.services.AppConfiguration":{oServiceCalls:{setApplicationFullWidth:{executeServiceCallFn:function(e){A.setApplicationFullWidth(e.oMessageData.body.bValue);return new q.Deferred().resolve().promise();}}}},"sap.ushell.appRuntime":{oRequestCalls:{innerAppRouteChange:{isActiveOnly:true,distributionType:["all"]},hashChange:{isActiveOnly:true,distributionType:["URL"]},setDirtyFlag:{isActiveOnly:true,distributionType:["URL"]},getDirtyFlag:{isActiveOnly:true,distributionType:["URL"]},themeChange:{isActiveOnly:false,distributionType:["all"]},uiDensityChange:{isActiveOnly:false,distributionType:["all"]}},oServiceCalls:{hashChange:{executeServiceCallFn:function(e){var i=new q.Deferred();window.hasher.disableBlueBoxHashChangeTrigger=true;window.hasher.replaceHash(e.oMessageData.body.newHash);window.hasher.disableBlueBoxHashChangeTrigger=false;var j=e.oMessageData.body.direction;if(j){sap.ushell.Container.getServiceAsync("ShellNavigation").then(function(k){k.hashChanger.fireEvent("hashReplaced",{hash:k.hashChanger.getHash(),direction:j});L.debug("PostMessageAPI.hashChange :: Informed by the Iframe, to change the "+"History direction property in FLP to: "+j);i.resolve();});}else{i.resolve();}return i.promise();}}}},"sap.ushell.services.UserInfo":{oServiceCalls:{getThemeList:{executeServiceCallFn:function(e){var i=new q.Deferred();sap.ushell.Container.getServiceAsync("UserInfo").then(function(j){j.getThemeList().then(i.resolve,i.reject);});return i.promise();}},getLanguageList:{executeServiceCallFn:function(e){var i=new q.Deferred();sap.ushell.Container.getServiceAsync("UserInfo").then(function(j){j.getLanguageList().then(i.resolve,i.reject);});return i.promise();}},updateUserPreferences:{executeServiceCallFn:function(e){var i=new q.Deferred();if(e.oMessageData.body.language){sap.ushell.Container.getUser().setLanguage(e.oMessageData.body.language);sap.ushell.Container.getServiceAsync("UserInfo").then(function(j){j.updateUserPreferences().then(function(){sap.ushell.Container.getUser().resetChangedProperty("language");i.resolve();},i.reject);});}else{i.resolve();}return i.promise();}},openThemeManager:{executeServiceCallFn:function(e){E.emit("openThemeManager",Date.now());return new q.Deferred().resolve().promise();}}}},"sap.ushell.services.ShellNavigation":{oServiceCalls:{toExternal:{executeServiceCallFn:function(e){sap.ushell.Container.getServiceAsync("ShellNavigation").then(function(i){i.toExternal(e.oMessageData.body.oArgs,undefined,e.oMessageData.body.bWriteHistory);});return new q.Deferred().resolve().promise();}},toAppHash:{executeServiceCallFn:function(e){sap.ushell.Container.getServiceAsync("ShellNavigation").then(function(i){i.toAppHash(e.oMessageData.body.sAppHash,e.oMessageData.body.bWriteHistory);});return new q.Deferred().resolve().promise();}}}},"sap.ushell.services.NavTargetResolution":{oServiceCalls:{getDistinctSemanticObjects:{executeServiceCallFn:function(){var e=new q.Deferred();sap.ushell.Container.getServiceAsync("NavTargetResolution").then(function(n){n.getDistinctSemanticObjects().then(e.resolve,e.reject);});return e.promise();}},expandCompactHash:{executeServiceCallFn:function(e){var i=new q.Deferred();sap.ushell.Container.getServiceAsync("NavTargetResolution").then(function(n){n.expandCompactHash(e.oMessageData.body.sHashFragment).then(i.resolve,i.reject);});return i.promise();}},resolveHashFragment:{executeServiceCallFn:function(e){var i=new q.Deferred();sap.ushell.Container.getServiceAsync("NavTargetResolution").then(function(n){n.resolveHashFragment(e.oMessageData.body.sHashFragment).then(i.resolve,i.reject);});return i.promise();}},isNavigationSupported:{executeServiceCallFn:function(e){var i=new q.Deferred();sap.ushell.Container.getServiceAsync("NavTargetResolution").then(function(n){n.isNavigationSupported(e.oMessageData.body.aIntents).then(i.resolve,i.reject);});return i.promise();}}}},"sap.ushell.services.Renderer":{oServiceCalls:{addHeaderItem:{executeServiceCallFn:function(e){h("addHeaderItem",e);return new q.Deferred().resolve().promise();}},addHeaderEndItem:{executeServiceCallFn:function(e){h("addHeaderEndItem",e);return new q.Deferred().resolve().promise();}},showHeaderItem:{executeServiceCallFn:function(e){sap.ushell.Container.getRenderer("fiori2").showHeaderItem(e.oMessageData.body.aIds,e.oMessageData.body.bCurrentState||true,e.oMessageData.body.aStates);return new q.Deferred().resolve().promise();}},showHeaderEndItem:{executeServiceCallFn:function(e){sap.ushell.Container.getRenderer("fiori2").showHeaderEndItem(e.oMessageData.body.aIds,e.oMessageData.body.bCurrentState||true,e.oMessageData.body.aStates);return new q.Deferred().resolve().promise();}},hideHeaderItem:{executeServiceCallFn:function(e){sap.ushell.Container.getRenderer("fiori2").hideHeaderItem(e.oMessageData.body.aIds,e.oMessageData.body.bCurrentState||true,e.oMessageData.body.aStates);return new q.Deferred().resolve().promise();}},hideHeaderEndItem:{executeServiceCallFn:function(e){sap.ushell.Container.getRenderer("fiori2").hideHeaderEndItem(e.oMessageData.body.aIds,e.oMessageData.body.bCurrentState||true,e.oMessageData.body.aStates);return new q.Deferred().resolve().promise();}},setHeaderTitle:{executeServiceCallFn:function(e){sap.ushell.Container.getRenderer("fiori2").setHeaderTitle(e.oMessageData.body.sTitle);return new q.Deferred().resolve().promise();}},setHeaderVisibility:{executeServiceCallFn:function(e){sap.ushell.Container.getRenderer("fiori2").setHeaderVisibility(e.oMessageData.body.bVisible,e.oMessageData.body.bCurrentState||true,e.oMessageData.body.aStates);return new q.Deferred().resolve().promise();}},createShellHeadItem:{executeServiceCallFn:function(e){var p=e.oMessageData.body.params;p.press=function(){e.oContainer.postMessageRequest("sap.ushell.appRuntime.buttonClick",{buttonId:p.id});};new sap.ushell.ui.shell.ShellHeadItem(p);return new q.Deferred().resolve().promise();}},showActionButton:{executeServiceCallFn:function(e){sap.ushell.Container.getRenderer("fiori2").showActionButton(e.oMessageData.body.aIds,e.oMessageData.body.bCurrentState,e.oMessageData.body.aStates);return new q.Deferred().resolve().promise();}},hideActionButton:{executeServiceCallFn:function(e){sap.ushell.Container.getRenderer("fiori2").hideActionButton(e.oMessageData.body.aIds,e.oMessageData.body.bCurrentState,e.oMessageData.body.aStates);return new q.Deferred().resolve().promise();}},addUserAction:{executeServiceCallFn:function(e){e.oMessageData.body.oParameters.oControlProperties.press=function(){e.oContainer.postMessageRequest("sap.ushell.appRuntime.buttonClick",{buttonId:e.oMessageData.body.oParameters.oControlProperties.id});};sap.ushell.Container.getRenderer("fiori2").addUserAction(e.oMessageData.body.oParameters);return new q.Deferred().resolve().promise();}},addOptionsActionSheetButton:{executeServiceCallFn:function(e){var B=Array.isArray(e.oMessageData.body)?e.oMessageData.body:[e.oMessageData.body];B.forEach(function(i){if(sap.ui.getCore().byId(i.id)){sap.ui.getCore().byId(i.id).destroy();}new sap.m.Button({id:i.id,text:i.text,icon:i.icon,tooltip:i.tooltip,press:function(){e.oContainer.postMessageRequest("sap.ushell.appRuntime.buttonClick",{buttonId:i.id});}});sap.ushell.Container.getRenderer("fiori2").showActionButton([i.id],true,i.aStates);});return new q.Deferred().resolve().promise();}},removeOptionsActionSheetButton:{executeServiceCallFn:function(e){var B=Array.isArray(e.oMessageData.body)?e.oMessageData.body:[e.oMessageData.body];B.forEach(function(i){sap.ushell.Container.getRenderer("fiori2").hideActionButton(i.id,true,i.aStates);if(sap.ui.getCore().byId(i.id)){sap.ui.getCore().byId(i.id).destroy();}});return new q.Deferred().resolve().promise();}}}},"sap.ushell.services.LaunchPage":{oServiceCalls:{getGroupsForBookmarks:{executeServiceCallFn:function(){var e=new q.Deferred();sap.ushell.Container.getServiceAsync("LaunchPage").then(function(l){l.getGroupsForBookmarks().then(e.resolve,e.reject);});return e.promise();}}}},"sap.ushell.services.Menu":{oServiceCalls:{getSpacesPagesHierarchy:{executeServiceCallFn:function(){var e=new q.Deferred();sap.ushell.Container.getServiceAsync("Menu").then(function(M){M.getSpacesPagesHierarchy().then(function(i){e.resolve(i);});});return e.promise();}}}},"sap.ushell.services.CommonDataModel":{oServiceCalls:{getAllPages:{executeServiceCallFn:function(){var e=new q.Deferred();sap.ushell.Container.getServiceAsync("CommonDataModel").then(function(i){i.getAllPages().then(function(p){e.resolve(p);});});return e.promise();}}}}};function f(){this._getBrowserURL=function(){return document.URL;};Object.keys(o).forEach(function(k){if(k.indexOf(S)!==0){throw new Error("All Post Message APIs must start with '"+S+"' - "+k);}});P.init(true,f.prototype.registerShellCommunicationHandler.bind(this));}f.prototype.getAPIs=function(){return o;};function g(k,e){var i=o[k],n;if(i){if(e.oServiceCalls){Object.keys(e.oServiceCalls).forEach(function(j){i.oServiceCalls[j]=e.oServiceCalls[j];});}if(e.oRequestCalls){Object.keys(e.oRequestCalls).forEach(function(j){i.oRequestCalls[j]=e.oRequestCalls[j];});}return;}n={oRequestCalls:{},oServiceCalls:{}};if(e.oServiceCalls){Object.keys(e.oServiceCalls).forEach(function(j){n.oServiceCalls[j]=e.oServiceCalls[j];});}if(e.oRequestCalls){Object.keys(e.oRequestCalls).forEach(function(j){n.oRequestCalls[j]=e.oRequestCalls[j];});}o[k]=n;}f.prototype._getPostMesageInterface=function(e,i){var j,k=this.getAPIs();if(k[e]){j=k[e];if(j&&j.oRequestCalls&&j.oRequestCalls[i]){return j.oRequestCalls[i];}}return undefined;};f.prototype.registerShellCommunicationHandler=function(e){Object.keys(e).forEach(function(k){g(k,e[k]);});};f.prototype.isActiveOnly=function(e,i){var j=this._getPostMesageInterface(e,i);if(j){return j.isActiveOnly;}return undefined;};f.prototype.getResponseHandler=function(e,i){var j=this._getPostMesageInterface(e,i);if(j){return j.fnResponseHandler;}return undefined;};f.prototype._createNewInnerAppState=function(i){return new Promise(function(r){var n,H,j,N,v;sap.ushell.Container.getServiceAsync("AppState").then(function(k){n=k.createEmptyAppState(undefined,false);if(i.oMessageData.body.sData!==undefined){try{v=JSON.parse(i.oMessageData.body.sData);}catch(e){v=i.oMessageData.body.sData;}}else{v="";}n.setData(v);n.save();N=n.getKey();H=window.hasher.getHash();if(H.indexOf("&/")>0){if(H.indexOf("sap-iapp-state=")>0){j=/(?:sap-iapp-state=)([^&/]+)/.exec(H)[1];H=H.replace(j,N);}else{H=H+"/sap-iapp-state="+N;}}else{H=H+"&/sap-iapp-state="+N;}window.hasher.changed.active=false;window.hasher.replaceHash(H);window.hasher.changed.active=true;r(N);});});};function s(e){if(e===true){if(sap.ui.getCore().byId("shell-header")){sap.ui.getCore().byId("shell-header").setBlocked(true);var H=q("#shell-header-blockedLayer");H.addClass("sapUshellShellBlocked");}if(sap.ui.getCore().byId("menuBar")){sap.ui.getCore().byId("menuBar").setBlocked(true);var m=q("#menuBar-blockedLayer");m.addClass("sapUshellMenuBarBlocked");}}else if(e===false){if(sap.ui.getCore().byId("shell-header")){sap.ui.getCore().byId("shell-header").setBlocked(false);}if(sap.ui.getCore().byId("menuBar")){sap.ui.getCore().byId("menuBar").setBlocked(false);}}}function h(e,i){sap.ushell.Container.getRenderer("fiori2")[e]("sap.ushell.ui.shell.ShellHeadItem",{id:i.oMessageData.body.sId,tooltip:i.oMessageData.body.sTooltip,icon:i.oMessageData.body.sIcon,press:function(){i.oContainer.postMessageRequest("sap.ushell.appRuntime.buttonClick",{buttonId:i.oMessageData.body.sId});}},i.oMessageData.body.bVisible,i.oMessageData.body.bCurrentState||true,i.oMessageData.body.aStates);}f.prototype._sendEmail=function(t,e,B,i,j,I,k){var F=(this._getBrowserURL&&this._getBrowserURL())||document.URL;function r(l,m){if(l&&l.length>0&&((e&&e.includes(l))||(B&&B.includes(l)))){if(B&&B.includes(l)){B=B.replace(l,m);}if(e&&e.includes(l)){e=e.replace(l,m);}}}if(k){sap.ushell.Container.getServiceAsync("AppState").then(function(l){l.setAppStateToPublic(I).done(function(n,x,m,X,p){if(X!==undefined){F=F.replace(x,X);}if(p!==undefined){F=F.replace(m,p);}r(I,F);sap.m.URLHelper.triggerEmail(t,e,B,i,j);}).fail(L.error);});}else{r(I,F);sap.m.URLHelper.triggerEmail(t,e,B,i,j);}};f.prototype._stripBookmarkServiceUrlForLocalContentProvider=function(p,e){if(!p||!p.serviceUrl||!e){return;}if(e.id===""||e.id==="saas_approuter"){p.serviceUrl=undefined;L.warning("Dynamic data bookmarks tiles are not supported for local content providers",null,"sap/ushell/components/applicationIntegration/application/PostMessageAPI");}};return new f();});
