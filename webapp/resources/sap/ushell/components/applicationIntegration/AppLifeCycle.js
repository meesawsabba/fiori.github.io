// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/components/applicationIntegration/elements/model","sap/ushell/components/applicationIntegration/Storage","sap/ushell/components/applicationIntegration/application/BlueBoxHandler","sap/ushell/ui5service/ShellUIService","sap/ushell/components/applicationIntegration/application/Application","sap/ushell/components/applicationIntegration/relatedServices/RelatedServices","sap/ushell/components/applicationIntegration/relatedShellElements/RelatedShellElements","sap/ushell/components/applicationIntegration/configuration/AppMeta","sap/ushell/services/AppConfiguration","sap/ushell/utils","sap/ui/Device","sap/ushell/Config","sap/ushell/ApplicationType","sap/base/util/UriParameters","sap/ui/thirdparty/jquery","sap/base/Log"],function(E,S,B,a,A,R,b,c,d,u,D,C,f,U,q,L){"use strict";function g(){var v,h=["URL"],r,s,i,I={},j=false,o={},k={home:{embedded:"embedded-home",headerless:"headerless-home",merged:"blank-home",blank:"blank-home"},app:{minimal:"minimal",app:"app",standalone:"standalone",embedded:"embedded",headerless:"headerless",merged:"merged",home:"home",blank:"blank",lean:"lean"}},w,G=[],l={},m=false,K={FULL:"true",RESTRICTED:"restricted"};this.shellElements=function(){return b;};this.service=function(){return R;};this.isCurrentApp=function(e){return(o.appId===e);};this.isAppWithSimilarShellHashInCache=function(e,F){var p=S.get(e);if(p){if(p.shellHash===F){return true;}return false;}return false;};this.isAppInCache=function(e){return!!S.get(e);};this.normalizeAppId=function(e){var p="-component",t=e.endsWith(p);if(t){return e.substring(0,e.length-p.length);}return e;};this.onComponentCreated=function(e,p,t){var x=t.component,y=this.normalizeAppId(x.getId());if(this.isAppInCache(y)){S.get(y).app=x;this.active(y);}else{o.app=x;if(x.active){x.active();}}};this.onGetMe=function(e,p,t){t.AppLifeCycle=this;};this.store=function(e){var p=S.get(e);if(p){A.store(p);c.store(p.meta);}};this.destroy=function(e,F,p,t){var x=S.get(e),y;function z(){if(F&&F.getUrl){B.deleteStateFul(F.getUrl());}A.destroy(F);b.destroy(F);c.destroy(F);}if(t===undefined){t=false;}this.removeControl(e,t);if(x){y=B.getStateFul(F.getUrl());if(y&&B.isStatefulContainerSupported(y)&&t===false){var H=B.getHandler();H.destroy(y,e);}else{x.container.destroy();B.deleteStateFul(F.getUrl());}S.remove(e);if(p){p.resolve();}}else{var P=F&&F.sendBeforeAppCloseEvent&&F.sendBeforeAppCloseEvent();if(P===undefined){z();if(p){p.resolve();}}else{P.then(function(){z();if(p){p.resolve();}},function(J){z();if(p){p.resolve();}L.error("FLP got a failed response from the iframe for the 'sap.ushell.services.CrossApplicationNavigation.beforeAppCloseEvent' message sent",J,"sap.ushell.components.applicationIntegration.AppLifeCycle.js");});}}};this.restore=function(e){var p=S.get(e);if(p){A.restore(p);R.restore(p.service);c.restore(p.meta);}};this.active=function(e){var p=S.get(e);if(p){A.active(p.app);}};this.handleExitStateful=function(F,e){var p,H=B.getHandler();if(S.get(F)){p=B.getStorageKey(e);if(p&&B.isKeepAliveSupported(e)){return H.store(e,p);}return Promise.resolve();}return H.destroy(e);};this.handleExitApplication=function(F,e,t,T,p){var x=this,y,P,z;if(t&&T&&T.getIframeReusedForApp&&T.getIframeReusedForApp()===true){T.setProperty("iframeReusedForApp",false,true);A.postMessageToIframeApp(T,"sap.ushell.sessionHandler","afterApplicationShow",{},false);}if(F&&e){if(e.getUrl()&&B.isStatefulContainerSupported(B.getStateFul(e.getUrl()))){P=this.handleExitStateful(F,e);}else if(S.get(F)){if(R.isBackNavigation()===true&&!p){z=new q.Deferred();this.destroy(F,e,z);P=z.promise();}else{this.store(F);sap.ui.getCore().getEventBus().publish("sap.ushell","appClosed",e);}}else if(e.getIsStateful&&e.getIsStateful()){if(p){P=e.postMessageRequest("sap.gui.triggerCloseSessionImmediately");}}else{y=h.indexOf(e.getApplicationType)>=0;if(this.isAppOfTypeCached(F,y)===false){z=new q.Deferred();this.destroy(F,e,z);P=z.promise();}}if(p===true){if(P===undefined){this.closeKeepAliveApps(n);}else{P.then(function(){x.closeKeepAliveApps(n);});}}if(F.indexOf("Shell-appfinder-component")>0){sap.ui.getCore().getEventBus().publish("sap.ushell","appFinderAfterNavigate");}}sap.ui.getCore().getEventBus().publish("relatedServices","resetBackNavigation");};function n(e){return(e.value.keepAliveMode===K.RESTRICTED);}this.closeKeepAliveApps=function(F,p){try{var t=this,x=[];S.forEach(function(y){if(F.apply(this,[y])===true){x.push(y.value);}});x.forEach(function(y){var z;if(p){z=new q.Deferred();p.push(z.promise());}t.destroy(y.appId,y.container,z,true);});}catch(e){L.error("Error: sap.ushell.services.appLifeCycle.closeOtherKeepAliveRestrictedApps:"+e);}};this.onBeforeNavigate=function(F,e,t,T){if(F&&e){if(e.getUrl()&&(B.isStatefulContainerSupported(B.getStateFul(e.getUrl()))||S.get(F)||(e.getIsStateful&&e.getIsStateful()))){A.postMessageToIframeApp(e,"sap.ushell.sessionHandler","beforeApplicationHide",{},false);}}};this.onAfterNavigate=function(F,e,t,T){var p=t.indexOf("Shell-appfinder-component")>0||t.indexOf("Shell-home-component")>0||t.indexOf("pages-component-container")>0;this.handleExitApplication(F,e,t,T,p);if(p===true){A.setActiveAppContainer(undefined);}if(t){if(S.get(t)){this.restore(t);}else{}}};this.storeApp=function(e,p,t,F,x){if(!this.isAppInCache(e)){if(p.setProperty){p.setProperty("isKeepAlive",true,true);}S.set(e,{service:{},shellHash:F,appId:e,stt:"loading",appRelatedElements:b.getAppRelatedElement(),container:p,meta:d.getMetadata(t),app:undefined,keepAliveMode:x&&(x.globalValue||x.paramValue),appTarget:t,ui5ComponentName:t&&t.ui5ComponentName});I[F]=e;B.setStorageKey(p,e);return true;}return false;};this.restoreApp=function(e){if(this.isAppInCache(e)){o=S.get(e);if(B.getStorageKey(o.container)){B.setStorageKey(o.container,e);}}};this.isAppOfTypeCached=function(e,p,t){var x;if(!j&&e.indexOf(r)!==-1){return true;}if(!j&&e.indexOf("Shell-appfinder")!==-1){return true;}x=new U(window.location.href).get("sap-keep-alive");if(x===K.FULL||x===K.RESTRICTED){if(t){t.globalValue=x;}return true;}return false;};this.isCachedEnabledAsAppParameter=function(e,t,p){var x;if(t&&t.appCapabilities&&t&&t.appCapabilities.appFrameworkId==="UI5"){return false;}x=e&&e.params&&e.params["sap-keep-alive"];if(x===K.FULL||x===K.RESTRICTED){if(p){p.paramValue=x;}return true;}if(t&&t.url){x=new U(t.url).get("sap-keep-alive");if(x===K.FULL||x===K.RESTRICTED){if(p){p.paramValue=x;}return true;}}return false;};this.calculateAppType=function(t){if(t.applicationType==="URL"&&t.additionalInformation&&t.additionalInformation.startsWith("SAPUI5.Component=")){return"SAPUI5";}return t.applicationType;};this.getStatefulCapabilities=function(t){if(t.appCapabilities&&t.appCapabilities&&t.appCapabilities.statefulContainer){return t.appCapabilities.statefulContainer;}return undefined;};this.isNotifyInnerAppRouteChangeEnabled=function(t){if(t.appCapabilities&&t.appCapabilities.notifyInnerAppRouteChange){return true;}return false;};this.isStatefulCapabilityEnabled=function(t){var e=this.getStatefulCapabilities(t);if(e&&(e.enabled===true||e===true)){return true;}return false;};this.isGUICapabilityEnabled=function(t){var e=this.getStatefulCapabilities(t);if(e&&e.protocol==="GUI"){return true;}return false;};this.isFLPCapabilityEnabled=function(t){return!this.isGUICapabilityEnabled(t)&&this.isStatefulCapabilityEnabled(t);};this.isGUIStatefulCapabilityEnabled=function(t){return this.isGUICapabilityEnabled(t)&&this.isStatefulCapabilityEnabled(t);};this.openApp=function(e,t,p,F){var x,y,z=h.indexOf(t.applicationType)>=0,T,H,J={globalValue:undefined,paramValue:undefined};var M="application"+e;x=B.getStateFul(t.url);if(x&&B.isStatefulContainerSupported(x)){if(this.isAppOfTypeCached(M,z,J)||this.isCachedEnabledAsAppParameter(p,t,J)){if(!this.isAppInCache(M)){this.storeApp(M,x,t,F,J);}this.restoreApp(M);}else{o={appId:M,stt:"loading",container:x,meta:d.getMetadata(t),app:undefined};}}else if(this.isAppOfTypeCached(M,z,J)||this.isCachedEnabledAsAppParameter(p,t,J)){if(!this.isAppInCache(M)){x=this.createApplicationContainer(e,t);this.storeApp(M,x,t,F,J);B.set(t.url,x);}this.restoreApp(M);}else if(t.applicationType==="TR"||(t.appCapabilities&&t.appCapabilities.appFrameworkId==="GUI")){x=this.getWebGuiV1StatefulContainer(t.url);if(!x){x=this.createApplicationContainer(e,t);B.set(t.url,x);}o={appId:M,stt:"loading",container:x,meta:d.getMetadata(t),app:undefined};}else{if(x){y=p.semanticObject+"-"+p.action;this.removeApplication(y);}else if(t.applicationType==="URL"||t.applicationType==="TR"){y=p.semanticObject+"-"+p.action;T=B.getById("application-"+y);if(T){H=T.getUrl();B.removeCapabilities(T);this.destroy("application-"+y,T);B.deleteStateFul(H);}}x=this.createApplicationContainer(e,t);B.set(t.url,x);if(B.isCapUT(x,"isFLP")){B.setCapabilities(x,[{service:"sap.ushell.services.appLifeCycle",action:"create"},{service:"sap.ushell.services.appLifeCycle",action:"destroy"}]);}o={appId:M,stt:"loading",container:x,meta:d.getMetadata(t),app:undefined};}};this.getAppMeta=function(){return c;};this.evict=function(e){var p,t=e.value,x=e.key;this.removeControl(x);if(t.container.getUrl&&t.container.getUrl()){p=B.getStateFul(t.container.getUrl());}if(p){var H=B.getHandler();H.destroy(p,x);}else{t.container.destroy();}};this.init=function(e,p,t,x,y,z,F){var H=this,J;if(D.system.phone){J=10;if(F&&F.limit&&F.limit.phone){J=F.limit.phone;}}else if(D.system.tablet){J=10;if(F&&F.limit&&F.limit.tablet){J=F.limit.tablet;}}else if(D.system.desktop){J=15;if(F&&F.limit&&F.limit.desktop){J=F.limit.desktop;}}else{J=10;}s=new a({scopeObject:y.ownerComponent,scopeType:"component"});i=e;v=p;r=t;c.init(r);j=x;B.init({oShellUIService:s},F,this);S.init(J,function(M){this.evict(M);}.bind(this));this.registerShellCommunicationHandler({"sap.ushell.services.appLifeCycle":{oRequestCalls:{create:{isActiveOnly:true,distributionType:["URL"],fnResponseHandler:function(P){P.then(function(M){L.info("sap.ushell.services.appLifeCycle.create:"+M);}).catch(function(M){L.error("Error: sap.ushell.services.appLifeCycle.create:"+M);});}},destroy:{isActiveOnly:true,distributionType:["URL"],fnResponseHandler:function(P){P.then(function(M){L.info("sap.ushell.services.appLifeCycle.destroy:"+M);}).catch(function(M){L.error("Error: sap.ushell.services.appLifeCycle.destroy:"+M);});}},store:{isActiveOnly:true,distributionType:["URL"],fnResponseHandler:function(P){P.then(function(M){L.info("sap.ushell.services.appLifeCycle.store:"+M);}).catch(function(M){L.error("Error: sap.ushell.services.appLifeCycle.store:"+M);});}},restore:{isActiveOnly:true,distributionType:["URL"],fnResponseHandler:function(P){P.then(function(M){L.info("sap.ushell.services.appLifeCycle.restore:"+M);}).catch(function(M){L.error("Error: sap.ushell.services.appLifeCycle.restore:"+M);});}}},oServiceCalls:{subscribe:{executeServiceCallFn:function(M){B.mapCapabilities(M.oContainer,M.oMessageData.body);return new q.Deferred().resolve({}).promise();}},setup:{executeServiceCallFn:function(M){var N=M.oMessageData&&M.oMessageData.body,O=[],P=M.oContainer.getApplicationType(),Q=M.oContainer.getFrameworkId(),T=false;if(N){if(M.oContainer.getIsKeepAlive()===true&&(P==="GUI"||P==="TR"||P==="NWBC"||P==="WDA"||Q==="GUI"||Q==="WDA"||Q==="NWBC")){T=true;}if(N.isStateful===true&&!T){O.push({"action":"create","service":"sap.ushell.services.appLifeCycle"});O.push({"action":"destroy","service":"sap.ushell.services.appLifeCycle"});}if(N.session&&N.session.bLogoutSupport===true){O.push({"action":"logout","service":"sap.ushell.sessionHandler"});}if(O.length>0){B.mapCapabilities(M.oContainer,O);}}return new q.Deferred().resolve().promise();}}}},"sap.gui":{oServiceCalls:{loadFinished:{executeServiceCallFn:function(M){var N=M.oContainer.getApplicationType(),O=M.oContainer.getFrameworkId();if((N==="GUI"||N==="TR"||N==="NWBC"||O==="GUI"||O==="NWBC")&&M.oContainer.getIsKeepAlive()===false){H.setWebGuiV1StatefulContainer(M.oContainer);M.oContainer.setIsStateful(true);o={appId:M.oContainer.getId(),stt:"loading",container:M.oContainer,meta:undefined,app:undefined};}return new q.Deferred().resolve({}).promise();}}}}});sap.ui.getCore().getEventBus().subscribe("sap.ushell","appComponentLoaded",this.onComponentCreated,this);sap.ui.getCore().getEventBus().subscribe("sap.ushell","getAppLifeCycle",this.onGetMe,this);b.init(this.getElementsModel(),z);};this.addControl=function(e){v.addCenterViewPort(e);};this.removeControl=function(e,F){var p=B.getById(e),t=B.isStatefulContainerSupported(p);if(!t||F){v.removeCenterViewPort(e,true);}};this.removeApplication=function(e){var p=this.getControl(e);if(p){this.removeControl(p.getId());p.destroy();}};this.getControl=function(e){return v&&(v.getViewPortControl("centerViewPort","application-"+e)||v.getViewPortControl("centerViewPort","applicationShellPage-"+e));};this.getViewPortContainer=function(){return v;};this.navTo=function(e){v.navTo("centerViewPort",e,"show");};this.getCurrentApplication=function(){return o;};this.setApplicationFullWidth=function(e){var p=this.getCurrentApplication();if(p.container){p.container.toggleStyleClass("sapUShellApplicationContainerLimitedWidth",!e);}};this.createComponent=function(e,p){function t(z){return(z.value.ui5ComponentName===e.ui5ComponentName);}var x=[],y=new q.Deferred();this.shellElements().setDangling(true);this.closeKeepAliveApps(t,x);Promise.all(x).then(function(){A.createComponent(e,p).done(y.resolve).fail(y.reject);});return y.promise();};this.getAppContainer=function(e,p,t,x,F){p.shellUIService=s.getInterface();p.targetNavigationMode=t?"explace":"inplace";this.openApp(e,p,x,F);if(G.length>0){o.container.registerShellCommunicationHandler(G);}if(l.UI5APP){o.container.setIframeHandlers(l.UI5APP);}return o.container;};this.getShellUIService=function(){return s;};this.initShellUIService=function(e){s._attachHierarchyChanged(c.onHierarchyChange.bind(this));s._attachTitleChanged(c.onTitleChange.bind(this));s._attachRelatedAppsChanged(c.onRelatedAppsChange.bind(this));s._attachBackNavigationChanged(e.fnOnBackNavigationChange.bind(this));};this.getElementsModel=function(){return E;};this.activeContainer=function(p){var t=this.getWebGuiV1AllApplicationContainers();t.forEach(function(e){L.info("Deactivating container "+e.getId());e.setActive(false);});B.forEach(function(x){if(x&&x!==p){try{L.info("Deactivating container "+x.getId());x.setActive(false);}catch(e){}}});if(p){L.info("Activating container "+p.getId());p.setActive(true);}};this.showApplicationContainer=function(e){this.navTo(e.getId());if(e.hasStyleClass("sapUShellApplicationContainerShiftedIframe")){e.toggleStyleClass("sapUShellApplicationContainerIframeHidden",false);}else{e.toggleStyleClass("hidden",false);}A.setActiveAppContainer(e);L.info("New application context opened successfully in an existing transaction UI session.");};this.reuseStateFulContainerAndRestore=function(e,t,H,F,T){var p=this,x=I[F];if(B.getStorageKey(e)){B.setStorageKey(e,x);}return H.restore(e,x,T).then(function(){p.showApplicationContainer(e);},function(y){L.error(y&&y.message||y);});};this.reuseStateFulContainer=function(e,p,t,H,F,T){var x=this;I[F]=t;if(B.getStorageKey(e)){B.setStorageKey(e,t);}this.initAppMetaParams();return H.create(e,p,t,T).then(function(){x.showApplicationContainer(e);},function(y){L.error(y&&y.message||y);});};this.initAppMetaParams=function(){if(!this.getAppMeta().getIsHierarchyChanged()){s.setHierarchy();}if(!this.getAppMeta().getIsTitleChanged()){s.setTitle();}if(!this.getAppMeta().getIsRelatedAppsChanged()){s.setRelatedApps();}if(!m){s.setBackNavigation();}};this.reuseApplicationContainer=function(e,p,t){var x=this;e.setProperty("iframeReusedForApp",true,true);return e.setNewApplicationContext(p,t).then(function(){x.navTo(e.getId());if(e.hasStyleClass("sapUShellApplicationContainerShiftedIframe")){e.toggleStyleClass("sapUShellApplicationContainerIframeHidden",false);}else{e.toggleStyleClass("hidden",false);}L.info("New application context opened successfully in an existing transaction UI session.");},function(y){L.error(y&&y.message||y);});};this.createApplicationContainer=function(e,p){return A.createApplicationContainer(e,p);};this.publishNavigationStateEvents=function(e,p,O){var t,x=e.getId?e.getId():"",y=this;var z=d.getMetadata(),F=z.icon,T=z.title;e.addEventDelegate({onAfterRendering:O});t=e.exit;e.exit=function(){if(t){t.apply(this,arguments);}y.getAppMeta()._applyContentDensityByPriority();setTimeout(function(){var H=q.extend(true,{},p);delete H.componentHandle;H.appId=x;H.usageIcon=F;H.usageTitle=T;sap.ui.getCore().getEventBus().publish("sap.ushell","appClosed",H);L.info("app was closed");},0);var P=y._publicEventDataFromResolutionResult(p);sap.ushell.renderers.fiori2.utils.publishExternalEvent("appClosed",P);};};this._publicEventDataFromResolutionResult=function(e){var p={};if(!e){return e;}["applicationType","ui5ComponentName","url","additionalInformation","text"].forEach(function(P){p[P]=e[P];});Object.freeze(p);return p;};this.getInMemoryInstance=function(e,F,p,O){var t="application-"+e,x=S.get(t),y="",N=false,z;if(x){if(O!==null&&O!==undefined&&O!==""){y=O.toLowerCase();N=y.indexOf("shell-home")>=0||y.indexOf("launchpad-openflppage")>=0||y.indexOf("shell-appfinder")>=0;}z=(N&&(typeof p==="string"&&p.length>0));if(x.shellHash===F&&!z){return{isInstanceSupported:true,appId:x.appId,container:x.container};}return{isInstanceSupported:false,appId:x.appId,container:x.container};}return{isInstanceSupported:false,appId:undefined,container:undefined};};this.handleOpenStateful=function(e,p,t,x,T,F,y){var H=B.getHandler();x.setProperty("iframeReusedForApp",true,true);if(S.get(t)&&e===false){this.reuseStateFulContainerAndRestore(x,t,H,F,T);}else{this.reuseStateFulContainer(x,T.url,t,H,F,T);if(p){if(!this.isAppInCache(t)){this.storeApp(t,x,T,F,y);}}}};this.leave=function(e,p){var t=B.isStatefulContainerSupported(e);var x=S.get(p);if(x){R.store(x.service);}if(t){return this.handleExitStateful(p,e);}return Promise.resolve();};this.open=function(e,p,t,T,W,F,M){var x=this,y,z=(this.getWebGuiV1StatefulContainer(T.url)!==undefined),H,J=h.indexOf(T.applicationType)>=0,N="application-"+e,O,P,Q,V=false,X,Y,Z,$=new q.Deferred(),_,a1={globalValue:undefined,paramValue:undefined};P=this.isAppOfTypeCached(N,J,a1)||this.isCachedEnabledAsAppParameter(t,T,a1);Q=this.calculateAppType(T);X=f.getDefaultFullWidthSetting(Q);y=B.getStateFul(T.url);H=B.isStatefulContainerSupported(y);if(!H){if(o&&N!==o.appId){y=undefined;}O=S.get("application"+p);if(O){y=O.container;if(!H&&P&&y!==undefined){Y=true;}}}var b1,c1;b1=T.appCapabilities&&T.appCapabilities.fullWidth;if(X===true){if(T.fullWidth===false||T.fullWidth==="false"||M.fullWidth===false||M.fullWidth==="false"||b1===false){c1=false;}}else if(T.fullWidth===true||T.fullWidth==="true"||M.fullWidth===true||M.fullWidth==="true"){c1=true;}if(c1===undefined){c1=X;}if(H){if(!y){y=W(e,M,t,T,p,c1,F);this.restoreApp(y.getId());this.navTo(y.getId());V=true;}}else if(!z&&y&&!P){Z=new q.Deferred();this.destroy(y.getId(),y,Z);Z.then(function(){y=W(e,M,t,T,p,c1,F);});}else if(!y){y=W(e,M,t,T,p,c1,F);}if(Z===undefined){Z=new q.Deferred().resolve();}if(y&&y.getDeffedControlCreation){_=y.getDeffedControlCreation();}else{_=Promise.resolve();}Z.then(function(){_.then(function(){if(!z&&!H){if(Y===true){sap.ui.getCore().getEventBus().publish("launchpad","appOpening",T);}x.restoreApp(y.getId());x.navTo(y.getId());if(Y===true){sap.ui.getCore().getEventBus().publish("sap.ushell","appOpened",T);}}v.switchState("Center");u.setPerformanceMark("FLP -- centerViewPort");x.activeContainer(y);if(H){x.handleOpenStateful(V,P,"application"+p,y,T,F,a1);}else if(z){x.reuseApplicationContainer(y,"TR",T.url);}$.resolve();});});return $.promise();};this.handleControl=function(e,p,t,T,W,F){var x=this,M=d.getMetadata(T),y=v.getCurrentCenterPage?v.getCurrentCenterPage():undefined,z=sap.ui.getCore().byId(y);var P=x.leave(z,y).then(function(){x.open(e,p,t,T,W,F,M);},function(H){L.error(H&&H.message||H);});return P;};this.switchViewState=function(e,p,t){var x=e,y;if(k[e]&&k[e][i]){x=k[e][i];}var z=C.last("/core/shell/model/currentState/stateName")==="home";if(!z&&(!o.appId||!S.get(o.appId))){E.destroyManageQueue();}y=S.get("application"+t);if(y){b.restore(y);}else{b.assignNew(e);}E.switchState(x,p,t);this.shellElements().setDangling(false);this.shellElements().processDangling();if(e==="searchResults"){this.getElementsModel().setProperty("/lastSearchScreen","");if(!window.hasher.getHash().indexOf("Action-search")===0){var F=sap.ui.getCore().getModel("searchModel");window.hasher.setHash("Action-search&/searchTerm="+F.getProperty("/uiFilter/searchTerms")+"&dataSource="+JSON.stringify(F.getProperty("/uiFilter/dataSource").getJson()));}}};this.registerShellCommunicationHandler=function(e){A.registerShellCommunicationHandler(e);};this.registerIframeCommunicationHandler=function(H,t){l[t]=H;};this.postMessageToIframeApp=function(e,p,M,W){function t(J){if(e==="sap.ushell.sessionHandler"&&p==="logout"){if(J&&J.getApplicationType&&",WCF,GUI,TR,WDA,".indexOf(J.getApplicationType())>0){return false;}}return true;}var x,y=A.getActiveAppContainer(),z=false,F=[];if(B.hasIFrame(y)&&(B.isCapabilitySupported(y,e,p)||A.isAppTypeSupported(y,e,p))&&t(y)===true){F.push(A.postMessageToIframeApp(y,e,p,M,W));z=true;}if(!A.isActiveOnly(e,p)){B.forEach(function(O){if(z===true&&O===y){return;}if(B.hasIFrame(O)){if((B.isCapabilitySupported(O,e,p)||A.isAppTypeSupported(O,e,p))&&t(O)===true){F.push(A.postMessageToIframeApp(O,e,p,M,W));}}});}x=A.getResponseHandler(e,p);var H=Promise.all(F);if(x){x(H);}return H;};this.postMessageToIframeAppAccordingToPolicy=function(e,p,M,W,P){var t,x=A.getActiveAppContainer(),y=[];if(B.hasIFrame(x)&&A.isAppTypeSupportedByPolicy(x,P)){y.push(A.postMessageToIframeApp(x,e,p,M,W));}if(!P.isActiveOnly){B.forEach(function(O){if(B.hasIFrame(O)){if(B.isCapabilitySupported(O,e,p)||A.isAppTypeSupported(O,e,p)){y.push(A.postMessageToIframeApp(O,e,p,M,W));}}});}t=A.getResponseHandler(e,p);var z=Promise.all(y);if(t){t(z);}return z;};this.setBackNavigationChanged=function(e){m=e;};this.getBackNavigationChanged=function(){return m;};this.parseStatefulContainerConfiguration=function(){w={};};this.getWebGuiV1StatefulContainer=function(e){var p;if(e){p=B._getBlueBoxCacheKey(e);return w[p];}else{return undefined;}};this.setWebGuiV1StatefulContainer=function(e){var p=e.getUrl(),t;if(p){t=B._getBlueBoxCacheKey(p);w[t]=e;}};this.getWebGuiV1AllApplicationContainers=function(){return Object.keys(w).map(function(e){return w[e];}).filter(function(e){return!!e;});};}return new g();},true);
