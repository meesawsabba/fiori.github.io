// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/base/security/encodeXML","sap/base/util/deepEqual","sap/base/util/uid","sap/base/util/UriParameters","sap/m/MessagePopover","sap/m/Text","sap/ui/core/Component","sap/ui/core/ComponentContainer","sap/ui/core/Control","sap/ui/core/Icon","sap/ui/Device","sap/ui/thirdparty/URI","sap/ushell/ApplicationType","sap/ushell/Config","sap/ushell/EventHub","sap/ushell/library","sap/ushell/resources","sap/ushell/System","sap/ushell/User","sap/ushell/utils","sap/ui/thirdparty/jquery","sap/ushell/utils/UrlParsing","sap/ui/core/routing/History"],function(L,a,d,g,U,M,T,C,b,c,I,D,f,A,h,E,u,r,S,j,k,q,o,H){"use strict";var P="sap.ushell.components.container.",s=P+"ApplicationContainer",l="sap.ushell.Container.dirtyState.",m="autoplay;battery;camera;display-capture;geolocation;gyroscope;magnetometer;microphone;midi;clipboard-write;clipboard-read;fullscreen;",n,t,v,w=false,K=false,x=[],y=0;var z=["sap-ach","sap-fiori-id","sap-hide-intent-link","sap-priority","sap-tag","sap-ui-app-id-hint","sap-ui-debug","sap-ui-fl-control-variant-id","sap-ui-fl-max-layer","sap-ui-tech-hint","sap-ui2-tcode","sap-ui2-wd-app-id","sap-ui2-wd-conf-id","sap-ushell-cdm-site-url","sap-ushell-defaultedParameterNames","sap-ushell-navmode","sap-ushell-next-navmode","sap-ushell-url","sap-app-origin-hint"];function B(e){sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(i){i.isUrlSupported(e.url).done(function(){e.promise.resolve({allowed:true,id:e.id});}).fail(function(){e.promise.resolve({allowed:false,id:e.id});});});}function F(e){var i={asyncURLHandler:t1.prototype._adaptIsUrlSupportedResultForMessagePopover};if(M&&M.setDefaultHandlers){M.setDefaultHandlers(i);}E.emit("StepDone",e.stepName);}E.once("initMessagePopover").do(F);n=new k.Map();function G(e){return n.get(e.getId());}function J(){return t;}function N(e){var p=new U(e).mParams,i=p["sap-xapp-state"],u1;delete p["sap-xapp-state"];u1={startupParameters:p};if(i){u1["sap-xapp-state"]=i;}return u1;}function O(e,i){return r.i18n.getText(e,i);}function Q(){return new I({size:"2rem",src:"sap-icon://error",tooltip:t1.prototype._getTranslatedText("an_error_has_occured")});}function R(e){var i=e.getAggregation("child"),p;if(i instanceof b){p=i.getComponentInstance().getMetadata().getName().replace(/\.Component$/,"");L.debug("unloading component "+p,null,s);}e.destroyAggregation("child");}function V(e,i,p){return new Promise(function(u1){var v1,w1,x1,y1,z1,A1={},B1,C1;function D1(H1){H1.setWidth(e.getWidth());H1.setHeight(e.getHeight());H1.addStyleClass("sapUShellApplicationContainer");e.setAggregation("child",H1,true);}v1=i.indexOf("?");if(v1>=0){y1=t1.prototype._getParameterMap(i);A1=y1.startupParameters;i=i.slice(0,v1);}if(i.slice(-1)!=="/"){i+="/";}if(/\.view\.(\w+)$/i.test(p)){x1=/^SAPUI5=(?:([^/]+)\/)?([^/]+)\.view\.(\w+)$/i.exec(p);if(!x1){L.error("Invalid SAPUI5 URL",p,s);u1(t1.prototype._createErrorControl());return;}z1=x1[1];B1=x1[2];C1=x1[3].toUpperCase();if(z1){B1=z1+"."+B1;}else{w1=B1.lastIndexOf(".");if(w1<1){L.error("Missing namespace",p,s);return t1.prototype._createErrorControl();}z1=B1.slice(0,w1);}}else{z1=p.replace(/^SAPUI5=/,"");}var E1={};var F1=z1.replace(/\./g,"/");E1[z1]=i+F1;sap.ui.loader.config({paths:E1});t1.prototype._destroyChild(e);if(B1){if(e.getApplicationConfiguration()){A1.config=e.getApplicationConfiguration();}sap.ui.view({id:e.getId()+"-content",type:C1,viewData:A1||{},viewName:B1,async:true}).loaded().then(function(H1){e.fireEvent("applicationConfiguration");D1(H1);u1(H1);});}else{L.debug("loading component "+z1,null,s);var G1=y1?{startupParameters:y1.startupParameters}:{startupParameters:{}};if(y1&&y1["sap-xapp-state"]){G1["sap-xapp-state"]=y1["sap-xapp-state"];}if(e.getApplicationConfiguration()){G1.config=e.getApplicationConfiguration();}sap.ui.core.Component.create({id:e.getId()+"-component",componentData:G1,name:z1}).then(function(H1){e.fireEvent("applicationConfiguration",{"configuration":H1.getMetadata().getConfig()});var I1=new b({id:e.getId()+"-content",component:H1});D1(I1);u1(I1);});}});}function W(e,i){setTimeout(function(){sap.ui.getCore().getEventBus().publish("sap.ushell",e,i);},0);}function X(e,i,p){var u1=this,v1,w1={oControl:undefined,oPromise:undefined},x1,y1,z1,A1={startupParameters:{}},B1,C1=e.getComponentHandle(),D1,E1;function F1(G1){e.fireEvent("applicationConfiguration",{configuration:G1.getMetadata().getConfig()});y1=new b({id:e.getId()+"-content",component:G1});y1.setHeight(e.getHeight());y1.setWidth(e.getWidth());y1.addStyleClass("sapUShellApplicationContainer");e._disableRouterEventHandler=t1.prototype._disableRouter.bind(u1,G1);sap.ui.getCore().getEventBus().subscribe("sap.ushell.components.container.ApplicationContainer","_prior.newUI5ComponentInstantion",e._disableRouterEventHandler);e.setAggregation("child",y1,true);sap.ushell.Container.getServiceAsync("PluginManager").then(function(J1){D1=J1.getPluginLoadingPromise("RendererExtensions");E1=D1&&D1.state();if(E1==="pending"){D1.done(function(){t1.prototype._publishExternalEvent("appComponentLoaded",{component:G1});}).fail(function(){t1.prototype._publishExternalEvent("appComponentLoaded",{component:G1});});}if(E1==="resolved"||E1==="rejected"){t1.prototype._publishExternalEvent("appComponentLoaded",{component:G1});}});return y1;}x1=i.indexOf("?");if(x1>=0){z1=t1.prototype._getParameterMap(i);A1={startupParameters:z1.startupParameters};if(z1["sap-xapp-state"]){A1["sap-xapp-state"]=z1["sap-xapp-state"];}i=i.slice(0,x1);}if(e.getApplicationConfiguration()){A1.config=e.getApplicationConfiguration();}if(i.slice(-1)!=="/"){i+="/";}t1.prototype._destroyChild(e);B1={id:e.getId()+"-component",name:p,componentData:A1};L.debug("Creating component instance for "+p,JSON.stringify(B1),s);sap.ui.getCore().getEventBus().publish("sap.ushell.components.container.ApplicationContainer","_prior.newUI5ComponentInstantion",{name:p});if(C1){var G1=C1.getInstance(B1);w1.oControl=F1(G1);}else{v1=new q.Deferred();var H1={};var I1=p.replace(/\./g,"/");H1[I1]=i;sap.ui.loader.config({paths:H1});L.error("No component handle available for '"+p+"'; fallback to component.load()",null,s);sap.ui.component({id:e.getId()+"-component",name:p,componentData:A1,async:true}).then(function(G1){v1.resolve(F1(G1));});w1.oPromise=v1.promise();}return w1;}function Y(e){var i;if((e instanceof C)&&(typeof e.getRouter==="function")){i=e.getRouter();if(i&&(typeof i.stop==="function")){L.info("router stopped for instance "+e.getId());i.stop();}}}function Z(e){var i=document.createElement("a"),p=new U(e).get("sap-client"),u1;i.href=e;u1=i.protocol+"//"+i.host;return new S({alias:p?u1+"?sap-client="+p:u1,baseUrl:u1,client:p||undefined,platform:"abap"});}function $(e,i){var p=false,u1=e.getDomRef(),v1,w1;if(e.getIframeWithPost()===true&&u1&&u1.getAttribute&&u1.getAttribute("sap-iframe-app")=="true"){u1=q("#"+u1.getAttribute("id")+"-iframe")[0];}if(u1){v1=f(e._getIFrameUrl(u1)||window.location&&window.location.href||"");w1=v1.protocol()+"://"+v1.host();p=(i.source===u1.contentWindow)||(i.origin===w1);}return p;}function _(e,i,p){var u1=JSON.stringify({type:"request",service:i,request_id:g(),body:{}});L.debug("Sending post message request to origin ' "+p+"': "+u1,null,"sap.ushell.components.container.ApplicationContainer");e.postMessage(u1,p);}function a1(){var i=this.getDomRef();if(!i||i.tagName!=="IFRAME"){if(this.getIframeWithPost()===true&&i&&i.getAttribute&&i.getAttribute("sap-iframe-app")=="true"){return q("#"+i.getAttribute("id")+"-iframe")[0];}return null;}return i;}function b1(i){var e;if(i===undefined){i=this._getIFrame();}if(this.getIframeWithPost()===true){e=q("#"+i.getAttribute("id").replace("-iframe","-form"))[0].action;if(e===undefined&&(new f()).query(true).hasOwnProperty("sap-isolation-enabled")){e=i.src;}}else{e=i.src;}return e;}function c1(e,i){if(e&&!e.getActive()){L.debug("Skipping handling of postMessage 'message' event with data '"+JSON.stringify(u1)+"' on inactive container '"+e.getId()+"'","Only active containers can handle 'message' postMessage event","sap.ushell.components.container.ApplicationContainer");return;}var p=e.getUi5ComponentName&&e.getUi5ComponentName(),u1=i.data;if(typeof p==="string"){L.debug("Skipping handling of postMessage 'message' event with data '"+JSON.stringify(u1)+"' on container of UI5 application '"+p+"'","Only non UI5 application containers can handle 'message' postMessage event","sap.ushell.components.container.ApplicationContainer");return;}var v1={bApiRegistered:true};v(e,i,v1);t1.prototype._handlePostMessagesForPluginsPostLoading(e,i,v1);}function d1(e,p,u1){var v1,w1;if(u1.bApiRegistered!==false){return;}sap.ushell.Container.getServiceAsync("PluginManager").then(function(x1){if(w===false){w=true;v1=x1.getPluginLoadingPromise("RendererExtensions");w1=v1&&v1.state();if(w1==="pending"){K=true;v1.always(function(){var y1;K=false;L.debug("Processing post messages queue after 'RendererExtensions' plugins loaded, queue size is: "+x.length,null,"sap.ushell.components.container.ApplicationContainer");for(var i=0;i<x.length;i++){y1=x[i];try{t1.prototype._handleMessageEvent.call(y1.that,y1.oContainer,y1.oMessage);}catch(ex){L.error(ex.message||ex,null,"sap.ushell.components.container.ApplicationContainer");}}x=[];});}}if(K===true){x.push({index:y++,that:this,oContainer:e,oMessage:p});}});}function e1(){w=false;K=false;x=[];y=0;}function f1(e,i){var p=e._getIFrame(),u1=e.getApplicationType();if(k.isApplicationTypeEmbeddedInIframe(e.getApplicationType(u1))&&p){var v1=new f(e._getIFrameUrl(p));var w1=v1.protocol()+"://"+v1.host();p.contentWindow.postMessage(JSON.stringify({action:"pro54_disableDirtyHandler"}),w1);i.preventDefault();}}function g1(e,i,p){e.write("<div").writeControlData(i).writeAccessibilityState(i).addClass("sapUShellApplicationContainer").writeClasses(i).addStyle("height",i.getHeight()).addStyle("width",i.getWidth()).writeStyles().write(">");if(p){e.renderControl(p);}e.write("</div>");}function h1(e,i,p){if(k.isApplicationTypeEmbeddedInIframe(i)){var u1=e.getTargetNavigationMode();p=t1.prototype._adjustNwbcUrl(p,i,u1,e.getIsStateful());k.localStorageSetItem(e.globalDirtyStorageKey,sap.ushell.Container.DirtyState.INITIAL);}return p;}function i1(e,i,p,u1){var v1,w1=function(){var E1=k.getParameterValueBoolean("sap-accessibility");if(E1!==undefined){return E1;}return sap.ushell.Container.getUser().getAccessibilityMode();},x1=function(){var E1=new U(e)||{mParams:{}};if(E1.mParams["sap-theme"]===undefined){return sap.ushell.Container.getUser().getTheme(j.prototype.constants.themeFormat.NWBC);}return undefined;},y1=function(){var E1=false,F1=new U(e)||{mParams:{}};E1=sap.ui.getCore().getConfiguration().getStatistics()&&F1.mParams["sap-statistics"]===undefined;return E1;},z1=function(){var E1=window.hasher&&window.hasher.getHash(),B1="",F1;if(E1&&E1.length>0&&E1.indexOf("sap-iapp-state=")>0){F1=/(?:sap-iapp-state=)([^&/]+)/.exec(E1);if(F1&&F1.length===2){B1=F1[1];}}return B1;},A1=function(){var E1="";var F1=(!!q("body.sapUiSizeCompact").length);var G1=(!!q("body.sapUiSizeCozy").length);if(F1===true){E1="0";}else if(G1){E1="1";}return E1;};e+=e.indexOf("?")>=0?"&":"?";e+="sap-ie=edge";v1=x1();if(v1){e+=e.indexOf("?")>=0?"&":"?";e+="sap-theme="+encodeURIComponent(v1);}if(p){e+=e.indexOf("?")>=0?"&":"?";e+="sap-target-navmode="+encodeURIComponent(p);}if(w1()){e+=e.indexOf("?")>=0?"&":"?";e+="sap-accessibility=X";}if(y1()){e+=e.indexOf("?")>=0?"&":"?";e+="sap-statistics=true";}if(i==="TR"||i==="GUI"){e+=e.indexOf("?")>=0?"&":"?";e+="sap-keepclientsession=2";}else if(u1){e+=e.indexOf("?")>=0?"&":"?";e+="sap-keepclientsession=1";}var B1=z1();if(B1&&B1.length>0){e+=e.indexOf("?")>=0?"&":"?";e+="sap-iapp-state="+B1;}var C1=A1();if(C1&&C1.length>0){e+=e.indexOf("?")>=0?"&":"?";e+="sap-touch="+C1;}var D1=0;if(h.last("/core/shell/sessionTimeoutIntervalInMinutes")>0){D1=h.last("/core/shell/sessionTimeoutIntervalInMinutes");}e+=e.indexOf("?")>=0?"&":"?";e+="sap-ushell-timeout="+D1;return k.appendSapShellParam(e,i);}function j1(e,i,p,u1){var v1=i.getAggregation("child"),w1,x1;if(!v1||i._bRecreateChild){x1=t1.prototype._createUi5Component(i,p,u1);if(x1.oControl!==undefined){i._bRecreateChild=false;t1.prototype._renderControlInDiv(e,i,x1.oControl);}else{i.oDeferredControlCreation=new q.Deferred();t1.prototype._renderControlInDiv(e,i);x1.oPromise.then(function(y1){i._bRecreateChild=false;w1=sap.ui.getCore().createRenderManager();w1.renderControl(y1);w1.flush(q("#"+i.getId())[0]);w1.destroy();i.oDeferredControlCreation.resolve();});}}else{t1.prototype._renderControlInDiv(e,i,v1);}}function k1(e,i,p){var u1=e.getProperty(i);if(d(u1,p)){return;}e.setProperty(i,p);e._bRecreateChild=true;}function l1(e,i,p,u1,v1){var w1,x1=true;localStorage.removeItem(i.globalDirtyStorageKey);i.oDeferredControlCreation=undefined;if(v1&&v1.indexOf("SAPUI5.Component=")===0&&p===A.URL.type){j1(e,i,u1,v1.replace(/^SAPUI5\.Component=/,""));return;}if(v1&&v1.indexOf("SAPUI5=")===0&&p===A.URL.type){t1.prototype._renderControlInDiv(e,i,undefined,"open");i.oDeferredControlCreation=new q.Deferred();t1.prototype._createUi5View(i,u1,v1).then(function(y1){var B1,C1=q("#"+i.getId());if(C1&&C1.length>0){B1=sap.ui.getCore().createRenderManager();B1.renderControl(y1);B1.flush(q("#"+i.getId())[0]);B1.destroy();}else{e.renderControl(y1);}i.oDeferredControlCreation.resolve();});t1.prototype._renderControlInDiv(e,i,undefined,"close");return;}L.debug("Not resolved as \"SAPUI5.Component=\" or \"SAPUI5=\" , "+"will attempt to load into iframe "+v1);if(!i.getActive()){L.debug("Skipping rendering container iframe","Container '"+i.getId()+"' is inactive");return;}try{u1=i.getFrameSource(p,u1,v1);}catch(ex){L.error(ex.message||ex,null,s);i.fireEvent("applicationConfiguration");e.renderControl(t1.prototype._createErrorControl());return;}if(sap.ushell.Container){w1=t1.prototype._getLogoutHandler(i);if(!w1){if(k.isApplicationTypeEmbeddedInIframe(p)){w1=t1.prototype._logout.bind(null,i);n.put(i.getId(),w1);sap.ushell.Container.attachLogoutEvent(w1);sap.ushell.Container.addRemoteSystem(t1.prototype._createSystemForUrl(u1));}}else if(!k.isApplicationTypeEmbeddedInIframe(p)){sap.ushell.Container.detachLogoutEvent(w1);n.remove(i.getId());}}u1=t1.prototype._checkNwbcUrlAdjustment(i,p,u1);u1=i._adjustURLForIsolationOpeningWithoutURLTemplate(u1);if(p==="TR"){i.setProperty("iframePostAllParams",true,true);}if(new U(window.location.href).get("sap-post")==="false"){x1=false;}else if(window.QUnit!==undefined){x1=i.getIframeWithPost();}if(x1===true&&(p==="NWBC"||p==="TR"||p==="WDA")){i.setProperty("iframeWithPost",true,true);i.oDeferredRenderer=new q.Deferred();u1=t1.prototype._filterURLParams(u1);var z1=[];var A1=t1.prototype._getParamKeys(u1,z1);t1.prototype._generateRootElementForIFrame(e,i,true);if(A1.length>0){sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(y1){y1.getAppStateData(A1).then(function(B1){var C1;var D1=q("#"+i.getId());if(D1.length>0){C1=sap.ui.getCore().createRenderManager();t1.prototype._buildHTMLElements(C1,i,B1,z1,u1);C1.flush(D1[0]);C1.destroy();}else{t1.prototype._buildHTMLElements(e,i,B1,z1,u1);}setTimeout(i.oDeferredRenderer.resolve,0);},function(B1){t1.prototype._buildHTMLElements(e,i,undefined,z1,u1);setTimeout(i.oDeferredRenderer.resolve,0);});});}else{t1.prototype._buildHTMLElements(e,i,undefined,z1,u1);setTimeout(i.oDeferredRenderer.resolve,0);}t1.prototype._generateRootElementForIFrame(e,i,false);return;}i.fireEvent("applicationConfiguration");e.write("<iframe").writeControlData(i).writeAccessibilityState(i).writeAttributeEscaped("src",u1).writeAttributeEscaped("title",r.i18n.getText("AppilcationContainer.IframeTitle")).addClass("sapUShellApplicationContainer").writeClasses(i).addStyle("height",i.getHeight()).addStyle("width",i.getWidth()).writeStyles();if(h.last("/core/shell/enableFeaturePolicyInIframes")===true){e.writeAttribute("allow",m);}e.write("></iframe>");}function m1(e){var i=new U(document.URL);if(i.get("sap-isolation-enabled")==="true"){var p=o,u1=p.getHash(document.URL),v1="",w1="&sap-plugins="+encodeURIComponent(sap.ushell.Container.getService("PluginManager")._getNamesOfPluginsWithAgents()),x1="&sap-history-dir="+(H.getInstance().getDirection()?H.getInstance().getDirection():"");if(e.indexOf("&/")>0){v1=e.substr(e.indexOf("&/"));}if(w1==="&sap-plugins="){w1="";}if(u1){var y1=p.parseShellHash("#"+u1),z1=p.paramsToString(y1.params);if(z1&&z1.length>=0){var A1=sap.ushell.Container.getService("AppState").createEmptyAppState(),B1=sap.ushell.Container.getService("AppState").createEmptyAppState(),C1="";if(z1.indexOf("sap-intent-param")>=0){C1=encodeURIComponent(z1);}else{A1.setData(z1);A1.save();C1=encodeURIComponent("sap-intent-param="+A1.getKey());}B1.setData("sap-startup-params="+C1);B1.save();e=e.split("#")[0]+"&sap-intent-param="+B1.getKey()+w1+x1+"#"+window.hasher.getHash();}else{e=e.split("#")[0]+w1+x1+"#"+window.hasher.getHash();}}else{e+="#"+window.hasher.getHash();}if(e.indexOf("&/")<0){e+=v1;}}if(i.has("sap-iframe-params")){var D1=i.get("sap-iframe-params")||"",E1=D1.split(",");E1.forEach(function(F1){if(F1&&F1.length>0){if(i.has(F1)){e=e.split("#")[0]+"&"+F1+"="+i.get(F1)+"#"+e.split("#")[1];}}});}return e;}function n1(e){var i=new f(e);i=i.removeSearch(z);return i.toString();}function o1(e,i){var p=[],u1;if(e.indexOf("sap-intent-param=")>0){u1=/(?:sap-intent-param=)([^&/]+)/.exec(e);if(u1&&u1.length===2){p.push([u1[1]]);i.push("sap-intent-param-data");}}if(e.indexOf("sap-xapp-state=")>0){u1=/(?:sap-xapp-state=)([^&/]+)/.exec(e);if(u1&&u1.length===2){p.push([u1[1]]);i.push("sap-xapp-state-data");}}if(e.indexOf("sap-iapp-state=")>0){u1=/(?:sap-iapp-state=)([^&/]+)/.exec(e);if(u1&&u1.length===2){p.push([u1[1]]);i.push("sap-iapp-state-data");}}return p;}function p1(e,i,p,u1,v1){var w1=i.getId()+"-form",x1="",y1="",z1=false;if(p===undefined){p=[];}p.push([sap.ushell.Container.getFLPUrl(true)]);u1.push("sap-flp-url");p.push([i.getSystemAlias()]);u1.push("system-alias");var A1="";var B1={};u1.forEach(function(F1,G1){if(p[G1][0]){B1[F1]=p[G1][0];}});var C1=v1;A1=JSON.stringify(B1);x1="<input name=\"sap-flp-params\" value=\""+a(A1)+"\">";if(i.getIframePostAllParams()===true){var D1=new U(v1);y1=q1(i,D1);if(y1!==""){v1=r1(v1,D1);}}i.fireEvent("applicationConfiguration");e.write("<form").writeAttributeEscaped("method","post").writeAttributeEscaped("id",w1).writeAttributeEscaped("name",w1).writeAttributeEscaped("target",i.getId()+"-iframe").writeAttributeEscaped("action",v1).addStyle("display","none").writeStyles().write(">").writeAttributeEscaped(x1+y1).write("</form>");var E1=i.sId;if(i.hasStyleClass("sapUShellApplicationContainerIframeHidden")){z1=true;i.toggleStyleClass("sapUShellApplicationContainerIframeHidden",false);}i.sId+="-iframe";e.write("<iframe").writeAttributeEscaped("name",i.getId()).writeControlData(i).writeAccessibilityState(i).writeAttributeEscaped("sap-orig-src",C1).writeAttributeEscaped("title",r.i18n.getText("AppilcationContainer.IframeTitle")).addClass("sapUShellApplicationContainer").writeClasses(i).addStyle("height",i.getHeight()).addStyle("width",i.getWidth()).writeStyles();if(h.last("/core/shell/enableFeaturePolicyInIframes")===true){e.writeAttribute("allow",m.replaceAll(";"," "+(new f(v1).origin())+";"));}e.write("></iframe>");i.sId=E1;if(z1){i.toggleStyleClass("sapUShellApplicationContainerIframeHidden",true);}}function q1(e,i){var u1="";var v1="",w1="";if(i.has("sap-iframe-hint")){u1=i.get("sap-iframe-hint");}var x1=i.mParams;if(e.getApplicationType()==="TR"||(u1==="GUI")){var p,y1;for(p in x1){if(p==="sap-iframe-hint"||p==="sap-keep-alive"){continue;}y1=x1[p][0];v1="<input name=\""+p+"\" value=\""+a(y1)+"\">";w1+=v1;}}return w1;}function r1(e,i){var p=i.get("sap-iframe-hint"),u1=i.get("sap-keep-alive"),v1=new f(e).query("");if(typeof p==="string"){v1.addSearch("sap-iframe-hint",p);}if(typeof u1==="string"){v1.addSearch("sap-keep-alive",u1);}return v1.toString();}function s1(e,i,p){if(p){e.write("<div").writeControlData(i).writeAttributeEscaped("sap-iframe-app","true").addClass("sapUShellApplicationContainer").writeClasses(i).addStyle("height",i.getHeight()).addStyle("width",i.getWidth()).writeStyles().write(">");}else{e.write("</div>");}}var t1=c.extend(s,{metadata:{properties:{additionalInformation:{defaultValue:"",type:"string"},application:{type:"object"},applicationConfiguration:{type:"object"},applicationType:{defaultValue:"URL",type:P+"ApplicationType"},height:{defaultValue:"100%",type:"sap.ui.core.CSSSize"},navigationMode:{defaultValue:"",type:"string"},targetNavigationMode:{defaultValue:"",type:"string"},text:{defaultValue:"",type:"string"},url:{defaultValue:"",type:"string"},visible:{defaultValue:true,type:"boolean"},active:{defaultValue:true,type:"boolean"},"sap-system":{type:"string"},applicationDependencies:{type:"object"},componentHandle:{type:"object"},ui5ComponentName:{type:"string"},width:{defaultValue:"100%",type:"sap.ui.core.CSSSize"},shellUIService:{type:"object"},appIsolationService:{type:"object"},reservedParameters:{type:"object"},coreResourcesFullyLoaded:{type:"boolean"},isStateful:{defaultValue:false,type:"boolean"},iframeHandlers:{defaultValue:"",type:"string"},iframeWithPost:{defaultValue:false,type:"boolean"},beforeAppCloseEvent:{type:"object"},extendedInfo:{type:"object"},systemAlias:{defaultValue:"",type:"string"},iframePostAllParams:{defaultValue:false,type:"boolean"},isKeepAlive:{defaultValue:false,type:"boolean"},frameworkId:{defaultValue:"",type:"string"},iframeReusedForApp:{defaultValue:false,type:"boolean"}},events:{applicationConfiguration:{}},aggregations:{child:{multiple:false,type:"sap.ui.core.Control",visibility:"hidden"}},library:"sap.ushell",designtime:"sap/ushell/designtime/ApplicationContainer.designtime"},exit:function(){var e,i=this;if(sap.ushell.Container){e=t1.prototype._getLogoutHandler(i);if(e){sap.ushell.Container.detachLogoutEvent(e);n.remove(i.getId());}}localStorage.removeItem(i.globalDirtyStorageKey);if(i._unloadEventListener){removeEventListener("unload",i._unloadEventListener);}if(i._disableRouterEventHandler){sap.ui.getCore().getEventBus().unsubscribe("sap.ushell.components.container.ApplicationContainer","_prior.newUI5ComponentInstantion",i._disableRouterEventHandler);}if(i._storageEventListener){removeEventListener("storage",i._storageEventListener);}if(i._messageEventListener){removeEventListener("message",i._messageEventListener);}t1.prototype._destroyChild(i);if(c.exit){c.exit.apply(i);}},setHandleMessageEvent:function(i){v=i;},init:function(){var e=this;e.globalDirtyStorageKey=l+g();e._unloadEventListener=e.exit.bind(e);addEventListener("unload",e._unloadEventListener);e._storageEventListener=function(i){var p=e.getApplicationType();if(i.key===e.globalDirtyStorageKey&&i.newValue===sap.ushell.Container.DirtyState.PENDING&&k.isApplicationTypeEmbeddedInIframe(p)){var u1=e._getIFrame();if(u1){L.debug("getGlobalDirty() send pro54_getGlobalDirty ",null,"sap.ushell.components.container.ApplicationContainer");var v1=new f(e._getIFrameUrl(u1));var w1=v1.protocol()+"://"+v1.host();u1.contentWindow.postMessage(JSON.stringify({action:"pro54_getGlobalDirty"}),w1);}}};addEventListener("storage",e._storageEventListener);e._messageEventListener=t1.prototype._handleMessageEvent.bind(null,e);addEventListener("message",e._messageEventListener);},onAfterRendering:function(){var e=this;this.rerender=function(){};if(D.os.ios&&this.$().prop("tagName")==="IFRAME"){this.$().parent().css("overflow","auto");}if(this.oDeferredRenderer){this.oDeferredRenderer.done(function(){var i=document.getElementById(e.getId()+"-form");if(i){i.submit();}});}},renderer:function(e,i){var p=i.getApplication(),u1=i.launchpadData,v1;if(!i.getVisible()){t1.prototype._renderControlInDiv(e,i);return;}if(i.error){delete i.error;t1.prototype._renderControlInDiv(e,i,t1.prototype._createErrorControl());}else if(!p){t1.prototype._render(e,i,i.getApplicationType(),i.getUrl(),i.getAdditionalInformation());}else if(!p.isResolvable()){t1.prototype._render(e,i,p.getType(),p.getUrl(),"");}else if(u1){t1.prototype._render(e,i,u1.applicationType,u1.Absolute.url.replace(/\?$/,""),u1.applicationData);}else{L.debug("Resolving "+p.getUrl(),null,s);p.resolve(function(w1){L.debug("Resolved "+p.getUrl(),JSON.stringify(w1),s);i.launchpadData=w1;t1.prototype._destroyChild(i);},function(w1){var x1=p.getMenu().getDefaultErrorHandler();if(x1){x1(w1);}t1.prototype._destroyChild(i);i.error=w1;});v1=new T({text:t1.prototype._getTranslatedText("loading",[p.getText()])});t1.prototype._destroyChild(i);i.setAggregation("child",v1);t1.prototype._renderControlInDiv(e,i,v1);}}});t1.prototype.getFrameSource=function(e,i){if(!Object.prototype.hasOwnProperty.call(A.enum,e)){throw new Error("Illegal application type: "+e);}return i;};t1.prototype.setUrl=function(e){k1(this,"url",e);};t1.prototype.setAdditionalInformation=function(e){k1(this,"additionalInformation",e);};t1.prototype.setApplicationType=function(e){k1(this,"applicationType",e);};t1.prototype.createPostMessageRequest=function(e,i){var p=Date.now().toString();return{type:"request",request_id:p,service:e,body:i};};t1.prototype.setNewTRApplicationContext=function(e){var i=new q.Deferred(),p=this._getIFrame(),u1,v1,w1=this;if(!p){return i.promise().reject({message:"Expected an existing TR application application frame but found none."});}function x1(){if(v1){v1["sap-flp-url"]=sap.ushell.Container.getFLPUrl(true);v1["system-alias"]=w1.getSystemAlias();u1["sap-flp-params"]=v1;}var A1=w1.createPostMessageRequest("sap.its.startService",u1);w1.postMessageToIframe(A1,p,true).then(function(){i.resolve();},function(B1){i.reject({eventData:B1,message:"Failed to change application context."});});}e=k.appendSapShellParam(e);e=t1.prototype._filterURLParams(e);u1={url:e};if(this.getIframeWithPost&&this.getIframeWithPost()===true){var y1=[];var z1=t1.prototype._getParamKeys(e,y1);if(z1.length>0){sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(A1){A1.getAppStateData(z1).then(function(B1){v1={};y1.forEach(function(C1,D1){if(B1[D1][0]){v1[C1]=B1[D1][0];}});x1();},function(B1){x1();});});}else{v1={};x1();}}else{x1();}return i.promise();};t1.prototype.postMessageToIframe=function(i,p,u1){var v1=this;var w1=i.request_id;return new Promise(function(x1,y1){function z1(D1){var E1;try{E1=JSON.parse(D1.data,v1);if(w1!==E1.request_id){return;}if(E1.status==="success"){x1(E1);}else{y1(E1);}window.removeEventListener("message",z1);}catch(e){x1();L.warning("Obtained bad response from framework in response to message "+i.request_id);L.debug("Underlying framework returned invalid response data: '"+D1.data+"'");}}var A1=JSON.stringify(i);L.debug("Sending postMessage "+A1+" to application container '"+v1.getId()+"'");var B1=new f(v1._getIFrameUrl(p));var C1=B1.protocol()+"://"+B1.host();if(u1){window.addEventListener("message",z1,false);p.contentWindow.postMessage(A1,C1);}else{p.contentWindow.postMessage(A1,C1);x1();}});};t1.prototype.postMessageToCurrentIframe=function(e,i){if(i===undefined){i=false;}var p=this._getIFrame();if(!p){if(i){return Promise.reject({message:"Expected opened iframe not found."});}return;}return this.postMessageToIframe(e,p,i);};t1.prototype.setNewApplicationContext=function(e,i){var p=this;var u1=this["setNew"+e+"ApplicationContext"];if(!u1){return Promise.reject({message:"Unsupported application type"});}var v1=this._getIFrame();if(!v1){return Promise.reject({message:"Expected an existing TR application application frame but found none."});}var w1=this.createPostMessageRequest("sap.gui.triggerCloseSessionImmediately",{});return this.postMessageToIframe(w1,v1,true).then(function(){return u1.call(p,i);},function(x1){return Promise.reject({eventData:x1,message:"Failed to change application context."});});};t1.prototype.onApplicationOpened=function(e){var i=this.getIsStateful();if(!i){return Promise.resolve();}var p=this.getApplicationType();if(p==="TR"&&e!=="TR"){var u1=this._getIFrame();if(!u1){return Promise.reject({message:"Expected an exisiting TR application application frame but found none."});}var v1=this.createPostMessageRequest("sap.gui.triggerCloseSession",{});return this.postMessageToIframe(v1,u1,false).catch(function(w1){return Promise.reject({eventData:w1,message:"Failed to change application context."});});}return Promise.resolve();};t1.prototype.postMessageRequest=function(e,i){var p=this._getIFrame();if(!p){return Promise.reject({message:"Expected an exisiting TR application application frame but found none."});}var u1=this.createPostMessageRequest(e,i||{});return this.postMessageToIframe(u1,p,false).catch(function(v1){return Promise.reject({eventData:v1,message:"Failed to post message."});});};t1.prototype.sendBeforeAppCloseEvent=function(){var e=this.getBeforeAppCloseEvent&&this.getBeforeAppCloseEvent(),i;if(e&&e.enabled&&e.enabled===true){i=this.createPostMessageRequest("sap.ushell.services.CrossApplicationNavigation.beforeAppCloseEvent",e.params);return this.postMessageToIframe(i,this._getIFrame(),true);}return undefined;};t1.prototype.getDeffedControlCreation=function(e){return this.oDeferredControlCreation?this.oDeferredControlCreation.promise():q.Deferred().resolve().promise();};t1.prototype._getCommunicationHandlers=J;t1.prototype._adaptIsUrlSupportedResultForMessagePopover=B;t1.prototype._getLogoutHandler=G;t1.prototype._getParameterMap=N;t1.prototype._getTranslatedText=O;t1.prototype._createErrorControl=Q;t1.prototype._destroyChild=R;t1.prototype._createUi5View=V;t1.prototype._publishExternalEvent=W;t1.prototype._createUi5Component=X;t1.prototype._disableRouter=Y;t1.prototype._createSystemForUrl=Z;t1.prototype._isTrustedPostMessageSource=$;t1.prototype._handleMessageEvent=c1;t1.prototype._logout=f1;t1.prototype._renderControlInDiv=g1;t1.prototype._checkNwbcUrlAdjustment=h1;t1.prototype._adjustNwbcUrl=i1;t1.prototype._render=l1;t1.prototype._getParamKeys=o1;t1.prototype._buildHTMLElements=p1;t1.prototype._buildHTMLForAllPostParams=q1;t1.prototype._generateRootElementForIFrame=s1;t1.prototype._backButtonPressedCallback=_;t1.prototype._getIFrame=a1;t1.prototype._getIFrameUrl=b1;t1.prototype._filterURLParams=n1;t1.prototype._adjustURLForIsolationOpeningWithoutURLTemplate=m1;t1.prototype._resetPluginsLoadIndications=e1;t1.prototype._handlePostMessagesForPluginsPostLoading=d1;return t1;},true);
