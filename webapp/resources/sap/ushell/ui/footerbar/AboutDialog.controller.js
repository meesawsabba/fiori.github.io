// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/Fragment","sap/ui/model/json/JSONModel","sap/ushell/services/AppConfiguration","sap/ushell/Config","sap/ushell/resources","sap/base/Log","sap/base/util/isEmptyObject","sap/ui/Device"],function(C,F,J,A,a,r,L,b,D){"use strict";return C.extend("sap.ushell.ui.footerbar.AboutDialog.controller",{onBeforeOpen:function(){this._setupAboutDialogModel();},onClose:function(){this._getDialog().close();},onAfterClose:function(){this._getDialog().destroy();},_getDialog:function(){if(!this.oAboutDialog){this.oAboutDialog=F.byId("aboutDialogFragment","aboutDialog");}return this.oAboutDialog;},_setupAboutDialogModel:function(){this._setupAppInfoModel().catch(function(e){L.error("Failed to setup application info model.",e);});var o=this._getDialog(),s=this._getSystemInformation(),u=this._getUserEnvironmentInformation(),S=new J(s),U=new J(u);o.setModel(S,"SysInfo");o.setModel(U,"UserEnvInfo");},_setupAppInfoModel:function(){var c=["appId","appVersion","appSupportInfo","technicalAppComponentId","appFrameworkId","appFrameworkVersion"],o=this._getDialog();return new Promise(function(d,e){sap.ushell.Container.getServiceAsync("AppLifeCycle").then(function(f){var g=f.getCurrentApplication();return Promise.all([g.getInfo(c),this._getContentProviderLabel(g)]);}.bind(this)).then(function(R){var m=A.getMetadata(),i=R[0]||{},p=R[1];c=c.concat(["appTitle","contentProviderLabel"]);i.appTitle=m.title;i.contentProviderLabel=p;var f=this._buildApplicationInformationObject(c,i);o.setModel(new J(f),"AppInfo");d();}.bind(this)).catch(function(f){e(f);});}.bind(this));},_buildApplicationInformationObject:function(c,p){var o={},P;for(var i=0;i<c.length;i++){P=c[i];if(p[P]){o[P]={label:r.i18n.getText(P),text:p[P]};}}return o;},_getSystemInformation:function(){var l=sap.ushell.Container.getLogonSystem(),p=l.getProductName(),P=l.getProductVersion(),s=l.getSystemName(),S=l.getSystemRole(),t=l.getTenantRole(),o={};if(p){o.productName={label:r.i18n.getText("productName"),text:p};}if(P){o.productVersion={label:r.i18n.getText("productVersionFld"),text:P};}if(s){o.systemName={label:r.i18n.getText("systemName"),text:s};}if(S){o.systemRole={label:r.i18n.getText("systemRole"),text:S};}if(t){o.tenantRole={label:r.i18n.getText("tenantRole"),text:t};}return o;},_getUserEnvironmentInformation:function(){var u={};u.userAgentFld={label:r.i18n.getText("userAgentFld"),text:navigator.userAgent};var d=this._getDeviceType(),t=this._isTouchSupported(),U=sap.ushell.Container.getUser(),T=U.getTheme(),o=U.getContentDensity()==="cozy";if(d){u.deviceType={label:r.i18n.getText("deviceType"),text:d};}u.touchSupported={label:r.i18n.getText("touchSupported"),text:t?r.i18n.getText("yes"):r.i18n.getText("no")};u.activeTheme={label:r.i18n.getText("activeTheme"),text:T};u.optimizedForTouch={label:r.i18n.getText("AppearanceContentDensityLabel"),text:o?r.i18n.getText("yes"):r.i18n.getText("no")};return u;},_getContentProviderLabel:function(o){if(a.last("/core/contentProviders/providerInfo/show")){return o.getSystemContext().then(function(s){return s.label;});}return Promise.resolve(undefined);},_getDeviceType:function(){var d;if(D.system.combi){d=r.i18n.getText("configuration.form_factor_combi");}else if(D.system.desktop){d=r.i18n.getText("configuration.form_factor_desktop");}else if(D.system.tablet){d=r.i18n.getText("configuration.form_factor_tablet");}else if(D.system.phone){d=r.i18n.getText("configuration.form_factor_phone");}return d;},_isTouchSupported:function(){return D.support.touch&&(D.system.tablet||D.system.phone||D.system.combi);},calculateNumberOfColumns:function(m){if(!this.isFormVisible(m)){return 1;}return Object.keys(m).length>1?2:1;},isFormVisible:function(m){return!!m&&!b(m);}});});
