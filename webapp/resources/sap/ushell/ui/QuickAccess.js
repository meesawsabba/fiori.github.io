//Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/Fragment","sap/ui/model/json/JSONModel","sap/ushell/library","sap/ushell/Config","sap/ushell/resources","sap/ushell/utils","sap/ushell/utils/WindowUtils","sap/ushell/components/ComponentKeysHandler","sap/ushell/utils/AppType"],function(F,J,u,C,r,a,W,b,A){"use strict";var c=u.AppType;var q={oModel:new J({recentActivities:[],frequentActivities:[]}),_createQuickAccessDialog:function(f){return F.load({name:"sap.ushell.ui.QuickAccess",type:"XML",controller:this}).then(function(o){this.oQuickAccessDialog=o;this.oQuickAccessDialog.setModel(this.oModel);this.oQuickAccessDialog.attachAfterClose(function(){this.oQuickAccessDialog.destroy();var d=sap.ui.getCore().byId(f);if(d){d.focus();}else{b.getInstance().then(function(e){e.goToTileContainer();});}}.bind(this));sap.ui.getCore().byId("shell").addDependent(this.oQuickAccessDialog);return this.oQuickAccessDialog;}.bind(this));},_updateQuickAccessDialog:function(d){var i=d.getContent()[0];i.setBusy(true);return sap.ushell.Container.getServiceAsync("UserRecents").then(function(U){return Promise.all([new Promise(function(e){U.getRecentActivity().then(function(f){e(f.map(function(o){o.timestamp=a.formatDate(o.timestamp);return o;}));},function(){e([]);});}),new Promise(function(e){U.getFrequentActivity().then(function(f){e(f);},function(){e([]);});})]);}).then(function(R){var e=R[0];var f=R[1];this.oModel.setData({recentActivities:e,frequentActivities:f});this._setDialogContentHeight(d,Math.max(e.length,f.length));i.setBusy(false);}.bind(this));},_setDialogContentHeight:function(d,i){var h=(i+0.5)*4+2.75;if(h<18){h=18;}else if(h>42){h=42;}d.setContentHeight(h+"rem");},_closeDialog:function(){this.oQuickAccessDialog.close();},_titleFormatter:function(t,s){if(s===c.SEARCH){t="\""+t+"\"";}return t;},_descriptionFormatter:function(s){if(s===c.SEARCH){return r.i18n.getText("recentActivitiesSearchDescription");}return A.getDisplayName(s);},_itemPress:function(e){var p=e.getParameter("listItem").getBindingContextPath();var i=this.oModel.getProperty(p);if(i.url[0]==="#"){window.hasher.setHash(i.url);this._closeDialog();}else{var l=C.last("/core/shell/enableRecentActivity")&&C.last("/core/shell/enableRecentActivityLogging");if(l){var R={title:i.title,appType:c.URL,url:i.url,appId:i.url};sap.ushell.Container.getRenderer("fiori2").logRecentActivity(R);}W.openURL(i.url,"_blank");}}};return{openQuickAccessDialog:function(f,s){return q._createQuickAccessDialog(s).then(function(d){var i=d.getContent()[0];q._updateQuickAccessDialog(d);i.setSelectedKey(f);d.open();});},_getQuickAccess:function(){return q;}};});
