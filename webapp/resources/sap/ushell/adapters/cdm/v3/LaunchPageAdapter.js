// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/adapters/cdm/v3/_LaunchPage/readHome","sap/ushell/adapters/cdm/_LaunchPage/modifyHome","sap/ushell/adapters/cdm/v3/_LaunchPage/readCatalogs","sap/m/library","sap/ushell/utils","sap/ushell/utils/WindowUtils","sap/ushell/utils/UrlParsing","sap/ushell/adapters/cdm/v3/utilsCdm","sap/ushell/components/tiles/utilsRT","sap/ushell/adapters/cdm/v3/AdapterBase","sap/ushell/adapters/cdm/v3/_LaunchPage/readVisualizations","sap/ushell/navigationMode","sap/ushell/Config","sap/ui/model/json/JSONModel","sap/ui/thirdparty/jquery","sap/base/util/isEmptyObject","sap/base/util/ObjectPath","sap/base/Log"],function(r,m,R,M,u,W,a,U,o,A,b,n,C,J,q,i,O,L){"use strict";var g=M.GenericTileMode;var S="sap.ushell.components.tiles.cdm.applauncher";var D="sap.ushell.components.tiles.cdm.applauncherdynamic";function c(d,p,f){A.call(this,d,p,f);Promise.all([sap.ushell.Container.getServiceAsync("URLParsing"),sap.ushell.Container.getServiceAsync("CommonDataModel")]).then(function(e){this.oURLParsingService=e[0];this.oCDMService=e[1];}.bind(this));this._getTileFromHashInContextOfSite=function(e,z,I){var B=new q.Deferred(),E=z[I];if(!E){E=e(I);z[I]=E;}E.done(function(T){var F={tileIntent:I,tileResolutionResult:T};B.resolve(F);}).fail(function(F){B.reject("Hash '"+I+"' could not be resolved to a tile. "+F);});return B.promise();};this._getTileFromHash=function(I){var e=new q.Deferred();sap.ushell.Container.getServiceAsync("ClientSideTargetResolution").then(function(z){var B=z.resolveTileIntent.bind(z);this._getTileFromHashInContextOfSite(B,this._mCatalogTilePromises,I).done(e.resolve).fail(e.reject);}.bind(this));return e.promise();};this._getTileForUrl=function(T){var e={componentName:T.indicatorDataSource?D:S};return{tileIntent:"#",tileResolutionResult:{tileComponentLoadInfo:e,isCustomTile:false}};};this._prepareTileHash=function(T){var P={},e,z;if(this._isCatalogTile(T)){return T.tileIntent;}if(this._isGroupTile(T)&&T.target){z=T.target.parameters||[];z.forEach(function(B){if(B.name&&B.value){P[B.name]=[B.value];}});e={target:{semanticObject:T.target.semanticObject,action:T.target.action},params:P,appSpecificRoute:T.target.appSpecificRoute};return"#"+a.constructShellHash(e);}return undefined;};this.getDefaultGroup=function(){var e=new q.Deferred(),z;var B=this;if(!this._oDefaultGroup){z=this._ensureLoaded();}if(z){z.done(function(){e.resolve(B._oDefaultGroup);}).fail(function(E){e.reject("Failed to access default group. "+E);});}else{e.resolve(B._oDefaultGroup);}return e.promise();};this.addGroup=function(T){var e=new q.Deferred(),G,z,B=this;if(!this._isValidTitle(T)){return e.reject("No valid group title").promise();}z="Failed to add the group with title '"+T+"' to the homepage. ";this.oCDMService.getSite().done(function(E){G=u.generateUniqueId(r.getGroupIdsFromSite(E));m.addGroupToSite(E,m.createEmptyGroup(G,T));B.oCDMService.save().done(function(){delete B._ensureLoadedDeferred;e.resolve(E.groups[G],G);}).fail(function(F){e.reject(F);});}).fail(function(E){e.reject(z+E);});return e.promise();};this.setGroupTitle=function(G,N){var e=this,z=new q.Deferred(),B,E;if(typeof G!=="object"||!r.getGroupId(G)){return z.reject("Unexpected group value").promise();}if(!e._isValidTitle(N)){return z.reject("Unexpected oGroup title value").promise();}E="Failed to set new title for group with id '"+r.getGroupId(G)+"'. ";B=r.getGroupTitle(G);this.oCDMService.getSite().done(function(F){if(G){m.setGroupTitle(G,N);}e.oCDMService.save().done(function(){z.resolve();}).fail(function(H){L.error(H);z.reject(B);});}).fail(function(F){z.reject(B,E+F);});return z.promise();};this.hideGroups=function(H){var e=new q.Deferred(),z=this.oCDMService,G;if(H&&Array.isArray(H)){G="Failed to hide group. ";z.getSite().done(function(B){r.getGroupsArrayFromSite(B).forEach(function(E){var I=Array.prototype.indexOf.call(H,r.getGroupId(E))===-1;m.setGroupVisibility(E,I);});z.save().done(function(){e.resolve();}).fail(function(E){e.reject("Hiding of groups did not work as expected - "+E);});}).fail(function(E){e.reject(G+E);});}else{e.reject("Invalid input parameter aHiddenGroupIds. Please pass a valid input parameter.");}return e.promise();};this.moveGroup=function(G,e){var z=new q.Deferred(),B=this.oCDMService,E,F;if(!G||!r.getGroupId(G)||e<0){return z.reject("Unable to move groups - invalid parameters").promise();}F="Failed to move group with id '"+G.identification.id+"'. ";B.getSite().done(function(H){var I=r.getGroupIdsFromSite(H),K=r.getGroupId(G);if(!I){return z.reject("groupsOrder not found - abort operation of adding a group.");}else if(I.indexOf(K)===e){return z.resolve();}E=u.moveElementInsideOfArray(I,I.indexOf(K),e);if(!E){return z.reject("invalid move group operation - abort.");}m.setGroupsOrder(H,E);B.save().done(function(){z.resolve();}).fail(function(N){z.reject(N);});return undefined;}).fail(function(H){z.reject(F+H);});return z.promise();};this.removeGroup=function(G){var e=new q.Deferred(),z=this.oCDMService,B,E;if(typeof G!=="object"){return e.reject("invalid group parameter").promise();}E=r.getGroupId(G);if(!E){return e.reject("group without id given").promise();}B="Failed to remove group with id '"+E+"'. ";z.getSite().done(function(F){m.removeGroupFromSite(F,G);z.save().done(function(){e.resolve();}).fail(function(H){e.reject(H);});}).fail(function(F){e.reject(B+F);});return e.promise();};this.resetGroup=function(G){var e=new q.Deferred(),z=this.oCDMService,B=[],E=this,F,H;if(typeof G==="object"&&r.getGroupId(G)){H=r.getGroupId(G);F="Failed to reset group with id '"+H+"'. ";z.getSite().done(function(I){q.extend(true,B,r.getGroupsArrayFromSite(I));if(E.isGroupRemovable(G)===false){z.getGroupFromOriginalSite(H).done(function(K){if(typeof I==="object"&&r.getGroupFromSite(I,H)){m.overwriteGroup(I,K,H);}z.save().done(function(){e.resolve(K);}).fail(function(N){e.reject("Group could not be reset - "+N,B);});}).fail(function(K){e.reject("Group could not be reset - "+K,B);});}else{e.reject("Group could not be reset as it was created by the user",B);}}).fail(function(I){e.reject(F+I,[]);});}return e.promise();};this.getLinkTiles=function(G){return r.getGroupLinks(G);};this.isLinkPersonalizationSupported=function(){return true;};this._notifyTileAboutRefresh=function(T){if(typeof T.tileRefresh==="function"){T.tileRefresh();}};this.refreshTile=function(T){var e=this._mResolvedTiles[T.id];if(e){if(e.tileComponent){this._notifyTileAboutRefresh(e.tileComponent);}}};this._notifyTileAboutVisibility=function(T,N,e){if(typeof T.tileSetVisible==="function"&&e!==N){T.tileSetVisible(N);}};this.getTileView=function(G){var e=this;return new q.Deferred(function(z){return e._getTileView(G,false).then(function(T){z.resolve(T);},function(B){var E="Tile with ID '"+G.id+"' could not be initialized"+(B?":\n"+B:".");L.error(E,null,G.tileType);z.reject(E);});}).promise();};this._getCatalogTileView=function(e){if(typeof e!=="object"){throw new Error(e);}var z;if(typeof e.tileResolutionResult!=="object"){z=this._mResolvedTiles[e.id];}else{z=e;}return this._getTileUiComponentContainerSync(e,z,true);};this._getCatalogTileViewControl=function(e){var z=new q.Deferred();if(typeof e!=="object"){var E="Invalid input parameter passed to _getCatalogTileView: "+e;L.error(E);return z.reject(E).promise();}return this._getTileUiComponentContainer(e,e,true);};this._createLinkInstance=function(T,I,N,G,e){var z,B,E,F=this.getTileSubtitle(T);var H=G;if(I===true){z=this.getCatalogTileTitle(T);}else{z=this.getTileTitle(T);}B=new H({mode:g.LineMode,subheader:F,header:z,url:W.getLeanURL(this.getTileTarget(T)),press:function(K){this._genericTilePressHandler(T,K);}.bind(this)});if(N){E=e.i18n.getText(N+"NavigationMode");B.setAriaLabel(E+" "+z+" "+F);}this._mResolvedTiles[T.id].linkTileControl=B;return B;};this._genericTilePressHandler=function(T,e){var z;if(e.getSource().getScope&&e.getSource().getScope()==="Display"){z=this.getTileTarget(T);if(z){if(z[0]==="#"){hasher.setHash(z);}else{W.openURL(z,"_blank");}}}};this.addTile=function(e,G){var z=new q.Deferred(),B,E=this.oCDMService,F;if(!G){G=this._oDefaultGroup;}if(e.contentProviderId){if(e.externalUrl){return this.addBookmark(this._getBookmarkDataForExtensionCatalogTile(e),G);}return z.reject("Extension Tile without URL").promise();}F=k();F.vizId=e.vizId;this._mResolvedTiles[F.id]={tileIntent:e.tileIntent,tileResolutionResult:e.tileResolutionResult,isLink:false};E.getSite().done(function(H){H.groups[G.identification.id].payload.tiles.push(F);E.save().done(function(){z.resolve(F);}).fail(function(I){z.reject(I);});}).fail(function(H){B="Failed to add tile with id '"+F.id+"' to group with id '"+G.identification.id+"'. ";z.reject(B+H);});return z.promise();};this._getBookmarkDataForExtensionCatalogTile=function(e){var B={title:e.tileResolutionResult.title,subtitle:e.tileResolutionResult.subTitle,icon:e.tileResolutionResult.icon,info:e.tileResolutionResult.info,url:e.externalUrl};if(e.tileResolutionResult.indicatorDataSource&&e.tileResolutionResult.indicatorDataSource.path){B.serviceUrl=e.tileResolutionResult.indicatorDataSource.path;B.serviceRefreshInterval=e.tileResolutionResult.indicatorDataSource.refresh;}return B;};this.removeTile=function(G,T,I){var z=this.oCDMService,B,E=new q.Deferred(),F=this;if(!G||typeof G!=="object"||!G.identification||!G.identification.id||!T||typeof T!=="object"||!T.id){return E.reject({},"Failed to remove tile. No valid input parameters passed to removeTile method.").promise();}B="Failed to remove tile with id '"+T.id+"' from group with id '"+G.identification.id+"'. ";z.getSite().done(function(H){var P,K;I=+I;try{P=H.groups[G.identification.id].payload;}catch(e){E.reject(H.groups[G.identification.id],B);}K=F.getTileType(T)===F.TileType.Link?"links":"tiles";if(F.getTileType(T)===F.TileType.Link){I-=P.tiles.length;}if(I>=0){P[K].splice(I,1);}else{P[K]=P[K].filter(function(N){return N.id!==T.id;});}z.save().done(function(){E.resolve();}).fail(function(N){L.error(N);E.reject(H.groups[G.identification.id],N);});}).fail(function(e){E.reject({},B+e);});return E.promise();};this.moveTile=function(T,e,z,B,E,F){var G=new q.Deferred(),H=this.oCDMService,I=this,K;if(!T||i(T)||e===undefined||e<0||z===undefined||z<0||!B||!B.identification||!B.identification.id||!E||!E.identification||!E.identification.id){return G.reject("Invalid input parameters").promise();}K="Failed to move tile with id '"+T.id+"'. ";H.getSite().done(function(N){var P,Q,V=I.getTileType(T)===I.TileType.Link?"links":"tiles";if(!F){F=I._mResolvedTiles[T.id].isLink?"link":"tile";}P=F==="link"?"links":"tiles";if(V!==P&&I._mResolvedTiles[T.id]){I._mResolvedTiles[T.id].isLink=F==="link";}if(P==="links"){z-=N.groups[E.identification.id].payload.tiles.length;}if(V==="links"){e-=N.groups[B.identification.id].payload.tiles.length;}if(B.identification.id===E.identification.id){if(e!==z||V!==P){Q=N.groups[E.identification.id].payload;Q[V].splice(e,1);Q[P].splice(z,0,T);}else{return G.resolve(T).promise();}}else{N.groups[B.identification.id].payload[V].splice(e,1);N.groups[E.identification.id].payload[P].splice(z,0,T);}H.save().done(function(){G.resolve(T);}).fail(function(X){L.error(K+X);G.reject(K+X);});return undefined;}).fail(function(N){L.error(K+N);G.reject(K+N);});return G.promise();};this._compareCatalogs=function(e,B){return(e.identification.title||"").toLowerCase()>(B.identification.title||"").toLowerCase()?1:-1;};this.getCatalogs=function(){var e=this,z=new q.Deferred(),B=[];function E(F,G,B,H,P,I){var K=F.catalogs[G];if(P&&I){K.contentProviderId=P;I.catalogsMap[G]=K;}B.push(K);H.notify(K);}sap.ushell.Container.getServiceAsync("CommonDataModel").then(function(F){F.getSite().done(function(G){Object.keys(G.catalogs).forEach(function(H){E(G,H,B,z);});F.getExtensionSites().progress(function(H){var P=H.providerId;var I=H.site;var K=Promise.resolve(I);var N={sitePromise:K,site:I,catalogsMap:{}};Object.keys(I.catalogs).forEach(function(Q){e._mContentProviders[P]=N;E(I,Q,B,z,P,N);});}).done(function(H){H.filter(function(I){return!I.success;}).forEach(function(I){B.push({identification:{id:I.providerId},contentProviderId:I.providerId,error:"The following content providers could not provide catalogs: "+I.providerId+(I.error?" -> "+I.error:"")});});z.resolve(B.sort(e._compareCatalogs));});});});return z.promise();};this._isStartableInbound=function(I){if(!I.semanticObject||!I.action){return false;}var N=["Shell-plugin","Shell-bootConfig"];if(N.indexOf(I.semanticObject+"-"+I.action)>-1){return false;}return true;};this._isStartableVisualization=function(V,I){var e=O.get("signature.parameters",I);if(!e){return true;}var z=O.get("parameters",b.getTarget(V));return Object.keys(e).every(function(B){var E=e[B];if(B==="sap-external-url"){return true;}if(!E.filter||E.filter.format!=="plain"){return true;}var F=E.filter.value;var G=O.get([B,"value","value"],z);if(F!==G){return false;}return true;});};this._isHiddenInbound=function(I){return!!I.hideLauncher;};this._toHashFromInbound=function(I){var e=U.toHashFromInbound(I);if(!e){return undefined;}return"#"+e;};this._getExternalUrlFromInbound=function(I){return O.get("signature.parameters.sap-external-url.launcherValue.value",I)||null;};this._toHashFromOutbound=function(e){var z=U.toHashFromOutbound(e);if(!z){return undefined;}return"#"+z;};this.getCatalogTiles=function(e){var z=this,B=new q.Deferred();if(typeof e!=="object"||e===null){return B.reject("Invalid input parameter '"+e+"' passed to getCatalogTiles.").promise();}if(e.contentProviderId&&this._mContentProviders[e.contentProviderId]){this._mContentProviders[e.contentProviderId].sitePromise.then(function(E){h.call(z,e,E).done(B.resolve).fail(B.reject);},function(E){B.reject("Failed to get site: "+E);});}else{this.oCDMService.getSite().done(function(E){h.call(z,e,E).done(B.resolve).fail(B.reject);}).fail(function(E){B.reject("Failed to get site: "+E);});}return B.promise();};function h(e,z){var B=this,E=new q.Deferred();setTimeout(function(){var F=((e.payload&&e.payload.viz)||[]).reduce(function(G,V){var H,I,K,N,P,Q,T,X,Y,Z,$,_,a1,b1,c1,d1,e1;if(!V){return G;}I=b.get(z,V);if(!I){return G;}K=b.getTypeId(I);N=b.getType(z,K);H=b.getAppId(I);if(H){P=b.getAppDescriptor(z,H);if(!P){return G;}Q=r.getInbound(P,b.getTarget(I).inboundId);if(!Q){return G;}if(!B._isStartableInbound(Q.inbound)||!B._isStartableVisualization(I,Q.inbound)||B._isHiddenInbound(Q.inbound)){return G;}X=U.mapOne(Q.key,Q.inbound,P,I,N,z);if(!X||!X.tileResolutionResult){return G;}b1=X.resolutionResult.applicationType;c1=X.resolutionResult.additionalInformation;e1=C.last("/core/navigation/enableInPlaceForClassicUIs");d1=e1?e1[b1]:false;Y=n.computeNavigationModeForHomepageTiles(b1,c1,d1);Z=b.getOutbound(I,Q.inbound);T=B._toHashFromOutbound(Z);}else{var f1=b.getConfig(I);if(f1===undefined){return G;}X=U.mapOne(undefined,undefined,undefined,I,N,z);if(u.getMember(f1,"sap|flp.target.type")==="URL"){a1=u.getMember(f1,"sap|flp.target.url");}}$=X.tileResolutionResult;$.navigationMode=Y;if(!B._isFormFactorSupported($)){return G;}if(e.contentProviderId){a1=B._getMember(P,"sap|app.crossNavigation.inbounds.Shell-launchURL.signature.parameters.sap-external-url.launcherValue.value");}_={id:V,vizId:V,tileIntent:a1||T,tileResolutionResult:$,isCatalogTile:true};if(e.contentProviderId&&a1){_.contentProviderId=e.contentProviderId;_.externalUrl=a1;}G.push(_);return G;},[]);E.resolve(F);},0);return E.promise();}this.getCatalogError=function(e){if(e.error){return e.error;}return undefined;};this.getCatalogId=function(e){return R.getId(e);};this.getCatalogTitle=function(e){return R.getTitle(e);};this._isFailedCatalogTile=function(T){return!!(T&&this._mFailedResolvedCatalogTiles&&this._mFailedResolvedCatalogTiles[r.getTileId(T)]);};this.getCatalogTileTitle=function(G){if(this._isGroupTile(G)){if(this._isFailedGroupTile(G)){return"";}return this._mResolvedTiles[G.id].tileResolutionResult.title;}if(this._isCatalogTile(G)){if(this._isFailedCatalogTile(G)){return undefined;}return G.tileResolutionResult.title;}return undefined;};this.getCatalogTileSize=function(e){return e.tileResolutionResult.size||"1x1";};this.getCatalogTileView=function(e){return this._getCatalogTileView(e);};this.getCatalogTileViewControl=function(e){return this._getCatalogTileViewControl(e);};this.getCatalogTilePreviewSubtitle=function(G){if(this._isGroupTile(G)){return this.getTileSubtitle(G);}return(G.tileResolutionResult&&G.tileResolutionResult.subTitle)||"";};this.getCatalogTilePreviewIcon=function(G){if(this._isGroupTile(G)){return this.getTileIcon(G);}return(G.tileResolutionResult&&G.tileResolutionResult.icon)||"";};this.getCatalogTilePreviewInfo=function(G){if(this._isGroupTile(G)){return this.getTileInfo(G);}return(G.tileResolutionResult&&G.tileResolutionResult.info)||"";};this.getCatalogTilePreviewIndicatorDataSource=function(G){return G.tileResolutionResult&&G.tileResolutionResult.indicatorDataSource;};this.getCatalogTileKeywords=function(G){var K=[],e=G;if(!e){L.error("Could not find the Tile","sap.ushell.adapters.cdm.LaunchPageAdapter");return K;}if(this._mResolvedTiles&&this._mResolvedTiles[G.id]){e=this._mResolvedTiles[G.id];}if(e&&e.tileResolutionResult&&Array.isArray(e.tileResolutionResult.keywords)){Array.prototype.push.apply(K,e.tileResolutionResult.keywords);}if(e&&e.tileResolutionResult&&e.tileResolutionResult.title){K.push(e.tileResolutionResult.title);}if(e&&e.tileResolutionResult&&e.tileResolutionResult.subTitle){K.push(e.tileResolutionResult.subTitle);}return K;};this._visitBookmarks=function(e,V,z,B){var E;var I=a.parseShellHash(e);if(I){E=x(I);}else{E=w(e);}return this.oCDMService.getSite().then(function(F){var G=F.groups;var T=Object.keys(G).filter(function(K){return!G[K].payload.locked;}).map(function(K){return G[K].payload.tiles.filter(function(H){return H.isBookmark&&H.vizType===z&&(H.contentProvider||"")===(B||"")&&s(E,H.target);});}).reduce(function(H,K){Array.prototype.push.apply(H,K);return H;},[]);if(!V){return T.length;}return q.when(T.map(V)).then(function(){return T.length;});});};this.addBookmark=function(P,G,e){var z=this;return new q.Deferred(function(B){var E=z.oCDMService;q.when(G||z.getDefaultGroup(),E.getSite()).done(function(G,F){var T,H,I=a.parseShellHash(P.url),K,N=false;if(!I){H=w(P.url);N=true;}else{H=x(I);}T=j(P,H,e);if(N){K=new q.Deferred();K.resolve(z._getTileForUrl(T));}else{K=z._getTileFromHash(P.url);}K.done(function(Q){Q.isLink=false;z._mResolvedTiles[T.id]=Q;F.groups[G.identification.id].payload.tiles.push(T);E.save().done(function(){B.resolve(T);}).fail(function(V){B.reject(V);});}).fail(function(Q){B.reject("Bookmark creation failed because: "+Q);});}).fail(function(F){B.reject(F);});}).promise();};this.addCustomBookmark=function(B,T,e){var z=new q.Deferred();Promise.all([sap.ushell.Container.getServiceAsync("URLParsing"),sap.ushell.Container.getServiceAsync("CommonDataModel")]).then(function(E){var F=E[0];var G=E[1];q.when(T||this.getDefaultGroup(),G.getSite()).done(function(H,I){var K,N=F.parseShellHash(B.url),P=(N===undefined);K=P?w(B.url):x(N);var Q={id:u.generateUniqueId([]),vizType:B.vizType,title:B.title,subTitle:B.subtitle,icon:B.icon,info:B.info,numberUnit:B.numberUnit,target:K,indicatorDataSource:{path:B.serviceUrl,refresh:B.serviceRefreshInterval},vizConfig:B.vizConfig,isBookmark:true};if(e){Q.contentProvider=e;}this._resolveTileByVizId(Q,I).done(function(V){V.isLink=false;this._mResolvedTiles[Q.id]=V;I.groups[H.identification.id].payload.tiles.push(Q);G.save().done(function(){z.resolve(Q);}).fail(z.reject);}.bind(this)).fail(function(V){z.reject("Bookmark creation failed because: "+V);});}.bind(this)).fail(z.reject);}.bind(this));return z.promise();};this.countBookmarks=function(e,z){return this._visitBookmarks(e,undefined,undefined,z);};this.countCustomBookmarks=function(I){if(!I.vizType){return Promise.reject("countCustomBookmarks: Required parameter is missing: oIdentifier.vizType");}return new Promise(function(e,z){this._visitBookmarks(I.url,undefined,I.vizType,I.contentProviderId).done(e).fail(z);}.bind(this));};this.updateBookmarks=function(e,P,V,z){var B=this.oCDMService;var E=this._mResolvedTiles;function F(T){return new q.Deferred(function(G){var I,N;var H;var K=false;var Q={};if(P.url||P.url===""){I=a.parseShellHash(P.url);if(!I){N=w(P.url);}else{N=x(I);}}if(T.icon!==P.icon){Q.icon=P.icon;K=true;}if(T.title!==P.title){Q.title=P.title;K=true;}if(T.subTitle!==P.subtitle){Q.subtitle=P.subtitle;K=true;}if(P.url&&e!==P.url){Q.targetURL=P.url;K=true;}if(T.info!==P.info){Q.info=P.info;K=true;}l(T,P,N);if(K&&E[T.id]){H=E[T.id].tileComponent;if(H){H.tileSetVisualProperties(Q);}}G.resolve(T);}).promise();}return this._visitBookmarks(e,F,V,z).then(function(G){return B.save().then(function(){return G;});});};this.updateCustomBookmarks=function(I,B){if(!I.vizType){return Promise.reject("updateCustomBookmarks: Required parameter is missing: oIdentifier.vizType");}if(B.title===""){return Promise.reject("updateCustomBookmarks: The bookmark title cannot be an empty string");}if(B.url===""){return Promise.reject("updateCustomBookmarks: The bookmark url cannot be an empty string");}return new Promise(function(e,z){this.updateBookmarks(I.url,B,I.vizType,I.contentProviderId).done(e).fail(z);}.bind(this));};this.deleteBookmarks=function(e,V,z){var B=this.oCDMService;var I=a.parseShellHash(e);var E;if(I){E=x(I);}else{E=w(e);}return B.getSite().then(function(F){var G=F.groups;var H=Object.keys(G).map(function(K){var P=G[K].payload;var N=0;P.tiles=P.tiles.filter(function(T){if(T.isBookmark&&T.vizType===V&&(T.contentProvider||"")===(z||"")&&s(E,T.target)){++N;return false;}return true;});return N;}).reduce(function(K,N){K+=N;return K;},0);return B.save().then(function(){return H;});});};this.deleteCustomBookmarks=function(I){if(!I.vizType){return Promise.reject("deleteCustomBookmarks: Required parameter is missing: oIdentifier.vizType");}return new Promise(function(e,z){this.deleteBookmarks(I.url,I.vizType,I.contentProviderId).done(e).fail(z);}.bind(this));};this.onCatalogTileAdded=function(T){};this._onTileSettingsSave=function(T,e){var z=new q.Deferred(),B,N,E,F,G,H,I;if(!T||!T.id||!e){return z.reject().promise();}N=e.oTitleInput.getValue();F=e.oSubTitleInput.getValue();E=e.oInfoInput.getValue();G=this.getTileTitle(T);H=this.getTileInfo(T);I=this.getTileSubtitle(T);if(G===N&&I===F&&H===E){return z.resolve().promise();}B={};if(G!==N){B.title=N;T.title=N;}if(I!==F){B.subtitle=F;T.subTitle=F;}if(H!==E){B.info=E;T.info=E;}if(this._mResolvedTiles[T.id].tileComponent){this._mResolvedTiles[T.id].tileComponent.tileSetVisualProperties(B);}else if(this._mResolvedTiles[T.id].linkTileControl){if(B.title){this._mResolvedTiles[T.id].linkTileControl.setHeader(B.title);}if(B.subtitle){this._mResolvedTiles[T.id].linkTileControl.setSubheader(B.subtitle);}if((B.title)||(B.subtitle)){this._mResolvedTiles[T.id].linkTileControl.rerender();}}sap.ushell.Container.getServiceAsync("CommonDataModel").then(function(K){K.save().fail(function(P){L.error(P);z.reject("Could not save personalization changes: "+P);}).done(function(){z.resolve();});});return z.promise();};this.getTileActions=function(T){var e=[],z,B;if(this._isGroupTile(T)&&!this._isFailedGroupTile(T)){B=new J({config:{display_title_text:this.getTileTitle(T),display_subtitle_text:this.getTileSubtitle(T),display_info_text:this.getTileInfo(T)}});z=o.getTileSettingsAction(B,this._onTileSettingsSave.bind(this,T),this.getTileType(T));e.push(z);}return e;};function j(P,T,e){var z=k(P,T);z.isBookmark=true;if(e){z.contentProvider=e;}return z;}function k(P,T){var e={id:u.generateUniqueId([])};l(e,P,T);return e;}function l(T,P,e){P=q.extend(true,{},P);if(e){T.target=e;}if(P.title||P.title===""){T.title=P.title;}if(P.icon||P.icon===""){T.icon=P.icon;}if(P.subtitle||P.subtitle===""){T.subTitle=P.subtitle;}if(P.info||P.info===""){T.info=P.info;}if(P.numberUnit||P.numberUnit===""){T.numberUnit=P.numberUnit;}if(P.dataSource){T.dataSource={};q.extend(true,T.dataSource,P.dataSource);delete P.serviceUrl;}else if(P.dataSource===null){delete T.dataSource;delete T.indicatorDataSource;delete P.serviceUrl;}if((P.dataSource||T.dataSource)&&P.serviceUrlPath){T.indicatorDataSource={path:P.serviceUrlPath};}if(P.serviceUrl||P.serviceUrl===""){if(T.dataSource){L.warning("`serviceUrl` is marked for deprecation in the future."+"It is not the preferred means for defining a dynamic "+"tile's data source. Please use `oParameter.dataSource`");delete T.dataSource;}T.indicatorDataSource={path:P.serviceUrl};}else if(P.serviceUrl===null&&!T.dataSource){delete T.indicatorDataSource;}if(P.serviceRefreshInterval||P.serviceRefreshInterval===0){T.indicatorDataSource.refresh=P.serviceRefreshInterval;}if(P.vizConfig){T.vizConfig=P.vizConfig;}}function s(T,e){if(T&&e){if(T.url){return T.url===e.url;}return T.semanticObject===e.semanticObject&&T.action===e.action&&t(T.parameters,e.parameters)&&T.appSpecificRoute===e.appSpecificRoute;}return T===e;}function t(P,e){var F,z;P=P||[];e=e||[];if(P.length===e.length){F=v(P);z=v(e);return F===z;}return false;}function v(e){return e.map(function(P){return P.name+P.value;}).sort().join();}function w(e){return{url:e};}function x(I){var T={semanticObject:I.semanticObject,action:I.action,parameters:y(I.params)};if(I.appSpecificRoute){T.appSpecificRoute=I.appSpecificRoute;}return T;}function y(I){return Object.keys(I).map(function(K){var V=I[K]&&I[K][0];return{name:K,value:V||""};});}this._getSiteData=function(){var e=new q.Deferred();sap.ushell.Container.getServiceAsync("CommonDataModel").then(function(z){z.getSite().done(e.resolve).fail(e.reject);});return e.promise();};this._addDefaultGroup=function(G,e){var z=r.getDefaultGroup(G);if(!z){z=m.createDefaultGroup(u.generateUniqueId(r.getGroupIdsFromSite(e)));e=m.addGroupToSite(e,z,0);G=r.getGroupsArrayFromSite(e);}this._oDefaultGroup=z;return G;};}c.prototype=A.prototype;return c;},true);
