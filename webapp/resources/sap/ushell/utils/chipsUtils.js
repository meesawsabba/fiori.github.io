// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/base/util/ObjectPath"],function(L,O){"use strict";var D="X-SAP-UI2-CHIP:/UI2/DYNAMIC_APPLAUNCHER",S="X-SAP-UI2-CHIP:/UI2/STATIC_APPLAUNCHER";var c={};c.getCatalogTilePreviewTitle=function(C){var a=c.getBagText(C,"tileProperties","display_title_text");return a||(!C.isStub()&&C.getContract("preview")&&C.getContract("preview").getPreviewTitle())||undefined;};c.getCatalogTilePreviewSubtitle=function(C){var a=c.getBagText(C,"tileProperties","display_subtitle_text");return a||(!C.isStub()&&C.getContract("preview")&&C.getContract("preview").getPreviewSubtitle())||undefined;};c.getCatalogTilePreviewIcon=function(C){var a=c._getConfigurationProperty(C,"tileConfiguration","display_icon_url");return a||(!C.isStub()&&C.getContract("preview")&&C.getContract("preview").getPreviewIcon())||undefined;};c.getCatalogTileTargetURL=function(C){var a=c._getConfigurationProperty(C,"tileConfiguration","navigation_target_url");return a||(!C.isStub()&&C.getContract("preview")&&C.getContract("preview").getTargetUrl())||undefined;};c.getCatalogTileNumberUnit=function(C){return c._getConfigurationProperty(C,"tileConfiguration","display_number_unit");};c.getCatalogTilePreviewInfo=function(C){return c.getBagText(C.getChip(),"tileProperties","display_info_text");};c.getCatalogTileSize=function(C){return c.getTileSize(C);};c.getCatalogTilePreviewIndicatorDataSource=function(C){var i;var t=c._getAppLauncherTileConfiguration(C);if(c._isAppLauncher(C)&&t&&t.service_url){i={path:t.service_url,refresh:t.service_refresh_interval};}return i;};c._getConfigurationProperty=function(C,s,p){var t,T;try{t=C.getConfigurationParameter(s);T=JSON.parse(t);}catch(e){return;}if(T[p]!==undefined){return T[p];}};c.getBagText=function(C,b,t){if(C.getBagIds().indexOf(b)>-1&&C.getBag(b).getTextNames().indexOf(t)>-1){return C.getBag(b).getText(t);}};c.getTileSize=function(t){var r=(!t.isStub()&&t.getConfigurationParameter("row"))||"1",a=(!t.isStub()&&t.getConfigurationParameter("col"))||"1";return r+"x"+a;};c._getAppLauncherTileConfiguration=function(C){var p,s=C.getConfigurationParameter("tileConfiguration");try{p=JSON.parse(s||"{}");}catch(e){L.error("Tile with ID '"+C.getId()+"' has a corrupt configuration containing a 'tileConfiguration' value '"+s+"' which could not be parsed. If present, a (stringified) JSON is expected as value.",e.message,"sap.ushell_abap.adapters.abap.LaunchPageAdapter");return{};}return p;};c._isAppLauncher=function(C){var b=C.getChip().getBaseChipId();return b===D||b===S;};c.getTileConfigurationFromSimplifiedChip=function(s){var t;try{t=JSON.parse(s.configuration.tileConfiguration);}catch(e){t={};}return t;};c.getTargetUrlFromSimplifiedChip=function(s,U){var C=this.getCustomTileTargetFromSimplified(s);if(C){return"#"+U.constructShellHash(C);}var t=this.getTileConfigurationFromSimplifiedChip(s);return t.navigation_target_url;};c.getIndicatorDataSourceFromSimplifiedChip=function(s){var t=this.getTileConfigurationFromSimplifiedChip(s);var a=t.service_url;if(!a){return undefined;}return{path:a,refresh:t.service_refresh_interval};};c.getTileSizeFromSimplifiedChip=function(s){var C=s.configuration;var r=C.row||1;var a=C.col||1;return r+"x"+a;};c.getNumberUnitFromSimplifiedChip=function(s){var t=this.getTileConfigurationFromSimplifiedChip(s);return t.display_number_unit;};c.getInfoFromSimplifiedChip=function(s){var t=s.bags.tileProperties;return t&&t.texts.display_info_text;};c.getKeywordsFromSimplifiedChip=function(s){var k=[];var t=s.bags.tileProperties;var K=t&&t.texts.display_search_keywords;if(K){k.push(K);}return k;};c.isCustomTileFromSimplifiedChip=function(s){var C=s.chipId;return C!==D&&C!==S;};c.loadChipInstanceFromSimplifiedChip=function(s){var b=s.bags;var r={chipId:s.chipId,configuration:s.configuration?JSON.stringify(s.configuration):"{}"};return sap.ushell.Container.getServiceAsync("PageBuilding").then(function(p){var f=p.getFactory();var C=f.createChipInstance(r);this.addBagDataToChipInstance(C,b);return new Promise(function(a,d){C.load(a,d);}).then(function(){return C;});}.bind(this));};c.addBagDataToChipInstance=function(C,b){if(!b){return;}var p;for(var B in b){var o=b[B];var a=C.getBag(B);try{for(p in o.properties){a.setProperty(p,o.properties[p]);}for(p in o.texts){a.setText(p,o.texts[p]);}}catch(e){L.error("chipsUtils.addBagDataToChipInstance: "+e.toString());}}};c.getCustomTileTargetFromSimplified=function(s){if(s.chipId==="X-SAP-UI2-CHIP:/UI2/AR_SRVC_NEWS"){return{target:{semanticObject:"NewsFeed",action:"displayNewsList"}};}var t=JSON.parse(s.configuration.tileConfiguration||"{}");var T=JSON.parse(t.TILE_PROPERTIES||"{}");if(T.semanticObject&&T.semanticAction){return{target:{semanticObject:T.semanticObject,action:T.semanticAction},params:{EvaluationId:[T.evaluationId]}};}return null;};return c;},true);
