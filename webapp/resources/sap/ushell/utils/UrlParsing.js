// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/thirdparty/URI","sap/base/util/UriParameters","sap/base/Log"],function(U,b,L){"use strict";function c(){}var r=/^(([A-Za-z0-9_/]+)-([A-Za-z0-9_/-]+)(~([A-Z0-9a-z=+/]+))?)?([?]([^&]|(&[^/]))*&?)?$/;c.getShellHash=function(s){var a=/[^#]*#(([^&]|&[^/])*)(&\/.*)?/,m=a.exec(s);if(m){return m[1];}return undefined;};c.getHash=function(u){var a=/#(.*)/,m=a.exec(u);if(m){return m[1];}return undefined;};c.isIntentUrl=function(u){return this._isIntentUrl(u,window.location.href);};c.isIntentUrlAsync=function(u){return new Promise(function(a,e){sap.ushell.Container.getFLPUrlAsync(true).done(a).fail(e);}).then(function(f){return this._isIntentUrl(u,f);}.bind(this));};c._isIntentUrl=function(u,f){var a=/^#/,t,l,T,s,h,p;if(typeof u!=="string"){return false;}if(!a.test(u)){t=(new U(u)).normalize();T=t.protocol()+"://"+t.host()+t.pathname();l=(new U(f)).normalize();s=l.protocol()+"://"+l.host()+l.pathname();if(T!==s){return false;}}h=c.getHash(u);if(!h){return false;}p=c.parseShellHash(h);if(p&&p.semanticObject&&p.action){return true;}return false;};c.parseParameters=function(p){var u=b.fromQuery(p);var k=u.keys();var K=k.next();var P={};while(K.done===false){P[K.value]=u.getAll(K.value);K=k.next();}return P;};function _(p,e,f){var g,a,k,i,l,s="";e=e||"&";f=f||"=";g="";a=null;l=[];for(a in p){if(p.hasOwnProperty(a)){l.push(a);}}l.sort();for(k=0;k<l.length;k=k+1){a=l[k];if(Array.isArray(p[a])){for(i=0;i<p[a].length;i=i+1){s+=g+encodeURIComponent(a)+f+encodeURIComponent(p[a][i]);g=e;}}else{s+=g+encodeURIComponent(a)+f+encodeURIComponent(p[a]);g=e;}}return s;}c.paramsToString=function(p){return _(p);};c.privparamsToString=function(p,D,a){return _(p,D,a);};c.parseShellHash=function(h){var a=r,s,S,A,C,p,m,e;if(!h){return undefined;}s=c.splitHash(h);m=a.exec(s.shellPart);if(m){S=m[2];A=m[3];C=m[5];p=m[6];e=c.parseParameters(p);return{semanticObject:S,action:A,contextRaw:C,params:e,appSpecificRoute:s.appSpecificRoute};}if(s.appSpecificRoute){return{semanticObject:undefined,action:undefined,contextRaw:undefined,params:{},appSpecificRoute:s.appSpecificRoute};}return undefined;};c.privstripLeadingHash=function(h){if(h[0]==="#"){return h.substring(1);}return h;};c.splitHash=function(h){var a=/^(?:#|)([\S\s]*?)(&\/[\S\s]*)?$/,m,s,A;if(h===undefined||h===null||h===""){return{};}m=a.exec(h);s=m[1];if(s!==""&&!r.test(s)){return{};}A=m[2];if(s||A){return{shellPart:s,appSpecificRoute:A};}return{};};function d(u,a){if(a){return u+a;}return u;}c.constructShellHash=function(s){var e,p,f,i=null,k,l=[],g="?",a=null;if(!s){return"";}if(!s.target){s.target={};s.target.semanticObject=s.semanticObject;s.target.action=s.action;s.target.contextRaw=s.contextRaw;}if(s.target.shellHash||s.target.shellHash===""){f=c.privstripLeadingHash(s.target.shellHash);return d(f,s.appSpecificRoute);}if(s.target.semanticObject&&s.target.action){e=s.target.semanticObject+"-"+s.target.action.replace(/[?].*/,"");}else{return d("",s.appSpecificRoute);}if(s.target.contextRaw){e+="~"+s.target.contextRaw;}g="?";a=null;l=[];for(a in s.params){if(s.params.hasOwnProperty(a)){l.push(a);}}p=(s.params&&JSON.parse(JSON.stringify(s.params)))||{};if(s.appStateKey){l.push("sap-xapp-state");p["sap-xapp-state"]=s.appStateKey;}l.sort();for(k=0;k<l.length;k=k+1){a=l[k];if(Array.isArray(p[a])){if(p[a].length>1){L.error("Array startup parameters violate the designed intent of the Unified Shell Intent, use only single-valued parameters!");}for(i=0;i<p[a].length;i=i+1){e+=g+encodeURIComponent(a)+"="+encodeURIComponent(p[a][i]);g="&";}}else{e+=g+encodeURIComponent(a)+"="+encodeURIComponent(p[a]);g="&";}}return d(e,s.appSpecificRoute);};return c;});
