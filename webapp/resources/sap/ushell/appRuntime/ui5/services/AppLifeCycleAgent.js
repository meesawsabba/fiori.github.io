// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/appRuntime/ui5/AppRuntimePostMessageAPI","sap/ushell/appRuntime/ui5/AppRuntimeService","sap/base/util/UriParameters","sap/ui/thirdparty/URI","sap/ui/thirdparty/jquery","sap/ui/Device","sap/ui/core/BusyIndicator","sap/ushell/appRuntime/ui5/performance/FesrEnhancer"],function(A,a,U,b,q,D,B,F){"use strict";function c(){var t=this,s,o,e=true,d={},C,f={},r,R;this.init=function(m,g,h,E,i,j){s=m;C=g;R=h;if(E!==undefined){e=E;}this.addAppInfoToCache(i,j);A.registerCommHandlers({"sap.ushell.services.appLifeCycle":{oServiceCalls:{create:{executeServiceCallFn:function(M){F.startInteraction();var k=JSON.parse(M.oMessage.data),i=new U(k.body.sUrl).get("sap-ui-app-id");t.create(i,k.body.sUrl);window.hasher.disableCFLPUpdate=true;window.hasher.replaceHash(k.body.sHash);window.hasher.disableCFLPUpdate=false;return new q.Deferred().resolve().promise();}},destroy:{executeServiceCallFn:function(M){var k=JSON.parse(M.oMessage.data);t.destroy(k.body.sCacheId);return new q.Deferred().resolve().promise();}},store:{executeServiceCallFn:function(M){var k=JSON.parse(M.oMessage.data);t.store(k.body.sCacheId);return new q.Deferred().resolve().promise();}},restore:{executeServiceCallFn:function(M){var k=JSON.parse(M.oMessage.data);t.restore(k.body.sCacheId);window.hasher.disableCFLPUpdate=true;window.hasher.replaceHash(k.body.sHash);window.hasher.disableCFLPUpdate=false;return new q.Deferred().resolve().promise();}}}}});this.initialSetup();};this.initialSetup=function(){a.sendMessageToOuterShell("sap.ushell.services.appLifeCycle.setup",{isStateful:true,isKeepAlive:true,lifecycle:{bActive:true,bSwitch:true,bStorageIdentifier:true},settings:{bTheme:true,bLocal:true},session:{bSignOffSupport:true,bExtendSessionSupport:true}});};this.restore=function(S){var g=f[S],h=g.getComponentInstance();g.setVisible(true);if(h){if(h.isKeepAliveSupported&&h.isKeepAliveSupported()===true){h.activate();}else{if(h.restore){h.restore();}if(h.getRouter&&h.getRouter()&&h.getRouter().initialize){h.getRouter().initialize();}}r=g;}};this.store=function(S){var g=r,h;f[S]=g;h=g.getComponentInstance();g.setVisible(false);if(h){if(h.isKeepAliveSupported&&h.isKeepAliveSupported()===true){h.deactivate();}else{if(h.suspend){h.suspend();}if(h.getRouter&&h.getRouter()){h.getRouter().stop();}}}};this.getURLParameters=function(u){return new Promise(function(g,h){if(u.hasOwnProperty("sap-intent-param")){var i=u["sap-intent-param"];a.sendMessageToOuterShell("sap.ushell.services.CrossApplicationNavigation.getAppStateData",{sAppStateKey:i}).then(function(p){delete u["sap-intent-param"];var j=q.extend({},u,(new b("?"+p)).query(true),true);g(j);},function(E){g(u);});}else{g(u);}});};this.getAppInfo=function(g,u){return new Promise(function(h){function G(){o.getAppInfo(g,u).then(function(i){t.addAppInfoToCache(g,i);h(i);});}if(e===true&&d[g]){h(JSON.parse(JSON.stringify(d[g])));}else if(o){G();}else{sap.ui.require([s.replace(/\./g,"/")],function(O){o=O;G();});}});};this.addAppInfoToCache=function(g,h){if(g&&h&&e===true&&d[g]===undefined){d[g]=JSON.parse(JSON.stringify(h));}};this.create=function(g,u){if(D.browser.chrome){B.show(0);}var h=new Promise(function(i){t.getAppInfo(g,u).then(function(j){i(j);});}).then(function(i){t.getURLParameters(new b(u).query(true)).then(function(j){C(g,j,i).then(function(k){R(k);});});});return h;};this.setComponent=function(g){r=g;};this.destroy=function(S){if(S){if(f[S]===r){r=undefined;}f[S].destroy();delete f[S];}else if(r){r.destroy();r=undefined;}F.setAppShortId();};}return new c();},true);
