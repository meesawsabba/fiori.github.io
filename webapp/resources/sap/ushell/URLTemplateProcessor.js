// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/ui/thirdparty/URI","sap/ui/thirdparty/URITemplate","sap/ushell/_URLTemplateProcessor/DefinitionParameterSetBuilder","sap/ushell/_URLTemplateProcessor/DependencyGraph","sap/ushell/_URLTemplateProcessor/Resolvers","sap/ushell/_URLTemplateProcessor/TemplateParameterParser","sap/ushell/_URLTemplateProcessor/utils"],function(L,U,a,_,b,c,d,e){"use strict";function l(s){L.debug(s,"sap.ushell.URLTemplateProcessor");}function f(v){if(typeof v==="undefined"){return"<undefined>";}if(typeof v==="string"){if(v===""){return"<empty string>";}return"'"+v+"'";}if(typeof v==="number"){return"(number) "+v;}if(typeof v==="boolean"){return"(bool) "+v;}var s;if(typeof v==="object"){s=JSON.stringify(v);if(s.length>255){s=s.substr(0,255)+"...";}}else{s="{other type}";}return s;}function g(P){var j=Object.keys(P).filter(function(s){return typeof P[s]==="object"&&P[s].hasOwnProperty("renameTo");});var o=[];j.forEach(function(s){var k=P[s];if(k.hasOwnProperty("renameTo")){o.push(function(u,m){var r=m;r=m.replace(new RegExp(s+"=","g"),k.renameTo+"=");return r;});}});return o;}function h(t,s,r,A,D){var E=p(t,s,r,A,D);return i(t,E);}function p(t,s,r,A,D){l("[TEMPLATE EXPANSION] "+t.urlTemplate);var o=_.buildDefinitionParameterSet(t.parameters,s,D)||{};var R=e.removeArrayParameterNotation(r[D]||{});var j=d.parseTemplateParameterSet(o,D);var k=d.parseTemplateParameterSetAsLiterals(R);var P=e.mergeObject(k,j);l("- parsed template parameters: "+JSON.stringify(P,null,3));var G=b.buildDependencyGraph(P);l("- created dependency graph: "+JSON.stringify(G,null,3));var m=b.getDependencyResolutionOrder(G);l("- resolving in order: "+m.join(" > "));var n=c.resolveAllParameters(P,m,s,r,A,D);Object.keys(n).forEach(function(q){var u=n[q];l(q+" --> "+f(u));});return{oDefinitionParamsSet:o,oResolvedParameters:n};}function i(t,E){var P=g(E.oDefinitionParamsSet||{});var u=t.urlTemplate;var s=U.expand(u,E.oResolvedParameters).toString();l("- created URL: "+s);P.forEach(function(o){s=o(u,s);});if(P.length>0){l("- created URL (post expansion): "+s);}return s;}return{prepareExpandData:p,expand:h};});
