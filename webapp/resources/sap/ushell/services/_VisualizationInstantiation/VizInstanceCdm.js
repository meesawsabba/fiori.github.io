// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/services/_VisualizationInstantiation/VizInstance","sap/m/library","sap/ui/core/Component","sap/base/util/ObjectPath","sap/base/util/deepExtend","sap/ui/core/ComponentContainer","sap/ushell/library","sap/ushell/services/_VisualizationInstantiation/VizInstanceRenderer"],function(V,m,C,O,d,a,u,b){"use strict";var L=m.LoadState;var c=V.extend("sap.ushell.ui.launchpad.VizInstanceCdm",{metadata:{library:"sap.ushell"},renderer:b});c.prototype.load=function(i){var o;if(i===true){o=this._loadCustomVizType();}else{o=this._loadStandardVizType();}return o.then(function(e){this._oComponent=e;var f=new a({component:e});e.setParent(this);this._setContent(f);this._setComponentTileVisible(this.getActive());}.bind(this)).catch(function(e){this.setState(L.Failed);return Promise.reject(e);}.bind(this));};c.prototype._loadStandardVizType=function(){var o=this._getComponentConfiguration();return C.create(o);};c.prototype._loadCustomVizType=function(){var A=this._getCustomComponentConfiguration();var p={};var w=[];return sap.ushell.Container.getServiceAsync("Ui5ComponentLoader").then(function(o){var U=o.createComponent(A,p,w,u.UI5ComponentType.Visualization);return new Promise(function(r,e){U.done(function(f){r(f);});});}).then(function(U){if(U&&U.componentHandle&&U.componentHandle.getInstance){return U.componentHandle.getInstance();}throw new Error("Create component failed: no instance found in the component handle.");});};c.prototype._getComponentConfiguration=function(){var v=this.getInstantiationData().vizType;var o=this.getVizConfig();var e=O.get(["sap.platform.runtime","componentProperties"],v);e=d({},this._getComponentProperties(),e);var f={name:v["sap.ui5"].componentName,componentData:{properties:e},url:O.get(["sap.platform.runtime","componentProperties","url"],v),manifest:O.get(["sap.platform.runtime","componentProperties","manifest"],v),asyncHints:O.get(["sap.platform.runtime","componentProperties","asyncHints"],v)};var i=O.get(["sap.platform.runtime","includeManifest"],v);var I=O.get(["sap.platform.runtime","includeManifest"],o);if(i||I){f.manifest=d({},v,o);}if(typeof f.manifest==="object"){e.manifest=f.manifest;}return f;};c.prototype._getCustomComponentConfiguration=function(){var o=this._getComponentConfiguration();var A={loadCoreExt:true,loadDefaultDependencies:false,componentData:o.componentData,url:o.url,applicationConfiguration:{},reservedParameters:{},applicationDependencies:o,ui5ComponentName:o.name};return A;};c.prototype._getComponentProperties=function(){return{title:this.getTitle(),subtitle:this.getSubtitle(),icon:this.getIcon(),info:this.getInfo(),indicatorDataSource:this.getIndicatorDataSource(),dataSource:this.getDataSource(),contentProviderId:this.getContentProviderId(),targetURL:this.getTargetURL(),displayFormat:this.getDisplayFormat(),numberUnit:this.getNumberUnit()};};c.prototype._setComponentTileVisible=function(v){if(this._oComponent&&typeof this._oComponent.tileSetVisible==="function"){this._oComponent.tileSetVisible(v);}};c.prototype.setActive=function(e,r){this._setComponentTileVisible(e);if(r){this.refresh();}return this.setProperty("active",e,false);};c.prototype.refresh=function(){if(this._oComponent&&typeof this._oComponent.tileRefresh==="function"){this._oComponent.tileRefresh();}};return c;});
