// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/m/ActionSheet","sap/m/library","sap/ui/events/PseudoEvents","sap/ushell/library","sap/ui/core/Control","sap/m/GenericTile","sap/ushell/services/_VisualizationInstantiation/VizInstanceRenderer","sap/ushell/resources","sap/m/VBox","sap/ui/core/Icon"],function(A,m,P,u,C,G,V,r,a,I){"use strict";var L=m.LoadState;var F=m.FrameType;var T=m.TileSizeBehavior;var D=u.DisplayFormat;var b=C.extend("sap.ushell.ui.launchpad.VizInstance",{metadata:{library:"sap.ushell",properties:{title:{type:"string",defaultValue:"",bindable:true},subtitle:{type:"string",defaultValue:"",bindable:true},height:{type:"int",defaultValue:2},width:{type:"int",defaultValue:2},info:{type:"string",defaultValue:"",bindable:true},icon:{type:"sap.ui.core.URI",defaultValue:"",bindable:true},numberUnit:{type:"string",defaultValue:"",bindable:true},state:{type:"sap.m.LoadState",defaultValue:L.Loaded,bindable:true},sizeBehavior:{type:"sap.m.TileSizeBehavior",defaultValue:T.Responsive,bindable:true},editable:{type:"boolean",defaultValue:false,bindable:true},active:{type:"boolean",defaultValue:false},targetURL:{type:"string"},indicatorDataSource:{type:"object",defaultValue:undefined},dataSource:{type:"object",defaultValue:undefined},keywords:{type:"string[]",defaultValue:[]},instantiationData:{type:"object",defaultValue:{}},contentProviderId:{type:"string",defaultValue:""},vizConfig:{type:"object"},supportedDisplayFormats:{type:"string[]",defaultValue:[D.Standard]},dataHelpId:{type:"string",defaultValue:""},displayFormat:{type:"string",defaultValue:D.Standard},preview:{type:"boolean",defaultValue:false}},defaultAggregation:"tileActions",aggregations:{content:{type:"sap.ui.core.Control",multiple:false},tileActions:{type:"sap.m.Button",forwarding:{getter:"_getTileActionSheet",aggregation:"buttons"}}},events:{press:{parameters:{scope:{type:"sap.m.GenericTileScope"},action:{type:"string"}}}}},renderer:V});b.prototype.init=function(){this._oContent=new G({frameType:this._formatPlaceholderFrameType(this.getDisplayFormat()),state:this.getState()});this.setAggregation("content",this._oContent);};b.prototype.setDisplayFormat=function(d){this.setProperty("displayFormat",d);this._setSize();if(this._oContent.isA("sap.m.GenericTile")){this._oContent.setFrameType(this._formatPlaceholderFrameType(d));}return this;};b.prototype.setState=function(s){this.setProperty("state",s);if(this._oContent.isA("sap.m.GenericTile")){this._oContent.setState(s);}return this;};b.prototype._formatPlaceholderFrameType=function(d){this._setSize();switch(d){case D.Flat:return F.OneByHalf;case D.FlatWide:return F.TwoByHalf;case D.StandardWide:return F.TwoByOne;default:return F.OneByOne;}};b.prototype.exit=function(){if(this._oActionModeButtonIconVBox){this._oActionModeButtonIconVBox.destroy();}if(this._oActionDivCenter){this._oActionDivCenter.destroy();}if(this._oActionSheet){this._oActionSheet.destroy();}if(this._oRemoveIconVBox){this._oRemoveIconVBox.destroy();}};b.prototype.getLayout=function(){return{columns:this.getWidth(),rows:this.getHeight()};};b.prototype._setContent=function(c){var g=this.getLayoutData();if(g&&g.isA("sap.f.GridContainerItemLayoutData")){g.setRows(this.getHeight());g.setColumns(this.getWidth());this.getParent().invalidate();}if(this.getDataHelpId()){c.data("help-id",this.getDataHelpId(),true);}this._oContent=c;this.invalidate();};b.prototype._updateContent=function(){var c=this._oContent;if(this._oContent.getItems){this.setAggregation("content",c.getItems()[0]);}else{this.setAggregation("content",c);}};b.prototype._getTileActionSheet=function(){if(!this._oActionSheet){this._oActionSheet=new A();}return this._oActionSheet;};b.prototype._onActionMenuIconPressed=function(){if(this._oActionModeIcon){this._getTileActionSheet().openBy(this._oActionModeIcon);}};b.prototype.getFocusDomRef=function(){if(this.getEditable()){return this._oActionModeIcon&&this._oActionModeIcon.getFocusDomRef();}var p=this._oContent.findAggregatedObjects(true,function(c){return c.isA("sap.m.GenericTile")||c.isA("sap.f.Card");});if(p.length){return p[0].getFocusDomRef();}return this._oContent.getFocusDomRef();};b.prototype.onclick=function(e){if(this._preventDefault(e)){this.firePress({scope:"Display",action:"Press"});}else if(this._oRemoveIconVBox&&this._oRemoveIconVBox.getDomRef().contains(e.target)){this.firePress({scope:"Actions",action:"Remove"});}else{this._onActionMenuIconPressed();}};b.prototype.onBeforeRendering=function(){this._updateContent();var d=this.getDomRef();if(d){d.removeEventListener("keyup",this._fnKeyupHandler);d.removeEventListener("touchend",this._fnTouchendHandler);}};b.prototype.onAfterRendering=function(){var d=this.getDomRef();this._fnKeyupHandler=this.onkeyup.bind(this);this._fnTouchendHandler=this.onclick.bind(this);d.addEventListener("keyup",this._fnKeyupHandler,true);d.addEventListener("touchend",this._fnTouchendHandler,true);};b.prototype.onkeyup=function(e){if(this.getEditable()){if((P.events.sapdelete.fnCheck(e)||P.events.sapbackspace.fnCheck(e))){this.firePress({scope:"Actions",action:"Remove"});}if(P.events.sapspace.fnCheck(e)||P.events.sapenter.fnCheck(e)){this._preventDefault(e);}}};b.prototype._preventDefault=function(e){if(this.getEditable()){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();return false;}return true;};b.prototype.load=function(){return Promise.resolve();};b.prototype._setSize=function(){var s={};switch(this.getDisplayFormat()){case D.Flat:s.width=2;s.height=1;break;case D.FlatWide:s.width=4;s.height=1;break;case D.StandardWide:s.width=4;s.height=2;break;default:s.width=2;s.height=2;break;}this.setWidth(s.width);this.setHeight(s.height);};b.prototype.getAvailableDisplayFormats=function(){var c,s=this.getSupportedDisplayFormats(),d=this.getDisplayFormat();c=s.filter(function(f){return f!==d;});var i=c.indexOf("compact");var t=this.getTitle();var e=this.getTargetURL();if(i>-1&&(!t||!e)){c.splice(i,1);}return c;};b.prototype._getRemoveIconVBox=function(){if(!this._oRemoveIconVBox){var M=sap.ui.getCore().getLibraryResourceBundle("sap.m");var R=new I({id:this.getId()+"-action-remove",alt:M.getText("GENERICTILE_ACTIONS_ARIA_TEXT"),decorative:false,noTabStop:true,src:"sap-icon://decline",tooltip:r.i18n.getText("removeButtonTitle")}).addStyleClass("sapUshellTileDeleteIconInnerClass sapMPointer");this._oRemoveIconVBox=new a({items:[R]}).addStyleClass("sapUshellTileDeleteIconOuterClass sapUshellTileDeleteClickArea sapMPointer");this._oRemoveIconVBox.setParent(this);}return this._oRemoveIconVBox;};b.prototype._getActionDivCenter=function(){if(!this._oActionDivCenter){this._oActionDivCenter=new a().addStyleClass("sapUshellTileActionDivCenter");this._oActionDivCenter.attachBrowserEvent("click",this._onActionMenuIconPressed,this);this._oActionDivCenter.setParent(this);}return this._oActionDivCenter;};b.prototype._getActionModeButtonIconVBox=function(){if(!this._oActionModeButtonIconVBox){var M=sap.ui.getCore().getLibraryResourceBundle("sap.m");this._oActionModeIcon=new I({id:this.getId()+"-action-more",decorative:false,alt:M.getText("LIST_ITEM_NAVIGATION"),noTabStop:true,press:[this._onActionMenuIconPressed,this],src:"sap-icon://overflow",tooltip:r.i18n.getText("configuration.category.tile_actions")}).addStyleClass("sapUshellTileActionIconDivBottomInner sapMPointer");this._oActionModeButtonIconVBox=new a({items:[this._oActionModeIcon]}).addStyleClass("sapUshellTileActionIconDivBottom sapMPointer");this._oActionModeButtonIconVBox.setParent(this);}return this._oActionModeButtonIconVBox;};return b;});
