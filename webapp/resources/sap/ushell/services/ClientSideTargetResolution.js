// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/base/util/isPlainObject","sap/base/util/ObjectPath","sap/base/util/extend","sap/ushell/ApplicationType","sap/ushell/Config","sap/ushell/navigationMode","sap/ushell/services/_ClientSideTargetResolution/Formatter","sap/ushell/services/_ClientSideTargetResolution/InboundIndex","sap/ushell/services/_ClientSideTargetResolution/InboundProvider","sap/ushell/services/_ClientSideTargetResolution/ParameterMapping","sap/ushell/services/_ClientSideTargetResolution/PrelaunchOperations","sap/ushell/services/_ClientSideTargetResolution/Search","sap/ushell/services/_ClientSideTargetResolution/StagedLogger","sap/ushell/services/_ClientSideTargetResolution/SystemContext","sap/ushell/services/_ClientSideTargetResolution/Utils","sap/ushell/services/_ClientSideTargetResolution/VirtualInbounds","sap/ushell/services/_ClientSideTargetResolution/XAppStateProcessing","sap/ushell/services/AppConfiguration","sap/ushell/TechnicalParameters","sap/ushell/utils","sap/ushell/utils/UrlParsing"],function(L,i,O,E,A,C,N,_,a,b,c,d,f,g,h,j,k,l,m,T,U,n){"use strict";function p(o,e,P,s){this._init.apply(this,arguments);}p.prototype._init=function(o,e,P,s){this._iLogId=0;if(!this._implementsServiceInterface(o)){L.error("Cannot get Inbounds","ClientSideTargetResolutionAdapter should implement getInbounds method","sap.ushell.services.ClientSideTargetResolution");return;}this._oInboundProvider=new b(o.getInbounds.bind(o));this._oHaveEasyAccessSystemsDeferreds={userMenu:null,sapMenu:null};this._oServiceConfiguration=s;this._oAdapter=o;};p.prototype._implementsServiceInterface=function(o){if(typeof o.getInbounds==="function"){return true;}return false;};p.prototype._extractInboundFilter=function(o){if(!this._oAdapter.hasSegmentedAccess){return undefined;}if(typeof o!=="string"){return undefined;}var F=o.indexOf("#")===0?o:"#"+o;var s=n.parseShellHash(F);if(!s||!s.semanticObject||!s.action){return undefined;}return[{semanticObject:s.semanticObject,action:s.action}];};p.prototype.resolveHashFragment=function(H){var t=this,D=new jQuery.Deferred(),B=this._oAdapter.resolveHashFragmentFallback&&this._oAdapter.resolveHashFragmentFallback.bind(this._oAdapter),s=this._extractInboundFilter(H);this._oInboundProvider.getInbounds(s).then(function(I){t._resolveHashFragment(H,B,I).done(function(o){return D.resolve(o);}).fail(D.reject.bind(D));},function(){D.reject.apply(D,arguments);});return D.promise();};p.prototype.resolveTileIntent=function(H){var t=this,D=new jQuery.Deferred(),s=this._extractInboundFilter(H);this._oInboundProvider.getInbounds(s).then(function(I){t._resolveTileIntent(H,undefined,I).done(D.resolve.bind(D)).fail(D.reject.bind(D));},function(){D.reject.apply(D,arguments);});return D.promise();};p.prototype.resolveTileIntentInContext=function(I,H){var o,D=new jQuery.Deferred();o=a.createIndex(I.concat(k.getInbounds()));this._resolveTileIntent(H,undefined,o).done(D.resolve.bind(D)).fail(D.reject.bind(D));return D.promise();};p.prototype._resolveHashFragment=function(H,B,I){var t=this,D=new jQuery.Deferred(),F=H.indexOf("#")===0?H:"#"+H,s=n.parseShellHash(F);if(s===undefined){L.error("Could not parse shell hash '"+H+"'","please specify a valid shell hash","sap.ushell.services.ClientSideTargetResolution");return D.reject().promise();}s.formFactor=U.getFormFactor();this._getMatchingInbounds(s,I,{bExcludeTileInbounds:true}).fail(function(e){L.error("Could not resolve "+H,"_getMatchingInbounds promise rejected with: "+e,"sap.ushell.services.ClientSideTargetResolution");D.reject(e);}).done(function(M){var e;if(M.length===0){L.warning("Could not resolve "+H,"rejecting promise","sap.ushell.services.ClientSideTargetResolution");D.reject("Could not resolve navigation target");return;}M=t._applySapNavigationScopeFilter(M,s);e=M[0];if(L.getLevel()>=L.Level.DEBUG){var u=function(K,v){return(this[K]===undefined)?"<undefined>":v;};var r=function(o,v){return(o==="_original")?undefined:u.call(this,o,v);};var q=JSON.stringify(e,r,"   ");L.debug("The following target will now be resolved",q,"sap.ushell.services.ClientSideTargetResolution");}t._resolveSingleMatchingTarget(e,B,F).done(function(o){D.resolve(o);}).fail(D.reject.bind(D));});return D.promise();};p.prototype._applySapNavigationScopeFilter=function(M,s){var S=s&&s.params&&s.params["sap-navigation-scope-filter"];if(!S){return M;}var F=M.filter(function(o){var e=O.get("inbound.signature.parameters",o);var q=e&&e["sap-navigation-scope"];if(q){return S[0]===q.defaultValue.value;}return undefined;});return F.length>0?F:M;};p.prototype._resolveSingleMatchingTarget=function(M,B,F){var t=this,D=new jQuery.Deferred(),I=n.parseShellHash(F),s=[I.semanticObject,I.action].join("-"),e=(M.inbound.resolutionResult||{}).applicationType;var o;if(this._oAdapter.resolveSystemAlias){o=this._oAdapter.resolveSystemAlias.bind(this._oAdapter);}var H=!!M.inbound.templateContext;var q=A.getEasyAccessMenuResolver(s,e);if(q&&!H){q(I,M,o,A.WDA.enableWdaCompatibilityMode).then(function(R){var u=N.compute(O.get("inbound.resolutionResult.applicationType",M),(M.intentParamsPlusAllDefaults["sap-ushell-next-navmode"]||[])[0],(M.intentParamsPlusAllDefaults["sap-ushell-navmode"]||[])[0],(m.getCurrentApplication()||{}).applicationType,C.last("/core/navigation/enableInPlaceForClassicUIs"));U.shallowMergeObject(R,u);R.inboundPermanentKey=M.inbound.permanentKey||M.inbound.id;D.resolve(R);},function(u){D.reject(u);});return D.promise();}var r=this._getReservedParameters(M);c.mapParameterNamesAndRemoveObjects(M);sap.ushell.Container.getServiceAsync("AppState").then(function(u){l.mixAppStateIntoResolutionResultAndRename(M,u).done(function(M){var R=function(){return t._constructFallbackResolutionResult.call(t,M,B,F);};if(A[e]){R=A[e].generateResolutionResult;}delete M.intentParamsPlusAllDefaults["sap-tag"];delete M.mappedIntentParamsPlusSimpleDefaults["sap-tag"];M.mappedDefaultedParamNames=M.mappedDefaultedParamNames.filter(function(P){return P!=="sap-tag";});var v=O.get("inbound.resolutionResult.url",M);d.executePrelaunchOperations(M,r["sap-prelaunch-operations"]).then(function(){return R(M,v,o);}).then(function(w){w.reservedParameters=r;w.inboundPermanentKey=M.inbound.permanentKey||M.inbound.id;return w;}).then(function(w){L.debug("Intent was resolved to the following target",JSON.stringify(M.resolutionResult,null,3),"sap.ushell.services.ClientSideTargetResolution");U.shallowMergeObject(M.resolutionResult,w);D.resolve(M.resolutionResult);},function(w){if(typeof w==="string"&&w.indexOf("fallback:")>=0){t._constructFallbackResolutionResult.call(this,M,B,F).then(function(x){U.shallowMergeObject(M.resolutionResult,x);D.resolve(M.resolutionResult);},D.reject.bind(D));}else{D.reject(w);}});});});return D.promise();};p.prototype._getReservedParameters=function(M){var r=T.getParameters({injectFrom:"startupParameter"}).map(function(P){return P.name;});var R=j.extractParameters(r,M.intentParamsPlusAllDefaults);T.getParameters({injectFrom:"inboundParameter"}).forEach(function(P){var s=P.name;var S=M.inbound&&M.inbound.signature&&M.inbound.signature.parameters;if(S&&Object.keys(S).length>0){var o=S[s];var I=o&&o.defaultValue&&o.defaultValue.hasOwnProperty("value");var e=o&&o.filter&&o.filter.hasOwnProperty("value");if(o&&(e||I)){if(I){R[s]=o.defaultValue.value;}else{R[s]=o.filter.value;}}else{delete R[s];}delete M.intentParamsPlusAllDefaults[s];var q=M.defaultedParamNames.indexOf(s);if(q>=0){M.defaultedParamNames.splice(q,1);}}});return R;};p.prototype._resolveTileIntent=function(H,B,I){var t=this,D=new jQuery.Deferred(),F=H.indexOf("#")===0?H:"#"+H,s=n.parseShellHash(F);if(s===undefined){L.error("Could not parse shell hash '"+H+"'","please specify a valid shell hash","sap.ushell.services.ClientSideTargetResolution");return D.reject("Cannot parse shell hash").promise();}s.formFactor=U.getFormFactor();this._getMatchingInbounds(s,I,{bExcludeTileInbounds:false}).fail(function(e){L.error("Could not resolve "+H,"_getMatchingInbounds promise rejected with: "+e,"sap.ushell.services.ClientSideTargetResolution");D.reject(e);}).done(function(M){var o;if(M.length===0){L.warning("Could not resolve "+H,"no matching targets were found","sap.ushell.services.ClientSideTargetResolution");D.reject("No matching targets found");return;}o=M[0];t._resolveSingleMatchingTileIntent(o,B,F).done(D.resolve.bind(D)).fail(D.reject.bind(D));});return D.promise();};p.prototype._resolveSingleMatchingTileIntent=function(M,B,F){var D=new jQuery.Deferred(),s=(M.inbound.resolutionResult||{}).applicationType,t=this;var e;if(this._oAdapter.resolveSystemAlias){e=this._oAdapter.resolveSystemAlias.bind(this._oAdapter);}c.mapParameterNamesAndRemoveObjects(M);sap.ushell.Container.getServiceAsync("AppState").then(function(o){l.mixAppStateIntoResolutionResultAndRename(M,o).done(function(M){var r=function(){return t._constructFallbackResolutionResult.call(t,M,B,F);};if(A[s]){r=A[s].generateResolutionResult;}delete M.intentParamsPlusAllDefaults["sap-tag"];delete M.mappedIntentParamsPlusSimpleDefaults["sap-tag"];M.mappedDefaultedParamNames=M.mappedDefaultedParamNames.filter(function(P){return P!=="sap-tag";});var q=O.get("inbound.resolutionResult.url",M);r(M,q,e).then(function(R){U.shallowMergeObject(M.resolutionResult,R);var u=E({},M.inbound.tileResolutionResult);u.startupParameters=M.effectiveParameters;u.navigationMode=M.resolutionResult.navigationMode;if(!u.navigationMode){u.navigationMode=N.getNavigationMode(M.resolutionResult);}D.resolve(u);L.debug("Tile Intent was resolved to the following target",JSON.stringify(u,null,3),"sap.ushell.services.ClientSideTargetResolution");},function(u){D.reject(u);});});});return D.promise();};p.prototype._constructFallbackResolutionResult=function(M,B,F){var e={},D;Object.keys(M.intentParamsPlusAllDefaults).forEach(function(P){if(Array.isArray(M.intentParamsPlusAllDefaults[P])){e[P]=M.intentParamsPlusAllDefaults[P];}});D=M.mappedDefaultedParamNames||M.defaultedParamNames;if(D.length>0){e["sap-ushell-defaultedParameterNames"]=[JSON.stringify(D)];}if(typeof B!=="function"){L.error("Cannot resolve hash fragment",F+" has matched an inbound that cannot be resolved client side and no resolveHashFragmentFallback method was implemented in ClientSideTargetResolutionAdapter","sap.ushell.services.ClientSideTargetResolution");return Promise.reject("Cannot resolve hash fragment: no fallback provided.");}L.warning("Cannot resolve hash fragment client side",F+" has matched an inbound that cannot be resolved client side. Using fallback logic","sap.ushell.services.ClientSideTargetResolution");return new Promise(function(r,R){B(F,E({},M.inbound),e).done(function(o){var q={};["applicationType","additionalInformation","url","applicationDependencies","text"].forEach(function(P){if(o.hasOwnProperty(P)){q[P]=o[P];}});r(q);}).fail(R.bind(null));});};p.prototype.getDistinctSemanticObjects=function(){var D=new jQuery.Deferred();this._oInboundProvider.getInbounds().then(function(I){var s={};I.getAllInbounds().forEach(function(o){if(typeof o.semanticObject==="string"&&o.semanticObject!=="*"&&!o.hideIntentLink&&o.semanticObject.length>0){s[o.semanticObject]=true;}});D.resolve(Object.keys(s).sort());},function(){D.reject.apply(D,arguments);});return D.promise();};p.prototype.getLinks=function(o){var e,t=this,s,P,I,D=new jQuery.Deferred(),q;if(arguments.length===1&&i(arguments[0])){e=arguments[0];q=E({},e);["action","semanticObject"].forEach(function(r){if(e.hasOwnProperty(r)){q[r]=e[r];}});if(q.appStateKey){q.params=q.params||{};q.params["sap-xapp-state"]=[q.appStateKey];delete q.appStateKey;}}else if(arguments.length<=3){L.warning("Passing positional arguments to getLinks is deprecated","Please use nominal arguments instead","sap.ushell.services.ClientSideTargetResolution");s=arguments[0];P=arguments[1];I=arguments[2];q={semanticObject:s,params:P,ignoreFormFactor:I};}else{return D.reject("invalid arguments for getLinks").promise();}this._oInboundProvider.getInbounds().then(function(r){t._getLinks(q,r).done(D.resolve.bind(D)).fail(D.reject.bind(D));},function(){D.reject.apply(D,arguments);});return D.promise();};p.prototype._validateGetSemanticObjectLinksArgs=function(o){var s=o.semanticObject,e=o.action,I=!o.hasOwnProperty("action");if(typeof s!=="undefined"||I){if(typeof s!=="string"){L.error("invalid input for _getLinks","the semantic object must be a string, got "+Object.prototype.toString.call(s)+" instead","sap.ushell.services.ClientSideTargetResolution");return"invalid semantic object";}if(I&&s.match(/^\s+$/)){L.error("invalid input for _getLinks","the semantic object must be a non-empty string, got '"+s+"' instead","sap.ushell.services.ClientSideTargetResolution");return"invalid semantic object";}if(!I&&s.length===0){L.error("invalid input for _getLinks","the semantic object must not be an empty string, got '"+s+"' instead","sap.ushell.services.ClientSideTargetResolution");return"invalid semantic object";}}if(typeof e!=="undefined"){if(typeof e!=="string"){L.error("invalid input for _getLinks","the action must be a string, got "+Object.prototype.toString.call(e)+" instead","sap.ushell.services.ClientSideTargetResolution");return"invalid action";}if(e.length===0){L.error("invalid input for _getLinks","the action must not be an empty string, got '"+e+"' instead","sap.ushell.services.ClientSideTargetResolution");return"invalid action";}}return undefined;};p.prototype._getLinks=function(o,I){var s=o.semanticObject,e=o.action,P=o.params,w=!!o.withAtLeastOneUsedParam,t=!!o.treatTechHintAsFilter,q=o.ignoreFormFactor,S=o.hasOwnProperty("sortResultsBy")?o.sortResultsBy:"intent";if(o.hasOwnProperty("sortResultOnTexts")){L.warning("the parameter 'sortResultOnTexts' was experimental and is no longer supported","getLinks results will be sorted by '"+S+"'","sap.ushell.services.ClientSideTargetResolution");}var r={bExcludeTileInbounds:true};var u=this._validateGetSemanticObjectLinksArgs(o);if(o.tags){r.tags=o.tags;}if(u){return new jQuery.Deferred().reject(u).promise();}if(s==="*"){return jQuery.when([]);}function v(z){var B=n.paramsToString(z);return B?"?"+B:"";}var D=new jQuery.Deferred(),F=U.getFormFactor(),x=n.parseParameters(v(P)),y={semanticObject:(s===""?undefined:s),action:e,formFactor:(q?undefined:F),params:x};if(t){y.treatTechHintAsFilter=true;}this._getMatchingInbounds(y,I,r).done(function(M){var z={},R=M.map(function(G){var J=s||G.inbound.semanticObject,K="#"+J+"-"+G.inbound.action,Q;if(J==="*"){return undefined;}if(G.inbound.action==="*"){return undefined;}if(G.inbound&&G.inbound.hasOwnProperty("hideIntentLink")&&G.inbound.hideIntentLink===true){return undefined;}if(!z.hasOwnProperty(K)){z[K]={matchingInbound:G.inbound,count:1};if(G.inbound.signature.additionalParameters==="ignored"){Q=j.filterObjectKeys(x,function(Z){return(Z.indexOf("sap-")===0)||G.inbound.signature.parameters.hasOwnProperty(Z);},false);}else{Q=x;}if(w){var V=Object.keys(Q).some(function(Z){return Z.indexOf("sap-")!==0;});if(!V){z[K].hideReason="getLinks called with 'withAtLeastOneUsedParam = true', but the inbound had no business parameters defined.";return undefined;}}var W=j.inboundSignatureMeetsParameterOptions(G.inbound.signature.parameters,o.paramsOptions||[]);if(!W){z[K].hideReason="inbound signature does not meet the requested parameter filter options";return undefined;}var X={intent:K+v(Q),text:G.inbound.title};if(G.inbound.icon){X.icon=G.inbound.icon;}if(G.inbound.subTitle){X.subTitle=G.inbound.subTitle;}if(G.inbound.shortTitle){X.shortTitle=G.inbound.shortTitle;}var Y=O.get("inbound.signature.parameters.sap-tag.defaultValue.value",G);if(Y){X.tags=[Y];}return X;}z[K].count++;return undefined;}).filter(function(G){return typeof G==="object";});if(S!=="priority"){R.sort(function(G,J){return G[S]<J[S]?-1:1;});}if(R.length===0){L.debug("_getLinks returned no results");}else if(L.getLevel()>=L.Level.DEBUG){if(L.getLevel()>=L.Level.TRACE){var B=[];var H=[];R.forEach(function(G){var J=G.intent.split("?")[0];if(z[J].hideReason){H.push(["-",J+"("+z[J].hideReason+")\n"," text:",G.text+"\n"," full intent:",G.intent].join(" "));}else{B.push(["-",J,z[J].count>1?"("+(z[J].count-1)+" others matched)\n":"\n","text:",G.text+"\n","full intent:",G.intent].join(" "));}});L.debug("_getLinks filtered to the following unique intents:","\n"+B.join("\n"),"sap.ushell.services.ClientSideTargetResolution");L.debug("_getLinks would have also returned the following unique intents, but something prevented this:",H.join("\n"),"sap.ushell.services.ClientSideTargetResolution");}else{L.debug("_getLinks filtered to unique intents.","Reporting histogram: \n - "+Object.keys(z).join("\n - "),"sap.ushell.services.ClientSideTargetResolution");}}D.resolve(R);}).fail(D.reject.bind(D));return D.promise();};p.prototype._getMatchingInbounds=function(s,I,o){var t=this,e,q,r,u,S,v,P,D=new jQuery.Deferred();if(o){e=o.tags;v=o.bExcludeTileInbounds;}if(L.getLevel()>=L.Level.DEBUG){r=++t._iLogId;}g.begin(function(){function w(M){var y=M.action||(typeof M.action==="undefined"?"<any>":"<invalid-value>");var z=M.semanticObject||(typeof M.semanticObject==="undefined"?"<any>":"<invalid-value>");return n.constructShellHash({semanticObject:z,action:y,params:M.params});}var x=w(s);return{logId:r,title:"Matching Intent '"+x+"' to inbounds (form factor: "+(s.formFactor||"<any>")+")",moduleName:"sap.ushell.services.ClientSideTargetResolution",stages:["STAGE1: Find matching inbounds","STAGE2: Resolve references","STAGE3: Rematch with references","STAGE4: Sort matched targets"]};});S=s.semanticObject;q=s.action;this._oShellHash=s;u=e?I.getSegmentByTags(e):I.getSegment(S,q);if(v){P=u.filter(function(w){return!w.tileResolutionResult||!w.tileResolutionResult.isCustomTile;});}else{P=u;}var G=null;if(this._oAdapter.getContentProviderDataOriginsLookup){G=this._oAdapter.getContentProviderDataOriginsLookup.bind(this._oAdapter);}f.match(s,P,{},G,L.getLevel()>=L.Level.DEBUG).then(function(w){g.log(function(){return{logId:r,stage:1,prefix:"\u2718",lines:Object.keys(w.noMatchReasons||{}).map(function(z){return z+" "+w.noMatchReasons[z];})};});g.log(function(){var z=w.matchResults.map(function(B){return _.formatInbound(B.inbound);});return{logId:r,stage:1,prefix:z.length>0?"\u2705":"\u2718",lines:z.length>0?z:["No inbound was matched"]};});var M={};var x=false;var y=Object.keys(w.missingReferences);y.forEach(function(z){var B=Object.keys(w.missingReferences[z]);x=x||B.length>0;M[z]=B;});y=y.filter(function(z){if(M[z].length>0){return true;}delete M[z];return false;});if(!x){g.log(function(){return{logId:r,stage:2,prefix:"\u2705",line:"No need to resolve references"};});return new jQuery.Deferred().resolve({matchResults:w.matchResults,referencesToInclude:null}).promise();}y.forEach(function(z){g.log(function(){return{logId:r,stage:2,line:"@ Must resolve the following references with contentProviderId = \""+z+"\":",prefix:"\u2022",lines:M[z]};});});var R=new jQuery.Deferred();sap.ushell.Container.getServiceAsync("ReferenceResolver").then(function(z){var B=y.map(function(F){return this.getSystemContext(F);}.bind(this));return Promise.all(B).then(function(F){var H=y.map(function(J,K){return new Promise(function(Q,V){z.resolveReferences(M[J],F[K]).done(Q).fail(V);});});return Promise.all(H);});}.bind(this)).then(function(z){var B={matchResults:w.matchResults,referencesToInclude:{}};y.forEach(function(F,H){var J=z[H];B.referencesToInclude[F]=J;if(Object.keys(J).length>0){g.log(function(){return{logId:r,stage:2,line:"\u2705 resolved references with contentProviderId = \""+F+"\" to the following values:",prefix:"\u2022",lines:Object.keys(J).map(function(K){return K+": '"+J[K]+"'";})};});}});R.resolve(B);}).catch(function(z){g.log(function(){return{logId:r,stage:2,prefix:"\u274c",line:"Failed to resolve references: "+z};});D.resolve([]);});return R.promise();}.bind(this)).then(function(w){var M,x,R=w.referencesToInclude;if(!R){g.log(function(){return{logId:r,stage:3,line:"rematch was skipped (no references to resolve)",prefix:"\u2705"};});return new jQuery.Deferred().resolve(w).promise();}x=w.matchResults;M=x.map(function(y){return y.inbound;});return f.match(s,M,R,G,0).then(function(F){g.log(function(){var x=F.matchResults||[];if(x.length>=1){return{logId:r,stage:3,line:"The following inbounds re-matched:",lines:x.map(function(y){return _.formatInbound(y.inbound);}),prefix:"\u2705"};}return{logId:r,stage:3,line:"No inbounds re-matched",prefix:"-"};});return F;});}).then(function(F){var M=F.matchResults||[];if(M.length<=1){g.log(function(){return{logId:r,stage:4,line:"Nothing to sort"};});D.resolve(M);return;}var w=f.sortMatchingResultsDeterministic(F.matchResults||[]);g.log(function(){var x=w.map(function(y){return _.formatInbound(y.inbound||{})+(y.matchesVirtualInbound?" (virtual)":"")+"\n[ Sort Criteria ] "+"\n * 1 * sap-priority: '"+y["sap-priority"]+"'"+"\n * 2 * Sort string: '"+y.priorityString+"\n * 3 * Deterministic blob: '"+f.serializeMatchingResult(y)+"'";});return{logId:r,stage:4,line:"Sorted inbounds as follows:",lines:x,prefix:".",number:true};});D.resolve(w);});return D.promise().then(function(M){g.end(function(){return{logId:r};});return M;});};p.prototype._isIntentSupportedOne=function(I,o){var D=new jQuery.Deferred(),s=n.parseShellHash(I);if(I==="#"){D.resolve(true);return D.promise();}if(s===undefined){return D.reject("Could not parse shell hash '"+I+"'").promise();}s.formFactor=U.getFormFactor();this._getMatchingInbounds(s,o,{bExcludeTileInbounds:true}).done(function(t){D.resolve(t.length>0);}).fail(function(){D.reject();});return D.promise();};p.prototype.isIntentSupported=function(I){var t=this,D=new jQuery.Deferred();this._oInboundProvider.getInbounds().then(function(o){t._isIntentSupported(I,o).done(D.resolve.bind(D)).fail(D.reject.bind(D));},function(){D.reject.apply(D,arguments);});return D.promise();};p.prototype._isIntentSupported=function(I,o){var t=this,D=new jQuery.Deferred(),s={};D.resolve();function e(q,S){s[q]={supported:S};}var r=[];I.forEach(function(q){var u=t._isIntentSupportedOne(q,o);u.fail(function(v){r.push(v);});u.done(function(v){e(q,v);});D=jQuery.when(D,u);});var R=new jQuery.Deferred();D.done(function(){R.resolve(s);}).fail(function(){R.reject("One or more input intents contain errors: "+r.join(", "));});return R.promise();};p.prototype.getUserDefaultParameterNames=function(s){var t=this,D=new jQuery.Deferred();this._oInboundProvider.getInbounds().then(function(I){t._getUserDefaultParameterNames(I.getAllInbounds(),s).then(function(r){D.resolve(r);},function(e){D.reject("Cannot get user default parameters from inbounds: "+e);});},function(){D.reject.apply(D,arguments);});return D.promise();};p.prototype._getUserDefaultParameterNames=function(I,s){var r={simple:{},extended:{}};I=I.filter(function(o){if(o.contentProviderId===undefined&&s.id===""){return true;}return o.contentProviderId===s.id;});return sap.ushell.Container.getServiceAsync("ReferenceResolver").then(function(R){I.forEach(function(t){var S=t.signature&&t.signature.parameters||[];Object.keys(S).forEach(function(P){var o=S[P],e,q,u;if(o){if(o.filter&&o.filter.format==="reference"){u=o.filter.value;}else if(o.defaultValue&&o.defaultValue.format==="reference"){u=o.defaultValue.value;}if(typeof u==="string"){e=R.extractUserDefaultReferenceName(u);if(typeof e==="string"){r.simple[e]={};}q=R.extractExtendedUserDefaultReferenceName(u);if(typeof q==="string"){r.extended[q]={};}}}});});return r;});};p.prototype.getEasyAccessSystems=function(M){var r={},o,v,D;M=M||"sapMenu";if(this._oHaveEasyAccessSystemsDeferreds[M]){return this._oHaveEasyAccessSystemsDeferreds[M].promise();}this._oHaveEasyAccessSystemsDeferreds[M]=new jQuery.Deferred();D=this._oHaveEasyAccessSystemsDeferreds[M];function e(I,s,v){if(!I){return false;}var q=[I.semanticObject,I.action].join("-");return v[M][q]&&I.deviceTypes&&s!==undefined&&I.deviceTypes[s];}o=A.getEasyAccessMenuDefinitions().reduce(function(R,q){var s=q.easyAccessMenu.intent.split("-")[1];R[s]={appType:q.type,priority:q.easyAccessMenu.systemSelectionPriority};return R;},{});v={userMenu:A.getEasyAccessMenuDefinitions().reduce(function(u,q){var s=q.easyAccessMenu.intent;u[s]=q.easyAccessMenu.showSystemSelectionInUserMenu;return u;},{}),sapMenu:A.getEasyAccessMenuDefinitions().reduce(function(s,q){var t=q.easyAccessMenu.intent;s[t]=q.easyAccessMenu.showSystemSelectionInSapMenu;return s;},{})};this._oInboundProvider.getInbounds().then(function(I){var q={};I.getAllInbounds().filter(function(s){return e(s,U.getFormFactor(),v);}).forEach(function(s){var S;if(i(s.signature.parameters["sap-system"])&&s.signature.parameters["sap-system"].hasOwnProperty("filter")){S=O.get("signature.parameters.sap-system.filter.value",s);}if(typeof S==="string"){var t=o[s.action].priority;var u=o[s.action].appType;if(!r[S]){q[S]=-1;r[S]={appType:{}};}if(q[S]<t){r[S].text=s.title;q[S]=t;}r[S].appType[u]=true;}else{L.warning("Cannot extract sap-system from easy access menu inbound: "+_.formatInbound(s),"This parameter is supposed to be a string. Got '"+S+"' instead.","sap.ushell.services.ClientSideTargetResolution");}});D.resolve(r);},function(){D.reject.apply(D,arguments);});return D.promise();};p.prototype.getSystemContext=function(s){var S=s===undefined?"":s;return new Promise(function(r,e){var o;this._oAdapter.resolveSystemAlias(S).done(function(R){o=h.createSystemContextFromSystemAlias(R);r(o);}).fail(function(q){e(q);});}.bind(this));};p.hasNoAdapter=false;return p;},true);
