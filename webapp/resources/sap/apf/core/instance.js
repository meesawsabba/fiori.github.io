/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(['sap/apf/utils/utils','sap/apf/utils/filter','sap/apf/utils/hashtable','sap/apf/core/utils/checkForTimeout','sap/apf/core/utils/uriGenerator','sap/apf/core/utils/fileExists','sap/apf/core/utils/annotationHandler','sap/apf/core/utils/filter','sap/apf/core/messageHandler','sap/apf/core/path','sap/apf/core/persistence','sap/apf/core/metadataFactory','sap/apf/core/textResourceHandler','sap/apf/core/configurationFactory','sap/apf/core/sessionHandler','sap/apf/core/resourcePathHandler','sap/apf/core/constants','sap/apf/cloudFoundry/analysisPathProxy','sap/apf/cloudFoundry/ajaxHandler','sap/ui/comp/smartfilterbar/ControlConfiguration','sap/apf/core/metadataProperty','sap/apf/core/metadataFacade','sap/apf/core/metadata','sap/apf/core/readRequestByRequiredFilter',"sap/apf/core/ajax","sap/apf/core/odataRequest","sap/apf/core/entityTypeMetadata","sap/apf/core/readRequest","sap/ui/thirdparty/jquery"],function(u,a,H,c,b,F,A,d,M,P,e,f,T,C,S,R,g,h,j,k,l,m,n,o,p,q,r,s,Q){'use strict';f=f||sap.apf.core.MetadataFactory;T=T||sap.apf.core.TextResourceHandler;C=C||sap.apf.core.ConfigurationFactory;S=S||sap.apf.core.SessionHandler;R=R||sap.apf.core.ResourcePathHandler;function I(t){var v=this;var w;var x,y,z;var B=t.instances.messageHandler;var D=t.instances.startParameter;t.constructors=t.constructors||{};var E=(t.functions&&t.functions.checkForTimeout)||c;var G={instances:{messageHandler:B,coreApi:this},constructors:{Request:t.constructors.Request},exits:{binding:{afterGetFilter:t.exits&&t.exits.binding&&t.exits.binding.afterGetFilter},path:{beforeAddingToCumulatedFilter:t.exits&&t.exits.path&&t.exits.path.beforeAddingToCumulatedFilter}},functions:t.functions};var J;var K;var L;var N;var O;var U;var V;var W;var X;var Y;var Z=t&&t.instances&&t.instances.datajs||OData;this.destroy=function(){O.destroy();};this.ajax=function(i){var c1=Q.extend(true,{},i);c1.functions=c1.functions||{};c1.functions.getSapSystem=D.getSapSystem;if(t.functions&&t.functions.ajax){c1.functions.ajax=t.functions.ajax;}c1.instances=c1.instances||{};c1.instances.messageHandler=B;return sap.apf.core.ajax(c1);};this.odataRequest=function(i,c1,d1,e1){var G={instances:{datajs:Z},functions:{getSapSystem:D.getSapSystem}};var f1=(t&&t.functions&&t.functions.odataRequest)||sap.apf.core.odataRequestWrapper;f1(G,i,c1,d1,e1);};this.getStartParameterFacade=function(){return D;};this.getMessageHandler=function(){return B;};this.putMessage=function(i){return B.putMessage(i);};this.check=function(i,c1,d1){return B.check(i,c1,d1);};this.createMessageObject=function(i){return B.createMessageObject(i);};this.activateOnErrorHandling=function(i){B.activateOnErrorHandling(i);};this.setCallbackForMessageHandling=function(i){B.setMessageCallback(i);};this.getLogMessages=function(){return B.getLogMessages();};this.checkForTimeout=function(i){var c1=E(i);if(c1){B.putMessage(c1);}return c1;};this.getUriGenerator=function(){return b;};this.getMetadata=function(i){return K.getMetadata(i);};this.getMetadataFacade=function(){return K.getMetadataFacade();};this.getEntityTypeMetadata=function(i,c1){return K.getEntityTypeMetadata(i,c1);};this.loadApplicationConfig=function(i){J.loadConfigFromFilePath(i);};this.loadTextElements=function(i){L.loadTextElements(i);};this.registerTextWithKey=function(i,c1){L.registerTextWithKey(i,c1);};this.getApplicationConfigProperties=function(){return J.getConfigurationProperties();};this.getResourceLocation=function(i){return J.getResourceLocation(i);};this.getPersistenceConfiguration=function(){return J.getPersistenceConfiguration();};this.getCategories=function(){return N.getCategories();};this.existsConfiguration=function(i){return N.existsConfiguration(i);};this.getStepTemplates=function(){return N.getStepTemplates();};this.getConfigurationObjectById=function(i){return N.getConfigurationById(i);};this.registerSmartFilterBarInstance=function(i){if(!Y){Y=Q.Deferred();}Y.resolve(i);};this.getSmartFilterBarAsPromise=function(){if(!Y){Y=Q.Deferred();}this.getSmartFilterBarConfigurationAsPromise().done(function(i){if(!i){Y.resolve(null);}});return Y;};this.getSmartFilterBarConfigurationAsPromise=function(){return N.getSmartFilterBarConfiguration();};this.getSmartFilterBarPersistenceKey=function(i){return"APF"+N.getConfigHeader().AnalyticalConfiguration+i;};this.getSmartFilterbarDefaultFilterValues=function(){var i=Q.Deferred();var c1=[];t.functions.getCombinedContext().done(function(e1){e1.getProperties().forEach(function(f1){var g1={key:f1,visibleInAdvancedArea:true,defaultFilterValues:d1(e1,f1)};c1.push(new sap.ui.comp.smartfilterbar.ControlConfiguration(g1));});i.resolve(c1);});return i;function d1(e1,f1){var g1=e1.getFilterTermsForProperty(f1);var i=[];g1.forEach(function(h1){var i1=new sap.ui.comp.smartfilterbar.SelectOption({low:h1.getValue(),operator:h1.getOp(),high:h1.getHighValue(),sign:'I'});i.push(i1);});return i;}};this.getReducedCombinedContext=function(){var i=Q.Deferred();t.functions.getCombinedContext().done(function(c1){var d1=v.getSmartFilterBarAsPromise();d1.done(function(e1){if(!e1){i.resolve(c1);return;}var f1=new d(t.instances.messageHandler);var g1=e1.getFilters();g1.forEach(function(h1){f1.addAnd(d.transformUI5FilterToInternal(t.instances.messageHandler,h1));});i.resolve(c1.removeTermsByProperty(f1.getProperties()));});});return i;};this.getFacetFilterConfigurations=function(){return N.getFacetFilterConfigurations();};this.getNavigationTargets=function(){return N.getNavigationTargets();};this.createStep=function(i,c1,d1){var e1;B.check(i!==undefined&&typeof i==="string"&&i.length!==0,"sStepID is  unknown or undefined");e1=N.createStep(i,d1);O.addStep(e1,c1);return e1;};this.getSteps=function(){return O.getSteps();};this.moveStepToPosition=function(i,c1,d1){O.moveStepToPosition(i,c1,d1);};this.updatePath=function(i,c1){O.update(i,c1);};this.removeStep=function(i,c1){O.removeStep(i,c1);};this.resetPath=function(){if(O){O.destroy();}O=new P.constructor(G);};this.stepIsActive=function(i){return O.stepIsActive(i);};this.isApfStateAvailable=function(){return U.isApfStateAvailable();};this.storeApfState=function(){U.storeApfState();};this.restoreApfState=function(){return U.restoreApfState();};this.serialize=function(){var i=O.serialize();v.getSmartFilterBarAsPromise().done(function(c1){if(c1){i.smartFilterBar=c1.fetchVariant();}});return i;};this.deserialize=function(i){if(i.smartFilterBar){if(!Y){Y=Q.Deferred();}Y.done(function(c1){c1._apfOpenPath=true;c1.applyVariant(i.smartFilterBar);c1.clearVariantSelection();c1.fireFilterChange();});}O.deserialize(i);};this.getTextNotHtmlEncoded=function(i,c1){return L.getTextNotHtmlEncoded(i,c1);};this.getTextHtmlEncoded=function(i,c1){return L.getTextHtmlEncoded(i,c1);};this.isInitialTextKey=function(i){return(i===g.textKeyForInitialText);};this.getMessageText=function(i,c1){return L.getMessageText(i,c1);};this.getXsrfToken=function(i){return U.getXsrfToken(i);};this.setDirtyState=function(i){U.setDirtyState(i);};this.isDirty=function(){return U.isDirty();};this.setPathName=function(i){U.setPathName(i);};this.getPathName=function(){return U.getPathName();};this.getCumulativeFilter=function(){return t.functions.getCumulativeFilter();};this.createReadRequest=function(i){var c1=N.createRequest(i);var d1;if(typeof i==='string'){d1=N.getConfigurationById(i);}else{d1=i;}return new sap.apf.core.ReadRequest(G,c1,d1.service,d1.entityType);};this.createReadRequestByRequiredFilter=function(i){var c1=N.createRequest(i);var d1;if(typeof i==='string'){d1=N.getConfigurationById(i);}else{d1=i;}return new o(G,c1,d1.service,d1.entityType);};this.loadMessageConfiguration=function(i,c1){B.loadConfig(i,c1);};this.loadAnalyticalConfiguration=function(i){N.loadConfig(i);};this.savePath=function(i,c1,d1,e1){var f1;var g1;var h1;var i1;if(typeof i==='string'&&typeof c1==='string'&&typeof d1==='function'){f1=i;g1=c1;h1=d1;i1=e1;this.setPathName(g1);V.modifyPath(f1,g1,h1,i1);}else if(typeof i==='string'&&typeof c1==='function'){g1=i;h1=c1;i1=d1;this.setPathName(g1);V.createPath(g1,h1,i1);}else{B.putMessage(B.createMessageObject({code:"5027",aParameters:[i,c1,d1]}));}};this.readPaths=function(i){V.readPaths(i);};this.openPath=function(i,c1){function d1(e1,f1,g1){if(!g1){v.setPathName(e1.path.AnalysisPathName);}c1(e1,f1,g1);}return V.openPath(i,d1);};this.deletePath=function(i,c1){V.deletePath(i,c1);};this.createFilter=function(i){return new a(B,i);};this.getActiveStep=function(){return O.getActiveSteps()[0];};this.getCumulativeFilterUpToActiveStep=function(){return O.getCumulativeFilterUpToActiveStep();};this.setActiveStep=function(c1){O.makeStepActive(c1);var d1=O.getActiveSteps();var i;for(i=0;i<d1.length;++i){O.makeStepInactive(d1[i]);}return O.makeStepActive(c1);};this.createFirstStep=function(i,c1,d1){var e1=false;var f1;f1=v.getStepTemplates();f1.forEach(function(g1){e1=g1.id===i?true:e1;});if(!e1){B.putMessage(B.createMessageObject({code:'5036',aParameters:[i]}));}else{v.createStep(i,d1,c1);}};this.getFunctionCreateRequest=function(){return N.createRequest;};this.getAnnotationsForService=function(i){return W.getAnnotationsForService(i);};this.checkAddStep=function(i){return O.checkAddStep(i);};this.getPathFilterInformation=function(){return O.getFilterInformation();};this.getGenericExit=function(i){if(t&&t.exits&&t.exits[i]&&typeof t.exits[i]==='function'){return t.exits[i];}return undefined;};this.getComponent=function(){return t&&t.instances&&t.instances.component;};L=new((t.constructors.TextResourceHandler)||sap.apf.core.TextResourceHandler)(G);B.setTextResourceHandler(L);if(t.manifests){G.manifests=t.manifests;}X=new((t.constructors.FileExists)||F)({functions:{ajax:v.ajax,getSapSystem:D.getSapSystem}});var $={manifests:t.manifests,functions:{getSapSystem:D.getSapSystem,getComponentNameFromManifest:u.getComponentNameFromManifest,getODataPath:b.getODataPath,getBaseURLOfComponent:b.getBaseURLOfComponent,addRelativeToAbsoluteURL:b.addRelativeToAbsoluteURL},instances:{fileExists:X}};W=new((t.constructors.AnnotationHandler)||A.constructor)($);N=new((t.constructors.ConfigurationFactory)||sap.apf.core.ConfigurationFactory)(G);var _={constructors:{EntityTypeMetadata:sap.apf.core.EntityTypeMetadata,Hashtable:(t.constructors.Hashtable)||H,Metadata:(t.constructors.Metadata)||n,MetadataFacade:(t.constructors.MetadataFacade)||m,MetadataProperty:(t.constructors.MetadataProperty)||l,ODataModel:(t.constructors.ODataModel)||sap.ui.model.odata.v2.ODataModel},instances:{messageHandler:G.instances.messageHandler,coreApi:v,annotationHandler:W},functions:{getServiceDocuments:N.getServiceDocuments,getSapSystem:D.getSapSystem}};K=new(t.constructors.MetadataFactory||sap.apf.core.MetadataFactory)(_);O=new(t.constructors.Path||P.constructor)(G);U=new(t.constructors.SessionHandler||sap.apf.core.SessionHandler)(G);if(t.functions&&t.functions.isUsingCloudFoundryProxy){w=t.functions.isUsingCloudFoundryProxy;}else{w=function(){return false;};}if(w()){x={instances:{messageHandler:B},functions:{coreAjax:this.ajax}};y=(t.constructors.AjaxHandler||sap.apf.cloudFoundry.AjaxHandler);z=new y(x);}var a1={instances:{messageHandler:B,coreApi:this},functions:{getComponentName:t.functions&&t.functions.getComponentName},manifests:t.manifests};if(t.constructors.Persistence){a1.instances.ajaxHandler=z;V=new t.constructors.Persistence(a1);}else if(w()){a1.instances.ajaxHandler=z;V=new sap.apf.cloudFoundry.AnalysisPathProxy(a1);}else{V=new e.constructor(a1);}var b1={instances:{coreApi:v,messageHandler:G.instances.messageHandler,fileExists:X},functions:{checkForTimeout:E,initTextResourceHandlerAsPromise:L.loadResourceModelAsPromise,isUsingCloudFoundryProxy:w},corePromise:t.corePromise,manifests:t.manifests};if(t.constructors&&t.constructors.ProxyForAnalyticalConfiguration){b1.constructors={ProxyForAnalyticalConfiguration:t.constructors.ProxyForAnalyticalConfiguration};}J=new(t.constructors.ResourcePathHandler||sap.apf.core.ResourcePathHandler)(b1);if(t&&t.coreProbe){t.coreProbe({coreApi:this,startParameter:D,resourcePathHandler:J,textResourceHandler:L,configurationFactory:N,path:O,sessionHandler:U,persistence:V,fileExists:X,corePromise:t.corePromise});}}sap.apf=sap.apf||{};sap.apf.core=sap.apf.core||{};sap.apf.core.Instance=I;return{constructor:I};});
