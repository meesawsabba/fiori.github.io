/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/core/ajax","sap/apf/utils/filter","sap/apf/core/constants","sap/ui/model/odata/ODataUtils","sap/ui/thirdparty/jquery"],function(a,f,c,O,q){"use strict";sap.apf.core.SessionHandler=function(i){var b=null;var s=false;var d=false;var e=false;var p='';var x="";var h=new sap.apf.utils.Hashtable(i.instances.messageHandler);var C=i.instances.coreApi;var m=i.instances.messageHandler;if(i&&i.functions&&i.functions.serializeApfState&&typeof i.functions.serializeApfState=='function'){s=i.functions.serializeApfState;}if(i&&i.functions&&i.functions.deserializeApfState&&typeof i.functions.deserializeApfState=='function'){d=i.functions.deserializeApfState;}this.type="sessionHandler";this.ajax=function(S){sap.apf.core.ajax(S);};this.getXsrfToken=function(j){var k=q.Deferred();j=g(j);var l=h.getItem(j);if(l!==undefined&&l!==false){return k.resolve(l);}this.fetchXcsrfToken(j).done(function(x){h.setItem(j,x);k.resolve(x);});return k.promise();};function g(j){var k=C.getStartParameterFacade().getSapSystem();if(k){return sap.ui.model.odata.ODataUtils.setOrigin(j,{force:true,alias:k});}return j;}this.fetchXcsrfToken=function(j){var k=q.Deferred();var l="HEAD";if(h.getItem(j)===false){l="GET";}this.ajax({url:C.getUriGenerator().getAbsolutePath(j),type:l,beforeSend:function(r){r.setRequestHeader("x-csrf-token","Fetch");},success:o.bind(this),error:n.bind(this),async:true});function o(D,S,X){x=X.getResponseHeader("x-csrf-token");if(x!==undefined&&x!==null){k.resolve(x);}if(x===null){x="";k.resolve(x);}}function n(r,S,E){if(r.status===405&&h.getItem(j)!==false){h.setItem(j,false);this.fetchXcsrfToken(j).done(function(x){k.resolve(x);});}else{x="";var M=m.createMessageObject({code:5101,aParameters:[]});m.putMessage(M);k.resolve(x);}}return k.promise();};this.setDirtyState=function(j){e=j;};this.isDirty=function(){return e;};this.setPathName=function(n){if(typeof n!='string'){p='';return;}p=n;};this.getPathName=function(){return p;};this.isApfStateAvailable=function(){if(b===null){return false;}return true;};this.storeApfState=function(){var k=true;if(s){s(undefined,k).done(function(j){b=j;});}};this.restoreApfState=function(){if(this.isApfStateAvailable()&&d){C.resetPath();return d(b);}};};});
