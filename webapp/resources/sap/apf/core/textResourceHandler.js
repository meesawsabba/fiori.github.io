/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/utils/hashtable","sap/ui/thirdparty/jquery","sap/base/security/encodeXML","sap/base/strings/formatMessage"],function(h,q,e,f){"use strict";sap.apf.core.TextResourceHandler=function(I){var m=I.instances.messageHandler;var r;var H=new sap.apf.utils.Hashtable(m);var o=new sap.apf.utils.Hashtable(m);var a=new sap.apf.utils.Hashtable(m);var b={};var R=(I.constructors&&I.constructors.ResourceModel)||sap.ui.model.resource.ResourceModel;var c;this.getTextNotHtmlEncoded=function(l,p){var t;var i;var k;if(typeof l==="string"){i=l;}else{m.check((l!==undefined&&l.kind!==undefined&&l.kind==="text"&&l.key!==undefined),"Error - oLabel is not compatible");i=l.key;}k=JSON.stringify({textKey:i,parameters:p});if(H.hasItem(k)){return H.getItem(k);}t=d(i,p);H.setItem(k,t);return t;};this.getTextHtmlEncoded=function(l,p){return e(this.getTextNotHtmlEncoded(l,p));};this.getMessageText=function(s,p){return g(s,p,false);};this.loadTextElements=function(t){var i,l;l=t.length;for(i=0;i<l;i++){o.setItem(t[i].TextElement,t[i].TextElementDescription);}};this.registerTextWithKey=function(k,t){b[k]=t;};this.loadResourceModelAsPromise=function(A,s,i){var j=q.Deferred();c=new R({bundleUrl:A,async:true});if(s!==undefined&&s!==""){c.enhance({bundleUrl:s,async:true}).then(function(){if(i!==undefined&&i!==""){c.enhance({bundleUrl:i,async:true}).then(function(){c.getResourceBundle().then(function(k){r=k;j.resolve();});});}else{c.getResourceBundle().then(function(k){r=k;j.resolve();});}});}else if(i!==undefined&&i!==""){c.enhance({bundleUrl:i,async:true}).then(function(){c.getResourceBundle().then(function(k){r=k;j.resolve();});});}else{c.getResourceBundle().then(function(k){r=k;j.resolve();});}return j.promise();};function g(k,p,C){if(p&&p.length===0){return r.getText(k,undefined,C);}return r.getText(k,p,C);}function d(k,p){var t;if(k===sap.apf.core.constants.textKeyForInitialText){return"";}else if(b[k]){if(p&&p.length>0){return f(b[k],p);}return b[k];}else if(o.hasItem(k)){t=g(k,p,true);if(typeof t!=="string"||t===k){return o.getItem(k);}return t;}else if(a.hasItem(k)){return a.getItem(k);}t=g(k,p,true);if(typeof t==="string"){return t;}m.putMessage(m.createMessageObject({code:"3001",aParameters:[k],oCallingObject:this}));var i="# text not available: "+k;a.setItem(k,i);return i;}};});
