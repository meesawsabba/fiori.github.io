/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
sap.ui.define(["sap/apf/modeler/core/configurationEditor","sap/apf/utils/hashtable","sap/apf/utils/utils","sap/apf/modeler/core/configurationObjects"],function(c,h,u,a){"use strict";sap.apf.modeler.core.ConfigurationHandler=function(b){var t=this;var m=b.instances.messageHandler;var p=b.instances.persistenceProxy;var C=b.constructors.ConfigurationEditor;var H=b.constructors.Hashtable;var L=b.constructors.LazyLoader;var d=new H(m);var e=new H(m);var l=new H(m);var f=new H(m);var g,j;var k={constructors:{Hashtable:H},instances:{messageHandler:m}};this.exportTexts=function(i){var o=this.getConfiguration(i).AnalyticalConfigurationName;return j.exportTexts(o);};this.getTextPool=function(){return j;};this.setApplicationIdAndContext=function(o,q,T){j=T||j;d=new H(m);var i,r=q.length;for(i=0;i<r;i++){d.setItem(q[i].AnalyticalConfiguration,q[i]);e.setItem(q[i].AnalyticalConfiguration,q[i].AnalyticalConfigurationName);}g=o;};this.getApplicationId=function(){return g;};this.setConfiguration=function(i,o){i.AnalyticalConfiguration=o||n();i.Application=g;d.setItem(i.AnalyticalConfiguration,i);return i.AnalyticalConfiguration;};this.getList=function(){var i=[];var o=function(q,r){i.push(r);};d.each(o);return i;};this.getConfiguration=function(i){return d.getItem(i);};this.loadConfiguration=function(i,o){var q,r=i.id||i;if(!i.updateExisting){q=l.getItem(r);}if(!q){q=new L(k,v);l.setItem(r,q);}q.asyncGetInstance(r,s);function s(w,x,y){o(w,x);}function v(r,w,x){var y={instances:{coreApi:b.instances.coreApi,messageHandler:m,configurationHandler:t,persistenceProxy:p,textPool:j,metadataFactory:b.instances.metadataFactory},constructors:{Hashtable:H,Step:b.constructors.Step,HierarchicalStep:b.constructors.HierarchicalStep,SmartFilterBar:b.constructors.SmartFilterBar,FacetFilter:b.constructors.FacetFilter,NavigationTarget:b.constructors.NavigationTarget,Representation:b.constructors.Representation,ConfigurationObjects:b.constructors.ConfigurationObjects,ElementContainer:b.constructors.ElementContainer,ConfigurationFactory:b.constructors.ConfigurationFactory,RegistryProbe:b.constructors.RegistryProbe}};new C(i,y,function(z,A){w(r,z,A);});}};this.resetConfiguration=function(i){var o;if(l.hasItem(i)){o=d.getItem(i);o.AnalyticalConfigurationName=e.getItem(i);l.removeItem(i);return i;}};this.updateConfigurationName=function(i,o){e.setItem(i,o);};this.copyConfiguration=function(i,o){var q=this.getConfiguration(i);if(!q){o(null);return;}t.loadConfiguration(i,r);function r(s){var v,w,x,y;y=sap.apf.modeler.core.ConfigurationObjects.deepDataCopy(q);v=n();y.AnalyticalConfiguration=v;t.setConfiguration(y,v);w=s.copy(v);x=new L(k,undefined,{id:v,instance:w});l.setItem(v,x);o(v);}};this.replaceConfigurationId=function(i,s){if(i.indexOf("apf1972-")===0){var o=d.getItem(i);var q=l.getItem(i).getInstance();var r=new L(k,undefined,{id:s,instance:q});o.AnalyticalConfiguration=s;d.setItem(s,o);e.setItem(s,o.AnalyticalConfigurationName);d.removeItem(i);l.setItem(s,r);l.removeItem(i);}};this.exportConfiguration=function(i,o){var q;this.loadConfiguration(i,r);function r(s){if(!s.isSaved()){m.putMessage(m.createMessageObject({code:"11007",aParameters:[i]}));o(null);}else{var v=b.functions.getApplication(g);var w=t.getConfiguration(i).AnalyticalConfigurationName;q=s.serialize();q.configHeader={Application:g,ApplicationName:v.ApplicationName,SemanticObject:v.SemanticObject,AnalyticalConfiguration:i,AnalyticalConfigurationName:w,UI5Version:sap.ui.version};p.readEntity("configuration",function(x,y,z){if(z){m.putMessage(m.createMessageObject({code:"5022",aParameters:[i]}));o(null);}else{q.configHeader.CreationUTCDateTime=x.CreationUTCDateTime;q.configHeader.LastChangeUTCDateTime=x.LastChangeUTCDateTime;q=JSON.stringify(q,null,'\t');o(q,w);}},[{name:"AnalyticalConfiguration",value:i}],["CreationUTCDateTime","LastChangeUTCDateTime"],g);}}};this.memorizeConfiguration=function(i){var o,q;q=l.getItem(i);if(!q){return null;}o=q.getInstance();if(o){f.setItem(i,o.copy(i));return i;}return null;};this.restoreMemorizedConfiguration=function(i){var o,q;q=f.removeItem(i);if(q){o=new L(k,undefined,{id:i,instance:q});l.setItem(i,o);return q;}return null;};this.removeConfiguration=function(i,r){function o(q,s){if(!s){d.removeItem(i);l.removeItem(i);}r(i,q,s);}if(i.indexOf("apf1972-")!==0){p.remove("configuration",[{name:"AnalyticalConfiguration",value:i}],o,undefined,g);}else{d.removeItem(i);l.removeItem(i);r(i,undefined,undefined);}};this.removeAllConfigurations=function(){d=new H(m);};function n(){return"apf1972-"+(sap.apf.utils.createPseudoGuid(32));}};});
