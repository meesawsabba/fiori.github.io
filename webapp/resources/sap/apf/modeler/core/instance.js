/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
sap.ui.define(["sap/ui/thirdparty/datajs","sap/apf/utils/hashtable","sap/apf/core/constants","sap/apf/core/messageHandler","sap/apf/core/sessionHandler","sap/apf/core/representationTypes","sap/apf/core/entityTypeMetadata","sap/apf/core/configurationFactory","sap/apf/core/utils/uriGenerator","sap/apf/core/metadata","sap/apf/core/metadataFacade","sap/apf/core/metadataProperty","sap/apf/core/messageDefinition","sap/apf/core/metadataFactory","sap/apf/core/odataProxy","sap/apf/cloudFoundry/modelerProxy","sap/apf/cloudFoundry/ajaxHandler","sap/apf/utils/proxyTextHandlerForLocalTexts","sap/apf/core/ajax","sap/apf/core/odataRequest","sap/apf/modeler/core/messageDefinition","sap/apf/modeler/core/textHandler","sap/apf/modeler/core/textPool","sap/apf/modeler/core/applicationHandler","sap/apf/modeler/core/configurationHandler","sap/apf/modeler/core/configurationEditor","sap/apf/modeler/core/step","sap/apf/modeler/core/hierarchicalStep","sap/apf/modeler/core/smartFilterBar","sap/apf/modeler/core/facetFilter","sap/apf/modeler/core/navigationTarget","sap/apf/modeler/core/elementContainer","sap/apf/modeler/core/representation","sap/apf/modeler/core/configurationObjects","sap/apf/utils/parseTextPropertyFile","sap/apf/modeler/core/lazyLoader","sap/apf/modeler/core/registryWrapper","sap/apf/utils/startParameter","sap/apf/core/utils/fileExists","sap/apf/core/utils/annotationHandler","sap/ui/thirdparty/jquery"],function(d,h,c,m,s,r,e,a,u,b,f,g,j,k,o,l,n,p,q,t,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,Q){"use strict";sap.apf.modeler.core.Instance=function(P,R){var S=this;var T,U,V,W,X,Y,Z,$,_,a1,b1,c1,d1,e1,f1,g1,h1,i1,j1,k1,l1,m1,n1,o1,p1,w,m,s,M,q1,k,r1,s1,t1,u1,v1,w1,x1,y1,z1,A1,B1;var C1=[];var D1;var d;T=(R&&R.constructors&&R.constructors.ApplicationHandler)||sap.apf.modeler.core.ApplicationHandler;V=(R&&R.constructors&&R.constructors.ConfigurationHandler)||sap.apf.modeler.core.ConfigurationHandler;W=(R&&R.constructors&&R.constructors.ConfigurationEditor)||sap.apf.modeler.core.ConfigurationEditor;X=(R&&R.constructors&&R.constructors.ConfigurationObjects)||sap.apf.modeler.core.ConfigurationObjects;Y=(R&&R.constructors&&R.constructors.ConfigurationFactory)||sap.apf.core.ConfigurationFactory;d1=(R&&R.constructors&&R.constructors.ElementContainer)||sap.apf.modeler.core.ElementContainer;Z=(R&&R.constructors&&R.constructors.Step)||sap.apf.modeler.core.Step;$=(R&&R.constructors&&R.constructors.HierarchicalStep)||sap.apf.modeler.core.HierarchicalStep;_=(R&&R.constructors&&R.constructors.SmartFilterBar)||sap.apf.modeler.core.SmartFilterBar;a1=(R&&R.constructors&&R.constructors.FacetFilter)||sap.apf.modeler.core.FacetFilter;b1=(R&&R.constructors&&R.constructors.NavigationTarget)||sap.apf.modeler.core.NavigationTarget;c1=(R&&R.constructors&&R.constructors.Representation)||sap.apf.modeler.core.Representation;f1=(R&&R.constructors&&R.constructors.Hashtable)||sap.apf.utils.Hashtable;g1=(R&&R.constructors&&R.constructors.RegistryProbe)||sap.apf.modeler.core.RegistryWrapper;m1=(R&&R.constructors&&R.constructors.LazyLoader)||sap.apf.modeler.core.LazyLoader;h1=(R&&R.constructors&&R.constructors.Metadata)||sap.apf.core.Metadata;i1=(R&&R.constructors&&R.constructors.EntityTypeMetadata)||sap.apf.core.EntityTypeMetadata;j1=(R&&R.constructors&&R.constructors.MetadataFacade)||sap.apf.core.MetadataFacade;k1=(R&&R.constructors&&R.constructors.MetadataProperty)||sap.apf.core.MetadataProperty;l1=(R&&R.constructors&&R.constructors.MetadataFactory)||sap.apf.core.MetadataFactory;n1=(R&&R.constructors&&R.constructors.StartParameter)||sap.apf.utils.StartParameter;o1=(R&&R.constructors&&R.constructors.AnnotationHandler)||sap.apf.core.utils.AnnotationHandler;e1=(R&&R.constructors&&R.constructors.FileExists)||sap.apf.core.utils.FileExists;p1=(R&&R.constructors&&R.constructors.ProxyTextHandlerForLocalTexts)||sap.apf.utils.ProxyTextHandlerForLocalTexts;U=(R&&R.constructors&&R.constructors.AjaxHandler||sap.apf.cloudFoundry.AjaxHandler);d=(R&&R.instances&&R.instances.datajs)||OData;if(R&&R.constructors&&R.constructors.TextHandler){w=new R.constructors.TextHandler();}else{w=new sap.apf.modeler.core.TextHandler();}if(R&&R.constructors&&R.constructors.MessageHandler){m=new R.constructors.MessageHandler(true);}else{m=new sap.apf.core.MessageHandler(true);}m.activateOnErrorHandling(true);m.loadConfig(sap.apf.core.messageDefinition);m.loadConfig(sap.apf.modeler.core.messageDefinition);m.setTextResourceHandler(w);if(R&&R.instances&&R.instances.component){B1={};B1.baseManifest=sap.apf.modeler.Component.prototype.getMetadata().getManifest();B1.manifest=Q.extend({},true,R.instances.component.getMetadata().getManifest());}M=new n1(R&&R.instances&&R.instances.component,B1);this.getStartParameterFacade=function(){return M;};this.ajax=function(i){var J1=Q.extend(true,{},i);J1.functions=J1.functions||{};J1.functions.getSapSystem=M.getSapSystem;if(R&&R.functions&&R.functions.ajax){J1.functions.ajax=R.functions.ajax;}J1.instances={messageHandler:m};return sap.apf.core.ajax(J1);};var p=new p1({instances:{messageHandler:m}});r1={manifests:B1,instances:{messageHandler:m,coreApi:this,proxyTextHandlerForLocalTexts:p}};var E1=R&&R.functions&&R.functions.isUsingCloudFoundryProxy&&R.functions.isUsingCloudFoundryProxy();if(E1){t1={instances:{messageHandler:m},functions:{coreAjax:this.ajax}};r1.instances.ajaxHandler=new U(t1);}if(R&&R.constructors&&R.constructors.PersistenceProxy){q1=new R.constructors.PersistenceProxy(P,r1);}else{if(E1){q1=new sap.apf.cloudFoundry.modelerProxy.ModelerProxy(P,r1);}else if(B1&&B1.manifest["sap.apf"]&&B1.manifest["sap.apf"].activateLrep){q1=new sap.apf.core.LayeredRepositoryProxy(P,r1);}else{q1=new sap.apf.core.OdataProxy(P,r1);}}if(R&&R.constructors&&R.constructors.SessionHandler){s=new R.constructors.SessionHandler(r1);}else{s=new sap.apf.core.SessionHandler(r1);}var F1={functions:{getSapSystem:M.getSapSystem,getComponentNameFromManifest:sap.apf.utils.getComponentNameFromManifest,getODataPath:sap.apf.core.utils.uriGenerator.getODataPath,getBaseURLOfComponent:sap.apf.core.utils.uriGenerator.getBaseURLOfComponent,addRelativeToAbsoluteURL:sap.apf.core.utils.uriGenerator.addRelativeToAbsoluteURL},instances:{fileExists:new e1({functions:{ajax:this.ajax,getSapSystem:M.getSapSystem}})}};var O=new o1(F1);s1={constructors:{EntityTypeMetadata:i1,Hashtable:f1,Metadata:h1,MetadataFacade:j1,MetadataProperty:k1},functions:{getServiceDocuments:function(){return[P.serviceRoot];},getSapSystem:M.getSapSystem},instances:{messageHandler:m,coreApi:S,annotationHandler:O},deactivateFatalError:true};k=new l1(s1);u1={constructors:{Hashtable:f1},instances:{messageHandler:m}};this.getCatalogServiceUri=R&&R.functions&&R.functions.getCatalogServiceUri;v1=(R&&R.functions&&R.functions.odataRequestWrapper)||sap.apf.core.odataRequestWrapper;this.odataRequest=function(i,J1,K1,L1){var M1={instances:{datajs:d},functions:{getSapSystem:M.getSapSystem}};v1(M1,i,J1,K1,L1);};this.checkForTimeout=function(i){var J1=sap.apf.core.utils.checkForTimeout(i);if(J1){m.putMessage(J1);}return J1;};this.getEntityTypeMetadataAsPromise=function(i,J1){return k.getEntityTypeMetadata(i,J1);};this.getEntityTypeMetadata=this.getEntityTypeMetadataAsPromise;this.getXsrfToken=function(i){return s.getXsrfToken(i);};this.getUriGenerator=function(){return sap.apf.core.utils.uriGenerator;};this.getText=function(i,J1){return w.getText(i,J1);};this.putMessage=function(i){return m.putMessage(i);};this.check=function(i,J1,K1){return m.check(i,J1,K1);};this.createMessageObject=function(i){return m.createMessageObject(i);};this.setCallbackForMessageHandling=function(i){m.setMessageCallback(i);};this.isUsingCloudFoundryProxy=function(){return E1||false;};this.isVendorContentAvailable=function(){if(M.isLrepActive()||(E1&&this.getGenericExit("hasVendorContent")&&this.getGenericExit("hasVendorContent")())){return true;}return false;};this.importConfigurationFromVendorLayer=function(i,J1,K1,L1){if(E1){this.getApplicationHandler(function(y,M1){if(M1){L1(undefined,undefined,M1);return;}q1.importVendorContent(i,J1,K1,L1,y.registerApplicationCreatedOnServer);});}else{G1(i,J1,K1,L1);}};function G1(J1,K1,L1,M1){var N1;q1.readAllConfigurationsFromVendorLayer().then(function(U1){var V1=J1+'.'+K1;var i;for(i=0;i<U1.length;i++){if(U1[i].value===V1){N1=U1[i].applicationText;break;}}S.getApplicationHandler(O1);});function O1(y,i){if(i){M1(undefined,undefined,i);return;}var U1=false;var V1=y.getApplication(J1);if(!V1){U1=true;}var W1={ApplicationName:N1};y.setAndSave(W1,P1,J1,U1);}function P1(i,b,U1){if(U1){M1(K1,undefined,U1);return;}Q1();}function Q1(){var i=new sap.apf.core.utils.Filter(m,'Language','eq',sap.apf.core.constants.developmentLanguage);var U1=new sap.apf.core.utils.Filter(m,'Application','eq',J1);U1.addAnd(i);q1.readCollection("texts",R1,undefined,undefined,U1,{layer:"VENDOR"});}function R1(i,b,U1){if(U1){M1(K1,undefined,U1);return;}H1(i,J1,S1);}function S1(i){if(i){M1(K1,undefined,i);return;}q1.readEntity("configuration",T1,[{value:K1}],undefined,J1,{layer:"VENDOR"});}function T1(i,b,U1){if(U1){M1(undefined,b,U1);return;}var V1=JSON.parse(i.SerializedAnalyticalConfiguration);I1(V1,L1,M1);}}function H1(i,J1,K1){S.getApplicationHandler(M1);function L1(N1,b,O1){var P1;var x;if(O1){K1(O1);}else{P1={instances:{messageHandler:m,persistenceProxy:q1},constructors:{Hashtable:f1},isUsingCloudFoundryProxy:E1};x=new sap.apf.modeler.core.TextPool(P1,J1,N1);x.addTextsAndSave(i,K1,J1);}}function M1(y,N1){if(N1){K1(N1);return;}var O1;var P1=y.getApplication(J1);if(!P1){O1=m.createMessageObject({code:11021});K1(O1);return;}if(y1&&y1.getId()===J1){y1.getInstance().getTextPool().addTextsAndSave(i,K1,J1);}else{var Q1=new sap.apf.core.utils.Filter(m,'Application','eq',J1);var R1=new sap.apf.core.utils.Filter(m,'Language','eq',sap.apf.core.constants.developmentLanguage);R1.addAnd(Q1);q1.readCollection("texts",L1,undefined,undefined,R1);}}}this.importTexts=function(J1,K1){var L1;var M1;var i;var N1=sap.apf.utils.parseTextPropertyFile(J1,{instances:{messageHandler:m}});if(N1.Messages.length>0){L1=m.createMessageObject({code:11020});M1=N1.Messages.length;for(i=0;i<M1-1;i++){N1.Messages[i+1].setPrevious(N1.Messages[i]);}L1.setPrevious(N1.Messages[M1-1]);K1(L1);}else{H1(N1.TextElements,N1.Application,K1);}};function I1(i,J1,K1){var L1=i.configHeader;S.getApplicationHandler(M1);function M1(y,Q1){if(Q1){K1(undefined,undefined,Q1);return;}var R1=false;var S1=y.getList();S1.forEach(function(U1){if(U1.Application===L1.Application){R1=true;}});if(R1){S.getConfigurationHandler(L1.Application,O1);}else{var T1={ApplicationName:L1.ApplicationName,SemanticObject:L1.SemanticObject};y.setAndSave(T1,N1,L1.Application,true);}}function N1(Q1,b,R1){if(R1){K1(undefined,undefined,R1);return;}S.getConfigurationHandler(L1.Application,O1);}function O1(z,Q1){if(Q1){K1(undefined,undefined,Q1);return;}var R1=Q.extend({},i,true);delete R1.configHeader;var S1=false;var T1=z.getList();T1.forEach(function(X1){if(X1.AnalyticalConfiguration===L1.AnalyticalConfiguration){S1=true;}});if(S1){J1(V1,W1,L1.AnalyticalConfigurationName);}else{z.setConfiguration({AnalyticalConfigurationName:L1.AnalyticalConfigurationName},L1.AnalyticalConfiguration);var U1={id:L1.AnalyticalConfiguration,creationDate:L1.CreationUTCDateTime,lastChangeDate:L1.LastChangeUTCDateTime,content:R1};z.loadConfiguration(U1,P1);}function V1(){z.setConfiguration({AnalyticalConfigurationName:L1.AnalyticalConfigurationName},L1.AnalyticalConfiguration);var U1={updateExisting:true,id:L1.AnalyticalConfiguration,creationDate:L1.CreationUTCDateTime,lastChangeDate:L1.LastChangeUTCDateTime,content:R1};z.loadConfiguration(U1,P1);}function W1(X1){if(X1&&X1!==""){L1.AnalyticalConfigurationName=X1;}var Y1=z.setConfiguration({AnalyticalConfigurationName:L1.AnalyticalConfigurationName});var Z1={id:Y1,content:R1};z.loadConfiguration(Z1,P1);}}function P1(Q1,R1){if(R1){K1(undefined,undefined,R1);return;}Q1.save(K1);}}this.importConfiguration=function(i,J1,K1){var L1=JSON.parse(i);if(!M1(L1,K1)){return;}I1(L1,J1,K1);function M1(L1,K1){var N1=[],O1=true,P1;if(!sap.apf.utils.isValidGuid(L1.configHeader.Application)){N1.push(m.createMessageObject({code:11037,aParameters:[L1.configHeader.Application]}));O1=false;}if(!sap.apf.utils.isValidGuid(L1.configHeader.AnalyticalConfiguration)){N1.push(m.createMessageObject({code:11038,aParameters:[L1.configHeader.AnalyticalConfiguration]}));O1=false;}P1=sap.apf.modeler.core.ConfigurationObjects.getTextKeysFromConfiguration(L1);P1.forEach(function(Q1){var R1=new f1(m);if(!R1.hasItem(Q1)){R1.setItem(Q1,Q1);if(!sap.apf.utils.isValidGuid(Q1)){N1.push(m.createMessageObject({code:11039,aParameters:[Q1]}));O1=false;}}});if(O1){return O1;}N1.forEach(function(Q1,R1,N1){if(R1){Q1.setPrevious(N1[R1-1]);}});K1(i,undefined,N1[N1.length-1]);return O1;}};this.getApplicationHandler=function(i){if(!x1){var J1=(R&&R.functions&&R.functions.loadApplicationHandler)||K1;x1=new m1(u1,J1);}x1.asyncGetInstance("ApplicationHandlerId",i);function K1(id,L1){new T({instances:{messageHandler:m,persistenceProxy:q1},constructors:{Hashtable:f1},functions:{resetConfigurationHandler:N1}},M1);function M1(y,O1){L1(id,y,O1);}function N1(O1){if(y1&&y1.getId()===O1){y1.getInstance().removeAllConfigurations();y1.reset();}}}};this.getConfigurationHandler=function(i,J1){if(!y1){w1=(R&&R.functions&&R.functions.loadConfigurationHandler)||K1;y1=new m1(u1,w1);}y1.asyncGetInstance(i,J1);function K1(i,L1,M1){var N1=new sap.apf.core.utils.Filter(m,'Application','eq',i);var O1=new sap.apf.core.utils.Filter(m,'Language','eq',sap.apf.core.constants.developmentLanguage);O1.addAnd(N1);var P1=[];var Q1=["AnalyticalConfiguration","AnalyticalConfigurationName","Application","CreatedByUser","CreationUTCDateTime","LastChangeUTCDateTime","LastChangedByUser"];P1.push({entitySetName:"configuration",filter:N1,selectList:Q1});P1.push({entitySetName:'texts',filter:O1});q1.readCollectionsInBatch(P1,R1);function R1(S1,T1){var x,U1;var V1;var W1;var z=M1;if(T1){L1(i,undefined,T1);}else{V1=S1[0];W1=S1[1];U1={instances:{messageHandler:m,persistenceProxy:q1},constructors:{Hashtable:f1},isUsingCloudFoundryProxy:E1};x=new sap.apf.modeler.core.TextPool(U1,i,W1);if(!z){z=new V({instances:{messageHandler:m,persistenceProxy:q1,coreApi:S,metadataFactory:k},constructors:{ConfigurationEditor:W,ConfigurationFactory:Y,ConfigurationObjects:X,ElementContainer:d1,EntityTypeMetadata:i1,SmartFilterBar:_,FacetFilter:a1,NavigationTarget:b1,Hashtable:f1,Representation:c1,RegistryProbe:g1,Step:Z,HierarchicalStep:$,LazyLoader:m1},functions:{getApplication:x1.getInstance().getApplication}});}z.setApplicationIdAndContext(i,V1,x);L1(i,z,T1);}}}};this.getUnusedTextKeys=function(i,J1){var K1={instances:{messageHandler:m,persistenceProxy:q1},constructors:{Hashtable:f1}};var L1=new X(K1);var M1=null,N1=null,z=null;L1.getTextKeysFromAllConfigurations(i,function(P1,Q1){if(N1){return;}M1=P1;N1=Q1;if(Q1||z){O1();}});this.getConfigurationHandler(i,function(P1,Q1){if(N1){return;}z=P1;N1=Q1;if(Q1||M1){O1();}});function O1(){var P1=[];if(N1){J1(undefined,N1);return;}z.getTextPool().getTextKeys().forEach(function(Q1){if(!M1.hasItem(Q1)){P1.push(Q1);}});J1(P1,undefined);}};this.resetConfigurationHandler=function(){if(y1){y1.reset();}};this.getRepresentationTypes=function(){var i=sap.apf.core.representationTypes();var J1=[];Q.extend(true,J1,i);return J1;};this.getAllAvailableSemanticObjects=function(i){if(A1){i(A1,D1);return;}if(D1){i([],D1);return;}C1.push(i);if(C1.length===1){var J1={requestUri:"/sap/opu/odata/UI2/INTEROP/SemanticObjects?$format=json&$select=id,text",method:"GET",isSemanticObjectRequest:true};S.odataRequest(J1,K1,L1);}function K1(M1,N1){A1=M1.results;C1.forEach(function(O1){O1(M1.results,undefined);});}function L1(M1){var N1;if(M1&&M1.messageObject){N1=M1.messageObject;}else{m.createMessageObject({code:"11041"});A1=[];}D1=N1;C1.forEach(function(O1){O1([],N1);});}};this.getSemanticActions=function(J1){var K1;var L1=Q.Deferred();if(!z1){z1=new f1(m);}K1=z1.getItem(J1);if(K1){L1.resolve(K1);return L1.promise();}S.getAllAvailableSemanticObjects(M1);return L1.promise();function M1(N1,O1){if(O1){L1.reject(O1);return;}var P1=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService("CrossApplicationNavigation");var Q1={id:J1,text:""};var i;for(i=0;i<N1.length;i++){if(N1[i].id===J1){Q1=N1[i];break;}}if(!P1){m.createMessageObject({code:"5038"});var R1={semanticObject:Q1,semanticActions:[]};z1.setItem(J1,R1);L1.resolve(R1);}else{P1.getLinks({semanticObject:Q1.id,ignoreFormFactor:true,ui5Component:R.instances.component}).done(function(S1){var T1=[];S1.forEach(function(U1){var V1=U1.intent.split("-");var W1=V1[1].split("?");W1=W1[0].split("~");T1.push({id:W1[0],text:U1.text});});var R1={semanticObject:Q1,semanticActions:T1};z1.setItem(J1,R1);L1.resolve(R1);}).fail(function(){L1.reject(m.createMessageObject({code:"11042"}));});}}};this.navigateToGenericRuntime=function(i,J1,K1){var L1;if(R&&R.exits&&R.exits.getRuntimeUrl&&Q.isFunction(R.exits.getRuntimeUrl)){L1=R.exits.getRuntimeUrl(i,J1);}else{var M1=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService("CrossApplicationNavigation");var N1={};if(S.getStartParameterFacade().isLrepActive()){N1['sap-apf-configuration-id']=i+'.'+J1;}else{N1['sap-apf-configuration-id']=J1;}var O1=M1.hrefForExternal({target:R.functions.getNavigationTargetForGenericRuntime(),params:N1});var P1=Q(location).attr('href');var Q1=P1.split('#')[0];L1=Q1+O1;}K1(L1);};this.readAllConfigurationsFromVendorLayer=function(){return q1.readAllConfigurationsFromVendorLayer();};this.showSemanticObject=function(){if(M.isLrepActive()||E1){return false;}return true;};this.getGenericExit=function(i){if(R&&R.exits&&R.exits[i]&&typeof R.exits[i]==='function'){return R.exits[i];}return undefined;};this.getComponent=function(){return R&&R.instances&&R.instances.component;};if(R&&R.probe&&typeof R.probe==='function'){R.probe({constructors:{ApplicationHandler:T,ConfigurationHandler:V,ConfigurationEditor:W,ConfigurationObjects:X,ConfigurationFactory:Y,MetadataFactory:l1,Metadata:h1,EntityTypeMetadata:i1,MetadataFacade:j1,MetadataProperty:k1,Step:Z,HierarchicalStep:$,SmartFilterBar:_,FacetFilter:a1,NavigationTarget:b1,Representation:c1,ElementContainer:d1,Hashtable:f1,LazyLoader:m1,AnnotationHandler:o1,ProxyTextHandlerForLocalTexts:p1,RegistryProbe:g1},textHandler:w,messageHandler:m,sessionHandler:s,persistenceProxy:q1,metadataFactory:k,injectForFollowUp:r1,injectMetadataFactory:s1,fnOdataRequestWrapper:v1,proxyTextHandlerForLocalTexts:p,ajax:this.ajax,odataRequestWrapper:v1,annotationHandler:O});}};});
