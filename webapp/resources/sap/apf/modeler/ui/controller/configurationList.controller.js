/*!
* SAP APF Analysis Path Framework
*
* (c) Copyright 2012-2014 SAP SE. All rights reserved
*/
sap.ui.define(["sap/apf/modeler/ui/utils/textPoolHelper","sap/apf/modeler/ui/utils/navigationHandler","sap/apf/modeler/ui/utils/helper","sap/apf/modeler/ui/utils/APFTree","sap/ui/core/util/File","sap/ui/util/openWindow","sap/apf/cloudFoundry/uiHandler","sap/ui/thirdparty/jquery","sap/base/util/isEmptyObject","sap/ui/core/syncStyleClass"],function(t,N,H,A,F,O,U,q,a,S){'use strict';sap.ui.controller("sap.apf.modeler.ui.controller.configurationList",{onInit:function(){var c=this.getOwnerComponent();if(c!==undefined){this.oCoreApi=c.oCoreApi;this._setDisplayText();this._setPublishVisible();}this._instantiateToolbarView();this._instantiateAPFTree();this._instantiateTitleAndBreadCrumbView();this._addConfigStyleClass();this.oModel=new sap.ui.model.json.JSONModel({aConfigDetails:[]});this.getView().setModel(this.oModel);this.bProgramaticSelection=false;if(this.oTreeInstance!==undefined){this.oTreeInstance.expandToLevel(1);this.oTreeInstance.collapseAll();}this.modelUpdateDeferred={};sap.apf.modeler.ui.utils.APFRouter.patternMatch(this);},_instantiateToolbarView:function(){var b=new sap.ui.view({viewName:"sap.apf.modeler.ui.view.toolbar",type:"XML",viewData:{oConfigListInstance:this}});this.toolbarController=b.getController();this.byId("idConfigMasterData").insertItem(b,0);},_instantiateAPFTree:function(){this.oTreeInstance=this.byId("idConfigTree");this.oTreeInstance.setTranslationFunction(this.oCoreApi.getText);var d;if(this.oCoreApi.getRepresentationTypes()[0].metadata){d=this.oCoreApi.getRepresentationTypes()[0].id;}this.oTreeInstance.setDefaultRepresentationType(d);},_instantiateTitleAndBreadCrumbView:function(){this.oTitleBreadCrumbView=new sap.ui.view({viewName:"sap.apf.modeler.ui.view.titleBreadCrumb",type:"XML",viewData:{getText:this.oCoreApi.getText}});this.oTitleBreadCrumbController=this.oTitleBreadCrumbView.getController();this.byId("idConfigDetail").insertItem(this.oTitleBreadCrumbView,0);this.oBreadCrumb=this.oTitleBreadCrumbView.byId("IdBreadCrumb");},setConfigListMasterTitle:function(T){this.byId("idConfigTitleMaster").setText(this.oCoreApi.getText("configurationObjectTitle")+" : "+T);},onAfterRendering:function(){var s=this;this.oTreeInstance.onAfterRendering=function(){s._setHeightForScrollBar();};},_setHeightForScrollBar:function(){var v=this;var h=q(window).height();h=h-165;v.byId("idMasterScroll").setHeight(h+"px");H.onResize(function(){h=q(v.byId("configPage").getDomRef()).height();v.byId("idMasterScroll").setHeight(h+"px");});},_setDisplayText:function(){this.byId("configPage").setTitle(this.oCoreApi.getText("configModelerTitle"));this.byId("idSavebutton").setText(this.oCoreApi.getText("save"));this.byId("idCancelbutton").setText(this.oCoreApi.getText("cancel"));this.byId("idExportbutton").setText(this.oCoreApi.getText("export"));this.byId("idExecuteButton").setText(this.oCoreApi.getText("execute"));this.byId("idPublishbutton").setText(this.oCoreApi.getText("share"));this.byId("idAriaPropertyForBreadCrumb").setText(this.oCoreApi.getText("breadCrumbText"));},_setPublishVisible:function(){var v=this.oCoreApi.isUsingCloudFoundryProxy();this.byId("idPublishbutton").setVisible(v);},_addConfigStyleClass:function(){this.getView().addStyleClass("sapUiSizeCompact");this.byId("idConfigTree").addStyleClass("configTree");this.byId("idConfigTitleMaster").addStyleClass("configTitle");this.byId("idConfigMasterData").addStyleClass("configMasterData");this.byId("idConfigDetailData").addStyleClass("configDetailData");},_setSubViewContainerHeight:function(s){var o=this;var b=s.getContent()[0].getItems()[0];var h=q(window).height();var c=q(this.byId("idConfigTitleMaster").getDomRef()).outerHeight()+q(this.byId("idConfigTitleMaster").getDomRef()).offset().top+25;var d=q(this.byId("idConfigMasterData").getItems()[0].getDomRef()).height();var e=q(this.byId("configPage").getDomRef()).find("header").height();var f=q(this.byId("configPage").getDomRef()).find("footer").height();var g,i;if(d>0){g=c+d+e+f;}else{g=265;}var j=h-g-40+"px";b.setHeight(j);var k=q(this.byId("idConfigDetailData").getDomRef()).width();if(k>0){i=q(this.byId("idConfigMasterData").getDomRef()).offset().left;}else{k=1015;i=15;}var l=k-i;var m=l+"px";b.setWidth(m);H.onResize(function(){h=q(o.byId("configPage").getDomRef()).height();j=h-g+"px";b.setHeight(j);k=q(o.byId("idConfigDetailData").getDomRef()).width();l=k-i;m=l+"px";b.setWidth(m);});},_setSubView:function(s){this.oSubView=s;},_getSubView:function(){return this.oSubView;},updateSubView:function(p){var s=this;var P=this._getSubView();var d=this.byId("idConfigDetailData");var v=this.getSPathFromURL(p);this.configurationHandler.memorizeConfiguration(p.arguments.configId);if(P){P.destroy();}if(p.arguments.configId.indexOf("newConfig")===0){this.modelUpdateDeferred[this.byId("idConfigTree").getModel().getData().aConfigDetails.length-1]=new q.Deferred();}var o=new sap.ui.view({viewName:"sap.apf.modeler.ui.view."+v.objectType,type:"XML",viewData:{oParams:p,oCoreApi:s.oCoreApi,updateConfigTree:s.updateConfigTree.bind(s),updateSelectedNode:s.updateSelectedNode.bind(s),updateTitleAndBreadCrumb:s.updateTitleAndBreadCrumb.bind(s),updateTree:s.updateTree.bind(s),oConfigurationHandler:s.configurationHandler,oApplicationHandler:s.applicationHandler,oConfigurationEditor:s.configEditor,getText:s.oCoreApi.getText,getEntityTypeMetadataAsPromise:s.oCoreApi.getEntityTypeMetadataAsPromise,getRepresentationTypes:s.oCoreApi.getRepresentationTypes,oFooter:s.byId("idFooterBarMain"),createMessageObject:s.oCoreApi.createMessageObject,putMessage:s.oCoreApi.putMessage,getAllAvailableSemanticObjects:s.oCoreApi.getAllAvailableSemanticObjects,getSemanticActions:s.oCoreApi.getSemanticActions,getNavigationTargetName:s._getNavigationTargetName.bind(s),setNavigationTargetName:s._setNavigationTargetName.bind(s),getCalatogServiceUri:s.oCoreApi.getCatalogServiceUri,oTitleBreadCrumbController:s.oTitleBreadCrumbController}});if(p.name!=="applicationList"){d.removeAllContent();o.placeAt(d);this._setSubViewContainerHeight(o);this._setSubView(o);}},clearTitleAndBreadCrumb:function(){this.oTitleBreadCrumbView.byId("IdFormTitle").setText("");this.oTitleBreadCrumbView.byId("IdBreadCrumb").destroyContent();},_createLinkForBreadCrumb:function(n,i,p){var c=this;var l=new sap.m.Link({text:n,id:c.createId("linkId"+i),press:function(){c._navigateToNode(p);}});l.addAriaDescribedBy(c.byId("idAriaPropertyForBreadCrumb"));return l;},_createTextForBreadCrumb:function(v,i){var c=this;var l=new sap.m.Label({id:c.createId("textId"+i)});l.addStyleClass("dialogText");l.setText(v);return l;},_createIconForBreadCrumb:function(){var b=new sap.ui.core.Icon({src:"sap-icon://open-command-field"});b.addStyleClass("breadCrumbIcon");return b;},_navigateToNode:function(p){var i=this.oTreeInstance.getItemNodeByContext(p);this.oTreeInstance.setSelectedItem(i);this._onTreeNodeSelection()},_getAllPossibleNodes:function(p){var n=[];if(p.configId){n.push({id:p.configId,name:p.configurationName,oParams:{arguments:{configId:p.configId}}});}if(p.facetFilterId){n.push({id:p.facetFilterId,name:p.facetFilterName,oParams:{arguments:{configId:p.configId,facetFilterId:p.facetFilterId}}});}if(p.smartFilterId){n.push({id:p.smartFilterId,name:p.smartFilterName,oParams:{arguments:{configId:p.configId,smartFilterId:p.smartFilterId}}});}if(p.categoryId){n.push({id:p.categoryId,name:p.categoryName,oParams:{arguments:{configId:p.configId,categoryId:p.categoryId}}});}if(p.stepId){n.push({id:p.stepId,name:p.stepName,oParams:{arguments:{configId:p.configId,categoryId:p.categoryId,stepId:p.stepId}}});}if(p.representationId){n.push({id:p.representationId,name:p.representationName,oParams:{arguments:{configId:p.configId,categoryId:p.categoryId,stepId:p.stepId,representationId:p.representationId}}});}if(p.navTargetId){n.push({id:p.navTargetId,name:p.navTargetName,oParams:{arguments:{configId:p.configId,navTargetId:p.navTargetId}}});}return n;},_breadCrumbCreation:function(s,T){for(var i=0;i<s.length;i++){var p=this.getSPathFromURL(s[i].oParams).sPath;var l;if(i===1){l=this._createTextForBreadCrumb(T,i);this.oBreadCrumb.addContent(l);var I=this._createIconForBreadCrumb();this.oBreadCrumb.addContent(I);}if(i!==s.length-1){var L=this._createLinkForBreadCrumb(s[i].name,i,p);this.oBreadCrumb.addContent(L);var o=this._createIconForBreadCrumb();this.oBreadCrumb.addContent(o);}if(i===s.length-1){l=this._createTextForBreadCrumb(s[i].name,++i);this.oBreadCrumb.addContent(l);}}},updateTitleAndBreadCrumb:function(T){var f;var s;var o=this.oTreeInstance.getSelectedItems();if(o&&o.length>0){s=o[0];}var b=s?this.oTreeInstance.getAPFTreeNodeContext(s):undefined;var n=b?b.nodeObjectType:undefined;var p=b?this.oTreeInstance.getParentNodeContext(b):undefined;if(T){f=T;}else{if(n){var c=s.getTitle();f=this.oCoreApi.getText(n)+": "+c;if(n===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.SMARTFILTERBAR){f=c;}}}if(p){if(this.oBreadCrumb){this.oBreadCrumb.destroyContent();}var d=this._getAllPossibleNodes(p);var e;switch(n){case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION:this._breadCrumbCreation(d);break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.SMARTFILTERBAR:case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER:e=this.oCoreApi.getText("facetFilter");this._breadCrumbCreation(d,e);break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY:e=this.oCoreApi.getText("category");this._breadCrumbCreation(d,e);break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP:e=this.oCoreApi.getText("category");this._breadCrumbCreation(d,e);break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION:e=this.oCoreApi.getText("category");this._breadCrumbCreation(d,e);break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET:e=this.oCoreApi.getText("navigationTarget");this._breadCrumbCreation(d,e);break;default:break;}}if(n!==sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP){this.oTitleBreadCrumbController.setTitleForDetailPage(f);}},setSelectionOnTree:function(v){if(v.objectType==="smartFilterBar"){this.toolbarController.disableCopyDeleteButton();}else{this.toolbarController.enableCopyDeleteButton();}this._enableDisableExportAndExecuteButton(true);this.oTreeInstance.setSelectionOnTree(v.sPath);},removeSelectionOnTree:function(){this.oTreeInstance.removeSelectionOnTree(this.selectedNode);},updateConfigTree:function(o){var b,n,c,i,d,e,f,g,h;var s=this;o.forEach(function(k){var l;b=s.getSPathFromURL(k.oldContext).sPath;c=b.split("/");i=c[2];d=c[6];f=c[8];g=q.extend(true,{},s.oModel.getData().aConfigDetails[i].configData[1].categories[d].steps[f]);h=g.id;g.isSelected=false;n=s.getSPathFromURL(k.newContext).sPath;e=n.split("/")[6];if(k.removeStep===undefined){if(s.oModel.getData().aConfigDetails[i].configData[1].categories[e].steps){s.oModel.getData().aConfigDetails[i].configData[1].categories[e].steps.forEach(function(v){if(v.id===h){l=true;}});if(l===undefined){s.oModel.getData().aConfigDetails[i].configData[1].categories[e].steps.push(g);}}else{s.oModel.getData().aConfigDetails[i].configData[1].categories[e].steps=[];s.oModel.getData().aConfigDetails[i].configData[1].categories[e].steps.push(g);}}else if(k.removeStep===true){if(s.oModel.getData().aConfigDetails[i].configData[1].categories[e].steps){s.oModel.getData().aConfigDetails[i].configData[1].categories[e].steps.forEach(function(v,w){if(v.id===h){var x=s.oModel.getData().aConfigDetails[i].configData[1].categories[e].steps;x.splice(w,1);s.oModel.getData().aConfigDetails[i].configData[1].categories[e].steps=x;}});if(k.changeCategory===true){var m=s.getSPathFromURL(k.categoryChangeContext).sPath;var p=m.split("/");i=p[2];var r=p[6];var u=p[8];s.oModel.getData().aConfigDetails[i].configData[1].categories[r].steps[u].isSelected=true;s.oModel.getData().aConfigDetails[i].configData[1].categories[r].expanded=true;}}}});this.oModel.updateBindings();var j=o.length;if(o[j-1].changeCategory){sap.ui.core.UIComponent.getRouterFor(this).navTo(o[j-1].oldContext.name,o[j-1].categoryChangeContext.arguments,true);}this.configEditor.setIsUnsaved();},updateSelectedNode:function(p,c){if(p){if(this.oTreeInstance.getSelectedItems()){this.selectedNode=this.oTreeInstance.getSelectedItem();}if(this.selectedNode){if(p.name&&this.selectedNode._getBindingContext()&&this.selectedNode._getBindingContext().getObject()){this.selectedNode.getBindingContext().getObject().name=p.name;this.selectedNode.getBindingContext().getObject().isSelected=true;if(this.selectedNode.getBindingContext().getObject().type===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION||this.selectedNode.getBindingContext().getObject().type===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET){this.selectedNode.getBindingContext().getObject().icon=p.icon;}this.oModel.updateBindings();}if(p.id&&this.selectedNode.getBindingContext().getObject().id){this.selectedNode.getBindingContext().getObject().id=p.id;if(p.icon){this.selectedNode.getBindingContext().getObject().icon=p.icon;}this.oModel.updateBindings();}else if(p.id&&this.selectedNode.getBindingContext().getObject().AnalyticalConfiguration){this.selectedNode.getBindingContext().getObject().AnalyticalConfiguration=p.id;this.selectedNode.getBindingContext().getObject().expanded=true;}}if((this.selectedNode.getBindingContext().getObject().type===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION)&&c){sap.ui.core.UIComponent.getRouterFor(this).navTo(this.selectedNode.getBindingContext().getObject().type,c,true);this.updateTree();}}},createConfigList:function(){var s=this;this.configList=this.configurationHandler.getList();this.configList.forEach(function(c,i){var C={};C.AnalyticalConfiguration=c.AnalyticalConfiguration;C.name=c.AnalyticalConfigurationName;C.Application=c.Application;C.type=sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION;C.bIsLoaded=false;C.bToggleState=false;C.isSelected=false;C.expanded=false;C.selectable=true;C.hasExpander=true;s.oModel.getData().aConfigDetails.push(C);s.modelUpdateDeferred[i]=new q.Deferred();});this.oModel.updateBindings();},showNoConfigSelectedText:function(){this.byId("idConfigDetailData").removeAllContent();this.clearTitleAndBreadCrumb();var n=new sap.m.Label().addStyleClass("noConfigSelected");n.setText(this.oCoreApi.getText("noConfigSelected"));n.placeAt(this.byId("idConfigDetailData"));this.toolbarController.disableCopyDeleteButton();this._enableDisableExportAndExecuteButton(false);this.byId("idConfigDetail").setBusy(false);},updateConfigListView:function(){this.selectedNode=this.oTreeInstance.getSelectedItems();if(this.selectedNode===null||this.selectedNode===undefined||this.selectedNode.length==0){if(this.configList.length>1){this.showNoConfigSelectedText();}else{this.oModel.getData().aConfigDetails[0].isSelected=true;this.oModel.getData().aConfigDetails[0].expanded=true;this.configId=this.oModel.getData().aConfigDetails[0].AnalyticalConfiguration;this.oModel.updateBindings();var c={appId:this.appId,configId:this.oModel.getData().aConfigDetails[0].AnalyticalConfiguration};this.selectedNode=this.oTreeInstance.getItems()[0];this.oTreeInstance.expand(0);this.toolbarController.enableCopyDeleteButton();this._enableDisableExportAndExecuteButton(true);sap.ui.core.UIComponent.getRouterFor(this).navTo(this.oModel.getData().aConfigDetails[0].type,c,true);}}},_getNodeData:function(p,b){var c=this.oModel.getData().aConfigDetails;var n={};var g=function(j){var l={};var m=j||this.configId;for(var i=0;i<c.length;i++){if(c[i].AnalyticalConfiguration===m){l.index=i;l.data=c[i];l.id=c[i].AnalyticalConfiguration;break;}}return l;};var d=function(l){var m=g.call(this,p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION]).index;var o={};for(var i=0;i<c[m].configData.length;i++){if(c[m].configData[i].filters instanceof Array){o.indexConfigData=i;for(var j=0;j<c[m].configData[i].filters.length;j++){if(c[m].configData[i].filters[j].id===l){o.index=j;o.data=c[m].configData[i].filters[j];o.id=c[m].configData[i].filters[j].id;o.filterNodeExpansion=c[m].configData[i].expanded;}}}}return o;};var e=function(l){var m=g.call(this,p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION]).index;var o={};for(var i=0;i<c[m].configData.length;i++){if(c[m].configData[i].categories instanceof Array){o.indexConfigData=i;for(var j=0;j<c[m].configData[i].categories.length;j++){if(c[m].configData[i].categories[j].id===l){o.index=j;o.data=c[m].configData[i].categories[j];o.id=c[m].configData[i].categories[j].id;o.categoryExpansion=c[m].configData[i].expanded;}}}}return o;};var f=function(j){var l=g.call(this,p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION]).index;var m=e.call(this,p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY]).indexConfigData;var o=e.call(this,p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY]).index;var r={};for(var i=0;i<c[l].configData[m].categories[o].steps.length;i++){if(c[l].configData[m].categories[o].steps[i].id===j){r.index=i;r.data=c[l].configData[m].categories[o].steps[i];r.id=c[l].configData[m].categories[o].steps[i].id;}}return r;};var h=function(j){var l=g.call(this,p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION]).index;var m=e.call(this,p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY]).indexConfigData;var o=e.call(this,p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY]).index;var r=f.call(this,p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP]).index;var s={};if(c[l].configData[m].categories[o].steps[r]){for(var i=0;i<c[l].configData[m].categories[o].steps[r].representations.length;i++){if(c[l].configData[m].categories[o].steps[r].representations[i].id===j){s.index=i;s.data=c[l].configData[m].categories[o].steps[r].representations[i];s.id=c[l].configData[m].categories[o].steps[r].representations[i].id;}}}return s;};var k=function(l){var m=g.call(this,p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION]).index;var o={};for(var i=0;i<c[m].configData.length;i++){if(c[m].configData[i].navTargets instanceof Array){o.indexConfigData=i;for(var j=0;j<c[m].configData[i].navTargets.length;j++){if(c[m].configData[i].navTargets[j].id===l){o.index=j;o.data=c[m].configData[i].navTargets[j];o.id=c[m].configData[i].navTargets[j].id;o.nTExpansion=c[m].configData[i].expanded;}}}}return o;};switch(b){case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION:n=g.call(this,p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION]);break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER:n=d.call(this,p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER]);break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.SMARTFILTERBAR:n=d.call(this,p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.SMARTFILTERBAR]);break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY:n=e.call(this,p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY]);break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP:n=f.call(this,p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP]);break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION:n=h.call(this,p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION]);break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET:n=k.call(this,p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET]);break;default:break;}return n;},_retainNodeState:function(p,b){var c=this._getNodeData(p,sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION).index;if(!this.oModel.getData().aConfigDetails[c].bIsLoaded){return{};}var n=this._getNodeData(p,b);if(!n.data){return{};}return{expanded:n.data.expanded,isSelected:n.data.isSelected};},updateTree:function(){var s=this;var c=[],f=[],b=[],d={},n=[],C=[],e=[],g=[],h,k;this.oTextPool=this.configurationHandler.getTextPool();var p={};p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION]=this.configId;var l=s._getNodeData(p,sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION).index;var m=this.configId;var r=false;var u=false;var v=false;var w=Object.keys(this.configEditor.getFilterOption())[0];c=this.configEditor.getCategories();function x(){if(s.oModel.getData().aConfigDetails[l].bIsLoaded){k=s._getNodeData(p,w);}h=s._retainNodeState(p,w);}function y(i,o){var j=s.oCoreApi.getText("smartFilterBar");if(w===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER){j=s.oTextPool.get(o.getLabelKey())?s.oTextPool.get(o.getLabelKey()).TextElementDescription:o.getLabelKey();}p[w]=o.getId();x();b.push({id:o.getId(),name:j,type:w,isSelected:h.isSelected||false,expanded:h.expanded||false,selectable:true,icon:i});}if(w===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.SMARTFILTERBAR){d=this.configEditor.getSmartFilterBar();y("sap-icon://filter",d);}else if(w===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER){f=this.configEditor.getFacetFilters();f.forEach(function(o){var i=o.isVisible()?"sap-icon://filter":"sap-icon://hide";y(i,o);});}if(k&&k.filterNodeExpansion){r=true;}n=this.configEditor.getNavigationTargets();var R=this.oCoreApi.getRepresentationTypes();var z={};R.forEach(function(o){var i=o.id;z[i]=o.picture;});c.forEach(function(i){p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY]=i.getId();var o=i;var j=o.getId();g=[];s.configEditor.getCategoryStepAssignments(j).forEach(function(K){var L=s.configEditor.getStep(K);p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY]=j;p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP]=L.getId();var M=s._retainNodeState(p,sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP);var P=L.getRepresentations();var Q=P.map(function(T){p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION]=T.getId();var V=s._retainNodeState(p,sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION);return{id:T.getId(),name:s.oCoreApi.getText(T.getRepresentationType()),type:"representation",isSelected:V.isSelected||false,expanded:V.expanded||false,selectable:true,icon:z[T.getRepresentationType()]};});g.push({id:L.getId(),name:s.oTextPool.get(L.getTitleId())?s.oTextPool.get(L.getTitleId()).TextElementDescription:L.getTitleId(),type:"step",representations:Q,isSelected:M.isSelected||false,expanded:M.expanded||false,selectable:true,icon:L.getType()==="hierarchicalStep"?"sap-icon://drill-down":"sap-icon://step"});});var I=s._retainNodeState(p,sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY);if(s.oModel.getData().aConfigDetails[l].bIsLoaded){var J=s._getNodeData(p,sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY);if(J.categoryExpansion){v=true;}}C.push({id:i.getId(),name:s.oTextPool.get(i.labelKey)?s.oTextPool.get(i.labelKey).TextElementDescription:i.labelKey,type:"category",steps:g,isSelected:I.isSelected||false,expanded:I.expanded||false,selectable:true,icon:"sap-icon://open-folder"});});e.push({filters:b,name:s.oCoreApi.getText("facetFilters"),expanded:r,selectable:false});e.push({categories:C,name:s.oCoreApi.getText("categories"),expanded:v,selectable:false});var B=[];var D=function(j,o){p[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET]=o.getId();var I=s._retainNodeState(p,sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET);if(s.oModel.getData().aConfigDetails[l].bIsLoaded){var J=s._getNodeData(p,sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET);if(J.nTExpansion){u=true;}}var i,K;for(i=0;i<j.length;i++){if(j[i].id===o.getAction()){K=j[i].text;break;}}if(o.getTitleKey()){K=s.configurationHandler.getTextPool().get(o.getTitleKey()).TextElementDescription;}B.push({id:o.getId(),name:K||o.getSemanticObject(),type:"navigationTarget",isSelected:I.isSelected||false,expanded:I.expanded||false,selectable:true,icon:o.isStepSpecific()?"sap-icon://pushpin-off":"sap-icon://overview-chart"});};var E=function(){var o=n.map(function(I){return I.getId();});var T=[];for(var i=0;i<o.length;i++){for(var j=0;j<B.length;j++){if(o[i]===B[j].id){T[i]=B[j];break;}}}B=T;};var G=function(){var o={};o.configData=e;s.oModel.getData().aConfigDetails[l].bIsLoaded=true;var T=s.oModel.getData().aConfigDetails[l];q.extend(T,o);s.oModel.getData().aConfigDetails[l]=T;s.oModel.getData().aConfigDetails[l].name=s.configurationHandler.getConfiguration(m).AnalyticalConfigurationName;for(var i=0;i<s.oModel.getData().aConfigDetails.length;i++){if(s.modelUpdateDeferred[i]&&s.modelUpdateDeferred[i].state()==="pending"&&n.length===0){s.modelUpdateDeferred[i].resolve(s.oModel.getData());}}if(T.configData[2].navTargets.length>0){s._setNavigationTargetName({configIndexInTree:l});s.modelUpdateDeferred[l].resolve(s.oModel.getData());}s.oModel.updateBindings();};n.forEach(function(o){var P=s.oCoreApi.getSemanticActions(o.getSemanticObject());P.then(function(i){D(i.semanticActions,o);if(B.length===n.length){E();if(e[2]){e.splice(2,2);e.push({navTargets:B,name:s.oCoreApi.getText("navigationTargets"),expanded:u,selectable:false});G();var j=sap.apf.modeler.ui.utils.APFRouter.params;if(j.name==="navigationTarget"){sap.apf.modeler.ui.utils.APFRouter.setCurrentSelectionState(j,s);}}}});});e.push({navTargets:B,name:s.oCoreApi.getText("navigationTargets"),expanded:u,selectable:false});G();},_checkIfKeyExists:function(k,c){var i;if(this.navTargetTextsTable[c]){this.navTargetTextsTable[c].texts.forEach(function(n,b){if(n.key===k){i=b;}});}return i;},_getNavigationTargetName:function(k){var s=this;var v;var n=new q.Deferred();var c=s.getSPathForConfig(s.configId).split('/')[2];if(this.modelUpdateDeferred[c]===undefined){this.modelUpdateDeferred[c]=new q.Deferred();this.modelUpdateDeferred[c].resolve(this.oModel.getData());}q.when(this.modelUpdateDeferred[c]).done(function(m){var i=s._checkIfKeyExists(k,c);if(i!==undefined){v=s.navTargetTextsTable[c].texts[i].value;n.resolve(v);}});return n.promise();},_setNavigationTargetName:function(p){var c=p.configIndexInTree!==undefined?p.configIndexInTree:this.getSPathForConfig(this.configId).split('/')[2];if(a(this.navTargetTextsTable)){this.navTargetTextsTable={};}if(!this.navTargetTextsTable[c]){this.navTargetTextsTable[c]={texts:[]};}if(p.key&&p.value){var i=this._checkIfKeyExists(p.key,c);if(i===undefined){var n={};n.key=p.key;n.value=p.value;this.navTargetTextsTable[c].texts.push(n);}else{this.navTargetTextsTable[c].texts[i].value=p.value;}}else{var b=this.oModel.getData().aConfigDetails[c].configData[2].navTargets;for(var d=0;d<b.length;d++){var e={};e.key=b[d].id;e.value=b[d].name;this.navTargetTextsTable[p.configIndexInTree].texts.push(e);}}},_handleToggleTreeNode:function(e){var s=this;var c=e.getSource().getSelectedItems();if(c&&c.length>0){var p=c[0]._getBindingContext().sPath;var b=c[0]._getBindingContext().getObject().type;if(b===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION){var d=p.split('/')[2];if(s.oModel.getData().aConfigDetails[d].bIsLoaded===true){this.oModel.updateBindings();}else{this.configurationHandler.loadConfiguration(this.oModel.getData().aConfigDetails[d].AnalyticalConfiguration,function(f,m){if(m===undefined){s.configEditor=f;s.configId=s.oModel.getData().aConfigDetails[d].AnalyticalConfiguration;s.updateTree();}});}}}},getSPathForConfig:function(c){var p;this.oModel.getData().aConfigDetails.forEach(function(b,i){if(b.AnalyticalConfiguration===c){p="/aConfigDetails/"+i;}});return p;},getSPathFromURL:function(p){var v={sPath:undefined,objectType:undefined};var s=this;this.oModel.getData().aConfigDetails.forEach(function(c,i){if(c.AnalyticalConfiguration===p.arguments.configId){v.sPath="/aConfigDetails/"+i;v.objectType=sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION;s.oModel.getData().aConfigDetails[i].expanded=true;if(p.arguments.categoryId!==undefined){s.oModel.getData().aConfigDetails[i].configData[1].categories.forEach(function(b,d){if(b.id===p.arguments.categoryId){v.sPath=v.sPath.concat("/configData/1/categories/"+d);v.objectType=sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY;s.oModel.getData().aConfigDetails[i].configData[1].expanded=true;if(p.arguments.stepId!==undefined){s.oModel.getData().aConfigDetails[i].configData[1].categories[d].steps.forEach(function(e,f){if(e.id===p.arguments.stepId){v.sPath=v.sPath.concat("/steps/"+f);v.objectType=sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP;s.oModel.getData().aConfigDetails[i].configData[1].categories[d].expanded=true;if(p.arguments.representationId!==undefined){s.oModel.getData().aConfigDetails[i].configData[1].categories[d].steps[f].representations.forEach(function(r,g){if(r.id===p.arguments.representationId){s.oModel.getData().aConfigDetails[i].configData[1].categories[d].steps[f].expanded=true;v.sPath=v.sPath.concat("/representations/"+g);v.objectType=sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION;}});}}});}}});}if(p.arguments.facetFilterId!==undefined){s.oModel.getData().aConfigDetails[i].configData[0].filters.forEach(function(f,b){if(f.id===p.arguments.facetFilterId){v.sPath=v.sPath.concat("/configData/0/filters/"+b);v.objectType=sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER;s.oModel.getData().aConfigDetails[i].configData[0].expanded=true;}});}if(p.arguments.smartFilterId!==undefined){v.sPath=v.sPath.concat("/configData/0/filters/0");v.objectType=sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.SMARTFILTERBAR;s.oModel.getData().aConfigDetails[i].configData[0].expanded=true;}if(p.arguments.navTargetId!==undefined){s.oModel.getData().aConfigDetails[i].configData[2].navTargets.forEach(function(n,b){if(n.id===p.arguments.navTargetId){v.sPath=v.sPath.concat("/configData/2/navTargets/"+b);v.objectType=sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET;s.oModel.getData().aConfigDetails[i].configData[2].expanded=true;}});}}});return v;},_navHandleExpandDelete:function(n,p,b){var s=this;this.selectedNode=this.oTreeInstance.getSelectedItem();var c=this.oModel.getData().aConfigDetails;var I=b||this.oTreeInstance.isConfigurationSwitched(this.oPreviousSelectedNode,this.selectedNode);var g=function(j){var v;for(var i=0;i<c.length;i++){if(c[i].AnalyticalConfiguration===j){v=i;break;}}return v;};var d=function(v){var k=g.call(this,p.configId);var w,x;for(var i=0;i<c[k].configData.length;i++){if(c[k].configData[i].filters instanceof Array){w=i;for(var j=0;j<c[k].configData[i].filters.length;j++){if(c[k].configData[i].filters[j].id===v){x=j;break;}else{x=j;}}}}return{indexConfig:w,indexFilter:x};};var e=function(v){var k=g.call(this,p.configId);var w,x;for(var i=0;i<c[k].configData.length;i++){if(c[k].configData[i].navTargets instanceof Array){w=i;for(var j=0;j<c[k].configData[i].navTargets.length;j++){if(c[k].configData[i].navTargets[j].id===v){x=j;break;}else{x=j;}}}}return{indexConfig:w,indexNavTarget:x};};var f=function(v){var k=g.call(this,p.configId);var w,x;for(var i=0;i<c[k].configData.length;i++){if(c[k].configData[i].categories instanceof Array){w=i;for(var j=0;j<c[k].configData[i].categories.length;j++){if(c[k].configData[i].categories[j].id===v){x=j;break;}else{x=j;}}}}return{indexConfig:w,indexCategory:x};};var h=function(j){var k=g.call(this,p.configId);var l=f.call(this,p.categoryId).indexConfig;var o=f.call(this,p.categoryId).indexCategory;var v;for(var i=0;i<c[k].configData[l].categories[o].steps.length;i++){if(c[k].configData[l].categories[o].steps[i].id===j){v=i;break;}else{v=i;}}return v;};if(p.configId.indexOf(sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.ISNEWCONFIG)===0&&I){this.configurationHandler.removeConfiguration(p.configId,function(i){var C=s.oModel.getData().aConfigDetails;var k=g.call(s,p.configId);s._deleteConfigNavTargetTexts(k,C.length);C.splice(k,1);s.oModel.getData().aConfigDetails=C;});}else{var k,l,m,o,r,u;switch(n.nodeObjectType){case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION:k=g.call(this,p.configId);this.oModel.getData().aConfigDetails[k].isSelected=true;this.oModel.getData().aConfigDetails[k].expanded=true;break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER:k=g.call(this,p.configId);l=d.call(this,p.facetFilterId).indexConfig;m=d.call(this,p.facetFilterId).indexFilter;this.oModel.getData().aConfigDetails[k].expanded=true;this.oModel.getData().aConfigDetails[k].configData[l].expanded=true;this.oModel.getData().aConfigDetails[k].configData[l].filters[m].expanded=true;break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY:k=g.call(this,p.configId);l=f.call(this,p.categoryId).indexConfig;o=f.call(this,p.categoryId).indexCategory;this.oModel.getData().aConfigDetails[k].expanded=true;this.oModel.getData().aConfigDetails[k].configData[l].expanded=true;break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP:k=g.call(this,p.configId);l=f.call(this,p.categoryId).indexConfig;o=f.call(this,p.categoryId).indexCategory;r=h.call(this,p.stepId);this.oModel.getData().aConfigDetails[k].expanded=true;this.oModel.getData().aConfigDetails[k].configData[l].expanded=true;this.oModel.getData().aConfigDetails[k].configData[l].categories[o].expanded=true;break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION:k=g.call(this,p.configId);l=f.call(this,p.categoryId).indexConfig;o=f.call(this,p.categoryId).indexCategory;r=h.call(this,p.stepId);this.oModel.getData().aConfigDetails[k].expanded=true;this.oModel.getData().aConfigDetails[k].configData[l].expanded=true;this.oModel.getData().aConfigDetails[k].configData[l].categories[o].expanded=true;this.oModel.getData().aConfigDetails[k].configData[l].categories[o].steps[r].expanded=true;break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET:k=g.call(this,p.configId);l=e.call(this,p.navTargetId).indexConfig;u=e.call(this,p.navTargetId).indexNavTarget;this.oModel.getData().aConfigDetails[k].expanded=true;this.oModel.getData().aConfigDetails[k].configData[l].expanded=true;this.oModel.getData().aConfigDetails[k].configData[l].navTargets[u].expanded=true;break;default:break;}}this.oModel.updateBindings();},_isNewSubView:function(p){var i=false;if(p.arguments.configId.indexOf(sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.ISNEWCONFIG)===0){i=true;}else{if(p.name===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION){i=(this.configurationHandler.getConfiguration(p.arguments.configId)!==undefined)?false:true;}else if(p.name===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY){i=(this.configEditor.getCategory(p.arguments.categoryId)!==undefined)?false:true;}else if(p.name===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER){i=(this.configEditor.getFacetFilter(p.arguments.facetFilterId)!==undefined)?false:true;}else if(p.name===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP){i=(this.configEditor.getStep(p.arguments.stepId)!==undefined)?false:true;}else if(p.name===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION){i=(this.configEditor.getStep(p.arguments.stepId).getRepresentation(p.arguments.representationId)!==undefined)?false:true;}else if(p.name===sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET){i=(this.configEditor.getNavigationTarget(p.arguments.navTargetId)!==undefined)?false:true;}}return i;},_getCurrentConfigurationNode:function(){var p=this.oTreeInstance.getItems();var c=this.configId;for(var i=0;i<p.length;i++){if(c===p[i]._getBindingContext().getObject().AnalyticalConfiguration){return p[i];}}return undefined;},_navMandatoryResetState:function(c,b){var s=c;c.selectedNode=c.oTreeInstance.getSelectedItem();s.bIsSaved=s.configEditor?s.configEditor.isSaved():undefined;var d=(typeof s.byId("idConfigDetailData").getContent()[0].getController==="function")?s.byId("idConfigDetailData").getContent()[0].getController():undefined;c.configurationHandler.memorizeConfiguration(d.getView().getViewData().oParams.arguments.configId);var i=this._isNewSubView(d.getView().getViewData().oParams);if(!i){s.updateTree();var e=s.selectedNode._getBindingContext().getObject();if(e){e.isSelected=true;var f=d.getView().getViewData().oParams.name;var g=sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes;if(f!==g.REPRESENTATION){d.updateSubViewInstancesOnReset(s.configEditor);}else{d.oConfigurationEditor=s.configEditor;}d.setDetailData.call(d);s.updateTitleAndBreadCrumb();}else{s.oTreeInstance.setSelectedItem(s._getCurrentConfigurationNode());}if(typeof b==="function"){b();}}else{s.handleConfirmDeletion();}return{bIsSaved:s.bIsSaved,isNewView:i};},_navSaveState:function(s){s();},_navConfigResetState:function(c,b){var s=c;var d=(typeof s.byId("idConfigDetailData").getContent()[0].getController==="function")?s.byId("idConfigDetailData").getContent()[0].getController():undefined;var i=this._isNewSubView(d.getView().getViewData().oParams);if(!i){s.configurationHandler.loadConfiguration(s.configId,function(e,m){if(m===undefined){var d=(typeof s.byId("idConfigDetailData").getContent()[0].getController==="function")?s.byId("idConfigDetailData").getContent()[0].getController():undefined;s.configEditor=e;s.updateTree();var f=s.selectedNode._getBindingContext().getObject();if(f){f.isSelected=true;var g=d.getView().getViewData().oParams.name;var h=sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes;if(g!==h.REPRESENTATION){d.updateSubViewInstancesOnReset(s.configEditor);}else{d.oConfigurationEditor=s.configEditor;}d.setDetailData.call(d);s.updateTitleAndBreadCrumb();}else{s.oTreeInstance.setSelectedItem(s._getCurrentConfigurationNode());}if(typeof b==="function"){b();}}});}else{s.handleConfirmDeletion();}},_onTreeNodeSelection:function(e){this.selectedNode=this.oTreeInstance.getSelectedItem();var s=this;var p,P,r;if(!this.bProgramaticSelection){this.oPreviousSelectedNode=this.oTreeInstance.previousSelectedItem;this.bIsDifferntConfig=this.oTreeInstance.isConfigurationSwitched(this.oPreviousSelectedNode,this.selectedNode);this.oSelectedNodeDetails=this.oTreeInstance.getAPFTreeNodeContext(this.selectedNode);this.oParentNodeDetails=this.oTreeInstance.getParentNodeContext(this.oSelectedNodeDetails);this._enableDisableExportAndExecuteButton(true);var b;if(this.byId("idConfigDetailData").getContent().length>=1){b=(typeof this.byId("idConfigDetailData").getContent()[0].getController==="function")?this.byId("idConfigDetailData").getContent()[0].getController():undefined;}var c=this.selectedNode?this.selectedNode.getId():null;var d=this.oPreviousSelectedNode?this.oPreviousSelectedNode.getId():null;var f=function(){if(s.oPreviousSelectedNode){var l=s.selectedNode.getBindingContext().getObject();l.isSelected=false;s.oModel.updateBindings();}};if(c!==d||this.bNavDeletionMode){var n=N.getInstance();var i;if(b!==undefined){i=typeof b.getValidationState==="function"?b.getValidationState.call(b):true;}else{i=true;}var g=this.configEditor?q.extend(true,{},this.configEditor):undefined;this.bIsSaved=g?g.isSaved():undefined;var o;var h=false;var j=this.configurationHandler.getList();if(!i&&(j.length>0)){n.throwMandatoryPopup(this,{yes:function(){var b=(typeof s.byId("idConfigDetailData").getContent()[0].getController==="function")?s.byId("idConfigDetailData").getContent()[0].getController():undefined;var l=s._isNewSubView(b.getView().getViewData().oParams);if(!l){var y=function(v){s.configEditor=s.configurationHandler.restoreMemorizedConfiguration(s.oParentNodeDetails.configId);if(s.bIsSaved===false&&s.configEditor){s.configEditor.setIsUnsaved();}if(typeof v==="function"){v();}s.updateTree();var w=s.selectedNode.getBindingContext().getObject();s.navigateToDifferntView(s.oParentNodeDetails,s.oSelectedNodeDetails);w.isSelected=true;s.oModel.updateBindings();};if(s.bIsSaved===false&&s.bIsDifferntConfig){o(false,function(){y.call(s);});}else{y.call(s);}}else{if(s.bIsSaved===false&&s.bIsDifferntConfig){o(false,function(){var m=s.selectedNode.getBindingContext().sPath;var u=s.oPreviousSelectedNode;s.handleConfirmDeletion(u,m);});}else{var m=s.selectedNode.getBindingContext().sPath;var u=s.oPreviousSelectedNode;s.handleConfirmDeletion(u,m);}}s._navHandleExpandDelete.call(s,s.oSelectedNodeDetails,s.oParentNodeDetails);},no:function(){f();}});h=true;}o=function(l){if(b){s.configurationHandler.memorizeConfiguration(b.getView().getViewData().oParams.arguments.configId);}n.throwLossOfDataPopup(s,{yes:function(m){if(typeof l==="function"){l(function(){m(function(){var u;if(s.oPreviousSelectedNode){var B=s.oPreviousSelectedNode._getBindingContext().sPath;var C=B.split("/");u=C[2];}s.oModel.getData().aConfigDetails[u].AnalyticalConfiguration=s.configId;});});}else{if(s.oPreviousSelectedNode){p=s.oTreeInstance.getAPFTreeNodeContext(s.oPreviousSelectedNode);P=s.oTreeInstance.getParentNodeContext(p);r=s.configurationHandler.restoreMemorizedConfiguration(P.configId);if(r){s.configEditor=r;}}m(function(){var u;if(s.oPreviousSelectedNode){var B=s.oPreviousSelectedNode._getBindingContext().sPath;var C=B.split("/");u=C[2];}s.oModel.getData().aConfigDetails[u].AnalyticalConfiguration=s.configId;var v=s.selectedNode._getBindingContext().getObject();s.navigateToDifferntView(s.oParentNodeDetails,s.oSelectedNodeDetails);v.isSelected=true;s.oModel.updateBindings();});}},no:function(){s.configurationHandler.loadConfiguration(s.configId,function(m,u){if(u===undefined){s.configEditor=m;if(s.configId.indexOf(sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.ISNEWCONFIG)===0){s._navHandleExpandDelete.call(s,{},{configId:s.configId},s.oParentNodeDetails);}else{s.updateTree();}s.navigateToDifferntView(s.oParentNodeDetails,s.oSelectedNodeDetails);s._navHandleExpandDelete.call(s,s.oSelectedNodeDetails,s.oParentNodeDetails);}});},cancel:function(){f();}});};if(s.bIsSaved===false&&s.bIsDifferntConfig&&i){o();h=true;}if(!h){if(this.oPreviousSelectedNode&&this.oPreviousSelectedNode.getId()!==this.selectedNode.getId()){var k=this.oPreviousSelectedNode.getBindingContext().getObject();if(k){this.oPreviousSelectedNode.getBindingContext().getObject().isSelected=false;}}else{this.selectedNode.getBindingContext().getObject().isSelected=true;}this.navigateToDifferntView(this.oParentNodeDetails,this.oSelectedNodeDetails,this.bIsSaved,this.bIsDifferntConfig);}this.oTreeInstance.previousSelectedItem=this.oTreeInstance.getSelectedItem();}}this.bProgramaticSelection=false;this.bNavDeletionMode=false;},navigateToDifferntView:function(p,s,i,I){if((!a(p)&&(i===undefined||i))||(!I)){sap.ui.core.UIComponent.getRouterFor(this).navTo(s.nodeObjectType,p,true);}},_deleteConfigNavTargetTexts:function(b,n){var s=this;var c;for(var i=b;i<n-1;i++){this.modelUpdateDeferred[i]=this.modelUpdateDeferred[i+1];}delete this.modelUpdateDeferred[n-1];if(this.navTargetTextsTable){if(this.navTargetTextsTable[b]){delete this.navTargetTextsTable[b];}if(b!==(n-1)){Object.keys(this.navTargetTextsTable).forEach(function(k){k=parseInt(k,10);if(k>b){s.navTargetTextsTable[k-1]=s.navTargetTextsTable[k];c=k;}});if(c!==undefined){delete this.navTargetTextsTable[c];}}}},handleConfirmDeletion:function(s,b){var c=((s===undefined)||(typeof s.preventDefault==="function"))?this.oTreeInstance.getAPFTreeNodeContext(this.oTreeInstance.getSelectedItem()):this.oTreeInstance.getAPFTreeNodeContext(s);var d=this;this.selectedNode=this.oTreeInstance.getSelectedItem();var C,n,e,o,f,i,g,h,j,k;f=c.nodeContext;o=f.split("/");i=o[2];switch(c.nodeObjectType){case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER:this.configEditor.removeFacetFilter(c.nodeAPFId);g=o[6];var l=this.oModel.getData().aConfigDetails[i].configData[0].filters;l.splice(g,1);this.oModel.getData().aConfigDetails[i].configData[0].filters=l;e=o.slice(0,3);n=e.join("/");break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY:this.configEditor.removeCategory(c.nodeAPFId);h=o[6];var m=this.oModel.getData().aConfigDetails[i].configData[1].categories;m.splice(h,1);this.oModel.getData().aConfigDetails[i].configData[1].categories=m;e=o.slice(0,3);n=e.join("/");break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET:this.configEditor.removeNavigationTarget(c.nodeAPFId);j=o[6];var p=this.oModel.getData().aConfigDetails[i].configData[2].navTargets;p.splice(j,1);this.oModel.getData().aConfigDetails[i].configData[2].navTargets=p;e=o.slice(0,3);n=e.join("/");break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP:var r=this.configEditor.getCategoriesForStep(c.nodeAPFId);var u=c.nodeContext.split("/");i=u[2];r.forEach(function(G){d.configEditor.removeCategoryStepAssignment(G,c.nodeAPFId);d.oModel.getData().aConfigDetails[i].configData[1].categories.forEach(function(I,J){if(I.id===G){d.oModel.getData().aConfigDetails[i].configData[1].categories[J].steps.forEach(function(K,L){if(K.id===c.nodeAPFId){var M=d.oModel.getData().aConfigDetails[i].configData[1].categories[J].steps;M.splice(L,1);d.oModel.getData().aConfigDetails[i].configData[1].categories[J].steps=M;}});}});});e=o.slice(0,7);n=e.join("/");break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION:h=o[6];k=o[8];var P=this.oModel.getData().aConfigDetails[i].configData[1].categories[h].steps[k].id;var v=this.configEditor.getStep(P);var w=this.configEditor.getCategoriesForStep(P);v.removeRepresentation(c.nodeAPFId);w.forEach(function(G){d.oModel.getData().aConfigDetails[i].configData[1].categories.forEach(function(I,J){if(I.id===G){d.oModel.getData().aConfigDetails[i].configData[1].categories[J].steps.forEach(function(K,L){if(K.id===P){d.oModel.getData().aConfigDetails[i].configData[1].categories[J].steps[L].representations.forEach(function(M,Q){if(M.id===c.nodeAPFId){var R=d.oModel.getData().aConfigDetails[i].configData[1].categories[J].steps[L].representations;R.splice(Q,1);d.oModel.getData().aConfigDetails[i].configData[1].categories[J].steps[L].representations=R;}});}});}});});e=o.slice(0,9);n=e.join("/");break;case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION:var x=false;if(c.nodeAPFId.indexOf("newConfig")===0){x=true;}if(!x){this.configurationHandler.removeConfiguration(c.nodeAPFId,function(G){var y;var z=d.oModel.getData().aConfigDetails;d._deleteConfigNavTargetTexts(parseInt(i,10),z.length);var D=(d.configurationHandler.getList().length>0)?true:false;z.splice(i,1);d.oModel.getData().aConfigDetails=z;d.oModel.updateBindings();if(b){var B=d.oTreeInstance.getParentNodeContext(d.oTreeInstance.getAPFTreeNodeContext(d.selectedNode));sap.ui.core.UIComponent.getRouterFor(d).navTo(d.selectedNode._getBindingContext().getObject().type,B,true);}else{d.clearTitleAndBreadCrumb();d.byId("idConfigDetailData").removeAllContent();if(D){y=new sap.m.Label().addStyleClass("noConfigSelected");y.setText(d.oCoreApi.getText("noConfigSelected"));y.placeAt(d.byId("idConfigDetailData"));d.toolbarController.disableCopyDeleteButton();d._enableDisableExportAndExecuteButton(false);}else{y=new sap.m.Label().addStyleClass("addNewConfig");y.setText(d.oCoreApi.getText("addNewConfig"));y.placeAt(d.byId("idConfigDetailData"));d.toolbarController.disableCopyDeleteButton();d._enableDisableExportAndExecuteButton(false);}}});}else{var y;var z=d.oModel.getData().aConfigDetails;z.splice(i,1);d.oModel.getData().aConfigDetails=z;d.oModel.updateBindings();if(b){var B=d.oTreeInstance.getParentNodeContext(d.oTreeInstance.getAPFTreeNodeContext(d.selectedNode));sap.ui.core.UIComponent.getRouterFor(d).navTo(d.selectedNode._getBindingContext().getObject().type,B,true);}else{d.clearTitleAndBreadCrumb();d.byId("idConfigDetailData").removeAllContent();var D=(this.configurationHandler.getList().length>0)?true:false;if(D){y=new sap.m.Label().addStyleClass("noConfigSelected");y.setText(d.oCoreApi.getText("noConfigSelected"));y.placeAt(d.byId("idConfigDetailData"));d.toolbarController.disableCopyDeleteButton();d._enableDisableExportAndExecuteButton(false);}else{y=new sap.m.Label().addStyleClass("addNewConfig");y.setText(d.oCoreApi.getText("addNewConfig"));y.placeAt(d.byId("idConfigDetailData"));d.toolbarController.disableCopyDeleteButton();d._enableDisableExportAndExecuteButton(false);}}}break;default:break;}if(b){this.bNavDeletionMode=true;}if(c.nodeObjectType!==sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION){this.configEditor.setIsUnsaved();this.clearTitleAndBreadCrumb();this.byId("idConfigDetailData").removeAllContent();n=b||n;C=this.oTreeInstance.getModel().getContext(n);this.oModel.updateBindings();this.selectedNode=this.oTreeInstance.getItemNodeByContextWithoutExpand(C.sPath);this.bProgramaticSelection=false;this.oTreeInstance.setSelectedItem(this.selectedNode);if(b){this.selectedNode.getBindingContext().getObject().isSelected=true;this.oModel.updateBindings();}}var E=(this.toolbarController.confirmationDialog===undefined)?false:this.toolbarController.confirmationDialog.isOpen;if(E&&!b){this.toolbarController.confirmationDialog.close();}},handleNavBack:function(){var s;var b=this;if(this.byId("idConfigDetailData").getContent().length>=1){s=(typeof this.byId("idConfigDetailData").getContent()[0].getController==="function")?this.byId("idConfigDetailData").getContent()[0].getController():undefined;}this.selectedNode=this.oTreeInstance.getSelectedItem();this.oSelectedNodeDetails=this.oTreeInstance.getAPFTreeNodeContext(this.selectedNode);this.oParentNodeDetails=this.oTreeInstance.getParentNodeContext(this.oSelectedNodeDetails);var n=N.getInstance();var i;if(s!==undefined){i=typeof s.getValidationState==="function"?s.getValidationState.call(s):true;}else{i=true;}this.bIsSaved=this.configEditor?this.configEditor.isSaved():undefined;var c=(b.configurationHandler.getList().length>0)?true:false;var d=function(f){if(this.selectedNode){this.selectedNode=null;}this.oModel=new sap.ui.model.json.JSONModel({aConfigDetails:[]});this.getView().setModel(this.oModel);this.configEditor=undefined;this.navTargetTextsTable={};window.history.go(-1);};if(c){var e=(b.bIsSaved===undefined)?true:b.bIsSaved;if(!i){n.throwMandatoryPopup(b,{yes:function(){b.configEditor=b.configurationHandler.restoreMemorizedConfiguration(s.getView().getViewData().oParams.arguments.configId);if(b.bIsSaved===false&&b.configEditor){b.configEditor.setIsUnsaved();}var f=b._navMandatoryResetState(b);var g=b.configurationHandler.getList();if(f.bIsSaved===false&&g.length>0){n.throwLossOfDataPopup(b,{yes:function(h){h();d.call(b);},no:function(){if(b.configId.indexOf(sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.ISNEWCONFIG)===0){b._navHandleExpandDelete.call(b,{},{configId:b.configId},b.oParentNodeDetails);}d.call(b);}});}else{d.call(b);}}});return;}else if(!e&&i){n.throwLossOfDataPopup(b,{yes:function(f){f();d.call(b);},no:function(){b.configurationHandler.resetConfiguration(b.configId);if(b.configId.indexOf(sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.ISNEWCONFIG)===0){b._navHandleExpandDelete.call(b,{},{configId:b.configId},b.oParentNodeDetails);}d.call(b);}});return;}}d.call(b);},handleSavePress:function(){var s,i;var b=this;this.selectedNode=this.oTreeInstance.getSelectedItems();if(this.selectedNode){var B=this.selectedNode[0].getBindingContext().sPath;var c=B.split("/");i=c[2];}if(this.byId("idConfigDetailData").getContent().length>=1){s=(typeof this.byId("idConfigDetailData").getContent()[0].getController==="function")?this.byId("idConfigDetailData").getContent()[0].getController():undefined;}var d=function(){var b=this;var m;b.configEditor.save(function(h,j,k){if(k===undefined){b.configurationHandler.memorizeConfiguration(s.getView().getViewData().oParams.arguments.configId);b.oModel.getData().aConfigDetails[i].AnalyticalConfiguration=h;b.oModel.updateBindings();b.oSelectedNodeDetails=b.oTreeInstance.getAPFTreeNodeContext(b.selectedNode[0]);b.oParentNodeDetails=b.oTreeInstance.getParentNodeContext(b.oSelectedNodeDetails);b.navigateToDifferntView(b.oParentNodeDetails,b.oSelectedNodeDetails,true,false);m=b.oCoreApi.createMessageObject({code:"11513"});b.oCoreApi.putMessage(m);}else{m=b.oCoreApi.createMessageObject({code:"11514"});b.oCoreApi.putMessage(m);}});};var n=N.getInstance();var e;if(s!==undefined){e=typeof s.getValidationState==="function"?s.getValidationState.call(s):true;}else{e=true;}var f=this.configEditor?q.extend(true,{},this.configEditor):undefined;this.bIsSaved=f?f.isSaved():undefined;var g=false;if(!e){n.throwMandatoryPopup(b,{yes:function(){b.configEditor=b.configurationHandler.restoreMemorizedConfiguration(s.getView().getViewData().oParams.arguments.configId);if(b.bIsSaved===false&&b.configEditor){b.configEditor.setIsUnsaved();}b._navMandatoryResetState(b);d.call(b);}});g=true;}if(!g){d.call(this);this.toolbarController.closeDialog();}},_handleExportButtonPress:function(){var s;if(this.byId("idConfigDetailData").getContent().length>=1){s=(typeof this.byId("idConfigDetailData").getContent()[0].getController==="function")?this.byId("idConfigDetailData").getContent()[0].getController():undefined;}var e=function(){if(!this.exportConfigurationDialog){this.exportConfigurationDialog=sap.ui.xmlfragment("idExportConfigurationFragment","sap.apf.modeler.ui.fragment.exportConfiguration",this);this.getView().addDependent(this.exportConfigurationDialog);this._setExportConfigDialogText();this._addStyleClassForExportDialog();this.configurationHandler.memorizeConfiguration(s.getView().getViewData().oParams.arguments.configId);}S("sapUiSizeCompact",this.getView(),this.exportConfigurationDialog);this.exportConfigurationDialog.open();};this._performExportOrExecute(e.bind(this));},handlePublishPress:function(){if(this.oCoreApi.isUsingCloudFoundryProxy()){U.showShareDialog(this.oCoreApi,this);}},_enableDisableExportAndExecuteButton:function(e){this.byId("idExportbutton").setEnabled(e);this.byId("idExecuteButton").setEnabled(e);this.byId("idPublishbutton").setEnabled(e);},_setExportConfigDialogText:function(){sap.ui.core.Fragment.byId("idExportConfigurationFragment","idExportConfigDialog").setTitle(this.oCoreApi.getText("exportConfig"));sap.ui.core.Fragment.byId("idExportConfigurationFragment","idDownloadConfig").setText(this.oCoreApi.getText("downloadConfig"));sap.ui.core.Fragment.byId("idExportConfigurationFragment","idDownloadTextProperty").setText(this.oCoreApi.getText("downloadTextProperty"));sap.ui.core.Fragment.byId("idExportConfigurationFragment","idCloseButton").setText(this.oCoreApi.getText("close"));},_addStyleClassForExportDialog:function(){sap.ui.core.Fragment.byId("idExportConfigurationFragment","idDownloadConfig").addStyleClass("configLink");sap.ui.core.Fragment.byId("idExportConfigurationFragment","idDownloadTextProperty").addStyleClass("textPropertyLink");},_handleCloseOfExportDialog:function(){if(this.exportConfigurationDialog.isOpen()){this.exportConfigurationDialog.close();}},_handleOpenConfigLinkPress:function(){this.configurationHandler.exportConfiguration(this.configId,function(c,b){F.save(c,b,'json','application/json','utf-8');});},_handleOpenTextsLinkPress:function(){var c=this.configurationHandler.getConfiguration(this.configId).AnalyticalConfigurationName;var e=this.configurationHandler.exportTexts(this.configId);F.save(e,c,'properties','text/plain','utf-8');},_performExportOrExecute:function(r){var s,o,n,c,b,i,d,C;var e=false;var f=true;var g=this;g.selectedNode=g.oTreeInstance.getSelectedItem();g.oSelectedNodeDetails=g.oTreeInstance.getAPFTreeNodeContext(g.selectedNode);g.oParentNodeDetails=g.oTreeInstance.getParentNodeContext(g.oSelectedNodeDetails);var h=N.getInstance();if(this.byId("idConfigDetailData").getContent().length>=1){s=(typeof this.byId("idConfigDetailData").getContent()[0].getController==="function")?this.byId("idConfigDetailData").getContent()[0].getController():undefined;}if(s!==undefined){f=typeof s.getValidationState==="function"?s.getValidationState.call(s):true;}var j=this.configEditor?q.extend(true,{},this.configEditor):undefined;this.bIsSaved=j?j.isSaved():undefined;var k=function(c){g.byId("idConfigDetailData").removeAllContent();if(c){d=new sap.m.Label().addStyleClass("noConfigSelected");d.setText(g.oCoreApi.getText("noConfigSelected"));}else{d=new sap.m.Label().addStyleClass("addNewConfig");d.setText(g.oCoreApi.getText("addNewConfig"));}d.placeAt(g.byId("idConfigDetailData"));g.toolbarController.disableCopyDeleteButton();g._enableDisableExportAndExecuteButton(false);};if(!f){h.throwMandatoryPopup(g,{yes:function(){g.configEditor=g.configurationHandler.restoreMemorizedConfiguration(s.getView().getViewData().oParams.arguments.configId);if(g.bIsSaved===false&&g.configEditor){g.configEditor.setIsUnsaved();}n=g._navMandatoryResetState(g);c=(g.configurationHandler.getList().length>0)?true:false;if(c){if(n.bIsSaved===false){o();}else{if(g.oParentNodeDetails.configId.indexOf("newConfig")!==0){r();}}}else{k(c);}}});e=true;}o=function(){h.throwLossOfDataPopup(g,{yes:function(l){g._navSaveState(function(){l(function(m){if(g.selectedNode){b=g.selectedNode._getBindingContext().sPath;C=b.split("/");i=C[2];}g.oModel.getData().aConfigDetails[i].AnalyticalConfiguration=g.configId;g.oModel.updateBindings();r();});});},no:function(){if(g.configId.indexOf(sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.ISNEWCONFIG)===0){g._navHandleExpandDelete.call(g,{},{configId:g.configId},g.oParentNodeDetails);g.clearTitleAndBreadCrumb();g.byId("idConfigDetailData").removeAllContent();c=(g.configurationHandler.getList().length>0)?true:false;k(c);}else{g._navConfigResetState(g,function(){g._navHandleExpandDelete.call(g,g.oSelectedNodeDetails,g.oParentNodeDetails);r();});}}});};if(g.bIsSaved===false&&f){o();e=true;}if(!e){r();}},handleExecuteButtonPress:function(){var s=this.oTreeInstance.getSelectedItem();var e=function(){var o=this.oTreeInstance.getAPFTreeNodeContext(s);var p=this.oTreeInstance.getParentNodeContext(o);this.oCoreApi.navigateToGenericRuntime(p.appId,p.configId,O);this.configurationHandler.memorizeConfiguration(p.configId);};this._performExportOrExecute(e.bind(this));},getStepConfigDataBysPath:function(p){var c=p.split("/");var i=c[2],b=c[4],d=c[6],e=c[8];var s=this.oModel.getData().aConfigDetails[i].configData[b].categories[d].steps[e];return s;}});});
