/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
sap.ui.define(["sap/apf/modeler/ui/utils/textPoolHelper","sap/apf/modeler/ui/utils/nullObjectChecker","sap/apf/modeler/ui/utils/viewValidator"],function(t,n,v){"use strict";var p,T,c,C,o,a,b;var n=sap.apf.modeler.ui.utils.nullObjectChecker;function _(j){j.byId("idCategoryBasicData").setText(T("categoryData"));j.byId("idCategoryTitleLabel").setText(T("categoryTitle"));j.byId("idCategoryTitle").setPlaceholder(T("newCategory"));j.byId("idTotalStepsLabel").setText(T("totalSteps"));}function d(j){var s;if(p&&p.arguments&&p.arguments.categoryId){a=C.getCategory(p.arguments.categoryId);}if(!n.checkIsNotUndefined(a)){s=C.setCategory();a=C.getCategory(s);e(j);}}function e(j,k){var l={id:a.getId(),icon:"sap-icon://open-folder"};if(k){delete l.icon;l.name=k;}j.getView().getViewData().updateSelectedNode(l);}function f(j,k){var s=T("category")+": "+k;j.getView().getViewData().updateTitleAndBreadCrumb(s);}function g(j){if(!n.checkIsNotNullOrUndefinedOrBlank(C.getCategory(p.arguments.categoryId))){return;}if(n.checkIsNotNullOrUndefinedOrBlank(a.labelKey)&&o.get(a.labelKey)){j.byId("idCategoryTitle").setValue(o.get(a.labelKey).TextElementDescription);}else{j.byId("idCategoryTitle").setValue(a.getId());}}function h(j){var k=C.getCategoryStepAssignments(a.getId()).length;j.byId("idTotalSteps").setValue(k);}var i=sap.ui.core.mvc.Controller.extend("sap.apf.modeler.ui.controller.category",{onInit:function(){var j=this;var V=j.getView().getViewData();T=V.getText;p=V.oParams;c=V.oConfigurationHandler;o=c.getTextPool();C=V.oConfigurationEditor;if(!C){c.loadConfiguration(p.arguments.configId,function(k){C=k;});}b=new sap.apf.modeler.ui.utils.ViewValidator(j.getView());_(j);d(j);j.setDetailData();b.addField("idCategoryTitle");},onAfterRendering:function(){if(this.getView().byId("idCategoryTitle").getValue().length===0){this.getView().byId("idCategoryTitle").focus();}},setDetailData:function(){var j=this;g(j);h(j);},handleChangeDetailValue:function(E){var j=this,k;var s=j.byId("idCategoryTitle").getValue().trim();var l=sap.apf.modeler.ui.utils.TranslationFormatMap.CATEGORY_TITLE;if(n.checkIsNotNullOrUndefinedOrBlank(s)){o.setTextAsPromise(s,l).done(function(m){k={labelKey:m};C.setCategory(k,a.getId());e(j,s);f(j,s);C.setIsUnsaved();});}else{C.setIsUnsaved();}},handleSuggestions:function(E){var j=sap.apf.modeler.ui.utils.TranslationFormatMap.CATEGORY_TITLE;var s=new sap.apf.modeler.ui.utils.SuggestionTextHandler(o);s.manageSuggestionTexts(E,j);},updateSubViewInstancesOnReset:function(j){C=j;a=C.getCategory(a.getId());},getValidationState:function(){return b.getValidationState();},onExit:function(){b=null;}});return i;},true);
