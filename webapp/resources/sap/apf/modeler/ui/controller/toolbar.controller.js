/*!
* SAP APF Analysis Path Framework
*
* (c) Copyright 2012-2018 SAP SE. All rights reserved
*/
sap.ui.define(['sap/ui/core/mvc/Controller','sap/apf/modeler/ui/utils/constants','sap/ui/core/syncStyleClass'],function(M,c,S){'use strict';return M.extend("sap.apf.modeler.ui.controller.toolbar",{onInit:function(){this.oCoreApi=this.getView().getViewData().oConfigListInstance.oCoreApi;this.oConfigListInstance=this.getView().getViewData().oConfigListInstance;this._setDisplayText();},_setDisplayText:function(){this.byId("idAddButton").setText(this.oCoreApi.getText("addButton"));this.byId("idCopyButton").setText(this.oCoreApi.getText("copyButton"));this.byId("idDeleteButton").setText(this.oCoreApi.getText("deleteButton"));this.byId("idMoveUp").setTooltip(this.oCoreApi.getText("moveUp"));this.byId("idMoveDown").setTooltip(this.oCoreApi.getText("moveDown"));},enableCopyDeleteButton:function(){if(!this.byId("idCopyButton").getEnabled()){this.byId("idCopyButton").setEnabled(true);}if(!this.byId("idDeleteButton").getEnabled()){this.byId("idDeleteButton").setEnabled(true);}},disableCopyDeleteButton:function(){if(this.byId("idCopyButton").getEnabled()){this.byId("idCopyButton").setEnabled(false);}if(this.byId("idDeleteButton").getEnabled()){this.byId("idDeleteButton").setEnabled(false);}},_setAddMenuText:function(){sap.ui.core.Fragment.byId("idAddMenuFragment","idNewConfig").setText(this.oCoreApi.getText("newConfiguration"));sap.ui.core.Fragment.byId("idAddMenuFragment","idNewFacetFilter").setText(this.oCoreApi.getText("newFacetFilter"));sap.ui.core.Fragment.byId("idAddMenuFragment","idNewCategory").setText(this.oCoreApi.getText("newCategory"));sap.ui.core.Fragment.byId("idAddMenuFragment","idNewNavigationTarget").setText(this.oCoreApi.getText("newNavigationTarget"));sap.ui.core.Fragment.byId("idAddMenuFragment","idStep").setText(this.oCoreApi.getText("step"));sap.ui.core.Fragment.byId("idAddMenuFragment","idNewStep").setText(this.oCoreApi.getText("newStep"));sap.ui.core.Fragment.byId("idAddMenuFragment","idExistingStep").setText(this.oCoreApi.getText("existingStep"));sap.ui.core.Fragment.byId("idAddMenuFragment","idHierarchicalStep").setText(this.oCoreApi.getText("hierarchicalStep"));sap.ui.core.Fragment.byId("idAddMenuFragment","idNewRepresentation").setText(this.oCoreApi.getText("newRepresentation"));},_setExistingStepDialogText:function(){sap.ui.core.Fragment.byId("idExistingStepDialogFragment","idExistingStepDialog").setTitle(this.oCoreApi.getText("existingStepDialogTitle"));},_enableDisableAddMenuItems:function(s,a){var f;var A=a.getItems();var n,m={};if(this.oConfigListInstance.configEditor){f=Object.keys(this.oConfigListInstance.configEditor.getFilterOption())[0];}if(this.oConfigListInstance.configurationHandler.getList().length===0||s===null){n="default";}else{n=s.nodeObjectType;}m["default"]=1;m[c.configurationObjectTypes.CONFIGURATION]=4;m[c.configurationObjectTypes.FACETFILTER]=4;m[c.configurationObjectTypes.SMARTFILTERBAR]=4;m[c.configurationObjectTypes.CATEGORY]=5;m[c.configurationObjectTypes.STEP]=6;m[c.configurationObjectTypes.REPRESENTATION]=6;m[c.configurationObjectTypes.NAVIGATIONTARGET]=4;A.forEach(function(o,i){if(i<m[n]){o.setEnabled(true);if(f!==c.configurationObjectTypes.FACETFILTER&&i===1){o.setEnabled(false);}}else{o.setEnabled(false);}});},_handlePressAddButton:function(e){var s;var o=this,i=true;if(this.oConfigListInstance.getView().byId("idConfigDetailData").getContent().length>=1){s=(typeof this.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController==="function")?this.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController():undefined;}e.getSource().$().blur();var n=sap.apf.modeler.ui.utils.navigationHandler.getInstance();if(s!==undefined){i=typeof s.getValidationState==="function"?s.getValidationState.call(s):true;}var a=this.oConfigListInstance.configEditor?jQuery.extend(true,{},this.oConfigListInstance.configEditor):undefined;this.oConfigListInstance.bIsSaved=a?a.isSaved():undefined;var b=false;var d=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(this.oConfigListInstance.oTreeInstance.getSelectedItem());var A=e.getSource();var f=function(){if(!this.addMenu){this.addMenu=new sap.ui.xmlfragment("idAddMenuFragment","sap.apf.modeler.ui.fragment.addMenu",this);this.getView().addDependent(this.addMenu);this._setAddMenuText();}var g=sap.ui.core.Popup.Dock;this._enableDisableAddMenuItems(d,this.addMenu);this.addMenu.open(false,A,g.BeginTop,g.BeginBottom,A);};if(!i){n.throwMandatoryPopup(o.oConfigListInstance,{yes:function(){var p=o.oConfigListInstance.oTreeInstance.getParentNodeContext(d);o.oConfigListInstance.configEditor=o.oConfigListInstance.configurationHandler.restoreMemorizedConfiguration(p.configId);if(o.oConfigListInstance.bIsSaved===false&&o.oConfigListInstance.configEditor){o.oConfigListInstance.configEditor.setIsUnsaved();}var N=o.oConfigListInstance._navMandatoryResetState(o.oConfigListInstance);if(!N.isNewView){f.call(o);}}});b=true;}if(!b){f.call(o);}},_handleAddMenuItemPress:function(e){var i=this.addMenu.getItems();var a=e.getParameters("item");var n;var N={"idAddMenuFragment--idNewFacetFilter":c.configurationObjectTypes.FACETFILTER,"idAddMenuFragment--idNewCategory":c.configurationObjectTypes.CATEGORY,"idAddMenuFragment--idNewStep":c.configurationObjectTypes.STEP,"idAddMenuFragment--idHierarchicalStep":c.configurationObjectTypes.STEP,"idAddMenuFragment--idNewRepresentation":c.configurationObjectTypes.REPRESENTATION,"idAddMenuFragment--idNewConfig":c.configurationObjectTypes.CONFIGURATION,"idAddMenuFragment--idNewNavigationTarget":c.configurationObjectTypes.NAVIGATIONTARGET,"default":c.configurationObjectTypes.CONFIGURATION};i.forEach(function(o){if(o.getId()===a.id){n=N[o.getId()];}else if(o.getSubmenu()){o.getSubmenu().getItems().forEach(function(o){if(o.getId()===a.id){n=N[o.getId()];}});}});var I=false;if(a.id==="idAddMenuFragment--idExistingStep"){this._handleAddExistingStepPress();}else if(a.id!=="idAddMenuFragment--idStep"&&n!==undefined){if(a.id==="idAddMenuFragment--idHierarchicalStep"){I=true;}this.oConfigListInstance.oTreeInstance.addNodeInTree(n,undefined,I);}},_copyConfiguration:function(C,n){var o=this.oConfigListInstance.configurationHandler.getConfiguration(C);var a={},b;a.AnalyticalConfiguration=o.AnalyticalConfiguration;a.name="< "+o.AnalyticalConfigurationName+" >";a.Application=o.Application;a.type=c.configurationObjectTypes.CONFIGURATION;a.bIsLoaded=false;a.bToggleState=false;a.isSelected=true;a.expanded=true;a.selectable=true;a.hasExpander=true;this.oConfigListInstance.oModel.getData().aConfigDetails.push(a);this.oConfigListInstance.oModel.updateBindings();b=this.oConfigListInstance.oTreeInstance.getModel().getContext(n);this.oConfigListInstance.selectedNode=this.oConfigListInstance.oTreeInstance.getItemNodeByContextWithoutExpand(b.sPath);this.oConfigListInstance.modelUpdateDeferred[this.oConfigListInstance.oModel.getData().aConfigDetails.length-1]=new jQuery.Deferred();var d={appId:this.oConfigListInstance.appId,configId:C};sap.ui.core.UIComponent.getRouterFor(this.oConfigListInstance).navTo(a.type,d,true);},_handlePressCopyButton:function(e){var d=jQuery.Deferred();var s,a;var o=this,b=true;if(this.oConfigListInstance.getView().byId("idConfigDetailData").getContent().length>=1){s=(typeof this.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController==="function")?this.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController():undefined;}e.getSource().$().blur();var n=sap.apf.modeler.ui.utils.navigationHandler.getInstance();if(s!==undefined){b=typeof s.getValidationState==="function"?s.getValidationState.call(s):true;}var f=this.oConfigListInstance.configEditor?jQuery.extend(true,{},this.oConfigListInstance.configEditor):undefined;this.oConfigListInstance.bIsSaved=f?f.isSaved():undefined;var g=false;var h=function(){var C=this;var N;var p=this.oTreeInstance.getAPFTreeNodeContext(this.oTreeInstance.getSelectedItem()||this.selectedNode);this.selectedNode=this.oTreeInstance.getSelectedItem()||this.selectedNode;var q,r,t,u,O,v,w,x,y,z;t=p.nodeContext;switch(p.nodeObjectType){case c.configurationObjectTypes.FACETFILTER:var F=this.oCoreApi.getText("copyOf")+"  "+p.nodeTitle;var A=this.configEditor.copyFacetFilter(p.nodeAPFId);var B=this.configEditor.getFacetFilter(A);var T=sap.apf.modeler.ui.utils.TranslationFormatMap.FACETFILTER_LABEL;this.oTextPool.setTextAsPromise(F,T).done(function(i){B.setLabelKey(i);O=t.split("/");a=O[2];v=O[6];var j=this.oModel.getData().aConfigDetails[a].configData[0].filters[v];j.isSelected=false;var i1=jQuery.extend(true,{},j);i1.id=A;i1.name="< "+F+" >";i1.isSelected=true;u=this.oModel.getData().aConfigDetails[a].configData[0].filters.length;this.oModel.getData().aConfigDetails[a].configData[0].filters.push(i1);O[6]=u;r=O.join("/");h1();}.bind(this));break;case c.configurationObjectTypes.CATEGORY:var D=this.oCoreApi.getText("copyOf")+"  "+p.nodeTitle;var E=this.configEditor.copyCategory(p.nodeAPFId);var G=sap.apf.modeler.ui.utils.TranslationFormatMap.CATEGORY_TITLE;this.oTextPool.setTextAsPromise(D,G).done(function(i1){var j1={labelKey:i1};this.configEditor.setCategory(j1,E);O=t.split("/");a=O[2];w=O[6];var k1=[];var l1=this.configEditor.getSteps();l1.forEach(function(p1){if(C.configEditor.getCategoriesForStep(p1.getId())[0]===E){k1.push(p1.getId());}});var m1=this.oModel.getData().aConfigDetails[a].configData[1].categories[w];m1.isSelected=false;var n1=jQuery.extend(true,{},m1);if(n1.steps){for(var i=0;i<n1.steps.length;i++){n1.steps[i].id=k1[i];var o1=C.configEditor.getStep(k1[i]);N=o1.getRepresentations();if(n1.steps[i].representations){for(var j=0;j<n1.steps[i].representations.length;j++){n1.steps[i].representations[j].id=N[j].getId();}}}}n1.id=E;n1.name="< "+D+" >";n1.isSelected=true;u=this.oModel.getData().aConfigDetails[a].configData[1].categories.length;this.oModel.getData().aConfigDetails[a].configData[1].categories.push(n1);O[6]=u;r=O.join("/");h1();}.bind(this));break;case c.configurationObjectTypes.NAVIGATIONTARGET:var H=this.oCoreApi.getText("copyOf")+"  "+p.nodeTitle;var I=this.configEditor.copyNavigationTarget(p.nodeAPFId);O=t.split("/");a=O[2];x=O[6];var J=this.oModel.getData().aConfigDetails[a].configData[2].navTargets[x];J.isSelected=false;var K=jQuery.extend(true,{},J);K.id=I;K.name="< "+H+" >";K.isSelected=true;u=this.oModel.getData().aConfigDetails[a].configData[2].navTargets.length;this.oModel.getData().aConfigDetails[a].configData[2].navTargets.push(K);O[6]=u;r=O.join("/");h1();o.oConfigListInstance._setNavigationTargetName({configIndexInTree:a});break;case c.configurationObjectTypes.STEP:var L=this.oCoreApi.getText("copyOf")+"  "+p.nodeTitle;var P=this.configEditor.copyStep(p.nodeAPFId);var Q=this.configEditor.getCategoriesForStep(P);var R=this.configEditor.getStep(P);var U=sap.apf.modeler.ui.utils.TranslationFormatMap.STEP_TITLE;this.oTextPool.setTextAsPromise(L,U).done(function(i){var j;R.setTitleId(i);O=t.split("/");a=O[2];w=O[6];y=O[8];var i1=this.oModel.getData().aConfigDetails[a].configData[1].categories[w].steps[y];i1.isSelected=false;var j1=jQuery.extend(true,{},i1);N=R.getRepresentations();j1.id=P;j1.name="< "+L+" >";if(j1.representations){for(j=0;j<j1.representations.length;j++){j1.representations[j].id=N[j].getId();}}u=this.oModel.getData().aConfigDetails[a].configData[1].categories[w].steps.length;O[8]=u;r=O.join("/");for(var k1=0;k1<Q.length;k1++){var l1=jQuery.extend(true,{},j1);var m1={arguments:{configId:o.oConfigListInstance.configId,categoryId:Q[k1]}};var n1=o.oConfigListInstance.getSPathFromURL(m1).sPath.split("/");var o1=n1[6];this.oModel.getData().aConfigDetails[a].configData[1].categories[o1].steps.push(l1);}this.oModel.getData().aConfigDetails[a].configData[1].categories[w].steps[u].isSelected=true;h1();}.bind(this));break;case c.configurationObjectTypes.REPRESENTATION:O=t.split("/");a=O[2];w=O[6];y=O[8];z=O[10];var V=this.oModel.getData().aConfigDetails[a].configData[1].categories[w].steps[y].id;var W=this.configEditor.getStep(V);var X=this.configEditor.getCategoriesForStep(V);this.oModel.getData().aConfigDetails[a].configData[1].categories[w].steps[y].representations[z].isSelected=false;var Y=this.oModel.getData().aConfigDetails[a].configData[1].categories[w].steps[y].representations[z];var Z=jQuery.extend(true,{},Y);var $=W.copyRepresentation(Z.id);Z.id=$;u=this.oModel.getData().aConfigDetails[a].configData[1].categories[w].steps[y].representations.length;O[10]=u;r=O.join("/");for(var _=0;_<X.length;_++){var a1=jQuery.extend(true,{},Z);var b1={arguments:{configId:o.oConfigListInstance.configId,categoryId:X[_],stepId:V}};var c1=o.oConfigListInstance.getSPathFromURL(b1).sPath.split("/");var d1=c1[6];var e1=c1[8];this.oModel.getData().aConfigDetails[a].configData[1].categories[d1].steps[e1].representations.push(a1);}this.oModel.getData().aConfigDetails[a].configData[1].categories[w].steps[y].representations[u].isSelected=true;h1();break;case c.configurationObjectTypes.CONFIGURATION:var f1=this.oCoreApi.getText("copyOf")+"  "+p.nodeTitle;O=t.split("/");a=O[2];var g1=this.oModel.getData().aConfigDetails[a];g1.isSelected=false;O[2]=this.oModel.getData().aConfigDetails.length;r=O.join("/");this.configurationHandler.copyConfiguration(p.nodeAPFId,function(i){var j={AnalyticalConfigurationName:f1};var i1=C.configurationHandler.setConfiguration(j,i);C.configTitle=f1;C.configurationHandler.loadConfiguration(i1,function(j1){var f1=C.configTitle;var k1=sap.apf.modeler.ui.utils.TranslationFormatMap.APPLICATION_TITLE;C.configurationHandler.getTextPool().setTextAsPromise(f1,k1).done(function(l1){j1.setApplicationTitle(l1);});});o._copyConfiguration(i,r);});break;default:break;}function h1(){C.oModel.updateBindings();q=C.oTreeInstance.getModel().getContext(r);C.selectedNode=C.oTreeInstance.getItemNodeByContextWithoutExpand(q.sPath);var i=C.oTreeInstance.getAPFTreeNodeContext(C.selectedNode);var j=C.oTreeInstance.getParentNodeContext(i);C.navigateToDifferntView(j,i);C.configEditor.setIsUnsaved();d.resolve();}};var k=function(){var i=new sap.m.Label().addStyleClass("noConfigSelected");i.setText(o.oConfigListInstance.oCoreApi.getText("noConfigSelected"));i.placeAt(o.oConfigListInstance.byId("idConfigDetailData"));o.oConfigListInstance.toolbarController.disableCopyDeleteButton();o.oConfigListInstance._enableDisableExportAndExecuteButton();};var l;if(!b){n.throwMandatoryPopup(o.oConfigListInstance,{yes:function(){var i=o.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(o.oConfigListInstance.oTreeInstance.getSelectedItem());var p=o.oConfigListInstance.oTreeInstance.getParentNodeContext(i);o.oConfigListInstance.bIsDifferntConfig=o.oConfigListInstance.oTreeInstance.isConfigurationSwitched(o.oConfigListInstance.oPreviousSelectedNode,o.oConfigListInstance.selectedNode);o.oConfigListInstance.configEditor=o.oConfigListInstance.configurationHandler.restoreMemorizedConfiguration(p.configId);if(o.oConfigListInstance.bIsSaved===false&&o.oConfigListInstance.configEditor){o.oConfigListInstance.configEditor.setIsUnsaved();}if(o.oConfigListInstance.bIsDifferntConfig===false){var s=(typeof o.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController==="function")?o.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController():undefined;var j=o.oConfigListInstance._isNewSubView(s.getView().getViewData().oParams);if(!j){h.call(o.oConfigListInstance);o.oConfigListInstance._navHandleExpandDelete.call(o.oConfigListInstance,o.oConfigListInstance.oSelectedNodeDetails,p);}else{o.oConfigListInstance.handleConfirmDeletion();}}else{var N=o.oConfigListInstance._navMandatoryResetState(o.oConfigListInstance);if(!N.isNewView){if(N.bIsSaved===false){l(o.oConfigListInstance);}else{h.call(o.oConfigListInstance);}}}}});g=true;}var m;if(s.getView().getViewData().oParams.name==="configuration"){m=true;}l=function(i){n.throwLossOfDataPopup(i,{yes:function(j){o.oConfigListInstance._navSaveState(function(){j(function(p){if(o.oConfigListInstance.selectedNode){var B=o.oConfigListInstance.selectedNode._getBindingContext().sPath;var C=B.split("/");var a=C[2];}o.oConfigListInstance.oModel.getData().aConfigDetails[a].AnalyticalConfiguration=o.oConfigListInstance.configId;o.oConfigListInstance.oModel.updateBindings();h.call(o.oConfigListInstance);});});},no:function(){var i={appId:o.oConfigListInstance.appId,configId:o.oConfigListInstance.configId};var s=(typeof o.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController==="function")?o.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController():undefined;var m=(s.getView().getViewData().oParams.name==="configuration")?true:false;if(o.oConfigListInstance.configId.indexOf(c.configurationObjectTypes.ISNEWCONFIG)===0){o.oConfigListInstance._navHandleExpandDelete.call(o.oConfigListInstance,{},i,m);o.oConfigListInstance.clearTitleAndBreadCrumb();o.oConfigListInstance.byId("idConfigDetailData").removeAllContent();k();}else{o.oConfigListInstance._navConfigResetState(o.oConfigListInstance,function(){h.call(o.oConfigListInstance);});}}});};if(o.oConfigListInstance.bIsSaved===false&&b&&m){l(o.oConfigListInstance);g=true;}if(!g){h.call(o.oConfigListInstance);}return d.promise();},_handlePressDeleteButton:function(e){var d;var s=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(this.oConfigListInstance.oTreeInstance.getSelectedItem());var n=this.oCoreApi.getText(s.nodeObjectType);e.getSource().$().blur();if(s.nodeObjectType===c.configurationObjectTypes.STEP){d=this.oCoreApi.getText("confirmStepDeletion",[s.nodeTitle]);}else{d=this.oCoreApi.getText("confirmDeletion",[n,s.nodeTitle]);}this._openDeleteConfirmationDialog(d);},_openDeleteConfirmationDialog:function(d){var s=this;var C=jQuery.extend(s.oConfigListInstance,{closeDialog:s.closeDialog.bind(s)});if(!this.confirmationDialog){this.confirmationDialog=sap.ui.xmlfragment("idConfigConfirmationDialogFragment","sap.apf.modeler.ui.fragment.deleteConfirmationDialog",C);this.getView().addDependent(this.confirmationDialog);this._setConfirmationDialogText();}var a=new sap.m.Text();a.setText(d);this.confirmationDialog.removeAllContent();this.confirmationDialog.addContent(a);this.confirmationDialog.addAriaDescribedBy(a);S("sapUiSizeCompact",this.getView(),this.confirmationDialog);this.confirmationDialog.open();},closeDialog:function(){if(this.confirmationDialog&&this.confirmationDialog.isOpen()){this.confirmationDialog.close();}},_setConfirmationDialogText:function(){sap.ui.core.Fragment.byId("idConfigConfirmationDialogFragment","idDeleteConfirmation").setTitle(this.oCoreApi.getText("confirmation"));sap.ui.core.Fragment.byId("idConfigConfirmationDialogFragment","idDeleteButton").setText(this.oCoreApi.getText("deleteButton"));sap.ui.core.Fragment.byId("idConfigConfirmationDialogFragment","idCancelButtonDialog").setText(this.oCoreApi.getText("cancel"));},_handlePressMoveUpButton:function(){this.bIsDown=false;var s=this.oConfigListInstance.oTreeInstance.getSelectedItem();if(s!==null){var a=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(s);if(a!==undefined){this._moveUpOrDown(a,this.bIsDown);}}},_handlePressMoveDownButton:function(){this.bIsDown=true;var s=this.oConfigListInstance.oTreeInstance.getSelectedItem();if(s!==null){var a=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(s);if(a!==undefined){this._moveUpOrDown(a,this.bIsDown);}}},_moveUpOrDown:function(s,i){var a=s.nodeObjectType;var b=s.nodeAPFId;var n=s.nodeContext;var d=n.split('/')[2];var o,e,t,T,l;var f=false;var g=n.split('/')[n.split('/').length-1];switch(a){case c.configurationObjectTypes.FACETFILTER:o=this.oConfigListInstance.oModel.getData().aConfigDetails[d].configData[0].filters;l=o.length;if(i){if(parseInt(g,10)!==(l-1)){this.oConfigListInstance.configEditor.moveFacetFilterUpOrDown(b,1);e=parseInt(g,10)+1;f=true;}}else{if(parseInt(g,10)!==0){this.oConfigListInstance.configEditor.moveFacetFilterUpOrDown(b,-1);e=parseInt(g,10)-1;f=true;}}break;case c.configurationObjectTypes.CATEGORY:o=this.oConfigListInstance.oModel.getData().aConfigDetails[d].configData[1].categories;l=o.length;if(i){if(parseInt(g,10)!==(l-1)){this.oConfigListInstance.configEditor.moveCategoryUpOrDown(b,1);e=parseInt(g,10)+1;f=true;}}else{if(parseInt(g,10)!==0){this.oConfigListInstance.configEditor.moveCategoryUpOrDown(b,-1);e=parseInt(g,10)-1;f=true;}}break;case c.configurationObjectTypes.NAVIGATIONTARGET:o=this.oConfigListInstance.oModel.getData().aConfigDetails[d].configData[2].navTargets;l=o.length;if(i){if(parseInt(g,10)!==(l-1)){this.oConfigListInstance.configEditor.moveNavigationTargetUpOrDown(b,1);e=parseInt(g,10)+1;f=true;}}else{if(parseInt(g,10)!==0){this.oConfigListInstance.configEditor.moveNavigationTargetUpOrDown(b,-1);e=parseInt(g,10)-1;f=true;}}break;case c.configurationObjectTypes.STEP:var h=n.split('/')[6];var j=this.oConfigListInstance.oModel.getData().aConfigDetails[d].configData[1].categories[h];o=j.steps;l=o.length;if(i){if(parseInt(g,10)!==(l-1)){this.oConfigListInstance.configEditor.moveCategoryStepAssignmentUpOrDown(j.id,b,1);e=parseInt(g,10)+1;f=true;}}else{if(parseInt(g,10)!==0){this.oConfigListInstance.configEditor.moveCategoryStepAssignmentUpOrDown(j.id,b,-1);e=parseInt(g,10)-1;f=true;}}break;case c.configurationObjectTypes.REPRESENTATION:var k=this.oConfigListInstance.oTreeInstance.getSelectedItem();var m=k.getParentNode();var p=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(m).nodeAPFId;var q=this.oConfigListInstance.configEditor.getStep(p);h=n.split('/')[6];var r=n.split('/')[8];o=this.oConfigListInstance.oModel.getData().aConfigDetails[d].configData[1].categories[h].steps[r].representations;l=o.length;if(i){if(parseInt(g,10)!==(l-1)){q.moveRepresentationUpOrDown(b,1);e=parseInt(g,10)+1;f=true;}}else{if(parseInt(g,10)!==0){q.moveRepresentationUpOrDown(b,-1);e=parseInt(g,10)-1;f=true;}}break;default:break;}if(f){t=o[g];T=o[e];o[e]=t;o[g]=T;this.oConfigListInstance.oModel.updateBindings();this.oConfigListInstance.configEditor.setIsUnsaved();}},_handleAddExistingStepPress:function(){var s=this;var a=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(this.oConfigListInstance.oTreeInstance.getSelectedItem());var b=this.oConfigListInstance.oTreeInstance.getParentNodeContext(a).categoryId;var d=this.oConfigListInstance.configEditor.getStepsNotAssignedToCategory(b);var e;var f=[];d.forEach(function(g){var o={};var h=s.oConfigListInstance.configEditor.getStep(g);e=s.oConfigListInstance.oTextPool.get(h.getTitleId()).TextElementDescription;o.id=g;o.name=e;f.push(o);});var m=new sap.ui.model.json.JSONModel({existingStepData:f});if(!this.addExistingStepDialog){this.addExistingStepDialog=sap.ui.xmlfragment("idExistingStepDialogFragment","sap.apf.modeler.ui.fragment.existingStepDialog",this);this._setExistingStepDialogText();}this.getView().addDependent(this.addExistingStepDialog);this.addExistingStepDialog.setModel(m);this.addExistingStepDialog.open();},_handleExistingStepDialogOK:function(e){var n=c.configurationObjectTypes.STEP;var s=e.getParameters("listItem").selectedItems;var a=s.length;var b=this.oConfigListInstance.oTreeInstance.getAPFTreeNodeContext(this.oConfigListInstance.oTreeInstance.getSelectedItem());var d=this.oConfigListInstance.oTreeInstance.getParentNodeContext(b).categoryId;var E=[];for(var i=0;i<a;i++){var p=e.getParameters("selectedItems").selectedContexts[i].sPath.split('/')[2];var o=e.getSource().getModel().getData().existingStepData[p];var f=this.oConfigListInstance.configEditor.getStep(o.id);this.oConfigListInstance.configEditor.addCategoryStepAssignment(d,o.id);var r=f.getRepresentations();var g=r.length;var R=[];for(var j=0;j<g;j++){var h={};h.id=r[j].getId();h.name=r[j].getRepresentationType();h.icon=this._getRepresentationIcon(h.name);R.push(h);}var k={};k.step=o;k.representations=R;k.noOfReps=g;E.push(k);}if(a!==0){var l={noOfSteps:a,aExistingStepsToBeAdded:E};this.oConfigListInstance.oTreeInstance.addNodeInTree(n,l);}},_getRepresentationIcon:function(r){var i;var R=this.oCoreApi.getRepresentationTypes();for(var a=0;a<R.length;a++){if(r===R[a].id){i=R[a].picture;break;}}return i;},_handleExistingStepDialogSearch:function(e){var v=e.getParameter("value");var f=new sap.ui.model.Filter("name",sap.ui.model.FilterOperator.Contains,v);var b=e.getSource().getBinding("items");b.filter([f]);},_handleExistingStepDialogClose:function(e){if(this.addExistingStepDialog){e.getSource().getBinding("items").filter([]);}}});},true);
