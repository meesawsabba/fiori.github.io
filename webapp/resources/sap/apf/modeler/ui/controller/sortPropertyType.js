/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/modeler/ui/utils/optionsValueModelBuilder","sap/apf/modeler/ui/utils/staticValuesBuilder","sap/apf/modeler/ui/utils/constants","sap/apf/modeler/ui/utils/textManipulator","sap/apf/modeler/ui/utils/nullObjectChecker","sap/apf/utils/utils"],function(o,s,c,t,n,u){"use strict";var p='idSortProperty';var a='idSortDirection';var o=sap.apf.modeler.ui.utils.optionsValueModelBuilder;var T=sap.apf.modeler.ui.utils.textManipulator;var C=sap.apf.modeler.ui.utils.CONSTANTS.events;function _(j){j.byId("idSortLabel").setText(j.oTextReader("sortingField"));j.byId("idSortLabel").setTooltip(j.oTextReader("sortingField"));j.byId("idSortDirectionLabel").setText(j.oTextReader("direction"));j.byId("idSortDirectionLabel").setTooltip(j.oTextReader("direction"));j.byId("idAddPropertyIcon").setTooltip(j.oTextReader("addButton"));j.byId("idRemovePropertyIcon").setTooltip(j.oTextReader("deleteButton"));}function b(j){if(sap.ui.Device.browser.msie&&sap.ui.Device.browser.version>=11){j.byId("idAriaPropertyForSortGroup").setText(j.oTextReader("sorting"));}j.byId("idAriaPropertyForAdd").setText(j.oTextReader("ariaTextForAddIcon"));j.byId("idAriaPropertyForDelete").setText(j.oTextReader("ariaTextForDeleteIcon"));}function d(j){var k=j.byId(p);j.getAllPropertiesAsPromise().done(function(r){var m=o.convert(r.aAllProperties);k.setModel(m);k.setSelectedKey(r.sSelectedKey);});}function e(j){var k=j.byId(a);var s=new sap.apf.modeler.ui.utils.StaticValuesBuilder(j.oTextReader,o);var m=s.getSortDirections();k.setModel(m);k.setSelectedKey(j.getView().getViewData().oPropertyTypeData.sContext);}function f(j){var S=true,k=true;var P=j.getView().getViewData().oPropertyTypeState;var l=P.indexOfPropertyTypeViewId(j.getView().getId());if(P.indexOfPropertyTypeViewId(j.getView().getId())===0){k=false;}j.byId("idAddPropertyIcon").setVisible(S);j.byId("idRemovePropertyIcon").setVisible(k);if(l>0&&P.aProperties!==undefined){var m=P.getViewAt(l-1);m.oController.byId("idAddPropertyIcon").setVisible(false);}}function g(j,k){var P=j.getView().getViewData().oPropertyTypeState;if(P!==undefined){var l=P.aProperties.length;var m=P.getViewAt(k-1);var q=j.oConfigurationEditor.isSaved();if(k>1&&k==l&&q==false){m.oController.byId("idAddPropertyIcon").setVisible(true);m.oController.byId("idRemovePropertyIcon").setVisible(true);}if(k===1&&k==l&&q==false){m.oController.byId("idAddPropertyIcon").setVisible(true);}}}function h(j){j.byId("idAddPropertyIcon").attachEvent(C.SETFOCUSONADDICON,j.setFocusOnAddRemoveIcons.bind(j));}var i=sap.ui.core.mvc.Controller.extend("sap.apf.modeler.ui.controller.sortPropertyType",{oConfigurationEditor:{},oParentObject:{},oStepPropertyMetadataHandler:{},oTextReader:{},onInit:function(){var j=this;j.oConfigurationEditor=j.getView().getViewData().oConfigurationEditor;j.oParentObject=j.getView().getViewData().oParentObject;j.oStepPropertyMetadataHandler=j.getView().getViewData().oStepPropertyMetadataHandler;j.oTextReader=j.getView().getViewData().oCoreApi.getText;j.setDetailData();},onAfterRendering:function(){var j=this;j.byId("idAddPropertyIcon").fireEvent(C.SETFOCUSONADDICON);},setDetailData:function(){var j=this;_(j);b(j);d(j);e(j);f(j);j.disableView();},handleChangeForSortProperty:function(j){var k=this;var S=T.removePrefixText(k.byId(p).getSelectedKey(),k.oTextReader(sap.apf.modeler.ui.utils.CONSTANTS.texts.NOTAVAILABLE));var P=k.getView().getViewData().oPropertyOrchestration;var v=k.getView().getId();return new Promise(function(r){k.getView().fireEvent(C.UPDATEPROPERTYVALUESTATE,{"sProperty":S});P.updatePropertyTypeRow(v,S);P.updateAllSelectControlsForPropertyType().then(function(){k.updateOfConfigurationObject();k.oConfigurationEditor.setIsUnsaved();r();});});},handleChangeForSortDirection:function(){var j=this;j.updateOfConfigurationObject();j.oConfigurationEditor.setIsUnsaved();},setFocusOnAddRemoveIcons:function(){var j=this;j.byId("idAddPropertyIcon").focus();},handlePressOfAddPropertyIcon:function(){var j=this;h(j);j.addPropertyAsPromise();},handlePressOfRemovePropertyIcon:function(){var j=this;var v=j.getView().getViewData();var P=j.getView().getViewData().oPropertyTypeState;if(P!==undefined){var k=P.indexOfPropertyTypeViewId(j.getView().getId());}return new Promise(function(r){j.getView().fireEvent(C.FOCUSONREMOVE);var l=v.oPropertyOrchestration;l.removePropertyTypeReference(j.getView().getId());l.updateAllSelectControlsForPropertyType().then(function(){j.updateOfConfigurationObject();v.oPropertyTypeHandlerBackLink.handlePressOfRemove({oSourceView:j.getView()});g(j,k);j.oConfigurationEditor.setIsUnsaved();j.getView().destroy();r();});});},updateOfConfigurationObject:function(){var j=this;var P=j.getView().getViewData().oPropertyOrchestration;var k=P.getSortPropertyInformationList(a);j.updateOfConfigurationObjectOfSubclass(k);},getSelectedSortProperty:function(){var j=this;var P=j.getView().getViewData().oPropertyTypeState;var k=P.getPropertyValueState();var l=P.indexOfPropertyTypeViewId(j.getView().getId());return k[l];},removeAllItemsFromDropDownList:function(){var j=this;var v=j.byId(p);v.getItems().forEach(function(I){v.removeItem(I);});},setItemsOfDropDownList:function(j,A,k){function l(w,x){return w.indexOf(x)!==-1;}var m=this;var v=m.byId(p);var q=(k===m.oTextReader("none"));var r=JSON.parse(JSON.stringify(j));v.addItem(new sap.ui.core.Item({key:m.oTextReader("none"),text:m.oTextReader("none")}));if(!l(r,k)&&!q){r.unshift(k);}r=r.filter(function(w){return w!==m.oTextReader("none");});r.forEach(function(V){var w=V;if(!l(A,V)&&!q){V=T.addPrefixText([V],m.oTextReader)[0];}var I=new sap.ui.core.Item({key:V,text:V});v.addItem(I);if(w===k){k=V;}});v.setSelectedKey(k);},updateOfConfigurationObjectOfSubclass:function(S){},getOrderBy:function(){},setNextPropertyInParentObject:function(){},removePropertyFromParentObject:function(){},disableView:function(){},addPropertyAsPromise:function(){return sap.apf.utils.createPromise();}});return i;},true);
