/* (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/ui/utils/formatter","sap/viz/ui5/types/legend/Common"],function(f,C){"use strict";sap.apf.ui.utils.PrintModel=function(i){this.oUiApi=i.uiApi;this.oCoreApi=i.oCoreApi;this.oFilterIdHandler=i.oFilterIdHandler;};sap.apf.ui.utils.PrintModel.prototype.constructor=sap.apf.ui.utils.PrintModel;function g(p,m,i,o,v,j){var F=new sap.apf.ui.utils.formatter({getEventCallback:p.oUiApi.getEventCallback.bind(p.oUiApi),getTextNotHtmlEncoded:p.oCoreApi.getTextNotHtmlEncoded,getExits:p.oUiApi.getCustomFormatExit()},m);var k=F.getFormattedValue(i,v);var l=F.getFormattedValue(i,j);var n=p.oCoreApi.getTextNotHtmlEncoded(o,[k,l]);return n;}function _(p){var s=p.oUiApi.getSmartFilterForPrint();var F=[];if(s!==undefined&&s!==null){var S=s.getFilterData();var i=s.getAnalyticalParameters();if(i&&i.length>0){i.forEach(function(l){var v=S[l.fieldName];var m=l.fieldNameOData;p.oCoreApi.getMetadataFacade().getProperty(m).done(function(n){F.push({sFilterName:m,sFilterValue:g(p,n,m,"EQ",v)});});});}var u=s.getFilters();if(u.length>0){var o=sap.apf.core.utils.Filter.transformUI5FilterToInternal(p.oCoreApi.getMessageHandler(),u[0]);for(var j in S){var t="";var k=o.getFilterTermsForProperty(j);if(k.length>0){p.oCoreApi.getMetadataFacade().getProperty(j).done(function(m){for(var v=0;v<k.length;v++){t+=g(p,m,j,k[v]['operator'],k[v]['value'],k[v]['highValue']);if(v!==k.length-1){t+=", ";}}F.push({sFilterName:j,sFilterValue:t});});}}}}return F;}function a(p){var n,F="",s;var o,i,k=[],S=[],l=[];o=p.oUiApi.getFacetFilterForPrint();if(o){i=o.getLists();for(n=0;n<i.length;n++){F=i[n].getTitle();l=i[n].getSelectedItems();if(l.length>0){S=b(l);if(F!==undefined&&F!==null){s="";for(var j=0;j<S.length;j++){if(j!==S.length-1){s+=S[j]+", ";}else{s+=S[j];}}k.push({sFilterName:F,sFilterValue:s});}}else{k.push({sFilterName:F,sFilterValue:p.oCoreApi.getTextNotHtmlEncoded("noSelectionInFilter")});}}}return k;}function b(s){var S=[];s.forEach(function(i){S.push(i.getText());});return S;}function c(p){var A=p.oFilterIdHandler.getAllInternalIds();var o,j=[],i;if(A.length>0){for(i=0;i<A.length;i++){o=p.oFilterIdHandler.get(A[i]).getExpressions();j.push(o[0]);}}return j;}function d(p,A){var k=[],i,j,F="",s,o,P;var l=[];for(i=0;i<A.length;i++){for(j=0;j<A[i].length;j++){p.oCoreApi.getMetadataFacade().getProperty(A[i][j].name).done(function(m){P=m;F="";l=[];F=m.label;o=new sap.apf.ui.utils.formatter({getEventCallback:p.oUiApi.getEventCallback.bind(p.oUiApi),getTextNotHtmlEncoded:p.oCoreApi.getTextNotHtmlEncoded,getExits:p.oUiApi.getCustomFormatExit()},m);});l.push(o.getFormattedValue(P.name,A[i][j].value));if(F!==undefined&&F!==null){s="";for(var j=0;j<l.length;j++){if(j!==l.length-1){s+=l[j]+", ";}else{s+=l[j];}}k.push({sFilterName:F,sFilterValue:s});}}}return k;}function e(p){var i=p.oUiApi.getEventCallback(sap.apf.core.constants.eventTypes.printTriggered);var A=d(p,c(p));if(i!==undefined){var j={getTextNotHtmlEncoded:p.oCoreApi.getTextNotHtmlEncoded};A=i.apply(j,c(p));}return A;}function h(p){var F,i,j;var k=a(p);i=_(p);F=e(p);j=F.concat(i,k);return j;}sap.apf.ui.utils.PrintModel.prototype.getFiltersToPrint=function(){var p=this;var F=h(p);return F;};sap.apf.ui.utils.PrintModel.prototype.getHeaderForFirstPage=function(){return this.oUiApi.getLayoutView().getController().oSavedPathName.getText();};sap.apf.ui.utils.PrintModel.prototype.getApplicationName=function(){var m;var A=this.applicationConfig.appName;if(!A){m=this.oCoreApi.createMessageObject({code:"6003",aParameters:["sAppName"]});this.oCoreApi.putMessage(m);}return A;};sap.apf.ui.utils.PrintModel.prototype.setApplicationConfig=function(i){this.applicationConfig=i;};sap.apf.ui.utils.PrintModel.prototype.getRepresentationForPrint=function(s){var p;var i;var I;var o;var S=this.oCoreApi.getTextNotHtmlEncoded(s.title);var j=s.getSelectedRepresentation();var k=j.bIsAlternateView?j.toggleInstance:j;if(k&&k.titleControl&&k.titleControl.oParent){I=k.titleControl.oParent.getItems();if(I&&I.length>1){for(i=0;i<I.length;i++){if(I[i].getMetadata()._sClassName==="sap.m.HBox"){o=I[i];o.setVisible(false);}}}}p=k.getPrintContent(S);return p.oRepresentation;};});
