/*
 * ! SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/ui/utils/printView","sap/apf/ui/utils/formatter","sap/viz/ui5/types/legend/Common","sap/base/util/isEmptyObject","sap/ui/thirdparty/jquery"],function(p,f,C,b,q){"use strict";sap.apf.ui.utils.Print=function(I){"use strict";var c=I.oCoreApi;var u=I.uiApi;var A=null;var d=new sap.apf.ui.utils.PrintModel(I);var p=new sap.apf.ui.utils.PrintView(I,d);this.oPrintLayout={};function _(o){if(!b(o.oPrintLayout)){o.oPrintLayout.removeContent();}q('#apfPrintArea').remove();q("body").append('<div id="apfPrintArea"></div>');u.createApplicationLayout(false).then(function(a){a.setBusy(true);});}this.doPrint=function(a){a=a||0;c.getApplicationConfigProperties().done(function(i){d.setApplicationConfig(i);var j,n,P;var l=2000,s=this;d.nStepRenderCount=0;A=c.getSteps();d.nNoOfSteps=A.length;this.oPrintLayout=new sap.ui.layout.VerticalLayout({id:"idAPFPrintLayout"});_(this);P=new sap.ui.layout.VerticalLayout({id:'idAPFPrintFirstPageLayout',content:[p.getHeaderForFirstPage(),p.getPrintLayoutForFacetFiltersAndFooters()]}).addStyleClass("filterLayout");this.oPrintLayout.addContent(P);for(j=0;j<A.length;j++){n=parseInt(j,10)+1;this.oPrintLayout.addContent(p.getPrintLayoutForEachStep(A[j],n,A.length));}this.oPrintLayout.placeAt("apfPrintArea");e(s.oPrintLayout,l,a);}.bind(this));};function e(P,i,a){new Promise(function(r){setTimeout(function(){r();},i);}).then(function(){k(P);if(a==1){h(a);}else{h();}g(P);return u.createApplicationLayout(false)}).then(function(j){j.setBusy(false);});}function g(P){var s,o;var a,l;for(var i=0;i<q("#apfPrintArea").siblings().length;i++){q("#apfPrintArea").siblings()[i].hidden=false;}for(var m=0;m<A.length;m++){s=A[m].getSelectedRepresentation();s=s.bIsAlternateView?s.toggleInstance:s;if(s&&s.titleControl&&s.titleControl.oParent){a=s.titleControl.oParent.getItems();if(a&&a.length>1){for(var j=0;j<a.length;j++){if(a[j].getMetadata()._sClassName==="sap.m.HBox"){l=a[j];l.setVisible(true);}}}}if(s.type!==sap.apf.ui.utils.CONSTANTS.representationTypes.TREE_TABLE_REPRESENTATION&&s.type!==sap.apf.ui.utils.CONSTANTS.representationTypes.TABLE_REPRESENTATION){o=P.getContent()[m+1].getContent()[1].getContent()[0];o.destroy();o=null;}}P.destroy();P=null;q("div[id^=idAPFStepLayout]").remove();q("#apfPrintArea").remove();}function h(a){a=a||0;var i=sap.ui.Device.system.tablet;var j=sap.ui.Device.os.ios;if(i===true&&j===true){var l=q("html").clone();var m=q(l).find('body');q(m).children("div").each(function(s,v){if(q(v).attr('id')==='apfPrintArea'){q(v).show();}else{q(v).remove();}});q(q(l).find('body')).html(q(m.html()));var t="<html>"+q(l).html()+"</html>";var n=window.open("","_blank","width=300,height=300");n.opener=null;n.document.write(t);n.print();}else{if(a==0){var o=window.open("","_blank",'height=600,width=700');var r=document.getElementById("apfPrintArea").innerHTML;o.opener=null;o.document.write('<html><head><title>Analysis Path Framework</title>');o.document.write('</head><body >');o.document.write(r);o.document.write('</body></html>');o.document.close();o.print();o.close();}else{window.print();}}}function k(P){var a=P.getDomRef();q("#apfPrintArea").empty();q("#apfPrintArea").append(q(a).html());for(var i=0;i<q("#apfPrintArea").siblings().length;i++){q("#apfPrintArea").siblings()[i].hidden=true;}}};});
