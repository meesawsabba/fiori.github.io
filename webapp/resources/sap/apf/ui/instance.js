/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2019 SAP AG. All rights reserved
 */
sap.ui.define(['sap/apf/ui/utils/constants','sap/apf/core/constants','sap/apf/ui/reuse/view/analysisPath.view','sap/apf/ui/reuse/view/carousel.view','sap/apf/utils/trace','sap/ui/dom/includeStylesheet'],function(u,c,A,C,t,I){'use strict';function s(o,f,S){var l=o.getLayoutView();var b=l.byId("subHeader");var d=l.byId("idSplitterLayoutData");b.addContent(f);if(!(f instanceof sap.ui.comp.smartfilterbar.SmartFilterBar)){d.setSize("65px");}f.addEventDelegate({onAfterRendering:function(){b.setBusy(false);if(f instanceof sap.ui.comp.smartfilterbar.SmartFilterBar){b.setHeight("");b.addStyleClass(S);}}});}function r(o){o.getLayoutView().byId("subHeader").setBusy(false);}function a(i){i.uiApi=this;var o=i.oCoreApi;var S=i.oStartFilterHandler;var b;var m;var d;var e;var f;var g;var p;var h;var j;var F,k;var l=o.getUriGenerator().getApfLocation();this.oEventCallbacks={};var n;I(l+"resources/css/apfUi.css","apfCss");I(l+"resources/css/apfPrint.css","printCss");jQuery("#printCss").attr("media","print");this.getAddAnalysisStepButton=function(){return this.getAnalysisPath().getCarouselView().getAddStepButton();};this.getAnalysisPath=function(){if(b===undefined){b=sap.ui.view({viewName:"sap.apf.ui.reuse.view.analysisPath",type:sap.ui.core.mvc.ViewType.JS,viewData:i,async:true});}return b;};this.getNotificationBar=function(){if(m===undefined){m=sap.ui.view({viewName:"sap.apf.ui.reuse.view.messageHandler",type:sap.ui.core.mvc.ViewType.JS,viewData:i,async:true});}return m;};this.getStepContainer=function(){if(d===undefined){d=sap.ui.view({viewName:"sap.apf.ui.reuse.view.stepContainer",type:sap.ui.core.mvc.ViewType.JS,viewData:i,async:true});}return d;};this.getToolbar=function(){if(e===undefined){e=sap.ui.view({viewName:"sap.apf.ui.reuse.view.toolbar",type:sap.ui.core.mvc.ViewType.JS,viewData:i,async:true});}return e;};this.createCarouselSingleton=function(){if(i&&i.functions&&i.functions.createCarouselSingleton){f=i.functions.createCarouselSingleton();}if(f===undefined){f=sap.ui.view({viewName:"sap.apf.ui.reuse.view.carousel",type:sap.ui.core.mvc.ViewType.JS,viewData:{oInject:i},async:true});}return f;};this.getStepGallery=function(){if(g===undefined){g=sap.ui.view({type:sap.ui.core.mvc.ViewType.JS,viewName:"sap.apf.ui.reuse.view.stepGallery",viewData:i,async:true});}return g;};this.getPathGallery=function(){if(p===undefined){p=sap.ui.view({viewName:"sap.apf.ui.reuse.view.pathGallery",type:sap.ui.core.mvc.ViewType.JS,viewData:{oInject:i},async:true});}return p;};this.getDeleteAnalysisPath=function(){if(h===undefined){h=sap.ui.view({viewName:"sap.apf.ui.reuse.view.deleteAnalysisPath",type:sap.ui.core.mvc.ViewType.JS,viewData:{oInject:i},async:true});}return h;};this.getLayoutView=function(){if(j===undefined){j=sap.ui.view({viewName:"sap.apf.ui.reuse.view.layout",type:sap.ui.core.mvc.ViewType.XML,viewData:i,async:true});}return j;};this.selectionChanged=function(R){t.logCall("ui/Instance.selectionChanged",", bRefreshAllSteps: ",R,"--------");var x;var y=this;function z(){if(j){j.getController().enableDisableOpenIn();}}x=o.getSteps().indexOf(o.getActiveStep());var B=0;x=o.getSteps().indexOf(o.getActiveStep());if(!R){B=x+1;}t.logCall("...",", nActiveStepIndex: ",x,", indexOfRefresh",B);y.getAnalysisPath().getController().refresh(B);y.getAnalysisPath().getController().getView().getCarouselView().getController().setBusyFromIndex(B);o.updatePath(y.getAnalysisPath().getController().callBackForUpdatePath.bind(y.getAnalysisPath().getController()),function(){z();});t.logReturn("ui/Instance.selectionChanged");};var q=false;this.createApplicationLayout=function(x){var y=this;return new Promise(function(z){if(!q){var B=y.getStepGallery().loaded();var D=y.getToolbar().loaded();var E=y.getPathGallery().loaded();var G=y.getDeleteAnalysisPath().loaded();var H=y.getStepContainer().loaded();var J=Promise.all([B]).then(function(){return y.createCarouselSingleton().loaded();});var K=Promise.all([D,J,E,G]).then(function(){return y.getAnalysisPath().loaded();});var L=Promise.all([H,K]).then(function(){return y.getLayoutView().loaded();});L.then(function(){x.addPage(j);q=true;n=x;z(x);});}else{z(n);}});};this.addDetailFooterContent=function(x){this.getLayoutView().getController().addDetailFooterContentLeft(x);};this.addMasterFooterContentRight=function(x){this.getLayoutView().getController().addMasterFooterContentRight(x);};this.setEventCallback=function(E,x){this.oEventCallbacks[E]=x;};this.getEventCallback=function(E){return this.oEventCallbacks[E];};this.getCustomFormatExit=function(){return i.exits;};this.setCustomFormatExit=function(x){var y=this.getCustomFormatExit();y.customFormat=x;};this.drawSmartFilterBar=function(x){var y=this;function z(B){o.getSmartFilterbarDefaultFilterValues().done(function(D){k=sap.ui.view({viewName:"sap.apf.ui.reuse.view.smartFilterBar",type:sap.ui.core.mvc.ViewType.JS,viewData:{oCoreApi:o,oUiApi:y,oSmartFilterBarConfiguration:B,controlConfiguration:D,parent:y.getLayoutView()},async:true});k.loaded().then(function(V){s(y,V.byId("idAPFSmartFilterBar"),"smartFilterBarContainer");});});}if(x){if(x.entitySet){z(x);}else{o.getMetadata(x.service).done(function(B){x.entitySet=B.getEntitySetByEntityType(x.entityType);delete x.entityType;z(x);});}}else{r(y);}};this.drawFacetFilter=function(x){if(x.length>0){var y=this;F=sap.ui.view({viewName:"sap.apf.ui.reuse.view.facetFilter",type:sap.ui.core.mvc.ViewType.JS,viewData:{oCoreApi:o,oUiApi:this,aConfiguredFilters:x,oStartFilterHandler:S},async:true});F.loaded().then(function(V){s(y,V.byId("idAPFFacetFilter"));});}else{r(this);}};this.contextChanged=function(R){var x=this.getEventCallback(c.eventTypes.contextChanged);if(typeof x==="function"){x();}};this.getFacetFilterForPrint=function(){if(F){return F.byId("idAPFFacetFilter");}};this.getSmartFilterForPrint=function(){if(k){return k.byId("idAPFSmartFilterBar");}};this.handleStartup=function(x){var y=this;var z=jQuery.Deferred();o.getSmartFilterBarConfigurationAsPromise().done(function(B){if(B){y.drawSmartFilterBar(B);}x.done(function(D){var E=S.getStartFilters();E.done(function(G){y.contextChanged();if(!B){y.drawFacetFilter(G);}if(D.navigationMode==="backward"){y.getAnalysisPath().getController().isBackNavigation=true;o.updatePath(y.getAnalysisPath().getController().callBackForUpdatePath.bind(y.getAnalysisPath().getController()));y.getLayoutView().getController().setPathTitle();}if(D.navigationMode==="forward"){if(o.getStartParameterFacade().getSteps()){var H=o.getStartParameterFacade().getSteps()[0].stepId;var J=o.getStartParameterFacade().getSteps()[0].representationId;var K=y.getAnalysisPath().getController().callBackForUpdatePathAndSetLastStepAsActive.bind(y.getAnalysisPath().getController());o.createFirstStep(H,J,K);}if(sap.ui.core.BusyIndicator){sap.ui.core.BusyIndicator.hide();}}y.getNotificationBar().loaded().then(function(M){y.getLayoutView().byId("applicationPage").addContent(M);var L=M.getController().showMessage;o.setCallbackForMessageHandling(L.bind(M.getController()));z.resolve();});});});});return z.promise();};this.destroy=function(){F=undefined;k=undefined;if(b){var x=this.getAnalysisPath().getToolbar().getController();v(x.saveDialog);v(x.newOpenDialog);v(x.newDialog);v(x.confirmDialog);v(x.errorMsgDialog);v(x.noPathAddedDialog);if(x.deleteAnalysisPath!==undefined){v(x.deleteAnalysisPath.getController().oDialog);}if(x.pathGallery!==undefined){v(x.pathGallery.getController().oDialog);}var y=this.getAnalysisPath().getCarouselView().getStepGallery().getController();v(y.oHierchicalSelectDialog);}if(d){var z=this.getStepContainer().getController();v(z.selectionDisplayDialog);w(this);}};function v(x){if(x!==undefined){if(x instanceof sap.m.ViewSettingsDialog){x.destroy();}else if(x.isOpen()){x.close();}}}function w(x){var y=false;var z=false;var B;if(x.getStepContainer().getViewData().oCoreApi.getActiveStep()!==undefined){y=true;}if(y){B=x.getStepContainer().getViewData().oCoreApi.getActiveStep().getSelectedRepresentation();if(B!==undefined){z=true;}}if(z){if(B.type!==u.representationTypes.TABLE_REPRESENTATION){if(B.toggleInstance!==undefined){v(B.toggleInstance.viewSettingsDialog);}}else{v(B.viewSettingsDialog);}}}}sap.apf.ui.Instance=a;return a;},true);
