/*!
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/esh/search/ui/SearchHelper","sap/esh/search/ui/SearchNavigationObject","sap/esh/search/ui/SearchNavigationObjectForSinaNavTarget",],function(S,a,b){"use strict";var m=(sap.esh.search.ui.SearchResultListFormatter=function(){this.init.apply(this,arguments);});m.prototype={init:function(c){this.model=c;},format:function(s,t,o){o=o||{};o.suppressHighlightedValues=o.suppressHighlightedValues||false;var c=s.sina;var l={};var f=[];var r=s.items;var i,z;for(i=0;i<r.length;i++){var d=r[i];var e={};var I=[];for(z=0;z<d.detailAttributes.length;z++){var g=d.detailAttributes[z];var h=g.value;switch(g.metadata.type){case c.AttributeType.ImageBlob:if(h&&h.trim().length>0){h="data:;base64,"+h;}case c.AttributeType.ImageUrl:e.imageUrl=h;e.imageFormat=g.metadata.format?g.metadata.format.toLowerCase():undefined;if(g.defaultNavigationTarget){e.imageNavigation=new b(g.defaultNavigationTarget,this.model);}break;case c.AttributeType.GeoJson:e.geoJson={value:h,label:d.title||g.label,};break;case c.AttributeType.Group:var k=this._formatAttributeGroup(g,o,z);I.push(k);break;case c.AttributeType.Double:case c.AttributeType.Integer:case c.AttributeType.String:case c.AttributeType.Date:case c.AttributeType.Time:case c.AttributeType.Timestamp:var n=this._formatSingleAttribute(g,o,z);I.push(n);break;}}e.key=d.key;e.keystatus=d.keystatus;e.dataSource=d.dataSource;e.dataSourceName=d.dataSource.label;if(d.additionalAttributes){e.additionalAttributes=d.additionalAttributes;}if(d.titleAttributes){var p,q,u;var v=[];for(z=0;z<d.titleAttributes.length;z++){p=d.titleAttributes[z];if(p.metadata.type===c.AttributeType.Group){q=this._formatAttributeGroup(p,o,z);}else if(p.metadata.type===c.AttributeType.ImageUrl){q=this._formatSingleAttribute(p,o,z);e.titleIconUrl=p.value;q.value="";}else{q=this._formatSingleAttribute(p,o,z);}if(p.infoIconUrl){e.titleInfoIconUrl=p.infoIconUrl;q.value="";}u=q.value;v.push(u);}e.title=v.join(" ");}else{e.title=o.suppressHighlightedValues?d.title:d.titleHighlighted;}if(d.titleDescriptionAttributes){var w,x,y;var A=[];var B=[];for(z=0;z<d.titleDescriptionAttributes.length;z++){w=d.titleDescriptionAttributes[z];if(w.metadata.type===c.AttributeType.Group){x=this._formatAttributeGroup(w,o,z);}else{x=this._formatSingleAttribute(w,o,z);}y=x.value;A.push(y);B.push(x.name);}e.titleDescription=A.join(" ");e.titleDescriptionLabel=B.join(" ");}e.itemattributes=I;if(d.defaultNavigationTarget){e.titleNavigation=new b(d.defaultNavigationTarget,this.model);if(!e.title||e.title.length===0){e.title=d.defaultNavigationTarget.label;}}if(d.navigationTargets&&d.navigationTargets.length>0){e.navigationObjects=[];for(var j=0;j<d.navigationTargets.length;j++){var C=new b(d.navigationTargets[j],this.model);C.setLoggingType("RESULT_LIST_ITEM_NAVIGATE_CONTEXT");e.navigationObjects.push(C);}}var D=l[d.dataSource.id]||{};l[d.dataSource.id]=D;e.layoutCache=D;e.selected=e.selected||false;e.expanded=e.expanded||false;var E={};this._formatResultForDocuments(d,E);this._formatResultForNotes(d,E);e.additionalParameters=E;e.positionInList=i;e.resultSetId=s.id;f.push(e);}return f;},_formatAttributeGroup:function(c,o,d){if(c.attributes.length===2&&typeof c.attributes[1].attribute.value==="string"&&c.attributes[1].attribute.value.startsWith("sap-icon://")){var f=this._formatSingleAttribute(c.attributes[0].attribute,o,d);f.iconUrl=c.attributes[1].attribute.value;f.key=c.id;f.isTitle=false;f.isSortable=c.metadata.isSortable;f.attributeIndex=d;f.displayOrder=c.metadata.usage.Detail&&c.metadata.usage.Detail.displayOrder;return f;}var e={};var g={};e.name=c.label;var h=false;var j=false;var p=c.metadata._private;var k,l;for(var i=0;i<c.attributes.length;i++){var n=c.attributes[i];var _=n.attribute;var q=n.metadata.nameInGroup;var r;if(_.metadata.type===_.sina.AttributeType.Group){r=this._formatAttributeGroup(_,o,d);}else{r=this._formatSingleAttribute(_,o,d);}if(p){if(p.parentAttribute===_.metadata){k=r;}else if(p.childAttribute===_.metadata){l=r;}}if(r.value!==undefined&&r.value.length>0){g[q]=r;h=h||r.whyfound;j=j||r.longtext!==undefined;}}e.value="";e.valueRaw=undefined;e.valueWithoutWhyfound="";e.whyfound=false;if(Object.keys(g).length>0){var s=true;if(p&&k&&l&&(p.isUnitOfMeasure||p.isCurrency||p.isDescription)){var t=k.value;var u=l.value;t=t!==undefined&&t.trim().length>0?t:undefined;u=u!==undefined&&u.trim().length>0?u:undefined;if(!(t&&u)){if(p.isUnitOfMeasure||p.isCurrency){if(t&&!u){e.value=k.value;e.valueRaw=k.valueRaw;e.valueWithoutWhyfound=k.valueWithoutWhyfound;s=false;}}else if(p.isDescription){var v=p.textArrangement;var w=c.sina;if(v===w.AttributeGroupTextArrangement.TextFirst){if(!t&&u){e.value=l.value;e.valueRaw=l.valueRaw;e.valueWithoutWhyfound=l.valueWithoutWhyfound;s=false;}}else if(v===w.AttributeGroupTextArrangement.TextLast){if(t&&!u){e.value=k.value;e.valueRaw=k.valueRaw;e.valueWithoutWhyfound=k.valueWithoutWhyfound;s=false;}}else if(v===w.AttributeGroupTextArrangement.TextOnly){if(!u){s=false;}}}}}if(s){e.value=this._formatBasedOnGroupTemplate(c.template,g,"value");e.valueRaw=this._formatBasedOnGroupTemplate(c.template,g,"valueRaw");e.valueWithoutWhyfound=this._formatBasedOnGroupTemplate(c.template,g,"valueWithoutWhyfound");}e.whyfound=h;}e.key=c.id;e.isTitle=false;e.isSortable=c.metadata.isSortable;e.attributeIndex=d;e.displayOrder=c.metadata.usage.Detail&&c.metadata.usage.Detail.displayOrder;if(j){e.longtext=e.value;}return e;},_formatSingleAttribute:function(d,o,i){var I={};var s=d.sina;I.name=d.label;I.valueRaw=d.value;I.value=o.suppressHighlightedValues?d.valueFormatted:d.valueHighlighted;I.valueWithoutWhyfound=d.valueFormatted;I.key=d.id;I.isTitle=false;I.isSortable=d.metadata.isSortable;I.attributeIndex=i;I.displayOrder=d.metadata.usage.Detail&&d.metadata.usage.Detail.displayOrder;I.whyfound=d.isHighlighted;if(d.defaultNavigationTarget){I.defaultNavigationTarget=new b(d.defaultNavigationTarget,this.model);}if(d.metadata.format&&(d.metadata.format===s.AttributeFormatType.MultilineText||d.metadata.format===s.AttributeFormatType.LongText)){I.longtext=d.valueHighlighted;}return I;},_formatBasedOnGroupTemplate:function(t,c,v){if(!(t&&c&&v)){return"";}var d="",p=0;var e,r=/{\w+}/gi;while((e=r.exec(t))!==null){d+=t.substring(p,e.index);var f=e[0].slice(1,-1);d+=(c[f]&&c[f][v])||"";p=r.lastIndex;}d+=t.substring(p);return d;},_formatResultForDocuments:function(r,c){var k="";c.isDocumentConnector=false;var j,d;for(j=0;j<r.detailAttributes.length;j++){d=r.detailAttributes[j];if(d.metadata.id==="FILE_PROPERTY"){c.isDocumentConnector=true;}if(d.metadata.isKey===true){if(k.length>0){k+=";";}k=k+d.metadata.id+"="+d.value;}}if(c.isDocumentConnector===true){var s=";o=sid("+r.dataSource.system+"."+r.dataSource.client+")";var e=r.dataSource.id;c.imageUrl="/sap/opu/odata/SAP/ESH_SEARCH_SRV"+s+"/FileLoaderFiles(ConnectorId='"+e+"',FileType='ThumbNail',SelectionParameters='"+k+"')/$value";c.titleUrl="/sap/opu/odata/SAP/ESH_SEARCH_SRV"+s+"/FileLoaderFiles(ConnectorId='"+e+"',FileType='BinaryContent',SelectionParameters='"+k+"')/$value";var f="/sap/opu/odata/SAP/ESH_SEARCH_SRV"+s+"/FileLoaderFiles(ConnectorId='"+e+"',FileType='SUVFile',SelectionParameters='"+k+"')/$value";c.suvlink="/sap/bc/ui5_ui5/ui2/ushell/resources/sap/fileviewer/viewer/web/viewer.html?file="+encodeURIComponent(f);if(!r.navigationObjects){r.navigationObjects=[];}var n=new a({text:"Show Document",href:c.suvlink,target:"_blank",},this.model);r.navigationObjects.push(n);for(j=0;j<r.detailAttributes.length;j++){d=r.detailAttributes[j];if(d.id==="PHIO_ID_THUMBNAIL"&&d.value){c.containsThumbnail=true;}if(d.id==="PHIO_ID_SUV"&&d.value){c.containsSuvFile=true;}}}},_formatResultForNotes:function(){},};return m;});
