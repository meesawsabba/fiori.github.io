/*!
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
 */
sap.ui.define(["../i18n","sap/esh/search/ui/SearchHelper","sap/esh/search/ui/suggestions/SuggestionProvider","sap/esh/search/ui/suggestions/SuggestionType",],function(a,S,b,c){"use strict";var m=function(){this.init.apply(this,arguments);};m.prototype=jQuery.extend(new b(),{init:function(){b.prototype.init.apply(this,arguments);this.suggestApplications=S.refuseOutdatedRequests(this.suggestApplications);},abortSuggestions:function(){this.suggestApplications.abort();},combineSuggestionsWithIdenticalTitle:function(s){var d;var e={};for(var i=0;i<s.length;i++){d=s[i];var f=e[d.title+d.subtitle];if(f){if(!f.combinedSuggestionExists){var g={title:"combinedAppSuggestion"+i,subtitle:d.subtitle,sortIndex:f.sortIndex,url:this.model.searchUrlParser.renderFromParameters(this.model.appTopDefault,this.model.sinaNext.createFilter({dataSource:this.model.appDataSource,searchTerm:d.title,}),false),label:a.getText("suggestion_in_apps",d.label),icon:"",};var h=a.getText("suggestion_in_apps",[""]);g.label=g.label.replace(h,"<i>"+h+"</i>");e[g.title+g.subtitle]=g;f.combinedSuggestionExists=true;}}else{d.sortIndex=i;e[d.title+d.subtitle]=d;}}s=[];for(var j in e){if(Object.prototype.hasOwnProperty.call(e,j)){d=e[j];if(!d.combinedSuggestionExists){s.push(d);}}}s.sort(function(k,l){return k.sortIndex-l.sortIndex;});return s;},addAsterisk4ShowAllApps:function(s){var n=s;s=s.match(/\S+/g);if(s.length>0){var d;var e=[];for(var i=0;i<s.length;i++){d=s[i];if(d&&d.lastIndexOf("*")!==d.length-1){e.push(d+"*");}else{e.push(d);}}n=e.join(" ");}return n;},createShowMoreSuggestion:function(t){var d=a.getText("showAllNApps",t);d=d.replace(/"/g,"");var e=d;var l="<i>"+d+"</i>";return{title:d,tooltip:e,label:l,dataSource:this.model.appDataSource,labelRaw:this.model.getProperty("/uiFilter/searchTerm"),uiSuggestionType:c.SearchTermData,searchTerm:this.model.getProperty("/uiFilter/searchTerm")||"",};},getSuggestions:function(){var t=this;var d=t.model.getDataSource();if(d!==t.model.allDataSource&&d!==t.model.appDataSource){return Promise.resolve([]);}var s=t.model.getProperty("/uiFilter/searchTerm");return t.suggestApplications(s).then(function(r){var e=r.getElements();e=t.combineSuggestionsWithIdenticalTitle(e);jQuery.each(e,function(i,g){g.uiSuggestionType=c.App;g.dataSource=t.model.appDataSource;g.position=c.properties.App.position;g.key=c.App+g.url+g.icon;});var f=t.suggestionHandler.getSuggestionLimit(c.App);e=e.slice(0,f);if(r.totalResults>f&&d===t.model.appDataSource){e.push(t.createShowMoreSuggestion(r.totalResults));}return e;});},suggestApplications:function(s){return sap.ushell.Container.getServiceAsync("Search").then(function(d){return d.queryApplications({searchTerm:s,suggestion:true,});});},});return m;});
