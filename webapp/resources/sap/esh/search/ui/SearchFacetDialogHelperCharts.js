/*!
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
 */
sap.ui.define(["./i18n","sap/esh/search/ui/controls/SearchFacetPieChart","sap/base/Log","sap/suite/ui/microchart/ComparisonMicroChart","sap/m/Label","sap/m/IconTabFilter","sap/m/Button","sap/m/Bar","sap/m/BarDesign","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/ResizeHandler","sap/suite/ui/microchart/ComparisonMicroChartData","sap/m/ValueColor","sap/m/ActionSheet","sap/m/PlacementType",],function(a,S,L,C,b,I,B,c,d,F,f,R,g,V,A,P){"use strict";var m={};jQuery.extend(m,{init:function(e){this.dialog=e;},getBarChartPlaceholder:function(){var t=this;var o;o=new C({height:"90%",width:"100%",colorPalette:"",tooltip:"",});o.addStyleClass("largeChart1barchart");var e=new F("value",f.GT,0);var h={path:"items",factory:function(){var i=new g({title:"{label}",value:"{value}",color:{path:"selected",formatter:function(v){var r=V.Good;if(!v){r=V.Neutral;}return r;},},displayValue:"{valueLabel}",press:function(E){t.dialog.onDetailPageSelectionChangeCharts(E);},});return i;},filters:[e],};o.bindAggregation("data",h);o.setBusyIndicatorDelay(0);return o;},testWhetherPieWedgeOrLabelIsDummy:function(E){var r=false;var l="";var p=0,h=0;try{l=JSON.stringify(E.getParameters().data[0].data).split('"')[3];p=l.match(/\d+/g)[0];h=l.match(/\d+/g)[1];if(l===a.getText("facetPieChartOverflowText2",[p,h])){r=true;}else if(l===a.getText("facetPieChartOverflowText2",[h,p])){r=true;}}catch(e){}return r;},getPieChartPlaceholder2:function(){var t=this;var o;o=new sap.viz.ui5.controls.VizFrame({width:"100%",vizType:"info/pie",selectData:function(E){if(!t.testWhetherPieWedgeOrLabelIsDummy(E)){t.dialog.onDetailPageSelectionChangeCharts(E);}},deselectData:function(E){if(!t.testWhetherPieWedgeOrLabelIsDummy(E)){t.dialog.onDetailPageSelectionChangeCharts(E);}},});o.attachRenderComplete(function(E){var k=[];var l;var s=this.getBindingContext().getObject().items4pie;if(!s){return o;}for(var i=0;i<s.length;i++){l=s[i];if(l.selected===true){k.push({data:{Label:l.label,},});}}var n={clearSelection:true,};o.vizSelection(k,n);var q,r,u;var v,w,x,y;q=E.getSource().sId;v=$("#"+q+" .v-legend-marker").last();w=$("#"+q+" .v-legend-item").last();if(this.getBindingContext().getObject().items4pie[0].percentageMissingInBigPie>0){x=$("#"+q+" .v-legend-item").length-1;y=$("#"+q+" .v-datapoint-group").children();for(var j=0;j<y.length;j++){u=y[j];r=u.getAttribute("data-id");r=parseInt(r,10);if(r===x){u.remove();break;}}v.attr("fill-opacity","0");v.attr("stroke-opacity","1");v.attr("stroke","black");v.attr("stroke-width","0.5");w.unbind();w.off();}var z=$("#"+q+" .v-background-body");z.unbind();z.off();});o.setVizProperties({legendGroup:{linesOfWrap:0,layout:{maxWidth:0.5,},},title:{visible:false,},interaction:{selectability:{mode:"multiple",},},});o.addStyleClass("largeChart2piechart");var p=new F("pieReady",f.EQ,true);var D=new sap.viz.ui5.data.FlattenedDataset({dimensions:[{name:"Label",value:"{label}",},],measures:[{name:"Value",value:"{valueLabel}",},],data:{path:"items4pie",filters:[p],},});var e=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"size",type:"Measure",values:["Value"],});var h=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"color",type:"Dimension",values:["Label"],});o.setDataset(D);o.addFeed(e);o.addFeed(h);return o;},getPieChartPlaceholder:function(){var t=this;var o;var p={};p.oSearchFacetDialog=t.dialog;o=new S(p);o.addStyleClass("largeChart2piechart");R.register(o,function(e){var s=0;var h=0;if(e.target.firstChild){s=parseInt(window.getComputedStyle(e.target.firstChild,null).getPropertyValue("transform-origin").split(" ")[0],10);h=e.size.width/2-s;e.target.firstChild.style.marginLeft=h+"px";}});return o;},getHeaderWithDropDown:function(t){var e=this;var o=e.getDropDownButton();var l=new b({text:t,});var h=new c({translucent:true,design:d.Header,contentMiddle:[l,o],});h.addStyleClass("sapUshellSearchFacetDialogTabBarHeader");return h;},setDummyTabBarItems:function(o){o.tabBarItems=[new I({text:a.getText("facetList"),icon:"sap-icon://list",key:"list"+arguments[0],}),new I({text:a.getText("facetBarChart"),icon:"sap-icon://horizontal-bar-chart",key:"barChart"+arguments[0],}),new I({text:a.getText("facetPieChart"),icon:"sap-icon://pie-chart",key:"pieChart"+arguments[0],}),];o.chartOnDisplayIndex=0;},getDropDownButton:function(o){var e=[];var h;var D=new B({icon:o.tabBarItems[o.chartOnDisplayIndex].getIcon(),});for(var i=0;i<o.tabBarItems.length;i++){h=new B({text:o.tabBarItems[i].getText(),icon:o.tabBarItems[i].getIcon(),press:function(E){var n,p;p=E.getSource().sId;n=document.getElementById(p).dataset.facetViewIndex;n=parseInt(n,10);o.chartOnDisplayIndex=n;if(o.chartOnDisplayIndex===0){$(".sapUshellSearchFacetDialogSettingsContainer").css("display","block");}else{$(".sapUshellSearchFacetDialogSettingsContainer").css("display","none");}o.chartOnDisplayIndexByFilterArray[o.facetOnDisplayIndex]=n;var q=o.tabBarItems[o.chartOnDisplayIndex].getIcon();D.setIcon(q);var k=o.tabBarItems[o.chartOnDisplayIndex].getText();var l=a.getText("displayAs",[k]);D.setTooltip(l);var r=$(".sapUshellSearchFacetDialogFacetList")[0];if(r){var s=sap.ui.getCore().byId(r.id);if(!s.getSelectedItem()){s.setSelectedItem(s.getItems()[0]);}s.fireSelectionChange({listItem:s.getSelectedItem(),});}o.controlChartVisibility(o,n);},});h.data("facet-view-index",""+i,true);e.push(h);}var j=new A({showCancelButton:true,buttons:e,placement:P.Bottom,cancelButtonPress:function(){L.info("sap.m.ActionSheet: cancelButton is pressed");},});D.addStyleClass("sapUshellSearchFacetDialogTabBarButton");var k=o.tabBarItems[o.chartOnDisplayIndex].getText();var l=a.getText("displayAs",[k]);D.setTooltip(l);D.attachPress(function(){j.openBy(this);});return D;},getListContainersForDetailPage:function(){var t,e,p;var r=[];var h=0;var k=440;var s=$(".searchFacetLargeChartContainer");for(var i=0;i<s.length;i++){if(s[i].clientHeight>0){k=s[i].offsetParent.offsetParent.offsetParent.clientHeight;h=i;break;}}var l=$(".searchFacetLargeChartContainer")[h];if(l){var o=sap.ui.getCore().byId(l.id);var n,q,u;q=$(".sapUshellSearchFacetDialogSubheaderToolbar .sapMSF");n=$(".sapUshellSearchFacetDialogSortButton");u=l.firstChild.children;for(var j=0;j<u.length;j++){if(u[j].className){if(u[j].className.match(/sapMList/)){t=u[j];}else if(u[j].className.match(/barchart/)){e=u[j];}else if(u[j].className.match(/piechart/)){p=u[j];}}}r.push(l);r.push(o);r.push(k);r.push(t);r.push(e);r.push(p);r.push(n);r.push(q);}return r;},});return m;});
