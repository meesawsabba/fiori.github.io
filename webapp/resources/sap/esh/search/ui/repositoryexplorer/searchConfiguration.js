/*!
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
 */
sap.ui.define(["../i18n","./SearchResultSetFormatter","./SuggestionResultSetFormatter","./MetadataFormatter","./SearchResultTableExtend","../uri/CharMapper","../sinaNexTS/sina/LogicalOperator","../sinaNexTS/sina/ComparisonOperator","../sinaNexTS/sina/ComplexCondition","../sinaNexTS/sina/SimpleCondition","sap/m/VBox","sap/m/FlexJustifyContent","sap/m/Label","sap/m/Button","sap/m/ListMode","sap/m/Column","sap/m/ColumnListItem","sap/m/TableSelectDialog","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/json/JSONModel","sap/ui/core/TextDirection","sap/f/IllustratedMessage","sap/f/IllustratedMessageType","sap/f/IllustratedMessageSize",],function(a,S,b,M,c,C,L,d,e,f,V,F,g,B,h,j,k,T,l,m,n,J,o,I,p,q){"use strict";var r=new C(["#","%"]);var s=[];var t=new e.ComplexCondition({operator:L.LogicalOperator.Or,});var u=new f.SimpleCondition({operator:d.ComparisonOperator.Eq,attribute:"technical_type",value:"DWC_REMOTE_TABLE",});t.addCondition(u);var v=new f.SimpleCondition({operator:d.Eq,attribute:"technical_type",value:"DWC_LOCAL_TABLE",});t.addCondition(v);var w=new f.SimpleCondition({operator:d.Eq,attribute:"technical_type",value:"DWC_VIEW",});t.addCondition(w);var x=new f.SimpleCondition({operator:d.Eq,attribute:"technical_type",value:"DWC_ERMODEL",});t.addCondition(x);var y=new f.SimpleCondition({operator:d.Eq,attribute:"technical_type",value:"DWC_DATAFLOW",});t.addCondition(y);var z=new f.SimpleCondition({operator:d.Eq,attribute:"technical_type",value:"DWC_IDT",});t.addCondition(z);var A=new f.SimpleCondition({operator:d.Eq,attribute:"kind",value:"sap.dis.dataflow",});t.addCondition(A);var D=new f.SimpleCondition({operator:d.Eq,attribute:"kind",value:"sap.dwc.dac",});t.addCondition(D);var E={searchOnStart:false,defaultDataSource:"SEARCH_DESIGN",quickSelectDataSources:s,displayNoResultsPageBackButton:false,displayNoResultsPageSearchAllButton:false,displayFacetPanelInCaseOfNoResults:true,facetVisibility:true,browserTitleOverwritten:false,assembleFilteredDataSources:function(i){var G;var H="";if(E.dwcUser&&E.dwcUser.name){H=E.dwcUser.name;}G=i.getDataSource("SEARCH_DESIGN");G.label=a.getText("label_all");G.icon="sap-icon://world";s.push(G);var K=new Date();K.setMonth(K.getMonth()-1);G=i.createDataSource({id:"recent",label:a.getText("collectionRecentObjects"),icon:"sap-icon://history",type:i.DataSourceType.BusinessObject,subType:i.DataSourceSubType.Filtered,dataSource:i.dataSourceMap["SEARCH_DESIGN"],filterCondition:i.createComplexCondition({operator:i.LogicalOperator.And,conditions:[i.createSimpleCondition({attribute:"last_accessed",operator:i.ComparisonOperator.Gt,value:K,}),i.createSimpleCondition({attribute:"last_accessed",operator:i.ComparisonOperator.Lt,value:"$$now$$",}),],}),});G=i.createDataSource({id:"myobjects",label:a.getText("collectionMyObjects"),icon:"sap-icon://switch-classes",type:i.DataSourceType.BusinessObject,subType:i.DataSourceSubType.Filtered,dataSource:i.dataSourceMap["SEARCH_DESIGN"],filterCondition:i.createSimpleCondition({attribute:"creator",operator:i.ComparisonOperator.Eq,value:H,}),});s.push(G);G=i.createDataSource({id:"shared",label:a.getText("collectionShared"),icon:"sap-icon://share-2",type:i.DataSourceType.BusinessObject,subType:i.DataSourceSubType.Filtered,dataSource:i.dataSourceMap["SEARCH_DESIGN"],filterCondition:i.createSimpleCondition({attribute:"shared_with_space_name",operator:i.ComparisonOperator.Ne,value:"NULL",}),});s.push(G);G=i.createDataSource({id:"favorites",label:a.getText("collectionFavorites"),icon:"sap-icon://favorite",type:i.DataSourceType.BusinessObject,subType:i.DataSourceSubType.Filtered,dataSource:i.dataSourceMap["SEARCH_DESIGN"],filterCondition:i.createSimpleCondition({attribute:"favorites_user_id",operator:i.ComparisonOperator.Eq,value:H,}),});s.push(G);},getCustomNoResultScreen:function(i,G){if(typeof i==="undefined"){return;}else{var H=G.getSearchBoxTerm().trim()===""||G.getSearchBoxTerm().trim()==="*";var K=[];var N=q.Scene;var O=a.getText("emptyStateAfterSearchTitle");var P=a.getText("emptyStateAfterSearchDescription");var Q=p.NoSearchResults;if(H){if(i.id==="favorites"){O=a.getText("emptyStateNoFavoritesTitle");P=a.getText("emptyStateNoFavoritesDescription");Q=p.NoSavedItems;}else if(i.id==="shared"){O=a.getText("emptyStateNoObjectsTitle");P=a.getText("emptyStateNoObjectsDescription");Q=p.NoData;}else if(typeof this.getFirstSpaceCondition()!=="undefined"){O=a.getText("emptyStateNoObjectsTitle");P=a.getText("emptyStateNoObjectsDescription");Q=p.NoData;}}else{K.push(new B("",{text:a.getText("backToLastResults"),press:function(){window.history.back();},}));K.push(new B("",{text:a.getText("showAllObjects"),press:function(){G.setSearchBoxTerm("",true);},}).addStyleClass("sapUiTinyMarginBegin"));}var R=new I("",{title:O,description:P,illustrationSize:N,illustrationType:Q,additionalContent:K,}).addStyleClass("sapElisaEmptyStatePage-no-result");return new V("",{items:R,width:"100%",justifyContent:F.Center,visible:{parts:["/count","/isBusy","/firstSearchWasExecuted"],formatter:function(U,W,X){return U===0&&!W&&X;},},});}},hideListView:true,gridView:true,enableMultiSelectionResultItems:true,pageSize:30,layoutUseResponsiveSplitter:true,facetPanelWidthInPercent:18,FF_facetPanelUnifiedHeaderStyling:true,searchFilterBarShowWithFacets:true,searchBarDoNotHideForNoResults:true,FF_layoutWithoutPage:true,defaultResultViewType:"searchResultTable",updateUrl:true,beforeNavigation:function(i){i.invalidateQuery();},parseSearchUrlParameters:function(U){if(U&&U.filter){U.filter=r.unmap(U.filter);}return U;},renderSearchUrl:function(i){return("#/repositoryexplorer&/rex/search?top="+i.top+"&filter="+i.filter);},isSearchUrl:function(i){return i.indexOf("#/repositoryexplorer")===0;},titleColumnName:"businessName",titleColumnWidth:"16rem",extendTableColumn:c.extendTableColumn,boSuggestions:true,searchInAttibuteFacetPostion:{space_description:1,},cleanUpSpaceFilters:function(i,G){var H=i.getProperty("/uiFilter");if(G){if(G.attribute==="space_description"){H.rootCondition.removeAttributeConditions("space_description");H.dataSource=this.quickSelectDataSources[0];i.setProperty("/searchTermPlaceholder",i.calculatePlaceholder());}}else{H.rootCondition.removeAttributeConditions("space_description");}},hasSpaceFiltersOnly:function(i){var G=i.getAttributeConditions("space_description");if(G.length>0){var H=i.clone();H.removeAttributeConditions("space_description");if(!H.hasFilters()){return true;}}return false;},getFirstSpaceCondition:function(i){if(typeof i==="undefined"){return undefined;}else{if(i.rootCondition&&i.rootCondition.hasFilters()){for(var _=0,G=i.rootCondition.conditions;_<G.length;_++){var H=G[_];var K=H.getAttributeConditions("space_description");for(var N=0,O=K;N<O.length;N++){var P=O[N];return P;}}}}return undefined;},setSearchInLabelIconBindings:function(i){var G=i.getProperty("/uiFilter");var H=G.rootCondition.getAttributeConditions("space_description");var K="";var N="";if(H.length>0){K=H[0].valueLabel||"";N="sap-icon://sac/data-space-management";}else{var O=s.find(function(P){return P.id===G.dataSource.id;});if(O){K=O.label;N=O.icon;}}i.setProperty("/searchInLabel",K);i.setProperty("/searchInIcon",N);},getSearchInFacetListMode:function(i){if(i.dimension==="space_description"){return h.SingleSelectMaster;}},checkAndSetSpaceIcon:function(i,G){if(G==="space_description"){return"sap-icon://sac/data-space-management";}return i;},bNoAppSearch:true,bResetSearchTermOnQuickSelectDataSourceItemPress:true,FF_bSearchtermNoAsterisk:true,bPlaceHolderFixedValue:false,FF_bOptimizedQuickSelectDataSourceLabels:true,getPlaceholderLabelForDatasourceAll:function(){return a.getText("label_all");},setQuickSelectDataSourceAllAppearsNotSelected:function(i,G){var H=i.getDomRef().closest(".sapUshellSearchFacetSearchInAttribute");if(!H||!i.getSelectedItem()){return;}var K=G.getDataSource();if(K&&K.id==="SEARCH_DESIGN"){var N="sapUshellSearchFacetQuickSelectDataSource";N=this.id?this.id+"-"+N:N;var O=sap.ui.getCore().byId(N);O.getSelectedItem().getDomRef().classList.remove("sapMLIBSelected");}},showSpaceFacetInShowMoreDialog:function(i){if(i==="space_description"){return false;}return true;},getSpaceFacetId:function(i,G){if(i==="space_description"){return"sapUshellSearchFacetSearchInAttributeSpace";}return G;},openSpaceShowMoreDialog:function(G,H){var K=H.query.filter.clone();K.rootCondition.removeAttributeConditions("space_description");var N=H.sinaNext.createChartQuery({filter:K,dimension:G,top:1000,});return N.getResultSetAsync().then(function(O){var P=H.oFacetFormatter.getDialogFacetsFromChartQuery(O,H,true,G);for(var i=0;i<P.items.length;i++){var Q=P.items[i];delete Q.filterCondition.sina;}var R=function(){return[new j({hAlign:"Begin",width:"60%",popinDisplay:"Inline",minScreenWidth:"Tablet",demandPopin:true,}),new j({hAlign:"End",width:"30%",popinDisplay:"Inline",minScreenWidth:"Tablet",demandPopin:true,}),];};var U=function(Z){var $=[],_=Z.getParameter("value"),a1=Z.getParameter("itemsBinding");if(_!==undefined&&_.length>0){$.push(new m("label",n.Contains,_));}a1.filter($,"Application");};var W=new T("",{title:a.getText("selectspace"),contentWidth:"30rem",columns:[R()],search:U,liveChange:U,});var X=new J();X.setDefaultBindingMode("OneWay");X.setData(P);W.setModel(X);var Y=new k({type:"Active",unread:false,cells:[new g({text:"{label}",}),new g({text:"{value}",}),],});W.attachConfirm(function(Z){var $=Z.getParameter("selectedContexts");if($&&$.length&&$.length>0){var _=$[0].getObject();H.addFilterCondition(_.filterCondition,false);H.filterChanged=true;H._firePerspectiveQuery();}});W.bindAggregation("items","/items",Y);if(G==="space_description"){W.getBinding("items").sort([new sap.ui.model.Sorter({path:"label",descending:false})]);}W.open();},function(i){var O=a.getText("searchError");var P=i.message;l.error(P,{icon:l.Icon.NONE,title:O,actions:l.Action.OK,onClose:null,styleClass:"",initialFocus:null,textDirection:o.Inherit,});});},initAsync:function(){},};E.sinaConfiguration={provider:"hana_odata",url:"/dwaas-core/repository/search",metaDataSuffix:"SEARCH_DESIGN",querySuffix:t,odataVersion:"",searchResultSetFormatters:[new S()],suggestionResultSetFormatters:[new b()],metadataFormatters:[new M(E)],initAsync:function(i){E.assembleFilteredDataSources(i);},};return E;});
