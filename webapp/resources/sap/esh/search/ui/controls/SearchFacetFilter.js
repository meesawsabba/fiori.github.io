/*!
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
 */
sap.ui.define(["../i18n","sap/m/IconTabFilter","sap/m/Button","sap/m/VBox","sap/m/GroupHeaderListItem","./../error/errors","sap/esh/search/ui/controls/SearchFacetQuickSelectDataSource","sap/esh/search/ui/controls/SearchFacetHierarchy","sap/esh/search/ui/controls/SearchFacet","sap/esh/search/ui/controls/SearchFacetTabBar","sap/esh/search/ui/controls/SearchFacetBarChart","sap/esh/search/ui/controls/SearchFacetPieChart",],function(a,I,B,V,G,e,S,b,c,d,f,g){"use strict";var m=d.extend("my.IconTabBar",{renderer:"sap.esh.search.ui.controls.SearchFacetTabBarRenderer",setEshRole:function(){var h=this.getItems();for(var i=0;i<h.length;++i){var j=h[i];var k=j.getContent()[0];k.setEshRole.apply(k,arguments);}},getEshRole:function(){var i=this.getItems();var h=i[0];var j=h.getContent()[0];return j.getEshRole.apply(j,arguments);},attachSelectionChange:function(){},});return sap.ui.core.Control.extend("sap.esh.search.ui.controls.SearchFacetFilter",{metadata:{properties:{title:"string",},aggregations:{facets:{multiple:true,},},},init:function(){this.data("sap-ui-fastnavgroup","true",true);},constructor:function(o){o=jQuery.extend({},{},o);sap.ui.core.Control.prototype.constructor.apply(this,[o]);this.bindAggregation("facets",{path:"/facets",factory:function(i,C){var h=C.getObject();var M=C.getModel();var j=M.config;switch(h.facetType){case"attribute":var s="attribute_facet"+i;if(j&&typeof j.getSpaceFacetId==="function"){s=j.getSpaceFacetId(h.dimension,s);}if(j&&j.id){s=j.id+"-"+s;}var l={};l.id="barChart"+arguments[0];var n=new m(s,{items:[new I({text:a.getText("facetList"),icon:"sap-icon://list",key:"list"+arguments[0],content:new c("list"+arguments[0]),}),new I({text:a.getText("facetBarChart"),icon:"sap-icon://horizontal-bar-chart",key:"barChart"+arguments[0],content:new f(l),}),new I({text:a.getText("facetPieChart"),icon:"sap-icon://pie-chart",key:"pieChart"+arguments[0],content:new g("pieChart"+arguments[0]),}),],});n.addStyleClass("sapUshellSearchFacetIconTabBar");return n;case"datasource":return new c((j&&j.id?j.id+"-":"")+"dataSourceFacet");case"quickSelectDataSource":var q=new S((j&&j.id?j.id+"-":"")+"sapUshellSearchFacetQuickSelectDataSource",{});if(j&&j.FF_facetPanelUnifiedHeaderStyling){var p=new G({title:a.getText("quickSelectDataSourcesHeader"),});p.addStyleClass("sapUshellSearchFacetTabBarHeader");p.addStyleClass("sapElisaSearchFacetTabBarHeaderUl");return new V("",{items:[p,q],});}return q;case"hierarchy":var r="attribute_facet"+i;return new b(r,{});default:{var k=new Error("program error: unknown facet type "+h.facetType);throw new e.UnknownFacetType(k);}}},});},fireReset:function(){(this.getModel()).resetFilterConditions(false);(this.getModel()).setDataSource((this.getModel()).allDataSource,true);},renderer:function(r,C){var h=function(){return function(){var k=(sap.ui.getCore().byId($($(this.getDomRef()).closest(".sapUshellSearchFacet")[0]).attr("id")));var F=new sap.esh.search.ui.SearchFacetDialogModel(C.getModel());F.initBusinessObjSearch().then(function(){F.setData(C.getModel().getData());F.config=C.getModel().config;F.sinaNext=C.getModel().sinaNext;F.prepareFacetList();var q=null;if(k&&k.getBindingContext()&&k.getBindingContext().getObject()&&k.getBindingContext().getObject().dimension){q=(k.getBindingContext().getObject()).dimension;}var D=new sap.esh.search.ui.controls.SearchFacetDialog({selectedAttribute:q,});D.setModel(F);D.setModel(C.getModel(),"searchModel");D.open();var P=C.getParent().getParent().getParent().getParent();P.oFacetDialog=D;C.getModel().eventLogger.logEvent({type:C.getModel().eventLogger.FACET_SHOW_MORE,});});};};r.write("<div");r.writeControlData(C);r.addClass("sapUshellSearchFacetFilter");r.writeClasses();r.write(">");var j=true;for(var i=0,l=C.getFacets().length;i<l;i++){var k=C.getFacets()[i];var n=k.getBindingContext().getObject();switch(n.facetType){case"attribute":k.setEshRole("attribute");k.attachSelectionChange(null,function(){jQuery(C.showAllBtn.getDomRef()).hide();});if(n.position>999){if(j){k.setHeaderText(a.getText("filterBy"));j=false;}}else{k.setHeaderText(n.title);k.addStyleClass("sapUshellSearchFacetSearchInAttribute");}r.renderControl(k);break;case"datasource":k.setEshRole("datasource");k.addStyleClass("sapUshellSearchFacetDataSource");r.renderControl(k);break;case"quickSelectDataSource":if(C.getModel().config&&C.getModel().config.FF_facetPanelUnifiedHeaderStyling){}else{k.setHeaderText(a.getText("quickSelectDataSourcesHeader"));}r.renderControl(k);break;case"hierarchy":if(n.position>999){if(j){k.setHeaderText(a.getText("filterBy"));j=false;}}else{k.setHeaderText(n.title);k.addStyleClass("sapUshellSearchFacetSearchInAttribute");}r.renderControl(k);break;default:throw"program error: unknown facet type :"+n.facetType;}}if(C.getModel().getDataSource()&&C.getModel().getDataSource().type==="BusinessObject"){var o=C.getModel().oFacetFormatter.hasDialogFacetsFromMetaData(C.getModel());var p=C.getModel().getProperty("/boCount")>0;if(o&&p){r.write("<div>");C.showAllBtn=new B({text:"{showAllFilters}",press:h(),visible:true,});C.showAllBtn.setModel(C.getModel("i18n"));C.showAllBtn.addStyleClass("sapUshellSearchFacetFilterShowAllFilterBtn");r.renderControl(C.showAllBtn);r.write("</div>");}}r.write("</div>");},onAfterRendering:function(){var h=$(".searchFacetFilter .searchFacet").first().find("ul");var i=h.find("li");h.attr("role","tree");i.attr("role","treeitem");},});});
