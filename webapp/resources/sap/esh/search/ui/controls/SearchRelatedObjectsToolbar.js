/*!
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
 */
sap.ui.define(["../i18n","sap/esh/search/ui/SearchModel","sap/m/Toolbar","sap/m/ToolbarDesign","sap/m/Button","sap/m/Link","sap/m/ToolbarLayoutData","sap/m/ToolbarSpacer","sap/m/ActionSheet","sap/m/PlacementType","sap/ui/core/InvisibleText","sap/ui/core/IconPool","sap/ui/core/delegate/ItemNavigation",],function(a,S,T,b,B,L,c,d,A,P,I,e,f){"use strict";var m=sap.ui.core.Control.extend("sap.esh.search.ui.controls.SearchRelatedObjectsToolbar",{metadata:{properties:{itemId:"string",navigationObjects:{type:"object",multiple:true,},positionInList:"int",},aggregations:{_relatedObjectActionsToolbar:{type:"sap.m.Toolbar",multiple:false,visibility:"hidden",},_ariaDescriptionForLinks:{type:"sap.ui.core.InvisibleText",multiple:false,visibility:"hidden",},},},init:function(){var t=this;if(sap.ui.core.Control.prototype.init){sap.ui.core.Control.prototype.init.apply(t,arguments);}sap.esh.search.ui.controls.SearchRelatedObjectsToolbar._allOfMyCurrentInstances.push(t);t.setAggregation("_relatedObjectActionsToolbar",new T({design:b.Solid,}).data("sap-ui-fastnavgroup","false",true).addStyleClass("sapUshellSearchResultListItem-RelatedObjectsToolbar-Toolbar"));t.setAggregation("_ariaDescriptionForLinks",new I({text:a.getText("result_list_item_aria_has_more_links"),}));},exit:function(){var t=this;if(sap.ui.core.Control.prototype.exit){sap.ui.core.Control.prototype.exit.apply(t,arguments);}var g=sap.esh.search.ui.controls.SearchRelatedObjectsToolbar._allOfMyCurrentInstances;for(var i=0;i<g.length;i++){if(g[i]===t){g.splice(i,1);break;}}if(t.searchLayoutChangedIsSubscribed){t.searchLayoutChangedIsSubscribed=false;t.getModel().unsubscribe("searchLayoutChanged",t._layoutToolbarElements,t);}},renderer:function(r,C){r.write("<div");r.writeControlData(C);r.addClass("sapUshellSearchResultListItem-RelatedObjectsToolbar");r.writeClasses();r.write(">");r.renderControl(C.getAggregation("_ariaDescriptionForLinks"));C._renderToolbar(r);r.write("</div>");},_renderToolbar:function(r){var t=this;var i;var _=t.getAggregation("_relatedObjectActionsToolbar");_.destroyContent();var g=function(j){return function(){t._performNavigation(j,{trackingOnly:true,});};};var n=t.getNavigationObjects();if(n.length>0){var h=[];for(i=0;i<n.length;i++){var j=n[i];var l=new L({text:j.getText(),href:j.getHref(),layoutData:new c({shrinkable:false,}),press:g(j),});var k=j.getTarget();if(k){l.setTarget(k);}l.addStyleClass("sapUshellSearchResultListItem-RelatedObjectsToolbar-Element");h.push(l);}var o=new d();o.addStyleClass("sapUshellSearchResultListItem-RelatedObjectsToolbar-Spacer");_.addContent(o);for(i=0;i<h.length;i++){_.addContent(h[i]);}t._overFlowButton=new B({icon:e.getIconURI("overflow"),});t._overFlowButton.addStyleClass("sapUshellSearchResultListItem-RelatedObjectsToolbar-OverFlowButton");_.addContent(t._overFlowButton);t._overFlowSheet=new A({placement:P.Top,});t._overFlowButton.attachPress(function(){t._overFlowSheet.openBy(t._overFlowButton);});r.renderControl(_);}},onAfterRendering:function(){var t=this;if(t.getAggregation("_relatedObjectActionsToolbar")){t._layoutToolbarElements();t._addAriaInformation();}if(!t.searchLayoutChangedIsSubscribed){t.getModel().subscribe("searchLayoutChanged",t._layoutToolbarElements,t);t.searchLayoutChangedIsSubscribed=true;}},_layoutToolbarElements:function(){var t=this;var _=t.getAggregation("_relatedObjectActionsToolbar");if(!(t.getDomRef()&&_.getDomRef())){return;}var g=$(_.getDomRef());var h=g.width();if($(t.getDomRef()).css("display")==="none"||g.css("display")==="none"){return;}t.toolbarWidth=h;var j=$(t._overFlowButton.getDomRef());j.css("display","none");var k=0;var p=function(v,w){t._performNavigation(w);};var l=g.find(".sapUshellSearchResultListItem-RelatedObjectsToolbar-Element");for(var i=0;i<l.length;i++){var n=$(l[i]);n.css("display","");var o=k+n.outerWidth(true);if(o>h){if(i<l.length){j.css("display","");var q=j.outerWidth(true);for(;i>=0;i--){n=$(l[i]);o-=n.outerWidth(true);if(o+q<=h){break;}}}var r=t.getNavigationObjects();t._overFlowSheet.destroyButtons();i=i>=0?i:0;for(;i<l.length;i++){n=$(l[i]);n.css("display","none");var s=r[i];var u=new B({text:s.getText(),});u.attachPress(s,p);t._overFlowSheet.addButton(u);}break;}k=o;}t._setupItemNavigation();},_setupItemNavigation:function(){var t=this;if(!t.theItemNavigation){t.theItemNavigation=new f();t.addDelegate(t.theItemNavigation);}t.theItemNavigation.setCycling(false);t.theItemNavigation.setRootDomRef(t.getDomRef());var g=[];var _=t.getAggregation("_relatedObjectActionsToolbar");var h=_.getContent();for(var i=0;i<h.length;i++){if(!h[i].hasStyleClass("sapUshellSearchResultListItem-RelatedObjectsToolbar-Element")){continue;}if(!$(h[i].getDomRef()).attr("tabindex")){var j="-1";if(h[i].getPressed&&h[i].getPressed()){j="0";}$(h[i].getDomRef()).attr("tabindex",j);}g.push(h[i].getDomRef());}var k=t._overFlowButton.getDomRef();g.push(k);$(k).attr("tabindex","-1");t.theItemNavigation.setItemDomRefs(g);},_addAriaInformation:function(){var t=this;var g=$(this.getAggregation("_relatedObjectActionsToolbar").getDomRef());var h=g.find(".sapUshellSearchResultListItem-RelatedObjectsToolbar-Element");var i=$(t._overFlowButton.getDomRef());if(h.length>0||i.is(":visible")){var j=t.getAggregation("_ariaDescriptionForLinks").getId();h.each(function(){var l=$(this);var k=l.attr("aria-describedby")||"";k+=" "+j;l.attr("aria-describedby",k);});if(i.is(":visible")){var k=i.attr("aria-describedby")||"";k+=" "+j;i.attr("aria-describedby",k);}}},_performNavigation:function(n,p){var t=(p&&p.trackingOnly)||false;n.performNavigation({trackingOnly:t,});},});m._allOfMyCurrentInstances=[];$(window).on("resize",function(){for(var i=0;i<this._allOfMyCurrentInstances.length;i++){this._allOfMyCurrentInstances[i]._layoutToolbarElements();}}.bind(m));return m;});
