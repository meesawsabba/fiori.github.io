/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){var a=(this&&this.__extends)||(function(){var e=function(d,b){e=Object.setPrototypeOf||({__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;})||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p];};return e(d,b);};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");e(d,b);function _(){this.constructor=d;}d.prototype=b===null?Object.create(b):(_.prototype=b.prototype,new _());};})();var c=(this&&this.__awaiter)||function(t,_,P,g){function b(v){return v instanceof P?v:new P(function(r){r(v);});}return new(P||(P=Promise))(function(r,d){function f(v){try{s(g.next(v));}catch(e){d(e);}}function i(v){try{s(g["throw"](v));}catch(e){d(e);}}function s(e){e.done?r(e.value):b(e.value).then(f,i);}s((g=g.apply(t,_||[])).next());});};var h=(this&&this.__generator)||function(b,d){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1];},trys:[],ops:[]},f,y,t,g;return g={next:i(0),"throw":i(1),"return":i(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this;}),g;function i(n){return function(v){return s([n,v]);};}function s(o){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=o[0]&2?y["return"]:o[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,o[1])).done)return t;if(y=0,t)o=[o[0]&2,t.value];switch(o[0]){case 0:case 1:t=o;break;case 4:_.label++;return{value:o[1],done:false};case 5:_.label++;y=o[1];o=[0];continue;case 7:o=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(o[0]===6||o[0]===2)){_=0;continue;}if(o[0]===3&&(!t||(o[1]>t[0]&&o[1]<t[3]))){_.label=o[1];break;}if(o[0]===6&&_.label<t[1]){_.label=t[1];t=o;break;}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(o);break;}if(t[2])_.ops.pop();_.trys.pop();continue;}o=d.call(b,_);}catch(e){o=[6,e];y=0;}finally{f=t=0;}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:true};}};sap.ui.define(["require","exports","../../sina/DataSourceType","./MetadataParser","./HierarchyMetadataParser"],function(r,b,D,M,H){"use strict";Object.defineProperty(b,"__esModule",{value:true});b.MetadataParserXML=void 0;var d=(function(_){a(d,_);function d(p){return _.call(this,p)||this;}d.prototype._getWindow=function(){return c(this,void 0,void 0,function(){var j,f,e,g;return h(this,function(i){if(typeof window==="undefined"){if(typeof this.jsDOMWindow==="undefined"){j=r("jsdom");f=r("fs");e=f.readFileSync("./node_modules/jquery/dist/jquery.js","utf-8");g=new j.JSDOM("<html><script>"+e+"</script><body></body></html>",{runScripts:"dangerously",});this.jsDOMWindow=g.window;g.window.$=g.window.jQuery;}return[2,this.jsDOMWindow];}return[2,window];});});};d.prototype.fireRequest=function(e,u){return c(this,void 0,void 0,function(){var f;return h(this,function(g){switch(g.label){case 0:return[4,e.getXML(u)];case 1:f=g.sent();return[2,f];}});});};d.prototype.parseResponse=function(m){return c(this,void 0,void 0,function(){var t,e,w,x;return h(this,function(f){switch(f.label){case 0:t=this;e={businessObjectMap:{},businessObjectList:[],dataSourceMap:{},dataSourcesList:[],};return[4,this._getWindow()];case 1:w=f.sent();x=w.$.parseXML(m);w.$(x).find("Schema").each(function(){var $=w.$(this);var g=t._parseEntityType($,w);t._parseEntityContainer($,g,e,w);});return[2,e];}});});};d.prototype._parseEntityType=function(s,w){var t=this;var f={};s=w.$(s);var g=new H.HierarchyMetadataParser(w.$);s.find("EntityType").each(function(){var j=w.$(this).attr("Name");var k={schema:s.attr("Namespace"),keys:[],attributeMap:{},resourceBundle:"",labelResourceBundle:"",label:"",labelPlural:"",annotations:{},hierarchyDefinitionsMap:{},icon:"",};f[j]=k;w.$(this).find("Key>PropertyRef").each(function(){k.keys.push(w.$(this).attr("Name"));});w.$(this).find('>Annotation[Term="EnterpriseSearch.hierarchy.parentChild"]').each(function(){k.hierarchyDefinitionsMap=g.parse(this);});w.$(this).find('Annotation[Term="Search.searchable"]').each(function(){w.$(this).siblings("Annotation").each(function(){var $=w.$(this);var i=$.attr("Term");if(i!==undefined&&i.length>0){i=i.toUpperCase();var l=t._getValueFromElement(this,w);if(i==="ENTERPRISESEARCHHANA.UIRESOURCE.LABEL.BUNDLE"){var m=l;try{k.resourceBundle=w.jQuery.sap.resources({url:m,language:w.sap.ui.getCore().getConfiguration().getLanguage(),});}catch(e){t.log.error("Resource bundle of "+j+" '"+m+"' can't be found:"+e.toString());}}else if(i==="ENTERPRISESEARCHHANA.UIRESOURCE.LABEL.KEY"){var K=l;if(K&&k.resourceBundle){var T=k.resourceBundle.getText(K);if(T){k.labelResourceBundle=T;}}}else if(i==="UI.HEADERINFO.TYPENAME"){k.label=l;}else if(i==="UI.HEADERINFO.TYPENAMEPLURAL"){k.labelPlural=l;}else if(i==="UI.HEADERINFO.TITLE.TYPE"){t._setAnnotationValue(k.annotations,i,l);}else if(i==="UI.HEADERINFO.TITLE.VALUEQUALIFIER"){t._setAnnotationValue(k.annotations,i,l);}else if(i==="UI.HEADERINFO.TYPEIMAGEURL"){k.icon=l;}else{t._setAnnotationValue(k.annotations,i,l);}}});});w.$(this).find("Property").each(function(e){var l=w.$(this).attr("Name");var m={labelRaw:l,label:null,type:w.$(this).attr("Type"),presentationUsage:[],isFacet:false,isSortable:false,supportsTextSearch:false,displayOrder:e,annotationsAttr:{},unknownAnnotation:[],hierarchyDefinition:k.hierarchyDefinitionsMap[l],};k.attributeMap[l]=m;w.$(this).find("Annotation").each(function(){var o=w.$(this).attr("Term");if(o!==undefined&&o.length>0){o=o.toUpperCase();var p=t._getValueFromElement(this,w);if(p==undefined){w.$(this).children("Collection").children("Record").each(function(){p=p||[];var q={};p.push(q);w.$(this).children("PropertyValue").each(function(){var u=w.$(this).attr("Property");if(u!==undefined&&u.length>0){u=u.toUpperCase();var v=t._getValueFromElement(this,w);if(v!==undefined){q[u]=v;}}});});}if(p!==undefined){switch(o){case"SAP.COMMON.LABEL":if(!m.label){m.label=p;}break;case"ENTERPRISESEARCHHANA.UIRESOURCE.LABEL.KEY":if(p&&k.resourceBundle){var T=k.resourceBundle.getText(p);if(T){m.label=T;}}break;case"ENTERPRISESEARCH.KEY":m.isKey=p;break;case"ENTERPRISESEARCH.PRESENTATIONMODE":w.$(this).find("Collection>String").each(function(){var q=t._getValueFromElement(this,w);if(q){m.presentationUsage.push(q);}});break;case"ENTERPRISESEARCHHANA.ISSORTABLE":m.isSortable=p;break;case"ENTERPRISESEARCHHANA.SUPPORTSTEXTSEARCH":m.supportsTextSearch=p;break;case"ENTERPRISESEARCH.FILTERINGFACET.DEFAULT":m.isFacet=p;break;case"ENTERPRISESEARCH.DISPLAYORDER":m.displayOrder=p;break;default:if(o.startsWith("UI")||o.startsWith("OBJECTMODEL")||o.startsWith("SEMANTICS")){t._setAnnotationValue(m.annotationsAttr,o,p);}else{m.unknownAnnotation.push(w.$(this));}}}}});var n=m.annotationsAttr.UI&&m.annotationsAttr.UI.IDENTIFICATION;if(n){if(n.POSITION!==undefined){m.displayOrder=n.POSITION;}else if(Array.isArray(n)){for(var i=0;i<n.length;i++){if(n[i].TYPE==undefined&&n[i].POSITION!==undefined){m.displayOrder=n[i].POSITION;break;}}}}});});return f;};d.prototype._getValueFromElement=function(f,w){var $=w.$(f);var v=$.text();if(!v||v.trim().length==0){v=undefined;if($.attr("String")!==undefined){v=$.attr("String");}else if($.attr("Decimal")!==undefined){try{v=Number.parseFloat($.attr("Decimal"));if(isNaN(v)){v=undefined;}}catch(e){v=undefined;}}else if($.attr("Int")!==undefined){try{v=Number.parseInt($.attr("Int"),10);if(isNaN(v)){v=undefined;}}catch(e){v=undefined;}}else if($.attr("Bool")!==undefined){v=$.attr("Bool")=="true";}}return v;};d.prototype._parseEntityContainer=function(s,e,f,w){var t=this;s.find("EntityContainer>EntitySet").each(function(){if(w.$(this).attr("Name")&&w.$(this).attr("EntityType")){var n=w.$(this).attr("Name");var g=w.$(this).attr("EntityType");var i=g.slice(g.lastIndexOf(".")+1);var j=e[i];if(j===undefined){throw"EntityType "+i+" has no corresponding meta data!";}var k=t.sina._createDataSource({id:n,label:j.labelResourceBundle||j.label||n,labelPlural:j.labelResourceBundle||j.labelPlural||j.label||n,icon:j.icon||"",type:D.DataSourceType.BusinessObject,attributesMetadata:[{id:"dummy",},],});k.annotations=j.annotations;f.dataSourceMap[k.id]=k;f.dataSourcesList.push(k);j.name=n;j.dataSource=k;f.businessObjectMap[n]=j;f.businessObjectList.push(j);}});};return d;}(M.MetadataParser));b.MetadataParserXML=d;});})();
