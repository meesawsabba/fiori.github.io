/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){var _=(this&&this.__extends)||(function(){var e=function(d,b){e=Object.setPrototypeOf||({__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;})||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p];};return e(d,b);};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");e(d,b);function a(){this.constructor=d;}d.prototype=b===null?Object.create(b):(a.prototype=b.prototype,new a());};})();sap.ui.define(["require","exports","../../sina/SinaObject","../../core/util","./typeConverter"],function(r,e,S,u,t){"use strict";Object.defineProperty(e,"__esModule",{value:true});e.ItemParser=void 0;var I=(function(a){_(I,a);function I(p){var b=a.call(this)||this;b.provider=p;b.sina=p.sina;b.intentsResolver=b.sina._createFioriIntentsResolver();b.suvNavTargetResolver=b.sina._createSuvNavTargetResolver();return b;}I.prototype.parse=function(s,d){if(d.ResultList.SearchResults===null){return Promise.resolve([]);}var i=d.ResultList.SearchResults.results;return this.parseItems(i);};I.prototype.parseItems=function(b){var c=[];for(var i=0;i<b.length;++i){var d=b[i];var f=this.parseItem(d);c.push(f);}return Promise.all(c);};I.prototype.parseItem=function(i){var j;var b={};var c=[];var d=[];var f=[];var g=[];var s,h,k,l;var m={};var w=[];var n=[];var o;var p=this.sina.getDataSource(i.DataSourceId);var q,v,x,y;var z=[];var A=i.Score/100;for(j=0;j<i.Attributes.results.length;j++){q=i.Attributes.results[j];v=p.getAttributeMetadata(q.Id);x=this.sina._createSearchResultSetItemAttribute({id:q.Id,label:v.label,value:t.odata2Sina(v.type,q.Value),valueFormatted:q.ValueFormatted!==undefined?q.ValueFormatted:q.Value,valueHighlighted:q.Snippet||"",isHighlighted:q.Snippet.indexOf("<b>")>-1&&q.Snippet.indexOf("</b>")>-1,metadata:v,groups:[],});x.valueHighlighted=q.Snippet;b[x.id]=x;u.appendRemovingDuplicates(z,u.extractHighlightedTerms(x.valueHighlighted));if(v.suvUrlAttribute&&v.suvMimeTypeAttribute){k=b[v.suvUrlAttribute]||v.suvUrlAttribute.id;l=b[v.suvMimeTypeAttribute]||v.suvMimeTypeAttribute.id;m[q.Id]={suvThumbnailAttribute:x,suvTargetUrlAttribute:k,suvTargetMimeTypeAttribute:l,};}if(v.usage.Navigation){if(v.usage.Navigation.mainNavigation){o=this.sina._createNavigationTarget({label:x.value,targetUrl:x.value,target:"_blank",});}}f.push(x);if(v.usage.Detail){g.push(x);}if(!v.usage.Title&&!v.usage.Detail&&!v.isDescription&&(x.isHighlighted||(x.descriptionAttribute&&x.descriptionAttribute.isHighlighted))&&!this._parentHasUsage(v,["Detail","Title"])){w.push(x);}if(v.usage.Title){c.push(x);}if(v.usage.TitleDescription){d.push(x);}y=p.attributeMetadataMap[x.id]._private.semanticObjectType;if(y&&y.length>0){n.push({name:y,value:x.value,type:x.metadata.type,});}}for(h in m){s=m[h];if(typeof s.suvTargetUrlAttribute==="string"){s.suvTargetUrlAttribute=b[s.suvTargetUrlAttribute];}if(typeof s.suvTargetMimeTypeAttribute==="string"){s.suvTargetMimeTypeAttribute=b[s.suvTargetMimeTypeAttribute];}if(!(s.suvTargetUrlAttribute||s.suvTargetMimeTypeAttribute)){delete m[h];}}c.sort(function(E,F){return E.metadata.usage.Title.displayOrder-F.metadata.usage.Title.displayOrder;});g.sort(function(E,F){return E.metadata.usage.Detail.displayOrder-F.metadata.usage.Detail.displayOrder;});var B=this._parseHitAttributes(i,p,z);w=w.concat(B);g=g.concat(w);this.suvNavTargetResolver.resolveSuvNavTargets(p,m,z);var C=this.sina._createSearchResultSetItem({dataSource:p,attributes:f,titleAttributes:c,titleDescriptionAttributes:d,detailAttributes:g,defaultNavigationTarget:o,navigationTargets:[],score:A,});C._private.allAttributesMap=b;C._private.semanticObjectTypeAttributes=n;var D=this.sina._createItemPostParser({searchResultSetItem:C,});return D.postParseResultSetItem();};I.prototype._parentHasUsage=function(m,b){for(var i=0;i<m.groups.length;i++){var g=m.groups[i].group;var h=false;for(var j=0;j<b.length;j++){if(g.usage[b[j]]!==undefined){h=true;break;}}if(h||this._parentHasUsage(g,b)){return true;}}return false;};I.prototype._parseHitAttributes=function(b,d,s){var h=[];if(b.HitAttributes!==null){for(var i=0;i<b.HitAttributes.results.length;i++){var c=b.HitAttributes.results[i];var m=d.getAttributeMetadata(c.Id);var v=t.odata2Sina(m.type,u.filterString(c.Snippet,["<b>","</b>"]));var f=this.sina._createSearchResultSetItemAttribute({id:c.Id,label:m.label,value:v,valueFormatted:v,valueHighlighted:c.Snippet,isHighlighted:c.Snippet.indexOf("<b>")>-1&&c.Snippet.indexOf("</b>")>-1,metadata:m,});u.appendRemovingDuplicates(s,u.extractHighlightedTerms(f.valueHighlighted));h.push(f);}}return h;};return I;}(S.SinaObject));e.ItemParser=I;});})();
