/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){var a=(this&&this.__extends)||(function(){var e=function(d,b){e=Object.setPrototypeOf||({__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;})||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p];};return e(d,b);};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");e(d,b);function _(){this.constructor=d;}d.prototype=b===null?Object.create(b):(_.prototype=b.prototype,new _());};})();var c=(this&&this.__awaiter)||function(t,_,P,g){function b(v){return v instanceof P?v:new P(function(r){r(v);});}return new(P||(P=Promise))(function(r,d){function f(v){try{s(g.next(v));}catch(e){d(e);}}function h(v){try{s(g["throw"](v));}catch(e){d(e);}}function s(e){e.done?r(e.value):b(e.value).then(f,h);}s((g=g.apply(t,_||[])).next());});};var l=(this&&this.__generator)||function(b,d){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1];},trys:[],ops:[]},f,y,t,g;return g={next:h(0),"throw":h(1),"return":h(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this;}),g;function h(n){return function(v){return s([n,v]);};}function s(o){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=o[0]&2?y["return"]:o[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,o[1])).done)return t;if(y=0,t)o=[o[0]&2,t.value];switch(o[0]){case 0:case 1:t=o;break;case 4:_.label++;return{value:o[1],done:false};case 5:_.label++;y=o[1];o=[0];continue;case 7:o=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(o[0]===6||o[0]===2)){_=0;continue;}if(o[0]===3&&(!t||(o[1]>t[0]&&o[1]<t[3]))){_.label=o[1];break;}if(o[0]===6&&_.label<t[1]){_.label=t[1];t=o;break;}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(o);break;}if(t[2])_.ops.pop();_.trys.pop();continue;}o=d.call(b,_);}catch(e){o=[6,e];y=0;}finally{f=t=0;}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:true};}};sap.ui.define(["require","exports","../AbstractProvider","./template","./template2"],function(r,e,A,t,b){"use strict";Object.defineProperty(e,"__esModule",{value:true});e.Provider=void 0;var P=(function(_){a(P,_);function P(){var d=_.call(this)||this;d.id="sample";d.instanceCounterStr="0";return d;}P.prototype._initAsync=function(p){return c(this,void 0,void 0,function(){var f,d,g;return l(this,function(h){this.sina=p.sina;this.sina.util.sampleProviderInstanceCounter++;this.instanceCounterStr=""+this.sina.util.sampleProviderInstanceCounter;f=0;if(document.location.href.indexOf("use=sample1")>0){f=1;}else if(document.location.href.indexOf("use=sample2")>0){f=2;}if(f===1){this.templateProvider=b.createTemplate;}else if(f===2){this.templateProvider=t.createTemplate;}else if(parseInt(this.instanceCounterStr,10)%2===1){this.templateProvider=t.createTemplate;}else{this.templateProvider=b.createTemplate;}d=this.templateProvider(this);d._init(d);g=Promise.resolve({capabilities:this.sina._createCapabilities({fuzzy:false,}),});return[2,g];});});};P.prototype.getSuggestionList=function(d){var f=this._stringify(d);var g=new RegExp('"valueFormatted":"([^{/]+?)","valueHighlighted',"g");var m=f.match(g);var s=m.toString().split(" ");s=s.toString().split(",");m=m.concat(s);m=m.filter(function(i,p){if(i!==""){return m.indexOf(i)==p;}});return m;};P.prototype._stringify=function(o){var d=[];var s=JSON.stringify(o,function(k,v){if(typeof v==="object"&&v!==null){if(d.indexOf(v)!==-1){return undefined;}d.push(v);}return v;});d=null;return s;};P.prototype.adjustImageViewing=function(){var d,f,g;try{$(".sapUshellSearchResultListItem-Image").on("mouseenter",function(){d=$(this).clone();$("body").append(d);f=($(window).height()-$(d).outerHeight())*0.33;g=($(window).width()-$(d).outerWidth())*0.33;d.css({position:"absolute",top:f+"px",left:g+"px",}).show();});$(".sapUshellSearchResultListItem-Image").on("mouseleave",function(){d.remove();});}catch(h){}};P.prototype.applyFilters=function(d,s){var f=[];if(s.filter.rootCondition.conditions.length===0||s.filter.rootCondition.conditions[0].conditions.length===0){return d;}var o=[];var q=[];for(var g=0;g<s.filter.rootCondition.conditions.length;g++){var u=s.filter.rootCondition.conditions[g].conditions;for(var h=0;h<u.length;h++){o.push([u[h].attribute,u[h].value]);q.push(u[h].attribute);}}var v=false;for(var i=0;i<d.length;i++){var w=d[i];var x=[];for(var j=0;j<o.length;j++){v=false;for(var k=0;k<w.detailAttributes.length;k++){var y=w.detailAttributes[k];if(y.id===o[j][0]&&y.value===o[j][1]){v=true;}}for(var m=0;m<w.titleAttributes.length;m++){var z=w.titleAttributes[m];if(z.id===o[j][0]&&z.value===o[j][1]){v=true;}}o[j][2]=v;x.push(v);}if(x.toString().match(/false/)===null){f.push(w);}else{var B=[];var C=q.filter(function(w,E){return q.indexOf(w)==E;});for(var n=0;n<C.length;n++){v=false;var D=C[n];for(var p=0;p<o.length;p++){if(o[p][0]===D&&o[p][2]===true){v=true;break;}}B.push(v);}if(B.toString().match(/false/)===null){f.push(w);}}}return f;};P.prototype.adjustHighlights=function(d,s){var n=[];var f="";for(var i=0;i<d.length;i++){var g=d[i];var h=true;f="";g.titleHighlighted=this.addHighlight(g.title,s);if(g.titleHighlighted!==g.title){h=false;}for(var j=0;j<g.detailAttributes.length;j++){var m=g.detailAttributes[j];f=m.metadata.type;if(f==="String"||f==="Integer"){m.valueHighlighted=this.addHighlight(m.valueFormatted,s);if(m.valueHighlighted!==m.valueFormatted){h=false;}}}for(var k=0;k<g.titleAttributes.length;k++){var o=g.titleAttributes[k];f=o.metadata.type;if(f==="String"||f==="Integer"||f==="ImageUrl"){o.valueHighlighted=this.addHighlight(o.valueFormatted,s);if(o.valueHighlighted!==o.valueFormatted){h=false;}}}if(h===false||s==="*"||s===""){n.push(g);}}return n;};P.prototype.addHighlight=function(h,s){if(typeof h!=="string"||typeof s!=="string"){return h;}var p=h.toLowerCase().indexOf(s.toLowerCase());if(p>-1){var d=p+s.length;var n=h.substring(0,p)+"<b>"+h.substring(p,d)+"</b>"+h.substring(d);return n;}return h;};P.prototype.addSuvLinkToSearchResultItem=function(s,d,f){var g=this.sina._createSuvNavTargetResolver();if(!d){d="/resources/sap/esh/search/ui/sinaNexTS/providers/sample/docs/folklorist_authors_and_publications.suv";}if(!f){f=[];}var h={};h.obj={suvThumbnailAttribute:s,suvTargetMimeTypeAttribute:{value:"application/vnd.sap.universal-viewer+suv",},suvTargetUrlAttribute:{value:d,},};g.resolveSuvNavTargets(null,h,f);};P.prototype.executeSearchQuery=function(s){return c(this,void 0,void 0,function(){var d=this;return l(this,function(f){this.searchQuery=s;return[2,new Promise(function(g){var h;var i=d.templateProvider(d);var j=i.searchResultSetItemArray;var k=i.searchResultSetItemArray2;var m=j.concat(k);var n;if(i.searchResultSetItemArray3){n=i.searchResultSetItemArray3;m=m.concat(n);}var o=s.filter.searchTerm;var p=s.filter.dataSource.id;var q=d.generateFacets(s);var u;if(p==="Scientists"||p==="Folklorists"){u=d.adjustHighlights(j,o);u=d.applyFilters(u,s);h=d.sina._createSearchResultSet({items:u,facets:q,query:s,title:"",totalCount:u.length,});}else if(p==="Mysterious_Sightings"||p==="Urban_Legends"){u=d.adjustHighlights(k,o);u=d.applyFilters(u,s);h=d.sina._createSearchResultSet({items:u,facets:q,query:s,title:"",totalCount:u.length,});}else if(p==="Publications"){u=d.adjustHighlights(n,o);u=d.applyFilters(u,s);h=d.sina._createSearchResultSet({items:u,facets:q,query:s,title:"",totalCount:u.length,});}else if(p==="All"){u=d.adjustHighlights(j,o);u=d.applyFilters(u,s);var v=u.length;u=d.adjustHighlights(k,o);u=d.applyFilters(u,s);var w=u.length;var x=0;if(n){u=d.adjustHighlights(n,o);u=d.applyFilters(u,s);x=u.length;}q[0].items[0].measureValue=v;q[0].items[0].measureValueFormatted=""+v;q[0].items[1].measureValue=w;q[0].items[1].measureValueFormatted=""+w;if(n&&q[0].items.length>2){q[0].items[2].measureValue=x;q[0].items[2].measureValueFormatted=""+x;}u=d.adjustHighlights(m,o);u=d.applyFilters(u,s);h=d.sina._createSearchResultSet({items:u,facets:q,query:s,title:"",totalCount:u.length,});}g(h);})];});});};P.prototype.executeHierarchyQuery=function(q){throw new Error("Method not implmented.");};P.prototype.executeSuggestionQuery=function(q){return c(this,void 0,void 0,function(){var d,f,g,h,j,k,m,i,n;return l(this,function(o){d=q.filter.searchTerm;f=this.templateProvider(this);g=f.searchResultSetItemArray.concat(f.searchResultSetItemArray2).concat(f.searchResultSetItemArray3);h=this.getSuggestionList(g);j=h.filter(function(s){var p=new RegExp("^"+d,"gi");return s.match(p);});if(j.length===0){j=h;}k=[];m=function(p){var s=this.sina.SuggestionCalculationMode.Data;var u=q.filter.clone();u.setSearchTerm(p);return this.sina._createSearchTermSuggestion({searchTerm:p,calculationMode:s,filter:u,label:p,});};for(i=0;i<j.length;i++){k.push(m(j[i]));}n=this.sina._createSuggestionResultSet({title:"Suggestions",query:q,items:k,});return[2,new Promise(function(p){p(n);})];});});};P.prototype.executeChartQuery=function(q){return c(this,void 0,void 0,function(){var d,w;return l(this,function(f){d=this.generateFacets(q);w=1;if(q.dimension==="LOCATION"||d.length===1){w=0;}return[2,new Promise(function(g){g(d[w]);})];});});};P.prototype.getChartResultSetItemsForLocations=function(d){var f=[];var g;var h=[];var m,i,j,k,n;for(i=0;i<d.length;i++){n=d[i].detailAttributes;for(j=0;j<n.length;j++){if(n[j].id==="LOCATION"){g=n[j].value;if(h.indexOf(g)===-1){h.push(g);m=this.sina._createChartResultSetItem({filterCondition:this.sina.createSimpleCondition({attribute:"LOCATION",operator:this.sina.ComparisonOperator.Eq,value:g,}),dimensionValueFormatted:g,measureValue:1,measureValueFormatted:"1",});f.push(m);}else{for(k=0;k<f.length;k++){if(f[k].filterCondition.value===g){f[k].measureValue=f[k].measureValue+1;f[k].measureValueFormatted=""+f[k].measureValue;}}}}}}return f;};P.prototype.getChartResultSetItemsForPublications=function(d){var f=[];var g;var h=[];var m,i,j,k,n;for(i=0;i<d.length;i++){n=d[i].detailAttributes;for(j=0;j<n.length;j++){if(n[j].id==="PUBLICATION"){g=n[j].value;if(h.indexOf(g)===-1){h.push(g);m=this.sina._createChartResultSetItem({filterCondition:this.sina.createSimpleCondition({attribute:"PUBLICATION",operator:this.sina.ComparisonOperator.Eq,value:g,}),dimensionValueFormatted:g,measureValue:1,measureValueFormatted:"1",});f.push(m);}else{for(k=0;k<f.length;k++){if(f[k].filterCondition.value===g){f[k].measureValue=f[k].measureValue+1;f[k].measureValueFormatted=""+f[k].measureValue;}}}}}}return f;};P.prototype.getSientistOrFolkloristFacet=function(s,d){var f;var g=[];var h,i,j,k,m,n;var o=[];for(i=0;i<d.length;i++){m=d[i].titleAttributes;if(s.filter.dataSource.id==="Mysterious_Sightings"||s.filter.dataSource.id==="Urban_Legends"||s.filter.dataSource.id==="Publications"){m=d[i].detailAttributes;}for(j=0;j<m.length;j++){if(m[j].id==="SCIENTIST"||m[j].id==="FOLKLORIST"){f=m[j].value;n=m[j].id;if(g.indexOf(f)===-1){g.push(f);h=this.sina._createChartResultSetItem({filterCondition:this.sina.createSimpleCondition({attribute:m[j].id,operator:this.sina.ComparisonOperator.Eq,value:f,}),dimensionValueFormatted:f,measureValue:1,measureValueFormatted:"1",});o.push(h);}else{for(k=0;k<o.length;k++){if(o[k].filterCondition.value===f){o[k].measureValue=o[k].measureValue+1;o[k].measureValueFormatted=""+o[k].measureValue;}}}}}}return[o,n];};P.prototype.getTopFacetOnly=function(s){var d=s.filter.sina.allDataSource;var f=[this.sina._createDataSourceResultSetItem({dataSource:s.filter.sina.dataSources[1],dimensionValueFormatted:d.labelPlural,measureValue:4,measureValueFormatted:"4",}),this.sina._createDataSourceResultSetItem({dataSource:s.filter.sina.dataSources[2],dimensionValueFormatted:d.labelPlural,measureValue:5,measureValueFormatted:"5",}),];if(s.filter.sina.dataSources[3]){f[2]=this.sina._createDataSourceResultSetItem({dataSource:s.filter.sina.dataSources[3],dimensionValueFormatted:d.labelPlural,measureValue:1,measureValueFormatted:"1",});}var g=[this.sina._createDataSourceResultSet({title:s.filter.dataSource.label,items:f,query:s,}),];return g;};P.prototype.generateFacets=function(s){if(s.filter.dataSource.id==="All"){return this.getTopFacetOnly(s);}var d=[];var f;var g=this.templateProvider(this);var h=this.sina.createFilter({searchTerm:this.searchQuery.filter.searchTerm,dataSource:this.searchQuery.filter.dataSource,rootCondition:this.searchQuery.filter.rootCondition.clone(),});var i=[];var j;if(s.filter.dataSource.id==="Publications"){j=g.searchResultSetItemArray3;}else if(s.filter.dataSource.id==="Scientists"||s.filter.dataSource.id==="Folklorists"){j=g.searchResultSetItemArray;}else if(s.filter.dataSource.id==="Urban_Legends"||s.filter.dataSource.id==="Mysterious_Sightings"){j=g.searchResultSetItemArray2;}if(s.filter.dataSource.id==="Scientists"||s.filter.dataSource.id==="Mysterious_Sightings"){i=this.getChartResultSetItemsForLocations(j);f=this.sina._createChartResultSet({items:i,query:this.sina.createChartQuery({filter:h,dimension:"LOCATION",}),title:"Locations",});d.push(f);}var k=this.getSientistOrFolkloristFacet(s,j);i=k[0];var m=k[1];f=this.sina._createChartResultSet({items:i,query:this.sina.createChartQuery({filter:h,dimension:m,}),title:m.charAt(0).toUpperCase()+m.slice(1).toLowerCase()+"s",});d.push(f);return d;};return P;}(A.AbstractProvider));e.Provider=P;});})();
