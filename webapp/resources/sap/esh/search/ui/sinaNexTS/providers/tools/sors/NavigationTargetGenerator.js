/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){var _=(this&&this.__extends)||(function(){var e=function(d,b){e=Object.setPrototypeOf||({__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;})||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p];};return e(d,b);};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");e(d,b);function a(){this.constructor=d;}d.prototype=b===null?Object.create(b):(a.prototype=b.prototype,new a());};})();sap.ui.define(["require","exports","../../../core/util","../../../core/core","./JoinConditions","../../../sina/SinaObject"],function(r,e,u,c,J,S){"use strict";Object.defineProperty(e,"__esModule",{value:true});e.NavigationTargetGenerator=void 0;var N=(function(a){_(N,a);function N(p){var b=a.call(this,p)||this;b.active=b.checkActive();b.getPropertyMetadata=p.getPropertyMetadata;b.urlPrefix=p.urlPrefix;b.navigationTargetTemplatesInitialized=false;b.navigationTargetTemplatesMap={};b.objectTypeMap={};b.ignoredSemanticObjectTypes={LastChangedByUser:true,CreationDate:true,CreatedByUser:true,};return b;}N.prototype.checkActive=function(){var s=u.getUrlParameter("sors");if(s==="true"){return true;}return false;};N.prototype.cleanup=function(){this.objectTypeMap=null;};N.prototype.registerObjectType=function(o){if(!this.active){return;}var m={type:o.type,label:o.label,propertyMap:{},};this.objectTypeMap[o.type]=m;for(var i=0;i<o.properties.length;++i){var p=o.properties[i];var b=this.getPropertyMetadata(p);this.filterSemanticObjectType(b);m.propertyMap[b.name]=b;}};N.prototype.filterSemanticObjectType=function(p){if(this.ignoredSemanticObjectTypes[p.semanticObjectType]){delete p.semanticObjectType;}};N.prototype.finishRegistration=function(){if(!this.active){return;}this.calculateNavigationTargetTemplates();};N.prototype.calculateNavigationTargetTemplates=function(){if(this.navigationTargetTemplatesInitialized){return;}var j=this.collectJoinConditions();this.navigationTargetTemplatesMap=this.createNavTargetTemplatesFromJoinConditions(j);this.cleanup();this.navigationTargetTemplatesInitialized=true;};N.prototype.createNavTargetTemplatesFromJoinConditions=function(j){var n={};for(var s in j){var o=j[s];var b=[];for(var t in o){var d=o[t];if(!d){continue;}b.push.apply(b,d.generateNavigationTargetTemplates());}if(b.length!==0){n[s]=b;}}return n;};N.prototype.collectJoinConditions=function(){var s=this.createIndex();var j={};for(var o in this.objectTypeMap){var b=this.collectJoinConditionsForObjectType(s,o);if(!c.isEmptyObject(b)){j[o]=b;}}return j;};N.prototype.collectJoinConditionsForObjectType=function(s,o){var b={};var d=this.objectTypeMap[o];var g=function(i){var n=b[i];if(!n){n=new J.JoinConditions({sina:this.sina,navigationTargetGenerator:this,sourceObjectType:o,targetObjectType:i,});b[i]=n;}return n;}.bind(this);for(var p in d.propertyMap){var f=d.propertyMap[p];var h=f.semanticObjectType;if(!f.response){continue;}if(!h){continue;}var t=s[h];for(var i in t){if(i===d.type){continue;}var j=this.objectTypeMap[i];var k=t[i];for(var l in k){var m=j.propertyMap[l];if(!m.request){continue;}var n=g(i);n.add({sourcePropertyName:p,targetPropertyName:l,semanticObjectType:h,});}}}return b;};N.prototype.createIndex=function(){var s={};for(var o in this.objectTypeMap){this.createIndexForObjectType(s,o);}return s;};N.prototype.createIndexForObjectType=function(s,o){var b=this.objectTypeMap[o];for(var p in b.propertyMap){var d=b.propertyMap[p];var f=d.semanticObjectType;if(!f){continue;}var g=s[f];if(!g){g={};s[f]=g;}var h=g[b.type];if(!h){h={};g[b.type]=h;}var i=h[p];if(!i){i=true;h[p]=true;}}};N.prototype.formatItem=function(b){var d=function(f,g){for(var i=0;i<g.length;++i){var h=g[i];f[h.id]=h;}};var f={};d(f,b.detailAttributes);d(f,b.titleAttributes);return f;};N.prototype.generateNavigationTargetsForItem=function(b){var n=this.navigationTargetTemplatesMap[b.dataSource.id];if(!n){return undefined;}var f=this.formatItem(b);var d=[];for(var i=0;i<n.length;++i){var g=n[i];var h=g.generate(f);if(!h){continue;}d.push(h);}return d;};N.prototype.generateNavigationTargets=function(s){var b;if(!this.active){return;}for(var i=0;i<s.items.length;++i){var d=s.items[i];var n=this.generateNavigationTargetsForItem(d);d.navigationTargets=d.navigationTargets||[];(b=d.navigationTargets).push.apply(b,n);}};return N;}(S.SinaObject));e.NavigationTargetGenerator=N;});})();
