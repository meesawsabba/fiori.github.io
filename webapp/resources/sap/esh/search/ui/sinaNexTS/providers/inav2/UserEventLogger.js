/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["require","exports","./ajaxTemplates","../../core/util"],function(r,e,a,u){"use strict";Object.defineProperty(e,"__esModule",{value:true});e.UserEventLogger=void 0;var U=(function(){function U(p){this.provider=p;this.sina=p.sina;this.eventLoggingActive=false;this.clickCounterActive=false;this.delayedConsumer=new u.DelayedConsumer({timeDelay:2000,consumer:this.processEvents,consumerContext:this,});}U.prototype.delayedInit=function(){this.eventLoggingActive=this.provider.supports("SearchInteractionLogging","SearchInteractionLogging");this.clickCounterActive=this.provider.supports("PersonalizedSearch");};U.prototype.logUserEvent=function(b){b.timeStamp=u.generateTimestamp();if(this.eventLoggingActive&&b.type!=="ITEM_NAVIGATE"){this.delayedConsumer.add(b);}if(this.clickCounterActive&&b.type==="ITEM_NAVIGATE"&&b.sourceUrlArray.length!==0){this.incrementClickCounter(b.sourceUrlArray,b.targetUrl,b.systemAndClient);}};U.prototype.processEvents=function(b){var c={SearchInteractionLogging:{SessionID:this.provider.sessionId,EventList:[],},};for(var i=0;i<b.length;++i){var d=b[i];var f={Type:d.type,Timestamp:d.timeStamp,ParameterList:[],};for(var n in d){if(n==="type"||n==="timeStamp"){continue;}var v=d[n];f.ParameterList.push({Name:n,Value:v,});}c.SearchInteractionLogging.EventList.push(f);}return this.provider.ajaxClient.postJson(this.provider.getResponseUrl,c);};U.prototype.incrementClickCounter=function(s,t,b){if(!t){return undefined;}if(t.indexOf("#")===-1){return undefined;}if(!this.provider.supports("PersonalizedSearch","SetUserStatus")){return undefined;}var g=function(H){return H.split("-")[0];};var c=function(H){return H.split("-")[1].split("&")[0];};var d=function(p){var o=p;var q=[];for(var i=0,v=o.length;i<v;i++){var w=o[i];if(w.indexOf("sap-system")!==-1){continue;}var x=w.split("=")[0];var y=w.split("=")[1];q.push({Name:x,Value:y,});}return q;};var N=a.incrementClickCounterRequest.SearchConfiguration.ClientEvent.NavigationEventList;var h=s;var f=g(h[0]);N[0].SourceApplication.SemanticObjectType=f;var j=c(h[0]);N[0].SourceApplication.Intent=j;var k=h[1]!==undefined?d(h[1].split("&")):[];N[0].SourceApplication.ParameterList=k;h=t.split("?");var l=g(h[0]).split("#")[1];N[1].TargetApplication.SemanticObjectType=l;var m=c(h[0]);N[1].TargetApplication.Intent=m;var n=h[1]!==undefined?d(h[1].split("&")):[];N[1].TargetApplication.ParameterList=n;var S={System:b.systemId,Client:b.client,};N[1].TargetApplication=jQuery.extend(N[1].TargetApplication,S);return this.provider.ajaxClient.postJson(this.provider.getResponseUrl,a.incrementClickCounterRequest);};return U;}());e.UserEventLogger=U;});})();
