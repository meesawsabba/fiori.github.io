/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["require","exports","../../core/errors","../../sina/AttributeFormatType","../../sina/AttributeType","../../sina/MatchingStrategy"],function(r,e,a,A,b,M){"use strict";Object.defineProperty(e,"__esModule",{value:true});e.MetadataParser=void 0;var c=(function(){function c(p){this.provider=p;this.sina=p.sina;}c.prototype.normalizeAttributeMetadata=function(d){d.IsKey=d.isKey;};c.prototype.parseRequestAttributes=function(d,f){var g=f.Cube.Dimensions;var h=[];for(var i=0;i<g.length;++i){var j=g[i];if(j.Name.slice(0,2)==="$$"){continue;}var k=j.Attributes[0];this.normalizeAttributeMetadata(k);h.push(k);}this.provider.fillInternalMetadata(d,"metadataRequest",h);};c.prototype.parseResponseAttributes=function(d,f){var g=[];var h=f.Cube.Dimensions[0].Attributes;for(var i=0;i<h.length;++i){var j=h[i];if(j.Name.slice(0,2)==="$$"){continue;}this.normalizeAttributeMetadata(j);g.push(j);}this.provider.fillInternalMetadata(d,"metadataRequest",g);};c.prototype.parseMetadataRequestMetadata=function(d,f){var m=this.provider.getInternalMetadataLoadStatus(d);if(m.metadataRequest){return;}this.parseRequestAttributes(d,f);this.parseResponseAttributes(d,f);this.fillPublicMetadataBuffer(d);};c.prototype.parseSearchRequestMetadata=function(i){var d=this.sina.getDataSource(i.$$DataSourceMetaData$$[0].ObjectName);var m=this.provider.getInternalMetadataLoadStatus(d);if(m.searchRequest){return;}this.provider.fillInternalMetadata(d,"searchRequest",i.$$AttributeMetadata$$);this.fillPublicMetadataBuffer(d);this.calculateAttributeDisplayOrder(d,i);};c.prototype.fillPublicMetadataBuffer=function(d){d.attributesMetadata=[];d.attributeMetadataMap={};var f=this.provider.getInternalMetadataAttributes(d);for(var i=0;i<f.length;++i){var g=f[i];var h=this._parseAttributeTypeAndFormat(g);var p=this.sina._createAttributeMetadata({type:h.type,format:h.format,id:g.Name,label:g.Description,isSortable:this._parseIsSortable(g),isKey:g.IsKey,matchingStrategy:this._parseMatchingStrategy(g),usage:this._parseUsage(g),});d.attributesMetadata.push(p);d.attributeMetadataMap[g.Name]=p;}d._configure();};c.prototype.calculateAttributeDisplayOrder=function(d,f){var g,h,i;var t=[];var k=[];var l=[];var m=[];for(var j=0;j<f.$$ResultItemAttributes$$.length;++j){var n=f.$$ResultItemAttributes$$[j];var o=this.provider.getInternalMetadataAttribute(d,n.Name);if(o.presentationUsage.indexOf("Title")>=0||o.IsTitle){t.push(n.Name);}if(o.presentationUsage.indexOf("Summary")>=0||o.presentationUsage.indexOf("Image")>=0||o.presentationUsage.indexOf("Thumbnail")>=0){k.push(n.Name);}else if(o.presentationUsage.indexOf("Detail")>=0){l.push(n.Name);}}for(i=0;i<t.length;++i){g=t[i];h=d.getAttributeMetadata(g);h.usage.Title.displayOrder=i;}m.push.apply(m,k);m.push.apply(m,l);for(i=0;i<m.length;++i){g=m[i];h=d.getAttributeMetadata(g);h.usage.Detail.displayOrder=i;}};c.prototype._parseIsSortable=function(d){if(typeof d.IsSortable==="undefined"){return false;}return d.IsSortable;};c.prototype._parseMatchingStrategy=function(d){if(d.hasFulltextIndex){return M.MatchingStrategy.Text;}return M.MatchingStrategy.Exact;};c.prototype._parseUsage=function(d){var u={};if(d.presentationUsage.indexOf("Title")>=0||d.IsTitle){u.Title={displayOrder:0,};}if(d.presentationUsage.indexOf("Summary")>=0||d.presentationUsage.indexOf("Image")>=0||d.presentationUsage.indexOf("Thumbnail")>=0||d.presentationUsage.indexOf("Detail")>=0){u.Detail={displayOrder:0,};}if(d.accessUsage.indexOf("AutoFacet")>=0){u.Facet={displayOrder:0,};}if(d.accessUsage.indexOf("AdvancedSearch")>=0){u.AdvancedSearch={displayOrder:0,};}return u;};c.prototype._parseAttributeTypeAndFormat=function(d){for(var i=0;i<d.presentationUsage.length;i++){var p=d.presentationUsage[i];switch(p){case"Summary":continue;case"Detail":continue;case"Title":continue;case"Hidden":continue;case"FactSheet":continue;case"Thumbnail":case"Image":return{type:b.AttributeType.ImageUrl,};case"Text":return{type:b.AttributeType.String,format:A.AttributeFormatType.LongText,};default:throw new a.UnknownPresentationUsageError("Unknown presentation usage "+p);}}switch(d.DataType){case"Integer":case"Long":return{type:b.AttributeType.Integer,};case"Double":return{type:b.AttributeType.Double,};case"String":return{type:b.AttributeType.String,};case"Date":return{type:b.AttributeType.Date,};case"Time":return{type:b.AttributeType.Time,};case"Timestamp":return{type:b.AttributeType.Timestamp,};case"GeoJson":return{type:b.AttributeType.GeoJson,};default:throw new a.UnknownDataTypeError("Unknown data type "+d.DataType);}};return c;}());e.MetadataParser=c;});})();
