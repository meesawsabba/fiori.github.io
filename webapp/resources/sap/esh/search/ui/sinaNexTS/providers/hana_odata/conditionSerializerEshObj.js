/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["require","exports","../../sina/DataSource","../../sina/ComparisonOperator","../../sina/LogicalOperator","../../sina/ComplexCondition","../../sina/AttributeType","./typeConverter","./eshObjects/src/index","../../core/errors"],function(r,e,D,C,L,a,A,t,b,c){"use strict";Object.defineProperty(e,"__esModule",{value:true});e.serialize=e.ConditionSerializer=void 0;var d=(function(){function d(f){this.dataSource=f;}d.prototype.convertSinaToOdataOperator=function(f,g){switch(f){case C.ComparisonOperator.Eq:if(g===null||g===void 0?void 0:g.isHierarchy){return b.SearchQueryComparisonOperator.DescendantOf;}else{return b.SearchQueryComparisonOperator.EqualCaseSensitive;}case C.ComparisonOperator.Ne:return b.SearchQueryComparisonOperator.NotEqualCaseSensitive;case C.ComparisonOperator.Lt:return b.SearchQueryComparisonOperator.LessThanCaseInsensitive;case C.ComparisonOperator.Gt:return b.SearchQueryComparisonOperator.GreaterThanCaseInsensitive;case C.ComparisonOperator.Le:return b.SearchQueryComparisonOperator.LessThanOrEqualCaseInsensitive;case C.ComparisonOperator.Ge:return b.SearchQueryComparisonOperator.GreaterThanOrEqualCaseInsensitive;case C.ComparisonOperator.Co:return b.SearchQueryComparisonOperator.EqualCaseInsensitive;case C.ComparisonOperator.Bw:return b.SearchQueryComparisonOperator.EqualCaseInsensitive;case C.ComparisonOperator.Ew:return b.SearchQueryComparisonOperator.EqualCaseInsensitive;case C.ComparisonOperator.DescendantOf:return b.SearchQueryComparisonOperator.DescendantOf;case C.ComparisonOperator.ChildOf:return b.SearchQueryComparisonOperator.ChildOf;default:throw new c.UnknownComparisonOperatorError("Unknow comparison operator "+f);}};d.prototype.convertSinaToOdataLogicalOperator=function(f){switch(f){case L.LogicalOperator.And:return b.SearchQueryLogicalOperator.AND;case L.LogicalOperator.Or:return b.SearchQueryLogicalOperator.OR;default:throw new c.UnknownLogicalOperatorError("Unknow logical operator "+f);}};d.prototype.serializeComplexCondition=function(f){var g=new b.Expression({operator:this.convertSinaToOdataLogicalOperator(f.operator),items:[],});var h=f.conditions;for(var i=0;i<h.length;++i){var j=h[i];g.items.push(this.serialize(j));}return g;};d.prototype.serializeSimpleCondition=function(f){var g=A.AttributeType.String;var m;if(this.dataSource instanceof D.DataSource){m=this.dataSource.getAttributeMetadata(f.attribute);if(m&&m.type){g=m.type;}}var h=t.sina2Odata(g,f.value,{operator:f.operator,});var i=this.convertSinaToOdataOperator(f.operator,m);return new b.Comparison({property:f.attribute,operator:i,value:new b.Phrase({phrase:h}),});};d.prototype.serializeBetweenCondition=function(f){var l=f.conditions[0];var h=f.conditions[1];var g=A.AttributeType.String;if(this.dataSource instanceof D.DataSource){var m=this.dataSource.getAttributeMetadata(l.attribute);g=m.type||A.AttributeType.String;}var i=t.sina2Odata(g,l.value,{operator:l.operator,});var j=t.sina2Odata(g,h.value,{operator:h.operator,});return new b.Expression({operator:b.SearchQueryLogicalOperator.AND,items:[new b.Comparison({property:l.attribute,operator:b.SearchQueryComparisonOperator.GreaterThanOrEqualCaseInsensitive,value:new b.StringValue({value:i,isQuoted:true,}),}),new b.Comparison({property:l.attribute,operator:b.SearchQueryComparisonOperator.LessThanOrEqualCaseInsensitive,value:new b.StringValue({value:j,isQuoted:true,}),}),],});};d.prototype.serialize=function(f){if(f instanceof a.ComplexCondition){if(f.operator===L.LogicalOperator.And&&f.conditions.length>1&&f.conditions[0]&&(f.conditions[0].operator===C.ComparisonOperator.Ge||f.conditions[0].operator===C.ComparisonOperator.Gt||f.conditions[0].operator===C.ComparisonOperator.Le||f.conditions[0].operator===C.ComparisonOperator.Lt)){return this.serializeBetweenCondition(f);}return this.serializeComplexCondition(f);}return this.serializeSimpleCondition(f);};return d;}());e.ConditionSerializer=d;function s(f,g){var h=new d(f);var i=h.serialize(g);if(i instanceof b.Comparison){i=new b.Expression({operator:b.SearchQueryLogicalOperator.TIGHT_AND,items:[i],});}return i;}e.serialize=s;});})();
