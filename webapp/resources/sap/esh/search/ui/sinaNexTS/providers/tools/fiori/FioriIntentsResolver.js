/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){var _=(this&&this.__extends)||(function(){var e=function(d,b){e=Object.setPrototypeOf||({__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;})||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p];};return e(d,b);};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");e(d,b);function a(){this.constructor=d;}d.prototype=b===null?Object.create(b):(a.prototype=b.prototype,new a());};})();sap.ui.define(["require","exports","../../../sina/SinaObject","../../../sina/AttributeType"],function(r,e,S,A){"use strict";Object.defineProperty(e,"__esModule",{value:true});e.FioriIntentsResolver=void 0;var a;if(typeof window!=="undefined"&&typeof window.sap!=="undefined"&&window.sap.ushell&&window.sap.ushell.Container&&window.sap.ushell.Container.getServiceAsync){var c=window.sap.ushell.Container;c.getServiceAsync("SmartNavigation").then(function(s){a=s;}).catch(function(){c.getServiceAsync("CrossApplicationNavigation").then(function(s){a=s;});});}var F=(function(b){_(F,b);function F(p){var d=b.call(this,p)||this;if(typeof window!=="undefined"&&window.sap&&window.sap.ushell&&window.sap.ushell.Container){d._fioriFrontendSystemInfo={systemId:window.sap.ushell.Container.getLogonSystem().getName(),client:window.sap.ushell.Container.getLogonSystem().getClient(),};d._primaryIntentAction="-displayFactSheet";d._suppressInSearchTag="suppressInEnterpriseSearch".toLowerCase();}else{d._fioriFrontendSystemInfo={systemId:d.getLogonSystem().getName(),client:d.getLogonSystem().getClient(),};}return d;}F.prototype.resolveIntents=function(v){var t=this;if(!a||!v){return Promise.resolve({defaultNavigationTarget:v.fallbackDefaultNavigationTarget,});}if(Array.isArray(v)){var p=[];for(var k=0;k<v.length;k++){var d=t._doResolveIntents(v[k]);p.push(d);}return Promise.all(p);}return t._doResolveIntents(v);};F.prototype._doResolveIntents=function(v){var t=this;var s=v.semanticObjectType;var d=v.semanticObjectTypeAttributes;var f=v.systemId;var g=v.client;var h=v.fallbackDefaultNavigationTarget;if(!s||s.length===0){return Promise.resolve({defaultNavigationTarget:h,});}if(!d||d.length===0){return Promise.resolve();}var j={};var k;for(var i=0;i<d.length;i++){k=this.convertAttributeValueToUI5DataTypeFormats(d[i].value,d[i].type);j[d[i].name]=k;}var l={systemId:f||(t._fioriFrontendSystemInfo&&t._fioriFrontendSystemInfo.systemId),client:g||(t._fioriFrontendSystemInfo.client&&t._fioriFrontendSystemInfo.client),};if(f&&f.trim().length>0&&g&&g.trim().length>0&&(!t._fioriFrontendSystemInfo||!(t._fioriFrontendSystemInfo.systemId===f&&t._fioriFrontendSystemInfo.client===g))){l.urlParameter="sap-system=sid("+f+"."+g+")";}var p=new Promise(function(n){if(a&&a.getPrimaryIntent){t.convertJQueryDeferredToPromise(a.getPrimaryIntent(s,j)).then(function(o){n(o);}).catch(function(){n();});}else{n();}});var m=new Promise(function(n){var o;if(a&&a.getLinks){o=a.getLinks({semanticObject:s,params:j,withAtLeastOneUsedParam:true,sortResultOnTexts:true,});}else{o=a.getSemanticObjectLinks(s,j);}t.convertJQueryDeferredToPromise(o).then(function(q){n(q);}).catch(function(){n();});});return Promise.all([p,m]).then(function(n){var i;var o=n[0];var q;var u=n[1];var w;var x={navigationTargets:[],};var y;if(o&&!t._shallIntentBeSuppressed(o)){y=t._getNavigationTargetForIntent(o,l);x.defaultNavigationTarget=y;}var z=x.defaultNavigationTarget!==undefined;x.navigationTargets=[];if(u){for(i=0;i<u.length;i++){q=u[i];if(t._shallIntentBeSuppressed(q)){continue;}w=t._getNavigationTargetForIntent(q,l);if(!z&&q.intent.substring(q.intent.indexOf("-"),q.intent.indexOf("?"))===t._primaryIntentAction){x.defaultNavigationTarget=w;z=true;}else if(!y||!w.isEqualTo(y)){x.navigationTargets.push(w);}}}return x;});};F.prototype._shallIntentBeSuppressed=function(d){if(d.tags){for(var i=0;i<d.tags.length;i++){if(d.tags[i].toLowerCase()===this._suppressInSearchTag){return true;}}}return false;};F.prototype._getNavigationTargetForIntent=function(i,s){var t=this;var d=i.intent;if(s.urlParameter){if(d.indexOf("?")===-1){d+="?";}else{d+="&";}d+=s.urlParameter;}var f={target:{shellHash:d,},};var g=a.hrefForExternal(f);var n=t.sina._createNavigationTargetForIntent({label:i.text,targetUrl:g,externalTarget:f,systemId:s.systemId,client:s.client,});return n;};F.prototype.convertAttributeValueToUI5DataTypeFormats=function(v,s){var y,m,d,h,f,g,i;switch(s){case A.AttributeType.Timestamp:y=v.getUTCFullYear();m=v.getUTCMonth()+1;d=v.getUTCDate();h=v.getUTCHours();f=v.getUTCMinutes();g=v.getUTCSeconds();i=v.getUTCMilliseconds()*1000;v=this.addLeadingZeros(y.toString(),4)+"-"+this.addLeadingZeros(m.toString(),2)+"-"+this.addLeadingZeros(d.toString(),2)+"T"+this.addLeadingZeros(h.toString(),2)+":"+this.addLeadingZeros(f.toString(),2)+":"+this.addLeadingZeros(g.toString(),2)+"."+this.addLeadingZeros(i.toString(),3);break;case A.AttributeType.Date:v=v.slice(0,4)+"-"+v.slice(5,7)+"-"+v.slice(8,10);break;}return v;};F.prototype.addLeadingZeros=function(v,l){return"00000000000000".slice(0,l-v.length)+v;};F.prototype.getLogonSystem=function(){return{getName:function(){return;},getClient:function(){return;},getPlatform:function(){return;},};};F.prototype.convertJQueryDeferredToPromise=function(d){if(d.always){return new Promise(function(f,g){d.then(f,g);});}else{return d;}};return F;}(S.SinaObject));e.FioriIntentsResolver=F;});})();
