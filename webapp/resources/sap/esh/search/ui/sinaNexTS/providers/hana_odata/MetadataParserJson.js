/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){var a=(this&&this.__extends)||(function(){var e=function(d,b){e=Object.setPrototypeOf||({__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;})||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p];};return e(d,b);};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");e(d,b);function _(){this.constructor=d;}d.prototype=b===null?Object.create(b):(_.prototype=b.prototype,new _());};})();var c=(this&&this.__awaiter)||function(t,_,P,g){function b(v){return v instanceof P?v:new P(function(r){r(v);});}return new(P||(P=Promise))(function(r,d){function f(v){try{s(g.next(v));}catch(e){d(e);}}function i(v){try{s(g["throw"](v));}catch(e){d(e);}}function s(e){e.done?r(e.value):b(e.value).then(f,i);}s((g=g.apply(t,_||[])).next());});};var h=(this&&this.__generator)||function(b,d){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1];},trys:[],ops:[]},f,y,t,g;return g={next:i(0),"throw":i(1),"return":i(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this;}),g;function i(n){return function(v){return s([n,v]);};}function s(o){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=o[0]&2?y["return"]:o[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,o[1])).done)return t;if(y=0,t)o=[o[0]&2,t.value];switch(o[0]){case 0:case 1:t=o;break;case 4:_.label++;return{value:o[1],done:false};case 5:_.label++;y=o[1];o=[0];continue;case 7:o=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(o[0]===6||o[0]===2)){_=0;continue;}if(o[0]===3&&(!t||(o[1]>t[0]&&o[1]<t[3]))){_.label=o[1];break;}if(o[0]===6&&_.label<t[1]){_.label=t[1];t=o;break;}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(o);break;}if(t[2])_.ops.pop();_.trys.pop();continue;}o=d.call(b,_);}catch(e){o=[6,e];y=0;}finally{f=t=0;}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:true};}};sap.ui.define(["require","exports","../../sina/DataSourceType","./MetadataParser"],function(r,e,D,M){"use strict";Object.defineProperty(e,"__esModule",{value:true});e.MetadataParserJson=void 0;var b=(function(_){a(b,_);function b(p){return _.call(this,p)||this;}b.prototype.fireRequest=function(d,u){return c(this,void 0,void 0,function(){var f;return h(this,function(g){switch(g.label){case 0:return[4,d.getJson(u)];case 1:f=g.sent();return[2,f];}});});};b.prototype.parseResponse=function(m){return c(this,void 0,void 0,function(){var d,f,g,E,s,i,j,k,l;return h(this,function(n){d={businessObjectMap:{},businessObjectList:[],dataSourceMap:{},dataSourcesList:[],};f=(m.data&&m.data.metadata)||m.data||m;g=f["$EntityContainer"];if(typeof g!=="string"||g.length<1){throw"Meta data contains invalid EntityContainer!";}E=g.split(".");s=E[0];i=E[1];j=f[s];k=j[i];l=this._parseEntityType(s,j,i,k);this._parseEntityContainer(k,l,d);return[2,d];});});};b.prototype._parseEntityType=function(s,d,f,g){var i={};for(var j in d){if(j===f){continue;}var k=d[j];if(k["@EnterpriseSearch.enabled"]!==true){continue;}j=j.substring(0,j.length-4);var l={schema:s,keys:[],attributeMap:{},label:g[j]["@SAP.Common.Label"]||"",labelPlural:g[j]["@SAP.Common.Label"]||"",annotations:{},};i[j]=l;var m=0;for(var n in k){var o=k[n];if(n==="$Key"){l.keys=o;continue;}if(n.startsWith("@")){this._parseEntityTypeAnnotations(n,o,l);continue;}this._parseAttribute(n,o,l,m);m++;}}return i;};b.prototype._parseEntityTypeAnnotations=function(d,f,g){d=d.substring(1).toUpperCase();switch(d){case"UI.HEADERINFO.TYPENAME":g.label=f;break;case"UI.HEADERINFO.TYPENAMEPLURAL":g.label=f;break;case"UI.HEADERINFO.TITLE.TYPE":this._setAnnotationValue(g.annotations,d,f);break;case"UI.HEADERINFO.TITLE.VALUEQUALIFIER":this._setAnnotationValue(g.annotations,d,f);break;case"UI.HEADERINFO.TYPEIMAGEURL":g.icon=f;break;default:this._setAnnotationValue(g.annotations,d,f);}};b.prototype._parseAttribute=function(d,f,g,i){if(typeof f!=="object"){return;}var j={labelRaw:d,label:null,type:"",presentationUsage:[],isFacet:false,isSortable:false,supportsTextSearch:false,displayOrder:i,annotationsAttr:{},unknownAnnotation:[],};g.attributeMap[d]=j;for(var k in f){var l=f[k];if(k==="$Type"||k==="Type"){j["type"]=l;continue;}if(k.startsWith("@")){this._parseAttributeAnnotations(k,l,j);}}};b.prototype._parseAttributeAnnotations=function(d,f,g){d=d.substring(1).toUpperCase();if(f!==undefined){this._normalizeAnnotationValueOfArrayOrObject(f);switch(d){case"SAP.COMMON.LABEL":if(!g.label){g.label=f;}break;case"ENTERPRISESEARCH.KEY":g.isKey=f;break;case"ENTERPRISESEARCH.PRESENTATIONMODE":g.presentationUsage=f;break;case"ENTERPRISESEARCHHANA.ISSORTABLE":g.isSortable=f;break;case"ENTERPRISESEARCHHANA.SUPPORTSTEXTSEARCH":g.supportsTextSearch=f;break;case"ENTERPRISESEARCH.FILTERINGFACET.DEFAULT":g.isFacet=f;break;case"ENTERPRISESEARCH.DISPLAYORDER":g.displayOrder=f;break;default:if(d.startsWith("UI")||d.startsWith("OBJECTMODEL")||d.startsWith("SEMANTICS")){this._setAnnotationValue(g.annotationsAttr,d,f);}else{g.unknownAnnotation.push(d);}}}};b.prototype._normalizeAnnotationValueOfArrayOrObject=function(d){if(Array.isArray(d)){for(var i=0;i<d.length;i++){this._normalizeAnnotationValueOfObject(d[i]);}}else this._normalizeAnnotationValueOfObject(d);return d;};b.prototype._normalizeAnnotationValueOfObject=function(d){if(typeof d==="object"){for(var k in d){var f=k.toUpperCase();d[f]=d[k];delete d[k];}}return d;};b.prototype._getValueFromArrayWithSingleEntry=function(A){if(Array.isArray(A)&&A.length===1){return A[0];}return A;};b.prototype._parseEntityContainer=function(d,f,g){for(var i in d){var j=f[i];if(i==="$Kind"){continue;}if(j===undefined){throw"EntityType "+i+" has no corresponding meta data!";}var n=this.sina._createDataSource({id:i,label:j.label||i,labelPlural:j.labelPlural||j.label||i,icon:j.icon||"",type:D.DataSourceType.BusinessObject,attributesMetadata:[{id:"dummy",},],});n.annotations=j.annotations;g.dataSourceMap[n.id]=n;g.dataSourcesList.push(n);j.name=i;j.dataSource=n;g.businessObjectMap[i]=j;g.businessObjectList.push(j);}};return b;}(M.MetadataParser));e.MetadataParserJson=b;});})();
