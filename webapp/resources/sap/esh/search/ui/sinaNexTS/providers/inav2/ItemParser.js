/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["require","exports","../../core/util","./typeConverter","./pivotTableParser","../../core/errors"],function(r,e,u,t,p,a){"use strict";Object.defineProperty(e,"__esModule",{value:true});e.ItemParser=void 0;var I=(function(){function I(b){this.provider=b;this.sina=b.sina;this.intentsResolver=this.sina._createFioriIntentsResolver();}I.prototype.parse=function(s,d){var b=this.parseTotalCount(d);d=p.parse(d);if(d.axes.length===0){return Promise.resolve({totalCount:0,items:[],});}var c=d.axes[0];var f=[];for(var i=0;i<c.length;++i){var g=c[i];this.provider.metadataParser.parseSearchRequestMetadata(g);var h=this.parseItem(g);f.push(h);}return Promise.all(f).then(function(j){return{totalCount:b,items:j,};});};I.prototype.parseTotalCount=function(d){if(d.ItemLists&&d.ItemLists[0]&&d.ItemLists[0].TotalCount){return d.ItemLists[0].TotalCount.Value;}return 0;};I.prototype.parseItem=function(b){var c=[];var d=[];var s=[];var f=this.sina.getDataSource(b.$$DataSourceMetaData$$[0].ObjectName);for(var m=0;m<b.$$ResultItemAttributes$$.length;++m){var g=b.$$ResultItemAttributes$$[m];var h=f.getAttributeMetadata(g.Name);var j=this.sina._createSearchResultSetItemAttribute({id:g.Name,label:f.getAttributeMetadata(g.Name).label,value:t.ina2Sina(h.type,g.Value),valueFormatted:g.ValueFormatted||g.Value,valueHighlighted:g.ValueFormatted||g.Value,isHighlighted:false,metadata:h,});if(h.usage.Title){c.push(j);}if(h.usage.Detail){d.push(j);}for(var i=0;i<b.$$AttributeMetadata$$.length;i++){var l=b.$$AttributeMetadata$$[i];if(l.Name==g.Name){if(l.SemanticObjectType&&l.SemanticObjectType.length>0){s.push({name:l.SemanticObjectType,value:j.value,type:j.metadata.type,});}break;}}}c.sort(function(z,A){return z.metadata.usage.Title.displayOrder-A.metadata.usage.Title.displayOrder;});d.sort(function(z,A){return z.metadata.usage.Detail.displayOrder-A.metadata.usage.Detail.displayOrder;});this.parseWhyFound(f,c,d,b);var n;for(var k=0;k<b.$$RelatedActions$$.length;++k){var o=b.$$RelatedActions$$[k];if(o.Type==="GeneralUri"||o.Type==="SAPNavigation"){var q=o.Description;var v=encodeURI(o.Uri);n=this.sina._createNavigationTarget({label:q,targetUrl:v,});}}var w=b.$$DataSourceMetaData$$[0].SemanticObjectType;var x=b.$$DataSourceMetaData$$[0].SystemId;var y=b.$$DataSourceMetaData$$[0].Client;return this.intentsResolver.resolveIntents({semanticObjectType:w,semanticObjectTypeAttributes:s,systemId:x,client:y,fallbackDefaultNavigationTarget:n,}).then(function(z){var A=z&&z.defaultNavigationTarget;var B=z&&z.navigationTargets;var C=this.sina._createSearchResultSetItem({dataSource:f,titleAttributes:c,titleDescriptionAttributes:[],detailAttributes:d,defaultNavigationTarget:A,navigationTargets:B,});return C;}.bind(this));};I.prototype.parseWhyFound=function(d,b,c,f){var i,w,g,j,h;for(i=0;i<f.$$WhyFound$$.length;i++){w=f.$$WhyFound$$[i];g=this.getResponseAttributeId(d,w.Name);for(j=0;j<b.length;++j){h=b[j];if(g===h.id){w.matched=true;h.valueHighlighted=w.Value;h.isHighlighted=true;break;}}for(j=0;j<c.length;++j){h=c[j];if(g===h.id){w.matched=true;h.valueHighlighted=w.Value;h.isHighlighted=true;break;}}}for(i=0;i<f.$$WhyFound$$.length;i++){w=f.$$WhyFound$$[i];if(w.matched){continue;}g=this.getResponseAttributeId(d,w.Name);var m=d.getAttributeMetadata(g);if(!m){throw new a.WhyFoundAttributeMetadataMissingError("metadata misssing for "+g);}h=this.sina._createSearchResultSetItemAttribute({id:m.id,label:m.label,value:null,valueFormatted:u.filterString(w.Value,["<b>","</b>"]),valueHighlighted:w.Value,isHighlighted:true,metadata:m,});c.push(h);}};I.prototype.getResponseAttributeId=function(d,b){var c=this.provider.getInternalMetadataAttribute(d,b);if(!c){return b;}var f=this.provider.getInternalMetadataAttribute(d,c.correspondingSearchAttributeName);if(!f){return b;}return f.Name;};return I;}());e.ItemParser=I;});})();
