/*!
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
 */
sap.ui.define(["./i18n","sap/base/Log","./error/ErrorHandler","sap/m/MessageBox","sap/esh/search/ui/SearchHelper","sap/esh/search/ui/SearchResultListFormatter","sap/esh/search/ui/SearchFacetsFormatter","sap/esh/search/ui/SearchTabStripsFormatter","sap/esh/search/ui/suggestions/SuggestionHandler","sap/esh/search/ui/SearchConfiguration","sap/esh/search/ui/personalization/PersonalizationStorage","sap/esh/search/ui/eventlogging/EventLogger","sap/esh/search/ui/SearchUrlParser","sap/esh/search/ui/cFLPUtil","sap/esh/search/ui/usercategories/UserCategoryManager","sap/esh/search/ui/error/errors",],function(c,L,E,M,S,d,f,g,h,l,P,m,n,o,U,p){("use strict");var q;sap.esh.search.ui.searchModels={};sap.esh.search.ui.getModelSingleton=function(a,i){i=i||"default";if(!sap.esh.search.ui.searchModels[i]){a.isUshell=i==="flp"?true:false;sap.esh.search.ui.searchModels[i]=new sap.esh.search.ui.SearchModel({configuration:a,});}return sap.esh.search.ui.searchModels[i];};var r=sap.ui.model.json.JSONModel.extend("sap.esh.search.ui.SearchModel",{constructor:function(a){var t=this;a=a||{};sap.ui.model.json.JSONModel.prototype.constructor.apply(t,[]);t.config=l.create(a.configuration);t.setSizeLimit(1000);t.suggestionHandler=new h({model:this,});t.errorHandler=new sap.esh.search.ui.error.ErrorHandler({model:this,});t.searchApplications=S.refuseOutdatedRequests(t.searchApplications,"search");t.pageSize=this.config.pageSize||10;t.appTopDefault=20;t.boTopDefault=t.pageSize;t.setProperty("/isQueryInvalidated",true);t.setProperty("/isBusy",false);t.setProperty("/busyDelay",0);t.setProperty("/tableColumns",[]);t.setProperty("/tableSortableColumns",[]);t.setProperty("/tableResults",[]);t.setProperty("/results",[]);t.setProperty("/appResults",[]);t.setProperty("/boResults",[]);t.setProperty("/origBoResults",[]);t.setProperty("/count",0);t.setProperty("/countText","");t.setProperty("/boCount",0);t.setProperty("/appCount",0);t.setProperty("/facets",[]);t.setProperty("/dataSources",[t.allDataSource,t.appDataSource]);t.setProperty("/appSearchDataSource",null);t.setProperty("/currentPersoServiceProvider",null);t.setProperty("/businessObjSearchEnabled",true);t.setProperty("/initializingObjSearch",false);t.setProperty("/suggestions",[]);t.setProperty("/resultToDisplay",t.config.defaultResultViewType||S.loadResultViewType());t.setProperty("/displaySwitchVisibility",false);t.setProperty("/documentTitle","Search");t.setProperty("/top",t.boTopDefault);t.setProperty("/orderBy",{});t.setProperty("/facetVisibility",false);t.setProperty("/focusIndex",0);t.setProperty("/errors",[]);t.setProperty("/isErrorPopovered",false);this.setProperty("/nlqSuccess",false);this.setProperty("/nlqDescription","");this.setProperty("/firstSearchWasExecuted",false);t.setProperty("/multiSelectionAvailable",false);t.setProperty("/multiSelectionEnabled",false);t.setProperty("/multiSelection/actions",[]);t.setProperty("/multiSelectionSelected",false);t.setProperty("/multiSelectionObjects",[]);t.setProperty("/singleSelectionSelected",false);t.setProperty("/inputHelpSelectedItems",null);t.setProperty("/inputHelp",null);t.setProperty("/config",t.config);t.setProperty("/searchInLabel","");t.setProperty("/searchInIcon","sap-icon://none");if(a.searchModel&&a.searchModel._initBusinessObjSearchProm){t._initBusinessObjSearchProm=a.searchModel._initBusinessObjSearchProm;t.oFacetFormatter=new f(t);}t.subscribers=[];t.initBusinessObjSearch();t.searchUrlParser=new n({model:this,});t.userCategoryManagerPromise=null;t.tempDataSources=[];},createSina:function(){var s;return S.require(["sap/esh/search/ui/sinaNexTS/sina/sinaFactory"]).then(function(a){s=a[0];if(!this.config.searchBusinessObjects){return s.createAsync("dummy");}var t=[];if(window.location.href.indexOf("demo/FioriLaunchpad.")!==-1){t=["sample"];}else{t=["abap_odata","inav2","dummy",];}return o.readCFlpConfiguration(t).then(function(t){if(this.config.sinaConfiguration){t=[this.config.sinaConfiguration];}for(var _=0,b=t;_<b.length;_++){var e=b[_];var i=L.getLogger("sap.esh.search.ui.eshclient");e.logTarget=i;e.logLevel=i.getLevel();}return s.createByTrialAsync(t);}.bind(this));}.bind(this));},initBusinessObjSearch:function(){var t=this;if(t._initBusinessObjSearchProm){return t._initBusinessObjSearchProm;}t.setProperty("/initializingObjSearch",true);t.setProperty("/isBusy",true);var a={label:c.getText("genericLoading"),labelPlural:c.getText("genericLoading"),enabled:false,id:"$$Loading$$",};t.setProperty("/dataSource",a);t.setProperty("/dataSources",[a]);t._initBusinessObjSearchProm=P.create(this.config.personalizationStorage,this.config.isUshell).then(function(b){t.personalizationStorage=b;t.initFacetVisibility();return t.createSina();}).then(function(s){t.sinaNext=s;return U.create({sina:s,personalizationStorage:t.personalizationStorage,});}).then(function(u){t.userCategoryManager=u;t.eventLogger=m.newInstance({sinaNext:t.sinaNext,});t.eventLogger.logEvent({type:t.eventLogger.SESSION_START,});if(t.sinaNext.provider.id!=="abap_odata"){t.config.userDefinedDatasources=false;t.userCategoryManager.setFavActive(false);}t.createAllAndAppDataSource();t.setProperty("/defaultDataSource",t.calculateDefaultDataSource());if(t.sinaNext.provider.id==="dummy"){t.setProperty("/defaultDataSource",t.appDataSource);t.setProperty("/businessObjSearchEnabled",false);t.config.searchBusinessObjects=false;t.setFacetVisibility(false,false);}if(t.sinaNext.provider.id==="inav2"&&t.config.isUshell){sap.ui.require(["sap/ushell/System"],function(b){sap.ushell.Container.addRemoteSystem(new b({alias:"ENTERPRISE_SEARCH",platform:"abap",baseUrl:"/ENTERPRISE_SEARCH",}));});}t.setProperty("/uiFilter",t.sinaNext.createFilter());t.loadDataSources();t.resetDataSource(false);t.resetFilterConditions(false);t.query=t.sinaNext.createSearchQuery();if(t.config.multiSelect){t.query.setMultiSelectFacets(true);}t.oFacetFormatter=new f(t);t.tabStripFormatter=new g.Formatter(t.allDataSource);t.dataSourceTree=t.tabStripFormatter.tree;t.setProperty("/initializingObjSearch",false);t.setProperty("/isBusy",false);},function(e){t.errorHandler.onError(e);return Promise.reject();}).then(function(){t.config.initAsync(t);}).then(function(){if(sap&&sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getServiceAsync){return sap.ushell.Container.getServiceAsync("VisualizationInstantiation");}else{return Promise.resolve();}}).then(function(s){if(s!==undefined){t.uShellVisualizationInstantiationService=s;}});return t._initBusinessObjSearchProm;},calculateDefaultDataSource:function(){var a=this.allDataSource;if(this.userCategoryManager.isFavActive()){a=this.userCategoryManager.getCategory("MyFavorites");}if(this.config.defaultSearchScopeApps){a=this.appDataSource;}if(this.config.defaultDataSource){a=this.sinaNext.getDataSource(this.config.defaultDataSource);}return a;},initFacetVisibility:function(){if(typeof this.config.facetVisibility!=="undefined"){this.setFacetVisibility(this.config.facetVisibility,false);return;}var a=false;try{a=this.personalizationStorage.getItem("search-facet-panel-button-state");}catch(e){}this.setFacetVisibility(a,false);},isBusinessObjSearchConfigured:function(){try{var a=window["sap-ushell-config"].renderers.fiori2.componentData.config;return a.searchBusinessObjects!=="hidden";}catch(e){return true;}},isBusinessObjSearchEnabled:function(){return this.getProperty("/businessObjSearchEnabled");},setProperty:function(a){var t=this;try{var b=sap.ui.model.json.JSONModel.prototype.setProperty.apply(this,arguments);switch(a){case"/boResults":case"/appResults":t.calculateResultList();break;case"/appCount":case"/boCount":b=t.setProperty("/count",t.getProperty("/appCount")+t.getProperty("/boCount"));break;case"/count":b=t.setProperty("/countText",t._calculateCountText());break;default:break;}return b;}catch(e){t.errorHandler.onError(e);}},_calculateCountText:function(){var t=this;var a=t.getProperty("/count");if(a>0){if(t.getProperty("/nlqSuccess")){return t.getProperty("/nlqDescription");}if(typeof a!=="number"){return"";}var b=S.formatInteger(a);if(t.getProperty("/searchInLabel")){return((t.getProperty("/searchInLabel")||c.getText("results"))+" ("+b+")");}return c.getText("results")+" ("+b+")";}return"";},getPersonalizationStorageInstance:function(){return this.personalizationStorage;},getSearchBoxTerm:function(){return this.getProperty("/uiFilter/searchTerm")||"";},setSearchBoxTerm:function(s,a){var t=this;var b=s.replace(/^\s+/,"");this.setProperty("/uiFilter/searchTerm",b);this.calculateSearchButtonStatus();if(a||a===undefined){t._firePerspectiveQuery();}},getLastSearchTerm:function(){return this.query.getSearchTerm();},setFacetVisibility:function(v,a){if(sap.ui.Device.system.phone){v=false;}this.setProperty("/facetVisibility",v);try{this.personalizationStorage.setItem("search-facet-panel-button-state",v);}catch(e){}if(a||a===undefined){this._firePerspectiveQuery({preserveFormerResults:true,});}},getFacetVisibility:function(){return this.getProperty("/facetVisibility");},getTop:function(){return this.getProperty("/top");},setTop:function(t,a){this.setProperty("/top",t);if(a||a===undefined){this._firePerspectiveQuery({preserveFormerResults:true,});}},resetTop:function(){this.setProperty("/focusIndex",0);if(this.isAppCategory()){this.setTop(this.appTopDefault,false);}else{this.setTop(this.boTopDefault,false);}},getOrderBy:function(){return this.getProperty("/orderBy");},setOrderBy:function(a,b){this.setProperty("/orderBy",a);if(b||b===undefined){this._firePerspectiveQuery({preserveFormerResults:true,});}},resetOrderBy:function(a){this.setProperty("/orderBy",{});if(a||a===undefined){this._firePerspectiveQuery({preserveFormerResults:true,});}},isEqualOrderBy:function(a,b){if(!a.orderBy){return b.length===0;}if(b.length!==1){return false;}var e=b[0];if(e.id!==a.orderBy){return false;}if(a.sortOrder==="ASC"){return e.order===this.sinaNext.SortOrder.Ascending;}return e.order===this.sinaNext.SortOrder.Descending;},isPersSearchScopeActive:function(){return this.persSearchScopeActive;},getDocumentTitle:function(){var s=this.getSearchBoxTerm();var a=this.getDataSource().labelPlural||this.getDataSource().label;var t;if(this.getDataSource()===this.allDataSource){t=c.getText("searchTileTitleProposalAll",[s]);}else{t=c.getText("searchTileTitleProposal",[s,a]);}return t;},resetQuery:function(){if(this.getProperty("/initializingObjSearch")){return;}S.hasher.reset();this.resetTop();this.setSearchBoxTerm("",false);this.resetDataSource(false);this.resetFilterConditions(false);this.query.resetConditions();this.query.setSearchTerm("random-jgfhfdskjghrtekjhg");this.setProperty("/facets",[]);this.setProperty("/results",[]);this.setProperty("/appResults",[]);this.setProperty("/boResults",[]);this.setProperty("/origBoResults",[]);this.setProperty("/count",0);this.setProperty("/boCount",0);this.setProperty("/appCount",0);},createAllAndAppDataSource:function(){this.allDataSource=this.sinaNext.getAllDataSource();this.allDataSource.label=c.getText("label_all");this.allDataSource.labelPlural=c.getText("label_all");this.appDataSource=this.sinaNext._createDataSource({id:"$$APPS$$",label:c.getText("label_apps"),labelPlural:c.getText("label_apps"),type:this.sinaNext.DataSourceType.Category,});},getUserCategoryManager:function(){if(this.userCategoryManagerPromise){return this.userCategoryManagerPromise;}this.userCategoryManagerPromise=this.initBusinessObjSearch().then(function(){return this.userCategoryManager;}.bind(this));return this.userCategoryManagerPromise;},loadDataSources:function(){var t=this;var a=this.sinaNext.getBusinessObjectDataSources();a=a.slice();var b=[];a.forEach(function(e){if(!e.usage.appSearch){b.push(e);}else{t.setProperty("/appSearchDataSource",e);}});if(t.userCategoryManager.isFavActive()){b.splice(0,0,t.userCategoryManager.getCategory("MyFavorites"));t.favDataSource=t.userCategoryManager.getCategory("MyFavorites");}if(!this.config.odataProvider&&this.config.isUshell){b.splice(0,0,this.appDataSource);}if(!this.config.searchScopeWithoutAll){b.splice(0,0,this.allDataSource);}else{if(!this.config.defaultDataSource&&!t.userCategoryManager.isFavActive()){this.setProperty("/defaultDataSource",b[0]);}}this.setProperty("/dataSources",b);this.setProperty("/searchTermPlaceholder",this.calculatePlaceholder());},resetDataSource:function(a){this.setDataSource(this.getDefaultDataSource(),a);},isAllCategory:function(){var a=this.getProperty("/uiFilter/dataSource");return a===this.allDataSource;},isOtherCategory:function(){var a=this.getProperty("/uiFilter/dataSource");return((a.type===this.sinaNext.DataSourceType.Category||a.type===this.sinaNext.DataSourceType.UserCategory)&&!this.isAllCategory());},isAppCategory:function(){var a=this.getProperty("/uiFilter/dataSource");return a===this.appDataSource;},getDataSource:function(){return this.getProperty("/uiFilter/dataSource");},getDefaultDataSource:function(){return this.getProperty("/defaultDataSource");},setDataSource:function(a,b,e){if(this.getDataSource()!==a){this.eventLogger.logEvent({type:this.eventLogger.DATASOURCE_CHANGE,dataSourceId:a.id,});}this.updateDataSourceList(a);this.getProperty("/uiFilter").setDataSource(a);if(e||e===undefined){this.resetTop();}this.setProperty("/searchTermPlaceholder",this.calculatePlaceholder());this.calculateSearchButtonStatus();if(b||b===undefined){this._firePerspectiveQuery();}},notifyFilterChanged:function(){jQuery.each(this.aBindings,function(i,b){if(b.sPath==="/uiFilter/rootCondition"){b.checkUpdate(true);}});},addFilterCondition:function(a,b){try{var u=this.getProperty("/uiFilter");if(typeof this.config.cleanUpSpaceFilters==="function"){this.config.cleanUpSpaceFilters(this,a);}if(a.attribute||a.conditions){u.autoInsertCondition(a);}else{this.setDataSource(a,false);}if(b||b===undefined){this._firePerspectiveQuery({preserveFormerResults:false,});}this.notifyFilterChanged();}catch(e){this.errorHandler.onError(e);}},removeFilterCondition:function(a,b){if(a.attribute||a.conditions){this.getProperty("/uiFilter").autoRemoveCondition(a);}else{this.setDataSource(a,false);}if(b||b===undefined){this._firePerspectiveQuery({preserveFormerResults:true,});}this.notifyFilterChanged();},resetFilterConditions:function(a){this.getProperty("/uiFilter").resetConditions();if(a||a===undefined){this._firePerspectiveQuery();}this.notifyFilterChanged();},setFilter:function(a){this.setDataSource(a.dataSource,false);this.setSearchBoxTerm(a.searchTerm,false);var u=this.getProperty("/uiFilter");u.setRootCondition(a.rootCondition);this._firePerspectiveQuery();},doSuggestion:function(){this.suggestionHandler.doSuggestion(this.getProperty("/uiFilter").clone());},abortSuggestions:function(){this.suggestionHandler.abortSuggestions();},autoSelectAppSuggestion:function(a){return this.suggestionHandler.autoSelectAppSuggestion(a);},_firePerspectiveQuery:function(a,b){var t=this;return this.initBusinessObjSearch().then(function(){return t._doFirePerspectiveQuery(a,b);});},_doFirePerspectiveQuery:function(a,b){var t=this;var e,i;if(jQuery.isPlainObject(a)){e=a.deserialization;i=a.preserveFormerResults;}else{e=a||undefined;i=b||undefined;}var u=this.getProperty("/uiFilter");if(u.equals(this.query.filter)&&this.getTop()===this.query.top&&this.isEqualOrderBy(this.getOrderBy(),this.query.sortOrder)&&this.getCalculateFacetsFlag()===this.query.calculateFacets&&!this.getProperty("/isQueryInvalidated")){return Promise.resolve();}if(S.getUrlParameter("nlq")==="true"){this.query.setNlq(true);}if((this.query.filter.dataSource&&u.dataSource!==this.query.filter.dataSource)||(this.query.filter.searchTerm&&u.searchTerm!==this.query.filter.searchTerm)){this.resetOrderBy(false);}if(this.query.filter.dataSource&&u.dataSource!==this.query.filter.dataSource){this.oFacetFormatter.handleDataSourceChanged();}if(!e&&!i){if(!u.equals(this.query.filter)){this.resetTop();}}if(u.searchTerm!==this.query.filter.searchTerm||!u.rootCondition.equals(this.query.filter.rootCondition)){this.tabStripFormatter.invalidate(this.getDataSource());}if(this.getProperty("/isQueryInvalidated")===true){this.query.resetResultSet();this.setProperty("/isQueryInvalidated",false);}this.query.setFilter(this.getProperty("/uiFilter").clone());this.query.setTop(this.getTop());this.query.setSortOrder(this.assembleSortOrder());this.query.setCalculateFacets(this.getCalculateFacetsFlag());this.setProperty("/queryFilter",this.query.filter);this._notifySubscribers("ESHSearchStarted");sap.ui.getCore().getEventBus().publish("ESHSearchStarted");if(e){this.setProperty("/busyDelay",0);}else{this.setProperty("/busyDelay",600);}this.setProperty("/isBusy",true);this.abortSuggestions();this.calculateVisibility();this.updateSearchURLSilently(e);this.eventLogger.logEvent({type:this.eventLogger.SEARCH_REQUEST,searchTerm:this.getProperty("/uiFilter/searchTerm"),dataSourceKey:this.getProperty("/uiFilter/dataSource").id,});return(Promise.all([this.normalSearch(i),this.appSearch()]).then(function(){t.setProperty("/tabStrips",t.tabStripFormatter.format(t.getDataSource(),t.perspective,t));return t.oFacetFormatter.getFacets(t.getDataSource(),t.perspective,t).catch(function(j){return t.errorHandler.onErrorDeferred(j);}).then(function(j){if(j&&j.length>0){j[0].change=jQuery.sap.now();t.setProperty("/facets",j);}});}).catch(function(j){return t.errorHandler.onErrorDeferred(j);}).finally(function(){if(t.config&&t.config.browserTitleOverwritten===true){document.title=t.getDocumentTitle();}t._notifySubscribers("ESHSearchFinished");sap.ui.getCore().getEventBus().publish("ESHSearchFinished");t.setProperty("/isBusy",false);t.setProperty("/firstSearchWasExecuted",true);t.notifyFilterChanged();t.updateMultiSelectionSelected();}));},assembleSortOrder:function(){var a=this.getOrderBy();if(!a.orderBy){return[];}var b=this.sinaNext.SortOrder.Ascending;if(a.sortOrder==="DESC"){b=this.sinaNext.SortOrder.Descending;}return[{id:a.orderBy,order:b,},];},getCalculateFacetsFlag:function(){if(this.getDataSource().type===this.sinaNext.DataSourceType.Category||this.getFacetVisibility()){return true;}return false;},appSearch:function(){if(this.config.bNoAppSearch===true){return Promise.resolve(true);}var t=this;this.setProperty("/appResults",[]);this.setProperty("/appCount",0);if(!this.isAllCategory()&&!this.isAppCategory()){return Promise.resolve(true);}var a=this.query.filter.dataSource===this.allDataSource?this.appTopDefault:this.query.top;return this.searchApplications(this.query.filter.searchTerm,a,0).then(function(R){t.setProperty("/appCount",R.totalResults);t.setProperty("/appResults",R.getElements());},function(e){return t.errorHandler.onErrorDeferred(e);});},searchApplications:function(s,t,a){if(this.config.isUshell){return sap.ushell.Container.getServiceAsync("Search").then(function(b){return b.queryApplications({searchTerm:s,top:t,skip:a,});});}else{return Promise.resolve({totalResults:0,searchTerm:s,getElements:function(){return[];},});}},normalSearch:function(a){var t=this;if(!a){t.resetAndDisableMultiSelection();}if(!t.isBusinessObjSearchEnabled()||t.isAppCategory()){this.setProperty("/boResults",[]);this.setProperty("/origBoResults",[]);this.setProperty("/boCount",0);this.setProperty("/nlqSuccess",false);this.setProperty("/nlqDescription","");return Promise.resolve(true);}var s=function(b){t.perspective=b;t.setProperty("/nlqSuccess",false);if(b.nlqSuccess){t.setProperty("/nlqSuccess",true);t.setProperty("/nlqDescription",b.title);}return t._afterSearchPrepareResultList(t.perspective);};t.setDataSource(t.getDataSource(),false,false);t.query.setCalculateFacets(t.getCalculateFacetsFlag());return t.query.getResultSetAsync().then(function(b){var e=(b);return s(e);},function(e){return t.errorHandler.onErrorDeferred(e);});},_prepareTableResults:function(e){var t=this;var i,j,k;var s=[];var u=this.sinaNext.dataSourceMap[this.getDataSource().id].attributesMetadata;for(i=0;i<u.length;i++){if(u[i].usage.Detail&&u[i].groups.length===0&&u[i].type!=="GeoJson"&&u[i].id.match(/latitude|longitude/i)==null&&u[i].type!==t.sinaNext.AttributeType.ImageUrl){s.push(u[i]);}}var v=function(a,b){if(a.usage.Detail.displayOrder<b.usage.Detail.displayOrder){return-1;}if(a.usage.Detail.displayOrder>b.usage.Detail.displayOrder){return 1;}return 0;};s.sort(v);var w=e;var x="\u2013";for(i=0;i<e.length;i++){w[i].cells=[];for(j=0;j<s.length;j++){w[i].cells[j]={};}}for(i=0;i<e.length;i++){var y=e[i].itemattributes;for(j=0;j<s.length;j++){for(k=0;k<y.length;k++){if(s[j].id===y[k].key){if(y[k].iconUrl){w[i].cells[j]={value:y[k].value===undefined||y[k].value===null||y[k].value.trim().length===0?x:y[k].value,icon:y[k].iconUrl,};}else{w[i].cells[j]={value:y[k].value===undefined||y[k].value===null||y[k].value.trim().length===0?x:y[k].value,};}}}}if(e[i].hasTitleDescription){w[i].cells.unshift({value:e[i].titleDescription===undefined||e[i].titleDescription===null||e[i].titleDescription.trim().length===0?x:e[i].titleDescription,});}w[i].cells.unshift({value:e[i].title===undefined||e[i].title===null||e[i].title.trim().length===0?x:e[i].title,uri:e[i].uri,titleNavigation:e[i].titleNavigation,isTitle:true,titleIconUrl:e[i].titleIconUrl,titleInfoIconUrl:e[i].titleInfoIconUrl,});if(e[i].navigationObjects!==undefined&&e[i].navigationObjects.length>0){w[i].cells.push({value:c.getText("intents"),navigationObjects:e[i].navigationObjects,isRelatedApps:true,});}if(t.config.extendTableColumn){var z={idAttribute:e[i].additionalAttributes.idAttribute,favoriteUserId:e[i].additionalAttributes.favoriteUserId,};w[i].cells.push(t.config.extendTableColumn.assembleCell(z));}}t.setProperty("/tableResults",w);var A=[];var B=[];for(i=0;i<s.length;i++){if(s[i].id.match(/latitude|longitude/i)==null&&s[i].type!==t.sinaNext.AttributeType.ImageUrl){A.push({name:s[i].label,attributeId:s[i].id,});}}if(e[0].hasTitleDescription){var C=e[0].titleDescriptionLabel+" ("+c.getText("titleDescription")+")";A.unshift({name:C,attributeId:"SEARCH_TABLE_TITLE_DESCRIPTION_COLUMN",});}var D={};if(t.config.titleColumnName&&t.config.titleColumnName!==""){D.name=c.getText(t.config.titleColumnName);}else{D.name=t.getDataSource().label;}D.attributeId="SEARCH_TABLE_TITLE_COLUMN";if(t.config.titleColumnWidth&&t.config.titleColumnWidth!==""){D.width=t.config.titleColumnWidth;}A.unshift(D);var F=w[0].cells.length-1;if(w[0].cells[F].isRelatedApps){A.push({name:c.getText("intents"),attributeId:"SEARCH_APPS_AS_ID",});}if(t.config.extendTableColumn){A.push(t.config.extendTableColumn.column);}for(i=0;i<A.length;i++){A[i].key="searchColumnKey"+i;A[i].index=i;}t.setProperty("/tableColumns",A);for(i=0;i<u.length;i++){var G=u[i];if(G.isSortable){B.push({name:G.label,key:"searchSortableColumnKey"+i,attributeId:G.id,selected:t.getProperty("/orderBy").orderBy===G.id,});}}var H=function(a,b){if(a.name<b.name){return-1;}if(a.name>b.name){return 1;}return 0;};B.sort(H);B.unshift({name:c.getText("defaultRank"),key:"searchSortableColumnKeyDefault",attributeId:"",selected:jQuery.isEmptyObject(t.getProperty("/orderBy")),});t.setProperty("/tableSortableColumns",B);},_afterSearchPrepareResultList:function(s){var t=this;var i;t.setProperty("/boResults",[]);t.setProperty("/origBoResults",s.items);t.setProperty("/boCount",0);var a=new d(t);var b=a.format(s,t.query.filter.searchTerm);var e;var j=[];var k=[];for(i=0;i<b.length;i++){e=b[i];j.push(e.dataSource);k.push({isDocumentConnector:e.isDocumentConnector,});}var u=t.config.loadCustomModulesForDataSourcesAsync(j,k);var v=Promise.all([Promise.resolve(s),u]).then(function(w){var s=w[0];if(!t.isAllCategory()&&!t.isOtherCategory()&&!t.isAppCategory()&&s.totalCount>0){if(s.items[0].titleDescriptionAttributes.length>0){b.forEach(function(x){x.hasTitleDescription=true;});}t._prepareTableResults(b);}if(t.config&&typeof t.config.setSearchInLabelIconBindings==="function"){t.config.setSearchInLabelIconBindings(t,s.facets);}t.setProperty("/boCount",s.totalCount);t.setProperty("/boResults",b);t.enableOrDisableMultiSelection();return Promise.resolve();});return v;},resetAndDisableMultiSelection:function(){this.setProperty("/multiSelectionAvailable",false);this.setProperty("/multiSelectionEnabled",false);this.setProperty("/multiSelectionSelected",false);this.setProperty("/singleSelectionSelected",false);},enableOrDisableMultiSelection:function(){if(this.config.enableMultiSelectionResultItems){this.setProperty("/multiSelectionAvailable",true);this.setProperty("/multiSelectionEnabled",true);return;}var a=this.getDataSource();var b=this.config.getDataSourceConfig(a);var s=new b.searchResultListSelectionHandlerControl();if(s){this.setProperty("/multiSelectionAvailable",s.isMultiSelectionAvailable());}else{this.setProperty("/multiSelectionAvailable",false);}},updateMultiSelectionSelected:function(){var a=this.getProperty("/results");var b=0;var e=[];for(var i=0;i<a.length;i++){if(a[i].selected){b++;e.push(a[i]);}}if(b>0){this.setProperty("/multiSelectionSelected",true);this.setProperty("/multiSelectionObjects",e);}else{this.setProperty("/multiSelectionSelected",false);this.setProperty("/multiSelectionObjects",[]);}if(b===1){this.setProperty("/singleSelectionSelected",true);}else{this.setProperty("/singleSelectionSelected",false);}this.config.selectionChange(this);},_endWith:function(s,a){return s.indexOf(a,s.length-a.length)!==-1;},calculatePlaceholder:function(){var t=this;var a=t.getDataSource().labelPlural;if(t.config.FF_bOptimizedQuickSelectDataSourceLabels===true){var i;if(typeof t.config.getFirstSpaceCondition==="function"){var b=t.config.getFirstSpaceCondition(t.getProperty("/uiFilter"));if(b&&b.attributeLabel){i=true;a=b.valueLabel||b.value;}}if(!i&&t.getDataSource().id==="SEARCH_DESIGN"&&typeof t.config.getPlaceholderLabelForDatasourceAll==="function"){a=t.config.getPlaceholderLabelForDatasourceAll();}}else if(t.isAllCategory()||t.config.bPlaceHolderFixedValue===true){return c.getText("search");}else if(!i&&t.getDataSource().id==="SEARCH_DESIGN"&&typeof t.config.getPlaceholderLabelForDatasourceAll==="function"){a=t.config.getPlaceholderLabelForDatasourceAll();}return c.getText("searchInPlaceholder",[a]);},updateDataSourceList:function(a){var b=this.getProperty("/dataSources");this.removeTempDataSources();if(a===this.allDataSource||a===this.appDataSource){return;}if(a&&a.id){if(a.id.indexOf("~")>=0){return;}}for(var i=0;i<b.length;++i){var e=b[i];if(e===a){return;}}b.unshift(a);this.tempDataSources.push(a);this.setProperty("/dataSources",b);},removeTempDataSources:function(){var a=this.getProperty("/dataSources");this.tempDataSources.forEach(function(t,i,b){var e=a.indexOf(t);if(e<0){var j=new Error("could not find temp DataSource in DataSources");throw new p.ProgramError(j);}a.splice(e,1);b.splice(i,1);});},invalidateQuery:function(){S.hasher.reset();this.setProperty("/isQueryInvalidated",true);},autoStartApp:function(){var t=this;if(t.getProperty("/appCount")&&t.getProperty("/appCount")===1&&t.getProperty("/count")&&t.getProperty("/count")===1){var a=t.getProperty("/appResults");if(a&&a.length>0&&a[0]&&a[0].url&&t.getProperty("/uiFilter/searchTerm")&&a[0].tooltip&&t.getProperty("/uiFilter/searchTerm").toLowerCase().trim()===a[0].tooltip.toLowerCase().trim()){if(a[0].url[0]==="#"){window.location.href=a[0].url;}else{window.open(a[0].url,"_blank","noopener,noreferrer");}}}},getResultToDisplay:function(){return this.getProperty("/resultToDisplay");},setResultToDisplay:function(t){this.setProperty("/resultToDisplay",t);if(this.focusHandler){setTimeout(function(){this.focusHandler.setFocus();}.bind(this),1000);}S.saveResultViewType(t);},calculateVisibility:function(){var t=this;if(t.isAppCategory()){t.setResultToDisplay("appSearchResult");t.setProperty("/displaySwitchVisibility",false);}else if(t.isAllCategory()||t.isOtherCategory()){t.setResultToDisplay("searchResultList");t.setProperty("/displaySwitchVisibility",false);}else{var a=t.getResultToDisplay();if(!(a==="searchResultList"||a==="searchResultTable"||a==="searchResultGrid"||a==="searchResultMap")){t.setResultToDisplay(t.config.defaultResultViewType||S.loadResultViewType());}t.setProperty("/displaySwitchVisibility",true);}},calculateSearchButtonStatus:function(){if(this.getDataSource()===this.getProperty("/defaultDataSource")&&this.getSearchBoxTerm().length===0){this.setProperty("/searchButtonStatus","close");}else{this.setProperty("/searchButtonStatus","search");}},calculateResultList:function(){var t=this;var a=[];var b=t.getProperty("/boResults");if(b&&b.length){a.push.apply(a,b);}var e=t.getProperty("/appResults");if(e&&e.length>0){var i={type:"appcontainer",tiles:e,};if(a.length>0){if(a.length>3){a.splice(3,0,i);}else{a.push(i);}}else{a=[i];}}sap.ui.model.json.JSONModel.prototype.setProperty.apply(this,["/results",a]);},pushUIMessage:function(e){e.title=e.title==="[object Object]"?c.getText("searchError"):e.title;e.type=e.type!==undefined?e.type:sap.ui.core.MessageType.Error;var p=this.getProperty("/errors");p.push(e);this.setProperty("/errors",p);},updateSearchURLSilently:function(a){if(a||this.preventUpdateURL){S.hasher.init();}else{var H=this.renderSearchURL();if(this.config.updateUrl){S.hasher.setHash(H);}}},renderSearchURL:function(){return this.searchUrlParser.render();},parseURL:function(){this.searchUrlParser.parse();},subscribe:function(e,F,a){this.subscribers.push({sEventId:e||"",fnFunction:F,oListener:a||this,});},unsubscribe:function(e,F,a){e=e||"";a=a||this;for(var i=0;i<this.subscribers.length;i++){var s=this.subscribers[i];if(s.sEventId===e&&s.fnFunction===F&&s.oListener===a){this.subscribers.splice(i,1);}}},_notifySubscribers:function(e){for(var i=0;i<this.subscribers.length;i++){var s=this.subscribers[i];if(s.sEventId===e){s.fnFunction.apply(s.oListener,[e]);}}},});r.injectSearchShellHelper=function(_){q=q||_;};return r;});
