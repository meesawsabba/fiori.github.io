/*!
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
 */
sap.ui.define(["../i18n","sap/esh/search/ui/SearchHelper"],function(i,S){"use strict";var U=function(){this.init.apply(this,arguments);};var m="my-fav-data";U.create=function(p){var a=new U(p);return a.initAsync().then(function(){return a;});};U.prototype={init:function(p){this.active=false;this.categories=[];this.personalizationStorage=p.personalizationStorage;this.sina=p.sina;},initAsync:function(){var t=this;var u;var s;var a=[];var b=this.personalizationStorage.getItem(m);if(!b){u=this.sina._createDataSource({id:"MyFavorites",label:i.getText("label_userFavorites"),labelPlural:i.getText("label_userFavorites"),type:this.sina.DataSourceType.UserCategory,subDataSources:[],undefinedSubDataSourceIds:[],});this.categories.push(u);return Promise.resolve();}this.setFavActive(b.active);if(!this.isFavActive()){this.setFavActive(false);}this.setLastFavActive(this.isFavActive());for(var _=0,c=b.userCatgories;_<c.length;_++){var f=c[_];var d=f.subDataSources;if(d){s=d.map(function(e){var g=t.sina.getDataSource(e.id);if(!g){a.push(e.id);}return g;});}else{s=[];}s=s.filter(function(x){return x;});u=this.sina._createDataSource({id:f.id,label:i.getText("label_userFavorites"),labelPlural:i.getText("label_userFavorites"),type:this.sina.DataSourceType.UserCategory,subDataSources:s,undefinedSubDataSourceIds:a,});this.categories.push(u);}return Promise.resolve();},getCategory:function(a){for(var _=0,b=this.categories;_<b.length;_++){var c=b[_];if(c.id===a){return c;}}return null;},isFavActive:function(){return this.active;},setFavActive:function(a){this.active=a;},isLastFavActive:function(){return this.lastActive;},setLastFavActive:function(v){this.lastActive=v;},save:function(){var c=[];for(var _=0,a=this.categories;_<a.length;_++){var b=a[_];var s=[];for(var d=0,e=b.subDataSources;d<e.length;d++){var f=e[d];s.push({id:f.id,});}for(var g=0,h=b.undefinedSubDataSourceIds;g<h.length;g++){var u=h[g];s.push({id:u,});}c.push({id:b.id,subDataSources:s,});}this.personalizationStorage.setItem(m,{active:this.isFavActive(),userCatgories:c,});this.personalizationStorage.saveNotDelayed().then(function(){if(S.isSearchAppActive()&&this.isLastFavActive()!==this.isFavActive()){var r=new RegExp(/^[^#]*#/).exec(window.location.href);var j=r[0];setTimeout(function(){window.location.assign(j);window.location.reload();},2000);}else if(!S.isSearchAppActive()&&this.isLastFavActive()!==this.isFavActive()){setTimeout(function(){window.location.reload();},2000);}}.bind(this));},};return U;});
