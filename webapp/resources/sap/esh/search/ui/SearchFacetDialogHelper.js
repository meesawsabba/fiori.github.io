/*!
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
 */
sap.ui.define(["./i18n","sap/ui/model/Sorter"],function(a,S){"use strict";var m={};var b;m.setSearchAdvancedCondition=function(_){b=_;};jQuery.extend(m,{init:function(d){var t=this;t.POS_FACET_LIST=0;t.POS_TOOLBAR_SEARCHFIELD=0;t.POS_TOOLBAR_TOGGLEBUTTON=1;t.POS_SETTING_CONTAINER=0;t.POS_ATTRIBUTE_LIST_CONTAINER=1;t.POS_ICONTABBAR=0;t.POS_TABBAR_LIST=0;t.POS_TABBAR_CONDITION=1;t.POS_SORTING_SELECT=0;t.POS_SHOWONTOP_CHECKBOX=1;t.POS_ADVANCED_CHECKBOX=0;t.POS_ADVANCED_INPUT_LAYOUT=1;t.POS_ADVANCED_BUTTON=2;t.bResetFilterIsActive=false;var n={decimals:2,};t.oFloatNumberFormat=sap.ui.core.format.NumberFormat.getFloatInstance(n);t.oIntegernumberFormat=sap.ui.core.format.NumberFormat.getIntegerInstance();t.oDateFormatOptions={pattern:"yyyy/MM/dd",UTC:false,};t.oTimestampFormatOptions={pattern:"yyyy-MM-dd HH:mm:ss.SSSSSSS",UTC:true,};t.oDateFormat=sap.ui.core.format.DateFormat.getDateTimeInstance(t.oDateFormatOptions);t.oTimestampFormat=sap.ui.core.format.DateFormat.getDateTimeInstance(t.oTimestampFormatOptions);t.dialog=d;},getFacetList:function(){var t=this;return t.dialog.oSplitContainer.getMasterPages()[0].getContent()[t.POS_FACET_LIST];},updateDetailPage:function(l,f,i){var t=this;var M=t.dialog.getModel();var s=t.dialog.getModel("searchModel");var B=l.getBindingContext().sPath;var o=M.getProperty(B);var d=M.getAttributeDataType(o);var c=this.getFacetList().indexOfAggregation("items",l);var D=t.dialog.oSplitContainer.getDetailPages()[c];var e,g,A,h;if(d==="string"||d==="text"){e=D.getContent()[t.POS_ICONTABBAR].getItems()[t.POS_TABBAR_LIST].getContent()[0].getContent()[t.POS_ATTRIBUTE_LIST_CONTAINER];g=D.getContent()[t.POS_ICONTABBAR].getItems()[t.POS_TABBAR_LIST].getContent()[0].getContent()[t.POS_ATTRIBUTE_LIST_CONTAINER].getContent()[0];A=D.getContent()[t.POS_ICONTABBAR].getItems()[t.POS_TABBAR_CONDITION].getContent()[0];h=D.getContent()[t.POS_ICONTABBAR].getItems()[t.POS_TABBAR_LIST].getContent()[0].getContent()[t.POS_SETTING_CONTAINER];}else{e=D.getContent()[t.POS_ATTRIBUTE_LIST_CONTAINER];g=D.getContent()[t.POS_ATTRIBUTE_LIST_CONTAINER].getContent()[0];A=D.getContent()[t.POS_ATTRIBUTE_LIST_CONTAINER];h=D.getContent()[t.POS_SETTING_CONTAINER];}var n=D.getId();t.dialog.oSplitContainer.toDetail(n,"show");t.dialog.resetIcons(M,B,t.dialog);e.setBusy(true);var p={sAttribute:o.dimension,sBindingPath:B,sAttributeLimit:1000,bInitialFilters:i,};if(d==="number"){p.sAttributeLimit=20;}if(!M.chartQuery){M.chartQuery=M.sinaNext.createChartQuery({filter:M.getProperty("/uiFilter").clone(),dimension:o.dimension,top:1000,});}t.applyChartQueryFilter(c);if(f){var j=M.sinaNext.createSimpleCondition({attribute:o.dimension,operator:M.sinaNext.ComparisonOperator.Bw,value:f,});if(!t.bResetFilterIsActive){M.chartQuery.filter.autoInsertCondition(j);}}else{if(f===undefined&&(d==="string"||d==="text")){D.getContent()[t.POS_ICONTABBAR].getItems()[t.POS_TABBAR_LIST].getContent()[0].getSubHeader().getContent()[t.POS_TOOLBAR_SEARCHFIELD].setValue("");}}M.chartQuery.filter.searchTerm=s.getSearchBoxTerm();M.facetDialogSingleCall(p).then(function(){var I=M.getProperty(D.getBindingContext().sPath).items;if(A.data("initial")){t.initiateAdvancedConditions(A,I,A.data("dataType"));}var C=h.getItems()[t.POS_SHOWONTOP_CHECKBOX];if(g.getSelectedContexts().length>0){C.setEnabled(true);}t.updateDetailPageListItemsSelected(g,A);t.dialog.updateDetailPageCharts(I,M);});},applyChartQueryFilter:function(e){var t=this;t.dialog.getModel().resetChartQueryFilterConditions();var d=t.dialog.oSplitContainer.getDetailPages();for(var i=0;i<d.length;i++){if(i===e||d[i].getContent().length===0){continue;}var l;if(!d[i].getContent()[t.POS_ATTRIBUTE_LIST_CONTAINER]){l=d[i].getContent()[t.POS_ICONTABBAR].getItems()[t.POS_TABBAR_LIST].getContent()[0].getContent()[t.POS_ATTRIBUTE_LIST_CONTAINER].getContent()[0];}else{l=d[i].getContent()[t.POS_ATTRIBUTE_LIST_CONTAINER].getContent()[0];}for(var j=0;j<l.getItems().length;j++){var L=l.getItems()[j];var o=L.getBindingContext().getObject();var f=o.filterCondition;if(f.attribute||f.conditions){if(L.getSelected()&&!t.bResetFilterIsActive){t.dialog.getModel().chartQuery.filter.autoInsertCondition(f);}}}t.applyAdvancedCondition(d[i],t.getFacetList().getItems()[i].getBindingContext().getObject(),t.dialog.getModel());}},resetChartQueryFilters:function(){var t=this;t.dialog.getModel().resetChartQueryFilterConditions();var d=t.dialog.oSplitContainer.getDetailPages();for(var i=0;i<d.length;i++){if(d[i].getContent().length===0){continue;}var l;if(!d[i].getContent()[t.POS_ATTRIBUTE_LIST_CONTAINER]){l=d[i].getContent()[t.POS_ICONTABBAR].getItems()[t.POS_TABBAR_LIST].getContent()[0].getContent()[t.POS_ATTRIBUTE_LIST_CONTAINER].getContent()[0];}else{l=d[i].getContent()[t.POS_ATTRIBUTE_LIST_CONTAINER].getContent()[0];}for(var j=0;j<l.getItems().length;j++){var L=l.getItems()[j];var o=L.getBindingContext().getObject();var f=o.filterCondition;if(f.attribute||f.conditions){if(L.getSelected()){L.setSelected(false);}}}}},applyAdvancedCondition:function(d,f,A){var t=this;var c=t.dialog.getModel();var D,o,k,e,g,h,i,C;if(d.getContent()[t.POS_ATTRIBUTE_LIST_CONTAINER]){var l=d.getContent()[t.POS_ATTRIBUTE_LIST_CONTAINER];D=l.data("dataType");o=l.getContent();switch(D){case"timestamp":case"date":t.oDateTimeFormat=D==="timestamp"?t.oTimestampFormat:t.oDateFormat;for(k=1;k<o.length;k++){e=o[k];g=e.getContent()[t.POS_ADVANCED_CHECKBOX];var j=e.getContent()[t.POS_ADVANCED_INPUT_LAYOUT];if(g.getSelected()&&j.getDateValue()&&j.getSecondDateValue()){var s=new Date(j.getSecondDateValue().getFullYear(),j.getSecondDateValue().getMonth(),j.getSecondDateValue().getDate(),23,59,59);var n=t.oDateTimeFormat.format(j.getDateValue());var p=t.oDateTimeFormat.format(s);h=c.sinaNext.createSimpleCondition({attribute:f.dimension,attributeLabel:f.title,operator:c.sinaNext.ComparisonOperator.Ge,value:D==="timestamp"?j.getDateValue():n,valueLabel:n,});i=c.sinaNext.createSimpleCondition({attribute:f.dimension,attributeLabel:f.title,operator:c.sinaNext.ComparisonOperator.Le,value:D==="timestamp"?s:p,valueLabel:p,});C=c.sinaNext.createComplexCondition({valueLabel:j.getValue(),operator:c.sinaNext.LogicalOperator.And,conditions:[h,i],userDefined:true,});if(!t.bResetFilterIsActive){A.addFilterCondition(C,false);}}}break;case"integer":case"number":t.oNumberFormat=D==="integer"?t.oIntegernumberFormat:t.oFloatNumberFormat;for(k=1;k<o.length;k++){e=o[k];g=e.getContent()[t.POS_ADVANCED_CHECKBOX];var q=e.getContent()[t.POS_ADVANCED_INPUT_LAYOUT].getContent()[0];var r=e.getContent()[t.POS_ADVANCED_INPUT_LAYOUT].getContent()[2];var u=e.getContent()[t.POS_ADVANCED_INPUT_LAYOUT].getContent()[1];var v=t.oNumberFormat.parse(q.getValue());var w=t.oNumberFormat.parse(r.getValue());if(g.getSelected()){if(!isNaN(v)&&!isNaN(w)&&w>=v){h=c.sinaNext.createSimpleCondition({attribute:f.dimension,attributeLabel:f.title,operator:c.sinaNext.ComparisonOperator.Ge,value:v,valueLabel:t.oNumberFormat.format(v),userDefined:true,});i=c.sinaNext.createSimpleCondition({attribute:f.dimension,attributeLabel:f.title,operator:c.sinaNext.ComparisonOperator.Le,value:w,valueLabel:t.oNumberFormat.format(w),userDefined:true,});C=c.sinaNext.createComplexCondition({valueLabel:t.oNumberFormat.format(v)+u.getText()+t.oNumberFormat.format(w),operator:c.sinaNext.LogicalOperator.And,conditions:[h,i],userDefined:true,});if(!t.bResetFilterIsActive){A.addFilterCondition(C,false);}}else{t.dialog.getModel("searchModel").pushError({type:"error",title:a.getText("filterInputErrorTitle"),description:a.getText("filterInputError"),});t.dialog.bConditionValidateError=true;}}}break;default:break;}}else{var x=d.getContent()[t.POS_ICONTABBAR].getItems()[t.POS_TABBAR_CONDITION].getContent()[0];D=x.data("dataType");o=x.getContent();var y,z,B,F,O;switch(D){case"string":for(k=0;k<o.length-1;k++){e=o[k];y=e.getContent()[t.POS_ADVANCED_INPUT_LAYOUT].getContent()[0];z=e.getContent()[t.POS_ADVANCED_INPUT_LAYOUT].getContent()[1];B=z.getValue();switch(y.getSelectedKey()){case"eq":O=c.sinaNext.ComparisonOperator.Eq;break;case"ew":O=c.sinaNext.ComparisonOperator.Ew;break;case"bw":O=c.sinaNext.ComparisonOperator.Bw;break;case"co":O=c.sinaNext.ComparisonOperator.Co;break;default:O=c.sinaNext.ComparisonOperator.Eq;break;}if(z.getValue()){F=c.sinaNext.createSimpleCondition({attribute:f.dimension,attributeLabel:f.title,operator:O,value:B,valueLabel:B,userDefined:true,});if(!t.bResetFilterIsActive){A.addFilterCondition(F,false);}}}break;case"text":for(k=0;k<o.length-1;k++){e=o[k];y=e.getContent()[t.POS_ADVANCED_INPUT_LAYOUT].getContent()[0];z=e.getContent()[t.POS_ADVANCED_INPUT_LAYOUT].getContent()[1];B=z.getValue();switch(y.getSelectedKey()){case"co":O=c.sinaNext.ComparisonOperator.Co;break;default:O=c.sinaNext.ComparisonOperator.Eq;}if(z.getValue()){F=c.sinaNext.createSimpleCondition({attribute:f.dimension,attributeLabel:f.title,operator:O,value:B,valueLabel:B,userDefined:true,});if(!t.bResetFilterIsActive){A.addFilterCondition(F,false);}}}break;default:break;}}},initiateAdvancedConditions:function(A,I,t){var c=this;var C,o,d,e,f;for(var i=I.length;i>0;i--){var g=I[i-1];if(g.advanced){C=A.getContent();if(t==="string"||t==="text"){o=C[C.length-2];}else{o=C[C.length-1];}d=o.getContent()[c.POS_ADVANCED_CHECKBOX];d.setSelected(true);e=o.getContent()[c.POS_ADVANCED_INPUT_LAYOUT];switch(t){case"integer":case"number":var h=e.getContent()[0];var k=e.getContent()[2];if(g.filterCondition.conditions){for(var j=0;j<g.filterCondition.conditions.length;j++){var l=g.filterCondition.conditions[j];if(l.operator==="Ge"){h.setValue(l.valueLabel||c.oNumberFormat.format(l.value));}if(l.operator==="Le"){k.setValue(l.valueLabel||c.oNumberFormat.format(l.value));}}}break;case"string":f=g.filterCondition.operator;if(f==="Co"){e.getContent()[0].setSelectedKey("co");}else if(f==="Ew"){e.getContent()[0].setSelectedKey("ew");}else if(f==="Bw"){e.getContent()[0].setSelectedKey("bw");}e.getContent()[1].setValue(g.filterCondition.valueLabel);break;case"text":f=g.filterCondition.operator;if(f==="Co"){e.getContent()[0].setSelectedKey("co");}e.getContent()[1].setValue(g.filterCondition.valueLabel);break;default:e.setValue(g.label);break;}c.insertNewAdvancedCondition(o,t);c.dialog.getModel().changeFilterAdvaced(g,true);}}A.data("initial",false);},updateDetailPageListItemsSelected:function(d,A){var t=this;var D=A.data("dataType");t.sortingAttributeList(d.getParent().getParent());d.getParent().setBusy(false);if(D==="date"||D==="timestamp"||D==="number"||D==="integer"){d.focus();}},removeAdvancedCondition:function(A,l,t){var c=this;var C=A.getContent();var o,I,d;if(t==="string"||t==="text"){for(var i=0;i<C.length-1;i++){o=C[i];I=o.getContent()[c.POS_ADVANCED_INPUT_LAYOUT].getContent()[1];if(I.getProperty("value")){var v=I.getValue();var L=l.getBindingContext().getObject();if(v===L.filterCondition.value){d=i;break;}}}}A.removeContent(d);},sortingAttributeList:function(d){var t=this;var s=d.getContent()[t.POS_SETTING_CONTAINER];var o=s.getItems()[t.POS_SORTING_SELECT].getItems()[0];var c=s.getItems()[t.POS_SHOWONTOP_CHECKBOX];var l=d.getContent()[t.POS_ATTRIBUTE_LIST_CONTAINER].getContent()[0];var D=l.data("dataType");var B=l.getBinding("items");var e=[];if(c.getSelected()){e.push(new S("selected",true,false));}switch(o.getSelectedKey()){case"sortName":e.push(new S("label",false,false));break;case"sortCount":e.push(new S("value",true,false));if(D==="string"||D==="text"){e.push(new S("label",false,false));}break;default:break;}B.sort(e);},insertNewAdvancedCondition:function(A,t){var o=A.getParent();var n=new b({type:t,});if(t==="string"||t==="text"){var i=o.getAggregation("content").length-1;o.insertAggregation("content",n,i);}else{var c=o.indexOfAggregation("content",A);if(c===o.getAggregation("content").length-1){o.addContent(n);}}},deleteAdvancedCondition:function(A){var t=this;var o=A.getParent();var d=A.getParent().getParent().getParent().getParent().getParent();o.removeAggregation("content",A);t.updateCountInfo(d);},updateCountInfo:function(d){var t=this;var M=t.getFacetList();var o=M.getSelectedItem();if(!o){o=M.getItems()[0];}var c=o.getBindingContext().oModel;var s=o.getBindingContext().sPath;var D=c.getProperty(s).dimension;var f=t.dialog.getModel().aFilters;var e=0;for(var j=0;j<f.length;j++){if(!f[j].advanced&&f[j].facetAttribute===D){e++;}}var g=c.getAttributeDataType(c.getProperty(s));var A,h,i,C,k;var l=0;if(g==="string"||g==="text"){A=d.getContent()[t.POS_ICONTABBAR].getItems()[t.POS_TABBAR_CONDITION].getContent()[0];h=A.getContent().length-1;for(i=0;i<h;i++){C=A.getContent()[i];k=C.getContent()[0];if(k.getSelected()){l++;}}}else{A=d.getContent()[t.POS_ATTRIBUTE_LIST_CONTAINER];h=A.getContent().length;for(i=1;i<h;i++){C=A.getContent()[i];k=C.getContent()[0];if(k.getSelected()){l++;}}}var F=c.getProperty(s).facetType;if(F==="attribute"){var n=e+l;c.setProperty(s+"/count",n);t.dialog.resetEnabledForFilterResetButton();}},});return m;});
