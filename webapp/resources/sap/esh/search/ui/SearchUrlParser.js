/*!
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
 */
sap.ui.define(["./i18n","sap/esh/search/ui/SearchHelper","sap/esh/search/ui/SearchUrlParserInav2","sap/m/MessageBox",],function(i,S,a,M){"use strict";var b=function(){this.init.apply(this,arguments);};b.prototype={init:function(p){this.model=p.model;this.urlParserInav2=new a(p);},parse:function(){if(!this.model.config.isSearchUrl(S.getHashFromUrl())){return Promise.resolve(undefined);}if(!S.hasher.hasChanged()){return Promise.resolve(undefined);}return this.model.initBusinessObjSearch().then(function(){var p=S.getUrlParameters();if($.isEmptyObject(p)){return undefined;}if(p.datasource||p.searchterm){return this.urlParserInav2.parseUrlParameters(p);}return this.parseUrlParameters(p);}.bind(this)).then(function(){this.model.setProperty("/searchTermPlaceholder",this.model.calculatePlaceholder());this.model.calculateSearchButtonStatus();this.model._firePerspectiveQuery(true);}.bind(this));},parseUrlParameters:function(p){p=this.model.config.parseSearchUrlParameters(p);if(p.top){var t=parseInt(p.top,10);this.model.setTop(t,false);}var f;if(p.filter){var c=JSON.parse(p.filter);try{f=this.model.sinaNext.parseFilterFromJson(c);}catch(e){f=this.model.sinaNext.createFilter();if(c.searchTerm){f.setSearchTerm(c.searchTerm);}M.show(i.getText("searchUrlParsingErrorLong")+"\n("+e.toString()+")",{icon:M.Icon.ERROR,title:i.getText("searchUrlParsingError"),actions:[M.Action.OK],});}this.model.setProperty("/uiFilter",f);this.model.setDataSource(f.dataSource,false,false);}},render:function(){return this.renderFromParameters(this.model.getTop(),this.model.getProperty("/uiFilter"),true);},renderFromParameters:function(t,f,e){var p={top:t,filter:e?encodeURIComponent(JSON.stringify(f.toJson())):JSON.stringify(f.toJson()),};return this.model.config.renderSearchUrl(p);},};return b;});
