/*!
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
 */
sap.ui.define(["./i18n","./SearchHelper","./error/errors","sap/m/MessageBox"],function(a,S,e,M){"use strict";var b=function(){this.init.apply(this,arguments);};b.prototype={init:function(p){this.model=p.model;},parseUrlParameters:function(p){if(p.top){var t=parseInt(p.top,10);this.model.setTop(t,false);}var d=this.model.sinaNext.allDataSource;if(p.datasource){var c=JSON.parse(p.datasource);var f=c.ObjectName.value;switch(c.Type){case"Category":if(f==="$$ALL$$"){d=this.model.sinaNext.allDataSource;}else{d=this.model.sinaNext.getDataSource(f);if(!d){d=this.model.sinaNext._createDataSource({type:this.model.sinaNext.DataSourceType.Category,id:f,label:c.label,labelPlural:c.labelPlural,});}}break;case"BusinessObject":d=this.model.sinaNext.getDataSource(f);if(!d){d=this.model.sinaNext.allDataSource;delete p.filter;M.show(a.getText("searchUrlParsingErrorLong")+"\n(Unknow datasource "+f+")",{icon:M.Icon.ERROR,title:a.getText("searchUrlParsingError"),actions:[M.Action.OK],});}break;default:{var i=new Error("Unknown datasource type "+c.Type);throw new e.UnknownDataSourceType(i);}}}return this.model.sinaNext.loadMetadata(d).then(function(){var g={dataSource:d,};var r;if(p.filter){var h=JSON.parse(p.filter);r=this.parseCondition(g,h);}else{r=this.model.sinaNext.createComplexCondition();}var j=this.model.sinaNext.createFilter({dataSource:d,searchTerm:p.searchterm,rootCondition:r,});this.model.setProperty("/uiFilter",j);this.model.setDataSource(j.dataSource,false);}.bind(this));},parseCondition:function(c,d){if(d.conditions){return this.parseComplexCondition(c,d);}return this.parseSimpleCondition(c,d);},parseComplexCondition:function(c,d){var s=[];for(var i=0;i<d.conditions.length;++i){var f=d.conditions[i];s.push(this.parseCondition(c,f));}return this.model.sinaNext.createComplexCondition({operator:d.operator,conditions:s,valueLabel:d.label,});},parseSimpleCondition:function(c,d){c.attribute=d.attribute;return this.model.sinaNext.createSimpleCondition({attribute:d.attribute,attributeLabel:d.attributeLabel,value:this.parseValue(c,d.value),valueLabel:d.valueLabel||d.label,operator:this.parseOperator(c,d.operator),});},parseValue:function(c,v){var m=c.dataSource.getAttributeMetadata(c.attribute);return this.model.sinaNext.inav2TypeConverter.ina2Sina(m.type,v);},parseOperator:function(c,o){switch(o){case"=":return this.model.sinaNext.ComparisonOperator.Eq;case">":return this.model.sinaNext.ComparisonOperator.Gt;case">=":return this.model.sinaNext.ComparisonOperator.Ge;case"<":return this.model.sinaNext.ComparisonOperator.Lt;case"<=":return this.model.sinaNext.ComparisonOperator.Le;default:throw"Unknown operator "+o;}},};return b;});
