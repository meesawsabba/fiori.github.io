sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/library","sap/ui/model/odata/ODataUtils","sap/ovp/cards/generic/Component","sap/ovp/cards/v4/generic/Component","sap/ui/generic/app/navigation/service/NavigationHandler","sap/m/MessageBox","sap/ovp/cards/CommonUtils","sap/ovp/cards/PersonalizationUtils","sap/ovp/cards/charts/VizAnnotationManager","sap/m/BusyDialog","sap/ui/model/Filter","sap/ui/generic/app/navigation/service/SelectionVariant","sap/ui/comp/state/UIState","sap/m/ColumnListItem","sap/m/Text","sap/m/Switch","sap/m/Table","sap/m/Column","sap/m/Button","sap/m/Dialog","sap/ui/model/json/JSONModel","sap/ui/Device","sap/ovp/ui/SmartphoneHeaderToggle","sap/ui/model/odata/v2/ODataModel","sap/ui/model/odata/ODataMetadata","sap/ui/fl/write/api/ControlPersonalizationWriteAPI","sap/ui/thirdparty/hasher","sap/ui/model/analytics/odata4analytics","sap/m/BackgroundDesign","sap/m/ListSeparators","sap/ui/core/TextAlign","sap/ovp/support/lib/CommonMethods","sap/ovp/app/resources","sap/ovp/app/TemplateBaseExtension","sap/ui/core/mvc/ControllerExtension","sap/ovp/app/OVPUtils","sap/base/security/encodeURL","sap/base/util/ObjectPath","sap/ui/thirdparty/jquery","sap/base/util/merge","sap/ui/fl/apply/api/FlexRuntimeInfoAPI","sap/ui/core/CustomData","sap/ovp/cards/ovpLogger","sap/base/util/isEmptyObject","sap/ovp/cards/semanticDateRangeTypeHelper","sap/ui/model/Filter","sap/ovp/placeholder/placeholderHelper"],function(C,S,O,a,b,N,M,c,P,V,B,F,d,U,f,T,g,h,m,n,D,J,o,p,q,r,s,t,u,v,L,w,x,y,z,A,E,G,H,Q,I,K,R,W,X,Y,Z,$){"use strict";var _="sap.ovp.app.customData",a1="sap.ovp.app.extensionData";var b1=new W("OVP.app.Main");return C.extend("sap.ovp.app.Main",{getCustomAppStateDataExtension:function(e){},restoreCustomAppStateDataExtension:function(e){},getCustomFilters:function(){},onCustomActionPress:function(e){},onCustomParams:function(e){},modifyStartupExtension:function(e){},getCustomMessage:function(e,i){},onBeforeRebindPageExtension:function(){},oRefreshTimer:null,nRefreshInterval:0,filterItemInFocus:null,bFinishedCardsCreationProcess:false,storeIncomingDeltaChanges:function(e){this.deltaCardsInfo=e?e:[];},appendIncomingDeltaChange:function(e){this.deltaChanges.push(e);},templateBaseExtension:z,onInit:function(){this.bDeltaChangesEnabled=false;this.bRTAActive=false;this.bResetChartAxisFormatter=false;this.deltaChanges=[];this._initFlexibilityPersonalization();this.globalEventBus=sap.ui.getCore().getEventBus();this.getView().loaded().then(function(){var e=this.getOwnerComponent();var i=e.getMetadata();if(e&&i&&i.getManifest()){x.setAppComponent(this.getOwnerComponent());}x.setApplicationStatus(x.mApplicationStatus.LOADING);x.publishEvent("elements","ViewRenderingStarted",{});this.oContainer=sap.ushell&&sap.ushell.Container;this.aErrorCards=[];this.oCardsModels={};this.aFilters=[];this.errorHandlingObject={atLeastOneRequestSuccess:false,errorLoadingTimeout:{}};this.sPreviousEntityType="";this.sCurrentEntityType="";this.oLoadedComponents={};this.bGlobalFilterLoaded=false;this.bGoButtonPressed=false;this.bSearchButtonPressed=false;this.fnMacroFilterBarLoaded=undefined;this.isInitialLoading=true;this.isMacroFilterBar;var j=this.getUIModel();this.bDisableErrorPage=j&&j.getProperty("/disableErrorPage");this.oNavigationHandler=this.oNavigationHandler||new N(this);this.getLayout().addStyleClass("ovpLayoutElement");this.oState={};this.oState.oSmartFilterbar=this.byId("ovpGlobalFilter");this._initGlobalFilter();this._createModelForTile();this._checkJamAuth();c.enable(this,this.oNavigationHandler);this._loadCardComponent("sap.ovp.cards.error");}.bind(this));},performRecreationOfCard:function(e){e.settings.baseUrl=this._getBaseUrl();this._clearStoredEntities();this._initCardModel(e.model);e=this._getTemplateForChart(e);this._loadCardComponent(e.template);this._createModelViewMap(e);Q.when(this.createCard(e)).then(function(){if(this.getLayout().getMetadata().getName()==="sap.ovp.ui.DashboardLayout"){var i=this.getLayout().getDashboardLayoutUtil();if(i){var j=i.getDashboardLayoutModel();var k=j.getCardById(e.id);i._sizeCard(k);j.extractCurrentLayoutVariant();}}}.bind(this));},onExit:function(){this.bResetChartAxisFormatter=true;},_getOriginalCardDescriptorById:function(e){if(!e){return null;}var i=this.getView().byId(e);var j=i.getComponentInstance();var k=j.getComponentData();var l=k.appComponent;return l._getOvpCardOriginalConfig(e);},recreateCard:function(e){var i=e.cardId;var j=this._getCardFromManifest(i);var k=this._getOriginalCardDescriptorById(i);if(j.template=="sap.ovp.cards.charts.analytical"||j.template=="sap.ovp.cards.charts.smart.chart"||j.template=="sap.ovp.cards.v4.charts.analytical"){j.settings.chartAnnotationPath=e.chartAnnotationPath;j.settings.colorPalette=e.colorPalette;j.settings.bEnableStableColors=e.bEnableStableColors;if(e.navigation){j.settings.navigation=e.navigation;}}if(e.entitySet){j.settings.entitySet=e.entitySet;}j.settings.annotationPath=e.annotationPath;j.settings.dynamicSubtitleAnnotationPath=e.dynamicSubtitleAnnotationPath;j.settings.presentationAnnotationPath=e.presentationAnnotationPath;j.settings.selectionAnnotationPath=e.selectionAnnotationPath;j.settings.selectionPresentationAnnotationPath=e.selectionPresentationAnnotationPath;j.settings.kpiAnnotationPath=e.kpiAnnotationPath;j.settings.dataPointAnnotationPath=e.dataPointAnnotationPath;j.settings.identificationAnnotationPath=e.identificationAnnotationPath;j.settings.headerAnnotationPath=e.headerAnnotationPath;j.settings.staticParameters=k&&k.settings&&k.settings.staticParameters;if(e.staticParameters){j.settings.staticParameters=e.staticParameters;}if(e.customParams){j.settings.customParams=e.customParams;}var l=j.settings.selectedKey;j.settings.selectedKey=e.selectedKey;if(j){this.performRecreationOfCard(j);}var c1={changeType:"viewSwitch",content:{cardId:e.cardId,selectedKey:e.selectedKey,oldKey:l},isUserDependent:true};P.savePersonalization(c1,this.getView());},recreateRTAClonedCard:function(e){var i=this._getCardFromManifest(e.id);if(i){i.settings=e.settings;this.performRecreationOfCard(i);}},onBeforeRendering:function(){},onRequestCompleted:function(e){if(e&&e.getParameters()&&e.getParameters().success){var i=e.getParameters().response&&e.getParameters().response.responseText?JSON.parse(e.getParameters().response.responseText):"";if(i&&i.d&&i.d.results&&i.d.results.length==0){this.fVerifyAndSetErrorOrCustomMessageCard(e,true);}}else if(e&&e.getParameters()&&e.getParameters().response&&e.getParameters().response.statusCode!==0){this.fVerifyAndSetErrorOrCustomMessageCard(e,false);}},fVerifyAndSetErrorOrCustomMessageCard:function(i,j){var k;var l=this.getView().getModel("ui").getProperty('/aOrderedCards');for(k in l){var c1=this.getView().byId(l[k].id);var d1=c1&&c1.getComponentInstance();var e1=d1&&d1.getComponentData();var f1=d1&&d1.getRootControl();var g1=f1&&f1.getController();var h1=g1&&g1.getCardItemsBinding();if(h1&&!c.isODataV4(g1.oView.getModel())){var i1=i.getParameters().url;var j1=h1.sCustomParams;var k1=h1.sFilterParams;var l1=h1.sPath.replace("/","");var m1=h1.sRangeParams;var n1=h1.sCountMode&&h1.sCountMode.indexOf("Inline");var o1=h1.sSortParams;var p1=i.getSource().sServiceUrl;var q1=i.oSource&&i.oSource.oMetadata;var r1=g1.getEntityType();var s1=this.getView().getModel();var t1=g1.oView.getModel();var u1=this._getEntityRelevantFilters(r1,this.aFilters,t1,s1);var v1;try{v1=sap.ui.model.odata.ODataUtils.createFilterParams(u1,q1,r1);}catch(e){b1.error("applying filter on a card which is not valid");}i1=i1.split(l1).join("").split(j1).join("").split(k1).join("").split(m1).join("").split(o1).join("").split(p1).join("").split(v1).join("").split("?").join("").split("&").join("").split("/").join("");if(!n1){i1=i1.split("$inlinecount=allpages").join("");}var w1=e1&&e1.cardId;var x1=this._getCardFromManifest(w1);if(i1){var y1=/sap-client=[0-9][0-9][0-9]/i;i1=i1.replace(y1,"");}if(x1&&!i1){var z1=I({},i);var A1=I({},x1);var B1=this.getCustomMessage(z1,A1.id);B1=B1&&typeof B1==="object"?B1:"";if(j&&!B1){return;}if(B1){if(j&&B1.hasOwnProperty("sMessage")&&B1.sMessage&&typeof B1.sMessage==="string"){i.getParameters().response.statusText=B1.sMessage;if(B1.hasOwnProperty("sIcon")&&B1.sIcon&&typeof B1.sIcon==="string"&&B1.sIcon.indexOf("sap-icon")!==-1){i.getParameters().response.sIcon=B1.sIcon;}}else if(!j&&B1.hasOwnProperty("sMessage")&&B1.sMessage&&typeof B1.sMessage==="string"){i.getParameters().response.statusText=B1.sMessage;}}if(this.aErrorCards.indexOf(w1)==-1){this.aErrorCards.push(x1.id);}else{d1.destroy();}this.createErrorCard(x1,i);}}}},onAfterRendering:function(){x.setApplicationStatus(x.mApplicationStatus.RENDERED);x.publishEvent("elements","ViewRendered",{});this.oModelViewMap={};this.oAppStatePromise=null;if(this.getView().getModel("ui").getProperty("/refreshIntervalInMinutes")){this.nRefreshInterval=this.getView().getModel("ui").getProperty("/refreshIntervalInMinutes");this.nRefreshInterval=(this.nRefreshInterval<=1?1:this.nRefreshInterval)*60000;}var e=this._getCardsModel();var i=[];var k;for(k in e){if(i.indexOf(e[k].model)==-1){i.push(e[k].model);}}var j=this.getOwnerComponent();if(j){for(k in i){var l=j.getModel(i[k]);if(l&&c.isODataV4(l)){setTimeout(this.destroyErrorCardsAndReplaceWithOriginal.bind(this),0);}else if(l){l.attachRequestCompleted(this.onRequestCompleted.bind(this));l.attachRequestSent(this.destroyErrorCardsAndReplaceWithOriginal.bind(this));}}}if(this.initialized){return;}this.initialized=true;Promise.all([this.oFlexibilityPersonalizationPromise,this.oGlobalFilterLoadedPromise]).then(function(){this.isMacroFilterBar=this.getMacroFilterBar()!==undefined;this.getView().byId("ovpFilterNotFulfilledPage").setVisible(false);this.getView().byId("ovpCardPage").setVisible(true);this.persistencyVariantLoaded=true;var c1;var d1=[],e1=[];this.aManifestOrderedCards=this._getCardArrayAsVariantFormat(this.getLayout().getContent());for(var f1=0;f1<this.aManifestOrderedCards.length;f1++){c1=this._getCardFromManifest(this.aManifestOrderedCards[f1].id);if(c1&&c1.settings&&c1.settings.requireAppAuthorization){d1.push({id:c1.id,cardIntent:c1.settings.requireAppAuthorization});e1.push(c1.settings.requireAppAuthorization);}}var g1=this._mergeLREPContent(this.aManifestOrderedCards);this.getView().getModel("ui").setProperty('/aOrderedCards',g1);this.organizeCards(g1);}.bind(this));if(o.system.phone){p.enable(this);}},organizeCards:function(e){var k;var l=[];this._updateLayoutWithOrderedCards();this._updateDashboardLayoutCards(e);if(this.isDragAndDropEnabled()){if(sap.ushell&&sap.ushell.Container){this._initShowHideCardsButton();}}this._clearStoredEntities();e=this.getView().getModel("ui").getProperty('/aOrderedCards');for(var i=0;i<e.length;i++){if(e[i].visibility){k=this._getCardFromManifest(e[i].id);if(k){l.push(k);}}}for(var i=0;i<l.length;i++){this._initCardModel(l[i].model);this._loadCardComponent(l[i].template);this._createModelViewMap(l[i]);}setTimeout(function(){this.getLayout().addStyleClass("ovpLayoutElementShow");}.bind(this),0);var c1=this.fGetViewSwitchIndex(l);var d1=[];for(var i=0,j=0;j<l.length;i++,j++){while(l[j].id!==e[i].id){i++;}k=l[j];if(!k.settings.title){b1.error("title is mandatory for card ID : "+k.id);}if(k.settings.tabs){var e1=0;var f1=c1&&c1.hasOwnProperty(k.id)?c1[k.id]:"";if(f1&&typeof f1=="number"&&f1>0&&f1<=k.settings.tabs.length){e1=f1>=1?f1-1:f1;this.setOrderedCardsSelectedKey(k.id,f1);}else if(e[i].selectedKey&&k.settings.tabs.length>=e[i].selectedKey){e1=e[i].selectedKey-1;}this.initializeTabbedCard(k,e1);}k=this._getTemplateForChart(k);this._loadCardComponent(k.template);k.settings.baseUrl=this._getBaseUrl();d1.push(this.createCard(k));}Promise.all(d1).then(function(){this.bFinishedCardsCreationProcess=true;}.bind(this));if(this.busyDialog){this.busyDialog.close();}},_getTemplateForChart:function(e){if(e.template==="sap.ovp.cards.charts.smart.chart"){var i=this.getView();var j=i.getModel(e.model);var k=j.getMetaModel();var l=k.getODataEntitySet(e.settings.entitySet);var c1=k.getODataEntityType(l.entityType);var d1;var e1;var f1;var g1=false;var h1;if(e&&e.settings){if(!g1&&e.settings.kpiAnnotationPath){var i1=c1[e.settings.kpiAnnotationPath];h1=i1.Detail.DefaultPresentationVariant&&i1.Detail.DefaultPresentationVariant.Path;if(h1){f1=this._getTemplateForChartFromVisualization(h1,e,j,l,c1);g1=f1.bTemplateUpdated;if(g1){e=f1.oCard;return e;}}}if(!g1&&e.settings.selectionPresentationAnnotationPath){var j1=c1[e.settings.selectionPresentationAnnotationPath];if(j1){h1=j1.PresentationVariant&&j1.PresentationVariant.Path;if(h1){f1=this._getTemplateForChartFromVisualization(h1,e,j,l,c1);g1=f1.bTemplateUpdated;if(g1){e=f1.oCard;return e;}}}}if(!g1&&e.settings.presentationAnnotationPath){h1=e.settings.presentationAnnotationPath;f1=this._getTemplateForChartFromVisualization(h1,e,j,l,c1);g1=f1.bTemplateUpdated;if(g1){e=f1.oCard;return e;}}if(!g1&&e.settings.chartAnnotationPath){d1=c1[e.settings.chartAnnotationPath];e1=d1&&d1.ChartType&&d1.ChartType.EnumMember;if(e1&&e1.split("/")[1]==="Donut"){e.template="sap.ovp.cards.charts.analytical";}else{e.template="sap.ovp.cards.charts.smart.chart";}}}}return e;},_getTemplateForChartFromVisualization:function(e,i,j,k,l){if(/^@/.test(e)){e=e.slice(1);}i.settings.presentationAnnotationPath=e;var c1=l[e]&&l[e].Visualizations;var d1;var e1;var f1;var g1=false;if(c1&&c1.length>0){for(d1=0;d1<c1.length;d1++){var h1=c1[d1].AnnotationPath;if(!h1){return{oCard:i,bTemplateUpdated:g1};}h1.trim();if(h1.startsWith("@")){h1=h1.slice(1);}if(h1.indexOf("Chart")!=-1){i.settings.chartAnnotationPath=h1;e1=l[h1];f1=e1&&e1.ChartType&&e1.ChartType.EnumMember;if(f1&&f1.split("/")[1]==="Donut"){i.template="sap.ovp.cards.charts.analytical";}else{i.template="sap.ovp.cards.charts.smart.chart";}}g1=true;}}return{oCard:i,bTemplateUpdated:g1};},_createModelViewMap:function(e){if(!e||!e.settings||!e.model){return;}if(!e.settings.entitySet||e.settings.entitySet===""){return;}if(!(e.template.startsWith("sap.ovp.cards"))){return;}var i=e.model;if(!this.oModelViewMap[i]){this.oModelViewMap[i]={};}this.oModelViewMap[i][e.id]=true;},setTabIndex:function(e){if(typeof e=="object"){this.oTabIndexList=e;}else{this.oTabIndexList={};}},getTabIndex:function(){return this.oTabIndexList;},fGetViewSwitchIndex:function(e){var j=this.getGlobalFilter();var k=j&&j.getUiState();var l=k?JSON.stringify(k.getSelectionVariant()):"{}";var c1=JSON.parse(l);var d1=I({},c1);var e1=[];if(e&&e.length>0){for(var i=0;i<e.length;i++){var f1=I({},e[i]);e1.push(f1);}}this.onBeforeRebindPageExtension(e1,d1);return this.getTabIndex();},changeViewSwitchForVisibleCard:function(){var e=this.getView().getModel("ui").getProperty('/aOrderedCards');if(e&&e.length>0){var j=[],k=[];for(var i=0;i<e.length;i++){j.push(this._getCardFromManifest(e[i].id));}var l=this.fGetViewSwitchIndex(j);if(l&&typeof l=="object"){k=Object.keys(l);}if(k&&k.length>0){for(var i=0;i<e.length;i++){if(e[i]&&e[i].visibility==true){var c1=this._getCardFromManifest(e[i].id);if(c1&&c1.settings&&c1.settings.tabs&&c1.settings.hasOwnProperty("selectedKey")){var d1=l&&l.hasOwnProperty(c1.id)?l[c1.id]:"";var e1=c1.settings.selectedKey;if(d1&&typeof d1=="number"&&d1<=c1.settings.tabs.length&&d1!==e1){this.setOrderedCardsSelectedKey(c1.id,d1);var f1={};f1=c1.settings.tabs[d1-1];var g1={cardId:c1.id,selectedKey:d1};for(var h1 in f1){g1[h1]=f1[h1];}this.recreateCard(g1);}}}}}}},setOrderedCardsSelectedKey:function(e,j){var k=this.getView().getModel("ui").getProperty('/aOrderedCards');for(var i=0;i<k.length;i++){if(k[i]&&k[i].id==e){k[i].selectedKey=j;break;}}this.getView().getModel("ui").setProperty('/aOrderedCards',k);},getOrderedCardsSelectedKey:function(e){var j=this.getView().getModel("ui").getProperty('/aOrderedCards');for(var i=0;i<j.length;i++){if(j[i]&&j[i].id==e){return j[i].selectedKey;}}},initializeTabbedCard:function(e,i){if(e.template=="sap.ovp.cards.charts.analytical"||e.template=="sap.ovp.cards.charts.smart.chart"||e.template=="sap.ovp.cards.v4.charts.analytical"){e.settings.chartAnnotationPath=e.settings.tabs[i].chartAnnotationPath;e.settings.colorPalette=e.settings.tabs[i].colorPalette;e.settings.bEnableStableColors=e.settings.tabs[i].bEnableStableColors;if(e.settings.tabs[i].navigation){e.settings.navigation=e.settings.tabs[i].navigation;}}if(e.settings.tabs[i].entitySet){e.settings.entitySet=e.settings.tabs[i].entitySet;}e.settings.annotationPath=e.settings.tabs[i].annotationPath;e.settings.dynamicSubtitleAnnotationPath=e.settings.tabs[i].dynamicSubtitleAnnotationPath;e.settings.presentationAnnotationPath=e.settings.tabs[i].presentationAnnotationPath;e.settings.selectionAnnotationPath=e.settings.tabs[i].selectionAnnotationPath;e.settings.selectionPresentationAnnotationPath=e.settings.tabs[i].selectionPresentationAnnotationPath;e.settings.kpiAnnotationPath=e.settings.tabs[i].kpiAnnotationPath;e.settings.dataPointAnnotationPath=e.settings.tabs[i].dataPointAnnotationPath;e.settings.identificationAnnotationPath=e.settings.tabs[i].identificationAnnotationPath;e.settings.params=e.settings.tabs[i].params;e.settings.selectedKey=i+1;if(!e.settings.staticParameters){e.settings.staticParameters=e.settings.tabs[i].staticParameters;}if(!e.settings.customParams){e.settings.customParams=e.settings.tabs[i].customParams;}},_getLibraryResourceBundle:function(){if(!this.oLibraryResourceBundle){this.oLibraryResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ovp");}return this.oLibraryResourceBundle;},_getOvplibResourceBundle:function(){return this.getOwnerComponent()._getOvpLibResourceBundle();},_getCardsModel:function(){if(!this.oCards){var e=this.getUIModel();this.oCards=e.getProperty("/cards");}return this.oCards;},_getBaseUrl:function(){var e=this.getUIModel();if(!this.sBaseUrl){this.sBaseUrl=e.getProperty("/baseUrl");}return this.sBaseUrl;},_getApplicationId:function(){var e=this.getUIModel();return e.getProperty("/applicationId");},_getCardFromManifest:function(e){var j=this._getCardsModel();for(var i=0;i<j.length;i++){if(j[i].id===e){return j[i];}}b1.error("Card id "+e+" is not available in the manifest");return null;},_getCardArrayAsVariantFormat:function(e){var j=[];for(var i=0;i<e.length;i++){var k=this._getCardId(e[i].getId());j.push({id:k,visibility:e[i].getVisible()});var l;if(this.getView()&&this.getView().byId){if(this.getView().byId(k).getComponentInstance()){l=this.getView().byId(k).getComponentInstance().getComponentData().settings.selectedKey;}}if(l){j[j.length-1].selectedKey=l;}}return j;},_mergeLREPContent:function(l){var e=[];var i=false;if(this.bDeltaChangesEnabled&&Array.isArray(this.deltaCardsInfo)&&this.deltaCardsInfo.length>0){l=P.addMissingCardsFromManifest(l,this.deltaCardsInfo);i=true;}if(this.getLayout().getMetadata().getName()==="sap.ovp.ui.DashboardLayout"){if(!i){l=this.getLayout().getLayoutDataJSON();}e=P.mergeChanges(l,this.deltaChanges);this._bDashboardLayoutLrepActive=true;this.getLayout().getDashboardLayoutModel().setLayoutVars(e);}else{e=P.mergeChanges(l,this.deltaChanges);}return e?e:[];},_updateLayoutWithOrderedCards:function(){var l=this.getLayout();var e=this.getView().getModel("ui").getProperty('/aOrderedCards');l.removeAllContent();var k,c1=false;if(this.getView().getModel("ui")&&this.getView().getModel("ui").getProperty("/cards")){k=this.getView().getModel("ui").getProperty("/cards");for(var i=0;i<k.length;i++){c1=false;for(var j=0;j<e.length;j++){if(k[i].id==e[j].id){c1=true;break;}}if(!c1&&this.getView().byId(k[i].id)){this.getView().byId(k[i].id).destroy();}}}for(var i=0;i<e.length;i++){var d1=this.getView().byId(e[i].id);if(d1){d1.setVisible(e[i].visibility);l.addContent(d1);}}},_updateErrorCardsArray:function(e){var i;for(i=0;i<e.length;i++){var j=this.aErrorCards.indexOf(e[i].id);if((j>-1)&&e[i].visibility==false){this.aErrorCards.splice(j,1);}}},_updateDashboardLayoutCards:function(e){if(this.getLayout().getMetadata().getName()==="sap.ovp.ui.DashboardLayout"){if(this.getLayout().getDashboardLayoutUtil()){this.getLayout().getDashboardLayoutUtil().updateCardVisibility(e);}}},_resetDashboardLayout:function(){if(this.getLayout().getMetadata().getName()==="sap.ovp.ui.DashboardLayout"){if(this.getLayout().getDashboardLayoutUtil()){this.getLayout().getDashboardLayoutUtil().resetToManifest();}this.getLayout().rerender();}},_getCardArrayAsVariantFormatDashboard:function(){var e=[];var l=this.getLayout();var i=l.dashboardLayoutUtil.aCards;l.dashboardLayoutUtil.dashboardLayoutModel._sortCardsByRow(i);i.forEach(function(j){e.push({id:j.id,visibility:j.dashboardLayout.visible});});return e;},_fnIsLoadDataOnGoButton:function(e){this.getView().byId("ovpFilterNotFulfilledPage").setVisible(true);var i=this.getUIModel().getProperty("/smartVariantRequired");if(!i){return false;}if(!this.oState.oSmartFilterbar.isCurrentVariantStandard()){return false;}var j=this.getUIModel().getProperty("/dataLoadSettings");var l=j?j.loadDataOnAppLaunch:"ifAnyFilterExist";if(!["ifAnyFilterExist","always","never"].includes(l)){b1.error("dataLoadSetting is incorrect. It should be one of ifAnyFilterExist,always,never");}var k=false,c1=true;if(l==="ifAnyFilterExist"){var d1=this.oState.oSmartFilterbar.getFiltersWithValues();k=true;c1=d1.length?true:false;}else if(l==="always"){k=true;}else if(l==="never"){k=false;}if(k){var e1=this.oState.oSmartFilterbar.getSmartVariant();if(e1){e1.setExecuteOnStandard(true);k=e1.getExecuteOnStandard();}}E.loadingState.GLOBALFILTERFILLED=k;return k&&e&&c1;},verifyGlobalFilterLoaded:function(){var l=this.getUIModel().getProperty("/enableLiveFilter");var e=this.getGlobalFilter();var i=true;var j=e.determineMandatoryFilterItems();var k,c1=e.getFilterData(),d1;if(j&&c1){var e1=j.length;while(e1--){k=j[e1];d1=e.determineControlByFilterItem(k,true);if(d1){if(!e._checkForValues(c1,k,d1)){i=false;break;}}}}if(!this.bGlobalFilterLoaded&&l===false){if(!i){if($.hidePlaceholderNeeded()){$.hidePlaceholder();}}return this._fnIsLoadDataOnGoButton(i);}if(i){if(e.validateMandatoryFields()){E.loadingState.GLOBALFILTERFILLED=true;return true;}}else if(!i){if($.hidePlaceholderNeeded()){$.hidePlaceholder();}}this.getView().byId("ovpMain").setHeaderExpanded(true);this.getView().byId("ovpFilterNotFulfilledPage").setVisible(true);E.loadingState.GLOBALFILTERFILLED=false;return false;},onGlobalFilterChange:function(e){this.filterChanged=true;if(this.bGlobalFilterInitialized){var i=this.getGlobalFilter();var l=i.getLiveMode();var j=this.getLayout();var k=e.getParameter("afterFilterDataUpdate");if(!l&&j&&!k){j.setActive(false);}else{this.changeViewSwitchForVisibleCard();}}},destroyErrorCardsAndReplaceWithOriginal:function(){if(this.isModelRefreshTriggered||this.filterChanged||this.bGoButtonPressed||this.bSearchButtonPressed){var k;var e=Object.assign({},this.aErrorCards);for(k in e){var i=this.getView().byId(e[k]);var j=i&&i.getComponentInstance();var l=j&&j.getComponentData();var c1=l&&l.cardId;var d1=this._getCardFromManifest(c1);j.destroy();var e1=this.aErrorCards.indexOf(c1);if((e1>-1)){this.aErrorCards.splice(e1,1);}this.createCard(d1);}this.isModelRefreshTriggered=false;}},onGlobalFilterSearch:function(){if(this.filterChanged||this.bGoButtonPressed||this.bSearchButtonPressed){var e=this.getGlobalFilter();var k=this.getLayout();if(k){k.setActive(true);}if(this.aErrorCards&&this.aErrorCards.length>0){this.destroyErrorCardsAndReplaceWithOriginal();}if(e&&!e.isDialogOpen()){this._storeCurrentAppStateAndAdjustURL();}this._clearStoredEntities();var l=[];if(this.oGlobalFilter['_aFields'].length>0){l=this.oGlobalFilter["_aFields"];}else{var c1=this.oGlobalFilter['_aFilterBarViewMetadata'];for(var i=0;i<c1.length;i++){var d1=c1[i];for(var j=0;j<d1.fields.length;j++){l.push(d1.fields[j]);}}}for(var i=0;i<l.length;i++){if(l[i].control){var e1=document.getElementById(l[i].control.sId);if(Q(e1).hasClass('sapMFocus')){this.filterItemInFocus=l[i].control;break;}}}var f1="ovp-"+new Date().getTime();this._processFilters();this.globalEventBus.publish("OVPGlobalfilter","OVPGlobalFilterSeacrhfired",this.aFilters);if(this.nRefreshInterval!==0){if(this.oRefreshTimer!==null){clearTimeout(this.oRefreshTimer);}this.attachRefreshInterval(this.nRefreshInterval);}for(var g1 in this.oCardsModels){if(this.oCardsModels.hasOwnProperty(g1)&&!c.isODataV4(this.oCardsModels[g1])){try{this.oCardsModels[g1].refresh(false,false,f1);}catch(h1){b1.warning(h1);}}}this.filterChanged=false;this.bGoButtonPressed=false;this.bSearchButtonPressed=false;this._clearStoredEntities();}},_clearStoredEntities:function(){if(this.sPreviousEntityType){this.sPreviousEntityType="";}if(this.sCurrentEntityType){this.sCurrentEntityType="";}},_processSFBFilters:function(){var e=this.getGlobalFilter();var i=e.getFilters();var j=this.getCustomFilters();var k=true;var l;var c1=function(f1,g1){if(!(f1 instanceof A)){throw new Error("State must always be set with respect to a ControllerExtension");}if(!k){throw new Error("State must always be provided synchronously");}if(g1){l=g1;}};this.templateBaseExtension.addFilters(c1);k=false;var d1=[];if(j&&(j instanceof F)){d1.push(j);}if(l&&(l instanceof F)){d1.push(l);}if(d1.length!==0){var e1=[];if(i&&i.length>0){d1.push(i[0]);}e1.push(new F(d1,true));if(e1.length>0){i=e1;}}this.aFilters=i;},_processMacroFilters:function(){var e=this.getMacroFilterBar();var i=e.getConditions();var j=Object.keys(i);var k=[];if(j.length>0){var l=j.map(function(c1){var d1=i[c1]&&i[c1][0];if(d1){return new Z({path:c1,operator:d1.operator,value1:d1.values[0],value2:d1.values[1]});}});l=l.filter(function(c1){return c1!==undefined;});k.push(new Z({filters:l}));}this.aFilters=k;},_processFilters:function(){this.aFilters=[];if(this.getMacroFilterBar()){this._processMacroFilters();}if(this.getGlobalFilter()){this._processSFBFilters();}},_processSearch:function(){var e,i;var j=this.getGlobalFilter();if(!j){return;}var k=j.getParameters();var i=k&&k["custom"];if(!i){return;}for(var l in i){e=l+"="+G(i[l]);}return e;},_initGlobalFilter:function(){var e=this.getGlobalFilter();if(!e){var i=this.getMacroFilterBar();if(!i){this.bGlobalFilterLoaded=true;this._parseNavigationVariant();return;}this.oGlobalFilterLoadedPromise=new Promise(function(k,l){this.fnMacroFilterBarLoaded=k;}.bind(this));return;}e.attachFiltersDialogClosed(this._storeCurrentAppStateAndAdjustURL.bind(this));var j=e.getVariantManagement();if(j){j.attachAfterSave(function(k){this._storeCurrentAppStateAndAdjustURL(undefined,true);}.bind(this));}this.oGlobalFilterLoadedPromise=new Promise(function(k,l){e.attachInitialized(function(){this._parseNavigationVariant();if(this.oParseNavigationPromise){var c1;this.oParseNavigationPromise.then(function(d1){var e1=d1[0];var f1=d1[1];var g1=d1[2];if(e1){c1=Promise.resolve(this._setNavigationVariantToGlobalFilter(e1,f1,g1)).then(function(){this.filterChanged=false;}.bind(this));}}.bind(this));this.oParseNavigationPromise.catch(function(){b1.error("Could not parse navigation variant from URL");});this.oParseNavigationPromise.finally(function(){Promise.all([c1]).then(function(){this.bGlobalFilterInitialized=true;if(e&&this.verifyGlobalFilterLoaded()){k();}}.bind(this));}.bind(this));}else if(e&&this.verifyGlobalFilterLoaded()){k();}},this);e.attachSearch(function(){if(!this.bGlobalFilterLoaded){k();this.bGlobalFilterLoaded=true;if(!e.isDialogOpen()){this._storeCurrentAppStateAndAdjustURL();}var c1=this.getLayout();if(c1){c1.setActive(true);}return;}this.onGlobalFilterSearch();},this);e.attachFilterChange(this.onGlobalFilterChange,this);e._oSearchButton&&e._oSearchButton.attachPress(function(){this.bGoButtonPressed=true;var c1=this.getLayout();if(c1){c1.setActive(true);}}.bind(this));}.bind(this));this.oGlobalFilterLoadedPromise.then(function(k){this.bGlobalFilterLoaded=true;e._oBasicSearchField&&e._oBasicSearchField.attachSearch(function(){this.bSearchButtonPressed=true;}.bind(this));}.bind(this));},onShareButtonPress:function(){var e=this.getView().byId("sapOvpShareButton");if(e&&(e.getVisible()&&e.getEnabled())){this._onShareButtonAvailableAndPressed(e);}},_onShareButtonAvailableAndPressed:function(e){var l=this._getLibraryResourceBundle();var i=this.getUIModel();var j=i&&i.getProperty("/title");if(!this._oShareActionButton){this._oShareActionButton=sap.ui.core.Fragment.load({name:"sap.ovp.app.SharePage",controller:{shareEmailPressed:function(){S.URLHelper.triggerEmail(null,l.getText("Email_Subject",[j]),document.URL);},shareJamPressed:function(){var k=sap.ui.getCore().createComponent({name:"sap.collaboration.components.fiori.sharing.dialog",settings:{object:{id:document.URL,share:j}}});k.open();}}}).then(function(k){this.getView().addDependent(k);return k;}.bind(this));}this._oShareActionButton.then(function(k){k.openBy(e);});},_checkJamAuth:function(){var e=H.get("sap.ushell.Container.getUser");var i=this.getUIModel();if(i){i.setProperty("/jamVisible",!!e&&e().isJamActive());}},_createModelForTile:function(){var e=this.getUIModel();var i,j=e&&e.getProperty("/title");var k={tileTitle:j,tileCustomURL:function(){i=t.getHash();return i?("#"+i):window.location.href;}};if(e){e.setProperty("/tileInfo",k);}},_loadCardComponent:function(e){var i=e.replace(/\./g,'/');var j=sap.ui.require.toUrl(i);if(!this.oLoadedComponents[e]){this.oLoadedComponents[e]=sap.ui.core.Component.load({name:e,url:j,manifest:false}).then(function(k){return k;});}},_initCardModel:function(e){var i=false;if(this.oCardsModels[e]||!e){return;}this.oCardsModels[e]=this.getView().getModel(e);if(!c.isODataV4(this.getView().getModel(e))){if(!this.oCardsModels[e].bUseBatch){this.oCardsModels[e].setUseBatch(false);}else{this.oCardsModels[e].setUseBatch(true);}}if(this.getGlobalFilter()||this.getMacroFilterBar()){i=true;}if(!c.isODataV4(this.oCardsModels[e])){this._overrideCardModelRead(this.oCardsModels[e],i);}},getVisibleCustomFields:function(){var e=this.getGlobalFilter();var i=e.getAllFilterItems(true);var l,j,k=[];if(i){l=i.length;while(l--){j=i[l];if(j&&j.getVisibleInFilterBar()){k.push(j.getName());}}}var c1,d1,e1,f1=e.getFilterBarViewMetadata();var g1=[];if(f1){c1=f1.length;while(c1--){e1=f1[c1].fields;if(e1){d1=e1.length;while(d1--){if(e1[d1].isCustomFilterField&&k.indexOf(e1[d1].fieldName)>-1){g1.push({name:e1[d1].fieldName});}}}}}return g1;},_showErrorPage:function(e){if(this.bDisableErrorPage){return;}var i=this.getView().byId('ovpErrorPage');var j=this.getView().byId('ovpMain');if(e){i.setVisible(true);j.setVisible(false);return;}i.setVisible(false);j.setVisible(true);},_isValueHelpCall:function(e,j){var k=this.getGlobalFilter();if(!e||!k||!k._oFilterProvider){return false;}if(e.getId()!==k.getModel().getId()){return false;}var l=k._oFilterProvider;var c1=l.getAssociatedValueHelpProviders().concat(l.getAssociatedValueListProviders());var d1;for(var i=0;i<c1.length;i++){d1=c1[i]&&c1[i].oPrimaryValueListAnnotation;if(d1&&d1.valueListEntitySetName===j){return true;}}return false;},_removeFilter:function(e,i){var l=e.lastIndexOf(i);var j=e.indexOf(i);if(l===-1||j===-1){return e;}var k="%20and%20";var c1=e.substring(l).indexOf(k);c1=(c1!==-1)?l+c1:c1;var d1=e.substring(0,j).lastIndexOf(k);if(c1===-1&&d1===-1){if(e.lastIndexOf("$filter=")===0){return e.slice(0,8);}else{return"";}}else if(d1===-1){if(e.lastIndexOf("$filter=")===0){return e.slice(0,8)+e.slice(c1+k.length);}else{return e.slice(c1+k.length);}}else if(c1===-1){return e.slice(0,d1);}else{return e.slice(0,d1)+e.slice(c1);}},_removeRelevantFilterRecursively:function(e,j){if(!e._bMultiFilter){if(e.sPath===j){return undefined;}return e;}else{e.aFilters.forEach(function(k,l){e.aFilters[l]=this._removeRelevantFilterRecursively(k,j);}.bind(this));for(var i=0;i<e.aFilters.length;i++){if(!e.aFilters[i]){e.aFilters.splice(i,1);i--;}}if(e.aFilters.length>0){return e;}else{return undefined;}}},_removeRelevantFilter:function(e,i){if(!e||e.length===0){return e;}e[0]=this._removeRelevantFilterRecursively(e[0],i);return(!e[0])?undefined:e;},_getFilterPreference:function(e){var i;var j=this._getCardFromManifest(e);if(j){if(j.settings.tabs){var k=0;var l=j.settings.selectedKey;if(l&&j.settings.tabs.length>=l){k=l-1;}i=j.settings.tabs[k].mFilterPreference;}else{i=j.settings.mFilterPreference;}}return i;},_getFilterPreferenceFromUrlParams:function(e){var i=e.urlParameters;var j;var k="cardId=";var l=-1;if(i){for(var c1=0;c1<i.length;c1++){if((i[c1]).lastIndexOf(k)>=0){l=c1;break;}}if(l>=0){var d1=(i[l]).lastIndexOf(k);var e1=i[l].slice(d1+k.length);j=this._getFilterPreference(e1);if(d1>0){i[l]=i[l].slice(0,d1-1);}else{i.splice(l,1);}}}return j;},_addRelevantFilters:function(e,i,j,k){var l=e.urlParameters;var c1=-1;if(l){for(var d1=0;d1<l.length;d1++){if((l[d1]).lastIndexOf("$filter=",0)===0){c1=d1;break;}}}if(this.aRelevantFilters&&this.aRelevantFilters.length>0){if(c1>=0){var e1=O.createFilterParams(this.aRelevantFilters,i.oMetadata,j).substr(8);if(k&&k.filterAll==="card"){l[c1]=l[c1];}else if(k&&k.filterAll==="global"){l[c1]=l[c1].slice(0,8)+e1;}else if(k&&(k.cardFilter||k.globalFilter)){if(Array.isArray(k.cardFilter)&&k.cardFilter.length>0){k.cardFilter.forEach(function(f1){e1=this._removeFilter(e1,f1);}.bind(this));}if(Array.isArray(k.globalFilter)&&k.globalFilter.length>0){k.globalFilter.forEach(function(f1){l[c1]=this._removeFilter(l[c1],f1);}.bind(this));}if(e1===""&&l[c1].length===8){l.splice(c1,1);}else if(e1===""){l[c1]=l[c1];}else if(l[c1].length===8){l[c1]=l[c1]+e1;}else{if(this.aRelevantFilters.length===1){e1="("+e1+")";}l[c1]=l[c1].slice(0,8)+"("+l[c1].slice(8,l[c1].length)+")%20and%20"+e1;}}else{if(this.aRelevantFilters.length===1){e1="("+e1+")";}l[c1]=l[c1].slice(0,8)+"("+l[c1].slice(8,l[c1].length)+")%20and%20"+e1;}}else{if(k&&k.filterAll==="card"){e.filters=undefined;}else if(k&&k.filterAll==="global"){e.filters=this.aRelevantFilters;}else if(k&&(k.cardFilter||k.globalFilter)){if(Array.isArray(k.cardFilter)&&k.cardFilter.length>0){k.cardFilter.forEach(function(f1){this.aRelevantFilters=this._removeRelevantFilter(this.aRelevantFilters,f1);}.bind(this));}if(this.aRelevantFilters&&this.aRelevantFilters.length>0){e.filters=this.aRelevantFilters;}}else{e.filters=this.aRelevantFilters;}}}else{if(c1>=0){if(k&&k.filterAll==="card"){l[c1]=l[c1];}else if(k&&k.filterAll==="global"){l.splice(c1,1);}else if(k&&k.globalFilter){if(Array.isArray(k.globalFilter)&&k.globalFilter.length>0){k.globalFilter.forEach(function(f1){l[c1]=this._removeFilter(l[c1],f1);}.bind(this));}if(l[c1].length===8){l.splice(c1,1);}}}}return e;},_overrideCardModelRead:function(e,j){var k=e.read;var l=this;e.read=function(){var c1=arguments[1];if(!c1){c1={};Array.prototype.push.call(arguments,c1);}var d1=l._getEntityTypeFromPath(e,arguments[0],c1.context,false);var e1=l._getEntitySetFromEntityType(e,d1);if(l._isValueHelpCall(e,e1.name)){return k.apply(e,arguments);}var f1=l._getFilterPreferenceFromUrlParams(c1);if(j){l._processFilters();var g1=l.getGlobalFilter();var h1=l.getMacroFilterBar();var i1=g1!==undefined?g1.getModel():h1.getModel();if(!l.aFilters){l.aFilters=[];}var j1=false;var k1;var l1=e1["Org.OData.Capabilities.V1.SearchRestrictions"];if(e1["sap:searchable"]==="true"||(l1&&l1.Searchable&&l1.Searchable.Bool&&l1.Searchable.Bool==="true")){k1=l._processSearch();}l.sCurrentEntityType=d1.entityType;if(l.sPreviousEntityType!==l.sCurrentEntityType){l.sPreviousEntityType=l.sCurrentEntityType;j1=true;}if(!l.aRelevantFilters){l.aRelevantFilters=[];j1=true;}if(j1){l.aRelevantFilters=[];if(d1){l.aRelevantFilters=l._getEntityRelevantFilters(d1,l.aFilters,e,i1);}}c1=l._addRelevantFilters(c1,e,d1,f1);var m1=c1.urlParameters;if(k1){m1[m1.length]=k1;}if(g1&&g1.getConsiderAnalyticalParameters()){var n1=g1.getAnalyticBindingPath();var o1,p1,q1;if(n1&&n1.length>0){if(d1.entityType===g1.getEntityType()){p1=arguments[0];o1=arguments[0].indexOf('$');if(o1>0){p1=arguments[0].substring(0,o1-1);}q1=n1;if(p1!==q1){arguments[0]=arguments[0].replace(p1,q1);}}else{var r1=l._getParametersFromEntityPath(arguments[0]);var s1=l._getParametersFromEntityPath(n1);var t1,u1,v1;if(r1&&r1.length>0){var w1=l._getEntityTypeFromPath(e,arguments[0],c1.context,true);for(var i=0;i<s1.length;i++){t1=l._getPropertyMapping(r1,s1[i].name,w1.name,g1.getEntityType(),e,g1.getModel());if(t1){u1=t1+"=.*?[,\)]";v1=arguments[0].match(new RegExp(u1));if(v1&&v1.length>0){p1=v1[0].slice(0,-1);q1=t1+"="+s1[i].sValue;if(p1!==q1){arguments[0]=arguments[0].replace(p1,q1);}}}}}}}}}var x1=e.getMetaModel();var y1=x1.getODataEntityType(e1.entityType);m1=l._getExpandPropertiesForSmartCharts(m1,x1,y1);var z1=arguments[1].success;arguments[1].success=(function(C1,l){return function(){if(!l.errorHandlingObject.atLeastOneRequestSuccess){l.errorHandlingObject.atLeastOneRequestSuccess=true;l._showErrorPage(false);}if(l.filterItemInFocus!=null){l.filterItemInFocus.focus();l.filterItemInFocus=null;}if(l.nRefreshInterval!==0){if(l.oRefreshTimer!==null){clearTimeout(l.oRefreshTimer);}l.attachRefreshInterval(l.nRefreshInterval);}return C1.apply(this,arguments);};})(z1,l);var A1=arguments[1].error;arguments[1].error=(function(C1,l){return function(){if(!l.errorHandlingObject.atLeastOneRequestSuccess){clearTimeout(l.errorHandlingObject.errorLoadingTimeout);l.errorHandlingObject.errorLoadingTimeout=setTimeout(function(){if(!l.errorHandlingObject.atLeastOneRequestSuccess){l._showErrorPage(true);}},9000);}return C1.apply(this,arguments);};})(A1,l);var B1=k.apply(e,arguments);return B1;};},showErrorCardForMissingParam:function(e,j){var k=e[0];var l=e[1].urlParameters;for(var i in l){k=k+l[i];}var c1=new sap.ui.base.Event();c1.mParameters={"url":k,"response":{"statusText":y.getText("Missing_Param_Text")}};c1.oSource=j;setTimeout(function(){this.fVerifyAndSetErrorOrCustomMessageCard(c1,false);}.bind(this),0);},_checkMandatoryParams:function(e,j,k){var l=new u.Model(u.Model.ReferenceByModel(e));var c1=l.findQueryResultByName(j);var d1=c1&&c1.getParameterization();if(!d1){return true;}var e1=d1.getAllParameterNames();var f1=k.match(/\(.*\)/g);if(e1.length>0&&f1===null){return false;}var g1=f1[0].replace("(","").replace(")","").split(",");if(g1.length===e1.length){for(var i in g1){var h1=g1[i].split("=")[1];if(h1.indexOf("%27")>-1){h1=h1.split("%27")[1];}if(h1.length===0){return false;}}}else{return false;}},_getExpandPropertiesForSmartCharts:function(e,i,c1){var d1;var e1="";var f1;var g1;var h1;var i1="$expand";var j1=false;var k1=false;var l1;var m1;var n1;var o1="com.sap.vocabularies.Common.v1.Text";var p1=c1&&c1.property;if(!e||!(e.length>0)){return e;}for(var l=0;l<e.length;l++){if(e[l].indexOf("$expand")>-1){return e;}}for(var q1=0;q1<e.length;q1++){if(e[q1].indexOf("$select")>-1){k1=true;m1=e[q1];h1=e[q1].split("$select=");if(h1&&h1[1]){l1=decodeURIComponent(h1[1]);d1=l1.split(",");if(!d1||!(d1.length>1)){return e;}}break;}}if(!k1){return e;}if(!d1||!(d1.length>0)||!p1||!(p1.length>0)){return e;}for(var j=0;j<d1.length;j++){for(var k=0;k<p1.length;k++){if(d1[j]==(p1[k]&&p1[k].name)){if(p1[k]&&p1[k]["sap:aggregation-role"]&&p1[k]["sap:aggregation-role"]=="dimension"){if(!p1[k][o1]||!p1[k][o1].Path||!(p1[k][o1].Path.indexOf("/")>0)){break;}e1=p1[k][o1].Path;f1=e1.split("/");if(!f1.length){break;}g1=i.getODataAssociationEnd(c1,f1[0]);if(!g1){break;}if(!j1){i1=i1+"="+f1[0];j1=true;}else if(j1){i1=i1+","+f1[0];}n1=m1+","+e1;}break;}}}if(n1&&i1){e[q1]=n1;e.push(i1);}return e;},attachRefreshInterval:function(e){this.oRefreshTimer=setTimeout(function(){this._processFilters();this.globalEventBus.publish("OVPGlobalfilter","OVPGlobalFilterSeacrhfired",this.aFilters);var l=this.getLayout();if(l&&l.getActive()){for(var i in this.oCardsModels){this.isModelRefreshTriggered=true;if(!c.isODataV4(this.oCardsModels[i])){this.oCardsModels[i].refresh(false,false);}}}}.bind(this),e);},_getEntityTypeFromPath:function(e,i,j,k){var l=q.prototype._normalizePath.apply(e,[i,j]);if(k){l=i.replace(/^\/|\/$/g,"").split("/")[0];if(l.indexOf("(")!=-1){l=l.substring(0,l.indexOf("("));}}var c1=r.prototype._getEntityTypeByPath.apply(e.oMetadata,[l]);return c1;},_getEntitySetFromEntityType:function(e,j){if(!e||!j){return;}var k=e.getMetaModel();var l=k&&k.getODataEntityContainer();var c1=l&&l.entitySet;if(!c1||!Array.isArray(c1)){return;}var d1=c1.length;for(var i=0;i<d1;i++){if(c1[i].entityType===j.entityType){return c1[i];}}},_getPropertyMapping:function(e,j,k,l,c1,d1){var i,e1;for(i=0;i<e.length;i++){if(e[i].name===j){e1=e[i].name;return e1;}if((("P_"+e[i].name)===j)||(e[i].name===("P_"+j))){e1=e[i].name;return e1;}}if(!k||!l||!c1||!d1){return;}var f1=c1.oMetadata._getEntityTypeByName(k);var g1=d1.oMetadata._getEntityTypeByName(l);if(!f1||!g1){return;}var h1="com.sap.vocabularies.Common.v1.SemanticObject";var i1="com.sap.vocabularies.Common.v1.SemanticObjectMapping";var j1=c1.oAnnotations.getAnnotationsData();if(!j1||!j1.propertyAnnotations){return;}var k1=j1.propertyAnnotations[f1.namespace+"."+f1.name];var l1=d1.oAnnotations.getAnnotationsData();if(!l1||!l1.propertyAnnotations){return;}var m1=l1.propertyAnnotations[g1.namespace+"."+g1.name];var n1=m1&&m1[j];if(!n1||!n1[h1]){return;}var o1,p1,q1,r1,s1;for(o1 in k1){p1=k1[o1];if(p1[h1]&&p1[h1].String===n1[h1].String){q1=p1[i1];if(!q1){continue;}r1=q1.length;s1="";while(r1--){if(q1[r1].SemanticObjectProperty.String===j){s1=q1[r1].LocalProperty.PropertyPath;break;}}if(s1!==""){for(i=0;i<e.length;i++){if(e[i].name===s1){e1=e[i].name;return e1;}}}}}return e1;},_getParametersFromEntityPath:function(e){e=e.split("?")[0];var j=e.match(/\(.*=.*\)/);var k=[];if(!j){return k;}var l=j[0].slice(1,-1).trim().split(/\=|\,/);for(var i=0;i<l.length;i=i+2){k.push({name:l[i],sValue:l[i+1]});}return k;},_checkRelevantFiltersRecursive:function(e,j,k,l,c1,d1){if(!j._bMultiFilter){j.sPath=j.sPath.split('/').pop();var e1=this._getPropertyMapping(e,j.sPath,k,l,c1,d1);if(e1){j.sPath=e1;return j;}}else{var f1=j.aFilters;var g1,h1=[];if(f1){for(var i=0;i<f1.length;i++){g1=this._checkRelevantFiltersRecursive(e,f1[i],k,l,c1,d1);if(g1){h1.push(g1);}}if(h1.length>0){return(new F(h1,j.bAnd));}}}},_getEntityRelevantFilters:function(e,i,j,k){var l=[];if(i.length>0&&e){var c1=this.isMacroFilterBar?e.entityType:this.getGlobalFilter().getEntityType();var d1=this._checkRelevantFiltersRecursive(e.property,i[0],e.name,c1,j,k);if(d1){l.push(d1);}}return l;},_checkIsCardValid:function(e){var i=e+".Component";var j,k;sap.ui.require(i);var l=H.get(i);if(!l){return false;}if((l!==a)&&!(l.prototype instanceof a||l.prototype instanceof b)){return false;}if((j=l.getMetadata())&&(k=j.getCustomizing())){if(k["sap.ui.viewReplacements"]&&k["sap.ui.viewReplacements"]["sap.ovp.cards.generic.Card"]){return false;}}if((l.prototype.createContent!=a.prototype.createContent)&&(l.prototype.createContent!=b.prototype.createContent)){return false;}if((l.prototype.getPreprocessors!=a.prototype.getPreprocessors)&&(l.prototype.getPreprocessors!=b.prototype.getPreprocessors)){return false;}return true;},_createCardComponent:function(e,i,j){var k=e.getModel("@i18n");if(j.template&&this._checkIsCardValid(j.template)){var l={name:j.template,manifest:false,componentData:{model:i,modelName:j.model,i18n:k,cardId:j.id,settings:j.settings,appComponent:this.getOwnerComponent(),mainComponent:this}};var c1=this.getGlobalFilter();if(j.errorReason){l.componentData.errorReason=j.errorReason;}if(c1){l.componentData.globalFilter={getUiState:c1.getUiState.bind(c1)};}var d1=e;this.getOwnerComponent().runAsOwner(function(){sap.ui.core.Component.create(l).then(function(e1){var f1=e1.getComponentData().cardId;var g1=d1.byId(f1);g1.setPropagateModel(true);var h1=g1.getComponentInstance();g1.setComponent(e1);if(h1){setTimeout(function(){h1.destroy();},0);}});});}else{b1.error("Could not create Card from '"+j.template+"' template. Card is not valid.");}},createErrorCard:function(e,i){var j=I({},e,{template:"sap.ovp.cards.error"});j.errorReason=Object.assign({},i);j.settings.oldTemplate=e.template;j.settings.template="sap.ovp.cards.error";this._createCardComponent(this.getView(),undefined,j);},createCard:function(e){var i=this.getView();var j=i.getModel(e.model);var k;if(c.isODataV4(j)){k=[j.getMetaModel().requestObject("/"+e.settings.entitySet),this.oGlobalFilterLoadedPromise,this.oLoadedComponents[e.template]];}else{k=[j.getMetaModel().loaded(),this.oGlobalFilterLoadedPromise,this.oLoadedComponents[e.template],this.oLoadedComponents["sap.ovp.cards.error"]];}return Promise.all(k).then(function(){this._createCardComponent(i,j,e);}.bind(this),function(l){b1.error("Can't load card with id:'"+e.id+"' and type:'"+e.template+"', reason:"+l);});},_getCardId:function(e){var i=this.getView().getId()+"--";if(e.indexOf(i)!=-1){var j=e.indexOf(i)+i.length;return e.substr(j);}return e;},_initFlexibilityPersonalization:function(){var l=this.getLayout();var e="sap/ovp/flexibility/changeHandler/PersonalizationChangeHandler";var j=l.getContent();for(var i=0;i<j.length;i++){j[i].addCustomData(new R({key:"sap-ui-custom-settings",value:{"sap.ui.fl":{"flexibility":e}}}));}this.oFlexibilityPersonalizationPromise=new Promise(function(k,c1){K.waitForChanges({selectors:j}).then(function(){if(this.deltaChanges.length>0){this.bDeltaChangesEnabled=true;}k();}.bind(this),function(d1){k();});}.bind(this));},layoutChanged:function(e){var j=e.getParameter("positionChanges");var k=[],l=[];var c1,d1;if(this.getLayout().getMetadata().getName()==="sap.ovp.ui.DashboardLayout"){var e1=this.getLayout().dashboardLayoutUtil.dashboardLayoutModel.iColCount;if(j){for(var i=j.length-1;i>=0;i--){c1=j[i];d1=c1.content.cardId;if(c1.content.dashboardLayout.oldRow===c1.content.dashboardLayout.row&&c1.content.dashboardLayout.oldColumn===c1.content.dashboardLayout.column&&c1.content.dashboardLayout.oldRowSpan===c1.content.dashboardLayout.rowSpan&&c1.content.dashboardLayout.oldColSpan===c1.content.dashboardLayout.colSpan){continue;}if(l[d1]){l[d1].content.dashboardLayout.oldRow=c1.content.dashboardLayout.oldRow;continue;}l[d1]=c1;}Object.keys(l).forEach(function(h1){var c1=l[h1];if(c1.content.dashboardLayout.oldRow===c1.content.dashboardLayout.row&&c1.content.dashboardLayout.oldColumn===c1.content.dashboardLayout.column&&c1.content.dashboardLayout.oldRowSpan===c1.content.dashboardLayout.rowSpan&&c1.content.dashboardLayout.oldColSpan===c1.content.dashboardLayout.colSpan){return;}k.push(l[h1]);});k.forEach(function(c1){var h1=c1.content.dashboardLayout;c1.content.dashboardLayout={};c1.content.dashboardLayout["C"+e1]=h1;});}}else{var f1=this.getLayout().getContent();var g1=this._getCardArrayAsVariantFormat(f1);this.getView().getModel("ui").setProperty('/aOrderedCards',g1);k=j;}if(k.length>0){P.savePersonalization(k,this.getView());}},saveVariant:function(e){var i=this;this.smartVariandManagement.getVariantsInfo(function(j){var k=null;if(j&&j.length>0){k=j[0].key;}var l=k!==null;var c1={name:"Personalisation",global:false,overwrite:l,key:k,def:true};i.smartVariandManagement.fireSave(c1);});},getLayout:function(){return this.getView()?this.getView().byId("ovpLayout"):null;},_initShowHideCardsButton:function(){var e=sap.ushell.Container.getRenderer("fiori2");if(e){var i={controlType:"sap.ushell.ui.launchpad.ActionItem",bCurrentState:true,oControlProperties:{icon:"sap-icon://dimension",text:y.getText("hideCardsBtn_title"),tooltip:y.getText("hideCardsBtn_title"),press:this._onManageCardsMenuButtonPress.bind(this)},bIsVisible:true,aStates:["app"]};e.addUserAction(i);}},createOrDestroyCards:function(e,k,l){var c1=-1,d1=[],e1=[];for(var i=0;i<k.length;i++){if(e[i].id==k[i].id){c1=i;}else{c1=this.getCardIndexInArray(e,k[i].id);}var f1=this.getView().byId(k[i].id);var g1=f1.getComponentInstance();if(l){if(g1){g1.destroy();}}if(k[i].visibility!=e[c1].visibility||l){if(k[i].visibility===true){var h1=this._getCardFromManifest(k[i].id);d1.push({oCard:h1,sCreateOrDestroy:"create"});e1.push(h1);}else if(g1){d1.push({oCard:g1,sCreateOrDestroy:"destroy"});}}}var i1=this.fGetViewSwitchIndex(e1);if(d1&&d1.length>0){var j1=this.getView().getModel("ui").getProperty('/aOrderedCards');for(var j=0;j<d1.length;j++){if(d1[j]&&d1[j].oCard&&d1[j].hasOwnProperty("sCreateOrDestroy")&&d1[j].sCreateOrDestroy=="create"){var k1=d1[j].oCard;if(k1){k1.settings.baseUrl=this._getBaseUrl();this._clearStoredEntities();this._initCardModel(k1.model);k1=this._getTemplateForChart(k1);this._loadCardComponent(k1.template);this._createModelViewMap(k1);if(k1.settings.tabs){var l1=0;var m1=[];m1.push(k1);var n1=i1&&i1.hasOwnProperty(k1.id)?i1[k1.id]:"";var o1=this.getOrderedCardsSelectedKey(k1.id);if(n1&&typeof n1=="number"&&n1<=k1.settings.tabs.length&&n1!==o1){l1=n1>=1?n1-1:n1;this.setOrderedCardsSelectedKey(k1.id,n1);}else if(j1[j].selectedKey&&k1.settings.tabs.length>=j1[j].selectedKey){l1=j1[j].selectedKey-1;}this.initializeTabbedCard(k1,l1);}this.createCard(k1);}}else if(d1[j]&&d1[j].oCard&&d1[j].hasOwnProperty("sCreateOrDestroy")&&d1[j].sCreateOrDestroy=="destroy"){d1[j].oCard.destroy();}}}},getCardIndexInArray:function(e,j){for(var i=0;i<e.length;i++){if(e[i].id==j){return i;}}return-1;},rerenderCards:function(e){var j=this.getView().getModel("ui").getProperty('/aOrderedCards');this.createOrDestroyCards.apply(this,[j,e,false]);this.getView().getModel("ui").setProperty('/aOrderedCards',e);this._updateDashboardLayoutCards(e);this._updateLayoutWithOrderedCards();P.savePersonalization(this.visibilityChanges,this.getView());for(var i=0;i<e.length;i++){var k=e[i];var l=this.aErrorCards.indexOf(k.id);if(l>-1&&k.visibility==false){this.aErrorCards.splice(l,1);}}},getManageCardsDialogModelState:function(e){var j=[];for(var i=0;i<e.length;i++){j.push({'id':e[i].id,'visibility':e[i].visibility});}return j;},_onManageCardsMenuButtonPress:function(){this.visibilityChanges=[];var e;this.aManageCardsDialogModelState=[];var j=this.getView().getModel("ui").getProperty('/aOrderedCards');if(this.manageCardsDialog){this.openManageCardsDialog(j);}else{sap.ui.core.Fragment.load({name:"sap.ovp.app.ManageCard",controller:{onManageCardOkButtonPressed:function(){var k=this.manageCardsDialog.getModel().getProperty('/cards');this.createOrDestroyCards.apply(this,[this.aManageCardsDialogModelState,k,false]);this.getView().getModel("ui").setProperty('/aOrderedCards',k);this._updateDashboardLayoutCards(k);this._updateLayoutWithOrderedCards();P.savePersonalization(this.visibilityChanges,this.getView());this.manageCardsDialog.close();for(var i=0;i<k.length;i++){var l=k[i];var c1=this.aErrorCards.indexOf(l.id);if(c1>-1&&l.visibility==false){this.aErrorCards.splice(c1,1);}}this.aManageCardsDialogModelState=[];}.bind(this),onManagecardCancelButtonPressed:function(){this.manageCardsDialog.close();}.bind(this),onManageCardResetButtonPressed:function(){var l=this.getLayout().getMetadata().getName();M.show(y.getText("reset_cards_confirmation_msg"),{id:"resetCardsConfirmation",icon:M.Icon.QUESTION,title:y.getText("reset_cards_confirmation_title"),actions:[M.Action.OK,M.Action.CANCEL],onClose:function(k){if(k===M.Action.OK){this.manageCardsDialog.setBusy(true);var j=this.getView().getModel("ui").getProperty('/aOrderedCards');this.createOrDestroyCards.apply(this,[j,this.aManifestOrderedCards,(l==="sap.ovp.ui.DashboardLayout")?true:false]);this.getView().getModel("ui").setProperty('/aOrderedCards',this.aManifestOrderedCards);this._resetDashboardLayout();this._updateDashboardLayoutCards(this.aManifestOrderedCards);this._updateLayoutWithOrderedCards();this.manageCardsDialog.getModel().setProperty('/cards',this.aManifestOrderedCards);var c1=[];for(var i=0;i<j.length;i++){c1.push(this.getView().byId(j[i].id));}s.reset({selectors:c1}).finally(function(){this.manageCardsDialog.setBusy(false);this.manageCardsDialog.close();}.bind(this));}}.bind(this)});}.bind(this),onCardVisibilityChange:function(i){var k=i.oSource.getParent();k.toggleStyleClass('sapOVPHideCardsTableItem');k.getCells()[0].toggleStyleClass('sapOVPHideCardsDisabledCell');var l=i.getSource().getBindingContext().getObject();var c1;this.visibilityChanges.forEach(function(d1,e1){if(d1.content.cardId===l.id){c1=e1;}});if(c1&&c1>-1){this.visibilityChanges.splice(c1,1);}else{this.visibilityChanges.push({changeType:"visibility",content:{cardId:l.id,visibility:i.getParameter("state")},isUserDependent:true});}}.bind(this),cardTitleFormatter:function(i){var k=(i!==null)?this._getCardFromManifest(i):null;if(k){var l=k.settings;return l.title||l.category||l.subTitle;}return i;}.bind(this),afterManageCardsDialogOpen:function(){var l=this.getLayout().getMetadata().getName();var k=(l==="sap.ovp.ui.DashboardLayout")?true:this.isValidForReset();var c1=this.manageCardsDialog.getButtons();var d1;for(var i=0;i<c1.length;i++){if(c1[i].sId==='manageCardsResetBtn'){d1=c1[i];}}d1.setEnabled(k);this.manageCardsDialog.setProperty('stretch',o.system.phone);}.bind(this),afterManageCardsDialogClose:function(){this.visibilityChanges=[];this.manageCardsDialog.close();}.bind(this),onAfterManageCardsTableUpdated:function(k){var l=k.oSource.mAggregations.items;if(l){for(var i=0;i<l.length;i++){if(!l[i].getCells()[1].getState()){l[i].addStyleClass('sapOVPHideCardsTableItem');l[i].getCells()[0].addStyleClass('sapOVPHideCardsDisabledCell');}}}setTimeout(function(){document.querySelector('.sapMListTblRow').focus();},200);}}}).then(function(i){this.manageCardsDialog=i;e=Object.assign([],j);this.aManageCardsDialogModelState=this.getManageCardsDialogModelState(j);var k=new J({cards:e});this.manageCardsDialog.setModel(k);this.getView().addDependent(this.manageCardsDialog);this.openManageCardsDialog(j);}.bind(this));}},openManageCardsDialog:function(e){if(this.getLayout().getMetadata().getName()==="sap.ovp.ui.DashboardLayout"){var i=this._getCardArrayAsVariantFormatDashboard();var j=[];e.forEach(function(l){j.push(l['id']);});var k=[];i.forEach(function(l){if(j.indexOf(l.id)!=-1){k.push({"id":l.id,"visibility":l.visibility});}});e=k;}this.aManageCardsDialogModelState=this.getManageCardsDialogModelState(e);this.getView().getModel("ui").setProperty('/aOrderedCards',e);this.manageCardsDialog.getModel().setProperty('/cards',e);this.manageCardsDialog.open();},isValidForReset:function(){var e=this.getView().getModel("ui").getProperty('/aOrderedCards');for(var i=0;i<this.aManifestOrderedCards.length;i++){if(this.aManifestOrderedCards[i].id!==e[i].id||this.aManifestOrderedCards[i].visibility!==e[i].visibility){return true;}}return false;},isDragAndDropEnabled:function(){return!o.system.phone;},getGlobalFilter:function(){if(!this.oGlobalFilter){this.oGlobalFilter=this.getView().byId("ovpGlobalFilter");}return this.oGlobalFilter;},getMacroFilterBar:function(){if(!this.oMacroFilterBar){this.oMacroFilterBar=this.getView().byId("ovpGlobalMacroFilter");}return this.oMacroFilterBar;},getUIModel:function(){if(!this.oUIModel){var e=this.getOwnerComponent();this.oUIModel=e&&e.getModel("ui");}return this.oUIModel;},_parseNavigationVariant:function(){if(!this.oContainer){this.oParseNavigationPromise=Promise.resolve();return;}var e=this.oNavigationHandler;this.oParseNavigationPromise=new Promise(function(i,j){return e.parseNavigation().done(function(k,l,c1){i([k,l,c1]);}).fail(function(){j();});});},_setUiStateToGlobalFilter:function(e,i,j){var k=this.getGlobalFilter();var l=new U({selectionVariant:e.toJSONObject()});k.setUiState(l,{replace:j,strictMode:false});i=i.concat(e.getParameterNames().concat(e.getSelectOptionsPropertyNames()));i=i.filter(function(c1,d1,e1){return e1.indexOf(c1)==d1;});return i;},_processModifyStartupExtension:function(e){if(!e){e=[];}var i=this.getGlobalFilter();var j=i.getUiState();var k=new d(j.getSelectionVariant());var l=JSON.parse(JSON.stringify(k));return new Promise(function(c1,d1){Promise.all([this.modifyStartupExtension(k),this.templateBaseExtension.provideStartupExtension(k)]).then(function(){if(JSON.stringify(k)!==JSON.stringify(l)){try{e=this._setUiStateToGlobalFilter(k,e,true);}catch(e1){b1.error("Error with modifyStartupExtension, falling back to default behavior"+e1);e=this._setUiStateToGlobalFilter(l,e,true);}}c1(e);}.bind(this));}.bind(this));},_addFieldsToSFBAdvancedArea:function(e){var l;var i=this.getGlobalFilter();if(e&&e.length>0){l=e.length;while(l--){i.addFieldToAdvancedArea(e[l]);}}},_restoreAppState:function(e){this.restoreCustomAppStateDataExtension(e._CUSTOM);var i=e._EXTENSION;if(!i){return;}var j=true;var k=function(l){if(!(l instanceof A)){throw new Error("State must always be retrieved with respect to a ControllerExtension");}var c1=l.getMetadata().getNamespace();if(!j){throw new Error("State must always be restored synchronously");}return i[c1];};this.templateBaseExtension.restoreExtensionAppStateData(k);j=false;},_setNavigationVariantToGlobalFilter:function(e,j,k){return new Promise(function(l,c1){var d1=this.getGlobalFilter();var e1=this.getUIModel().oData;var f1=this.oState.oSmartFilterbar;var g1=this.oGlobalFilter.getUiState().getSemanticDates();if(!d1){return;}switch(k){case"iAppState":if(e.selectionVariant){var h1=JSON.parse(e.selectionVariant);if(h1.SelectionVariantID.length!==0){var i1=d1.getVariantManagement().getVariantItems().map(function(y1){return y1.getKey();});var j1=h1.SelectionVariantID;if(i1.indexOf(j1)===-1){l();break;}}var k1,l1,m1=false;var n1,o1,p1,q1;var r1,s1,t1;d1.clearVariantSelection();h1=JSON.parse(e.selectionVariant);d1.setCurrentVariantId(h1.SelectionVariantID);s1=d1.getUiState({allFilters:false});o1=s1&&JSON.stringify(s1.getSelectionVariant());q1=d1.getFilterData()._CUSTOM;q1=((typeof q1=='undefined')?{}:q1);r1=new U({selectionVariant:e.oSelectionVariant.toJSONObject(),semanticDates:e.semanticDates});d1.setUiState(r1,{replace:true,strictMode:false});k1=new d(e.selectionVariant);l1=k1.getParameterNames().concat(k1.getSelectOptionsPropertyNames());for(var i=0;i<l1.length;i++){d1.addFieldToAdvancedArea(l1[i]);}t1=d1.getUiState({allFilters:false});n1=t1&&JSON.stringify(t1.getSelectionVariant());if(o1!==n1){m1=true;}if(e.customData&&Object.keys(e.customData).length>0){var p1=e.customData;this._restoreAppState(p1);if(JSON.stringify(q1)!==JSON.stringify(p1)){m1=true;}}d1.getSmartVariant().currentVariantSetModified(m1);d1._updateToolbarText();}l();break;case"xAppState":case"URLParams":var u1=[];var v1=new d(e.oSelectionVariant.toJSONObject());var w1=new d(e.oDefaultedSelectionVariant.toJSONObject());if(!e.bNavSelVarHasDefaultsOnly&&!v1.isEmpty()){d1.clearVariantSelection();d1.clear();u1=this._setUiStateToGlobalFilter(v1,u1,true);}if(e.bNavSelVarHasDefaultsOnly&&!w1.isEmpty()&&d1.getCurrentVariantId()===""){var x1=this._mergeDefaultWithSFBVariant(w1,new d(JSON.stringify(d1.getUiState().getSelectionVariant())));u1=this._setUiStateToGlobalFilter(x1,u1,true);}if(d1.getCurrentVariantId()!==""){this._setDisplayCurrency(w1);}Promise.resolve(this._processModifyStartupExtension(u1)).then(function(u1){this._addFieldsToSFBAdvancedArea(u1);if(this.oGlobalFilter.isCurrentVariantStandard()&&e.bNavSelVarHasDefaultsOnly!==false&&this.oGlobalFilter.getSmartVariant()){Y.setSemanticDateRangeDefaultValue(e1,f1,g1,j||{});this.oGlobalFilter.getSmartVariant().currentVariantSetModified(false);}l();}.bind(this));break;case"initial":Promise.resolve(this._processModifyStartupExtension()).then(function(u1){this._addFieldsToSFBAdvancedArea(u1);if(this.oGlobalFilter.isCurrentVariantStandard()&&e.bNavSelVarHasDefaultsOnly!==false&&this.oGlobalFilter.getSmartVariant()){Y.setSemanticDateRangeDefaultValue(e1,f1,g1,j||{});this.oGlobalFilter.getSmartVariant().currentVariantSetModified(false);}l();}.bind(this));break;default:break;}}.bind(this));},_mergeDefaultWithSFBVariant:function(e,i){if(e.isEmpty()){return i;}var j=new d();var k,l;[i,e].forEach(function(c1){k=c1.getSelectOptionsPropertyNames();k.forEach(function(d1){j.removeSelectOption(d1);j.massAddSelectOption(d1,c1.getSelectOption(d1));});l=c1.getParameterNames();l.forEach(function(d1){j.removeParameter(d1);j.addParameter(d1,c1.getParameter(d1));});});return j;},_setDisplayCurrency:function(e){var i=this.getGlobalFilter();if(!i){return;}var l,j;var k=i.getAnalyticalParameters();if(k&&k.length>0){l=k.length;while(l--){if((k[l].name==="P_DisplayCurrency")||(k[l].name==="DisplayCurrency")){j=k[l];break;}}}if(!j){return;}var c1=i.getFilters([j.fieldName]);var d1=c1&&c1[0]&&c1[0].oValue1;if(d1&&d1!==" "){return;}var e1,f1;if(j.name.indexOf("P_")===0){f1=j.name;e1=j.name.substr(2);}else{f1="P_"+j.name;e1=j.name;}if(e&&!e.isEmpty()){var g1;d1=e.getParameter(e1);if(!d1||d1===" "){d1=e.getParameter(f1);}if(!d1||d1===" "){g1=e.getSelectOption(e1);d1=g1&&g1[0]&&g1[0].Low;}if(!d1||d1===" "){g1=e.getSelectOption(f1);d1=g1&&g1[0]&&g1[0].Low;}}if(!d1||d1===" "){d1=j.defaultPropertyValue;}if(!d1||d1===" "){return;}var h1=new d();h1.addParameter(j.name,d1);var i1=new U({selectionVariant:h1.toJSONObject()});i.setUiState(i1,{replace:false,strictMode:false});},_getCustomAppState:function(){var e={},i={};this.getCustomAppStateDataExtension(e);if(!(X(e))){i[_]=e;}var j;var k=true;var l=function(c1,d1){if(!(c1 instanceof A)){throw new Error("State must always be set with respect to a ControllerExtension");}if(!k){throw new Error("State must always be provided synchronously");}if(d1){j=j||Object.create(null);var e1=c1.getMetadata().getNamespace();j[e1]=d1;}};this.templateBaseExtension.provideExtensionAppStateData(l);k=false;if(j){i[a1]=j;}return i;},onBeforeSFBVariantSave:function(){var e=this._getCustomAppState();var i=this.getGlobalFilter().getFilterData();var j,k=this.getGlobalFilter().getBasicSearchControl();if(k&&k.getValue){j=k.getValue();}i._CUSTOM=e[_];i._EXTENSION=e[a1];this.getGlobalFilter().setFilterData(i,true);if(j){this.getGlobalFilter().getBasicSearchControl().setValue(j);}this.getGlobalFilter().fireFilterChange();},onAfterSFBVariantLoad:function(){var e=this.getGlobalFilter().getFilterData();if(e){this._restoreAppState(e);}},onAssignedFiltersChanged:function(e){if(e.getSource()&&this.getView().byId("ovpFilterText")){this.getView().byId("ovpFilterText").setText(e.getSource().retrieveFiltersWithValuesAsText());}},_CustomFilterField:function(e,i){for(var k in e){if(e.hasOwnProperty(k)){i[k]=e[k];}}},_getCurrentAppState:function(e){var i=this.getGlobalFilter();if(!i){return;}var j={};var k=this._getCustomAppState();var l={_CUSTOM:k[_],_EXTENSION:k[a1]};if(!e){if(l._CUSTOM){this._CustomFilterField(l._CUSTOM,j);}if(l._EXTENSION){var c1=Object.keys(l._EXTENSION);if(c1){this._CustomFilterField(l._EXTENSION[c1],j);}}if(!X(j)){var d1=this.getGlobalFilter().getFilterData();d1._CUSTOM=j;this.getGlobalFilter().setFilterData(d1,true);}}var e1=i.getUiState({allFilters:false});var f1=e1&&e1.getSelectionVariant();if(i.getSmartVariant().currentVariantGetModified()){f1.SelectionVariantID="";}var g1=f1&&JSON.stringify(f1);var h1=new d(g1);return{selectionVariant:h1.toJSONString(),semanticDates:e1.getSemanticDates(),customData:l};},_storeCurrentAppStateAndAdjustURL:function(e,i){if(e&&!e.oSource._bDirtyViaDialog){return;}if(!this.bGlobalFilterLoaded){return;}if(!this.oNavigationHandler){return;}if(this.oAppStatePromise){this.rejectPreviousPromise&&this.rejectPreviousPromise("skip");}this.oAppStatePromise=new Promise(function(l,c1){this.rejectPreviousPromise=c1;var d1=this._getCurrentAppState(i);var e1=this.oNavigationHandler.storeInnerAppStateWithImmediateReturn(d1,true);e1.promise.then(function(f1){l(f1);},function(f1){c1(f1.getErrorCode());});}.bind(this));var j=function(l){this.oAppStatePromise=null;if(l&&l.length>0){this.oNavigationHandler.replaceHash(l);return;}throw"AppState key is empty";};var k=function(l){this.oAppStatePromise=null;if(l==="skip"){throw l;}throw("Something went wrong while storing AppState - "+l);};this.oAppStatePromise.then(j.bind(this),k.bind(this)).catch(function(l){if(l==="skip"){return;}});},setTitle:function(e,i,j){var k="";if(e){k=e;}else if(i){k=i;}else{k=j;}return k;},onMacroFilterBarSearch:function(e){if(this.fnMacroFilterBarLoaded!==undefined){this.fnMacroFilterBarLoaded();}this._processFilters();var i="ovp-"+new Date().getTime();for(var j in this.oCardsModels){if(this.oCardsModels.hasOwnProperty(j)&&!c.isODataV4(this.oCardsModels[j])){try{this.oCardsModels[j].refresh(false,false,i);}catch(k){b1.warning(k);}}}this.globalEventBus.publish("OVPGlobalfilter","OVPGlobalFilterSeacrhfired",this.aFilters);}});});
