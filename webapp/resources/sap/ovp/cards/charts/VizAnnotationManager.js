sap.ui.define(["sap/ui/thirdparty/jquery","sap/ovp/cards/charts/Utils","sap/ui/model/odata/CountMode","sap/ovp/cards/AnnotationHelper","sap/ui/core/format/NumberFormat","sap/ui/core/format/DateFormat","sap/viz/ui5/api/env/Format","sap/viz/ui5/controls/VizTooltip","sap/ovp/cards/CommonUtils","sap/ovp/cards/OVPCardAsAPIUtils","sap/viz/ui5/data/DimensionDefinition","sap/viz/ui5/data/MeasureDefinition","sap/viz/ui5/controls/common/feeds/FeedItem","sap/ui/core/Element","sap/ovp/app/resources","sap/ovp/app/OVPUtils","sap/base/util/each","sap/base/util/merge","sap/ovp/cards/ovpLogger","sap/base/util/isEmptyObject"],function(q,U,C,a,N,D,V,b,c,O,e,M,F,g,h,l,o,p,t,u){"use strict";var w={LABEL_KEY:"sap:label",LABEL_KEY_V4:"com.sap.vocabularies.Common.v1.Label",TEXT_KEY:"sap:text",TEXT_KEY_V4:"com.sap.vocabularies.Common.v1.Text",TEXT_ARRANGEMENT_ANNO:"com.sap.vocabularies.UI.v1.TextArrangement",TYPE_KEY:"type",DISPLAY_FORMAT_KEY:"sap:display-format",SEMANTICS_KEY:"sap:semantics",UNIT_KEY:"sap:unit",UNIT_KEY_V4_ISOCurrency:"Org.OData.Measures.V1.ISOCurrency",UNIT_KEY_V4_Unit:"Org.OData.Measures.V1.Unit",CURRENCY_CODE:"currency-code",NAME_KEY:"name",NAME_CAP_KEY:"Name",EDM_TYPE:"type",EDM_INT32:"Edm.Int32",EDM_INT64:"Edm.Int64",SCATTER_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Scatter",BUBBLE_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Bubble",LINE_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Line",COLUMNSTACKED_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/ColumnStacked",VERTICALBULLET_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/VerticalBullet",COLUMN_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Column",BAR_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Bar",COMBINATION_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Combination",DONUT_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Donut"};var y={CARD_WARNING:"OVP-AC: Analytic card: Warning: ",CARD_ERROR:"OVP-AC: Analytic card Error: ",DATA_ANNO_ERROR:"OVP-AC: Analytic card Error:",CARD_ANNO_ERROR:"OVP-AC: Analytic card: Error ",CHART_ANNO_ERROR:"OVP-AC: Analytic card: Error ",INVALID_CHART_ANNO:"OVP-AC: Analytic Cards: Invalid Chart Annotation.",ANALYTICAL_CONFIG_ERROR:"Analytic card configuration error",CACHING_ERROR:"no model defined while caching OdataMetaData",INVALID_MAXITEMS:"maxItems is Invalid. ",NO_DATASET:"OVP-AC: Analytic Cards: Could not obtain dataset.",SORTORDER_WARNING:"SortOrder is present in PresentationVariant, but it is empty or not well formed.",BOOLEAN_ERROR:"Boolean value is not present in PresentationVariant.",IS_MANDATORY:"is mandatory.",IS_MISSING:"is missing.",NOT_WELL_FORMED:"is not found or not well formed)",MISSING_CHARTTYPE:"Missing ChartType in ",CHART_ANNO:"Chart Annotation.",DATA_ANNO:"Data Annotation",CARD_ANNO:"card annotation.",CARD_CONFIG:"card configuration.",CARD_CONFIG_ERROR:"Could not obtain configuration for ",CARD_CONTAINER_ERROR:"Could not obtain card container. ",DATA_UNAVAIALABLE:"No data available.",CONFIG_LOAD_ERROR:"Failed to load config.json. Reason: ",INVALID_CHARTTYPE:"Invalid ChartType given for ",INVALID_CONFIG:"No valid configuration given for ",CONFIG_JSON:"in config.json",ENTER_INTEGER:"Please enter an Integer.",NO_CARD_MODEL:"Could not obtain Cards model.",ANNO_REF:"com.sap.vocabularies.UI.v1 annotation.",INVALID_REDUNDANT:"Invalid/redundant role configured for ",CHART_IS:"chart is/are ",CARD_CONFIG_JSON:"card from config.json",ALLOWED_ROLES:"Allowed role(s) for ",DIMENSIONS_MANDATORY:"DimensionAttributes are mandatory.",MEASURES_MANDATORY:"MeasureAttributes are mandatory.",CARD_LEAST:"card: Enter at least ",CARD_MOST:"card: Enter at most ",FEEDS:"feed(s).",MIN_FEEDS:"Minimum number of feeds required for ",FEEDS_OBTAINED:"card is not configured. Obtained ",FEEDS_REQUIRED:"feed(s), Required: ",INVALID_SEMANTIC_MEASURES:"More than one measure is being semantically coloured",INVALID_IMPROVEMENT_DIR:"No Improvement Direction Found",INVALID_CRITICALITY:"Invalid criticality values",INVALID_DIMMEAS:"Invalid number of Measures or Dimensions",INVALID_FORECAST:"Invalid/Redundant Datapoint or Forecast measure",INVALID_TARGET:"Invalid/Redundant Datapoint or Target measure",ERROR_MISSING_AXISSCALES:"Minimum and Maximum values are mandatory for AxisScale MinMax to work"};var S=["year","yearweek","yearmonth","yearquarter"];var z=[w.COLUMNSTACKED_CHARTTYPE,w.DONUT_CHARTTYPE,w.COLUMN_CHARTTYPE,w.BAR_CHARTTYPE,w.VERTICALBULLET_CHARTTYPE,w.LINE_CHARTTYPE,w.COMBINATION_CHARTTYPE,w.BUBBLE_CHARTTYPE];var A=[w.COLUMNSTACKED_CHARTTYPE];var G;var L=new t("OVP.charts.VizAnnotationManager");function B(f,j,n,v,x,I1,J1){var K1="{";if(!f||!f.getSetting('ovpCardProperties')){L.error(y.ANALYTICAL_CONFIG_ERROR);K1+="}";return K1;}var L1=f.getSetting("dataModel");var M1;if(J1&&J1.EnumMember){M1=J1.EnumMember.split("/");if(M1&&(M1[1]==='Donut')){L1.setDefaultCountMode(C.Inline);}if(M1&&(M1[1]!='Donut')&&(x===undefined)){return null;}}var N1=[];var O1=[];var P1=[];var Q1=[];var R1=[];var S1=[];var T1=[];var U1=n&&n.Parameters;var V1=v&&v.SortOrder;var W1=v&&v.MaxItems,X1=null;var Y1;var Z1;var $1;var _1=null;var a2=w.TEXT_KEY;var b2=w.TEXT_KEY_V4;var c2=w.UNIT_KEY;var d2=w.UNIT_KEY_V4_ISOCurrency;var e2=w.UNIT_KEY_V4_Unit;var f2={};if(W1){X1=W1.Int32?W1.Int32:W1.Int;}if(X1){if(X1==="0"){L.error("OVP-AC: Analytic card Error: maxItems is configured as "+X1);K1+="}";return K1;}if(!/^\d+$/.test(X1)){L.error("OVP-AC: Analytic card Error: maxItems is Invalid. Please enter an Integer.");K1+="}";return K1;}}var g2=f.getSetting('ovpCardProperties'),h2=g2.getProperty('/parameters');var i2=g2.getProperty("/metaModel");U1=U1||!!h2;if(U1){var j2=a.resolveParameterizedEntitySet(L1,j,n,h2);K1+="path: '"+j2+"'";}else{K1+="path: '/"+j.name+"'";}var k2=[];_1=f.getSetting('ovpCardProperties').getProperty("/entitySet");if(!L1||!_1){return K1;}var l2=t1(L1,_1);var m2=f.getSetting('ovpCardProperties').getProperty("/cardLayout");var n2=1,o2;var p2=$();var q2;var r2;if(x&&m2&&m2.colSpan&&m2.colSpan>1){o2=m2.colSpan-n2;for(var s2 in p2){if((r2=p2[s2].reference)&&p2[r2]){var t2=p({},p2[r2]);p2[s2]=t2;}if(s2===M1[1]||(p2[s2].time&&p2[s2].time.type===M1[1].toLowerCase())){q2=p2[s2];break;}}var u2=_(x,q2,L1,_1);if(u2){q2=q2.time;}else{q2=q2.default;}var v2=f.getSetting('ovpCardProperties').getProperty("/dataStep");if(!v2){if(q2.resize&&q2.resize.hasOwnProperty("dataStep")&&!isNaN(q2.resize.dataStep)){v2=q2.resize.dataStep;}}v2=parseInt(v2,10);if(o2>0&&v2&&!isNaN(v2)){X1=parseInt(X1,10)+v2*o2;}}if(n){var g2=f.getSetting('ovpCardProperties');k2=a.getFilters(g2,n);}if(k2.length>0){K1+=", filters: "+JSON.stringify(k2);}if(V1){var w2=v.SortOrder;if(!w2.length){w2=U.getSortAnnotationCollection(L1,v,j);}if(w2.length<1){L.warning(y.CARD_WARNING+y.SORTORDER_WARNING);}else{var x2="";var y2;var z2;var A2;for(var i=0;i<w2.length;i++){y2=w2[i];A2=y2.Property.PropertyPath;T1.push(A2);if(typeof y2.Descending==="undefined"){z2='true';}else{var i1=y2.Descending.Bool||y2.Descending.Boolean;if(!i1){L.warning(y.CARD_WARNING+y.BOOLEAN_ERROR);z2='true';}else{z2=i1.toLowerCase()==='true'?'true':'false';}}x2=x2+"{path: '"+A2+"',descending: "+z2+"},";}K1+=", sorter: ["+x2.substring(0,x2.length-1)+"]";}}var B2=f.getSetting("ovpCardProperties").getProperty("/entityType");o(I1,function(i,m){Y1=m.Measure.PropertyPath;if(m.DataPoint&&m.DataPoint.AnnotationPath){var d=B2[m.DataPoint.AnnotationPath.substring(1)];if(d.ForecastValue&&(d.ForecastValue.PropertyPath||d.ForecastValue.Path)){var r=(d.ForecastValue.PropertyPath||d.ForecastValue.Path);R1.push((d.ForecastValue.PropertyPath||d.ForecastValue.Path));if(l2&&l2[r]){var s;if(l2[r][d2]){s=l2[r][d2].Path?l2[r][d2].Path:undefined;}else if(l2[r][e2]){s=l2[r][e2].Path?l2[r][e2].Path:undefined;}else if(l2[r][c2]){s=l2[r][c2];}if(s){if((R1?Array.prototype.indexOf.call(R1,s):-1)===-1){R1.push(s);}}}}if(d.TargetValue&&(d.TargetValue.PropertyPath||d.TargetValue.Path)){var G2=(d.TargetValue.PropertyPath||d.TargetValue.Path);R1.push((d.TargetValue.PropertyPath||d.TargetValue.Path));if(l2&&l2[G2]){var s;if(l2[G2][d2]){s=l2[G2][d2].Path?l2[G2][d2].Path:undefined;}else if(l2[G2][e2]){s=l2[G2][e2].Path?l2[G2][e2].Path:undefined;}else if(l2[G2][c2]){s=l2[G2][c2];}if(s){if((R1?Array.prototype.indexOf.call(R1,s):-1)===-1){R1.push(s);}}}}}R1.push(Y1);if(l2&&l2[Y1]){if(l2[Y1][b2]){if(l2[Y1][b2].String&&Y1!=l2[Y1][b2].String){R1.push(l2[Y1][b2].String?l2[Y1][b2].String:Y1);}else if(l2[Y1][b2].Path&&Y1!=l2[Y1][b2].Path){R1.push(l2[Y1][b2].Path?l2[Y1][b2].Path:Y1);}}else if(l2[Y1][a2]&&Y1!=l2[Y1][a2]){R1.push(l2[Y1][a2]?l2[Y1][a2]:Y1);}}if(l2&&l2[Y1]){var s;if(l2[Y1][d2]){s=l2[Y1][d2].Path?l2[Y1][d2].Path:undefined;}else if(l2[Y1][e2]){s=l2[Y1][e2].Path?l2[Y1][e2].Path:undefined;}else if(l2[Y1][c2]){s=l2[Y1][c2];}if(s){if((R1?Array.prototype.indexOf.call(R1,s):-1)===-1){R1.push(s);}}}});o(x,function(i,d){Y1=d.Dimension.PropertyPath;N1.push(Y1);if(l2&&l2[Y1]){if(l2[Y1][b2]){if(l2[Y1][b2].String&&Y1!=l2[Y1][b2].String){N1.push(l2[Y1][b2].String?l2[Y1][b2].String:Y1);}else if(l2[Y1][b2].Path&&Y1!=l2[Y1][b2].Path){$1=l2[Y1][b2].Path;var m=$1.split("/");if(m.length>1){Z1=E(i2,B2,$1);if(Z1!==""){N1.push($1);O1.push(Z1);Q1=H(i2,B2,$1);if(Q1.length>0){P1=P1.concat(Q1);}}}else{N1.push($1?$1:Y1);}}}else if(l2[Y1][a2]&&Y1!=l2[Y1][a2]){N1.push(l2[Y1][a2]?l2[Y1][a2]:Y1);}}});if(P1.length>0){var k=0;while(k<P1.length){if(N1.indexOf(P1[k])!==-1){P1.splice(k,1);}else{k++;}}}if(R1.length>0){o(R1,function(i,m){f2[m]=true;});}if(N1.length>0){o(N1,function(i,d){f2[d]=true;});}K1+=", parameters: {select:'"+[].concat(N1,R1).join(",");var C2=i2.getODataEntityType(j.entityType);if(C2){var D2=a.getRequestFields(v);if(D2&&D2.length>0){o(D2,function(i,r){if(!f2.hasOwnProperty(r)){f2[r]=true;S1.push(r);}});if(S1.length>0){K1+=","+S1.join(",");}}}if(T1.length>0){var E2=[];o(T1,function(i,s){if(!f2.hasOwnProperty(s)){E2.push(s);}});if(E2.length>0){K1+=","+E2.join(",");}}if(O1.length>0){K1+="'"+","+" expand:'"+O1.join(',');}var F2=a.checkFilterPreference(f.getSetting("ovpCardProperties"));if(F2){K1+="', custom: {cardId: '"+f.getSetting("ovpCardProperties").getProperty("/cardId")+"'}}";}else{K1+="'}";}if(M1&&(M1[1]==='Donut')&&(x===undefined)){K1+=", length: 1";}else if(M1&&(M1[1]==='Donut')&&(x)&&X1){K1+=", length: "+(parseInt(X1,10)+1);}else if(X1){K1+=", length: "+X1;}K1+="}";return K1;}B.requiresIContext=true;function E(m,d,s){var f="";var j=s.split("/");if(j.length>1){for(var i=0;i<(j.length-1);i++){var k=m.getODataAssociationEnd(d,j[i]);if(k){d=m.getODataEntityType(k.type);if(f){f=f+"/";}f=f+j[i];}else{return f;}}}return f;}function H(m,d,s){var f=[];var k=[];var n;var r=s.split("/");if(r.length>1){for(var i=0;i<(r.length-1);i++){var v=m.getODataAssociationEnd(d,r[i]);if(v){d=m.getODataEntityType(v.type);if(d){k=d&&d.key&&d.key.propertyRef;for(var j=0;j<k.length;j++){n=r[i]+"/"+k[j].name;f.push(n);}}}}}return f;}function I(m,d){var f=false;var r;if(m.DataPoint&&m.DataPoint.AnnotationPath){var i=d[m.DataPoint.AnnotationPath.substring(1)];if(i&&i.ForecastValue&&(i.ForecastValue.PropertyPath||i.ForecastValue.Path)){f=true;r=m;}}if(f===true){return r;}else{L.warning(y.CARD_WARNING+y.INVALID_FORECAST);return undefined;}}function J(m,d){var f=false;var r;if(m.DataPoint&&m.DataPoint.AnnotationPath){var i=d[m.DataPoint.AnnotationPath.substring(1)];if(i&&i.TargetValue&&(i.TargetValue.PropertyPath||i.TargetValue.Path)){f=true;r=m;}}if(f===true){return r;}else{L.warning(y.CARD_WARNING+y.INVALID_TARGET);return undefined;}}function K(m,d){var f;o(d,function(i,v){if(v.name===m){if(v["com.sap.vocabularies.Common.v1.Label"]){f=v["com.sap.vocabularies.Common.v1.Label"].String?v["com.sap.vocabularies.Common.v1.Label"].String:v["com.sap.vocabularies.Common.v1.Label"].Path;}else if(v["sap:label"]){f=v["sap:label"];}return false;}});return f;}function P(f,d){var j=true;if(d==="line"||d==="column"||d==="bar"){o(f,function(i,v){if((v.getUid()==='valueAxis')||(v.getUid()==='categoryAxis')){if(v.getValues().length!=1){j=false;L.warning(y.CARD_WARNING+y.INVALID_DIMMEAS);return false;}}});}else if(d==="vertical_bullet"){o(f,function(i,v){if((v.getUid()==='actualValues')||(v.getUid()==='categoryAxis')){if(v.getValues().length!=1){j=false;L.warning(y.CARD_WARNING+y.INVALID_DIMMEAS);return false;}}});}if(j===true){return true;}}function Q(m,s,v){var d=w.TYPE_KEY;if(!m||!m[s]||!m[s][d]){return v;}var n=["Edm.Int","Edmt.Int16","Edm.Int32","Edm.Int64","Edm.Decimal"];var f=m[s][d];if((n?Array.prototype.indexOf.call(n,f):-1)!==-1){return Number(v);}return v;}function R(d){if(d){return d;}return"";}function T(){var d={locale:function(){},format:function(v,f){var i="";if(f){i=f.split('/');}if(i.length>0){var m,s;if(i.length===3){m=Number(i[1]);s=Number(i[2]);if(isNaN(m)){m=-1;}if(isNaN(s)){s=0;}}else{m=2;s=0;}if(i[0]==="axisFormatter"||(i[0]==="ShortFloat")){var n;n=N.getFloatInstance({style:'short',minFractionDigits:m,maxFractionDigits:m?m:1});if(i[0]==="ShortFloat"){n=N.getFloatInstance({style:'short',minFractionDigits:m,maxFractionDigits:m});}if(m===-1){n=N.getFloatInstance({style:'short'});}return n.format(Number(v));}else if(i[0]==="tooltipNoScaleFormatter"){var j=N.getFloatInstance({style:'short',currencyCode:false,shortRefNumber:s,showScale:false,minFractionDigits:m,maxFractionDigits:m});if(m===-1){j=N.getFloatInstance({minFractionDigits:0,currencyCode:false});}return j.format(Number(v));}else if(i[0]==="CURR"){var k=N.getCurrencyInstance({style:'short',currencyCode:false,minFractionDigits:m,maxFractionDigits:m});if(m===-1){k=N.getCurrencyInstance({style:'short',currencyCode:false});}return k.format(Number(v));}else if(i[0].search("%")!==-1){var r=N.getPercentInstance({style:'short',minFractionDigits:m,maxFractionDigits:m});if(m===-1){r=N.getPercentInstance({style:'short',minFractionDigits:1,maxFractionDigits:1});}v=r.format(Number(v));return v;}}if(v.constructor===Date){var x=D.getDateTimeInstance({pattern:f});if(f==="YearMonthDay"){x=D.getDateInstance({style:"medium"});}if(f==="YearMonth"||f==="MMM"){x=D.getDateTimeInstance({format:"MMM"});}if(f==="YearQuarter"||f==="Quarter"){x=D.getDateTimeInstance({format:"QQQ"});}if(f==="YearWeek"||f==="Week"){x=D.getDateTimeInstance({format:"www"});}var I1=c.getApp();var J1=I1&&I1.bResetChartAxisFormatter;if(J1&&f==="hh:mm"){var K1=v.toLocaleTimeString();var L1=K1.split(":");v=L1[0]+":"+L1[1];return v;}var M1=J1?false:true;v=x.format(new Date(v),M1);}return v;}};V.numericFormatter(d);}function W(v,f){var d=v.getModel();var k=v.getVizType();if(k!="line"&&k!="bubble"){return;}if(!f){f=k==="line"?"categoryAxis":"valueAxis";}var m=v.getModel('ovpCardProperties').getProperty("/entitySet");if(!d||!m){return;}var n=t1(d,m);var r=v.getFeeds();for(var i=0;i<r.length;i++){if(r[i].getUid()===f){var s=r[i].getValues();if(!s){return;}for(var j=0;j<s.length;j++){if(n[s[j][w.TYPE_KEY]]!="Edm.DateTime"){return;}}v.setVizProperties({categoryAxis:{title:{visible:false}}});return;}}}function X(d,f,i,m,j,k){m=typeof m==="undefined"?false:m;var r=false;var n;if(!d&&m){L.error(j+y.CARD_ERROR+i+y.IS_MANDATORY);return r;}if(!d){L.warning(j+y.CARD_WARNING+i+y.IS_MISSING);r=true;return r;}n=f[d];if(!n||typeof n!=="object"){var s=m?L.error:L.warning;s(j+y.CARD_ERROR+"in "+i+". ("+d+" "+y.NOT_WELL_FORMED);return r;}if(k&&k==="sap.ovp.cards.charts.analytical.analyticalChart"&&i==="Chart Annotation"&&(!n.ChartType||!n.ChartType.EnumMember)){L.error(j+y.CARD_ERROR+y.MISSING_CHARTTYPE+y.CHART_ANNO);return r;}r=true;return r;}function Y(d){var r=false;if(!d){return r;}var s;var f;var i;var j;var k;var m;var n;var v="";var x;var I1=d.getView();if(I1){v="["+I1.getId()+"] ";}if(!(x=d.getCardPropertiesModel())){L.error(v+y.CARD_ERROR+"in "+y.CARD_CONFIG+y.NO_CARD_MODEL);return r;}n=x.getProperty("/entityType");if(!n||u(n)){L.error(v+y.CARD_ERROR+"in "+y.CARD_ANNO);return r;}s=x.getProperty("/selectionAnnotationPath");f=x.getProperty("/chartAnnotationPath");j=x.getProperty("/presentationAnnotationPath");k=x.getProperty("/identificationAnnotationPath");m=x.getProperty("/dataPointAnnotationPath");i=x.getProperty("/contentFragment");r=X(s,n,"Selection Variant",false,v);r=X(f,n,"Chart Annotation",true,v,i)&&r;r=X(j,n,"Presentation Variant",false,v)&&r;r=X(k,n,"Identification Annotation",true,v)&&r;r=X(m,n,"Data Point",false,v)&&r;return r;}function Z(d,f,v){}function $(d){return U.getConfig(d);}function _(d,f,i,j){var r=false;var m;var k;var n;var s;var v;var x;if(!f.time||u(f.time)){return r;}if(!d){return r;}for(var I1=0;I1<d.length;I1++){if(!d[I1].Dimension||!(k=d[I1].Dimension.PropertyPath)){return r;}m=t1(i,j);if(m&&m[k]){n=m[k][w.TYPE_KEY];s=m[k][w.DISPLAY_FORMAT_KEY];v=m[k][w.SEMANTICS_KEY];x=m[k]["com.sap.vocabularies.Common.v1.IsCalendarYear"]||m[k]["com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]||m[k]["com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]||m[k]["com.sap.vocabularies.Common.v1.IsCalendarYearWeek"];}if(n&&n.lastIndexOf("Edm.Date",0)===0){if(n.toLowerCase()==="edm.datetime"){if(s&&s.toLowerCase()==="date"){r=true;}}else{r=true;}}if(n==="Edm.String"&&(x||v&&S.indexOf(v)>-1)){r=true;}if(r){d.unshift(d.splice(I1,1)[0]);break;}}return r;}function a1(i,d,f){var r="";var j=$(d);var k,m;if(!j){return r;}r=j.default.type;k=i.getSetting("dataModel");m=i.getSetting('ovpCardProperties').getProperty("/entitySet");if(_(f,j,k,m)){r=j.time.type;}return r;}a1.requiresIContext=true;function b1(d,j,k){if(!d.length){return;}var m=k==="dimension"?"Dimension":"Measure";var n=[];o(d,function(i,v){if(!v||!v[m]||!v[m].PropertyPath){L.error(y.INVALID_CHART_ANNO);return false;}n.push(v[m].PropertyPath);});var r=q.map(j.feeds,function(f){if(f.type===k){if(f.role){return f.role.split("|");}return[];}});r=q.grep(r,function(f,i){return(r?Array.prototype.indexOf.call(r,f):-1)===i;}).join(", ");L.error(y.CARD_ERROR+y.INVALID_REDUNDANT+k+"(s) "+n.join(", ")+". "+y.ALLOWED_ROLES+j.type+y.CHART_IS+r);}function c1(v,i){var d;if(v){if(v.String){d=v.String;}else if(v.Boolean||v.Bool){d=d1(v);}else{d=e1(v,i);}}return d;}function d1(v,d){if(v&&v.Boolean){if(v.Boolean.toLowerCase()==="true"){return true;}else if(v.Boolean.toLowerCase()==="false"){return false;}}else if(v&&v.Bool){if(v.Bool.toLowerCase()==="true"){return true;}else if(v.Bool.toLowerCase()==="false"){return false;}}return d;}function e1(v,i){var d;if(v){if(v.String){d=Number(v.String);}else if(v.Int){d=Number(v.Int);}else if(v.Decimal){d=Number(v.Decimal);}else if(v.Double){d=Number(v.Double);}else if(v.Single){d=Number(v.Single);}}if(i){var n=N.getFloatInstance({style:'short',minFractionDigits:2,maxFractionDigits:2});if(d){d=n.format(Number(d));}}return d;}function f1(i,d){function h1(x){if(x){if(x.Path){return"{path:'"+x.Path+"'}";}else{return c1(x);}}else{return"";}}var v=i[i.measureNames];if(d&&d.CriticalityCalculation&&d.CriticalityCalculation.ImprovementDirection){var s=d.CriticalityCalculation.ImprovementDirection.EnumMember;var f=h1(d.CriticalityCalculation.DeviationRangeLowValue);var j=h1(d.CriticalityCalculation.DeviationRangeHighValue);var k=h1(d.CriticalityCalculation.ToleranceRangeLowValue);var m=h1(d.CriticalityCalculation.ToleranceRangeHighValue);return a._calculateCriticalityState(v,s,f,j,k,m,a.criticalityConstants.StateValues);}else{var n=d.Criticality.EnumMember;var r=n?n.split("/"):[];if(r){return r[1];}}}function g1(d,m,f){var j,k;o(m,function(i,v){if(v["com.sap.vocabularies.Common.v1.Label"]&&v["com.sap.vocabularies.Common.v1.Label"].String===d.measureNames){j=v.name;return false;}else if(v["com.sap.vocabularies.Common.v1.Label"]&&v["com.sap.vocabularies.Common.v1.Label"].Path===d.measureNames){j=v.name;return false;}else if(v["sap:label"]===d.measureNames){j=v.name;return false;}});o(f,function(i,v){if(v.Measure.PropertyPath===j){if(!v.DataPoint||!v.DataPoint.AnnotationPath){return false;}k=v.DataPoint.AnnotationPath;return false;}});return k;}function h1(i,d){if(i){if(i.Path){return i.Path;}else{return c1(i,d);}}else{return"";}}function i1(m,d){function f(s,i){return s&&s.indexOf(i,s.length-i.length)!==-1;}var j=false;o(m,function(i,v){if(v.DataPoint&&v.DataPoint.AnnotationPath){var k=d[v.DataPoint.AnnotationPath.substring(1)];if(k&&k.CriticalityCalculation&&k.CriticalityCalculation.ImprovementDirection&&k.CriticalityCalculation.ImprovementDirection.EnumMember){var s=k.CriticalityCalculation.ImprovementDirection.EnumMember;var n=h1(k.CriticalityCalculation.DeviationRangeLowValue);var r=h1(k.CriticalityCalculation.DeviationRangeHighValue);var x=h1(k.CriticalityCalculation.ToleranceRangeLowValue);var I1=h1(k.CriticalityCalculation.ToleranceRangeHighValue);if(f(s,"Minimize")||f(s,"Minimizing")){if(I1&&r){j=true;return false;}else{L.warning(y.CARD_WARNING+y.INVALID_CRITICALITY);}}else if(f(s,"Maximize")||f(s,"Maximizing")){if(x&&n){j=true;return false;}else{L.warning(y.CARD_WARNING+y.INVALID_CRITICALITY);}}else if(f(s,"Target")){if(x&&n&&I1&&r){j=true;return false;}else{L.warning(y.CARD_WARNING+y.INVALID_CRITICALITY);}}}else if(k&&k.Criticality){j=true;return false;}else{L.warning(y.CARD_WARNING+y.INVALID_IMPROVEMENT_DIR);}}});if(j===true&&m.length>1){L.warning(y.CARD_WARNING+y.INVALID_SEMANTIC_MEASURES);}return j;}function j1(m,d,f,v){function i(M1,N1){return M1&&M1.indexOf(N1,M1.length-N1.length)!==-1;}var r=[null,null];var j=true;var k=m.Measure.PropertyPath;if(f[k]){if(f[k][w.LABEL_KEY_V4]){k=s1(f[k][w.LABEL_KEY_V4].String?f[k][w.LABEL_KEY_V4].String:f[k][w.LABEL_KEY_V4].Path,v,f);}else if(f[k][w.LABEL_KEY]){k=f[k][w.LABEL_KEY];}else if(k){k=k;}}var n=m.DataPoint.AnnotationPath;var s=d[n.substring(1)];if(!s.CriticalityCalculation||!s.CriticalityCalculation.ImprovementDirection||!s.CriticalityCalculation.ImprovementDirection.EnumMember){return r;}var x=s.CriticalityCalculation.ImprovementDirection.EnumMember;var I1=h1(s.CriticalityCalculation.DeviationRangeLowValue,j);var J1=h1(s.CriticalityCalculation.DeviationRangeHighValue,j);var K1=h1(s.CriticalityCalculation.ToleranceRangeLowValue,j);var L1=h1(s.CriticalityCalculation.ToleranceRangeHighValue,j);if(i(x,"Minimize")||i(x,"Minimizing")){if(L1&&J1){r[0]=h.getText("MINIMIZING_LESS",[k,L1]);r[1]=h.getText("MINIMIZING_MORE",[k,J1]);r[2]=h.getText("MINIMIZING_CRITICAL",[L1,k,J1]);}}else if(i(x,"Maximize")||i(x,"Maximizing")){if(K1&&I1){r[0]=h.getText("MAXIMISING_MORE",[k,K1]);r[1]=h.getText("MAXIMISING_LESS",[k,I1]);r[2]=h.getText("MAXIMIZING_CRITICAL",[I1,k,K1]);}}else if(i(x,"Target")){if(K1&&I1&&L1&&J1){r[0]=h.getText("TARGET_BETWEEN",[K1,k,L1]);r[1]=h.getText("TARGET_AROUND",[k,I1,J1]);r[2]=h.getText("TARGET_CRITICAL",[I1,k,K1,L1,J1]);}}return r;}function k1(m,v,d){if(v&&v.DataPoint&&v.DataPoint.AnnotationPath){var f=d[v.DataPoint.AnnotationPath.substring(1)];var i,j;if(f&&f.ValueFormat){i=f.ValueFormat;}else if(f&&f.NumberFormat){i=f.NumberFormat;}if(i&&i.NumberOfFractionalDigits&&i.NumberOfFractionalDigits.Int){j=i.NumberOfFractionalDigits.Int;if(m<Number(j)){m=Number(j);}}}return m;}function l1(m,v,d){if(v&&v.DataPoint&&v.DataPoint.AnnotationPath){var f=d[v.DataPoint.AnnotationPath.substring(1)];var s,i;if(f&&f.ValueFormat){s=f.ValueFormat;}else if(f&&f.NumberFormat){s=f.NumberFormat;}if(s){if(s.ScaleFactor&&s.ScaleFactor.Decimal){i=Number(s.ScaleFactor.Decimal);}else if(s.ScaleFactor&&s.ScaleFactor.Int){i=Number(s.ScaleFactor.Int);}if(!isNaN(i)){if(m===undefined){m=Number(i);}else if(m>Number(i)){m=Number(i);}}}}return m;}function m1(m,s){if(m&&m[s]&&(m[s]["Org.OData.Measures.V1.ISOCurrency"]||(m[s][w.SEMANTICS_KEY]&&m[s][w.SEMANTICS_KEY]===w.CURRENCY_CODE))){return true;}return false;}function n1(m,v,f){if(m[v[f].PropertyPath][w.EDM_TYPE]===w.EDM_INT32){return true;}return false;}function o1(m,v,f){if(m[v[f].PropertyPath][w.EDM_TYPE]===w.EDM_INT64){return true;}return false;}function p1(d,f,r,s){var x,I1,J1,K1,L1;var M1,N1,O1,P1,Q1,R1=false;var S1;var T1,U1,V1;var W1,X1=[],Y1=[];var Z1;var $1;var _1=s&&s.getView();var a2,b2;var c2=_1&&_1.getModel("ui");var d2=c2&&c2.getProperty("/chartSettings");x=d.getModel('ovpCardProperties');if(O.checkIfAPIIsUsed(s)){R1=x&&x.getData()&&x.getData().showDataLabel;}L1=d2?d2.showDataLabel:R1;M1=d.getVizType();N1=$();for(var e2 in N1){if(($1=N1[e2].reference)&&N1[$1]){var f2=p({},N1[$1]);N1[e2]=f2;}if(N1[e2].default.type===M1||(N1[e2].time&&N1[e2].time.type===M1)){O1=N1[e2];break;}}if(!O1){L.error(y.CARD_ERROR+"in "+y.CARD_CONFIG+y.CARD_CONFIG_ERROR+M1+" "+y.CARD_CONFIG_JSON);return;}if(!x){L.error(y.CARD_ERROR+"in "+y.CARD_CONFIG+y.NO_CARD_MODEL);return;}var g2=d.getModel();var h2=x.getProperty("/entitySet");if(!g2||!h2){return;}I1=x.getProperty("/entityType");if(!I1){L.error(y.CARD_ANNO_ERROR+"in "+y.CARD_ANNO);return;}var i2=t1(g2,h2);J1=x.getProperty("/chartAnnotationPath");if(!J1||!(K1=I1[J1])){L.error(y.CARD_ANNO_ERROR+"in "+y.CARD_ANNO);return;}if(!(P1=K1.DimensionAttributes)||!P1.length){L.error(y.CHART_ANNO_ERROR+"in "+y.CHART_ANNO+" "+y.DIMENSIONS_MANDATORY);return;}var j2;if(!(Q1=K1.MeasureAttributes)||!Q1.length){L.error(y.CHART_ANNO_ERROR+"in "+y.CHART_ANNO+" "+y.MEASURES_MANDATORY);return;}else{var k2=Q1[0].DataPoint?I1[Q1[0].DataPoint.AnnotationPath.substring(1)]:null;var l2=k2&&k2.ValueFormat&&k2.ValueFormat.NumberOfFractionalDigits&&k2.ValueFormat.NumberOfFractionalDigits.Int;j2=l2?l2:0;}Z1=_(P1,O1,g2,h2);if(Z1){O1=O1.time;}else{O1=O1.default;}var m2=x.getProperty("/ChartProperties")||x.getProperty("/chartProperties");if(x&&x.getProperty("/tabs")&&(m2===undefined)){a2=_1.byId("ovp_card_dropdown");b2=parseInt(a2.getSelectedKey(),10);m2=x.getProperty("/tabs")&&x.getProperty("/tabs")[b2-1]&&(x.getProperty("/tabs")[b2-1]["ChartProperties"]||x.getProperty("/tabs")[b2-1]["chartProperties"]);}var n2=false;var o2=j2>0?"tooltipNoScaleFormatter/"+j2.toString()+"/":'tooltipNoScaleFormatter/-1/';var p2=new b({formatString:o2});p2.connect(d.getVizUid());p2.connect(d.getVizUid());d._oOvpVizFrameTooltip=p2;[O1.dimensions,O1.measures].forEach(function(k,i){var m=i?Q1:P1;var n=i?"measure(s)":"dimension(s)";if(k.min&&m.length<k.min){L.error(y.CARD_ERROR+"in "+M1+" "+y.CARD_LEAST+k.min+" "+n);n2=true;}if(k.max&&m.length>k.max){L.error(y.CARD_ERROR+"in "+M1+y.CARD_MOST+k.max+" "+n);n2=true;}});if(n2){return;}var q2=true;if(O1.properties&&O1.properties.hasOwnProperty("hideLabel")&&!O1.properties["hideLabel"]){q2=false;}var r2=true;var s2=false;if(M1==='donut'){s2=true;}d.removeAllAggregation();S1={legend:{isScrollable:false},title:{visible:false},interaction:{noninteractiveMode:r2?false:true,selectability:{legendSelection:s2?true:false,axisLabelSelection:false,mode:'EXCLUSIVE',plotLassoSelection:false,plotStdSelection:true},zoom:{enablement:'disabled'}},plotArea:{window:{start:'firstDataPoint',end:'lastDataPoint'},dataLabel:{visible:L1||s2?true:false,type:'value'},dataPoint:{invalidity:'ignore'},alignment:{vertical:'top'}},categoryAxis:{label:{truncatedLabelRatio:0.15}},general:{groupData:false,showAsUTC:true}};if(O1.properties&&O1.properties.semanticColor===true&&i1(Q1,I1)){var t2=h.getText("GOOD");var u2=h.getText("BAD");var v2=h.getText("CRITICAL");var w2=h.getText("OTHERS");if(Q1.length===1){var x2=j1(Q1[0],I1,i2,d);var t2=x2[0]||t2,u2=x2[1]||u2,v2=x2[2]||v2,w2=h.getText("OTHERS");}S1.plotArea.dataPointStyle={rules:[{callback:function(k){var m=g1(k,i2,Q1);if(!m){return false;}var n=I1[m.substring(1)];var v=f1(k,n);if(v===a.criticalityConstants.StateValues.Positive){return true;}else if(v==="Positive"){return true;}},properties:{color:"sapUiChartPaletteSemanticGoodLight1"},"displayName":t2},{callback:function(k){var m=g1(k,i2,Q1);if(!m){return false;}var n=I1[m.substring(1)];var v=f1(k,n);if(v===a.criticalityConstants.StateValues.Critical){return true;}else if(v==="Critical"){return true;}},properties:{color:"sapUiChartPaletteSemanticCriticalLight1"},"displayName":v2},{callback:function(k){var m=g1(k,i2,Q1);if(!m){return false;}var n=I1[m.substring(1)];var v=f1(k,n);if(v===a.criticalityConstants.StateValues.Negative){return true;}else if(v==="Negative"){return true;}},properties:{color:"sapUiChartPaletteSemanticBadLight1"},"displayName":u2},{callback:function(k){var m=g1(k,i2,Q1);if(!m){return false;}var n=I1[m.substring(1)];var v=f1(k,n);if(v===a.criticalityConstants.StateValues.None){return true;}else if(v==="Neutral"){return true;}},properties:{color:"sapUiChartPaletteSemanticNeutralLight1"},"displayName":w2}]};}var y2=x.getProperty("/bEnableStableColors");var z2=x.getProperty("/colorPalette");var A2;if(!y2&&z.indexOf(K1.ChartType.EnumMember)>=0&&z2&&Object.keys(z2).length>=2&&Object.keys(z2).length<=4){o(P1,function(i,k){if(k&&k.Role&&k.Role.EnumMember==="com.sap.vocabularies.UI.v1.ChartDimensionRoleType/Series"){A2=k.Dimension&&k.Dimension.PropertyPath;return;}});var B2;if(A2){if(i2&&i2[A2]){if(i2[A2][w.LABEL_KEY_V4]){B2=s1(i2[A2][w.LABEL_KEY_V4].String?i2[A2][w.LABEL_KEY_V4].String:i2[A2][w.LABEL_KEY_V4].Path,d,i2);}else if(i2[A2][w.LABEL_KEY]){B2=i2[A2][w.LABEL_KEY];}else if(A2){B2=A2;}}if(z2 instanceof Array){var C2=z2.map(function(v){return v.color;});var D2=z2.map(function(v){return v.legendText;});var E2=D2[0]!=undefined?D2[0]:h.getText("OTHERS");var F2=D2[1]!=undefined?D2[1]:h.getText("BAD");var G2=D2[2]!=undefined?D2[2]:h.getText("CRITICAL");var H2=D2[3]!=undefined?D2[3]:h.getText("GOOD");}S1.plotArea.dataPointStyle={rules:[{callback:function(k){if(k&&(k[B2]==="3"||k[B2]===3)){if(z2 instanceof Array){if(z2.length<4){return false;}}else if(z2&&!z2.hasOwnProperty(3)){return false;}return true;}},properties:{color:z2 instanceof Array&&C2.length?C2[3]:z2[3]&&z2[3]["color"]},"displayName":H2||z2[3]&&z2[3]["legendText"]},{callback:function(k){if(k&&(k[B2]==="2"||k[B2]===2)){if(z2 instanceof Array){if(z2.length<3){return false;}}else if(z2&&!z2.hasOwnProperty(2)){return false;}return true;}},properties:{color:z2 instanceof Array&&C2.length?C2[2]:z2[2]&&z2[2]["color"]},"displayName":G2||z2[2]&&z2[2]["legendText"]},{callback:function(k){if(k&&(k[B2]==="1"||k[B2]===1)){return true;}},properties:{color:z2 instanceof Array&&C2.length?C2[1]:z2[1]&&z2[1]["color"]},"displayName":F2||z2[1]&&z2[1]["legendText"]},{callback:function(k){if(k&&(k[B2]==="0"||k[B2]===0)){return true;}},properties:{color:z2 instanceof Array&&C2.length?C2[0]:z2[0]&&z2[0]["color"]},"displayName":E2||z2[0]&&z2[0]["legendText"]}]};}}var I2=false;var J2=false;if(K1.ChartType.EnumMember===w.SCATTER_CHARTTYPE||K1.ChartType.EnumMember===w.BUBBLE_CHARTTYPE||K1.ChartType.EnumMember===w.LINE_CHARTTYPE){if(K1&&K1.AxisScaling&&K1.AxisScaling.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisScalingType"){var K2=K1.AxisScaling;if(K2.AutoScaleBehavior&&K2.AutoScaleBehavior.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisAutoScaleBehaviorType"){var L2=K2.AutoScaleBehavior;if(L2.ZeroAlwaysVisible&&L2.ZeroAlwaysVisible.Bool=="true"){S1.plotArea.adjustScale=false;I2=true;}else if(L2.DataScope){S1.plotArea.adjustScale=true;I2=true;}}else if(K2.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisScalingType"&&K2.ScaleBehavior&&K2.ScaleBehavior.EnumMember){var M2=K2.ScaleBehavior.EnumMember;var N2=M2.substring(M2.lastIndexOf('/')+1,M2.length);if(N2=="FixedScale"){J2=true;}}}else if(K1&&K1.AxisScaling&&K1.AxisScaling.EnumMember){var O2=K1.AxisScaling.EnumMember.substring(K1.AxisScaling.EnumMember.lastIndexOf('/')+1,K1.AxisScaling.EnumMember.length);switch(O2){case"AdjustToDataIncluding0":S1.plotArea.adjustScale=false;I2=true;break;case"AdjustToData":S1.plotArea.adjustScale=true;I2=true;break;case"MinMaxValues":J2=true;break;default:break;}}if(J2){var P2=[];if(K1["MeasureAttributes"][0]&&K1["MeasureAttributes"][0].DataPoint&&K1["MeasureAttributes"][0].DataPoint.AnnotationPath){var Q2=K1["MeasureAttributes"][0].DataPoint.AnnotationPath;var R2=Q2.substring(Q2.lastIndexOf('@')+1,Q2.length);if(I1&&I1[R2]){var S2=I1[R2];if(S2&&S2.MaximumValue&&S2.MaximumValue.Decimal&&S2.MinimumValue&&S2.MinimumValue.Decimal){P2.push({feed:"valueAxis",max:S2.MaximumValue.Decimal,min:S2.MinimumValue.Decimal});I2=true;}else{L.error(y.ERROR_MISSING_AXISSCALES);}}}if(K1.ChartType.EnumMember!==w.LINE_CHARTTYPE&&K1["MeasureAttributes"][1]&&K1["MeasureAttributes"][1].DataPoint&&K1["MeasureAttributes"][1].DataPoint.AnnotationPath){var Q2=K1["MeasureAttributes"][1].DataPoint.AnnotationPath;var R2=Q2.substring(Q2.lastIndexOf('@')+1,Q2.length);if(I1&&I1[R2]){var S2=I1[R2];if(S2&&S2.MaximumValue&&S2.MaximumValue.Decimal&&S2.MinimumValue&&S2.MinimumValue.Decimal){P2.push({feed:"valueAxis2",max:S2.MaximumValue.Decimal,min:S2.MinimumValue.Decimal});I2=true;}else{L.error(y.ERROR_MISSING_AXISSCALES);}}}d.setVizScales(P2);}}U1=P1.slice();V1=Q1.slice();var T2=0;var U2=0;var V2;var W2;var X2=false;var Y2=false;var Z2;var $2=[];var _2=[],a3=[];if((M1==="column"||M1==="bar"||M1==="vertical_bullet")&&O1.feeds&&(O1.feeds.length>0)){var b3;for(b3=0;b3<O1.feeds.length;b3++){if(O1.feeds[b3].uid==="color"){O1.feeds.splice(b3,1);break;}}for(b3=0;b3<O1.feeds.length;b3++){if(O1.feeds[b3].uid==="categoryAxis"){delete O1.feeds[b3].role;break;}}if(x.getProperty("/colorPalette")){for(b3=0;b3<O1.feeds.length;b3++){if(O1.feeds[b3].uid==="categoryAxis"){O1.feeds[b3].role="Category";break;}}O1.feeds.push({"uid":"color","min":1,"type":"dimension","role":"Series"});}}o(O1.feeds,function(i,m){var n=m.uid;var v=[];if(m.type){var y3,z3,A3;if(m.type==="dimension"){y3=P1.length;z3="Dimension";A3="dimensions";T1=U1;W1=X1;}else{y3=Q1.length;z3="Measure";A3="measures";T1=V1;W1=Y1;}var B3=0,C3=y3;if(m.min){B3=B3>m.min?B3:m.min;}if(m.max){C3=C3<m.max?C3:m.max;}if(!m.role){var D3=T1.length;for(var j=0;j<D3&&v.length<C3;++j){var E3=T1[j];T1.splice(j,1);--D3;--j;v.push(E3);if(i2[E3[z3].PropertyPath][w.UNIT_KEY_V4_ISOCurrency]){Z2=i2[E3[z3].PropertyPath][w.UNIT_KEY_V4_ISOCurrency].Path?i2[E3[z3].PropertyPath][w.UNIT_KEY_V4_ISOCurrency].Path:undefined;}else if(i2[E3[z3].PropertyPath][w.UNIT_KEY_V4_Unit]){Z2=i2[E3[z3].PropertyPath][w.UNIT_KEY_V4_Unit].Path?i2[E3[z3].PropertyPath][w.UNIT_KEY_V4_Unit].Path:undefined;}else if(i2[E3[z3].PropertyPath][w.UNIT_KEY]){Z2=i2[E3[z3].PropertyPath][w.UNIT_KEY];}if(m1(i2,Z2)){X2=true;}else{Y2=true;}if(!X2){T2=k1(T2,E3,I1);V2=l1(V2,E3,I1);}else{U2=k1(U2,E3,I1);W2=l1(W2,E3,I1);}}}else{var F3=m.role.split("|");o(F3,function(j,Y3){if(v.length===C3){return false;}var D3=T1.length;for(var k=0;k<D3&&v.length<C3;++k){var E3=T1[k];if(E3&&E3.Role&&E3.Role.EnumMember&&E3.Role.EnumMember.split("/")&&E3.Role.EnumMember.split("/")[1]){var Z3=E3.Role.EnumMember.split("/")[1];if(Z3===Y3){T1.splice(k,1);--D3;--k;v.push(E3);if(i2[E3[z3].PropertyPath][w.UNIT_KEY_V4_ISOCurrency]){Z2=i2[E3[z3].PropertyPath][w.UNIT_KEY_V4_ISOCurrency].Path?i2[E3[z3].PropertyPath][w.UNIT_KEY_V4_ISOCurrency].Path:undefined;}else if(i2[E3[z3].PropertyPath][w.UNIT_KEY_V4_Unit]){Z2=i2[E3[z3].PropertyPath][w.UNIT_KEY_V4_Unit].Path?i2[E3[z3].PropertyPath][w.UNIT_KEY_V4_Unit].Path:undefined;}else if(i2[E3[z3].PropertyPath][w.UNIT_KEY]){Z2=i2[E3[z3].PropertyPath][w.UNIT_KEY];}if(m1(i2,Z2)){X2=true;}else{Y2=true;}if(!X2){T2=k1(T2,E3,I1);V2=l1(V2,E3,I1);}else{U2=k1(U2,E3,I1);W2=l1(W2,E3,I1);}}}else if((W1?Array.prototype.indexOf.call(W1,E3):-1)===-1){W1.push(E3);}}});if(v.length<C3){o(W1,function(k,E3){var Y3;var b3;if((Y3=O1[A3].defaultRole)&&((F3?Array.prototype.indexOf.call(F3,Y3):-1)!==-1)&&(b3=(T1?Array.prototype.indexOf.call(T1,E3):-1)!==-1)){T1.splice(b3,1);v.push(E3);if(i2[E3[z3].PropertyPath][w.UNIT_KEY_V4_ISOCurrency]){Z2=i2[E3[z3].PropertyPath][w.UNIT_KEY_V4_ISOCurrency].Path?i2[E3[z3].PropertyPath][w.UNIT_KEY_V4_ISOCurrency].Path:undefined;}else if(i2[E3[z3].PropertyPath][w.UNIT_KEY_V4_Unit]){Z2=i2[E3[z3].PropertyPath][w.UNIT_KEY_V4_Unit].Path?i2[E3[z3].PropertyPath][w.UNIT_KEY_V4_Unit].Path:undefined;}else if(i2[E3[z3].PropertyPath][w.UNIT_KEY]){Z2=i2[E3[z3].PropertyPath][w.UNIT_KEY];}if(m1(i2,Z2)){X2=true;}else{Y2=true;}if(!X2){T2=k1(T2,E3,I1);V2=l1(V2,E3,I1);}else{U2=k1(U2,E3,I1);W2=l1(W2,E3,I1);}if(v.length===C3){return false;}}});}if(v.length<B3){L.error(y.CARD_ERROR+y.MIN_FEEDS+M1+" "+y.FEEDS_OBTAINED+v.length+" "+y.FEEDS_REQUIRED+B3+" "+y.FEEDS);return false;}}if(v.length){var G3=[];var H3;if(!(H3=d.getDataset())){L.error(y.NO_DATASET);return false;}G=I1;o(v,function(i,E3){if(!E3||!E3[z3]||!E3[z3].PropertyPath){L.error(y.INVALID_CHART_ANNO);return false;}var k=E3[z3].PropertyPath;var B2=k;var Y3=k;var Z3=null;if(i2&&i2[k]){if(i2[k][w.LABEL_KEY_V4]){if(i2[k][w.LABEL_KEY_V4].String){B2=s1(i2[k][w.LABEL_KEY_V4].String,d,i2);}else if(i2[k][w.LABEL_KEY_V4].Path){B2=i2[k][w.LABEL_KEY_V4].Path;}else{B2=k;}}else if(i2[k][w.LABEL_KEY]){B2=i2[k][w.LABEL_KEY];}else if(k){B2=k;}if(i2[k][w.TEXT_KEY_V4]){Y3=i2[k][w.TEXT_KEY_V4].String?i2[k][w.TEXT_KEY_V4].String:i2[k][w.TEXT_KEY_V4].Path;}else if(i2[k][w.TEXT_KEY]){Y3=i2[k][w.TEXT_KEY];}else if(k){Y3=k;}Z3=i2[k][w.TYPE_KEY]||null;}var $3;if((Z3==="Edm.DateTime"||Z3==="Edm.DateTimeOffset")&&Y3===k){$3="{path:'"+k+"', formatter: 'sap.ovp.cards.charts.VizAnnotationManager.returnDateFormat'}";}else{if(i2[k]&&i2[k][w.TEXT_KEY_V4]&&i2[k][w.TEXT_KEY_V4][w.TEXT_ARRANGEMENT_ANNO]){var _3,a4;_3=i2[k][w.TEXT_ARRANGEMENT_ANNO];a4=_3&&_3.EnumMember;if(!a4){_3=i2[k][w.TEXT_KEY_V4][w.TEXT_ARRANGEMENT_ANNO];a4=_3&&_3.EnumMember;}if(!a4){var b4=G;_3=b4&&b4[w.TEXT_ARRANGEMENT_ANNO];a4=_3&&_3.EnumMember;}switch(a4){case"com.sap.vocabularies.UI.v1.TextArrangementType/TextFirst":$3="{"+Y3+"}"+" "+"("+"{"+k+"}"+")";break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextLast":$3="{"+k+"}"+" "+"("+"{"+Y3+"}"+")";break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly":$3="{"+Y3+"}";break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextSeperate":$3="{"+k+"}"+" "+"("+"{"+Y3+"}"+")";break;default:$3="{"+k+"}";break;}}else{$3="{"+Y3+"}";}}G3.push(B2);if(z3==="Dimension"){if(n==="waterfallType"){var c4=new e({name:B2,value:"{"+k+"}"});}else{var c4=new e({name:B2,value:"{"+k+"}",displayValue:$3});}var d4=i2[k][w.SEMANTICS_KEY];var e4=i2[k]["com.sap.vocabularies.Common.v1.IsCalendarYear"]&&i2[k]["com.sap.vocabularies.Common.v1.IsCalendarYear"].Bool||i2[k]["com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]&&i2[k]["com.sap.vocabularies.Common.v1.IsCalendarYearMonth"].Bool||i2[k]["com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]&&i2[k]["com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"].Bool||i2[k]["com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]&&i2[k]["com.sap.vocabularies.Common.v1.IsCalendarYearWeek"].Bool;if(Z1&&(Z3==="Edm.DateTime"||e4||Z3==="Edm.DateTimeOffset"||(d4&&d4.lastIndexOf("year",0)===0))){c4.setDataType("date");}H3.addDimension(c4);if((a3?Array.prototype.indexOf.call(a3,B2):-1)===-1){a3.push(B2);}}else{H3.addMeasure(new M({name:B2,value:"{"+k+"}"}));if(((_2?Array.prototype.indexOf.call(_2,B2):-1)===-1)&&(n!="bubbleWidth")){_2.push(B2);}}});d.addFeed(new F({'uid':n,'type':z3,'values':G3}));if(n==="categoryAxis"){S1[n]={title:{visible:q2?false:true,text:G3.join(", ")},label:{formatString:X2?'CURR':'axisFormatter',truncatedLabelRatio:0.15}};}else{S1[n]={title:{visible:q2?false:true,text:G3.join(", ")},label:{formatString:X2?'CURR':'axisFormatter'}};}$2.push(S1[n]);if(O1.hasOwnProperty("vizProperties")){var I3=0;var J3=O1.vizProperties.length;var K3;var L3;for(;I3<J3;I3++){if(O1.vizProperties[I3].hasOwnProperty("value")){L3=O1.vizProperties[I3].value;}if(O1.vizProperties[I3].hasOwnProperty("path")){K3=(O1.vizProperties[I3].path).split(".");var M3=K3.length;var N3,O3;var P3;for(var Q3=0,P3=K3[0],N3=S1,O3=m2;Q3<M3;++Q3){if(Q3===M3-1){if(O3&&O3.hasOwnProperty(P3)){if(M1==='donut'&&(O3[P3]==="value"||O3[P3]==="percentage")){L3=O3[P3];}else if(M1!='donut'){L3=O3[P3];}}if((I2&&(P3!="adjustScale"))||(!I2&&(P3==="adjustScale"))||(!I2&&(P3!="adjustScale"))){N3[P3]=L3;}break;}N3[P3]=N3[P3]||{};N3=N3[P3];if(O3){O3[P3]=O3[P3]||{};O3=O3[P3];}P3=K3[Q3+1];}}}}if(m.hasOwnProperty("vizProperties")){var i=0;var R3=m.vizProperties.length;var S3;var T3;var U3;for(;i<R3;i++){if(m.vizProperties[i].hasOwnProperty("method")){T3=m.vizProperties[i].method;switch(T3){case'count':S3=G3.length;if(m.vizProperties[i].hasOwnProperty("min")&&S3<=m.vizProperties[i].min){S3=m.vizProperties[i].min;}else if(m.vizProperties[i].hasOwnProperty("max")&&S3>=m.vizProperties[i].max){S3=m.vizProperties[i].max;}break;default:break;}}else if(m.vizProperties[i].hasOwnProperty("value")){S3=m.vizProperties[i].value;}if(m.vizProperties[i].hasOwnProperty("path")){U3=(m.vizProperties[i].path).split(".");var V3=U3.length;for(var j=0,W3=U3[0],X3=S1;j<V3;++j){if(j===V3-1){X3[W3]=S3;break;}X3[W3]=X3[W3]||{};X3=X3[W3];W3=U3[j+1];}}}}}}});var c3=d.getFeeds();if(O1.properties&&O1.properties.semanticPattern===true&&P(c3,M1)){o(c3,function(i,v){if(c3[i].getType()==='Measure'&&((c3[i].getUid()==='valueAxis')||(c3[i].getUid()==='actualValues'))){var k;o(Q1,function(b3,C3){var D3=K(C3.Measure.PropertyPath,i2);if(D3===c3[i].getValues()[0]){k=I(C3,I1);return false;}});if(k){var m=K(k.Measure.PropertyPath,i2);var n=(I1[k.DataPoint.AnnotationPath.substring(1)].ForecastValue.PropertyPath||I1[k.DataPoint.AnnotationPath.substring(1)].ForecastValue.Path);var y3=K(n,i2);var z3=h.getText("ACTUAL",[m]);var A3=h.getText("FORECAST",[y3]);S1.plotArea.dataPointStyle={rules:[{dataContext:{MeasureNamesDimension:m},properties:{color:"sapUiChartPaletteSequentialHue1Light1",lineType:"line",lineColor:"sapUiChartPaletteSequentialHue1Light1"},displayName:z3},{dataContext:{MeasureNamesDimension:y3},properties:{color:"sapUiChartPaletteSequentialHue1Light1",lineType:"dotted",lineColor:"sapUiChartPaletteSequentialHue1Light1",pattern:"diagonalLightStripe"},displayName:A3}]};d.getDataset().addMeasure(new M({name:y3,value:"{"+n+"}"}));var B3=c3[i].getValues();B3.push(y3);c3[i].setValues(B3);}return false;}});}var d3=false;if(z2&&z2.dimensionSettings&&Object.keys(z2.dimensionSettings).length>0){var e3=Object.keys(z2.dimensionSettings);for(var i=0;i<e3.length;i++){var f3=e3[i];var g3=z2.dimensionSettings[f3];if(Object.keys(g3).length>10){d3=true;break;}}}if(y2&&A.indexOf(K1.ChartType.EnumMember)>=0&&!d3){var h3=[];var i3=true;for(var i=0;i<P1.length;i++){var j3=P1[i].Dimension.PropertyPath;h3.push(j3);}for(var i=0;i<h3.length;i++){var f3=h3[i];if(e3.indexOf(f3)>-1){var k3=z2.dimensionSettings[f3];var l3=Object.keys(k3);var m3=[];for(var i=0;i<l3.length;i++){var n3=k3[l3[i]];m3.push(n3);}i3=i3&&m3.every(G1);}}if(i3){var o3=[];for(var i=0;i<h3.length;i++){var f3=h3[i];if(e3.indexOf(f3)>-1){var k3=z2.dimensionSettings[f3];var l3=Object.keys(k3);var m3=[];for(var i=0;i<l3.length;i++){var n3=k3[l3[i]];m3.push(n3);}F1(m3);for(var j=0;j<m3.length;j++){var p3=m3[j].dimensionValue;var q3=m3[j].color;var n3={"properties":{"color":q3}};n3.dataContext={};var r3=q1(i2,d,f3);n3.dataContext[r3]=p3;n3.displayName=p3;o3.push(n3);}}}S1.plotArea.dataPointStyle=S1.plotArea.dataPointStyle||{};S1.plotArea.dataPointStyle["rules"]=o3;}else{var o3=[];for(var i=0;i<h3.length;i++){var f3=h3[i];if(e3.indexOf(f3)>-1){var k3=z2.dimensionSettings[f3];var l3=Object.keys(k3);var m3=[];for(var i=0;i<l3.length;i++){var n3=k3[l3[i]];m3.push(n3);}F1(m3);var s3=m3.map(H1);}}S1.legend.order=function(m,n){var k=s3.indexOf(m);var v=s3.indexOf(n);return k>v?1:-1;};}}if(O1.properties&&O1.properties.semanticPattern===true&&P(c3,M1)&&d.getVizType()==="vertical_bullet"){o(c3,function(i,v){if(c3[i].getType()==='Measure'&&((c3[i].getUid()==='valueAxis')||(c3[i].getUid()==='actualValues'))){var k;o(Q1,function(b3,y3){var z3=K(y3.Measure.PropertyPath,i2);if(z3===c3[i].getValues()[0]){k=J(y3,I1);return false;}});if(k){var m=(I1[k.DataPoint.AnnotationPath.substring(1)].TargetValue.PropertyPath||I1[k.DataPoint.AnnotationPath.substring(1)].TargetValue.Path);var n=K(m,i2);d.getDataset().addMeasure(new M({name:n,value:"{"+m+"}"}));d.addFeed(new F({'uid':"targetValues",'type':"Measure",'values':[n]}));}return false;}});}if(X2&&Y2){L.warning(h.getText("Currency_non_currency_measure"));}o(c3,function(i,k){var m=k.getProperty("type");if(m==="Measure"){var n=k.getProperty("values");var v=true;var y3=K1.MeasureAttributes.filter(function(z3){return n.indexOf(i2[z3[m]["PropertyPath"]][w.LABEL_KEY])>=0||n.indexOf(i2[z3[m]["PropertyPath"]][w.LABEL_KEY_V4])>=0;});o(y3,function(j,z3){if(n1(i2,z3,m)||o1(i2,z3,m)){v=false;}else{v=true;return false;}});if(!v){S1[k.getProperty('uid')]['label']['allowDecimals']=false;}}});var t3;if(W2===undefined){W2="";}if(V2===undefined){V2="";}if(X2){t3=v1(W2,X2);}else{t3=v1(V2,X2);}if(f){f.setScale(t3);}u1(_2,a3,r);var u3="";o(c3,function(i,k){var m="-1";var n=k.getProperty("type");if(n==="Measure"){var v=$2.filter(function(A3){var B3=A3["title"]["text"].split(",").filter(function(C3){if(k.getValues().indexOf(C3.trim())>=0){return true;}else{return false;}});if(B3.length>0){return true;}else{return false;}});if(v&&v.length){var y3=k.getValues();if(y3&&y3.length){o(y3,function(i,A3){var B3=A3.trim();var C3=Q1.filter(function(G3){if(G3["Measure"]&&G3["Measure"]["PropertyPath"]){var H3=G3["Measure"]["PropertyPath"];if((i2[H3]&&i2[H3][w.LABEL_KEY]===B3)||(i2[H3]&&i2[H3][w.LABEL_KEY_V4]===B3)){return true;}else{return false;}}});if(C3&&C3.length){var D3=C3[0];if(!n1(i2,D3,n)&&!o1(i2,D3,n)){var E3="";if(D3&&D3["DataPoint"]&&D3["DataPoint"]["AnnotationPath"]&&D3["DataPoint"]["AnnotationPath"]){E3=D3["DataPoint"]["AnnotationPath"]&&D3["DataPoint"]["AnnotationPath"].substring(1);if(E3!=""){var F3;F3=I1[E3]&&I1[E3]["ValueFormat"]&&I1[E3]["ValueFormat"]["NumberOfFractionalDigits"]&&I1[E3]["ValueFormat"]["NumberOfFractionalDigits"]["Int"];m=F3>m?F3:m;}}}else{m=m<"0"?"0":m;}}});}}if(v&&v[0]&&v[0].label&&v[0].label.formatString){var z3=v[0].label.formatString;}u3="";if(X2){if(z3==='CURR'){u3='CURR/'+m.toString()+"/";}else{u3='axisFormatter/'+m.toString()+"/";}}else{u3='axisFormatter/'+m.toString()+"/";}if(v&&v[0]){v[0].label.formatString=u3;}}});if(M1==="vertical_bullet"){S1["valueAxis"]={title:{visible:q2?false:true},label:{formatString:u3}};}var v3="";var w3="";if(X2){v3=U2.toString();w3='CURR/'+U2.toString()+"/";}else{v3=T2.toString();w3='axisFormatter/'+T2.toString()+"/";}if(M1==="donut"||L1){if(M1==="donut"){S1.legendGroup={layout:{height:0.1}};}S1.plotArea.dataLabel.formatString=w3;if(S1.plotArea.dataLabel.type==="percentage"){S1.plotArea.dataLabel.formatString="0.0%/"+v3+"/";}}b1(U1,O1,"dimension");b1(V1,O1,"measure");if(Z1){var x3=P1[0].Dimension.PropertyPath;if(i2[x3][w.SEMANTICS_KEY]==='yearmonth'||i2[x3]["com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]){S1.timeAxis.levels=["year","month"];}else if(i2[x3][w.SEMANTICS_KEY]==='yearquarter'||i2[x3]["com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]){S1.timeAxis.levels=["year","quarter"];}else if(i2[x3][w.SEMANTICS_KEY]==='yearweek'||i2[x3]["com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]){S1.timeAxis.levels=["year","week"];}else if(i2[x3][w.SEMANTICS_KEY]==='year'||i2[x3]["com.sap.vocabularies.Common.v1.IsCalendarYear"]){S1.timeAxis.levels=["year"];}}d.setVizProperties(S1);}function q1(m,v,d){var f="";if(m&&m[d]){if(m[d][w.LABEL_KEY_V4]){f=s1(m[d][w.LABEL_KEY_V4].String?m[d][w.LABEL_KEY_V4].String:m[d][w.LABEL_KEY_V4].Path,v,m);}else if(m[d][w.LABEL_KEY]){f=m[d][w.LABEL_KEY];}else if(d){f=d;}}return f;}function r1(v,d,f){if(v&&(v.getVizType()==="bubble"||v.getVizType()==="scatter")){return;}var j,k,n,r;var s;var x=w.UNIT_KEY;var I1=w.UNIT_KEY_V4_ISOCurrency;var J1=w.UNIT_KEY_V4_Unit;var K1;var L1=[];if(!(j=v.getModel('ovpCardProperties'))){L.error(y.CARD_ERROR+"in "+y.CARD_CONFIG+y.NO_CARD_MODEL);return;}var M1=v.getModel();var N1=j.getProperty("/entitySet");if(!M1||!N1){return;}k=j.getProperty("/entityType");if(!k){L.error(y.CARD_ANNO_ERROR+"in "+y.CARD_ANNO);return;}var O1=t1(M1,N1);n=j.getProperty("/chartAnnotationPath");if(!n||!(r=k[n])){L.error(y.CARD_ANNO_ERROR+"in "+y.CARD_ANNO);return;}if(!(s=r.MeasureAttributes)||!s.length){L.error(y.CHART_ANNO_ERROR+"in "+y.CHART_ANNO+" "+y.MEASURES_MANDATORY);return;}o(s,function(i,m){K1=m.Measure.PropertyPath;if(m.DataPoint&&m.DataPoint.AnnotationPath){var X1=k[m.DataPoint.AnnotationPath.substring(1)];if(X1.ForecastValue&&(X1.ForecastValue.PropertyPath||X1.ForecastValue.Path)){L1.push((X1.ForecastValue.PropertyPath||X1.ForecastValue.Path));}}L1.push(K1);});var P1=d?d.results:null;var Q1="";var R1=true;var S1=[];var T1=v.getFeeds();o(T1,function(i,m){if(m.getType()==="Measure"){S1=S1.concat(m.getValues());}});if(P1){o(L1,function(i,m){var X1=q1(O1,v,m);if((S1?Array.prototype.indexOf.call(S1,X1):-1)!=-1){if(O1&&O1[m]){var Y1;if(O1[m][I1]){Y1=O1[m][I1].Path?O1[m][I1].Path:O1[m][I1].String;}else if(O1[m][J1]){Y1=O1[m][J1].Path?O1[m][J1].Path:O1[m][J1].String;}else if(O1[m][x]){Y1=O1[m][x];}if(!Y1){R1=false;return false;}if(Y1&&O1[Y1]){for(var i=0;i<P1.length;i++){var Z1=P1[i];if(R1){if(Q1&&Z1[Y1]&&(Z1[Y1]!="")&&(Q1!="")&&(Q1!=Z1[Y1])){R1=false;break;}}Q1=Z1[Y1];}}}}});}var U1="";if(R1){if(Q1!=""){U1=h.getText("IN_NO_SCALE",[Q1]);U1=" "+U1;}if(f){f.setText(U1);f.data("aria-label",U1,true);var V1=v.data("aria-label");if(V1&&U1&&V1.indexOf(U1)===-1){var W1=V1+U1;v.data("aria-label",W1,true);}}}}function s1(f,v,m){var r;var s;var d;if(f&&f.indexOf("{")===0){f=f.slice(1,-1);if(f.indexOf(">")!=-1){d=f.split(">");r=d[0];s=d[1];}else if(f.indexOf("&gt;")!=-1){d=f.split("&gt;");r=d[0];s=d[1];}try{f=v.getModel(r).getProperty(s);}catch(i){f=m[f][w.LABEL_KEY_V4].String;L.error("Unable to read labels from resource file",i);}}return f;}function t1(m,d){var f=U.cacheODataMetadata(m);if(!f){return undefined;}return f[d];}function u1(m,d,f){var j="",k="",n="";if(f){j=f.getText();}if(m&&(m.length>1)){for(var i=0;i<m.length-1;i++){if(k!=""){k+=", ";}k+=m[i];}k=h.getText("MEAS_DIM_TITLE",[k,m[i]]);}else if(m){k=m[0];}if(d&&(d.length>1)){for(var i=0;i<d.length-1;i++){if(n!=""){n+=", ";}n+=d[i];}n=h.getText("MEAS_DIM_TITLE",[n,d[i]]);}else if(d){n=d[0];}if(f&&(j==="")){j=h.getText("NO_CHART_TITLE",[k,n]);f.setText(j);f.data("aria-label",j,true);}}function v1(m,i){var n=1;var s;if(i){var d=N.getCurrencyInstance({style:'short',currencyCode:false,shortRefNumber:m});s=d.format(Number(n));}else{var f=N.getFloatInstance({style:'short',shortRefNumber:m});s=f.format(Number(n));}var j=s.slice(-1);return j;}function w1(v,d){v.attachSelectData(function(f){var n=l.bCRTLPressed?l.constants.explace:l.constants.inplace;l.bCRTLPressed=false;var m=v.getModel('ovpCardProperties');var s=v.getModel();var I1=m.getProperty("/entitySet");var J1=t1(s,I1);var K1=[],L1=[];var M1={},N1={};var O1=v.getDataset().getDimensions();var P1;for(var i=0;i<O1.length;i++){K1.push(O1[i].getName());}var Q1=v.getDataset().getBinding("data").getCurrentContexts().map(function(x){return x.getObject();});if(f.getParameter("data")&&f.getParameter("data")[0]&&f.getParameter("data")[0].data){L1=Object.keys(f.getParameter("data")[0].data);P1=f.getParameter("data")[0].data._context_row_number;var R1=v.getDataset().getBinding("data").getContexts()[P1];var S1=d.getEntityNavigationEntries(R1)[0];if(Q1[P1].$isOthers&&Q1[P1].$isOthers===true){var T1={},U1=[];for(var j=0;j<K1.length;j++){for(var k=0;k<L1.length;k++){if(K1[j]===L1[k]){for(var V1 in J1){if(J1.hasOwnProperty(V1)){var W1=J1[V1][w.LABEL_KEY]||J1[V1][w.NAME_KEY]||J1[V1][w.NAME_CAP_KEY];if(W1===L1[k]){U1.push(V1);}}}}}}for(var i=0;i<U1.length;i++){T1[U1[i]]=[];for(var j=0;j<Q1.length-1;j++){if(j!=P1){T1[U1[i]].push(Q1[j][U1[i]]);}}}var X1={$isOthers:true};var Y1={getObject:function(){return X1;},getOtherNavigationDimensions:function(){return T1;}};if(O.checkIfAPIIsUsed(d)){if(d.checkAPINavigation()){c.onContentClicked(Y1);}}else{if(S1){d.doNavigation(Y1,S1,n);}}}else{for(var j=0;j<K1.length;j++){for(var k=0;k<L1.length;k++){if(K1[j]===L1[k]){for(var V1 in J1){if(J1.hasOwnProperty(V1)){var W1=(J1[V1][w.LABEL_KEY_V4]&&J1[V1][w.LABEL_KEY_V4].String)||J1[V1][w.LABEL_KEY]||J1[V1][w.NAME_KEY]||J1[V1][w.NAME_CAP_KEY];if(W1.match(/{@i18n>.+}/gi)){var Z1=this.getModel("@i18n").getResourceBundle();W1=Z1.getText(W1.substring(W1.indexOf(">")+1,W1.length-1));}if(W1===L1[k]){M1[V1]=Q1[P1][V1];}}}}for(var V1 in Q1[P1]){if(J1.hasOwnProperty(V1)){N1[V1]=Q1[P1][V1];}}}}if(M1){o(Object.keys(M1),function(i,V1){if(J1[V1]["type"]==="Edm.String"){if(J1[V1]["sap:semantics"]==="yearmonth"||J1[V1]["com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]){M1[V1]=(M1[V1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYMM"}).format(M1[V1]):M1[V1]);}else if(J1[V1]["sap:semantics"]==="yearquarter"||J1[V1]["com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]){M1[V1]=(M1[V1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYQ"}).format(M1[V1]):M1[V1]);}else if(J1[V1]["sap:semantics"]==="yearweek"||J1[V1]["com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]){M1[V1]=(M1[V1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYww"}).format(M1[V1]):M1[V1]);}}});}if(N1){o(Object.keys(N1),function(i,V1){if(J1[V1]["type"]==="Edm.String"){if(J1[V1]["sap:semantics"]==="yearmonth"||J1[V1]["com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]){N1[V1]=(N1[V1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYMM"}).format(N1[V1]):N1[V1]);}else if(J1[V1]["sap:semantics"]==="yearquarter"||J1[V1]["com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]){N1[V1]=(N1[V1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYQ"}).format(N1[V1]):N1[V1]);}else if(J1[V1]["sap:semantics"]==="yearweek"||J1[V1]["com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]){N1[V1]=(N1[V1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYww"}).format(N1[V1]):N1[V1]);}}});}var $1=m.getProperty("/entityType"),_1=$1[m.getProperty('/presentationAnnotationPath')];if($1){var a2=a.getRequestFields(_1);if(a2&&a2.length>0){o(a2,function(i,r){if(!M1.hasOwnProperty(r)){M1[r]=Q1[P1][r];}});}}var Y1={getObject:function(){return M1;},getAllData:function(){return N1;}};if(O.checkIfAPIIsUsed(d)){if(d.checkAPINavigation()){c.onContentClicked(Y1);}}else{if(S1){d.doNavigation(Y1,S1,n);}}}}});}function x1(d){if(d.EnumMember.endsWith("Bubble")){return true;}else{return false;}}function y1(d){var r=false;if(!d||d.constructor!=Array||d.length<1||d[0].constructor!=Object||!d[0].Dimension||!d[0].Dimension.PropertyPath){L.error(y.CHART_ANNO_ERROR+"in "+y.CHART_ANNO+" "+y.DIMENSIONS_MANDATORY);return r;}r=true;return r;}function z1(m){var r=false;if(!m||m.constructor!=Array||m.length<1||m[0].constructor!=Object||!m[0].Measure||!m[0].Measure.PropertyPath){L.error(y.CHART_ANNO_ERROR+"in "+y.CHART_ANNO+" "+y.MEASURES_MANDATORY);return r;}r=true;return r;}function A1(d){return d.name;}function B1(d){if(d&&d.indexOf("#")!=-1){var f=d.split("#");if(f.length>1){return f[1];}}return"";}function C1(n,v){var d=v.getModel('ovpCardProperties');var f=D1(v);var m=+f.itemsLength;var i=+d.getProperty("/dataStep");if(m&&i){var j=n.colSpan-1;if(j>=0){m+=i*j;E1(v,m);}}}function D1(v){var d=v.getModel('ovpCardProperties');var f=d.getProperty("/entityType");var i=d.getProperty("/presentationAnnotationPath");var j=f.hasOwnProperty(i)&&f[i];var m=j&&j.MaxItems;if(m){var k=m.Int32?m.Int32:m.Int;return{itemsLength:+k,dataStep:+d.getProperty("/dataStep")};}}function E1(v,d){var n,f={},j=[];var k=v.getVizType();var r=v.getModel('ovpCardProperties');var s=r.getProperty("/entityType");var x=r.getProperty("/chartAnnotationPath");var I1=s[x];var J1=v.getParent();var K1=J1.getBinding("data");f.path=K1.getPath();f.parameters={};if(K1.mParameters&&K1.mParameters.select){f.parameters.select=K1.mParameters.select;}f.filters=K1.aApplicationFilters;f.sorter=K1.aSorters;f.length=(k==="donut")?d+1:d;f.template=new g();J1.bindAggregation("data",f);if(k==="donut"){o(I1.MeasureAttributes,function(i,m){j.push(m.Measure.PropertyPath);});n={};n.path=K1.getPath();n.parameters={};n.parameters.select=j.join(",");n.filters=K1.aApplicationFilters;n.sorter=K1.aSorters;n.length=1;n.template=new g();J1.bindAggregation("aggregateData",n);}J1.updateBindingContext();}function F1(d){d.sort(function(r,f){if(r.index<f.index){return-1;}if(r.index>f.index){return 1;}return 0;});}function G1(d){return d.color!==undefined;}function H1(r){return r.dimensionValue;}return{constants:w,errorMessages:y,formatItems:B,formatByType:Q,returnDateFormat:R,formatChartAxes:T,hideDateTimeAxis:W,checkExists:X,validateCardConfiguration:Y,checkNoData:Z,getConfig:$,hasTimeSemantics:_,getChartType:a1,getPrimitiveValue:c1,formThePathForCriticalityStateCalculation:f1,checkFlag:i1,buildVizAttributes:p1,setChartUoMTitle:r1,getMetadata:t1,getSelectedDataPoint:w1,checkBubbleChart:x1,dimensionAttrCheck:y1,measureAttrCheck:z1,getEntitySet:A1,getAnnotationQualifier:B1,reprioritizeContent:C1,getMaxItems:D1,getLabelFromAnnotationPath:s1};},true);
