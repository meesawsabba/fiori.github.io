sap.ui.define(["sap/ui/thirdparty/jquery","sap/ovp/cards/v4/charts/Utils","sap/ui/model/odata/CountMode","sap/ovp/cards/v4/V4AnnotationHelper","sap/ui/core/format/NumberFormat","sap/ui/core/format/DateFormat","sap/viz/ui5/api/env/Format","sap/viz/ui5/controls/VizTooltip","sap/ovp/cards/CommonUtils","sap/ovp/cards/OVPCardAsAPIUtils","sap/viz/ui5/data/DimensionDefinition","sap/viz/ui5/data/MeasureDefinition","sap/viz/ui5/controls/common/feeds/FeedItem","sap/ui/core/Element","sap/ovp/app/resources","sap/ovp/app/OVPUtils","sap/base/util/each","sap/base/util/merge","sap/ovp/cards/ovpLogger","sap/base/util/isEmptyObject"],function(q,U,C,a,N,D,V,b,c,O,e,M,F,g,h,l,o,p,t,u){"use strict";var w={LABEL_KEY:"sap:label",LABEL_KEY_V4:"com.sap.vocabularies.Common.v1.Label",TEXT_KEY:"sap:text",TEXT_KEY_V4:"com.sap.vocabularies.Common.v1.Text",TEXT_ARRANGEMENT_ANNO:"com.sap.vocabularies.UI.v1.TextArrangement",TYPE_KEY:"$Type",DISPLAY_FORMAT_KEY:"sap:display-format",SEMANTICS_KEY:"sap:semantics",UNIT_KEY:"sap:unit",UNIT_KEY_V4_ISOCurrency:"Org.OData.Measures.V1.ISOCurrency",UNIT_KEY_V4_Unit:"Org.OData.Measures.V1.Unit",CURRENCY_CODE:"currency-code",NAME_KEY:"name",NAME_CAP_KEY:"Name",EDM_TYPE:"type",EDM_INT32:"Edm.Int32",EDM_INT64:"Edm.Int64",SCATTER_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Scatter",BUBBLE_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Bubble",LINE_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Line",COLUMNSTACKED_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/ColumnStacked",VERTICALBULLET_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/VerticalBullet",COLUMN_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Column",BAR_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Bar",COMBINATION_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Combination",DONUT_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Donut",V4_ANNOTATION:"annotations"};var y={CARD_WARNING:"OVP-AC: Analytic card: Warning: ",CARD_ERROR:"OVP-AC: Analytic card Error: ",DATA_ANNO_ERROR:"OVP-AC: Analytic card Error:",CARD_ANNO_ERROR:"OVP-AC: Analytic card: Error ",CHART_ANNO_ERROR:"OVP-AC: Analytic card: Error ",INVALID_CHART_ANNO:"OVP-AC: Analytic Cards: Invalid Chart Annotation.",ANALYTICAL_CONFIG_ERROR:"Analytic card configuration error",CACHING_ERROR:"no model defined while caching OdataMetaData",INVALID_MAXITEMS:"maxItems is Invalid. ",NO_DATASET:"OVP-AC: Analytic Cards: Could not obtain dataset.",SORTORDER_WARNING:"SortOrder is present in PresentationVariant, but it is empty or not well formed.",BOOLEAN_ERROR:"Boolean value is not present in PresentationVariant.",IS_MANDATORY:"is mandatory.",IS_MISSING:"is missing.",NOT_WELL_FORMED:"is not found or not well formed)",MISSING_CHARTTYPE:"Missing ChartType in ",CHART_ANNO:"Chart Annotation.",DATA_ANNO:"Data Annotation",CARD_ANNO:"card annotation.",CARD_CONFIG:"card configuration.",CARD_CONFIG_ERROR:"Could not obtain configuration for ",CARD_CONTAINER_ERROR:"Could not obtain card container. ",DATA_UNAVAIALABLE:"No data available.",CONFIG_LOAD_ERROR:"Failed to load config.json. Reason: ",INVALID_CHARTTYPE:"Invalid ChartType given for ",INVALID_CONFIG:"No valid configuration given for ",CONFIG_JSON:"in config.json",ENTER_INTEGER:"Please enter an Integer.",NO_CARD_MODEL:"Could not obtain Cards model.",ANNO_REF:"com.sap.vocabularies.UI.v1 annotation.",INVALID_REDUNDANT:"Invalid/redundant role configured for ",CHART_IS:"chart is/are ",CARD_CONFIG_JSON:"card from config.json",ALLOWED_ROLES:"Allowed role(s) for ",DIMENSIONS_MANDATORY:"DimensionAttributes are mandatory.",MEASURES_MANDATORY:"MeasureAttributes are mandatory.",CARD_LEAST:"card: Enter at least ",CARD_MOST:"card: Enter at most ",FEEDS:"feed(s).",MIN_FEEDS:"Minimum number of feeds required for ",FEEDS_OBTAINED:"card is not configured. Obtained ",FEEDS_REQUIRED:"feed(s), Required: ",INVALID_SEMANTIC_MEASURES:"More than one measure is being semantically coloured",INVALID_IMPROVEMENT_DIR:"No Improvement Direction Found",INVALID_CRITICALITY:"Invalid criticality values",INVALID_DIMMEAS:"Invalid number of Measures or Dimensions",INVALID_FORECAST:"Invalid/Redundant Datapoint or Forecast measure",INVALID_TARGET:"Invalid/Redundant Datapoint or Target measure",ERROR_MISSING_AXISSCALES:"Minimum and Maximum values are mandatory for AxisScale MinMax to work"};var S=["year","yearweek","yearmonth","yearquarter"];var z=[w.COLUMNSTACKED_CHARTTYPE,w.DONUT_CHARTTYPE,w.COLUMN_CHARTTYPE,w.BAR_CHARTTYPE,w.VERTICALBULLET_CHARTTYPE,w.LINE_CHARTTYPE,w.COMBINATION_CHARTTYPE,w.BUBBLE_CHARTTYPE];var A=[w.COLUMNSTACKED_CHARTTYPE];var G;var L=new t("OVP.charts.VizAnnotationManager");function B(d,s,f){var i=d.getMetaModel().getObject("/"+s+"/"+f+"@");return i["@com.sap.vocabularies.Common.v1.IsCalendarYear"]||i["@com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]||i["@com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]||i["@com.sap.vocabularies.Common.v1.IsCalendarYearWeek"];}function E(f,j,n,v,x,K1,L1){var M1="{";if(!f||!f.getSetting('ovpCardProperties')){L.error(y.ANALYTICAL_CONFIG_ERROR);M1+="}";return M1;}var N1=f.getSetting("dataModel");var O1;if(L1&&L1.$EnumMember){O1=L1.$EnumMember.split("/");if(O1&&(O1[1]!='Donut')&&(x===undefined)){return null;}}var P1=[];var Q1=[];var R1=[];var S1=[];var T1=[];var U1=[];var V1=[];var W1=n&&n.Parameters;var X1=v&&v.SortOrder;var Y1=v&&v.MaxItems,Z1=null;var $1;var _1;var a2;var b2=null;var c2=w.TEXT_KEY;var d2=w.TEXT_KEY_V4;var e2=w.UNIT_KEY;var f2=w.UNIT_KEY_V4_ISOCurrency;var g2=w.UNIT_KEY_V4_Unit;var h2={};if(Y1){Z1=Y1.Int32?Y1.Int32:Y1.Int;}if(Z1){if(Z1==="0"){L.error("OVP-AC: Analytic card Error: maxItems is configured as "+Z1);M1+="}";return M1;}if(!/^\d+$/.test(Z1)){L.error("OVP-AC: Analytic card Error: maxItems is Invalid. Please enter an Integer.");M1+="}";return M1;}}var i2=f.getSetting('ovpCardProperties'),j2=i2.getProperty('/parameters');var k2=i2.getProperty("/metaModel");var l2=i2.getProperty("/measureAggregate");W1=W1||!!j2;if(W1){var m2=a.resolveParameterizedEntitySet(N1,j,n,j2);M1+="path: '"+m2+"'";}else{M1+="path: '/"+j.$Type.split(".")[1]+"'";}var n2=[];b2=f.getSetting('ovpCardProperties').getProperty("/entitySet");if(!N1||!b2){return M1;}var o2=u1(N1,b2);G1(N1,o2,j.$Type);var p2=f.getSetting('ovpCardProperties').getProperty("/cardLayout");var q2=1,r2;var s2=_();var t2;var u2;if(x&&p2&&p2.colSpan&&p2.colSpan>1){r2=p2.colSpan-q2;for(var v2 in s2){if((u2=s2[v2].reference)&&s2[u2]){var w2=p({},s2[u2]);s2[v2]=w2;}if(v2===O1[1]||(s2[v2].time&&s2[v2].time.type===O1[1].toLowerCase())){t2=s2[v2];break;}}var x2=a1(x,t2,N1,b2);if(x2){t2=t2.time;}else{t2=t2.default;}var y2=f.getSetting('ovpCardProperties').getProperty("/dataStep");if(!y2){if(t2.resize&&t2.resize.hasOwnProperty("dataStep")&&!isNaN(t2.resize.dataStep)){y2=t2.resize.dataStep;}}y2=parseInt(y2,10);if(r2>0&&y2&&!isNaN(y2)){Z1=parseInt(Z1,10)+y2*r2;}}if(n){var i2=f.getSetting('ovpCardProperties');n2=a.getFilters(i2,n);}if(n2.length>0){M1+=", filters: "+JSON.stringify(n2);}if(X1){var z2=v.SortOrder;if(!z2.length){z2=U.getSortAnnotationCollection(N1,v,j);}if(z2.length<1){L.warning(y.CARD_WARNING+y.SORTORDER_WARNING);}else{var A2="";var B2;var C2;var D2;for(var i=0;i<z2.length;i++){B2=z2[i];D2=B2.Property.PropertyPath;V1.push(D2);if(typeof B2.Descending==="undefined"){C2='true';}else{var j1=B2.Descending.Bool||B2.Descending.Boolean;if(!j1){L.warning(y.CARD_WARNING+y.BOOLEAN_ERROR);C2='true';}else{C2=j1.toLowerCase()==='true'?'true':'false';}}A2=A2+"{path: '"+D2+"',descending: "+C2+"},";}M1+=", sorter: ["+A2.substring(0,A2.length-1)+"]";}}var E2=f.getSetting("ovpCardProperties").getProperty("/entityType");o(K1,function(i,m){$1=m.Measure.$PropertyPath;if(m.DataPoint&&m.DataPoint.AnnotationPath){var d=E2[m.DataPoint.AnnotationPath.substring(1)];if(d.ForecastValue&&(d.ForecastValue.PropertyPath||d.ForecastValue.Path)){var r=(d.ForecastValue.PropertyPath||d.ForecastValue.Path);T1.push((d.ForecastValue.PropertyPath||d.ForecastValue.Path));if(o2&&o2[r]){var s;if(o2[r][f2]){s=o2[r][f2].Path?o2[r][f2].Path:undefined;}else if(o2[r][g2]){s=o2[r][g2].Path?o2[r][g2].Path:undefined;}else if(o2[r][e2]){s=o2[r][e2];}if(s){if((T1?Array.prototype.indexOf.call(T1,s):-1)===-1){T1.push(s);}}}}if(d.TargetValue&&(d.TargetValue.PropertyPath||d.TargetValue.Path)){var K2=(d.TargetValue.PropertyPath||d.TargetValue.Path);T1.push((d.TargetValue.PropertyPath||d.TargetValue.Path));if(o2&&o2[K2]){var s;if(o2[K2][f2]){s=o2[K2][f2].Path?o2[K2][f2].Path:undefined;}else if(o2[K2][g2]){s=o2[K2][g2].Path?o2[K2][g2].Path:undefined;}else if(o2[K2][e2]){s=o2[K2][e2];}if(s){if((T1?Array.prototype.indexOf.call(T1,s):-1)===-1){T1.push(s);}}}}}T1.push($1);if(o2&&o2[$1]){if(o2[$1][d2]){if(o2[$1][d2].String&&$1!=o2[$1][d2].String){T1.push(o2[$1][d2].String?o2[$1][d2].String:$1);}else if(o2[$1][d2].Path&&$1!=o2[$1][d2].Path){T1.push(o2[$1][d2].Path?o2[$1][d2].Path:$1);}}else if(o2[$1][c2]&&$1!=o2[$1][c2]){T1.push(o2[$1][c2]?o2[$1][c2]:$1);}}if(o2&&o2[$1]){var s;if(o2[$1][f2]){s=o2[$1][f2].Path?o2[$1][f2].Path:undefined;}else if(o2[$1][g2]){s=o2[$1][g2].Path?o2[$1][g2].Path:undefined;}else if(o2[$1][e2]){s=o2[$1][e2];}if(s){if((T1?Array.prototype.indexOf.call(T1,s):-1)===-1){T1.push(s);}}}});o(x,function(i,d){$1=d.Dimension.$PropertyPath;P1.push($1);if(o2&&o2[$1]){if(o2[$1]["annotations"]&&o2[$1]["annotations"]["@"+d2]){if(typeof o2[$1]["annotations"]["@"+d2]==='string'&&o2[$1]["annotations"]["@"+d2]&&$1!=o2[$1]["annotations"]["@"+d2]){P1.push(o2[$1]["annotations"]["@"+d2]);}else if(o2[$1]["annotations"]["@"+d2].$Path&&$1!=o2[$1]["annotations"]["@"+d2].$Path){a2=o2[$1]["annotations"]["@"+d2].$Path;var m=a2.split("/");if(m.length>1){_1=H(k2,E2,a2);if(_1!==""){P1.push(a2);Q1.push(_1);S1=I(k2,E2,a2);if(S1.length>0){R1=R1.concat(S1);}}}else{P1.push(a2?a2:$1);}}}else if(o2[$1][c2]&&$1!=o2[$1][c2]){P1.push(o2[$1][c2]?o2[$1][c2]:$1);}}});if(R1.length>0){var k=0;while(k<R1.length){if(P1.indexOf(R1[k])!==-1){R1.splice(k,1);}else{k++;}}}if(T1.length>0){o(T1,function(i,m){h2[m]=true;});}if(P1.length>0){o(P1,function(i,d){h2[d]=true;});}M1+=", parameters: {$apply:'groupby(("+P1.join(",")+"),";M1+="aggregate(";var F2=[];T1.forEach(function(m,i){var s=l2&&l2["Axis"+(i+1)];var d=s?s:"sum";var r=[m," with ",d," as ",m,"Aggregate"].join('');F2.push(r);});M1+=F2.join(',');M1+="))";var G2=k2.getObject("/"+j.$Type);if(G2){var H2=a.getRequestFields(v);if(H2&&H2.length>0){o(H2,function(i,r){if(!h2.hasOwnProperty(r)){h2[r]=true;U1.push(r);}});if(U1.length>0){M1+=","+U1.join(",");}}}if(V1.length>0){var I2=[];o(V1,function(i,s){if(!h2.hasOwnProperty(s)){I2.push(s);}});if(I2.length>0){M1+=","+I2.join(",");}}if(Q1.length>0){M1+="'"+","+" expand:'"+Q1.join(',');}var J2=a.checkFilterPreference(f.getSetting("ovpCardProperties"));if(J2){M1+="', custom: {cardId: '"+f.getSetting("ovpCardProperties").getProperty("/cardId")+"'}}";}else{M1+="'}";}if(O1&&(O1[1]==='Donut')&&(x===undefined)){M1+=", length: 1";}else if(O1&&(O1[1]==='Donut')&&(x)&&Z1){M1+=", length: "+(parseInt(Z1,10)+1);}else if(Z1){M1+=", length: "+Z1;}M1+="}";return M1;}E.requiresIContext=true;function H(m,d,s){var f="";var j=s.split("/");if(j.length>1){for(var i=0;i<(j.length-1);i++){var k=m.getODataAssociationEnd(d,j[i]);if(k){d=m.getODataEntityType(k.type);if(f){f=f+"/";}f=f+j[i];}else{return f;}}}return f;}function I(m,d,s){var f=[];var k=[];var n;var r=s.split("/");if(r.length>1){for(var i=0;i<(r.length-1);i++){var v=m.getODataAssociationEnd(d,r[i]);if(v){d=m.getODataEntityType(v.type);if(d){k=d&&d.key&&d.key.propertyRef;for(var j=0;j<k.length;j++){n=r[i]+"/"+k[j].name;f.push(n);}}}}}return f;}function J(m,d){var f=false;var r;if(m.DataPoint&&m.DataPoint.AnnotationPath){var i=d[m.DataPoint.AnnotationPath.substring(1)];if(i&&i.ForecastValue&&(i.ForecastValue.PropertyPath||i.ForecastValue.Path)){f=true;r=m;}}if(f===true){return r;}else{L.warning(y.CARD_WARNING+y.INVALID_FORECAST);return undefined;}}function K(m,d){var f=false;var r;if(m.DataPoint&&m.DataPoint.AnnotationPath){var i=d[m.DataPoint.AnnotationPath.substring(1)];if(i&&i.TargetValue&&(i.TargetValue.PropertyPath||i.TargetValue.Path)){f=true;r=m;}}if(f===true){return r;}else{L.warning(y.CARD_WARNING+y.INVALID_TARGET);return undefined;}}function P(m,d){var f;o(d,function(i,v){if(v.name===m){if(v["com.sap.vocabularies.Common.v1.Label"]){f=v["com.sap.vocabularies.Common.v1.Label"].String?v["com.sap.vocabularies.Common.v1.Label"].String:v["com.sap.vocabularies.Common.v1.Label"].Path;}else if(v["sap:label"]){f=v["sap:label"];}return false;}});return f;}function Q(f,d){var j=true;if(d==="line"||d==="column"||d==="bar"){o(f,function(i,v){if((v.getUid()==='valueAxis')||(v.getUid()==='categoryAxis')){if(v.getValues().length!=1){j=false;L.warning(y.CARD_WARNING+y.INVALID_DIMMEAS);return false;}}});}else if(d==="vertical_bullet"){o(f,function(i,v){if((v.getUid()==='actualValues')||(v.getUid()==='categoryAxis')){if(v.getValues().length!=1){j=false;L.warning(y.CARD_WARNING+y.INVALID_DIMMEAS);return false;}}});}if(j===true){return true;}}function R(m,s,v){var d=w.TYPE_KEY;if(!m||!m[s]||!m[s][d]){return v;}var n=["Edm.Int","Edmt.Int16","Edm.Int32","Edm.Int64","Edm.Decimal"];var f=m[s][d];if((n?Array.prototype.indexOf.call(n,f):-1)!==-1){return Number(v);}return v;}function T(d){if(d){return d;}return"";}function W(r){var d={locale:function(){},format:function(v,f){var i="";if(f){i=f.split('/');}if(i.length>0){var m,s;if(i.length===3){m=Number(i[1]);s=Number(i[2]);if(isNaN(m)){m=-1;}if(isNaN(s)){s=0;}}else{m=2;s=0;}if(i[0]==="axisFormatter"||(i[0]==="ShortFloat")){var n;n=N.getFloatInstance({style:'short',minFractionDigits:m,maxFractionDigits:m?m:1});if(i[0]==="ShortFloat"){n=N.getFloatInstance({style:'short',minFractionDigits:m,maxFractionDigits:m});}if(m===-1){n=N.getFloatInstance({style:'short'});}return n.format(Number(v));}else if(i[0]==="tooltipNoScaleFormatter"){var j=N.getFloatInstance({style:'short',currencyCode:false,shortRefNumber:s,showScale:false,minFractionDigits:m,maxFractionDigits:m});if(m===-1){j=N.getFloatInstance({minFractionDigits:0,currencyCode:false});}return j.format(Number(v));}else if(i[0]==="CURR"){var k=N.getCurrencyInstance({style:'short',currencyCode:false,minFractionDigits:m,maxFractionDigits:m});if(m===-1){k=N.getCurrencyInstance({style:'short',currencyCode:false});}return k.format(Number(v));}else if(i[0].search("%")!==-1){var x=N.getPercentInstance({style:'short',minFractionDigits:m,maxFractionDigits:m});if(m===-1){x=N.getPercentInstance({style:'short',minFractionDigits:1,maxFractionDigits:1});}v=x.format(Number(v));return v;}}if(v.constructor===Date){var K1=D.getDateTimeInstance({pattern:f});if(f==="YearMonthDay"){K1=D.getDateInstance({style:"medium"});}if(f==="YearMonth"||f==="MMM"){K1=D.getDateTimeInstance({format:"MMM"});}if(f==="YearQuarter"||f==="Quarter"){K1=D.getDateTimeInstance({format:"QQQ"});}if(f==="YearWeek"||f==="Week"){K1=D.getDateTimeInstance({format:"www"});}var L1=c.getApp();var M1=L1&&L1.bResetChartAxisFormatter;if(M1&&f==="hh:mm"){var N1=v.toLocaleTimeString();var O1=N1.split(":");v=O1[0]+":"+O1[1];return v;}var P1=M1?false:true;v=K1.format(new Date(v),P1);}return v;}};V.numericFormatter(d);}function X(v,f){var d=v.getModel();var k=v.getVizType();if(k!="line"&&k!="bubble"){return;}if(!f){f=k==="line"?"categoryAxis":"valueAxis";}var m=v.getModel('ovpCardProperties').getProperty("/entitySet");if(!d||!m){return;}var n=u1(d,m);var r=v.getFeeds();for(var i=0;i<r.length;i++){if(r[i].getUid()===f){var s=r[i].getValues();if(!s){return;}for(var j=0;j<s.length;j++){if(n[s[j][w.TYPE_KEY]]!="Edm.DateTime"){return;}}v.setVizProperties({categoryAxis:{title:{visible:false}}});return;}}}function Y(d,f,i,m,j,k){m=typeof m==="undefined"?false:m;var r=false;var n;if(!d&&m){L.error(j+y.CARD_ERROR+i+y.IS_MANDATORY);return r;}if(!d){L.warning(j+y.CARD_WARNING+i+y.IS_MISSING);r=true;return r;}n=f["@"+d];if(!n||typeof n!=="object"){var s=m?L.error:L.warning;s(j+y.CARD_ERROR+"in "+i+". (@"+d+" "+y.NOT_WELL_FORMED);return r;}if(k&&k==="sap.ovp.cards.v4.charts.analytical.analyticalChart"&&i==="Chart Annotation"&&(!n.ChartType||!n.ChartType.$EnumMember)){L.error(j+y.CARD_ERROR+y.MISSING_CHARTTYPE+y.CHART_ANNO);return r;}r=true;return r;}function Z(d){var r=false;if(!d){return r;}var s;var f;var i;var j;var k;var m;var n;var v="";var x;var K1=d.getView();if(K1){v="["+K1.getId()+"] ";}if(!(x=d.getCardPropertiesModel())){L.error(v+y.CARD_ERROR+"in "+y.CARD_CONFIG+y.NO_CARD_MODEL);return r;}n=x.getProperty("/entityType");var L1=d.getMetaModel();var M1=L1.getData().$Annotations[n.$Type];if(!n||u(n)){L.error(v+y.CARD_ERROR+"in "+y.CARD_ANNO);return r;}s=x.getProperty("/selectionAnnotationPath");f=x.getProperty("/chartAnnotationPath");j=x.getProperty("/presentationAnnotationPath");k=x.getProperty("/identificationAnnotationPath");m=x.getProperty("/dataPointAnnotationPath");i=x.getProperty("/contentFragment");r=Y(s,M1,"Selection Variant",false,v);r=Y(f,M1,"Chart Annotation",true,v,i)&&r;r=Y(j,M1,"Presentation Variant",false,v)&&r;r=Y(k,M1,"Identification Annotation",true,v)&&r;r=Y(m,M1,"Data Point",false,v)&&r;return r;}function $(d,f,v){}function _(d){return U.getConfig(d);}function a1(d,f,i,j){var r=false;var m;var k;var n;var s;var v;var x;if(!f.time||u(f.time)){return r;}if(!d){return r;}for(var K1=0;K1<d.length;K1++){if(!d[K1].Dimension||!(k=d[K1].Dimension.$PropertyPath)){return r;}m=u1(i,j);if(m&&m[k]){n=m[k][w.TYPE_KEY];s=m[k][w.DISPLAY_FORMAT_KEY];v=m[k][w.SEMANTICS_KEY];x=B(i,j,k);}if(n&&n.lastIndexOf("Edm.Date",0)===0){if(n.toLowerCase()==="edm.datetime"){if(s&&s.toLowerCase()==="date"){r=true;}}else{r=true;}}if(n==="Edm.String"&&(x||v&&S.indexOf(v)>-1)){r=true;}if(r){d.unshift(d.splice(K1,1)[0]);break;}}return r;}function b1(i,d,f){var r="";var j=_(d);var k,m;if(!j){return r;}r=j.default.type;k=i.getSetting("dataModel");m=i.getSetting('ovpCardProperties').getProperty("/entitySet");if(a1(f,j,k,m)){r=j.time.type;}return r;}b1.requiresIContext=true;function c1(d,j,k){if(!d.length){return;}var m=k==="dimension"?"Dimension":"Measure";var n=[];o(d,function(i,v){if(!v||!v[m]||!v[m].PropertyPath){L.error(y.INVALID_CHART_ANNO);return false;}n.push(v[m].PropertyPath);});var r=q.map(j.feeds,function(f){if(f.type===k){if(f.role){return f.role.split("|");}return[];}});r=q.grep(r,function(f,i){return(r?Array.prototype.indexOf.call(r,f):-1)===i;}).join(", ");L.error(y.CARD_ERROR+y.INVALID_REDUNDANT+k+"(s) "+n.join(", ")+". "+y.ALLOWED_ROLES+j.type+y.CHART_IS+r);}function d1(v,i){var d;if(v){if(v.String){d=v.String;}else if(v.Boolean||v.Bool){d=e1(v);}else{d=f1(v,i);}}return d;}function e1(v,d){if(v&&v.Boolean){if(v.Boolean.toLowerCase()==="true"){return true;}else if(v.Boolean.toLowerCase()==="false"){return false;}}else if(v&&v.Bool){if(v.Bool.toLowerCase()==="true"){return true;}else if(v.Bool.toLowerCase()==="false"){return false;}}return d;}function f1(v,i){var d;if(v){if(v.String){d=Number(v.String);}else if(v.Int){d=Number(v.Int);}else if(v.Decimal){d=Number(v.Decimal);}else if(v.Double){d=Number(v.Double);}else if(v.Single){d=Number(v.Single);}}if(i){var n=N.getFloatInstance({style:'short',minFractionDigits:2,maxFractionDigits:2});if(d){d=n.format(Number(d));}}return d;}function g1(i,d){function i1(x){if(x){if(x.Path){return"{path:'"+x.Path+"'}";}else{return d1(x);}}else{return"";}}var v=i[i.measureNames];if(d&&d.CriticalityCalculation&&d.CriticalityCalculation.ImprovementDirection){var s=d.CriticalityCalculation.ImprovementDirection.EnumMember;var f=i1(d.CriticalityCalculation.DeviationRangeLowValue);var j=i1(d.CriticalityCalculation.DeviationRangeHighValue);var k=i1(d.CriticalityCalculation.ToleranceRangeLowValue);var m=i1(d.CriticalityCalculation.ToleranceRangeHighValue);return a._calculateCriticalityState(v,s,f,j,k,m,a.criticalityConstants.StateValues);}else{var n=d.Criticality.EnumMember;var r=n?n.split("/"):[];if(r){return r[1];}}}function h1(d,m,f){var j,k;o(m,function(i,v){if(v["com.sap.vocabularies.Common.v1.Label"]&&v["com.sap.vocabularies.Common.v1.Label"].String===d.measureNames){j=v.name;return false;}else if(v["com.sap.vocabularies.Common.v1.Label"]&&v["com.sap.vocabularies.Common.v1.Label"].Path===d.measureNames){j=v.name;return false;}else if(v["sap:label"]===d.measureNames){j=v.name;return false;}});o(f,function(i,v){if(v.Measure.PropertyPath===j){if(!v.DataPoint||!v.DataPoint.AnnotationPath){return false;}k=v.DataPoint.AnnotationPath;return false;}});return k;}function i1(i,d){if(i){if(i.Path){return i.Path;}else{return d1(i,d);}}else{return"";}}function j1(m,d){function f(s,i){return s&&s.indexOf(i,s.length-i.length)!==-1;}var j=false;o(m,function(i,v){if(v.DataPoint&&v.DataPoint.AnnotationPath){var k=d[v.DataPoint.AnnotationPath.substring(1)];if(k&&k.CriticalityCalculation&&k.CriticalityCalculation.ImprovementDirection&&k.CriticalityCalculation.ImprovementDirection.EnumMember){var s=k.CriticalityCalculation.ImprovementDirection.EnumMember;var n=i1(k.CriticalityCalculation.DeviationRangeLowValue);var r=i1(k.CriticalityCalculation.DeviationRangeHighValue);var x=i1(k.CriticalityCalculation.ToleranceRangeLowValue);var K1=i1(k.CriticalityCalculation.ToleranceRangeHighValue);if(f(s,"Minimize")||f(s,"Minimizing")){if(K1&&r){j=true;return false;}else{L.warning(y.CARD_WARNING+y.INVALID_CRITICALITY);}}else if(f(s,"Maximize")||f(s,"Maximizing")){if(x&&n){j=true;return false;}else{L.warning(y.CARD_WARNING+y.INVALID_CRITICALITY);}}else if(f(s,"Target")){if(x&&n&&K1&&r){j=true;return false;}else{L.warning(y.CARD_WARNING+y.INVALID_CRITICALITY);}}}else if(k&&k.Criticality){j=true;return false;}else{L.warning(y.CARD_WARNING+y.INVALID_IMPROVEMENT_DIR);}}});if(j===true&&m.length>1){L.warning(y.CARD_WARNING+y.INVALID_SEMANTIC_MEASURES);}return j;}function k1(m,d,f,v){function i(O1,P1){return O1&&O1.indexOf(P1,O1.length-P1.length)!==-1;}var r=[null,null];var j=true;var k=m.Measure.PropertyPath;if(f[k]){if(f[k][w.LABEL_KEY_V4]){k=t1(f[k][w.LABEL_KEY_V4].String?f[k][w.LABEL_KEY_V4].String:f[k][w.LABEL_KEY_V4].Path,v,f);}else if(f[k][w.LABEL_KEY]){k=f[k][w.LABEL_KEY];}else if(k){k=k;}}var n=m.DataPoint.AnnotationPath;var s=d[n.substring(1)];if(!s.CriticalityCalculation||!s.CriticalityCalculation.ImprovementDirection||!s.CriticalityCalculation.ImprovementDirection.EnumMember){return r;}var x=s.CriticalityCalculation.ImprovementDirection.EnumMember;var K1=i1(s.CriticalityCalculation.DeviationRangeLowValue,j);var L1=i1(s.CriticalityCalculation.DeviationRangeHighValue,j);var M1=i1(s.CriticalityCalculation.ToleranceRangeLowValue,j);var N1=i1(s.CriticalityCalculation.ToleranceRangeHighValue,j);if(i(x,"Minimize")||i(x,"Minimizing")){if(N1&&L1){r[0]=h.getText("MINIMIZING_LESS",[k,N1]);r[1]=h.getText("MINIMIZING_MORE",[k,L1]);r[2]=h.getText("MINIMIZING_CRITICAL",[N1,k,L1]);}}else if(i(x,"Maximize")||i(x,"Maximizing")){if(M1&&K1){r[0]=h.getText("MAXIMISING_MORE",[k,M1]);r[1]=h.getText("MAXIMISING_LESS",[k,K1]);r[2]=h.getText("MAXIMIZING_CRITICAL",[K1,k,M1]);}}else if(i(x,"Target")){if(M1&&K1&&N1&&L1){r[0]=h.getText("TARGET_BETWEEN",[M1,k,N1]);r[1]=h.getText("TARGET_AROUND",[k,K1,L1]);r[2]=h.getText("TARGET_CRITICAL",[K1,k,M1,N1,L1]);}}return r;}function l1(m,v,d){if(v&&v.DataPoint&&v.DataPoint.AnnotationPath){var f=d[v.DataPoint.AnnotationPath.substring(1)];var i,j;if(f&&f.ValueFormat){i=f.ValueFormat;}else if(f&&f.NumberFormat){i=f.NumberFormat;}if(i&&i.NumberOfFractionalDigits&&i.NumberOfFractionalDigits.Int){j=i.NumberOfFractionalDigits.Int;if(m<Number(j)){m=Number(j);}}}return m;}function m1(m,v,d){if(v&&v.DataPoint&&v.DataPoint.AnnotationPath){var f=d[v.DataPoint.AnnotationPath.substring(1)];var s,i;if(f&&f.ValueFormat){s=f.ValueFormat;}else if(f&&f.NumberFormat){s=f.NumberFormat;}if(s){if(s.ScaleFactor&&s.ScaleFactor.Decimal){i=Number(s.ScaleFactor.Decimal);}else if(s.ScaleFactor&&s.ScaleFactor.Int){i=Number(s.ScaleFactor.Int);}if(!isNaN(i)){if(m===undefined){m=Number(i);}else if(m>Number(i)){m=Number(i);}}}}return m;}function n1(m,s){if(m&&m[s]&&(m[s]["Org.OData.Measures.V1.ISOCurrency"]||(m[s][w.SEMANTICS_KEY]&&m[s][w.SEMANTICS_KEY]===w.CURRENCY_CODE))){return true;}return false;}function o1(m,v,f){if(m[v[f].$PropertyPath].$Type===w.EDM_INT32){return true;}return false;}function p1(m,v,f){if(m[v[f].$PropertyPath].$Type===w.EDM_INT64){return true;}return false;}function q1(d,f,r,s){var x,K1,L1,M1,N1;var O1,P1,Q1,R1,S1,T1=false;var U1;var V1,W1,X1;var Y1,Z1=[],$1=[];var _1;var a2;var b2=s&&s.getView();var c2,d2;var e2=b2&&b2.getModel("ui");var f2=e2&&e2.getProperty("/chartSettings");x=d.getModel('ovpCardProperties');if(O.checkIfAPIIsUsed(s)){T1=x&&x.getData()&&x.getData().showDataLabel;}N1=f2?f2.showDataLabel:T1;O1=d.getVizType();P1=_();for(var g2 in P1){if((a2=P1[g2].reference)&&P1[a2]){var h2=p({},P1[a2]);P1[g2]=h2;}if(P1[g2].default.type===O1||(P1[g2].time&&P1[g2].time.type===O1)){Q1=P1[g2];break;}}if(!Q1){L.error(y.CARD_ERROR+"in "+y.CARD_CONFIG+y.CARD_CONFIG_ERROR+O1+" "+y.CARD_CONFIG_JSON);return;}if(!x){L.error(y.CARD_ERROR+"in "+y.CARD_CONFIG+y.NO_CARD_MODEL);return;}var i2=d.getModel();var j2=x.getProperty("/entitySet");if(!i2||!j2){return;}var k2=x.getProperty("/entityType").$Type;var l2=s.getMetaModel().getData().$Annotations[k2];var m2={"property":s.getMetaModel().getObject("/"+k2+"/")};K1=l.merge(true,{},l2,m2);if(!K1){L.error(y.CARD_ANNO_ERROR+"in "+y.CARD_ANNO);return;}var n2=u1(i2,j2);G1(i2,n2,k2);L1=x.getProperty("/chartAnnotationPath");if(!L1||!(M1=K1["@"+L1])){L.error(y.CARD_ANNO_ERROR+"in "+y.CARD_ANNO);return;}if(!(R1=M1.DimensionAttributes)||!R1.length){L.error(y.CHART_ANNO_ERROR+"in "+y.CHART_ANNO+" "+y.DIMENSIONS_MANDATORY);return;}var o2;if(!(S1=M1.MeasureAttributes)||!S1.length){L.error(y.CHART_ANNO_ERROR+"in "+y.CHART_ANNO+" "+y.MEASURES_MANDATORY);return;}else{var p2=S1[0].DataPoint?K1[S1[0].DataPoint.AnnotationPath.substring(1)]:null;var q2=p2&&p2.ValueFormat&&p2.ValueFormat.NumberOfFractionalDigits&&p2.ValueFormat.NumberOfFractionalDigits;o2=q2?q2:0;}_1=a1(R1,Q1,i2,j2);if(_1){Q1=Q1.time;}else{Q1=Q1.default;}var r2=x.getProperty("/ChartProperties")||x.getProperty("/chartProperties");if(x&&x.getProperty("/tabs")&&(r2===undefined)){c2=b2.byId("ovp_card_dropdown");d2=parseInt(c2.getSelectedKey(),10);r2=x.getProperty("/tabs")&&x.getProperty("/tabs")[d2-1]&&(x.getProperty("/tabs")[d2-1]["ChartProperties"]||x.getProperty("/tabs")[d2-1]["chartProperties"]);}var s2=false;var t2=o2>0?"tooltipNoScaleFormatter/"+o2.toString()+"/":'tooltipNoScaleFormatter/-1/';var u2=new b({formatString:t2});u2.connect(d.getVizUid());u2.connect(d.getVizUid());d._oOvpVizFrameTooltip=u2;[Q1.dimensions,Q1.measures].forEach(function(k,i){var m=i?S1:R1;var n=i?"measure(s)":"dimension(s)";if(k.min&&m.length<k.min){L.error(y.CARD_ERROR+"in "+O1+" "+y.CARD_LEAST+k.min+" "+n);s2=true;}if(k.max&&m.length>k.max){L.error(y.CARD_ERROR+"in "+O1+y.CARD_MOST+k.max+" "+n);s2=true;}});if(s2){return;}var v2=true;if(Q1.properties&&Q1.properties.hasOwnProperty("hideLabel")&&!Q1.properties["hideLabel"]){v2=false;}var w2=true;var x2=false;if(O1==='donut'){x2=true;}d.removeAllAggregation();U1={legend:{isScrollable:false},title:{visible:false},interaction:{noninteractiveMode:w2?false:true,selectability:{legendSelection:x2?true:false,axisLabelSelection:false,mode:'EXCLUSIVE',plotLassoSelection:false,plotStdSelection:true},zoom:{enablement:'disabled'}},plotArea:{window:{start:'firstDataPoint',end:'lastDataPoint'},dataLabel:{visible:N1||x2?true:false,type:'value'},dataPoint:{invalidity:'ignore'},alignment:{vertical:'top'}},categoryAxis:{label:{truncatedLabelRatio:0.15}},general:{groupData:false,showAsUTC:true}};if(Q1.properties&&Q1.properties.semanticColor===true&&j1(S1,K1)){var y2=h.getText("GOOD");var z2=h.getText("BAD");var A2=h.getText("CRITICAL");var B2=h.getText("OTHERS");if(S1.length===1){var C2=k1(S1[0],K1,n2,d);var y2=C2[0]||y2,z2=C2[1]||z2,A2=C2[2]||A2,B2=h.getText("OTHERS");}U1.plotArea.dataPointStyle={rules:[{callback:function(k){var m=h1(k,n2,S1);if(!m){return false;}var n=K1[m.substring(1)];var v=g1(k,n);if(v===a.criticalityConstants.StateValues.Positive){return true;}else if(v==="Positive"){return true;}},properties:{color:"sapUiChartPaletteSemanticGoodLight1"},"displayName":y2},{callback:function(k){var m=h1(k,n2,S1);if(!m){return false;}var n=K1[m.substring(1)];var v=g1(k,n);if(v===a.criticalityConstants.StateValues.Critical){return true;}else if(v==="Critical"){return true;}},properties:{color:"sapUiChartPaletteSemanticCriticalLight1"},"displayName":A2},{callback:function(k){var m=h1(k,n2,S1);if(!m){return false;}var n=K1[m.substring(1)];var v=g1(k,n);if(v===a.criticalityConstants.StateValues.Negative){return true;}else if(v==="Negative"){return true;}},properties:{color:"sapUiChartPaletteSemanticBadLight1"},"displayName":z2},{callback:function(k){var m=h1(k,n2,S1);if(!m){return false;}var n=K1[m.substring(1)];var v=g1(k,n);if(v===a.criticalityConstants.StateValues.None){return true;}else if(v==="Neutral"){return true;}},properties:{color:"sapUiChartPaletteSemanticNeutralLight1"},"displayName":B2}]};}var D2=x.getProperty("/bEnableStableColors");var E2=x.getProperty("/colorPalette");var F2;if(!D2&&z.indexOf(M1.ChartType.$EnumMember)>=0&&E2&&Object.keys(E2).length>=2&&Object.keys(E2).length<=4){o(R1,function(i,k){if(k&&k.Role&&k.Role.$EnumMember==="com.sap.vocabularies.UI.v1.ChartDimensionRoleType/Series"){F2=k.Dimension&&k.Dimension.$PropertyPath;return;}});var G2;if(F2){if(n2&&n2[F2]){if(n2[F2][w.LABEL_KEY_V4]){G2=t1(n2[F2][w.LABEL_KEY_V4]?n2[F2][w.LABEL_KEY_V4]:n2[F2][w.LABEL_KEY_V4].Path,d,n2);}else if(n2[F2][w.LABEL_KEY]){G2=n2[F2][w.LABEL_KEY];}else if(F2){G2=F2;}}if(E2 instanceof Array){var H2=E2.map(function(v){return v.color;});var I2=E2.map(function(v){return v.legendText;});var J2=I2[0]!=undefined?I2[0]:h.getText("OTHERS");var K2=I2[1]!=undefined?I2[1]:h.getText("BAD");var L2=I2[2]!=undefined?I2[2]:h.getText("CRITICAL");var M2=I2[3]!=undefined?I2[3]:h.getText("GOOD");}U1.plotArea.dataPointStyle={rules:[{callback:function(k){if(k&&(k[G2]==="3"||k[G2]===3)){if(E2 instanceof Array){if(E2.length<4){return false;}}else if(E2&&!E2.hasOwnProperty(3)){return false;}return true;}},properties:{color:E2 instanceof Array&&H2.length?H2[3]:E2[3]&&E2[3]["color"]},"displayName":M2||E2[3]&&E2[3]["legendText"]},{callback:function(k){if(k&&(k[G2]==="2"||k[G2]===2)){if(E2 instanceof Array){if(E2.length<3){return false;}}else if(E2&&!E2.hasOwnProperty(2)){return false;}return true;}},properties:{color:E2 instanceof Array&&H2.length?H2[2]:E2[2]&&E2[2]["color"]},"displayName":L2||E2[2]&&E2[2]["legendText"]},{callback:function(k){if(k&&(k[G2]==="1"||k[G2]===1)){return true;}},properties:{color:E2 instanceof Array&&H2.length?H2[1]:E2[1]&&E2[1]["color"]},"displayName":K2||E2[1]&&E2[1]["legendText"]},{callback:function(k){if(k&&(k[G2]==="0"||k[G2]===0)){return true;}},properties:{color:E2 instanceof Array&&H2.length?H2[0]:E2[0]&&E2[0]["color"]},"displayName":J2||E2[0]&&E2[0]["legendText"]}]};}}var N2=false;var O2=false;if(M1.ChartType.$EnumMember===w.SCATTER_CHARTTYPE||M1.ChartType.$EnumMember===w.BUBBLE_CHARTTYPE||M1.ChartType.$EnumMember===w.LINE_CHARTTYPE){if(M1&&M1.AxisScaling&&M1.AxisScaling.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisScalingType"){var P2=M1.AxisScaling;if(P2.AutoScaleBehavior&&P2.AutoScaleBehavior.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisAutoScaleBehaviorType"){var Q2=P2.AutoScaleBehavior;if(Q2.ZeroAlwaysVisible&&Q2.ZeroAlwaysVisible=="true"){U1.plotArea.adjustScale=false;N2=true;}else if(Q2.DataScope){U1.plotArea.adjustScale=true;N2=true;}}else if(P2.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisScalingType"&&P2.ScaleBehavior&&P2.ScaleBehavior.$EnumMember){var R2=P2.ScaleBehavior.$EnumMember;var S2=R2.substring(R2.lastIndexOf('/')+1,R2.length);if(S2=="FixedScale"){O2=true;}}}else if(M1&&M1.AxisScaling&&M1.AxisScaling.$EnumMember){var T2=M1.AxisScaling.$EnumMember.substring(M1.AxisScaling.$EnumMember.lastIndexOf('/')+1,M1.AxisScaling.$EnumMember.length);switch(T2){case"AdjustToDataIncluding0":U1.plotArea.adjustScale=false;N2=true;break;case"AdjustToData":U1.plotArea.adjustScale=true;N2=true;break;case"MinMaxValues":O2=true;break;default:break;}}if(O2){var U2=[];if(M1["MeasureAttributes"][0]&&M1["MeasureAttributes"][0].DataPoint&&M1["MeasureAttributes"][0].DataPoint.AnnotationPath){var V2=M1["MeasureAttributes"][0].DataPoint.AnnotationPath;var W2=V2.substring(V2.lastIndexOf('@')+1,V2.length);if(K1&&K1[W2]){var X2=K1[W2];if(X2&&X2.MaximumValue&&X2.MaximumValue&&X2.MinimumValue&&X2.MinimumValue){U2.push({feed:"valueAxis",max:X2.MaximumValue,min:X2.MinimumValue});N2=true;}else{L.error(y.ERROR_MISSING_AXISSCALES);}}}if(M1.ChartType.$EnumMember!==w.LINE_CHARTTYPE&&M1["MeasureAttributes"][1]&&M1["MeasureAttributes"][1].DataPoint&&M1["MeasureAttributes"][1].DataPoint.AnnotationPath){var V2=M1["MeasureAttributes"][1].DataPoint.AnnotationPath;var W2=V2.substring(V2.lastIndexOf('@')+1,V2.length);if(K1&&K1[W2]){var X2=K1[W2];if(X2&&X2.MaximumValue&&X2.MaximumValue&&X2.MinimumValue&&X2.MinimumValue){U2.push({feed:"valueAxis2",max:X2.MaximumValue,min:X2.MinimumValue});N2=true;}else{L.error(y.ERROR_MISSING_AXISSCALES);}}}d.setVizScales(U2);}}W1=R1.slice();X1=S1.slice();var Y2=0;var Z2=0;var $2;var _2;var a3=false;var b3=false;var c3;var d3=[];var e3=[],f3=[];if((O1==="column"||O1==="bar"||O1==="vertical_bullet")&&Q1.feeds&&(Q1.feeds.length>0)){var g3;for(g3=0;g3<Q1.feeds.length;g3++){if(Q1.feeds[g3].uid==="color"){Q1.feeds.splice(g3,1);break;}}for(g3=0;g3<Q1.feeds.length;g3++){if(Q1.feeds[g3].uid==="categoryAxis"){delete Q1.feeds[g3].role;break;}}if(x.getProperty("/colorPalette")){for(g3=0;g3<Q1.feeds.length;g3++){if(Q1.feeds[g3].uid==="categoryAxis"){Q1.feeds[g3].role="Category";break;}}Q1.feeds.push({"uid":"color","min":1,"type":"dimension","role":"Series"});}}o(Q1.feeds,function(i,m){var n=m.uid;var v=[];if(m.type){var E3,F3,G3;if(m.type==="dimension"){E3=R1.length;F3="Dimension";G3="dimensions";V1=W1;Y1=Z1;}else{E3=S1.length;F3="Measure";G3="measures";V1=X1;Y1=$1;}var H3=0,I3=E3;if(m.min){H3=H3>m.min?H3:m.min;}if(m.max){I3=I3<m.max?I3:m.max;}if(!m.role){var J3=V1.length;for(var j=0;j<J3&&v.length<I3;++j){var K3=V1[j];V1.splice(j,1);--J3;--j;v.push(K3);if(n2[K3[F3].$PropertyPath][w.UNIT_KEY_V4_ISOCurrency]){c3=n2[K3[F3].$PropertyPath][w.UNIT_KEY_V4_ISOCurrency].$Path?n2[K3[F3].$PropertyPath][w.UNIT_KEY_V4_ISOCurrency].$Path:undefined;}else if(n2[K3[F3].$PropertyPath][w.UNIT_KEY_V4_Unit]){c3=n2[K3[F3].$PropertyPath][w.UNIT_KEY_V4_Unit].$Path?n2[K3[F3].$PropertyPath][w.UNIT_KEY_V4_Unit].$Path:undefined;}else if(n2[K3[F3].$PropertyPath][w.UNIT_KEY]){c3=n2[K3[F3].$PropertyPath][w.UNIT_KEY];}if(n1(n2,c3)){a3=true;}else{b3=true;}if(!a3){Y2=l1(Y2,K3,K1);$2=m1($2,K3,K1);}else{Z2=l1(Z2,K3,K1);_2=m1(_2,K3,K1);}}}else{var L3=m.role.split("|");o(L3,function(j,c4){if(v.length===I3){return false;}var J3=V1.length;for(var k=0;k<J3&&v.length<I3;++k){var K3=V1[k];if(K3&&K3.Role&&K3.Role.$EnumMember&&K3.Role.$EnumMember.split("/")&&K3.Role.$EnumMember.split("/")[1]){var d4=K3.Role.$EnumMember.split("/")[1];if(d4===c4){V1.splice(k,1);--J3;--k;v.push(K3);if(n2[K3[F3].$PropertyPath][w.UNIT_KEY_V4_ISOCurrency]){c3=n2[K3[F3].$PropertyPath][w.UNIT_KEY_V4_ISOCurrency].$Path?n2[K3[F3].$PropertyPath][w.UNIT_KEY_V4_ISOCurrency].$Path:undefined;}else if(n2[K3[F3].$PropertyPath][w.UNIT_KEY_V4_Unit]){c3=n2[K3[F3].$PropertyPath][w.UNIT_KEY_V4_Unit].$Path?n2[K3[F3].$PropertyPath][w.UNIT_KEY_V4_Unit].$Path:undefined;}else if(n2[K3[F3].$PropertyPath][w.UNIT_KEY]){c3=n2[K3[F3].$PropertyPath][w.UNIT_KEY];}if(n1(n2,c3)){a3=true;}else{b3=true;}if(!a3){Y2=l1(Y2,K3,K1);$2=m1($2,K3,K1);}else{Z2=l1(Z2,K3,K1);_2=m1(_2,K3,K1);}}}else if((Y1?Array.prototype.indexOf.call(Y1,K3):-1)===-1){Y1.push(K3);}}});if(v.length<I3){o(Y1,function(k,K3){var c4;var g3;if((c4=Q1[G3].defaultRole)&&((L3?Array.prototype.indexOf.call(L3,c4):-1)!==-1)&&(g3=(V1?Array.prototype.indexOf.call(V1,K3):-1)!==-1)){V1.splice(g3,1);v.push(K3);if(n2[K3[F3].$PropertyPath][w.UNIT_KEY_V4_ISOCurrency]){c3=n2[K3[F3].$PropertyPath][w.UNIT_KEY_V4_ISOCurrency].$Path?n2[K3[F3].$PropertyPath][w.UNIT_KEY_V4_ISOCurrency].$Path:undefined;}else if(n2[K3[F3].$PropertyPath][w.UNIT_KEY_V4_Unit]){c3=n2[K3[F3].$PropertyPath][w.UNIT_KEY_V4_Unit].$Path?n2[K3[F3].$PropertyPath][w.UNIT_KEY_V4_Unit].$Path:undefined;}else if(n2[K3[F3].$PropertyPath][w.UNIT_KEY]){c3=n2[K3[F3].$PropertyPath][w.UNIT_KEY];}if(n1(n2,c3)){a3=true;}else{b3=true;}if(!a3){Y2=l1(Y2,K3,K1);$2=m1($2,K3,K1);}else{Z2=l1(Z2,K3,K1);_2=m1(_2,K3,K1);}if(v.length===I3){return false;}}});}if(v.length<H3){L.error(y.CARD_ERROR+y.MIN_FEEDS+O1+" "+y.FEEDS_OBTAINED+v.length+" "+y.FEEDS_REQUIRED+H3+" "+y.FEEDS);return false;}}if(v.length){var M3=[];var N3;if(!(N3=d.getDataset())){L.error(y.NO_DATASET);return false;}G=K1;o(v,function(i,K3){if(!K3||!K3[F3]||!K3[F3].$PropertyPath){L.error(y.INVALID_CHART_ANNO);return false;}var k=K3[F3].$PropertyPath;var G2=k;var c4=k;var d4=null;if(n2&&n2[k]){if(n2[k]["annotations"]){if(n2[k]["annotations"]["@"+w.LABEL_KEY_V4]){if(n2[k]["annotations"]["@"+w.LABEL_KEY_V4]instanceof String&&n2[k]["annotations"]["@"+w.LABEL_KEY_V4]){G2=t1(n2[k]["annotations"]["@"+w.LABEL_KEY_V4],d,n2);}else if(n2[k]["annotations"]["@"+w.LABEL_KEY_V4].$Path){G2=n2[k]["annotations"]["@"+w.LABEL_KEY_V4].$Path;}else{G2=n2[k]["annotations"]["@"+w.LABEL_KEY_V4];}}else if(n2[k]["annotations"]["@"+w.LABEL_KEY]){G2=n2[k]["annotations"]["@"+w.LABEL_KEY];}else if(k){G2=k;}if(n2[k]["annotations"]["@"+w.TEXT_KEY_V4]){c4=n2[k]["annotations"]["@"+w.TEXT_KEY_V4]?n2[k]["annotations"]["@"+w.TEXT_KEY_V4]:n2[k]["annotations"]["@"+w.TEXT_KEY_V4].$Path;}else if(n2[k]["annotations"]["@"+w.TEXT_KEY]){c4=n2[k]["annotations"]["@"+w.TEXT_KEY];}}else if(k){c4=k;}d4=n2[k].$Type||null;}var e4;if((d4==="Edm.DateTime"||d4==="Edm.DateTimeOffset")&&c4===k){e4="{path:'"+k+"', formatter: 'sap.ovp.cards.v4.charts.VizAnnotationManager.returnDateFormat'}";}else{if(n2[k]&&n2[k]["annotations"]&&n2[k]["annotations"]["@"+w.TEXT_KEY_V4]&&n2[k]["annotations"]["@"+w.TEXT_KEY_V4+"@"+w.TEXT_ARRANGEMENT_ANNO]){var f4,g4;f4=n2[k]["annotations"]["@"+w.TEXT_KEY_V4+"@"+w.TEXT_ARRANGEMENT_ANNO];g4=f4&&f4.$EnumMember;if(!g4){f4=n2[k]["annotations"]["@"+w.TEXT_KEY_V4]["@"+w.TEXT_ARRANGEMENT_ANNO];g4=f4&&f4.$EnumMember;}if(!g4){var h4=G;f4=h4&&h4["@"+w.TEXT_ARRANGEMENT_ANNO];g4=f4&&f4.$EnumMember;}switch(g4){case"com.sap.vocabularies.UI.v1.TextArrangementType/TextFirst":e4="{"+c4.$Path+"}"+" "+"("+"{"+k+"}"+")";break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextLast":e4="{"+k+"}"+" "+"("+"{"+c4.$Path+"}"+")";break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly":e4="{"+c4.$Path+"}";break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextSeperate":e4="{"+k+"}"+" "+"("+"{"+c4.$Path+"}"+")";break;default:e4="{"+k+"}";break;}}else{e4="{"+c4+"}";}}M3.push(G2);if(F3==="Dimension"){if(n==="waterfallType"){var i4=new e({name:G2,value:"{"+k+"}"});}else{var i4=new e({name:G2,value:"{"+k+"}",displayValue:e4});}var j4=n2[k][w.SEMANTICS_KEY];var k4=B(d.getModel(),j2,k);if(_1&&(d4==="Edm.DateTime"||k4||d4==="Edm.DateTimeOffset"||(j4&&j4.lastIndexOf("year",0)===0))){i4.setDataType("date");}N3.addDimension(i4);if((f3?Array.prototype.indexOf.call(f3,G2):-1)===-1){f3.push(G2);}}else{N3.addMeasure(new M({name:G2,value:"{"+k+"}"}));if(((e3?Array.prototype.indexOf.call(e3,G2):-1)===-1)&&(n!="bubbleWidth")){e3.push(G2);}}});d.addFeed(new F({'uid':n,'type':F3,'values':M3}));if(n==="categoryAxis"){U1[n]={title:{visible:v2?false:true,text:M3.join(", ")},label:{formatString:a3?'CURR':'axisFormatter',truncatedLabelRatio:0.15}};}else{U1[n]={title:{visible:v2?false:true,text:M3.join(", ")},label:{formatString:a3?'CURR':'axisFormatter'}};}d3.push(U1[n]);if(Q1.hasOwnProperty("vizProperties")){var O3=0;var P3=Q1.vizProperties.length;var Q3;var R3;for(;O3<P3;O3++){if(Q1.vizProperties[O3].hasOwnProperty("value")){R3=Q1.vizProperties[O3].value;}if(Q1.vizProperties[O3].hasOwnProperty("path")){Q3=(Q1.vizProperties[O3].path).split(".");var S3=Q3.length;var T3,U3;var V3;for(var W3=0,V3=Q3[0],T3=U1,U3=r2;W3<S3;++W3){if(W3===S3-1){if(U3&&U3.hasOwnProperty(V3)){if(O1==='donut'&&(U3[V3]==="value"||U3[V3]==="percentage")){R3=U3[V3];}else if(O1!='donut'){R3=U3[V3];}}if((N2&&(V3!="adjustScale"))||(!N2&&(V3==="adjustScale"))||(!N2&&(V3!="adjustScale"))){T3[V3]=R3;}break;}T3[V3]=T3[V3]||{};T3=T3[V3];if(U3){U3[V3]=U3[V3]||{};U3=U3[V3];}V3=Q3[W3+1];}}}}if(m.hasOwnProperty("vizProperties")){var i=0;var X3=m.vizProperties.length;var Y3;var Z3;var $3;for(;i<X3;i++){if(m.vizProperties[i].hasOwnProperty("method")){Z3=m.vizProperties[i].method;switch(Z3){case'count':Y3=M3.length;if(m.vizProperties[i].hasOwnProperty("min")&&Y3<=m.vizProperties[i].min){Y3=m.vizProperties[i].min;}else if(m.vizProperties[i].hasOwnProperty("max")&&Y3>=m.vizProperties[i].max){Y3=m.vizProperties[i].max;}break;default:break;}}else if(m.vizProperties[i].hasOwnProperty("value")){Y3=m.vizProperties[i].value;}if(m.vizProperties[i].hasOwnProperty("path")){$3=(m.vizProperties[i].path).split(".");var _3=$3.length;for(var j=0,a4=$3[0],b4=U1;j<_3;++j){if(j===_3-1){b4[a4]=Y3;break;}b4[a4]=b4[a4]||{};b4=b4[a4];a4=$3[j+1];}}}}}}});var h3=d.getFeeds();if(Q1.properties&&Q1.properties.semanticPattern===true&&Q(h3,O1)){o(h3,function(i,v){if(h3[i].getType()==='Measure'&&((h3[i].getUid()==='valueAxis')||(h3[i].getUid()==='actualValues'))){var k;o(S1,function(g3,I3){var J3=P(I3.Measure.$PropertyPath,n2);if(J3===h3[i].getValues()[0]){k=J(I3,K1);return false;}});if(k){var m=P(k.Measure.$PropertyPath,n2);var n=(K1[k.DataPoint.AnnotationPath.substring(1)].ForecastValue.PropertyPath||K1[k.DataPoint.AnnotationPath.substring(1)].ForecastValue.Path);var E3=P(n,n2);var F3=h.getText("ACTUAL",[m]);var G3=h.getText("FORECAST",[E3]);U1.plotArea.dataPointStyle={rules:[{dataContext:{MeasureNamesDimension:m},properties:{color:"sapUiChartPaletteSequentialHue1Light1",lineType:"line",lineColor:"sapUiChartPaletteSequentialHue1Light1"},displayName:F3},{dataContext:{MeasureNamesDimension:E3},properties:{color:"sapUiChartPaletteSequentialHue1Light1",lineType:"dotted",lineColor:"sapUiChartPaletteSequentialHue1Light1",pattern:"diagonalLightStripe"},displayName:G3}]};d.getDataset().addMeasure(new M({name:E3,value:"{"+n+"}"}));var H3=h3[i].getValues();H3.push(E3);h3[i].setValues(H3);}return false;}});}var i3=false;if(E2&&E2.dimensionSettings&&Object.keys(E2.dimensionSettings).length>0){var j3=Object.keys(E2.dimensionSettings);for(var i=0;i<j3.length;i++){var k3=j3[i];var l3=E2.dimensionSettings[k3];if(Object.keys(l3).length>10){i3=true;break;}}}if(D2&&A.indexOf(M1.ChartType.$EnumMember)>=0&&!Boolean(i3)){var m3=[];var n3=true;for(var i=0;i<R1.length;i++){var o3=R1[i].Dimension.$PropertyPath;m3.push(o3);}for(var i=0;i<m3.length;i++){var k3=m3[i];if(j3.indexOf(k3)>-1){var p3=E2.dimensionSettings[k3];var q3=Object.keys(p3);var r3=[];for(var i=0;i<q3.length;i++){var s3=p3[q3[i]];r3.push(s3);}n3=n3&&r3.every(I1);}}if(n3){var t3=[];for(var i=0;i<m3.length;i++){var k3=m3[i];if(j3.indexOf(k3)>-1){var p3=E2.dimensionSettings[k3];var q3=Object.keys(p3);var r3=[];for(var i=0;i<q3.length;i++){var s3=p3[q3[i]];r3.push(s3);}H1(r3);for(var j=0;j<r3.length;j++){var u3=r3[j].dimensionValue;var v3=r3[j].color;var s3={"properties":{"color":v3}};s3.dataContext={};var w3=r1(n2,d,k3);s3.dataContext[w3]=u3;s3.displayName=u3;t3.push(s3);}}}U1.plotArea.dataPointStyle=U1.plotArea.dataPointStyle||{};U1.plotArea.dataPointStyle["rules"]=t3;}else{var t3=[];for(var i=0;i<m3.length;i++){var k3=m3[i];if(j3.indexOf(k3)>-1){var p3=E2.dimensionSettings[k3];var q3=Object.keys(p3);var r3=[];for(var i=0;i<q3.length;i++){var s3=p3[q3[i]];r3.push(s3);}H1(r3);var x3=r3.map(J1);}}U1.legend.order=function(m,n){var k=x3.indexOf(m);var v=x3.indexOf(n);return k>v?1:-1;};}}if(Q1.properties&&Q1.properties.semanticPattern===true&&Q(h3,O1)&&d.getVizType()==="vertical_bullet"){o(h3,function(i,v){if(h3[i].getType()==='Measure'&&((h3[i].getUid()==='valueAxis')||(h3[i].getUid()==='actualValues'))){var k;o(S1,function(g3,E3){var F3=P(E3.Measure.PropertyPath,n2);if(F3===h3[i].getValues()[0]){k=K(E3,K1);return false;}});if(k){var m=(K1[k.DataPoint.AnnotationPath.substring(1)].TargetValue.PropertyPath||K1[k.DataPoint.AnnotationPath.substring(1)].TargetValue.Path);var n=P(m,n2);d.getDataset().addMeasure(new M({name:n,value:"{"+m+"}"}));d.addFeed(new F({'uid':"targetValues",'type':"Measure",'values':[n]}));}return false;}});}if(a3&&b3){L.warning(h.getText("Currency_non_currency_measure"));}o(h3,function(i,k){var m=k.getProperty("type");if(m==="Measure"){var n=k.getProperty("values");var v=true;var E3=M1.MeasureAttributes.filter(function(F3){var G3=F3[m].$PropertyPath;var H3=n2[G3];return Object.keys(H3).length>0&&n.indexOf(G3)>=0;});o(E3,function(j,F3){if(o1(n2,F3,m)||p1(n2,F3,m)){v=false;}else{v=true;return false;}});if(!v){U1[k.getProperty('uid')]['label']['allowDecimals']=false;}}});var y3;if(_2===undefined){_2="";}if($2===undefined){$2="";}if(a3){y3=w1(_2,a3);}else{y3=w1($2,a3);}if(f){f.setScale(y3);}v1(e3,f3,r);var z3="";o(h3,function(i,k){var m="-1";var n=k.getProperty("type");if(n==="Measure"){var v=d3.filter(function(G3){var H3=G3["title"]["text"].split(",").filter(function(I3){if(k.getValues().indexOf(I3.trim())>=0){return true;}else{return false;}});if(H3.length>0){return true;}else{return false;}});if(v&&v.length){var E3=k.getValues();if(E3&&E3.length){o(E3,function(i,G3){var H3=G3.trim();var I3=S1.filter(function(M3){if(M3["Measure"]&&M3["Measure"]["PropertyPath"]){var N3=M3["Measure"]["PropertyPath"];if((n2[N3]&&n2[N3][w.LABEL_KEY]===H3)||(n2[N3]&&n2[N3][w.LABEL_KEY_V4]===H3)){return true;}else{return false;}}});if(I3&&I3.length){var J3=I3[0];if(!o1(n2,J3,n)&&!p1(n2,J3,n)){var K3="";if(J3&&J3["DataPoint"]&&J3["DataPoint"]["AnnotationPath"]&&J3["DataPoint"]["AnnotationPath"]){K3=J3["DataPoint"]["AnnotationPath"]&&J3["DataPoint"]["AnnotationPath"].substring(1);if(K3!=""){var L3;L3=K1[K3]&&K1[K3]["ValueFormat"]&&K1[K3]["ValueFormat"]["NumberOfFractionalDigits"]&&K1[K3]["ValueFormat"]["NumberOfFractionalDigits"]["Int"];m=L3>m?L3:m;}}}else{m=m<"0"?"0":m;}}});}}if(v&&v[0]&&v[0].label&&v[0].label.formatString){var F3=v[0].label.formatString;}z3="";if(a3){if(F3==='CURR'){z3='CURR/'+m.toString()+"/";}else{z3='axisFormatter/'+m.toString()+"/";}}else{z3='axisFormatter/'+m.toString()+"/";}if(v&&v[0]){v[0].label.formatString=z3;}}});if(O1==="vertical_bullet"){U1["valueAxis"]={title:{visible:v2?false:true},label:{formatString:z3}};}var A3="";var B3="";if(a3){A3=Z2.toString();B3='CURR/'+Z2.toString()+"/";}else{A3=Y2.toString();B3='axisFormatter/'+Y2.toString()+"/";}if(O1==="donut"||N1){if(O1==="donut"){U1.legendGroup={layout:{height:0.1}};}U1.plotArea.dataLabel.formatString=B3;if(U1.plotArea.dataLabel.type==="percentage"){U1.plotArea.dataLabel.formatString="0.0%/"+A3+"/";}}c1(W1,Q1,"dimension");c1(X1,Q1,"measure");if(_1){var C3=R1[0].Dimension.$PropertyPath;var D3=d.getModel().getMetaModel().getObject("/"+j2+"/"+C3+"@");if(D3["@com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]){U1.timeAxis.levels=["year","month"];}else if(D3["@com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]){U1.timeAxis.levels=["year","quarter"];}else if(D3["@com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]){U1.timeAxis.levels=["year","week"];}else if(D3["@com.sap.vocabularies.Common.v1.IsCalendarYear"]){U1.timeAxis.levels=["year"];}}d.setVizProperties(U1);}function r1(m,v,d){var f="";if(m&&m[d]){if(m[d][w.LABEL_KEY_V4]){f=t1(m[d][w.LABEL_KEY_V4].String?m[d][w.LABEL_KEY_V4].String:m[d][w.LABEL_KEY_V4].Path,v,m);}else if(m[d][w.LABEL_KEY]){f=m[d][w.LABEL_KEY];}else if(d){f=d;}}return f;}function s1(v,d,f,j){if(v&&(v.getVizType()==="bubble"||v.getVizType()==="scatter")){return;}var k,n,r,s;var x;var K1=w.UNIT_KEY;var L1=w.UNIT_KEY_V4_ISOCurrency;var M1=w.UNIT_KEY_V4_Unit;var N1;var O1=[];if(!(k=v.getModel('ovpCardProperties'))){L.error(y.CARD_ERROR+"in "+y.CARD_CONFIG+y.NO_CARD_MODEL);return;}var P1=v.getModel();var Q1=k.getProperty("/entitySet");if(!P1||!Q1){return;}n=j[k.getProperty("/entityType").$Type];if(!n){L.error(y.CARD_ANNO_ERROR+"in "+y.CARD_ANNO);return;}var R1=u1(P1,Q1);r=k.getProperty("/chartAnnotationPath");if(!r||!(s=n["@"+r])){L.error(y.CARD_ANNO_ERROR+"in "+y.CARD_ANNO);return;}if(!(x=s.MeasureAttributes)||!x.length){L.error(y.CHART_ANNO_ERROR+"in "+y.CHART_ANNO+" "+y.MEASURES_MANDATORY);return;}o(x,function(i,m){N1=m.Measure.$PropertyPath;if(m.DataPoint&&m.DataPoint.AnnotationPath){var $1=n[m.DataPoint.AnnotationPath.substring(1)];if($1.ForecastValue&&($1.ForecastValue.PropertyPath||$1.ForecastValue.Path)){O1.push(($1.ForecastValue.PropertyPath||$1.ForecastValue.Path));}}O1.push(N1);});var S1=d?d:null;var T1="";var U1=true;var V1=[];var W1=v.getFeeds();o(W1,function(i,m){if(m.getType()==="Measure"){V1=V1.concat(m.getValues());}});if(S1){o(O1,function(i,m){var $1=r1(R1,v,m);if((V1?Array.prototype.indexOf.call(V1,$1):-1)!=-1){if(R1&&R1[m]){var _1;if(R1[m][L1]){_1=R1[m][L1].Path?R1[m][L1].Path:R1[m][L1].String;}else if(R1[m][M1]){_1=R1[m][M1].Path?R1[m][M1].Path:R1[m][M1].String;}else if(R1[m][K1]){_1=R1[m][K1];}if(!_1){U1=false;return false;}if(_1&&R1[_1]){for(var i=0;i<S1.length;i++){var a2=S1[i];if(U1){if(T1&&a2[_1]&&(a2[_1]!="")&&(T1!="")&&(T1!=a2[_1])){U1=false;break;}}T1=a2[_1];}}}}});}var X1="";if(U1){if(T1!=""){X1=h.getText("IN_NO_SCALE",[T1]);X1=" "+X1;}if(f){f.setText(X1);f.data("aria-label",X1,true);var Y1=v.data("aria-label");if(Y1&&X1&&Y1.indexOf(X1)===-1){var Z1=Y1+X1;v.data("aria-label",Z1,true);}}}}function t1(f,v,m){var r;var s;var d;if(f&&f.indexOf("{")===0){f=f.slice(1,-1);if(f.indexOf(">")!=-1){d=f.split(">");r=d[0];s=d[1];}else if(f.indexOf("&gt;")!=-1){d=f.split("&gt;");r=d[0];s=d[1];}try{f=v.getModel(r).getProperty(s);}catch(i){f=m[f][w.LABEL_KEY_V4].String;L.error("Unable to read labels from resource file",i);}}return f;}function u1(m,d){var f=U.cacheODataMetadata(m);if(!f){return undefined;}return f[d];}function v1(m,d,f){var j="",k="",n="";if(f){j=f.getText();}if(m&&(m.length>1)){for(var i=0;i<m.length-1;i++){if(k!=""){k+=", ";}k+=m[i];}k=h.getText("MEAS_DIM_TITLE",[k,m[i]]);}else if(m){k=m[0];}if(d&&(d.length>1)){for(var i=0;i<d.length-1;i++){if(n!=""){n+=", ";}n+=d[i];}n=h.getText("MEAS_DIM_TITLE",[n,d[i]]);}else if(d){n=d[0];}if(f&&(j==="")){j=h.getText("NO_CHART_TITLE",[k,n]);f.setText(j);f.data("aria-label",j,true);}}function w1(m,i){var n=1;var s;if(i){var d=N.getCurrencyInstance({style:'short',currencyCode:false,shortRefNumber:m});s=d.format(Number(n));}else{var f=N.getFloatInstance({style:'short',shortRefNumber:m});s=f.format(Number(n));}var j=s.slice(-1);return j;}function x1(v,d){v.attachSelectData(function(f){var n=l.bCRTLPressed?l.constants.explace:l.constants.inplace;l.bCRTLPressed=false;var m=v.getModel('ovpCardProperties');var s=v.getModel();var K1=m.getProperty("/entitySet");var L1=u1(s,K1);var M1=[],N1=[];var O1={},P1={};var Q1=v.getDataset().getDimensions();var R1;var S1=m.getProperty("/entityType");var T1=d.getMetaModel().getData()["$Annotations"];for(var i=0;i<Q1.length;i++){M1.push(Q1[i].getName());}var U1=v.getDataset().getBinding("data").getCurrentContexts().map(function(x){return x.getObject();});if(f.getParameter("data")&&f.getParameter("data")[0]&&f.getParameter("data")[0].data){N1=Object.keys(f.getParameter("data")[0].data);R1=f.getParameter("data")[0].data._context_row_number;var V1=v.getDataset().getBinding("data").getContexts()[R1];var W1=d.getEntityNavigationEntries(V1)[0];if(U1[R1].$isOthers&&U1[R1].$isOthers===true){var X1={},Y1=[];for(var j=0;j<M1.length;j++){for(var k=0;k<N1.length;k++){if(M1[j]===N1[k]){for(var Z1 in L1){if(L1.hasOwnProperty(Z1)){var $1=L1[Z1][w.LABEL_KEY]||L1[Z1][w.NAME_KEY]||L1[Z1][w.NAME_CAP_KEY];if($1===N1[k]){Y1.push(Z1);}}}}}}for(var i=0;i<Y1.length;i++){X1[Y1[i]]=[];for(var j=0;j<U1.length-1;j++){if(j!=R1){X1[Y1[i]].push(U1[j][Y1[i]]);}}}var _1={$isOthers:true};var a2={getObject:function(){return _1;},getOtherNavigationDimensions:function(){return X1;}};if(O.checkIfAPIIsUsed(d)){if(d.checkAPINavigation()){c.onContentClicked(a2);}}else{if(W1){d.doNavigation(a2,W1,n);}}}else{for(var j=0;j<M1.length;j++){for(var k=0;k<N1.length;k++){if(M1[j]===N1[k]){for(var Z1 in L1){if(T1[S1.$Type+"/"+Z1]){var $1=(typeof T1[S1.$Type+"/"+Z1]["@"+w.LABEL_KEY_V4]==='string'&&T1[S1.$Type+"/"+Z1]["@"+w.LABEL_KEY_V4])||T1[S1.$Type+"/"+Z1][w.LABEL_KEY]||T1[S1.$Type+"/"+Z1][w.NAME_KEY]||T1[S1.$Type+"/"+Z1][w.NAME_CAP_KEY]||Z1;if($1.match(/{@i18n>.+}/gi)){var b2=this.getModel("@i18n").getResourceBundle();$1=b2.getText($1.substring($1.indexOf(">")+1,$1.length-1));}if($1===N1[k]){O1[Z1]=U1[R1][Z1];}}}}for(var Z1 in U1[R1]){if(L1.hasOwnProperty(Z1)){P1[Z1]=U1[R1][Z1];}}}}if(O1){o(Object.keys(O1),function(i,Z1){var r=L1[Z1]&&L1[Z1]["annotations"];if(L1[Z1]["$Type"]==="Edm.String"){if(L1[Z1]["sap:semantics"]==="yearmonth"||(r&&r["@com.sap.vocabularies.Common.v1.IsCalendarYearMonth"])){O1[Z1]=(O1[Z1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYMM"}).format(O1[Z1]):O1[Z1]);}else if(L1[Z1]["sap:semantics"]==="yearquarter"||(r&&r["@com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"])){O1[Z1]=(O1[Z1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYQ"}).format(O1[Z1]):O1[Z1]);}else if(L1[Z1]["sap:semantics"]==="yearweek"||(r&&r["@com.sap.vocabularies.Common.v1.IsCalendarYearWeek"])){O1[Z1]=(O1[Z1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYww"}).format(O1[Z1]):O1[Z1]);}}});}if(P1){o(Object.keys(P1),function(i,Z1){var r=L1[Z1]&&L1[Z1]["annotations"];if(L1[Z1]["$Type"]==="Edm.String"){if(L1[Z1]["sap:semantics"]==="yearmonth"||(r&&r["@com.sap.vocabularies.Common.v1.IsCalendarYearMonth"])){P1[Z1]=(P1[Z1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYMM"}).format(P1[Z1]):P1[Z1]);}else if(L1[Z1]["sap:semantics"]==="yearquarter"||(r&&r["@com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"])){P1[Z1]=(P1[Z1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYQ"}).format(P1[Z1]):P1[Z1]);}else if(L1[Z1]["sap:semantics"]==="yearweek"||(r&&r["@com.sap.vocabularies.Common.v1.IsCalendarYearWeek"])){P1[Z1]=(P1[Z1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYww"}).format(P1[Z1]):P1[Z1]);}}});}var c2=S1[m.getProperty('/presentationAnnotationPath')];if(S1){var d2=a.getRequestFields(c2);if(d2&&d2.length>0){o(d2,function(i,r){if(!O1.hasOwnProperty(r)){O1[r]=U1[R1][r];}});}}var a2={getObject:function(){return O1;},getAllData:function(){return P1;}};if(O.checkIfAPIIsUsed(d)){if(d.checkAPINavigation()){c.onContentClicked(a2);}}else{if(W1){d.doNavigation(a2,W1,n);}}}}});}function y1(d){if(d.$EnumMember.endsWith("Bubble")){return true;}else{return false;}}function z1(d){var r=false;if(!d||d.constructor!=Array||d.length<1||d[0].constructor!=Object||!d[0].Dimension||!d[0].Dimension.$PropertyPath){L.error(y.CHART_ANNO_ERROR+"in "+y.CHART_ANNO+" "+y.DIMENSIONS_MANDATORY);return r;}r=true;return r;}function A1(m){var r=false;if(!m||m.constructor!=Array||m.length<1||m[0].constructor!=Object||!m[0].Measure||!m[0].Measure.$PropertyPath){L.error(y.CHART_ANNO_ERROR+"in "+y.CHART_ANNO+" "+y.MEASURES_MANDATORY);return r;}r=true;return r;}function B1(d){d=d["$Type"];return d;}function C1(d){if(d&&d.indexOf("#")!=-1){var f=d.split("#");if(f.length>1){return f[1];}}return"";}function D1(n,v){var d=v.getModel('ovpCardProperties');var f=E1(v);var m=+f.itemsLength;var i=+d.getProperty("/dataStep");if(m&&i){var j=n.colSpan-1;if(j>=0){m+=i*j;F1(v,m);}}}function E1(v){var d=v.getModel('ovpCardProperties');var f=d.getProperty("/entityType");var i=d.getProperty("/presentationAnnotationPath");var j=f.hasOwnProperty(i)&&f[i];var m=j&&j.MaxItems;if(m){var k=m.Int32?m.Int32:m.Int;return{itemsLength:+k,dataStep:+d.getProperty("/dataStep")};}}function F1(v,d){var n,f={},j=[];var k=v.getVizType();var r=v.getModel('ovpCardProperties');var s=r.getProperty("/entityType");var x=r.getProperty("/chartAnnotationPath");var K1=s[x];var L1=v.getParent();var M1=L1.getBinding("data");f.path=M1.getPath();f.parameters={};if(M1.mParameters&&M1.mParameters.select){f.parameters.select=M1.mParameters.select;}f.filters=M1.aApplicationFilters;f.sorter=M1.aSorters;f.length=(k==="donut")?d+1:d;f.template=new g();L1.bindAggregation("data",f);if(k==="donut"){o(K1.MeasureAttributes,function(i,m){j.push(m.Measure.PropertyPath);});n={};n.path=M1.getPath();n.parameters={};n.parameters.select=j.join(",");n.filters=M1.aApplicationFilters;n.sorter=M1.aSorters;n.length=1;n.template=new g();L1.bindAggregation("aggregateData",n);}L1.updateBindingContext();}function G1(d,m,f){var i=d.getMetaModel().getData().$Annotations;for(var k in m){if(i[f+"/"+k]&&!m[k]["annotations"]){m[k]["annotations"]=i[f+"/"+k];}}}function H1(d){d.sort(function(r,f){if(r.index<f.index){return-1;}if(r.index>f.index){return 1;}return 0;});}function I1(d){return d.color!==undefined;}function J1(r){return r.dimensionValue;}return{constants:w,errorMessages:y,formatItems:E,formatByType:R,returnDateFormat:T,formatChartAxes:W,hideDateTimeAxis:X,checkExists:Y,validateCardConfiguration:Z,checkNoData:$,getConfig:_,hasTimeSemantics:a1,getChartType:b1,getPrimitiveValue:d1,formThePathForCriticalityStateCalculation:g1,checkFlag:j1,buildVizAttributes:q1,setChartUoMTitle:s1,getMetadata:u1,getSelectedDataPoint:x1,checkBubbleChart:y1,dimensionAttrCheck:z1,measureAttrCheck:A1,getEntitySet:B1,getAnnotationQualifier:C1,reprioritizeContent:D1,getMaxItems:E1,getLabelFromAnnotationPath:t1};},true);
