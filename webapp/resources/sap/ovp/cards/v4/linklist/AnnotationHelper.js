sap.ui.define(["sap/ovp/cards/v4/V4AnnotationHelper","sap/ui/model/odata/AnnotationHelper","sap/ui/model/FilterOperator","sap/ovp/cards/ovpLogger"],function(V,O,F,o){"use strict";var l=new o("OVP.v4.linklist.AnnotationHelper");function g(i){var S=[];var j,D;var P=i.getProperty("/sortBy");if(P){var u=i.getProperty("/sortOrder");if(u&&u.toLowerCase()!=="descending"){D=false;}else{D=true;}j={path:P,descending:D};S.push(j);}return S;}function a(u,S){var v=[];var C=u.getProperty("/filters");if(C){v=v.concat(C);}var w=S&&S.SelectOptions;var x,P,R;if(w){for(var i=0;i<w.length;i++){x=w[i];P=x.PropertyName.$PropertyPath;for(var j=0;j<x.Ranges.length;j++){R=x.Ranges[j];if(R.Sign.$EnumMember){var y={path:P,operator:R.Option.$EnumMember.split("/")[1],value1:V.getPrimitiveValue(R.Low),value2:V.getPrimitiveValue(R.High),sign:R.Sign.$EnumMember==="com.sap.vocabularies.UI.v1.SelectionRangeSignType/I"?"I":"E"};if(y.sign==="E"&&y.operator!==F.EQ){l.error("Exclude sign is supported only with EQ operator");continue;}if(y.sign==="E"&&y.operator===F.EQ){y.operator=F.NE;y.sign="I";}if(y.operator==="CP"&&y.sign==="I"){var I=F.Contains;var z=y.value1;if(z){var A=z.indexOf('*');var B=z.lastIndexOf('*');if(A>-1){if((A===0)&&(B!==(z.length-1))){I=F.EndsWith;z=z.substring(1,z.length);}else if((A!==0)&&(B===(z.length-1))){I=F.StartsWith;z=z.substring(0,z.length-1);}else{z=z.substring(1,z.length-1);}}}y.operator=I;y.value1=z;}v.push(y);}}}}return v;}function f(C,E,H){var M=C.getSetting("ovpCardProperties");var i=M.getProperty("/metaModel");var j=E;var u=i.getData();var v="/"+M.getProperty("/entitySet");var S;if(M.getProperty('/selectionAnnotationPath')){var w="@"+M.getProperty('/selectionAnnotationPath');S=u["$Annotations"][j.$Type][w];}var I;var x=M.getProperty("/layoutDetail");if(x==='resizable'){var y=M.getProperty("/cardLayout");if(y){if(M.getProperty("/listFlavor")==="standard"){var z="";for(var A in H){z+=A;}var R=M.getProperty("/cardLayout/iRowHeigthPx");if(R===undefined){R=16;}var B;if(M.getProperty("/densityStyle")==="cozy"){B=72;if((z.indexOf("Description")===-1)&&((z.indexOf("Title")>0&&z.indexOf("ImageUrl")>0)||(z.indexOf("Title")>0&&z.indexOf("TypeImageUrl")>0))){B=56;}else if((z.indexOf("Description")===-1)&&z.indexOf("Title")>0){B=48;}}else{B=60;if((z.indexOf("Description")===-1)&&((z.indexOf("Title")>0&&z.indexOf("ImageUrl")>0)||(z.indexOf("Title")>0&&z.indexOf("TypeImageUrl")>0))){B=48;}else if((z.indexOf("Description")===-1)&&z.indexOf("Title")>0){B=40;}}M.setProperty('/cardLayout/itemHeight',B);if(!M.getProperty("/defaultSpan")&&M.getProperty("/cardLayout/autoSpan")){I=M.getProperty("/cardLayout/noOfItems");var D=Math.ceil((I*B+M.getProperty("/cardLayout/headerHeight")+2*M.getProperty("/cardLayout/iCardBorderPx"))/R);M.setProperty("/cardLayout/noOfItems",D);}else{var G=Math.floor(((y.rowSpan*R)-M.getProperty("/cardLayout/headerHeight")-2*M.getProperty("/cardLayout/iCardBorderPx")));I=Math.floor(G/B)*y.colSpan;}}}}else{I=6;}var J=C.getSetting('ovpCardProperties'),P=J.getProperty('/parameters');if(S||!!P){if((S&&S.Parameters)||!!P){v=V.resolveParameterizedEntitySet(C.getSetting("dataModel"),E,S,P);}}var K="{path: '"+v+"', length: "+I;var L=g(M);if(L.length>0){K=K+", sorter:"+JSON.stringify(L);}var N=a(M,S);if(N.length>0){K=K+", filters:"+JSON.stringify(N);}var Q=V.checkFilterPreference(M);if(Q){K=K+", parameters:{custom: {cardId: '"+M.getProperty("/cardId")+"'}}";}K=K+"}";return K;}f.requiresIContext=true;function b(C,u){var B=C.getModel().getProperty("/baseUrl");return n(B,u);}b.requiresIContext=true;function c(i,D){var I=true;var j=O.format(i,D);if(j.toLowerCase().indexOf("icon")>0){I=false;}return I;}c.requiresIContext=true;function d(D){var i=true;if(!D){return null;}else if(D.toLowerCase().indexOf("icon")>0){i=false;}return i;}function e(u){var i=new RegExp("http(s)?:\/\/(www\.)?[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?","i");return i.test(u);}function h(T){var i;if(T.hasOwnProperty("$Path")){i="{"+T.$Path+"}";}else{i=T;}return i;}function k(i){var P="{"+i+"}";return P;}function m(A){if(A){return 1;}return 0;}function n(B,u){if(!u){return undefined;}else if(u.lastIndexOf(B,0)===0||u.indexOf("://")>0){return u;}else if(u.lastIndexOf("/",0)===0){return B+u;}else{return B+"/"+u;}}function p(i,S,v){var j;if(typeof v==="object"){j=v[i];}else{j=(typeof v==="boolean")?v:true;}return!S[i]&&j;}function q(L,j,u){var N="";if(L){if(j&&u){N="#"+j+"-"+u;for(var i=0;i<L.length;i++){if(L[i].value===N){return L[i].name;}}N="";}else{return L[0].name;}}return N;}function r(C,i){return n(C.baseUrl,i);}function s(R){return this.getModel("contentRow").aBindings[0].getContext().getPath().replace("/staticContent/","");}function t(i){return((i.$Path&&("{"+i.$Path+"}"))||i||"");}return{getSorters:g,getFilters:a,formatItems:f,formatUrl:b,isImageUrl:c,isImageUrlStaticData:d,isValidURL:e,getIconPath:h,formatString:k,linkedAction:m,formUrl:n,isVisible:p,getApplicationName:q,getImageUrl:r,contentRowIndex:s,getAvatarInitials:t};},true);
